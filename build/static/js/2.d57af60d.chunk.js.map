{"version":3,"sources":["../node_modules/react/index.js","../../src/errors.ts","../../src/constants.ts","../../src/logger.ts","../../src/firebaseApp.ts","../../src/firebaseNamespace.ts","../../src/firebaseNamespaceCore.ts","../../src/platformLoggerService.ts","../../index.ts","../../src/registerCoreComponents.ts","../node_modules/prop-types/index.js","../node_modules/history/node_modules/warning/browser.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js","../node_modules/warning/warning.js","../node_modules/invariant/browser.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js","../node_modules/react-transition-group/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js","../node_modules/react-dom/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/react-router/es/matchPath.js","../node_modules/webpack/buildin/global.js","../../src/assert.ts","../../src/crypt.ts","../../src/deepCopy.ts","../../src/deferred.ts","../../src/environment.ts","../../src/json.ts","../../src/jwt.ts","../../src/sha1.ts","../../src/subscribe.ts","../../src/validation.ts","../../src/obj.ts","../../src/query.ts","../../src/utf8.ts","../node_modules/object-assign/index.js","../node_modules/react-transition-group/Transition.js","../node_modules/react-lifecycles-compat/react-lifecycles-compat.es.js","../node_modules/react-transition-group/utils/PropTypes.js","../node_modules/react-transition-group/TransitionGroup.js","../../src/component.ts","../../src/provider.ts","../../src/component_container.ts","../node_modules/re-base/index.js","../node_modules/path-to-regexp/index.js","../node_modules/react/cjs/react.production.min.js","../node_modules/react-dom/cjs/react-dom.production.min.js","../node_modules/scheduler/index.js","../node_modules/scheduler/cjs/scheduler.production.min.js","../node_modules/react-transition-group/CSSTransition.js","../node_modules/prop-types/factoryWithThrowingShims.js","../node_modules/prop-types/lib/ReactPropTypesSecret.js","../node_modules/dom-helpers/class/addClass.js","../node_modules/@babel/runtime/helpers/interopRequireDefault.js","../node_modules/dom-helpers/class/hasClass.js","../node_modules/dom-helpers/class/removeClass.js","../node_modules/react-transition-group/ReplaceTransition.js","../node_modules/react-transition-group/utils/ChildMapping.js","../node_modules/babel-preset-react-app/node_modules/regenerator-runtime/runtime.js","../node_modules/@firebase/app/node_modules/tslib/tslib.es6.js","../node_modules/@firebase/util/node_modules/tslib/tslib.es6.js","../node_modules/@firebase/component/node_modules/tslib/tslib.es6.js","../../../node_modules/google-closure-library/closure/goog/base.js","../ [synthetic:util/defineproperty] ","../ [synthetic:util/global] ","../ [synthetic:es6/util/arrayiterator] ","../ [synthetic:es6/util/makeiterator] ","../ [synthetic:util/polyfill] ","../ [synthetic:es6/promise/promise] ","../../../node_modules/google-closure-library/closure/goog/promise/thenable.js","../../../node_modules/google-closure-library/closure/goog/debug/error.js","../../../node_modules/google-closure-library/closure/goog/asserts/asserts.js","../../../node_modules/google-closure-library/closure/goog/async/freelist.js","../../../node_modules/google-closure-library/closure/goog/async/workqueue.js","../../../node_modules/google-closure-library/closure/goog/dom/asserts.js","../../../node_modules/google-closure-library/closure/goog/array/array.js","../../../node_modules/google-closure-library/closure/goog/object/object.js","../../../node_modules/google-closure-library/closure/goog/string/const.js","../../../node_modules/google-closure-library/closure/goog/html/trustedresourceurl.js","../../../node_modules/google-closure-library/closure/goog/string/internal.js","../../../node_modules/google-closure-library/closure/goog/html/safeurl.js","../../../node_modules/google-closure-library/closure/goog/labs/useragent/util.js","../../../node_modules/google-closure-library/closure/goog/html/safehtml.js","../../../node_modules/google-closure-library/closure/goog/async/nexttick.js","../../../node_modules/google-closure-library/closure/goog/async/run.js","../../../node_modules/google-closure-library/closure/goog/string/string.js","../../../node_modules/google-closure-library/closure/goog/labs/useragent/engine.js","../../../node_modules/google-closure-library/closure/goog/dom/safe.js","../../../node_modules/google-closure-library/closure/goog/labs/useragent/browser.js","../../../node_modules/google-closure-library/closure/goog/promise/promise.js","../../../node_modules/google-closure-library/closure/goog/disposable/disposable.js","../../../node_modules/google-closure-library/closure/goog/reflect/reflect.js","../../../node_modules/google-closure-library/closure/goog/useragent/useragent.js","../../../node_modules/google-closure-library/closure/goog/debug/debug.js","../../../node_modules/google-closure-library/closure/goog/events/browserfeature.js","../../../node_modules/google-closure-library/closure/goog/events/event.js","../../../node_modules/google-closure-library/closure/goog/events/browserevent.js","../../../node_modules/google-closure-library/closure/goog/events/listenable.js","../../../node_modules/google-closure-library/closure/goog/events/listener.js","../../../node_modules/google-closure-library/closure/goog/events/listenermap.js","../../../node_modules/google-closure-library/closure/goog/events/events.js","../../../node_modules/google-closure-library/closure/goog/events/eventtarget.js","../../../node_modules/google-closure-library/closure/goog/timer/timer.js","../../../node_modules/google-closure-library/closure/goog/structs/structs.js","../../../node_modules/google-closure-library/closure/goog/structs/map.js","../../../node_modules/google-closure-library/closure/goog/uri/utils.js","../../../node_modules/google-closure-library/closure/goog/uri/uri.js","../../../node_modules/google-closure-library/closure/goog/dom/browserfeature.js","../../../node_modules/google-closure-library/closure/goog/dom/dom.js","../../../node_modules/google-closure-library/closure/goog/json/json.js","utils.js","../../../node_modules/google-closure-library/closure/goog/window/window.js","../../../node_modules/google-closure-library/closure/goog/labs/useragent/platform.js","../../../node_modules/google-closure-library/closure/goog/events/eventtype.js","deprecation.js","object.js","actioncodeinfo.js","error_auth.js","actioncodeurl.js","actioncodesettings.js","../../../node_modules/google-closure-library/closure/goog/crypt/base64.js","idtoken.js","defines.js","idp.js","additionaluserinfo.js","dynamiclink.js","authcredential.js","authevent.js","universallinksubscriber.js","rpchandler.js","../../../node_modules/google-closure-library/closure/goog/net/xmlhttp.js","error_invalidorigin.js","error_withcredential.js","../../../node_modules/google-closure-library/closure/goog/net/xmlhttpfactory.js","../../../node_modules/google-closure-library/closure/goog/net/corsxmlhttpfactory.js","../../../node_modules/google-closure-library/closure/goog/debug/logrecord.js","../../../node_modules/google-closure-library/closure/goog/debug/logger.js","../../../node_modules/google-closure-library/closure/goog/functions/functions.js","../../../node_modules/google-closure-library/closure/goog/log/log.js","../../../node_modules/google-closure-library/closure/goog/net/fetchxmlhttpfactory.js","../../../node_modules/google-closure-library/closure/goog/net/xhrio.js","../../../node_modules/google-closure-library/closure/goog/net/httpstatus.js","../../../node_modules/google-closure-library/third_party/closure/goog/mochikit/async/deferred.js","../../../node_modules/google-closure-library/closure/goog/net/jsloader.js","iframeclient/iframewrapper.js","iframeclient/ifchandler.js","storage/asyncstorage.js","messagechannel/receiver.js","storage/indexeddb.js","messagechannel/postmessager.js","messagechannel/sender.js","messagechannel/defines.js","storage/storage.js","storage/hybridindexeddb.js","storage/inmemorystorage.js","storage/localstorage.js","storage/nullstorage.js","storage/sessionstorage.js","storage/factory.js","authstorage.js","storageautheventmanager.js","../../../node_modules/google-closure-library/closure/goog/crypt/sha2.js","storageoauthhandlermanager.js","../../../node_modules/google-closure-library/closure/goog/crypt/hash.js","../../../node_modules/google-closure-library/closure/goog/crypt/sha256.js","cordovahandler.js","../../../node_modules/google-closure-library/closure/goog/crypt/crypt.js","storagependingredirectmanager.js","autheventmanager.js","authsettings.js","confirmationresult.js","idtokenresult.js","proactiverefresh.js","token.js","authuser.js","storageredirectusermanager.js","storageusermanager.js","auth.js","recaptchaverifier/grecaptcha.js","recaptchaverifier/grecaptchamock.js","recaptchaverifier/mockloader.js","recaptchaverifier/realloader.js","recaptchaverifier/recaptchaverifier.js","args.js","exports_lib.js","exports_auth.js","../node_modules/re-base/dist/bundle.js","../../src/core/storage/DOMStorageWrapper.ts","../../src/core/storage/MemoryStorage.ts","../../src/core/storage/storage.ts","../../src/core/util/util.ts","../../src/core/util/Path.ts","../../src/realtime/Constants.ts","../../src/core/RepoInfo.ts","../../src/core/util/libs/parser.ts","../../src/core/snap/indexes/KeyIndex.ts","../../src/core/snap/snap.ts","../../src/core/util/validation.ts","../../src/api/onDisconnect.ts","../../src/api/TransactionResult.ts","../../src/core/util/NextPushId.ts","../../src/core/snap/Node.ts","../../src/core/snap/indexes/Index.ts","../../src/core/snap/LeafNode.ts","../../src/core/snap/indexes/PriorityIndex.ts","../../src/core/snap/IndexMap.ts","../../src/core/snap/ChildrenNode.ts","../../src/core/util/SortedMap.ts","../../src/core/snap/childSet.ts","../../src/core/snap/comparators.ts","../../src/core/snap/nodeFromJSON.ts","../../src/core/snap/indexes/ValueIndex.ts","../../src/api/Query.ts","../../src/core/operation/Operation.ts","../../src/core/snap/indexes/PathIndex.ts","../../src/api/DataSnapshot.ts","../../src/core/view/Event.ts","../../src/core/view/EventRegistration.ts","../../src/core/SparseSnapshotTree.ts","../../src/core/util/ServerValues.ts","../../src/core/util/ImmutableTree.ts","../../src/core/SyncPoint.ts","../../src/core/operation/AckUserWrite.ts","../../src/core/operation/ListenComplete.ts","../../src/core/operation/Overwrite.ts","../../src/core/operation/Merge.ts","../../src/core/view/CacheNode.ts","../../src/core/view/ViewCache.ts","../../src/core/view/Change.ts","../../src/core/view/filter/IndexedFilter.ts","../../src/core/view/ChildChangeAccumulator.ts","../../src/core/view/CompleteChildSource.ts","../../src/core/view/ViewProcessor.ts","../../src/core/view/EventGenerator.ts","../../src/core/view/View.ts","../../src/core/CompoundWrite.ts","../../src/core/WriteTree.ts","../../src/core/SyncTree.ts","../../src/core/SnapshotHolder.ts","../../src/core/AuthTokenProvider.ts","../../src/core/stats/StatsCollection.ts","../../src/core/stats/StatsManager.ts","../../src/core/stats/StatsListener.ts","../../src/core/stats/StatsReporter.ts","../../src/core/view/EventQueue.ts","../../src/core/util/EventEmitter.ts","../../src/core/util/VisibilityMonitor.ts","../../src/core/util/OnlineMonitor.ts","../../src/realtime/polling/PacketReceiver.ts","../../src/realtime/BrowserPollConnection.ts","../../src/core/version.ts","../../src/realtime/WebSocketConnection.ts","../../src/realtime/TransportManager.ts","../../src/realtime/Connection.ts","../../src/core/ServerActions.ts","../../src/core/PersistentConnection.ts","../../src/core/ReadonlyRestClient.ts","../../src/core/Repo.ts","../../src/core/view/filter/RangedFilter.ts","../../src/core/view/filter/LimitedFilter.ts","../../src/core/view/QueryParams.ts","../../src/api/Reference.ts","../../src/core/util/Tree.ts","../../src/core/Repo_transaction.ts","../../src/core/RepoManager.ts","../../src/api/Database.ts","../../src/api/internal.ts","../../src/api/test_access.ts","../node_modules/process/browser.js","../node_modules/@firebase/database/node_modules/tslib/tslib.es6.js","../node_modules/isarray/index.js","../node_modules/resolve-pathname/index.js","../node_modules/value-equal/index.js","../node_modules/history/es/PathUtils.js","../node_modules/history/es/LocationUtils.js","../node_modules/history/es/createTransitionManager.js","../node_modules/history/es/DOMUtils.js","../node_modules/history/es/createBrowserHistory.js","../node_modules/react-router/es/Router.js","../node_modules/history/es/createHashHistory.js","../node_modules/history/es/createMemoryHistory.js","../node_modules/react-router-dom/es/Router.js","../node_modules/react-router-dom/es/BrowserRouter.js","../node_modules/react-router/es/Route.js","../node_modules/react-router-dom/es/Route.js","../node_modules/react-router/es/Switch.js","../node_modules/react-router-dom/es/Switch.js"],"names":["module","exports","require","ErrorFactory","DEFAULT_ENTRY_NAME","_a","appName","Logger","options","config","firebase_","isDeleted_","this","name_","name","automaticDataCollectionEnabled_","automaticDataCollectionEnabled","options_","deepCopy","container","ComponentContainer","_addComponent","Component","INTERNAL","components","values","component","checkDestroyed_","val","delete","Promise","resolve","then","removeApp","all","getProviders","map","provider","_getService","instanceIdentifier","getProvider","getImmediate","identifier","_removeServiceInstance","clearInstance","addComponent","e","logger","debug","_addOrOverwriteComponent","addOrOverwriteComponent","ERROR_FACTORY","create","FirebaseAppImpl","prototype","console","log","firebase","createFirebaseNamespace","namespace","firebaseAppImpl","apps","Map","__esModule","initializeApp","rawConfig","undefined","String","contains","app","registerVersion","libraryKeyOrName","version","variant","library","PLATFORM_LOG_STRING","libraryMismatch","match","versionMismatch","warning","push","warn","join","registerComponent","SDK_VERSION","useAsService","componentName","has","type","set","serviceNamespace","appArg","serviceProps","deepExtend","serviceFxn","bind","apply","multipleInstances","args","Object","keys","defineProperty","get","createFirebaseNamespaceCore","extendNamespace","props","createSubscribe","getPlatformInfoString","getComponent","isVersionServiceProvider","service","filter","logString","isBrowser","firebaseNamespace","isNode","PlatformLoggerService","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","i","length","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","_typeof2","obj","Symbol","iterator","constructor","_typeof","_possibleConstructorReturn","self","call","assertThisInitialized","_setPrototypeOf","p","_inherits","subClass","superClass","value","condition","format","a","b","c","d","f","error","Error","argIndex","replace","framesToPop","ownKeys","object","enumerableOnly","getOwnPropertySymbols","symbols","sym","getOwnPropertyDescriptor","_objectSpread2","arguments","source","forEach","getOwnPropertyDescriptors","defineProperties","_CSSTransition","_interopRequireDefault","_ReplaceTransition","_TransitionGroup","_Transition","default","Transition","TransitionGroup","ReplaceTransition","CSSTransition","checkDCE","__REACT_DEVTOOLS_GLOBAL_HOOK__","process","err","_assertThisInitialized","ReferenceError","_defineProperty","patternCache","cacheCount","compilePath","pattern","cacheKey","end","strict","sensitive","cache","compiledPattern","re","pathToRegexp","matchPath","pathname","parent","path","_options","_options$exact","exact","_options$strict","_options$sensitive","_compilePath","exec","url","slice","isExact","params","reduce","memo","index","g","Function","window","assert","assertion","message","assertionError","CONSTANTS","stringToByteArray","str","out","charCodeAt","base64","byteToCharMap_","charToByteMap_","byteToCharMapWebSafe_","charToByteMapWebSafe_","ENCODED_VALS_BASE","HAS_NATIVE_SUPPORT","atob","encodeByteArray","input","webSafe","Array","isArray","init_","byteToCharMap","output","byte1","haveByte2","byte2","haveByte3","byte3","outByte1","outByte2","outByte3","outByte4","encodeString","btoa","decodeString","bytes","pos","c1","fromCharCode","c2","u","c3","byteArrayToString","decodeStringToByteArray","charToByteMap","charAt","byte4","ENCODED_VALS","ENCODED_VALS_WEBSAFE","base64Decode","Date","getTime","prop","hasOwnProperty","reject","promise","wrapCallback","callback","catch","getUA","navigator","ERROR_NAME","code","FirebaseError","captureStackTrace","serviceName","errors","customData","data","fullCode","template","replaceTemplate","fullMessage","PATTERN","_","toString","jsonEval","JSON","parse","decode","token","header","claims","signature","parts","split","chain_","buf_","W_","pad_","inbuf_","total_","blockSize","reset","compress_","buf","offset","W","t","k","update","lengthMinusBlock","n","inbuf","digest","totalBits","j","executor","onNoObservers","observers","unsubscribes","observerCount","task","finalized","next","forEachObserver","observer","close","complete","subscribe","nextOrObserver","methods","method","implementsAnyMethods","noop","unsub","unsubscribeOne","finalError","fn","sendOne","errorPrefix","fnName","argumentNumber","optional","argName","onError","utf8Bytes","proxy","ObserverProxy","test","global","NODE_CLIENT","NODE_ADMIN","now","Math","floor","validSince","validUntil","contextObj","res","querystringParams","arrayVal","encodeURIComponent","entries","querystring","high","stringify","minCount","maxCount","argCount","argError","context","propIsEnumerable","propertyIsEnumerable","toObject","assign","test1","getOwnPropertyNames","test2","test3","letter","shouldUseNative","from","to","s","EXITING","ENTERED","ENTERING","EXITED","UNMOUNTED","PropTypes","newObj","desc","_interopRequireWildcard","_react","_reactDom","_reactLifecyclesCompat","_React$Component","_this","initialStatus","parentGroup","transitionGroup","appear","isMounting","enter","appearStatus","in","unmountOnExit","mountOnEnter","state","status","nextCallback","_proto","getChildContext","getDerivedStateFromProps","_ref","prevState","componentDidMount","updateStatus","componentDidUpdate","prevProps","nextStatus","componentWillUnmount","cancelNextCallback","getTimeouts","exit","timeout","mounting","node","findDOMNode","performEnter","performExit","setState","_this2","appearing","timeouts","onEnter","safeSetState","onEntering","onTransitionEnd","onEntered","_this3","onExit","onExiting","onExited","cancel","nextState","setNextCallback","_this4","active","event","handler","addEndListener","setTimeout","render","_this$props","children","childProps","excluded","sourceKeys","indexOf","_objectWithoutPropertiesLoose","child","Children","only","cloneElement","contextTypes","childContextTypes","propTypes","defaultProps","_default","polyfill","componentWillMount","componentWillReceiveProps","nextProps","componentWillUpdate","__reactInternalSnapshotFlag","__reactInternalSnapshot","getSnapshotBeforeUpdate","isReactComponent","foundWillMountName","foundWillReceivePropsName","foundWillUpdateName","UNSAFE_componentWillMount","UNSAFE_componentWillReceiveProps","UNSAFE_componentWillUpdate","displayName","newApiName","maybeSnapshot","snapshot","__suppressDeprecationWarning","transitionTimeout","transitionType","timeoutPropName","enabledPropName","classNamesShape","timeoutsShape","_propTypes","oneOfType","number","shape","isRequired","string","enterDone","enterActive","exitDone","exitActive","_ChildMapping","_extends","handleExited","firstRender","appeared","mounted","prevChildMapping","getInitialChildMapping","getNextChildMapping","currentChildMapping","getChildMapping","childFactory","createElement","instanceFactory","instantiationMode","setInstantiationMode","mode","setMultipleInstances","setServiceProps","instances","instancesDeferred","normalizedIdentifier","normalizeInstanceIdentifier","deferred","Deferred","getOrInitializeService","setComponent","isComponentEager","instanceDeferred","services","isComponentSet","normalizeIdentifierForFactory","providers","Provider","LogLevel","defaultLogLevel","INFO","defaultLogHandler","logType","logLevel","toISOString","DEBUG","VERBOSE","info","WARN","ERROR","_logLevel","_logHandler","isarray","compile","tokensToFunction","tokensToRegExp","PATH_REGEXP","RegExp","tokens","defaultDelimiter","delimiter","m","escaped","prefix","capture","group","modifier","asterisk","partial","repeat","escapeGroup","escapeString","substr","encodeURIComponentPretty","encodeURI","toUpperCase","matches","opts","encode","pretty","segment","attachKeys","flags","route","endsWithDelimiter","groups","regexpToRegexp","arrayToRegexp","stringToRegexp","for","q","r","v","w","x","y","z","A","B","C","D","h","l","aa","E","isMounted","enqueueForceUpdate","enqueueReplaceState","enqueueSetState","F","G","refs","updater","H","I","forceUpdate","J","isPureReactComponent","K","current","currentDispatcher","L","M","ref","__self","__source","N","$$typeof","_owner","O","P","Q","R","pop","result","keyPrefix","func","count","S","V","T","U","done","escape","ca","da","ba","X","toArray","createRef","PureComponent","createContext","_calculateChangedBits","_currentValue","_currentValue2","_threadCount","Consumer","_context","forwardRef","lazy","_ctor","_status","_result","compare","Fragment","StrictMode","Suspense","createFactory","isValidElement","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","unstable_ConcurrentMode","unstable_Profiler","Y","Z","ea","fa","ha","ia","ja","ka","ma","na","oa","pa","extractEvents","eventTypes","qa","phasedRegistrationNames","ra","registrationName","sa","ta","dependencies","ua","va","wa","xa","currentTarget","la","ya","concat","za","Aa","Ba","_dispatchListeners","_dispatchInstances","isPropagationStopped","isPersistent","release","Ca","injectEventPluginOrder","injectEventPluginsByName","Da","stateNode","disabled","Ea","Fa","random","Ga","Ha","Ia","parentNode","tag","Ja","Ka","La","Ma","return","Na","dispatchConfig","Oa","_targetInst","Pa","Qa","Ra","Sa","document","Ta","toLowerCase","Ua","animationend","animationiteration","animationstart","transitionend","Va","Wa","Xa","style","animation","transition","Ya","Za","$a","ab","bb","cb","eb","fb","gb","textContent","hb","ib","nativeEvent","Interface","isDefaultPrevented","defaultPrevented","returnValue","kb","eventPool","lb","destructor","jb","getPooled","preventDefault","stopPropagation","cancelBubble","persist","eventPhase","bubbles","cancelable","timeStamp","isTrusted","extend","mb","nb","ob","pb","qb","documentMode","rb","sb","tb","ub","beforeInput","bubbled","captured","compositionEnd","compositionStart","compositionUpdate","vb","wb","keyCode","xb","detail","yb","Bb","locale","which","zb","ctrlKey","altKey","metaKey","char","Ab","Cb","Db","Eb","Hb","Ib","Jb","Kb","Lb","Mb","Nb","Ob","Pb","color","date","datetime","email","month","password","range","search","tel","text","time","week","Qb","nodeName","Rb","srcElement","correspondingUseElement","nodeType","Sb","setAttribute","Tb","Vb","_valueTracker","getValue","setValue","stopTracking","Ub","Wb","checked","Xb","Yb","Zb","$b","ac","bc","cc","dc","ec","fc","gc","hc","ic","jc","kc","lc","mc","nc","_debugOwner","_debugSource","fileName","lineNumber","oc","pc","qc","rc","acceptsBooleans","attributeName","attributeNamespace","mustUseProperty","propertyName","vc","xc","yc","tc","isNaN","uc","sc","removeAttribute","setAttributeNS","zc","Ac","defaultChecked","defaultValue","_wrapperState","initialChecked","Bc","initialValue","controlled","Cc","Dc","Ec","Fc","ownerDocument","activeElement","tabIndex","Gc","change","Hc","Jc","Kc","Lc","Mc","Nc","Oc","Pc","detachEvent","Qc","Rc","attachEvent","Sc","Tc","Uc","Vc","_isInputEventSupported","Wc","view","Xc","Alt","Control","Meta","Shift","Yc","getModifierState","Zc","$c","ad","bd","cd","dd","screenX","screenY","clientX","clientY","pageX","pageY","shiftKey","button","buttons","relatedTarget","fromElement","toElement","movementX","movementY","ed","pointerId","width","height","pressure","tangentialPressure","tiltX","tiltY","twist","pointerType","isPrimary","fd","mouseEnter","mouseLeave","pointerEnter","pointerLeave","gd","defaultView","parentWindow","alternate","hd","id","jd","kd","effectTag","ld","nd","sibling","md","od","animationName","elapsedTime","pseudoElement","pd","clipboardData","qd","rd","charCode","sd","Esc","Spacebar","Left","Up","Right","Down","Del","Win","Menu","Apps","Scroll","MozPrintableKey","td","8","9","12","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","112","113","114","115","116","117","118","119","120","121","122","123","144","145","224","ud","location","vd","dataTransfer","wd","touches","targetTouches","changedTouches","xd","yd","deltaX","wheelDeltaX","deltaY","wheelDeltaY","wheelDelta","deltaZ","deltaMode","zd","Ad","Bd","Cd","isInteractive","Dd","isInteractiveTopLevelEventType","Ed","Fd","Gd","targetInst","ancestors","containerInfo","topLevelType","Hd","Id","Jd","addEventListener","Kd","Ld","Md","Nd","Od","Pd","body","Qd","firstChild","Rd","nextSibling","Td","HTMLIFrameElement","contentDocument","Ud","contentEditable","Vd","Wd","select","Xd","Yd","Zd","$d","ae","start","selectionStart","selectionEnd","anchorNode","getSelection","anchorOffset","focusNode","focusOffset","be","onSelect","ee","de","fe","selected","defaultSelected","ge","dangerouslySetInnerHTML","he","ie","je","SimpleEventPlugin","EnterLeaveEventPlugin","ChangeEventPlugin","SelectEventPlugin","BeforeInputEventPlugin","ke","html","mathml","svg","le","me","ne","oe","MSApp","execUnsafeLocalFunction","namespaceURI","innerHTML","removeChild","appendChild","pe","lastChild","nodeValue","qe","animationIterationCount","borderImageOutset","borderImageSlice","borderImageWidth","boxFlex","boxFlexGroup","boxOrdinalGroup","columnCount","columns","flex","flexGrow","flexPositive","flexShrink","flexNegative","flexOrder","gridArea","gridRow","gridRowEnd","gridRowSpan","gridRowStart","gridColumn","gridColumnEnd","gridColumnSpan","gridColumnStart","fontWeight","lineClamp","lineHeight","opacity","order","orphans","tabSize","widows","zIndex","zoom","fillOpacity","floodOpacity","stopOpacity","strokeDasharray","strokeDashoffset","strokeMiterlimit","strokeOpacity","strokeWidth","se","trim","te","setProperty","substring","ue","menuitem","area","base","br","col","embed","hr","img","keygen","link","meta","param","track","wbr","ve","we","is","xe","blur","focus","ye","ze","Ae","Be","autoFocus","Ce","__html","De","Ee","clearTimeout","Fe","Ge","Set","He","Ie","Je","Ke","Le","__reactInternalMemoizedUnmaskedChildContext","__reactInternalMemoizedMaskedChildContext","Me","Ne","Oe","Pe","Qe","__reactInternalMemoizedMergedChildContext","Re","Se","Te","Ue","We","elementType","pendingProps","firstContextDependency","memoizedState","updateQueue","memoizedProps","lastEffect","firstEffect","nextEffect","childExpirationTime","expirationTime","Xe","Ze","$e","af","bf","cf","df","pendingChildren","implementation","ef","didError","earliestPendingTime","latestPendingTime","ff","gf","latestPingedTime","earliestSuspendedTime","latestSuspendedTime","hf","nextExpirationTimeToWorkOn","jf","kf","baseState","firstUpdate","lastUpdate","firstCapturedUpdate","lastCapturedUpdate","firstCapturedEffect","lastCapturedEffect","lf","mf","payload","nf","of","pf","qf","rf","sf","tf","uf","vf","stack","wf","xf","yf","zf","Af","Bf","Cf","Df","observedBits","Ef","Ff","Gf","Hf","If","documentElement","tagName","Jf","Kf","Lf","Nf","Of","Pf","Uf","_reactInternalFiber","Qf","Rf","Sf","Tf","Vf","shouldComponentUpdate","Wf","contextType","readContext","Xf","Yf","Zf","$f","_stringRef","ag","bg","cg","dg","eg","fg","gg","hg","ig","jg","kg","lg","mg","ng","og","pg","qg","rg","sg","tg","ug","vg","getDerivedStateFromError","wg","pendingContext","xg","timedOutAt","fallback","yg","Mf","Ye","element","hydrate","hidden","unstable_observedBits","zg","Ag","Bg","Fg","Gg","Hg","Ig","Jg","Kg","destroy","Lg","Mg","Ng","insertBefore","_reactRootContainer","onclick","Og","wasMultiple","multiple","display","Pg","Qg","Rg","componentDidCatch","Sg","add","componentStack","Tg","onClick","Ug","Vg","Wg","Xg","Yg","Zg","$g","ah","bh","ch","dh","unstable_cancelCallback","eh","createElementNS","createTextNode","fh","gh","pendingCommitExpirationTime","hh","maxDuration","ih","finishedWork","jh","kh","lh","mh","nh","oh","ph","qh","rh","sh","th","uh","vh","wh","xh","yh","zh","unstable_now","Ah","Bh","Ch","Dh","Eh","unstable_scheduleCallback","Fh","timeoutHandle","Gh","Hh","Ih","nextScheduledRoot","Jh","Kh","Lh","unstable_shouldYield","_onComplete","Mh","firstBatch","_expirationTime","_defer","rangeCount","db","focusedElem","selectionRange","Th","__reactInternalSnapshotBeforeUpdate","Sd","compareDocumentPosition","min","createRange","setStart","removeAllRanges","addRange","setEnd","left","scrollLeft","top","scrollTop","Fb","Gb","wc","ci","Cg","Dg","di","Ic","Eg","ce","Nh","Oh","Ph","Qh","Rh","Sh","Vh","_root","_callbacks","_next","_hasChildren","_didComplete","_children","Wh","_didCommit","_onCommit","Xh","_internalRoot","Yh","$h","legacy_renderSubtreeIntoContainer","hasAttribute","Zh","ai","Uh","querySelectorAll","form","commit","unmount","createBatch","bi","createPortal","unstable_renderSubtreeIntoContainer","unmountComponentAtNode","unstable_createPortal","unstable_batchedUpdates","unstable_interactiveUpdates","flushSync","unstable_flushControlled","Events","unstable_createRoot","findFiberByHostInstance","isDisabled","supportsFiber","inject","onCommitFiberRoot","onCommitFiberUnmount","Ve","findHostInstanceByFiber","bundleType","rendererPackageName","ei","fi","previous","priorityLevel","requestAnimationFrame","cancelAnimationFrame","performance","_schedMock","MessageChannel","port2","port1","onmessage","postMessage","unstable_ImmediatePriority","unstable_UserBlockingPriority","unstable_NormalPriority","unstable_IdlePriority","unstable_LowPriority","unstable_runWithPriority","unstable_wrapCallback","unstable_getCurrentPriorityLevel","_addClass","_removeClass","addClass","classes","removeClass","_len","_key","className","getClassNames","removeClasses","activeClassName","reflowAndAddClass","doneClassName","classNames","_this$getClassNames7","ReactPropTypesSecret","emptyFunction","shim","propName","propFullName","secret","getShim","ReactPropTypes","array","bool","symbol","any","arrayOf","instanceOf","objectOf","oneOf","checkPropTypes","classList","_hasClass","baseVal","replaceClassName","origClass","classToRemove","remove","_args","handleEnter","_len2","_key2","handleLifecycle","handleEntering","_len3","_key3","handleEntered","_len4","_key4","handleExit","_len5","_key5","handleExiting","_len6","_key6","_len7","_key7","idx","originalArgs","_child$props","inProp","_React$Children$toArr","first","second","mergeChildMappings","getProp","nextChildMapping","hasPrev","hasNext","prevChild","isLeaving","mapFn","mapper","prev","getValueForKey","nextKeysPending","pendingKeys","prevKey","childMapping","nextKey","pendingNextKey","runtime","Op","hasOwn","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","Context","_invoke","GenStateSuspendedStart","arg","GenStateExecuting","GenStateCompleted","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","GenStateSuspendedYield","makeInvokeMethod","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","NativeIteratorPrototype","Gp","defineIteratorMethods","AsyncIterator","previousPromise","callInvokeWithMethodAndArg","invoke","__await","unwrapped","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","iterable","iteratorMethod","isGeneratorFunction","genFun","ctor","mark","awrap","async","iter","reverse","skipTempReset","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","finish","thrown","delegateYield","regeneratorRuntime","accidentalStrictMode","extendStatics","__extends","__","__assign","__rest","__decorate","decorators","Reflect","decorate","__param","paramIndex","decorator","__metadata","metadataKey","metadataValue","metadata","__awaiter","thisArg","_arguments","fulfilled","step","rejected","__generator","label","trys","ops","verb","op","__exportStar","__values","__read","ar","__spread","__spreadArrays","il","jl","__asyncGenerator","resume","fulfill","settle","shift","__asyncDelegator","__asyncValues","__makeTemplateObject","cooked","raw","__importStar","mod","__importDefault","$jscomp.defineProperty","$jscomp.global","$jscomp.arrayIteratorImpl","$jscomp.polyfill","$jscomp.makeIterator","goog","goog.global","goog.isString","goog.isBoolean","goog.cspNonce_","goog.nullFunction","goog.typeOf","goog.isNull","goog.isArray","goog.isArrayLike","goog.isFunction","goog.isObject","goog.uidCounter_","goog.bindNative_","goog.bindJs_","boundArgs","newArgs","goog.bind","goog.bind.apply","goog.partial","goog.inherits","tempCtor","parentCtor","childCtor","childCtor.base","goog.Thenable.isImplementedBy","goog.debug.Error","opt_msg","goog.asserts.AssertionError","returnString","subLast","splitParts","messagePattern","messageArgs","sub","goog.debug.Error.call","goog.asserts.fail","opt_message","put","item","goog.async.WorkQueue","goog.async.FreeList","goog.async.WorkQueue.prototype.remove","goog.async.WorkItem","goog.dom.asserts.assertIsElementType_","doc","win","goog.async.WorkQueue.prototype.add","goog.async.WorkQueue.freelist_.get","goog.async.WorkItem.prototype.set","scope","goog.async.WorkItem.prototype.reset","opt_fromIndex","arr","fromIndex","goog.array.forEach","arr2","opt_obj","goog.array.some","goog.array.contains","goog.array.indexOf","goog.array.remove","rv","goog.array.removeAllIf","goog.array.forEachRight","removedCount","goog.array.concat","goog.array.toArray","goog.object.forEach","goog.object.isEmpty","goog.object.clone","goog.object.extend","goog.object.PROTOTYPE_FIELDS_.length","goog.object.PROTOTYPE_FIELDS_","goog.string.Const","opt_token","goog.string.Const.unwrap","stringConst","goog.string.Const.prototype.getTypedStringValue","goog.string.Const.prototype.toString","goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_","goog.string.Const.EMPTY","goog.html.TrustedResourceUrl","goog.html.TrustedResourceUrl.unwrapTrustedScriptURL","trustedResourceUrl","goog.html.TrustedResourceUrl.format","formatStr","goog.html.TrustedResourceUrl.BASE_URL_.test","goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse","goog.html.TrustedResourceUrl.prototype.getTypedStringValue","goog.html.TrustedResourceUrl.prototype.toString","goog.html.TrustedResourceUrl.BASE_URL_","goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_","goog.string.internal.AMP_RE_","goog.string.internal.LT_RE_","goog.string.internal.GT_RE_","goog.string.internal.QUOT_RE_","goog.string.internal.SINGLE_QUOTE_RE_","goog.string.internal.NULL_RE_","goog.string.internal.ALL_RE_","goog.string.internal.contains","goog.string.internal.compareElements_","goog.html.SafeUrl","goog.html.SafeUrl.unwrapTrustedURL","safeUrl","goog.html.SafeUrl.prototype.getTypedStringValue","goog.html.SafeUrl.prototype.toString","goog.html.SAFE_URL_PATTERN_.test","goog.html.SafeUrl.INNOCUOUS_STRING","goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse","goog.global.navigator","userAgent","goog.labs.userAgent.util.matchUserAgent","goog.labs.userAgent.util.userAgent_","goog.html.SafeHtml","goog.html.SafeHtml.unwrapTrustedHTML","safeHtml","goog.html.SafeHtml.prototype.getTypedStringValue","goog.html.SafeHtml.prototype.toString","goog.html.SafeHtml.prototype.initSecurityPrivateDoNotAccessOrElse_","initSecurityPrivateDoNotAccessOrElse_","goog.string.subs","subsArguments","goog.string.htmlEscape","goog.string.internal.ALL_RE_.test","goog.async.throwException","goog.global.setTimeout","Channel","iframe","goog.dom.safe.setIframeSrc","write","origin","channel","head","tail","script","onreadystatechange","script.onreadystatechange","goog.async.run","goog.async.run.schedule_","goog.async.run.initializeRunner_","goog.global.Promise","goog.global.Promise.resolve","goog.async.run.processWorkQueue","goog.global.setImmediate","goog.global.Window","goog.async.nextTick.setImmediate_","goog.async.nextTick.getSetImmediateEmulator_","goog.async.run.workQueueScheduled_","goog.async.run.workQueue_.add","goog.async.run.workQueue_","goog.Promise","goog.Promise.State_.PENDING","resolver","resolve_","reason","PENDING","FULFILLED","REJECTED","goog.Promise.CallbackEntry_","goog.Promise.CallbackEntry_.prototype.reset","goog.Promise.freelist_.get","onFulfilled","onRejected","goog.Promise.resolve","opt_value","goog.Promise.reject","goog.Promise.resolveThen_","goog.Promise.maybeThen_","goog.Promise.allSettled","toSettle","promises","results","onSettled","goog.Promise.prototype.addCallbackEntry_","hasEntry_","scheduleCallbacks_","queueEntry_","callbackEntriesTail_","callbackEntry","goog.Promise.prototype.addChildPromise_","goog.Promise.getCallbackEntry_","addCallbackEntry_","goog.Promise.State_.REJECTED","BLOCKED","goog.Promise.addUnhandledRejection_","goog.Promise.handleRejection_.call","goog.Promise.tryThen_","called","goog.Promise.prototype.scheduleCallbacks_","goog.Promise.prototype.popEntry_","goog.Promise.invokeCallback_","goog.Promise.prototype.then","addChildPromise_","goog.Promise.prototype.thenAlways","goog.Promise.prototype","goog.Promise.prototype.thenCatch","goog.Promise.prototype.cancel","goog.Promise.prototype.cancelInternal_","parent_","childCount","childEntry","beforeChildEntry","childPromise","cancelInternal_","removeEntryAfter_","popEntry_","goog.Promise.prototype.unblockAndFulfill_","goog.Promise.prototype.unblockAndReject_","goog.Promise.prototype.executeCallbacks_","executeCallback_","goog.Promise.CancellationError","goog.Disposable","goog.Disposable.instances_","OFF","goog.Disposable.prototype.dispose","goog.Disposable.MONITORING_MODE","uid","goog.reflect.sinkValue","goog.Disposable.prototype.disposeInternal","goog.userAgent.IE","goog.userAgent.EDGE","goog.userAgent.EDGE_OR_IE","goog.userAgent.GECKO","goog.userAgent.WEBKIT","goog.userAgent.getDocumentMode_","goog.userAgent.getVersionRegexResult_","docMode","parseFloat","goog.userAgent.DOCUMENT_MODE","goog.reflect.cache","cacheObj","valueFn","v1Subs","goog.string.internal.trim","v2Subs","subCount","subIdx","v1Sub","v2Sub","v1Comp","v2Comp","v1CompNum","parseInt","v2CompNum","HAS_W3C_EVENT_SUPPORT","Number","SET_KEY_CODE_TO_PREVENT_DEFAULT","goog.userAgent.isVersionOrHigher","PASSIVE_EVENTS","goog.global.addEventListener","passive","goog.events.Event","opt_target","goog.events.BrowserEvent","goog.events.Event.call","opt_e","init","relevantTouch","opt_currentTarget","goog.events.BrowserEvent.IE_POINTER_TYPE_MAP","event_","goog.events.Event.prototype.preventDefault","goog.debug.freezeInternal_","2","TOUCH","3","PEN","4","goog.events.BrowserEvent.prototype.preventDefault","goog.events.BrowserEvent.superClass_.preventDefault.call","VK_F1","VK_F12","goog.events.BrowserEvent.prototype.getBrowserEvent","goog.events.ListenableKey.counter_","goog.events.Listener","listener","src","opt_handler","goog.events.Listener.prototype.markAsRemoved","goog.events.ListenerMap","goog.events.ListenerMap.prototype.removeByKey","markAsRemoved","goog.events.ListenerMap.findListenerIndex_","listenerArray","listenerObj","goog.events.ListenerMap.prototype.add","typeStr","callOnce","goog.events.onStringMap_","goog.events.listen","opt_options","goog.events.listenOnce","goog.events.wrapListener","listen","goog.events.listen_","listenerMap","goog.events.getListenerMap_","goog.events.getProxy","proxyCallbackFunction","goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT","goog.events.BrowserFeature.PASSIVE_EVENTS","goog.events.getOnString_","goog.events.listenerCountEstimate_","listenOnce","goog.events.unlisten","eventTargetListeners_","listeners","goog.events.unlistenByKey","removeByKey","typeCount_","goog.events.onString_","goog.events.fireListeners_","retval","goog.events.fireListener","listenerFn","listenerHandler","goog.events.handleBrowserEvent_","cur","evt","ieEvent","useReturnValue","handleEvent","goog.events.EventTarget","goog.Disposable.call","goog.events.EventTarget.prototype.listen","goog.events.EventTarget.prototype.listenOnce","goog.events.EventTarget.prototype.fireListeners","unlistenByKey","eventObject","goog.Timer.callOnce","goog.Timer.MAX_TIMEOUT_","goog.Timer.INVALID_TIMEOUT_ID_","goog.global.clearTimeout","opt_delay","goog.Timer.promise","timerKey","thenCatch","opt_result","goog.structs.getValues","goog.structs.getKeys","getValues","goog.structs.Map","argLength","opt_map","getKeys","addAll","goog.structs.Map.prototype.cleanupKeysArray_","srcIndex","destIndex","goog.structs.Map.hasKey_","seen","goog.events.EventTarget.prototype.addEventListener","goog.events.EventTarget.prototype.removeEventListener","goog.events.EventTarget.prototype.dispatchEvent","ancestor","parentEventTarget_","ancestorsTree","actualEventTarget_","oldEvent","opt_ancestorsTree","fireListeners","goog.events.EventTarget.prototype.disposeInternal","goog.events.EventTarget.superClass_.disposeInternal.call","removeAllListeners","goog.structs.Map.prototype.getValues","cleanupKeysArray_","goog.structs.Map.prototype","goog.structs.Map.prototype.getKeys","clear","goog.structs.Map.prototype.clear","goog.structs.Map.prototype.get","goog.structs.Map.prototype.set","goog.structs.Map.prototype.forEach","goog.Uri","opt_uri","fragment_","setScheme","setUserInfo","userInfo_","setDomain","domain_","setPort","setPath","path_","setQueryData","clone","setFragment","opt_ignoreCase","SCHEME","goog.Uri.decodeOrEmpty_","USER_INFO","DOMAIN","PORT","PATH","QUERY_DATA","FRAGMENT","goog.Uri.prototype.setScheme","opt_decode","newScheme","goog.Uri.prototype.setPort","newPort","goog.Uri.prototype.setQueryData","queryData","goog.Uri.QueryData.prototype.setIgnoreCase","ignoreCase","ensureKeyMapInitialized_","invalidateCache_","encodedQuery_","lowerCase","goog.Uri.encodeSpecialChars_","goog.Uri.prototype.setParameterValue","goog.Uri.prototype.getParameterValue","goog.Uri.parse","uri","goog.Uri.create","opt_domain","opt_path","opt_preserveReserved","decodeURI","decodeURIComponent","encoded","opt_removeDoubleEncoding","goog.Uri.encodeChar_","goog.Uri.prototype.toString","scheme","getScheme","domain","getDomain","userInfo","getUserInfo","port","getPort","getPath","hasDomain","query","getEncodedQuery","queryData_","fragment","getFragment","goog.Uri.prototype.resolve","absoluteUri","overridden","relativeUri","hasPath","lastSlashIndex","leadingSlash","lastIndexOf","segments","goog.Uri.reDisallowedInRelativePath_","goog.Uri.reDisallowedInAbsolutePath_","goog.Uri.reDisallowedInQuery_","goog.Uri.reDisallowedInFragment_","goog.Uri.QueryData","opt_query","goog.Uri.QueryData.prototype.ensureKeyMapInitialized_","goog.uri.utils.parseQueryData","pairs","encodedQuery","indexOfEquals","goog.Uri.QueryData.createFromMap","setValues","goog.Uri.QueryData.prototype.remove","getKeyName_","map_","keyMap_","goog.Uri.QueryData.prototype.containsKey","goog.Uri.QueryData.prototype.setValues","goog.Uri.QueryData.prototype.getKeyName_","keyName","goog.Uri.QueryData.prototype.add","goog.Uri.QueryData.prototype","goog.Uri.QueryData.prototype.clear","goog.Uri.QueryData.prototype.forEach","goog.Uri.QueryData.prototype.getKeys","vals","goog.Uri.QueryData.prototype.getValues","containsKey","goog.Uri.QueryData.prototype.set","goog.Uri.QueryData.prototype.get","opt_default","goog.Uri.QueryData.prototype.toString","encodedKey","CAN_ADD_NAME_OR_TYPE_ATTRIBUTES","goog.dom.getElementHelper_","goog.dom.setProperties","goog.dom.DIRECT_ATTRIBUTE_MAP_.hasOwnProperty","goog.dom.DIRECT_ATTRIBUTE_MAP_","attributes","tagNameArr","goog.dom.append_","childHandler","startIndex","goog.dom.isNodeList","goog.json.Serializer.prototype.serializeInternal","sep","serializeInternal","serializeArray","serializeString_","serializeObject_","isFinite","serialize","goog.json.Serializer","goog.json.Serializer.charsToReplace_","goog.json.Serializer.charToJsonCharCache_","fireauth.util.isLocalStorageNotSynchronized","fireauth.util.getUserAgentString","fireauth.util.getCurrentUrl","fireauth.util.goTo","opt_window","finalUrl","goog.html.SafeUrl.sanitize","fireauth.util.isMobileBrowser","uaLower","opt_userAgent","fireauth.util.closeWindow","fireauth.util.popup","opt_name","opt_width","opt_height","fireauth.util.getBrowserName","opt_url","parentWin","safeLinkRef","linkRef","option","optionString","href","click","newWin","sanitizedLinkRef","fireauth.util.EMAIL_ADDRESS_REGEXP_","fireauth.util.onDomReady","goog.global.document","LOAD","fireauth.util.isAndroidOrIosCordovaScheme","fireauth.util.getCurrentScheme","fireauth.util.isIframe","fireauth.util.isWorker","fireauth.util.getEnvironment","REACT_NATIVE","NODE","WORKER","BROWSER","fireauth.util.isNativeEnvironment","environment","FIREFOX","CHROME","OPERA","IEMOBILE","IE","EDGE","fireauth.util.BrowserName.FIREFOX","SILK","BLACKBERRY","WEBOS","ANDROID","OTHER","SAFARI","DEFAULT","FIREBASEUI","fireauth.util.getClientVersion","frameworkVersion","frameworkSet","fireauth.util.Framework","providedFrameworks","reportedEnvironment","fireauth.util.getObjectRef","pieces","varStrName","last","opt_scope","fireauth.util.isWebStorageSupported","storage","fireauth.util.generateEventId","fireauth.util.isPopupRedirectSupported","fireauth.util.isHttpOrHttps","fireauth.util.runsInBackground","fireauth.util.stringifyJSON","goog.json.serialize","fireauth.util.copyWithoutNullsOrUndefined","trimmedObj","fireauth.util.parseJSON","opt_prefix","fireauth.util.iframeCanSyncWebStorage","fireauth.util.resetUnloadedGapiModules","beacon","hint","fireauth.util.Delay","shortDelay","fireauth.util.isAppVisible","fireauth.util.utcTimestampToDateString","fireauth.util.isAuthHandlerOrIframe","fireauth.util.Delay.prototype.get","fireauth.util.Delay.OFFLINE_DELAY_MS_","fireauth.deprecation.log","fireauth.deprecation.shownMessages_","fireauth.object.setReadonlyProperty","fireauth.object.readonlyConfigurable_","fireauth.object.setReadonlyProperties","fireauth.object.makeReadonlyCopy","fireauth.object.unsafeCreateReadOnlyCopy","copy","fireauth.ActionCodeInfo","response","newEmail","operation","EMAIL_SIGNIN","EMAIL","NEW_EMAIL","REQUEST_TYPE","FROM_EMAIL","DATA","OPERATION","fireauth.AuthError","fireauth.AuthError.ERROR_CODE_PREFIX","fireauth.AuthError.MESSAGES_","fireauth.AuthError.fromPlainObject","fireauth.AuthError.ERROR_CODE_PREFIX.length","fireauth.AuthError.prototype.toPlainObject","fireauth.AuthError.prototype.toJSON","ADMIN_ONLY_OPERATION","ARGUMENT_ERROR","APP_NOT_AUTHORIZED","APP_NOT_INSTALLED","CAPTCHA_CHECK_FAILED","CODE_EXPIRED","CORDOVA_NOT_READY","CORS_UNSUPPORTED","CREDENTIAL_ALREADY_IN_USE","CREDENTIAL_MISMATCH","CREDENTIAL_TOO_OLD_LOGIN_AGAIN","DYNAMIC_LINK_NOT_ACTIVATED","EMAIL_EXISTS","EXPIRED_OOB_CODE","EXPIRED_POPUP_REQUEST","INTERNAL_ERROR","INVALID_APP_CREDENTIAL","INVALID_APP_ID","INVALID_AUTH","INVALID_AUTH_EVENT","INVALID_CODE","INVALID_CONTINUE_URI","INVALID_CORDOVA_CONFIGURATION","INVALID_CUSTOM_TOKEN","INVALID_DYNAMIC_LINK_DOMAIN","INVALID_EMAIL","INVALID_API_KEY","INVALID_CERT_HASH","INVALID_IDP_RESPONSE","INVALID_MESSAGE_PAYLOAD","INVALID_OAUTH_PROVIDER","INVALID_OAUTH_CLIENT_ID","INVALID_ORIGIN","INVALID_OOB_CODE","INVALID_PASSWORD","INVALID_PERSISTENCE","INVALID_PHONE_NUMBER","INVALID_PROVIDER_ID","INVALID_RECIPIENT_EMAIL","INVALID_SENDER","INVALID_SESSION_INFO","INVALID_TENANT_ID","MISSING_ANDROID_PACKAGE_NAME","MISSING_AUTH_DOMAIN","MISSING_APP_CREDENTIAL","MISSING_CODE","MISSING_CONTINUE_URI","MISSING_IFRAME_START","MISSING_IOS_BUNDLE_ID","MISSING_OR_INVALID_NONCE","MISSING_PHONE_NUMBER","MISSING_SESSION_INFO","MODULE_DESTROYED","NEED_CONFIRMATION","NETWORK_REQUEST_FAILED","NO_AUTH_EVENT","NO_SUCH_PROVIDER","NULL_USER","OPERATION_NOT_ALLOWED","OPERATION_NOT_SUPPORTED","POPUP_BLOCKED","POPUP_CLOSED_BY_USER","PROVIDER_ALREADY_LINKED","QUOTA_EXCEEDED","REDIRECT_CANCELLED_BY_USER","REDIRECT_OPERATION_PENDING","REJECTED_CREDENTIAL","TENANT_ID_MISMATCH","TIMEOUT","TOKEN_EXPIRED","TOO_MANY_ATTEMPTS_TRY_LATER","UNAUTHORIZED_DOMAIN","UNSUPPORTED_PERSISTENCE","UNSUPPORTED_TENANT_OPERATION","USER_CANCELLED","USER_DELETED","USER_DISABLED","USER_MISMATCH","USER_SIGNED_OUT","WEAK_PASSWORD","WEB_STORAGE_UNSUPPORTED","fireauth.ActionCodeURL","apiKey","getParameterValue","fireauth.ActionCodeURL.ModeToOperationMap_","fireauth.ActionCodeURL.QueryField.API_KEY","API_KEY","CODE","CONTINUE_URL","LANGUAGE_CODE","MODE","TENANT_ID","RECOVER_EMAIL","PASSWORD_RESET","VERIFY_EMAIL","fireauth.ActionCodeSettings","continueUrl","settingsObj","initialize_","continueUrl_","amv_","apn_","installApp_","androidSettings","apn","installApp","amv","fireauth.ActionCodeSettings.AndroidRawField.INSTALL_APP","fireauth.ActionCodeSettings.AndroidRawField.MINIMUM_VERSION","fireauth.ActionCodeSettings.AndroidRawField.PACKAGE_NAME","fireauth.ActionCodeSettings.RawField.ANDROID","ibi_","iosSettings","ibi","fireauth.ActionCodeSettings.IosRawField.BUNDLE_ID","fireauth.ActionCodeSettings.RawField.IOS","canHandleCodeInApp","fireauth.ActionCodeSettings.RawField.HANDLE_CODE_IN_APP","canHandleCodeInApp_","dynamicLinkDomain","fireauth.ActionCodeSettings.RawField.DYNAMIC_LINK_DOMAIN","dynamicLinkDomain_","DYNAMIC_LINK_DOMAIN","HANDLE_CODE_IN_APP","IOS","URL","INSTALL_APP","MINIMUM_VERSION","PACKAGE_NAME","BUNDLE_ID","request","goog.crypt.base64.charToByteMap_","goog.crypt.base64.decodeString","goog.crypt.base64.decodeStringInternal_","getByte","nextCharIndex","goog.crypt.base64.init_","goog.crypt.base64.byteToCharMap_","goog.crypt.base64.ENCODED_VALS.charAt","goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt","pushByte","fireauth.IdToken","goog.now","fireauth.IdToken.parse","fireauth.IdToken.parseIdTokenClaims","fields","tokenString","padLen","jsonInfo","fireauth.IdToken.prototype.getTenantId","fireauth.IdToken.prototype.isAnonymous","PRODUCTION","firebaseAuthEndpoint","secureTokenEndpoint","STAGING","TEST","endpointKey","fireauth.constants.Endpoint","endpoint","fireauth.constants.getEndpointConfig","fireauth.idp.RESERVED_OAUTH2_PARAMS","fireauth.idp.Settings","FACEBOOK","languageParam","popupWidth","popupHeight","providerId","reservedOAuthParameters","GITHUB","GOOGLE","TWITTER","APPLE","fireauth.AdditionalUserInfo.fromPlainObject","factory","fireauth.FacebookAdditionalUserInfo","fireauth.GoogleAdditionalUserInfo","fireauth.GithubAdditionalUserInfo","fireauth.TwitterAdditionalUserInfo","resp","ID_TOKEN","PROVIDER_ID","idToken","providerId_","ANONYMOUS","CUSTOM","isNewUser","fireauth.FederatedAdditionalUserInfo","fireauth.GenericAdditionalUserInfo.call","profile","fireauth.FederatedAdditionalUserInfo.call","fireauth.DynamicLink.parseDeepLink","doubleDeepLink","iOSdeepLink","fireauth.AuthCredential","fireauth.AuthCredential.verifyTokenResponseUid","idTokenResolver","parsedIdToken","localId_","fireauth.SAMLAuthCredential","fireauth.SAMLAuthCredential.prototype.makeVerifyAssertionRequest_","fireauth.SAMLAuthCredential.fromJSON","json","fireauth.constants.SAML_PREFIX","fireauth.OAuthCredential","oauthResponse","postBody","fireauth.FederatedProvider","opt_reservedParams","fireauth.idp.getIdpSettings","fireauth.SAMLAuthProvider","fireauth.FederatedProvider.call","fireauth.OAuthProvider","fireauth.FacebookAuthProvider","fireauth.OAuthProvider.call","accessToken","accessTokenOrObject","credential","fireauth.GithubAuthProvider","fireauth.GoogleAuthProvider","fireauth.GoogleAuthProvider.credential","idTokenOrObject","fireauth.TwitterAuthProvider","fireauth.TwitterAuthProvider.credential","tokenObject","tokenOrObject","fireauth.EmailAuthCredential","PASSWORD","opt_signInMethod","fireauth.EmailAuthProvider","fireauth.EmailAuthCredential.fromJSON","fireauth.EmailAuthProvider.credentialWithLink","actionCodeUrl","fireauth.EmailAuthProvider.getActionCodeUrlFromSignInEmailLink","fireauth.ActionCodeURL.parseLink","emailLink","fireauth.PhoneAuthCredential","PHONE","allowedKeys","fireauth.PhoneAuthCredential.prototype.makeVerifyPhoneNumberRequest_","fireauth.PhoneAuthProvider","opt_auth","fireauth.PhoneAuthProvider.credential","verificationId","verificationCode","temporaryProof","phoneNumber","accessTokenSecret","rawNonce","pendingToken","fireauth.FacebookAuthProvider.credential","fireauth.GithubAuthProvider.credential","fireauth.AuthProvider.checkIfOAuthSupported","fireauth.AuthEvent","opt_eventId","opt_urlResponse","opt_sessionId","opt_postBody","opt_tenantId","opt_error","fireauth.AuthEvent.fromPlainObject","rawResponse","fireauth.UniversalLinkSubscriber","fireauth.SAMLAuthCredential.prototype.getIdTokenProvider","verifyAssertion","makeVerifyAssertionRequest_","fireauth.SAMLAuthCredential.prototype.linkToIdToken","verifyAssertionForLinking","fireauth.SAMLAuthCredential.prototype.matchIdTokenWithUid","verifyAssertionForExisting","fireauth.SAMLAuthCredential.prototype.toPlainObject","fireauth.OAuthCredential.prototype.getIdTokenProvider","fireauth.OAuthCredential.prototype.linkToIdToken","fireauth.OAuthCredential.prototype.matchIdTokenWithUid","fireauth.OAuthCredential.prototype.toPlainObject","fireauth.FederatedProvider.prototype.setCustomParameters","fireauth.OAuthProvider.prototype.addScope","fireauth.OAuthProvider.prototype.getScopes","fireauth.OAuthProvider.prototype.credential","optionsOrIdToken","opt_accessToken","fireauth.EmailAuthCredential.prototype.getIdTokenProvider","invokeRpc_","rpcHandler","fireauth.EmailAuthCredential.prototype.linkToIdToken","fireauth.EmailAuthCredential.prototype.matchIdTokenWithUid","fireauth.EmailAuthCredential.prototype.toPlainObject","EMAIL_LINK","EMAIL_PASSWORD","fireauth.PhoneAuthCredential.prototype.getIdTokenProvider","makeVerifyPhoneNumberRequest_","fireauth.PhoneAuthCredential.prototype.linkToIdToken","fireauth.PhoneAuthCredential.prototype.matchIdTokenWithUid","fireauth.PhoneAuthCredential.prototype.toPlainObject","fireauth.PhoneAuthProvider.prototype.verifyPhoneNumber","applicationVerifier","fireauth.RpcHandler.prototype.sendVerificationCode","sendVerificationCode","fireauth.AuthEvent.prototype.getUid","fireauth.AuthEvent.prototype.getTenantId","fireauth.AuthEvent.prototype.toPlainObject","fireauth.InvalidOriginError","scheme_","fireauth.InvalidOriginError.base","fireauth.AuthErrorWithCredential","fireauth.AuthError.call","credentialInfo","opt_credentialInfo","fireauth.AuthProvider.getCredentialFromResponse","tenantId","goog.net.XmlHttpFactory","goog.net.XmlHttpFactory.prototype.getOptions","goog.net.DefaultXmlHttpFactory","ACTIVE_X_IDENTS","candidate","goog.net.CorsXmlHttpFactory","XDomainRequest","UNINITIALIZED","responseText","goog.net.IeCorsXhrAdapter.prototype.setReadyState_","readyState","goog.debug.LogRecord","opt_time","opt_sequenceNumber","fireauth.AuthErrorWithCredential.prototype.toPlainObject","fireauth.AuthErrorWithCredential.prototype.toJSON","goog.net.DefaultXmlHttpFactory.prototype.createInstance","progId","getProgId_","ActiveXObject","goog.net.DefaultXmlHttpFactory.prototype.internalGetOptions","USE_NULL_FUNCTION","LOCAL_REQUEST_ERROR","goog.net.XmlHttp.factory_","goog.net.CorsXmlHttpFactory.prototype.createInstance","xhr","XMLHttpRequest","goog.net.IeCorsXhrAdapter","goog.net.CorsXmlHttpFactory.prototype.internalGetOptions","goog.net.IeCorsXhrAdapter.prototype.open","send","goog.net.IeCorsXhrAdapter.prototype.send","goog.net.IeCorsXhrAdapter.prototype","goog.net.IeCorsXhrAdapter.prototype.abort","goog.net.IeCorsXhrAdapter.prototype.setRequestHeader","goog.net.IeCorsXhrAdapter.prototype.getResponseHeader","goog.net.IeCorsXhrAdapter.prototype.handleLoad_","setReadyState_","COMPLETE","goog.net.IeCorsXhrAdapter.prototype.handleError_","goog.net.IeCorsXhrAdapter.prototype.handleTimeout_","handleProgress_","goog.net.IeCorsXhrAdapter.prototype.handleProgress_","LOADING","goog.net.IeCorsXhrAdapter.prototype.getAllResponseHeaders","goog.debug.Logger","goog.debug.Logger.Level","goog.debug.LogRecord.prototype.reset","goog.debug.LogRecord.nextSequenceNumber_","goog.debug.Logger.Level.prototype.toString","goog.debug.Logger.Level.WARNING","goog.debug.Logger.Level.CONFIG","goog.debug.Logger.Level.FINE","goog.debug.Logger.prototype.log","level","goog.debug.Logger.prototype.getEffectiveLevel","getEffectiveLevel","msg","logRecord","opt_exception","exception_","doLogRecord_","goog.debug.LogManager.rootLogger_","goog.debug.Logger.ROOT_LOGGER_NAME","goog.debug.LogManager.loggers_","goog.debug.LogManager.rootLogger_.setLevel","ret","lastDotIndex","leafName","parentLogger","goog.debug.LogManager.getLogger","children_","goog.log.fine","goog.net.FetchXmlHttpFactory","goog.net.FetchXmlHttp","goog.events.EventTarget.call","worker","goog.net.FetchXmlHttp.RequestState.UNSENT","statusText","Headers","goog.net.FetchXmlHttpFactory.prototype.createInstance","UNSENT","goog.net.FetchXmlHttp.prototype.readInputFromFetch_","setStatus","DONE","dispatchCallback_","goog.net.FetchXmlHttp.prototype.dispatchCallback_","goog.net.XhrIo","opt_xmlHttpFactory","goog.net.XhrIo.ResponseType.DEFAULT","open","goog.net.FetchXmlHttp.prototype.open","OPENED","goog.net.FetchXmlHttp.prototype","goog.net.FetchXmlHttp.prototype.send","requestInit","headers","credentials","opt_data","Request","abort","goog.net.FetchXmlHttp.prototype.abort","handleResponse_","goog.net.FetchXmlHttp.prototype.handleResponse_","HEADER_RECEIVED","goog.global.ReadableStream","TextDecoder","goog.net.FetchXmlHttp.prototype.handleDataFromStream_","newText","Uint8Array","stream","requestDone_","readInputFromFetch_","goog.net.FetchXmlHttp.prototype.handleResponseText_","goog.net.FetchXmlHttp.prototype.handleResponseArrayBuffer_","responseArrayBuffer","goog.net.FetchXmlHttp.prototype.handleSendFailure_","logger_","goog.net.FetchXmlHttp.prototype.setRequestHeader","goog.net.FetchXmlHttp.prototype.getResponseHeader","getAllResponseHeaders","goog.net.FetchXmlHttp.prototype.getAllResponseHeaders","lines","pair","goog.net.XhrIo.METHODS_WITH_FORM_DATA","opt_method","createXhr","xmlHttpFactory_","goog.net.XmlHttp.factory_.createInstance","getOptions","formatMsg_","error_","content","opt_content","opt_headers","goog.structs.forEach","contentTypeKey","goog.array.find","contentIsFormData","goog.net.XhrIo.CONTENT_TYPE_HEADER","goog.net.XhrIo.FORM_CONTENT_TYPE","cleanUpTimeoutTimer_","goog.net.XhrIo.shouldUseXhr2Timeout_","goog.net.XhrIo.isContentTypeHeader_","goog.net.XhrIo.prototype.error_","dispatchErrors_","cleanUpXhr_","goog.net.XhrIo.prototype.dispatchErrors_","getReadyState","getStatus","isSuccess","OK","CREATED","ACCEPTED","NO_CONTENT","PARTIAL_CONTENT","NOT_MODIFIED","QUIRK_IE_NO_CONTENT","goog.global.self","goog.global.self.location","protocol","goog.global.self.location.protocol","goog.net.XhrIo.HTTP_SCHEME_PATTERN.test","getStatusText","xhr_","goog.net.XhrIo.prototype.cleanUpXhr_","clearedOnReadyStateChange","opt_fromDispose","goog.net.XhrIo.prototype.cleanUpTimeoutTimer_","goog.net.XhrIo.prototype.getReadyState","goog.net.XhrIo.prototype.getStatus","goog.net.XhrIo.prototype.formatMsg_","goog.async.Deferred","opt_onCancelFunction","opt_defaultScope","goog.async.Deferred.prototype.updateResult_","fire_","goog.async.Deferred.prototype.check_","hasFired","goog.async.Deferred.prototype.addCallbacks","goog.async.Deferred.prototype.hasErrback_","sequenceRow","goog.async.Deferred.prototype.fire_","fired_","hasErrback_","unhandledErrorId_","goog.async.Deferred.errorMap_","isNewlyBlocked","unhandledException","sequenceEntry","errback","ex","onCallback","onErrback","addCallbacks","deferredError","goog.async.Deferred.AlreadyCalledError","goog.async.Deferred.CanceledError","goog.async.Deferred.Error_","goog.net.XhrIo.prototype.timeout_","dispatchEvent","goog.net.XhrIo.prototype","goog.net.XhrIo.prototype.abort","goog.net.XhrIo.prototype.disposeInternal","goog.net.XhrIo.superClass_.disposeInternal.call","goog.net.XhrIo.prototype.onReadyStateChange_","isDisposed","onReadyStateChangeHelper_","goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_","goog.net.XhrIo.prototype.getResponse","TEXT","ARRAY_BUFFER","goog.async.Deferred.prototype.cancel","opt_deepCancel","branches_","check_","updateResult_","goog.async.Deferred.prototype.continue_","goog.async.Deferred.prototype.then","goog.async.Deferred.Error_.prototype.throwError","goog.net.jsloader.safeLoad","script_","timeout_","timeoutDuration","goog.net.jsloader.DEFAULT_TIMEOUT","goog.net.jsloader.cleanup_","script.onerror","properties","goog.dom.safe.setScriptSrc","nonce","goog.NONCE_PATTERN_.test","goog.net.jsloader.getScriptParentElement_","headElements","getElementsByTagName","goog.net.jsloader.cancel_","scriptNode","removeScriptNode","LOAD_ERROR","goog.net.jsloader.Error","fireauth.XmlHttpFactory","opt_config","fireauth.RpcHandler.DEFAULT_SECURE_TOKEN_TIMEOUT_","fireauth.RpcHandler.DEFAULT_FIREBASE_TIMEOUT_","opt_firebaseClientVersion","fireauth.XmlHttpFactory.prototype.createInstance","fireauth.XmlHttpFactory.prototype.internalGetOptions","fireauth.RpcHandler.DEFAULT_SECURE_TOKEN_HEADERS_","fireauth.RpcHandler.DEFAULT_FIREBASE_HEADERS_","fireauth.RpcHandler.prototype.updateCustomLocaleHeader","languageCode","fireauth.RpcHandler.FIREBASE_LOCALE_KEY_","fireauth.RpcHandler.prototype.updateClientVersion","clientVersion","fireauth.RpcHandler.prototype.sendXhr_","fireauth.util.supportsCors","sendXhr","fireauth.RpcHandler.loadGApi_","goog.async.Deferred.prototype.addErrback","addErrback","fireauth.RpcHandler.loadGApiJs_","fireauth.RpcHandler","fireauth.RpcHandler.prototype.getTenantId","fireauth.RpcHandler.prototype.sendXhrUsingXhrIo_","xhrIo","timeoutInterval_","requestTimeout","goog.net.XhrIo.prototype.getResponseText","getResponseText","opt_callback","dispose","fireauth.RpcHandler.GAPI_CALLBACK_NAME_","fireauth.RpcHandler.validateRequestHasEmail_","fireauth.RpcHandler.validateEmailIfPresent_","fireauth.RpcHandler.validateIdTokenResponse_","fireauth.RpcHandler.validateVerifyPhoneNumberRequest_","fireauth.RpcHandler.prototype.sendXhrUsingGApiClient_","fireauth.RpcHandler.loadGApi_.then","apiKey_","oauth2Token","fireauth.RpcHandler.prototype.signInAnonymously","fireauth.RpcHandler.prototype.updateEmail","fireauth.RpcHandler.prototype.updatePassword","fireauth.RpcHandler.validateVerifyAssertionRequest_","fireauth.RpcHandler.processVerifyAssertionResponse_","fireauth.constants.OIDC_PREFIX","NONCE","fireauth.RpcHandler.validateVerifyAssertionResponse_","fireauth.AuthErrorWithCredential.fromPlainObject","FEDERATED_USER_ID_ALREADY_LINKED","fireauth.RpcHandler.getDeveloperErrorFromCode_","fireauth.RpcHandler.prototype.verifyAssertion","fireauth.RpcHandler.prototype.verifyAssertionForLinking","fireauth.RpcHandler.prototype.verifyAssertionForExisting","fireauth.RpcHandler.validateApplyActionCodeRequest_","updateProfile","fireauth.RpcHandler.prototype.updateProfile","fieldsToDelete","fieldValue","profileData","fieldName","fireauth.RpcHandler.prototype","fireauth.RpcHandler.prototype.sendPasswordResetEmail","fireauth.RpcHandler.prototype.sendSignInLinkToEmail","fireauth.RpcHandler.prototype.sendEmailVerification","fireauth.RpcHandler.prototype.verifyPhoneNumber","fireauth.RpcHandler.prototype.confirmPasswordReset","fireauth.RpcHandler.prototype.checkActionCode","fireauth.RpcHandler.prototype.applyActionCode","APPLY_OOB_CODE","requestValidator","responseField","requireTenantId","CHECK_ACTION_CODE","responseValidator","fireauth.RpcHandler.validateCheckActionCodeResponse_","CREATE_ACCOUNT","fireauth.RpcHandler.validateCreateAccountRequest_","returnSecureToken","CREATE_AUTH_URI","DELETE_ACCOUNT","requestRequiredFields","DELETE_LINKED_ACCOUNTS","fireauth.RpcHandler.validateDeleteLinkedAccountsRequest_","EMAIL_LINK_SIGNIN","EMAIL_LINK_SIGNIN_FOR_LINKING","GET_ACCOUNT_INFO","GET_EMAIL_SIGNIN_CODE","fireauth.RpcHandler.validateEmailSignInCodeRequest_","GET_EMAIL_VERIFICATION_CODE","fireauth.RpcHandler.validateEmailVerificationCodeRequest_","GET_OOB_CODE","fireauth.RpcHandler.validateOobCodeRequest_","GET_PROJECT_CONFIG","cachebuster","httpMethod","GET","GET_RECAPTCHA_PARAM","fireauth.RpcHandler.validateGetRecaptchaParamResponse_","RESET_PASSWORD","SEND_VERIFICATION_CODE","SESSION_INFO","SET_ACCOUNT_INFO","SET_ACCOUNT_INFO_SENSITIVE","fireauth.RpcHandler.validateSetAccountInfoSensitive_","SIGN_IN_ANONYMOUSLY","VERIFY_ASSERTION","responsePreprocessor","VERIFY_ASSERTION_FOR_EXISTING","fireauth.RpcHandler.validateVerifyAssertionForExistingResponse_","USER_NOT_FOUND","VERIFY_ASSERTION_FOR_LINKING","fireauth.RpcHandler.validateVerifyAssertionLinkRequest_","VERIFY_CUSTOM_TOKEN","fireauth.RpcHandler.validateVerifyCustomTokenRequest_","VERIFY_PASSWORD","fireauth.RpcHandler.validateVerifyPasswordRequest_","VERIFY_PHONE_NUMBER","VERIFY_PHONE_NUMBER_FOR_LINKING","fireauth.RpcHandler.validateVerifyPhoneNumberLinkRequest_","fireauth.RpcHandler.validateVerifyPhoneNumberForLinkingResponse_","VERIFY_PHONE_NUMBER_FOR_EXISTING","customErrorMap","fireauth.RpcHandler.verifyPhoneNumberForExistingErrorMap_","fireauth.object.hasNonEmptyFields","opt_fields","field","POST","fireauth.RpcHandler.prototype.requestFirebaseEndpoint","setParameterValue","getApiKey","opt_cachebuster","isGet","sendXhr_","fireauth.RpcHandler.getDeveloperError_","opt_customErrorMap","firebaseTimeout_","requestFirebaseEndpoint","tempResponse","errorReasonMap","apiaryError","prefixCode","serverErrorCode","errorMap","MISSING_CUSTOM_TOKEN","INVALID_IDENTIFIER","MISSING_PASSWORD","PASSWORD_LOGIN_DISABLED","INVALID_PENDING_TOKEN","EMAIL_NOT_FOUND","RESET_PASSWORD_EXCEED_LIMIT","MISSING_OOB_CODE","INVALID_ID_TOKEN","INVALID_TEMPORARY_PROOF","SESSION_EXPIRED","errorMessage","fireauth.iframeclient.IframeWrapper","fireauth.iframeclient.IframeWrapper.prototype.open_","fireauth.iframeclient.IframeWrapper.cachedGApiLoader_","onGapiLoad","ontimeout","fireauth.iframeclient.IframeWrapper.NETWORK_TIMEOUT_.get","cbName","fireauth.iframeclient.IframeWrapper.loadGApiJs_","url_","onOpen","clearTimerAndResolve","iframe_","networkErrorTimer","fireauth.iframeclient.IframeWrapper.PING_TIMEOUT_.get","open_","fireauth.iframeclient.IframeWrapper.NETWORK_TIMEOUT_","fireauth.iframeclient.IframeWrapper.PING_TIMEOUT_","fireauth.iframeclient.IframeUrlBuilder","authDomain","fireauth.iframeclient.OAuthUrlBuilder","authType","fireauth.iframeclient.OAuthUrlBuilder.getAuthFrameworksForApp_","fireauth.iframeclient.IfcHandler","opt_clientVersion","opt_endpointId","fireauth.iframeclient.IfcHandler.getOriginValidator_","fireauth.RpcHandler.prototype.getAuthorizedDomains","getAuthorizedDomains","authorizedDomains","domainPattern","fireauth.util.IP_ADDRESS_REGEXP_.test","escapedDomainPattern","fireauth.iframeclient.IfcHandler.prototype.initialize","clientVersion_","endpointId_","builder","authDomain_","setEndpointId","frameworks_","opt_frameworks","iframeUrl_","iframeWrapper_","fireauth.iframeclient.IfcHandler.prototype.registerEvents_","fireauth.iframeclient.IframeWrapper.prototype.registerEvent","AUTH_EVENT","registerEvent","resolveResponse","isHandled","authEvent","authEventListeners_","ACK","registerEvents_","setEventId","eventId_","v_","additionalParams_","opt_additionalParams","setTenantId","fireauth.storage.AsyncStorage","opt_asyncStorage","fireauth.messagechannel.Receiver","eventTarget","fireauth.iframeclient.IframeUrlBuilder.prototype.toString","fireauth.iframeclient.OAuthUrlBuilder.prototype.setTenantId","fireauth.iframeclient.OAuthUrlBuilder.prototype.toString","provider_","getAuthLanguage_","defaultLanguageCode","reservedParams_","scopes","frameworks","getAuthFrameworks_","fireauth.iframeclient.IfcHandler.prototype.startPopupTimeout","popupClosedByUserError","webStorageNotSupportedError","isResolved","fireauth.iframeclient.IfcHandler.prototype.isWebStorageSupported","WEB_STORAGE_SUPPORT_EVENT","initialize","fireauth.iframeclient.IframeWrapper.prototype.sendMessage","sendMessage","isWebStorageSupported","isSupported","popupWin","fireauth.util.onPopupClose","fireauth.util.POPUP_WAIT_CYCLE_MS_","shouldBeInitializedEarly","fireauth.iframeclient.IfcHandler.prototype.shouldBeInitializedEarly","fireauth.iframeclient.IfcHandler.prototype","fireauth.iframeclient.IfcHandler.prototype.hasVolatileStorage","fireauth_CordovaHandler_prototype$processPopup","fireauth.iframeclient.IfcHandler.prototype.processPopup","opt_alreadyRedirected","onInitialize","getRpcHandler_","onReady","fireauth.iframeclient.IfcHandler.getOAuthHelperWidgetUrl","fireauth.iframeclient.IfcHandler.prototype.processRedirect","fireauth.iframeclient.IfcHandler.prototype.initializeAndWait","fireauth.iframeclient.IfcHandler.prototype.unloadsOnRedirect","fireauth.iframeclient.IfcHandler.prototype.addAuthEventListener","fireauth.iframeclient.IfcHandler.prototype.removeAuthEventListener","ele","fireauth.storage.AsyncStorage.prototype.get","fireauth.storage.AsyncStorage.prototype","fireauth.storage.AsyncStorage.prototype.set","fireauth.storage.AsyncStorage.prototype.remove","fireauth.storage.AsyncStorage.prototype.addStorageListener","fireauth.storage.AsyncStorage.prototype.removeStorageListener","fireauth.messagechannel.Receiver.prototype.subscribe","fireauth.messagechannel.WorkerClientPostMessager","fireauth.messagechannel.Sender","postMessager","fireauth.messagechannel.Sender.prototype.send","CONNECTION_UNAVAILABLE","ackTimeout","opt_useLongTimeout","LONG_ACK","messageChannel","eventId","digits","ackTimer","UNSUPPORTED_EVENT","onMessage","COMPLETION","UNKNOWN","INVALID_RESPONSE","messageHandlers_","removeMessageHandler_","fireauth.messagechannel.Sender.prototype.removeMessageHandler_","messageHandler","fireauth.storage.IndexedDB","fireauth.storage.IndexedDB.isAvailable","goog.global.indexedDB","INDEXEDDB","fireauth.messagechannel.Receiver.getInstance","receiver","eventTarget_","fireauth.messagechannel.Receiver.receivers_.push","sync_","fireauth.util.getActiveServiceWorker","registration","sw","fireauth.storage.IndexedDB.prototype.initializeDb_","indexedDB_","fireauth.storage.IndexedDB.DB_NAME_","fireauth.storage.IndexedDB.VERSION_","request.onerror","request.onupgradeneeded","fireauth.storage.IndexedDB.DATA_OBJECT_STORE_NAME_","fireauth.storage.IndexedDB.DATA_KEY_PATH_","request.onsuccess","fireauth.storage.IndexedDB.prototype.deleteDb_","deleteDb_","initializeDb_","fireauth.storage.IndexedDB.prototype.initializeDbAndRun_","fireauth.storage.IndexedDB.prototype.getDataObjectStore_","tx","fireauth.storage.IndexedDB.prototype.getTransaction_","isReadWrite","fireauth.storage.IndexedDB.prototype.onIDBRequest_","fireauth.storage.IndexedDB.prototype.notifySW_","fireauth.util.getServiceWorkerController","initializeDbAndRun_","objectStore","getDataObjectStore_","getTransaction_","onIDBRequest_","cursor","centralCopy","diffKeys","fireauth.util.getKeyDiff","diff","localMap_","fireauth.storage.IndexedDB.prototype.stopListeners_","fireauth.storage.IndexedDB.STOP_ERROR_","fireauth.storage.HybridIndexedDB","fallbackStorage","randomId","randomKey","fireauth.storage.IndexedDB.managerInstance_","fireauth.storage.InMemoryStorage","IN_MEMORY","fireauth.storage.LocalStorage","fireauth.storage.LocalStorage.isAvailable","fireauth.storage.LocalStorage.getGlobalStorage","fireauth.storage.LocalStorage.STORAGE_AVAILABLE_KEY_","LOCAL_STORAGE","fireauth.storage.NullStorage","NULL_STORAGE","fireauth.storage.SessionStorage","fireauth.storage.SessionStorage.isAvailable","fireauth.storage.SessionStorage.getGlobalStorage","fireauth.storage.SessionStorage.STORAGE_AVAILABLE_KEY_","SESSION_STORAGE","fireauth.storage.Factory","envMap","fireauth.storage.Factory.EnvConfig.BROWSER","fireauth.storage.Factory.EnvConfig.NODE","fireauth.storage.Factory.EnvConfig.REACT_NATIVE","fireauth.messagechannel.Receiver.prototype.handleEvent_","eventType","handlers","allResponses","fireauth.messagechannel.WorkerClientPostMessager.prototype.postMessage","fireauth.messagechannel.Sender.prototype.close","fireauth.storage.IndexedDB.prototype.set","isLocked","dbTemp","notifySW_","fireauth.storage.IndexedDB.prototype","fireauth.storage.IndexedDB.prototype.get","fireauth.storage.IndexedDB.prototype.remove","fireauth.storage.IndexedDB.prototype.addStorageListener","fireauth.storage.IndexedDB.prototype.startListeners_","stopListeners_","pollTimerId_","poll_","fireauth.storage.IndexedDB.POLLING_DELAY_","startListeners_","removeStorageListener","fireauth.storage.IndexedDB.prototype.removeStorageListener","fireauth.storage.HybridIndexedDB.prototype.get","fireauth.storage.HybridIndexedDB.prototype.set","fireauth.storage.HybridIndexedDB.prototype","fireauth.storage.HybridIndexedDB.prototype.remove","fireauth.storage.HybridIndexedDB.prototype.addStorageListener","fireauth.storage.HybridIndexedDB.prototype.removeStorageListener","fireauth.storage.InMemoryStorage.prototype.get","fireauth.storage.InMemoryStorage.prototype","fireauth.storage.InMemoryStorage.prototype.set","fireauth.storage.InMemoryStorage.prototype.remove","fireauth.storage.InMemoryStorage.prototype.addStorageListener","fireauth.storage.InMemoryStorage.prototype.removeStorageListener","fireauth.storage.LocalStorage.prototype.get","fireauth.storage.LocalStorage.prototype","fireauth.storage.LocalStorage.prototype.set","fireauth.storage.LocalStorage.prototype.remove","addStorageListener","fireauth.storage.LocalStorage.prototype.addStorageListener","fireauth.storage.LocalStorage.prototype.removeStorageListener","fireauth.storage.NullStorage.prototype.get","fireauth.storage.NullStorage.prototype","fireauth.storage.NullStorage.prototype.set","fireauth.storage.NullStorage.prototype.remove","fireauth.storage.NullStorage.prototype.addStorageListener","fireauth.storage.NullStorage.prototype.removeStorageListener","fireauth.storage.SessionStorage.prototype.get","fireauth.storage.SessionStorage.prototype","fireauth.storage.SessionStorage.prototype.set","fireauth.storage.SessionStorage.prototype.remove","fireauth.storage.SessionStorage.prototype.addStorageListener","fireauth.storage.SessionStorage.prototype.removeStorageListener","persistent","temporary","LOCAL","NONE","SESSION","fireauth.authStorage.Manager","safariLocalStorageNotSynced","runsInBackground","webStorageSupported","fireauth.storage.Factory.instance_","storageFactory","env_","fireauth.authStorage.Manager.getInstance","fireauth.authStorage.Manager.instance_","fireauth.authStorage.Manager.prototype.getStorage_","fireauth.authStorage.Manager.prototype.getKeyName_","dataKey","opt_id","fireauth.authStorage.SEPARATOR_","fireauth.authStorage.Manager.prototype.remove","getStorage_","fireauth.authStorage.Manager.prototype.stopManualListeners_","clearInterval","fireauth.storage.AuthEventManager","appId","fireauth.authStorage.Manager.prototype.get","fireauth.authStorage.Manager.prototype","fireauth.authStorage.Manager.prototype.set","fireauth.authStorage.Manager.prototype.addListener","fireauth.authStorage.Manager.prototype.startManualListeners_","stopManualListeners_","setInterval","currentValue","oldValue","newValue","poll","fireauth.authStorage.Manager.LOCAL_STORAGE_POLLING_TIMER_","startManualListeners_","removeListener","fireauth.authStorage.Manager.prototype.removeListener","fireauth.authStorage.Manager.prototype.storageChangeEvent_","storedValue","realValue","triggerListeners","fireauth.authStorage.IE10_LOCAL_STORAGE_SYNC_DELAY","fireauth.authStorage.Manager.prototype.callListeners_","fireauth.storage.OAuthHandlerManager","goog.crypt.Sha2","goog.crypt.Sha2.BLOCKSIZE_","numHashBlocks","initHashBlocks","Int32Array","goog.crypt.Sha2.Kx_","goog.crypt.Hash","chunk","rounds","w_15","w_2","partialSum1","partialSum2","t2","t1","goog.crypt.Sha2.prototype.update","opt_length","inChunk","computeChunk_","goog.crypt.Sha2.prototype.reset","goog.crypt.Sha256","goog.crypt.Sha2.call","fireauth.CordovaHandler","fireauth.util.STORAGE_KEY_SEPARATOR_","fireauth.CordovaHandler.getError_","fireauth.CordovaHandler.prototype.computeSecureHash_","sha256","chunk_","hash_","goog.crypt.byteArrayToHex","goog.array.map","hexByte","numByte","fireauth.CordovaHandler.prototype.dispatchEvent_","fireauth.CordovaHandler.prototype.getInitialAuthEvent_","addAuthEventListener","authEventCallback","removeAuthEventListener","fireauth.CordovaHandler.prototype.setAuthEventListener_","universalLinkCb","initialResolve","noEventTimer","getPartialStoredEvent_","noEvent","eventData","callbackUrl","errorObject","type_","sessionId_","dispatchEvent_","fireauth.CordovaHandler.INITIAL_TIMEOUT_MS_","existingHandlerOpenURL","fireauth.UniversalLinkSubscriber.instance_","fireauth.UniversalLinkSubscriber.prototype.subscribe","this.masterCb_","cb_","setAuthEventListener_","fireauth.CordovaHandler.prototype.getPartialStoredEvent_","fireauth.storage.AuthEventManager.prototype.getAuthEvent","getAuthEvent","getAndDeletePartialEventManager_","fireauth.storage.PendingRedirectManager","initializeAndWait","fireauth.CordovaHandler.prototype.initializeAndWait","timeoutId","fireauth.util.CORDOVA_ONDEVICEREADY_TIMEOUT_MS_","fireauth.CordovaHandler.prototype","fireauth.CordovaHandler.prototype.startPopupTimeout","fireauth.CordovaHandler.prototype.processPopup","fireauth.CordovaHandler.prototype.unloadsOnRedirect","fireauth.CordovaHandler.prototype.shouldBeInitializedEarly","fireauth.CordovaHandler.prototype.hasVolatileStorage","fireauth_CordovaHandler_prototype$processRedirect","fireauth.CordovaHandler.prototype.processRedirect","onClose","onResume","onVisibilityChange","getInitialAuthEvent_","sessionId","fireauth.CordovaHandler.prototype.generateSessionId_","numOfChars","fireauth.CordovaHandler.SESSION_ID_TOTAL_CHARS_","chars","allowedChars","generateSessionId_","appIdentifier","appDisplayName","additionalParams","hashedSessionId","computeSecureHash_","oauthHelperWidgetUrl","storageKey_","manager_","isAvailable","openUrl","inAppBrowserRef_","processRedirectInternal_","closeBrowsertab","fireauth.CordovaHandler.REDIRECT_TIMEOUT_MS_","cleanup","fireauth.CordovaHandler.prototype.addAuthEventListener","fireauth.CordovaHandler.prototype.removeAuthEventListener","fireauth.storage.PendingRedirectManager.prototype.removePendingStatus","fireauth.AuthEventManager","fireauth.RedirectAuthEventProcessor","fireauth.PopupAuthEventProcessor","fireauth.AuthEventManager.instantiateOAuthSignInHandler","fireauth.constants.clientEndpoint","fireauth.AuthEventManager.prototype.initialize","previousOauthSignInHandler","fireauth.AuthEventManager.prototype.initializeWithNoPendingRedirectResult_","notSupportedEvent","fireauth.AuthEventManager.isCordovaFalsePositive_","handleAuthEvent_","defaultToEmptyResponse","fireauth.AuthEventManager.prototype.subscribe","fireauth.storage.PendingRedirectManager.prototype.getPendingStatus","fireauth.storage.PendingRedirectManager.PENDING_FLAG_","getPendingStatus","removePendingStatus","initializeWithNoPendingRedirectResult_","fireauth.AuthEventManager.prototype.unsubscribe","fireauth.AuthEventManager.prototype.reset","fireauth.AuthEventManager.prototype.handleAuthEvent_","fireauth.AuthEventManager.EVENT_DUPLICATION_CACHE_DURATION","lastProcessedEventTime_","processedEvents_","getUid","processed","potentialHandler","eventManager","fireauth.AuthEventManager.REDIRECT_TIMEOUT_MS_","initialized_","fireauth.AuthEventManager.prototype.processRedirect","fireauth.storage.PendingRedirectManager.prototype.setPendingStatus","setPendingStatus","oauthSignInHandler_","fireauth.AuthEventManager.prototype.startPopupTimeout","owner","fireauth.AuthEventManager.POPUP_TIMEOUT_MS_.get","fireauth.AuthEventManager.prototype.getRedirectResult","fireauth.AuthEventManager.KEY_SEPARATOR_","fireauth.AuthEventManager.manager_","fireauth.RedirectAuthEventProcessor.prototype.defaultToEmptyResponse","fireauth.RedirectAuthEventProcessor.prototype.clearRedirectResult","setRedirectResult_","fireauth.RedirectAuthEventProcessor.prototype.setRedirectResolve_","this.redirectedUserPromise_","fireauth.RedirectAuthEventProcessor.prototype.setRedirectResult_","isRedirect","fireauth.RedirectAuthEventProcessor.prototype.setRedirectReject_","setRedirectReject_","setRedirectResolve_","fireauth.AuthSettings","getAppVerificationDisabledForTesting","setAppVerificationDisabledForTesting","appVerificationDisabledForTesting_","fireauth.ConfirmationResult","credentialResolver","fireauth.ConfirmationResult.initialize","phoneAuthProvider","verifyPhoneNumber","fireauth.IdTokenResult","fireauth.ProactiveRefresh","retryPolicy","getWaitDuration","fireauth.StsTokenManager","fireauth.StsTokenManager.prototype.parseServerResponse","refreshToken","fireauth.StsTokenManager.calcOffsetTimestamp_","setAccessToken","accessToken_","expirationTime_","setRefreshToken","refreshToken_","fireauth.StsTokenManager.prototype.requestToken_","secureTokenTimeout_","requestStsToken","fireauth.UserMetadata","opt_createdAt","opt_lastLoginAt","fireauth.AuthUserInfo","opt_displayName","opt_photoURL","opt_email","opt_phoneNumber","fireauth.UserEvent","opt_properties","appOptions","clientFullVersion","setLastAccessToken_","stsTokenResponse","parseServerResponse","setAccountInfo","opt_accountInfo","fireauth.AuthEventManager.getManager","fireauth.AuthUser.prototype.initializeProactiveRefreshUtility_","getIdToken","waitInterval","stsTokenManager_","OFFSET_DURATION","initializeProactiveRefreshUtility_","this.onLanguageCodeChanged_","this.onFrameworkChanged_","fireauth.AuthUser.prototype.setLanguageCodeChangeDispatcher","LANGUAGE_CODE_CHANGED","dispatcher","fireauth.AuthUser.prototype.setFramework","framework","updateClientVersion","fireauth.AuthUser.prototype.setFrameworkChangeDispatcher","FRAMEWORK_CHANGED","fireauth.AuthUser.prototype.startProactiveRefresh","pending_","TOKEN_CHANGED","fireauth.AuthUser.prototype.stopProactiveRefresh","fireauth.AuthUser.prototype.setLastAccessToken_","lastAccessToken","fireauth.AuthUser.prototype.notifyStateChangeListeners_","fireauth.AuthUser.prototype.enablePopupRedirect","fireauth.AuthUser.prototype.setAccountInfo","accountInfo","fireauth.AuthUser.returnNothing_","fireauth.AuthUser.prototype.checkDestroyed_","fireauth.AuthUser.prototype.getProviderIds","fireauth.AuthUser.prototype.addProviderData","providerData","removeProviderData","fireauth.AuthUser.prototype.removeProviderData","fireauth.AuthUser.prototype.updateProperty","fireauth.AuthUser.prototype.copy","userToCopy","fireauth.UserMetadata.prototype.clone","addProviderData","fireauth.StsTokenManager.prototype.copy","tokenManagerToCopy","isAnonymous","fireauth.AuthUser.prototype.setUserAccountInfoFromToken_","setUserAccountInfoFromToken_","updateProperty","notifyAuthListeners_","fireauth.AuthUser.prototype.checkIfAlreadyLinked_","reloadWithoutSaving_","getProviderIds","notifyStateChangeListeners_","additionalUserInfo","fireauth.AuthUser.prototype.finalizeLinking_","updateTokensIfPresent_","settings","generateEventId_","getAuthEventManager","processPopup","popupEventId_","pendingPopupResolvePromise_","pendingPopupRejectPromise_","popupTimeoutPromise_","startPopupTimeout","registerPendingPromise_","errorThrown","additionalCheck","redirectEventId_","processRedirect","removeRedirectUser","fireauth.AuthUser.prototype.getAuthEventManager","authEventManager_","popupRedirectEnabled_","fireauth.AuthUser.prototype.registerPendingPromise_","processedP","fireauth.AuthUser.prototype.checkIfInvalidated_","userInvalidatedError_","USER_INVALIDATED","checkIfInvalidated_","user","stsTokenManagerResponse","firebaseUser","fireauth.storage.RedirectUserManager","fireauth.RedirectAuthEventProcessor.prototype.reset","fireauth.RedirectAuthEventProcessor.prototype.processAuthEvent","isWebStorageNotSupported","isOperationNotSupported","processErrorEvent_","fireauth.RedirectAuthEventProcessor.prototype.processSuccessEvent_","requestUri","urlResponse_","postBody_","processSuccessEvent_","processUnknownEvent_","fireauth.RedirectAuthEventProcessor.prototype.getRedirectResult","fireauth.RedirectAuthEventProcessor.prototype.startRedirectTimeout_","fireauth.AuthEventManager.REDIRECT_TIMEOUT_MS_.get","redirectResultResolved_","fireauth.PopupAuthEventProcessor.prototype.processAuthEvent","resolvePendingPopupEvent","fireauth.ConfirmationResult.prototype.confirm","fireauth.ProactiveRefresh.prototype.start","fireauth.ProactiveRefresh.prototype.process_","fireauth.ProactiveRefresh.prototype.getNextRun_","currentErrorWaitInterval","getNextRun_","fireauth.util.onAppVisible","process_","retryPolicy_","fireauth.ProactiveRefresh.prototype.stop","fireauth.StsTokenManager.prototype.toPlainObject","fireauth.StsTokenManager.prototype.getToken","forceRefresh","opt_forceRefresh","fireauth.StsTokenManager.TOKEN_REFRESH_BUFFER_","requestToken_","fireauth.UserMetadata.prototype.toPlainObject","fireauth.AuthUser","fireauth.AuthUser.prototype.setLanguageCode","updateCustomLocaleHeader","fireauth.AuthUser.prototype.getLanguageCode","fireauth.AuthUser.prototype.getFramework","fireauth.AuthUser.prototype.handleUserTokenChange_","FIREBASE","fireauth.AuthUser.prototype.reload","fireauth.AuthUser.prototype","fireauth.AuthUser.prototype.getIdTokenResult","fireauth.AuthUser.prototype.getIdToken","fireauth.AuthUser.prototype.parseAccountInfo_","users","linkedAccounts","providerInfo","extractLinkedAccounts_","fireauth.AuthUser.prototype.reauthenticateAndRetrieveDataWithCredential","REAUTH_WITH_CREDENTIAL","reauthenticateWithCredential","fireauth.AuthUser.prototype.reauthenticateWithCredential","userCredential","getUserCredential_","REAUTHENTICATE","fireauth.AuthUser.prototype.linkAndRetrieveDataWithCredential","LINK_WITH_CREDENTIAL","linkWithCredential","fireauth.AuthUser.prototype.linkWithCredential","checkIfAlreadyLinked_","LINK","finalizeLinking_","fireauth.AuthUser.prototype.linkWithPhoneNumber","getAuth_","fireauth.AuthUser.prototype.reauthenticateWithPhoneNumber","fireauth.AuthUser.prototype.updateEmail","fireauth.AuthUser.prototype.updatePhoneNumber","phoneCredential","updatePassword","fireauth.AuthUser.prototype.updatePassword","fireauth.AuthUser.prototype.updateProfile","profileRequest","unlink","fireauth.AuthUser.prototype.unlink","deleteLinkedAccounts","remainingProviderIds","fireauth.AuthUser.prototype.delete","pendingPromises_","setLanguageCodeChangeDispatcher","setFrameworkChangeDispatcher","destroyed_","stopProactiveRefresh","unsubscribe","canHandleAuthEvent","fireauth.AuthUser.prototype.canHandleAuthEvent","LINK_VIA_POPUP","REAUTH_VIA_POPUP","LINK_VIA_REDIRECT","REAUTH_VIA_REDIRECT","fireauth.AuthUser.prototype.resolvePendingPopupEvent","popupRedirectResult","getAuthEventHandlerFinisher","fireauth.AuthUser.prototype.getAuthEventHandlerFinisher","fireauth.AuthUser.prototype.linkWithPopup","runOperationWithPopup_","fireauth.AuthUser.prototype.reauthenticateWithPopup","fireauth.AuthUser.prototype.linkWithRedirect","runOperationWithRedirect_","fireauth.AuthUser.prototype.reauthenticateWithRedirect","fireauth.AuthUser.prototype.finishPopupAndRedirectLink","finishPopupAndRedirectReauth","fireauth.AuthUser.prototype.finishPopupAndRedirectReauth","sendEmailVerification","fireauth.AuthUser.prototype.sendEmailVerification","latestIdToken","buildRequest","fireauth.AuthUser.prototype.toJSON","toPlainObject","fireauth.AuthUser.prototype.toPlainObject","fireauth.object.makeWritableCopy","fireauth.storage.RedirectUserManager.prototype.removeRedirectUser","fireauth.storage.UserManager","fireauth.storage.UserManager.prototype.initialize_","localKey","fireauth.storage.UserManager.getAuthUserKey_","sessionKey","inMemoryKey","fireauth.authStorage.Manager.prototype.migrateFromLocalStorage","oldStorageValue","migrateFromLocalStorage","persistence","currentAuthUserKey_","currentKey","removeAllExcept_","fireauth.storage.UserManager.prototype.removeAllExcept_","fireauth.authStorage.Persistence","goog.Promise.all","toFulfill","onFulfill","onReject","fireauth.storage.UserManager.prototype.switchToLocalOnExternalEvent_","waitForReady_","fireauth.storage.UserManager.AUTH_USER_KEY_NAME_","fireauth.storage.UserManager.prototype.setCurrentUser","currentUser","fireauth.storage.UserManager.prototype.removeCurrentUser","fireauth.storage.UserManager.prototype.getCurrentUser","fireauth.AuthUser.fromPlainObject","fireauth.storage.UserManager.prototype.waitForReady_","fireauth.Auth","app_","setCurrentUser_","getStorageKey","fireauth.Auth.prototype.initAuthState_","fireauth.storage.RedirectUserManager.prototype.getRedirectUser","getRedirectUser","redirectUser_","redirectStorageManager_","redirectUserStorageManager_","initRedirectUser_","getCurrentUser","setCurrentUser","removeCurrentUser","initAuthState_","fireauth.Auth.prototype.initAuthRedirectState_","getRedirectResultWithoutClearing_","isStateResolved_","userStorageManager_","initAuthRedirectState_","fireauth.Auth.prototype.initAuthEventManager_","currentUser_","enablePopupRedirect","setLanguageCode","setFramework","initAuthEventManager_","fireauth.Auth.prototype.initializeReadableWritableProps_","initializeReadableWritableProps_","fireauth.Auth.LanguageCodeChangeEvent","fireauth.Auth.prototype.getAuthEventManager_","getAuthEventManager_","fireauth.AuthUser.initializeFromIdTokenResponse","opt_redirectStorageManager","handleUserStateChange_","fireauth.Auth.prototype.setCurrentUser_","attachEventListeners_","fireauth.AuthUser.prototype.removeStateChangeListener","removeStateChangeListener","stateChangeListeners_","userStateChangeListener_","startProactiveRefresh","setUserLanguage_","setUserFramework_","idTokenPromise","signInWithIdTokenResponse","SIGN_IN","fireauth.Auth.prototype.app_","fireauth.Auth.prototype.currentUser_","fireauth.Auth.prototype.getLastAccessToken_","fireauth.Auth.prototype.notifyAuthListeners_","getLastAccessToken_","fireauth.Auth.prototype.registerPendingPromise_","fireauth.grecaptcha","fireauth.GRecaptchaMockFactory","fireauth.storage.UserManager.prototype.setPersistence","fireauth.authStorage.validatePersistenceArgument","invalidTypeError","unsupportedTypeError","fireauth.Auth.prototype.setPersistence","fireauth.Auth.prototype","fireauth.Auth.prototype.setLanguageCode","notifyLanguageCodeListeners_","fireauth.Auth.prototype.getLanguageCode","fireauth.Auth.prototype.useDeviceLanguage","fireauth.Auth.prototype.logFramework","getFramework","fireauth.Auth.prototype.getFramework","fireauth.Auth.prototype.setTenantId","fireauth.Auth.prototype.getTenantId","fireauth.Auth.prototype.toJSON","fireauth.Auth.prototype.canHandleAuthEvent","fireauth.Auth.prototype.resolvePendingPopupEvent","fireauth.Auth.prototype.getAuthEventHandlerFinisher","finishPopupAndRedirectSignIn","fireauth.Auth.prototype.finishPopupAndRedirectSignIn","signInWithPopup","fireauth.Auth.prototype.signInWithPopup","fireauth.Auth.prototype.signInWithRedirect","fireauth.storage.UserManager.prototype.savePersistenceForRedirect","savePersistenceForRedirect","fireauth.Auth.prototype.getRedirectResult","updateCurrentUser","fireauth.Auth.prototype.updateCurrentUser","newUser","fireauth.AuthUser.copyUser","getRefreshToken","getExpirationTime","fireauth.Auth.prototype.signOut","fireauth.Auth.prototype.syncAuthUserChanges_","deleted_","thisId","thatId","fireauth.Auth.prototype.handleUserStateChange_","fireauth.Auth.prototype.handleUserTokenChange_","fireauth.Auth.prototype.handleUserDelete_","fireauth.Auth.prototype.handleUserInvalidated_","fireauth.Auth.prototype.initIdTokenChangeObserver_","fireauth.Auth.prototype.initUserStateObserver_","fireauth.Auth.prototype.addUserChangeListener_","userStateChangeUid_","addUserChangeListener_","fireauth.Auth.prototype.onIdTokenChanged","onAuthStateChanged","fireauth.Auth.prototype.onAuthStateChanged","fireauth.Auth.prototype.getIdTokenInternal","fireauth.Auth.prototype.signInWithCustomToken","signInWithIdTokenProvider_","signInWithEmailAndPassword","fireauth.Auth.prototype.signInWithEmailAndPassword","fireauth.Auth.prototype.createUserWithEmailAndPassword","fireauth.Auth.prototype.signInWithCredential","fireauth.Auth.prototype.signInAndRetrieveDataWithCredential","SIGN_IN_WITH_CREDENTIAL","signInAnonymously","fireauth.Auth.prototype.signInAnonymously","fireauth.Auth.prototype.getUid","fireauth.Auth.prototype.addAuthTokenListenerInternal","fireauth.Auth.prototype.removeAuthTokenListenerInternal","addAuthTokenListener","fireauth.Auth.prototype.addAuthTokenListener","fireauth.Auth.prototype.removeAuthTokenListener","fireauth.Auth.prototype.delete","fireauth.Auth.prototype.fetchSignInMethodsForEmail","fireauth.RpcHandler.prototype.fetchSignInMethodsForIdentifier","fetchSignInMethodsForIdentifier","rpcHandler_","fireauth.Auth.prototype.isSignInWithEmailLink","sendSignInLinkToEmail","fireauth.Auth.prototype.sendSignInLinkToEmail","actionCodeSettingsBuilder","fireauth.Auth.prototype.verifyPasswordResetCode","fireauth.Auth.prototype.confirmPasswordReset","getRpcHandler","fireauth.Auth.prototype.checkActionCode","applyActionCode","fireauth.Auth.prototype.applyActionCode","fireauth.Auth.prototype.sendPasswordResetEmail","fireauth.Auth.prototype.signInWithPhoneNumber","signInWithEmailLink","fireauth.Auth.prototype.signInWithEmailLink","opt_link","fireauth.grecaptcha.prototype.render","fireauth.grecaptcha.prototype.reset","fireauth.grecaptcha.prototype.getResponse","fireauth.grecaptcha.prototype.execute","fireauth.GRecaptchaMockFactory.prototype.getMock_","getId_","fireauth.GRecaptchaMockFactory.prototype.getId_","fireauth.GRecaptchaMockFactory.START_INSTANCE_ID","fireauth.RecaptchaMock","this.onClickHandler_","CLICK","fireauth.RecaptchaMock.prototype.checkIfDeleted_","fireauth.RecaptchaMockLoader","fireauth.GRecaptchaMockFactory.prototype.render","fireauth.GRecaptchaMockFactory.prototype.reset","mock","getMock_","fireauth.GRecaptchaMockFactory.prototype.getResponse","fireauth.GRecaptchaMockFactory.prototype.execute","fireauth.RecaptchaMock.prototype.getResponse","checkIfDeleted_","fireauth.RecaptchaMock.prototype.execute","fireauth.util.generateRandomAlphaNumericString","expirationCallback","fireauth.GRecaptchaMockFactory.EXPIRATION_TIME_MS","fireauth.GRecaptchaMockFactory.SOLVE_TIME_MS","fireauth.RecaptchaMock.prototype.delete","fireauth.RecaptchaMockLoader.prototype.loadRecaptchaDeps","fireauth.GRecaptchaMockFactory.instance_","fireauth.RecaptchaMockLoader.prototype.clearSingleRecaptcha","fireauth.RecaptchaRealLoader","fireauth.RecaptchaRealLoader.DEFAULT_DEPENDENCY_TIMEOUT_","fireauth.RecaptchaRealLoader.prototype.loadRecaptchaDeps","timer","fireauth.RecaptchaRealLoader.DEFAULT_DEPENDENCY_TIMEOUT_.get","hl","widgetId","fireauth.RecaptchaRealLoader.prototype.clearSingleRecaptcha","fireauth.BaseRecaptchaVerifier","opt_isTestingMode","fireauth.RecaptchaMockLoader.instance_","fireauth.RecaptchaRealLoader.instance_","opt_parameters","opt_rpcHandlerConfig","opt_getLanguageCode","existingCallback","existingExpiredCallback","CALLBACK","EXPIRED_CALLBACK","SITEKEY","SIZE","fireauth.BaseRecaptchaVerifier.prototype.dispatchEvent_","fireauth.BaseRecaptchaVerifier.prototype.registerPendingPromise_","isTestingMode","opt_app","getLanguageCode","fireauth.args.validate","actualAsArray","numRequiredArgs","isOptionalSection","expected","maxNumArgs","actual","minNumArgs","numExpectedString","optionalUndefined","fireauth.args.ORDINAL_NUMBERS_.length","fireauth.args.ORDINAL_NUMBERS_","opt_isSetter","ordinal","expectedType","apiName","isReady_","fireauth.BaseRecaptchaVerifier.prototype.isReady_","grecaptcha","fireauth.BaseRecaptchaVerifier.prototype.render","checkIfDestroyed_","outerContainer","goog.dom.createDom","fireauth.BaseRecaptchaVerifier.prototype","fireauth.BaseRecaptchaVerifier.prototype.verify","recaptchaToken","tokenListeners_","fireauth.BaseRecaptchaVerifier.prototype.removeTokenChangeListener_","removeTokenChangeListener_","fireauth.BaseRecaptchaVerifier.prototype.reset","fireauth.BaseRecaptchaVerifier.prototype.clear","isInvisible_","fireauth.args.string","typeLabel","validator","fireauth.args.bool","fireauth.args.object","fireauth.args.func","fireauth.args.null","fireauth.args.authCredential","opt_requiredProviderId","matchesRequiredProvider","getIdTokenProvider","fireauth.args.applicationVerifier","fireauth.args.or","optionA","optionB","fireauth.exportlib.exportPrototypeMethods","obfuscatedFnName","unobfuscatedFnName","fnMap","protObj","fireauth.exportlib.wrapMethodWithArgumentVerifier_","fireauth.exportlib.exportPrototypeProperties","obfuscatedPropName","unobfuscatedPropName","propMap","getter","setter","fireauth.exportlib.exportFunction","parentObj","wrapper","argumentsAsArray","shortName","fireauth.exportlib.extractMethodNameFromFullPath_","checkActionCode","confirmPasswordReset","createUserWithEmailAndPassword","fetchSignInMethodsForEmail","getRedirectResult","isSignInWithEmailLink","onIdTokenChanged","sendPasswordResetEmail","setPersistence","signInAndRetrieveDataWithCredential","signInWithCredential","signInWithCustomToken","signInWithPhoneNumber","signInWithRedirect","signOut","toJSON","useDeviceLanguage","verifyPasswordResetCode","getIdTokenResult","linkAndRetrieveDataWithCredential","linkWithPhoneNumber","linkWithPopup","linkWithRedirect","reauthenticateAndRetrieveDataWithCredential","reauthenticateWithPhoneNumber","reauthenticateWithPopup","reauthenticateWithRedirect","reload","updateEmail","updatePhoneNumber","execute","getResponse","thenAlways","confirm","fireauth.AuthProvider.getCredentialFromJSON","fromJSON","fireauth.EmailAuthProvider.credential","addScope","setCustomParameters","fireauth.RecaptchaVerifier","verify","auth","authComponent","fireauth.exportlib.AUTH_TYPE","authInteropComponent","AUTH_NPM_PACKAGE_VERSION","__WEBPACK_EXTERNAL_MODULE_6__","modules","installedModules","__webpack_require__","moduleId","loaded","_validators","_app2","_push3","_fetch3","_post3","_sync3","_bind3","_update3","_reset3","_removeBinding3","_remove3","_fsSync3","_fsRemoveBinding3","_fsBind3","_fsGet3","_fsRemoveDoc3","_fsAddToCollection3","_fsRemoveFromCollection3","_fsUpdateDoc3","_fsReset3","createClass","_validateDatabase","syncs","WeakMap","rebase","initializedApp","timestamp","database","ServerValue","TIMESTAMP","listenTo","bindToState","syncState","fetch","post","removeBinding","binding","firestore","FieldValue","serverTimestamp","bindDoc","bindCollection","syncDoc","listenToDoc","listenToCollection","addToCollection","updateDoc","removeDoc","removeFromCollection","_fsCreateRef","_fsSetUnmountHandler","_setData","_handleError","_createNestedObject","_setUnmountHandler","_addFirestoreListener","_addListener","_fsUpdateSyncState","_updateSyncState","_firebaseRefsMixin","_addSync","_hasOwnNestedProperty","_getSegmentCount","_getNestedObject","_isNestedPath","_isObject","_isValid","_toArray","_fsPrepareData","_prepareData","_throwError","_setState","_returnRef","_addFirestoreQuery","_addQueries","_createHash","childSnapshot","lastKey","root","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","asArray","newState","queries","needArgs","limitToFirst","limitToLast","orderByChild","startAt","endAt","equalTo","onFailure","handleError","keepKeys","acc","curr","isCollection","exists","withRefs","withIds","collection","empty","invoker","hash","sync","existingSyncs","boundOnFailure","on","reactSetState","onSnapshot","_newState2","_newState3","currentState","_newState4","_newState5","pathOrRef","_ref2","off","currentSyncs","findIndex","splice","_validateCollectionPath","_validateDocumentPath","_validateEndpoint","optionValidators","_utils","notObject","makeError","validQueries","errorMsg","defaultError","once","_sync","updateFirebase","stateKey","syncsToCall","syncedKeys","nested","syncedKey","datum","find","_fsSync","batch","domStorage_","prefix_","removeItem","prefixedName_","setItem","storedVal","getItem","cache_","isInMemoryStorage","createStoragefor","domStorageName","domStorage","DOMStorageWrapper","MemoryStorage","PersistentStorage","SessionStorage","logClient","LUIDGenerator","sha1","Sha1","sha1Bytes","buildLogMessage_","var_args","firstLog_","enableLogging","logWrapper","fatal","isInvalidJSONNumber","POSITIVE_INFINITY","NEGATIVE_INFINITY","MIN_NAME","MAX_NAME","nameCompare","aAsInt","tryParseInt","bAsInt","stringCompare","requireKey","ObjectToUniqueKey","sort","splitStringBySize","segsize","len","dataSegs","each","doubleToIEEE754String","ln","bits","Infinity","abs","pow","LN2","round","hexByteString","INTEGER_REGEXP_","intVal","exceptionGuard","beingCrawled","setTimeoutNonBlocking","pathOrString","pieceNum","pieces_","copyTo","pieceNum_","Path","getFront","getLength","popFront","getBack","pathString","toUrlEncodedString","begin","childPathObj","childPieces","isEmpty","relativePath","outerPath","innerPath","outer","inner","comparePaths","right","leftKeys","rightKeys","cmp","equals","other","errorPrefix_","parts_","byteLength_","max","stringLength","checkValid_","ValidationPath","MAX_PATH_LENGTH_BYTES","MAX_PATH_DEPTH","toErrorString","LONG_POLLING","host","secure","webSocketOnly","persistenceKey","includeNamespaceInQueryParams","internalHost","needsQueryParam","isCustomHost","isCacheableHost","isDemoHost","updateHost","newHost","connectionURL","connURL","toURLString","__EMPTY_NODE","MAX_NODE","parseRepoInfo","dataURL","parsedUrl","parseDatabaseURL","repoInfo","RepoInfo","subdomain","colonInd","slashInd","questionMarkInd","pathStringDecoded","piece","decodePath","queryParams","queryString","kv","decodeQuery","INVALID_KEY_REGEX_","INVALID_PATH_REGEX_","isValidKey","isValidPathString","isValidPriority","priority","validateFirebaseDataArg","validateFirebaseData","errorPrefixFxn","validateFirebaseMergeDataArg","mergePaths","curPath","prevPath","validateFirebaseMergePaths","validatePriority","validateEventType","validateKey","validatePathString","validateRootPathString","validateWritablePath","validateUrl","isValidRootPathString","validateBoolean","repo_","onComplete","validateArgCount","validateCallback","onDisconnectCancel","onDisconnectSet","setWithPriority","onDisconnectSetWithPriority","objectToMerge","newObjectToMerge","onDisconnectUpdate","committed","nextPushId","PUSH_CHARS","lastPushTime","lastRandChars","duplicateTime","timeStampChars","Wrap","NamedNode","getCompare","indexedValueChanged","oldNode","newNode","oldWrapped","newWrapped","minPost","MIN","isDefinedOn","maxPost","makePost","indexValue","Index","KEY_INDEX","KeyIndex","__childrenNodeConstructor","nodeFromJSON","priorityHashText","validatePriorityNode","priorityNode","isLeafNode","getPriority","value_","priorityNode_","LeafNode","EMPTY_NODE","lazyHash_","updatePriority","newPriorityNode","getImmediateChild","childName","getChild","hasChild","getPredecessorChildName","childNode","updateImmediateChild","newChildNode","updateChild","front","numChildren","forEachChild","action","exportFormat","toHash","compareTo","compareToLeafNode_","otherLeaf","otherLeafType","thisLeafType","otherIndex","VALUE_TYPE_ORDER","thisIndex","withIndex","isIndexed","_defaultIndexMap","PRIORITY_INDEX","aPriority","bPriority","indexCmp","startKey","comparator","isReverse_","resultGenerator_","nodeStack_","getNext","peek","LLRBNode","RED","SortedMap","inorderTraversal","reverseTraversal","min_","minKey","maxKey","insert","fixUp_","removeMin_","isRed_","moveRedLeft_","smallest","rotateRight_","moveRedRight_","rotateLeft_","colorFlip_","nl","nr","checkMaxDepth_","blackDepth","BLACK","comparator_","root_","getPredecessorKey","rightParent","getIterator","resultGenerator","SortedMapIterator","getIteratorFrom","getReverseIteratorFrom","getReverseIterator","LLRBEmptyNode","LOG_2","num","current_","mask","bits_","nextBitIsOne","buildChildSet","childList","keyFn","mapSortFn","base12","buildPennant","chunkSize","low","childTree","buildBalancedTree","namedNode","middle","attachPennant","pennant","isOne","buildFrom12Array","Base12Num","fallbackObject","indexes_","indexSet_","IndexMap","indexKey","sortedMap","safeGet","hasIndex","indexDefinition","addIndex","existingChildren","newIndex","sawIndexedValue","indexName","newIndexSet","newIndexes","addToIndexes","indexedChildren","existingSnap","newChildren","removeFromIndexes","NAME_ONLY_COMPARATOR","NAME_COMPARATOR","indexMap_","ChildrenNode","Default","newPriority","newIndexMap","newImmediateChild","numKeys","allIntegerKeys","childHash","resolveIndex_","predecessor","getFirstChildName","getFirstChild","getLastChildName","getLastChild","wrappedNode","startPost","endPost","otherChildrenNode","thisIter","otherIter","thisCurrent","otherCurrent","MAX","setPriorityMaxNode","USE_HINZE","childData","childSet","sortedChildSet","setNodeFromJSON","__referenceConstructor","OperationType","VALUE_INDEX","valueNode","indexPath_","extractChild","snap","aChild","bChild","node_","ref_","index_","exportVal","childPathString","childPath","childRef","DataSnapshot","childrenNode","hasChildren","getKey","getRef","eventRegistration","prevName","getParent","getEventType","getEventRunner","callback_","cancelCallback_","context_","respondsTo","createEvent","getQueryParams","getIndex","DataEvent","snapshotNode","ctx","createCancelEvent","CancelEvent","ValueEventRegistration","hasAnyCallback","callbacks_","eventToCheck","ChildEventRegistration","otherKeys","thisKeys","otherCount","otherKey","thisKey","every","repo","queryParams_","orderByCalled_","validateQueryEndpoints_","startNode","endNode","hasStart","getIndexStartValue","hasEnd","getIndexEndValue","tooManyArgsError","wrongArgTypeError","getIndexStartName","getIndexEndName","PathIndex","validateLimit_","hasLimit","hasAnchoredLimit","validateNoPreviousOrderByCall_","Query","cancelCallbackOrContext","getCancelAndContextArgs_","onValueEvent","callbacks","onChildEvent","cancelCallback","addEventCallbackForQuery","validateContextObject","valueCallback","removeEventCallbackForQuery","userCallback","failureCallbackOrContext","firstCall","onceCallback","limit","parsedPath","newParams","orderBy","orderByKey","orderByPriority","orderByValue","queryObject","getQueryObject","queryIdentifier","isEqual","sameRepo","samePath","sameQueryIdentifier","cancelOrContext","size","childKey","remember","SparseSnapshotTree","forget","tree","forEachTree","prefixPath","resolveDeferredValue","existing","serverValues","resolveScalarDeferredValue","resolveComplexDeferredValue","unused","delta","existingVal","resolveDeferredValueSnapshot","rawPri","leafNode","emptyChildrenSingleton","fromUser","fromServer","queryId","tagged","User","OperationSource","Server","forServerTaggedQuery","affectedTree","revert","ACK_USER_WRITE","operationForChild","subtree","AckUserWrite","Empty","EmptyChildren","fromObject","ImmutableTree","childSnap","findRootMostMatchingPathAndValue","predicate","childExistingPathAndValue","findRootMostValueAndPath","toSet","newChild","setTree","newTree","fold","fold_","pathSoFar","accum","findOnPath","findOnPath_","pathToFollow","nextChild","foreachOnPath","foreachOnPath_","currentRelativePath","foreach","foreach_","foreachChild","LISTEN_COMPLETE","ListenComplete","OVERWRITE","Overwrite","MERGE","Merge","fullyInitialized_","filtered_","isFullyInitialized","isFiltered","isCompleteForPath","isCompleteForChild","getNode","eventCache_","serverCache_","updateEventSnap","eventSnap","filtered","ViewCache","CacheNode","updateServerSnap","serverSnap","getEventCache","getCompleteEventSnap","getServerCache","getCompleteServerSnap","oldSnap","valueChange","Change","VALUE","childAddedChange","CHILD_ADDED","childRemovedChange","CHILD_REMOVED","childChangedChange","newSnapshot","oldSnapshot","CHILD_CHANGED","childMovedChange","CHILD_MOVED","affectedPath","optChangeAccumulator","oldChild","trackChildChange","updateFullNode","newSnap","filtersNodes","getIndexedFilter","changeMap","oldChange","oldType","getChanges","NO_COMPLETE_CHILD_SOURCE","getCompleteChild","getChildAfterChild","writes_","viewCache_","optCompleteServerCache_","serverNode","calcCompleteChild","completeServerData","nodes","calcIndexedSlice","viewCache","changes","filter_","assertIndexed","applyOperation","oldViewCache","writesCache","completeCache","newViewCache","filterServerNode","accumulator","ChildChangeAccumulator","overwrite","applyUserOverwrite_","applyServerOverwrite_","merge","applyUserMerge_","applyServerMerge_","ackUserWrite","revertUserWrite_","ackUserWrite_","listenComplete_","ViewProcessor","maybeAddValueEvent_","ProcessorResult","isLeafOrEmpty","oldCompleteSnap","generateEventCacheAfterServerEvent_","changePath","oldEventSnap","shadowingWrite","newEventCache","serverCache","completeChildren","completeEventChildren","calcCompleteEventChildren","completeNode","calcCompleteEventCache","oldEventNode","updatedPriority","calcEventCacheAfterServerOverwrite","childChangePath","newEventChild","eventChildUpdate","changedSnap","newServerCache","oldServerSnap","serverFilter","newServerNode","WriteTreeCompleteChildSource","newEventSnap","cacheHasChild_","changedChildren","curViewCache","writePath","applyMerge_","viewMergeTree","serverChild","childMergeTree","isUnknownDeepMerge","ackPath","mergePath","serverCachePath","oldServerNode","completeServerCache","oldEventCache","serverChildren","query_","generateEventsForChanges","eventCache","eventRegistrations","events","moves","generateEventsForType_","registrations","filteredChanges","compareChanges_","materializedChange","materializeSingleChange_","aWrapped","bWrapped","initialViewCache","eventRegistrations_","indexFilter","IndexedFilter","getNodeFilter","processor_","initialServerCache","initialEventCache","eventGenerator_","EventGenerator","getQuery","getCompleteServerCache","loadsAllData","addEventRegistration","removeEventRegistration","cancelError","cancelEvents","maybeEvent","remaining","generateEventsForChanges_","getInitialEvents","initialChanges","views","optCompleteServerCache","serverCacheComplete","eventCacheComplete","View","removed","hadCompleteView","hasCompleteView","viewQueryId","SyncPoint","getQueryViews","viewForQuery","getCompleteView","viewExistsForQuery","writeTree_","addWrite","CompoundWrite","rootmost","rootMostPath","addWrites","updates","newWrite","removeWrite","hasCompleteWrite","getCompleteNode","getCompleteChildren","childCompoundWrite","shadowingNode","applySubtreeWrite","writeTree","visibleWrites_","allWrites_","lastWriteId_","childWrites","WriteTreeRef","addOverwrite","writeId","visible","addMerge","getWrite","writeToRemove","removedWriteWasVisible","removedWriteOverlapsWithOtherWrites","currentWrite","recordContainsPath_","resetTree_","getCompleteWriteData","treePath","writeIdsToExclude","includeHiddenWrites","mergeAtPath","WriteTree","layerTree_","layeredCache","subMerge","completeServerChildren","topLevelSet","existingEventSnap","existingServerSnap","childMerge","toIterate","writeRecord","DefaultFilter_","writes","treeRoot","compoundWrite","deepNode","treePath_","existingServerCache","listenProvider_","syncPointTree_","pendingWriteTree_","tagToQueryMap","queryToTagMap","applyUserOverwrite","newData","applyOperationToSyncPoints_","applyUserMerge","changeTree","applyServerOverwrite","applyServerMerge","applyListenComplete","applyTaggedQueryOverwrite","queryKey","queryKeyForTag_","SyncTree","parseQueryKey_","queryPath","applyTaggedOperation_","applyTaggedQueryMerge","applyTaggedListenComplete","foundAncestorDefaultView","pathToSyncPoint","sp","syncPoint","childSyncPoint","viewAlreadyExists","makeQueryKey_","getNextQueryTag_","setupListener_","maybeSyncPoint","removedAndEvents","removingDefault","covered","parentSyncPoint","newViews","collectDistinctViewsForSubTree_","newQuery","createListenerForView_","startListening","queryForListening_","tagForQuery_","hashFn","stopListening","queryToRemove","tagToRemove","removeTags_","maybeChildSyncPoint","childMap","childViews","removedQuery","removedQueryKey","removedQueryTag","isDefault","queriesToStop","childQueries","queryToStop","errorForServerCode","splitIndex","nextQueryTag_","applyOperationHelper_","syncPointTree","applyOperationDescendantsHelper_","childOperation","childServerCache","childWritesCache","rootNode_","updateSnapshot","newSnapshotNode","authProvider_","auth_","getToken","addTokenChangeListener","removeTokenChangeListener","removeAuthTokenListener","notifyForInvalidToken","counters_","incrementCounter","amount","getCollection","hashString","collections_","StatsCollection","getOrCreateReporter","creatorFunction","reporters_","collection_","last_","newStats","stat","FIRST_STATS_MIN_TIME","FIRST_STATS_MAX_TIME","server_","statsToReport_","statsListener_","StatsListener","reportStats_","includeStat","stats","reportedStats","haveStatsToReport","reportStats","eventLists_","recursionDepth_","queueEvents","eventDataList","currList","eventPath","EventList","raiseEventsAtPath","raiseQueuedEventsMatchingPredicate_","raiseEventsForChangedPath","changedPath","sentAll","eventList","raise","events_","eventFn","allowedEvents_","listeners_","trigger","validateEventType_","getInitialEvent","et","visibilityChange","visible_","getInstance","VisibilityMonitor","EventEmitter","online_","isMobileCordova","OnlineMonitor","currentlyOnline","onMessage_","pendingResponses","currentResponseNum","closeAfterResponse","closeAfter","responseNum","handleResponse","requestNum","toProcess","FIREBASE_LONGPOLL_COMMAND_CB_NAME","FIREBASE_LONGPOLL_DATA_CB_NAME","connId","transportSessionId","lastSessionId","bytesSent","bytesReceived","everConnected_","log_","stats_","StatsManager","urlFn","onDisconnect","curSegmentNum","onDisconnect_","myPacketOrderer","PacketReceiver","isClosed_","connectTimeoutTimer_","onClosed_","isNodeSdk","executeWhenDOMReady","scriptTagHolder","FirebaseIFrameScriptHolder","command","arg1","arg2","incrementIncomingBytes_","sendNewPolls","pN","urlParams","uniqueCallbackIdentifier","connectURL","addTag","startLongPoll","addDisconnectPingFrame","forceAllow","BrowserPollConnection","forceAllow_","forceDisallow","forceDisallow_","Windows","UI","markConnectionHealthy","shutdown_","myDisconnFrame","dataStr","base64data","base64Encode","MAX_URL_DATA_SIZE","enqueueSegment","pw","commandCB","onMessageCB","outstandingRequests","pendingSegs","currentSerial","myIFrame","createIFrame_","iframeContents","contentWindow","alive","myID","myPW","newRequest_","theURL","curDataString","theSeg","seg","ts","addLongPollTag_","segnum","totalsegs","serial","doNewRequest","keepaliveTimeout","loadCB","doNodeLongPoll","onload","rstate","onerror","WebSocketImpl","MozWebSocket","WebSocket","keepaliveTimer","frames","totalFrames","WebSocketConnection","connectionURL_","device","ENV_CONSTANTS","platform","env","mySock","onopen","onclose","handleIncomingFrame","isOldAndroid","oldAndroidMatch","previouslyFailed","appendFrame_","fullMess","jsonMess","handleNewFrameCount_","frameCount","extractFrameCount_","mess","resetKeepAlive","remainingData","sendString_","responsesRequiredToBeHealthy","healthyTimeout","initTransports_","isWebSocketsAvailable","isSkipPollConnection","transports_","transports","TransportManager","ALL_TRANSPORTS","transport","initialTransport","upgradeTransport","repoInfo_","onReady_","onKill_","connectionCount","pendingDataMessages","state_","transportManager_","start_","conn","conn_","nextTransportId_","primaryResponsesRequired_","onMessageReceived","connReceiver_","onConnectionLost","disconnReceiver_","tx_","rx_","secondaryConn_","isHealthy_","healthyTimeout_ms","healthyTimeout_","everConnected","onConnectionLost_","onSecondaryConnectionLost_","onPrimaryMessageReceived_","onSecondaryMessageReceived_","sendRequest","dataMsg","sendData_","tryCleanupConnection","onSecondaryControl_","controlData","cmd","upgradeIfSecondaryHealthy_","secondaryResponsesRequired_","parsedData","layer","proceedWithUpgrade_","onControl_","onDataMessage_","onPrimaryResponse_","onHandshake_","onConnectionShutdown_","onReset_","sendPingOnPrimaryIfNecessary_","handshake","onConnectionEstablished_","tryStartUpgrade_","startUpgrade_","closeConnections_","refreshAuthToken","onDisconnectPut","onDisconnectMerge","RECONNECT_MIN_DELAY","RECONNECT_MAX_DELAY_DEFAULT","onDataUpdate_","onConnectStatus_","onServerInfoUpdate_","authTokenProvider_","authOverride_","PersistentConnection","nextPersistentConnectionId_","interruptReasons_","listens","outstandingPuts_","outstandingPutCount_","onDisconnectRequestQueue_","connected_","reconnectDelay_","maxReconnectDelay_","securityDebugCallback_","establishConnectionTimer_","requestCBHash_","requestNumber_","realtime_","authToken_","forceTokenRefresh_","invalidAuthTokenCount_","firstConnection_","lastConnectionAttemptTime_","lastConnectionEstablishedTime_","scheduleConnect_","onVisible_","onOnline_","onResponse","curReqNum","currentHashFn","listenSpec","sendListen_","req","warnOnListenWarnings_","removeListen_","warnings","indexSpec","indexPath","tryAuth","reduceReconnectDelayIfAdminCredential_","isAdmin","authMethod","isValidFormat","requestData","cred","onAuthRevoked_","unlisten","sendUnlisten_","queryObj","sendOnDisconnect_","putInternal","sendPut_","queued","errorReason","reqNum","onDataPush_","onListenRevoked_","onSecurityDebugPacket_","handleTimestamp_","sendConnectStats_","restoreState_","establishConnection_","online","onRealtimeDisconnect_","cancelSentTransactions_","shouldReconnect_","timeSinceLastConnectAttempt","reconnectDelay","nextConnectionId_","Connection","interrupt","serverTimeOffset","normalizedPathString","statusCode","explanation","clientName","isReactNative","ServerActions","listens_","getListenId_","listenId","ReadonlyRestClient","thisListen","queryStringParameters","toRestQueryStringParameters","restRequest_","authTokenData","authToken","forceRestClient","authProvider","dataUpdateCount","eventQueue_","EventQueue","nextWriteId_","interceptServerDataCallback_","persistentConnection_","authTokenProvider","AuthTokenProvider","authOverride","statsReporter_","StatsReporter","transactions_init_","infoData_","SnapshotHolder","infoSyncTree_","infoEvents","updateInfo_","serverSyncTree_","serverTime","generateServerValues","isMerge","taggedChildren","taggedSnap","rerunTransactions_","interceptServerData_","connectStatus","runOnDisconnectEvents_","getNextWriteId_","newVal","newNodeUnresolved","success","clearEvents","callOnCompleteCallback","abortTransactions_","childrenToMerge","changedKey","changedValue","resolvedOnDisconnectTree","syncTree","resolvedTree","resolveDeferredValueTree","showDelta","longestName","previousValue","paddedStat","statsIncrementCounter","metric","__database","Database","indexedFilter_","startPost_","RangedFilter","getStartPost_","endPost_","getEndPost_","getStartPost","getEndPost","startName","endName","rangedFilter_","limit_","getLimit","reverse_","isViewFromLeft","fullLimitUpdateChild_","foundStartPost","changeAccumulator","newChildNamedNode","windowBoundary","inRange","oldChildSnap","compareNext","limitSet_","startSet_","startNameSet_","endSet_","endNameSet_","viewFrom_","indexStartValue_","indexStartName_","indexEndValue_","indexEndName_","QueryParams","WIRE_PROTOCOL_CONSTANTS_","VIEW_FROM_LEFT","copy_","newLimit","VIEW_FROM_RIGHT","WIRE_PROTOCOL_CONSTANTS","INDEX_START_VALUE","INDEX_START_NAME","INDEX_END_VALUE","INDEX_END_NAME","LIMIT","viewFrom","VIEW_FROM","INDEX","LimitedFilter","REST_CONSTANTS","REST_QUERY_CONSTANTS_","qs","ORDER_BY","START_AT","END_AT","LIMIT_TO_FIRST","LIMIT_TO_LAST","Repo","Reference","parentPath","getRoot","databaseProp","transaction","transactionUpdate","applyLocally","promiseComplete","TransactionResult","startTransaction","setPriority","thennablePushRef","pushRef","OnDisconnect","TransactionStatus","TreeNode","subTree","pathObj","Tree","updateParents_","forEachDescendant","includeSelf","childrenFirst","forEachAncestor","forEachImmediateDescendantWithValue","updateChild_","childEmpty","childExists","MAX_TRANSACTION_RETRIES_","transactionQueueTree_","watchRef","retryCount","unwatcher","abortReason","currentWriteId","currentInputSnapshot","currentOutputSnapshotRaw","currentOutputSnapshotResolved","getLatestState_","RUN","queueNode","nodeQueue","priorityForNode","sendReadyTransactions_","excludeSets","pruneCompletedTransactionsBelowNode_","queue","buildTransactionQueue_","sendTransactionQueue_","setsToIgnore","txn","latestState","snapToSend","latestHash","SENT","dataToSend","pathToSend","COMPLETED","SENT_NEEDS_ABORT","NEEDS_ABORT","rootMostTransactionNode","getAncestorTransactionNode_","rerunTransactionQueue_","abortTransaction","currentNode","newDataNode","oldWriteId","newNodeResolved","lastInput","transactionNode","transactionQueue","aggregateTransactionQueuesForNode_","abortTransactionsOnNode_","lastSent","_staticInstance","repos_","useRestClient_","RepoManager","dbUrl","databaseFromApp","dbEmulatorHost","createRepo","deleteRepo","appRepos","DatabaseInternals","checkDeleted_","refFromURL","parsedURL","goOffline","goOnline","_increment","DataConnection","simpleListen","echo","onEcho","RealTimeConnection","ConnectionTarget","newHash","oldPut","opt_onComplete","opt_hash","registerDatabase","setSDKVersion","TEST_ACCESS","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","currentQueue","draining","queueIndex","cleanUpNextTick","drainQueue","run","marker","runClearTimeout","Item","nextTick","title","browser","argv","versions","addListener","emit","prependListener","prependOnceListener","cwd","chdir","dir","umask","isAbsolute","spliceOne","list","resolvePathname","toParts","fromParts","isToAbs","isFromAbs","mustEndAbs","hasTrailingSlash","up","part","unshift","valueEqual","addLeadingSlash","hasBasename","stripBasename","stripTrailingSlash","createPath","createLocation","currentLocation","hashIndex","searchIndex","parsePath","URIError","createTransitionManager","prompt","setPrompt","nextPrompt","confirmTransitionTo","getUserConfirmation","appendListener","isActive","notifyListeners","canUseDOM","removeEventListener","getConfirmation","supportsHistory","history","supportsPopStateOnHashChange","isExtraneousPopstateEvent","getHistoryState","createBrowserHistory","invariant","globalHistory","canUseHistory","needsHashChangeListener","_props$forceRefresh","_props$getUserConfirm","_props$keyLength","keyLength","basename","getDOMLocation","historyState","_window$location","createKey","transitionManager","handlePopState","handlePop","handleHashChange","forceNextPop","ok","revertPop","fromLocation","toLocation","toIndex","allKeys","go","initialLocation","createHref","pushState","prevIndex","nextKeys","replaceState","goBack","goForward","listenerCount","checkDOMListeners","isBlocked","block","unblock","Router","_temp","computeMatch","router","_props","React","BrowserRouter","createHistory","isEmptyChildren","Route","computedMatch","nextContext","_context$router","staticContext","Switch","_element$props","pathProp"],"mappings":"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","file":"static/js/2.d57af60d.chunk.js","sourcesContent":["'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react.production.min.js');\n} else {\n  module.exports = require('./cjs/react.development.js');\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @fileoverview Standardized Firebase Error.\n *\n * Usage:\n *\n *   // Typescript string literals for type-safe codes\n *   type Err =\n *     'unknown' |\n *     'object-not-found'\n *     ;\n *\n *   // Closure enum for type-safe error codes\n *   // at-enum {string}\n *   var Err = {\n *     UNKNOWN: 'unknown',\n *     OBJECT_NOT_FOUND: 'object-not-found',\n *   }\n *\n *   let errors: Map<Err, string> = {\n *     'generic-error': \"Unknown error\",\n *     'file-not-found': \"Could not find file: {$file}\",\n *   };\n *\n *   // Type-safe function - must pass a valid error code as param.\n *   let error = new ErrorFactory<Err>('service', 'Service', errors);\n *\n *   ...\n *   throw error.create(Err.GENERIC);\n *   ...\n *   throw error.create(Err.FILE_NOT_FOUND, {'file': fileName});\n *   ...\n *   // Service: Could not file file: foo.txt (service/file-not-found).\n *\n *   catch (e) {\n *     assert(e.message === \"Could not find file: foo.txt.\");\n *     if (e.code === 'service/file-not-found') {\n *       console.log(\"Could not read file: \" + e['file']);\n *     }\n *   }\n */\n\nexport type ErrorMap<ErrorCode extends string> = {\n  readonly [K in ErrorCode]: string;\n};\n\nconst ERROR_NAME = 'FirebaseError';\n\nexport interface StringLike {\n  toString(): string;\n}\n\nexport interface ErrorData {\n  [key: string]: StringLike | undefined;\n}\n\nexport interface FirebaseError extends Error, ErrorData {\n  // Unique code for error - format is service/error-code-string.\n  readonly code: string;\n\n  // Developer-friendly error message.\n  readonly message: string;\n\n  // Always 'FirebaseError'.\n  readonly name: typeof ERROR_NAME;\n\n  // Where available - stack backtrace in a string.\n  readonly stack?: string;\n}\n\n// Based on code from:\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\nexport class FirebaseError extends Error {\n  readonly name = ERROR_NAME;\n\n  constructor(readonly code: string, message: string) {\n    super(message);\n\n    // Fix For ES5\n    // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n    Object.setPrototypeOf(this, FirebaseError.prototype);\n\n    // Maintains proper stack trace for where our error was thrown.\n    // Only available on V8.\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, ErrorFactory.prototype.create);\n    }\n  }\n}\n\nexport class ErrorFactory<\n  ErrorCode extends string,\n  ErrorParams extends { readonly [K in ErrorCode]?: ErrorData } = {}\n> {\n  constructor(\n    private readonly service: string,\n    private readonly serviceName: string,\n    private readonly errors: ErrorMap<ErrorCode>\n  ) {}\n\n  create<K extends ErrorCode>(\n    code: K,\n    ...data: K extends keyof ErrorParams ? [ErrorParams[K]] : []\n  ): FirebaseError {\n    const customData = (data[0] as ErrorData) || {};\n    const fullCode = `${this.service}/${code}`;\n    const template = this.errors[code];\n\n    const message = template ? replaceTemplate(template, customData) : 'Error';\n    // Service Name: Error message (service/code).\n    const fullMessage = `${this.serviceName}: ${message} (${fullCode}).`;\n\n    const error = new FirebaseError(fullCode, fullMessage);\n\n    // Keys with an underscore at the end of their name are not included in\n    // error.data for some reason.\n    // TODO: Replace with Object.entries when lib is updated to es2017.\n    for (const key of Object.keys(customData)) {\n      if (key.slice(-1) !== '_') {\n        if (key in error) {\n          console.warn(\n            `Overwriting FirebaseError base field \"${key}\" can cause unexpected behavior.`\n          );\n        }\n        error[key] = customData[key];\n      }\n    }\n\n    return error;\n  }\n}\n\nfunction replaceTemplate(template: string, data: ErrorData): string {\n  return template.replace(PATTERN, (_, key) => {\n    const value = data[key];\n    return value != null ? value.toString() : `<${key}?>`;\n  });\n}\n\nconst PATTERN = /\\{\\$([^}]+)}/g;\n","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const DEFAULT_ENTRY_NAME = '[DEFAULT]';\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * A container for all of the Logger instances\n */\nexport const instances: Logger[] = [];\n\n/**\n * The JS SDK supports 5 log levels and also allows a user the ability to\n * silence the logs altogether.\n *\n * The order is a follows:\n * DEBUG < VERBOSE < INFO < WARN < ERROR\n *\n * All of the log types above the current log level will be captured (i.e. if\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\n * `VERBOSE` logs will not)\n */\nexport enum LogLevel {\n  DEBUG,\n  VERBOSE,\n  INFO,\n  WARN,\n  ERROR,\n  SILENT\n}\n\n/**\n * The default log level\n */\nconst defaultLogLevel: LogLevel = LogLevel.INFO;\n\n/**\n * We allow users the ability to pass their own log handler. We will pass the\n * type of log, the current log level, and any other arguments passed (i.e. the\n * messages that the user wants to log) to this function.\n */\nexport type LogHandler = (\n  loggerInstance: Logger,\n  logType: LogLevel,\n  ...args: unknown[]\n) => void;\n\n/**\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\n * messages on to their corresponding console counterparts (if the log method\n * is supported by the current log level)\n */\nconst defaultLogHandler: LogHandler = (instance, logType, ...args): void => {\n  if (logType < instance.logLevel) {\n    return;\n  }\n  const now = new Date().toISOString();\n  switch (logType) {\n    /**\n     * By default, `console.debug` is not displayed in the developer console (in\n     * chrome). To avoid forcing users to have to opt-in to these logs twice\n     * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\n     * logs to the `console.log` function.\n     */\n    case LogLevel.DEBUG:\n      console.log(`[${now}]  ${instance.name}:`, ...args);\n      break;\n    case LogLevel.VERBOSE:\n      console.log(`[${now}]  ${instance.name}:`, ...args);\n      break;\n    case LogLevel.INFO:\n      console.info(`[${now}]  ${instance.name}:`, ...args);\n      break;\n    case LogLevel.WARN:\n      console.warn(`[${now}]  ${instance.name}:`, ...args);\n      break;\n    case LogLevel.ERROR:\n      console.error(`[${now}]  ${instance.name}:`, ...args);\n      break;\n    default:\n      throw new Error(\n        `Attempted to log a message with an invalid logType (value: ${logType})`\n      );\n  }\n};\n\nexport class Logger {\n  /**\n   * Gives you an instance of a Logger to capture messages according to\n   * Firebase's logging scheme.\n   *\n   * @param name The name that the logs will be associated with\n   */\n  constructor(public name: string) {\n    /**\n     * Capture the current instance for later use\n     */\n    instances.push(this);\n  }\n\n  /**\n   * The log level of the given Logger instance.\n   */\n  private _logLevel = defaultLogLevel;\n  get logLevel(): LogLevel {\n    return this._logLevel;\n  }\n  set logLevel(val: LogLevel) {\n    if (!(val in LogLevel)) {\n      throw new TypeError('Invalid value assigned to `logLevel`');\n    }\n    this._logLevel = val;\n  }\n\n  /**\n   * The log handler for the Logger instance.\n   */\n  private _logHandler: LogHandler = defaultLogHandler;\n  get logHandler(): LogHandler {\n    return this._logHandler;\n  }\n  set logHandler(val: LogHandler) {\n    if (typeof val !== 'function') {\n      throw new TypeError('Value assigned to `logHandler` must be a function');\n    }\n    this._logHandler = val;\n  }\n\n  /**\n   * The functions below are all based on the `console` interface\n   */\n\n  debug(...args: unknown[]): void {\n    this._logHandler(this, LogLevel.DEBUG, ...args);\n  }\n  log(...args: unknown[]): void {\n    this._logHandler(this, LogLevel.VERBOSE, ...args);\n  }\n  info(...args: unknown[]): void {\n    this._logHandler(this, LogLevel.INFO, ...args);\n  }\n  warn(...args: unknown[]): void {\n    this._logHandler(this, LogLevel.WARN, ...args);\n  }\n  error(...args: unknown[]): void {\n    this._logHandler(this, LogLevel.ERROR, ...args);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FirebaseApp,\n  FirebaseOptions,\n  FirebaseAppConfig\n} from '@firebase/app-types';\nimport {\n  _FirebaseApp,\n  _FirebaseNamespace,\n  FirebaseService\n} from '@firebase/app-types/private';\nimport { deepCopy } from '@firebase/util';\nimport {\n  ComponentContainer,\n  Component,\n  ComponentType,\n  Name\n} from '@firebase/component';\nimport { AppError, ERROR_FACTORY } from './errors';\nimport { DEFAULT_ENTRY_NAME } from './constants';\nimport { logger } from './logger';\n\n/**\n * Global context object for a collection of services using\n * a shared authentication state.\n */\nexport class FirebaseAppImpl implements FirebaseApp {\n  private readonly options_: FirebaseOptions;\n  private readonly name_: string;\n  private isDeleted_ = false;\n  private automaticDataCollectionEnabled_: boolean;\n  private container: ComponentContainer;\n\n  constructor(\n    options: FirebaseOptions,\n    config: FirebaseAppConfig,\n    private readonly firebase_: _FirebaseNamespace\n  ) {\n    this.name_ = config.name!;\n    this.automaticDataCollectionEnabled_ =\n      config.automaticDataCollectionEnabled || false;\n    this.options_ = deepCopy<FirebaseOptions>(options);\n    this.container = new ComponentContainer(config.name!);\n\n    // add itself to container\n    this._addComponent(new Component('app', () => this, ComponentType.PUBLIC));\n    // populate ComponentContainer with existing components\n    for (const component of this.firebase_.INTERNAL.components.values()) {\n      this._addComponent(component);\n    }\n  }\n\n  get automaticDataCollectionEnabled(): boolean {\n    this.checkDestroyed_();\n    return this.automaticDataCollectionEnabled_;\n  }\n\n  set automaticDataCollectionEnabled(val) {\n    this.checkDestroyed_();\n    this.automaticDataCollectionEnabled_ = val;\n  }\n\n  get name(): string {\n    this.checkDestroyed_();\n    return this.name_;\n  }\n\n  get options(): FirebaseOptions {\n    this.checkDestroyed_();\n    return this.options_;\n  }\n\n  delete(): Promise<void> {\n    return new Promise(resolve => {\n      this.checkDestroyed_();\n      resolve();\n    })\n      .then(() => {\n        this.firebase_.INTERNAL.removeApp(this.name_);\n\n        return Promise.all(\n          this.container.getProviders().map(provider => provider.delete())\n        );\n      })\n      .then((): void => {\n        this.isDeleted_ = true;\n      });\n  }\n\n  /**\n   * Return a service instance associated with this app (creating it\n   * on demand), identified by the passed instanceIdentifier.\n   *\n   * NOTE: Currently storage and functions are the only ones that are leveraging this\n   * functionality. They invoke it by calling:\n   *\n   * ```javascript\n   * firebase.app().storage('STORAGE BUCKET ID')\n   * ```\n   *\n   * The service name is passed to this already\n   * @internal\n   */\n  _getService(\n    name: string,\n    instanceIdentifier: string = DEFAULT_ENTRY_NAME\n  ): FirebaseService {\n    this.checkDestroyed_();\n\n    // getImmediate will always succeed because _getService is only called for registered components.\n    return (this.container.getProvider(name as Name).getImmediate({\n      identifier: instanceIdentifier\n    }) as unknown) as FirebaseService;\n  }\n  /**\n   * Remove a service instance from the cache, so we will create a new instance for this service\n   * when people try to get this service again.\n   *\n   * NOTE: currently only firestore is using this functionality to support firestore shutdown.\n   *\n   * @param name The service name\n   * @param instanceIdentifier instance identifier in case multiple instances are allowed\n   * @internal\n   */\n  _removeServiceInstance(\n    name: string,\n    instanceIdentifier: string = DEFAULT_ENTRY_NAME\n  ): void {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    this.container.getProvider(name as any).clearInstance(instanceIdentifier);\n  }\n\n  /**\n   * @param component the component being added to this app's container\n   */\n  _addComponent(component: Component): void {\n    try {\n      this.container.addComponent(component);\n    } catch (e) {\n      logger.debug(\n        `Component ${component.name} failed to register with FirebaseApp ${this.name}`,\n        e\n      );\n    }\n  }\n\n  _addOrOverwriteComponent(component: Component): void {\n    this.container.addOrOverwriteComponent(component);\n  }\n\n  /**\n   * This function will throw an Error if the App has already been deleted -\n   * use before performing API actions on the App.\n   */\n  private checkDestroyed_(): void {\n    if (this.isDeleted_) {\n      throw ERROR_FACTORY.create(AppError.APP_DELETED, { appName: this.name_ });\n    }\n  }\n}\n\n// Prevent dead-code elimination of these methods w/o invalid property\n// copying.\n(FirebaseAppImpl.prototype.name && FirebaseAppImpl.prototype.options) ||\n  FirebaseAppImpl.prototype.delete ||\n  console.log('dc');\n","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseNamespace } from '@firebase/app-types';\nimport { _FirebaseApp, _FirebaseNamespace } from '@firebase/app-types/private';\nimport { createSubscribe, deepExtend, ErrorFactory } from '@firebase/util';\nimport { FirebaseAppImpl } from './firebaseApp';\nimport { createFirebaseNamespaceCore } from './firebaseNamespaceCore';\n\n/**\n * Return a firebase namespace object.\n *\n * In production, this will be called exactly once and the result\n * assigned to the 'firebase' global.  It may be called multiple times\n * in unit tests.\n */\nexport function createFirebaseNamespace(): FirebaseNamespace {\n  const namespace = createFirebaseNamespaceCore(FirebaseAppImpl);\n  (namespace as _FirebaseNamespace).INTERNAL = {\n    ...(namespace as _FirebaseNamespace).INTERNAL,\n    createFirebaseNamespace,\n    extendNamespace,\n    createSubscribe,\n    ErrorFactory,\n    deepExtend\n  };\n\n  /**\n   * Patch the top-level firebase namespace with additional properties.\n   *\n   * firebase.INTERNAL.extendNamespace()\n   */\n  function extendNamespace(props: { [prop: string]: unknown }): void {\n    deepExtend(namespace, props);\n  }\n\n  return namespace;\n}\n\nexport const firebase = createFirebaseNamespace();\n","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FirebaseApp,\n  FirebaseOptions,\n  FirebaseNamespace,\n  FirebaseAppConfig\n} from '@firebase/app-types';\nimport {\n  _FirebaseApp,\n  _FirebaseNamespace,\n  FirebaseService,\n  FirebaseServiceNamespace\n} from '@firebase/app-types/private';\nimport { deepExtend, contains } from '@firebase/util';\nimport { FirebaseAppImpl } from './firebaseApp';\nimport { ERROR_FACTORY, AppError } from './errors';\nimport { FirebaseAppLiteImpl } from './lite/firebaseAppLite';\nimport { DEFAULT_ENTRY_NAME, PLATFORM_LOG_STRING } from './constants';\nimport { version } from '../../firebase/package.json';\nimport { logger } from './logger';\nimport { Component, ComponentType, Name } from '@firebase/component';\n\n/**\n * Because auth can't share code with other components, we attach the utility functions\n * in an internal namespace to share code.\n * This function return a firebase namespace object without\n * any utility functions, so it can be shared between the regular firebaseNamespace and\n * the lite version.\n */\nexport function createFirebaseNamespaceCore(\n  firebaseAppImpl: typeof FirebaseAppImpl | typeof FirebaseAppLiteImpl\n): FirebaseNamespace {\n  const apps: { [name: string]: FirebaseApp } = {};\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const components = new Map<string, Component<any>>();\n\n  // A namespace is a plain JavaScript Object.\n  const namespace: FirebaseNamespace = {\n    // Hack to prevent Babel from modifying the object returned\n    // as the firebase namespace.\n    // @ts-ignore\n    __esModule: true,\n    initializeApp,\n    // @ts-ignore\n    app,\n    registerVersion,\n    // @ts-ignore\n    apps: null,\n    SDK_VERSION: version,\n    INTERNAL: {\n      registerComponent,\n      removeApp,\n      components,\n      useAsService\n    }\n  };\n\n  // Inject a circular default export to allow Babel users who were previously\n  // using:\n  //\n  //   import firebase from 'firebase';\n  //   which becomes: var firebase = require('firebase').default;\n  //\n  // instead of\n  //\n  //   import * as firebase from 'firebase';\n  //   which becomes: var firebase = require('firebase');\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (namespace as any)['default'] = namespace;\n\n  // firebase.apps is a read-only getter.\n  Object.defineProperty(namespace, 'apps', {\n    get: getApps\n  });\n\n  /**\n   * Called by App.delete() - but before any services associated with the App\n   * are deleted.\n   */\n  function removeApp(name: string): void {\n    delete apps[name];\n  }\n\n  /**\n   * Get the App object for a given name (or DEFAULT).\n   */\n  function app(name?: string): FirebaseApp {\n    name = name || DEFAULT_ENTRY_NAME;\n    if (!contains(apps, name)) {\n      throw ERROR_FACTORY.create(AppError.NO_APP, { appName: name });\n    }\n    return apps[name];\n  }\n\n  // @ts-ignore\n  app['App'] = firebaseAppImpl;\n  /**\n   * Create a new App instance (name must be unique).\n   */\n  function initializeApp(\n    options: FirebaseOptions,\n    config?: FirebaseAppConfig\n  ): FirebaseApp;\n  function initializeApp(options: FirebaseOptions, name?: string): FirebaseApp;\n  function initializeApp(\n    options: FirebaseOptions,\n    rawConfig = {}\n  ): FirebaseApp {\n    if (typeof rawConfig !== 'object' || rawConfig === null) {\n      const name = rawConfig;\n      rawConfig = { name };\n    }\n\n    const config = rawConfig as FirebaseAppConfig;\n\n    if (config.name === undefined) {\n      config.name = DEFAULT_ENTRY_NAME;\n    }\n\n    const { name } = config;\n\n    if (typeof name !== 'string' || !name) {\n      throw ERROR_FACTORY.create(AppError.BAD_APP_NAME, {\n        appName: String(name)\n      });\n    }\n\n    if (contains(apps, name)) {\n      throw ERROR_FACTORY.create(AppError.DUPLICATE_APP, { appName: name });\n    }\n\n    const app = new firebaseAppImpl(\n      options,\n      config,\n      namespace as _FirebaseNamespace\n    );\n\n    apps[name] = app;\n\n    return app;\n  }\n\n  /*\n   * Return an array of all the non-deleted FirebaseApps.\n   */\n  function getApps(): FirebaseApp[] {\n    // Make a copy so caller cannot mutate the apps list.\n    return Object.keys(apps).map(name => apps[name]);\n  }\n\n  function registerComponent(\n    component: Component\n  ): FirebaseServiceNamespace<FirebaseService> | null {\n    const componentName = component.name;\n    if (components.has(componentName)) {\n      logger.debug(\n        `There were multiple attempts to register component ${componentName}.`\n      );\n\n      return component.type === ComponentType.PUBLIC\n        ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          (namespace as any)[componentName]\n        : null;\n    }\n\n    components.set(componentName, component);\n\n    // create service namespace for public components\n    if (component.type === ComponentType.PUBLIC) {\n      // The Service namespace is an accessor function ...\n      const serviceNamespace = (\n        appArg: FirebaseApp = app()\n      ): FirebaseService => {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        if (typeof (appArg as any)[componentName] !== 'function') {\n          // Invalid argument.\n          // This happens in the following case: firebase.storage('gs:/')\n          throw ERROR_FACTORY.create(AppError.INVALID_APP_ARGUMENT, {\n            appName: componentName\n          });\n        }\n\n        // Forward service instance lookup to the FirebaseApp.\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return (appArg as any)[componentName]();\n      };\n\n      // ... and a container for service-level properties.\n      if (component.serviceProps !== undefined) {\n        deepExtend(serviceNamespace, component.serviceProps);\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (namespace as any)[componentName] = serviceNamespace;\n\n      // Patch the FirebaseAppImpl prototype\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (firebaseAppImpl.prototype as any)[componentName] =\n        // TODO: The eslint disable can be removed and the 'ignoreRestArgs'\n        // option added to the no-explicit-any rule when ESlint releases it.\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        function(...args: any) {\n          const serviceFxn = this._getService.bind(this, componentName);\n          return serviceFxn.apply(\n            this,\n            component.multipleInstances ? args : []\n          );\n        };\n    }\n\n    // add the component to existing app instances\n    for (const appName of Object.keys(apps)) {\n      (apps[appName] as _FirebaseApp)._addComponent(component);\n    }\n\n    return component.type === ComponentType.PUBLIC\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (namespace as any)[componentName]\n      : null;\n  }\n\n  function registerVersion(\n    libraryKeyOrName: string,\n    version: string,\n    variant?: string\n  ): void {\n    // TODO: We can use this check to whitelist strings when/if we set up\n    // a good whitelist system.\n    let library = PLATFORM_LOG_STRING[libraryKeyOrName] ?? libraryKeyOrName;\n    if (variant) {\n      library += `-${variant}`;\n    }\n    const libraryMismatch = library.match(/\\s|\\//);\n    const versionMismatch = version.match(/\\s|\\//);\n    if (libraryMismatch || versionMismatch) {\n      const warning = [\n        `Unable to register library \"${library}\" with version \"${version}\":`\n      ];\n      if (libraryMismatch) {\n        warning.push(\n          `library name \"${library}\" contains illegal characters (whitespace or \"/\")`\n        );\n      }\n      if (libraryMismatch && versionMismatch) {\n        warning.push('and');\n      }\n      if (versionMismatch) {\n        warning.push(\n          `version name \"${version}\" contains illegal characters (whitespace or \"/\")`\n        );\n      }\n      logger.warn(warning.join(' '));\n      return;\n    }\n    registerComponent(\n      new Component(\n        `${library}-version` as Name,\n        () => ({ library, version }),\n        ComponentType.VERSION\n      )\n    );\n  }\n\n  // Map the requested service to a registered service name\n  // (used to map auth to serverAuth service when needed).\n  function useAsService(app: FirebaseApp, name: string): string | null {\n    if (name === 'serverAuth') {\n      return null;\n    }\n\n    const useService = name;\n\n    return useService;\n  }\n\n  return namespace;\n}\n","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ComponentContainer,\n  ComponentType,\n  Provider,\n  Name\n} from '@firebase/component';\n\nexport class PlatformLoggerService {\n  constructor(private readonly container: ComponentContainer) {}\n  // In initial implementation, this will be called by installations on\n  // auth token refresh, and installations will send this string.\n  getPlatformInfoString(): string {\n    const providers = this.container.getProviders();\n    // Loop through providers and get library/version pairs from any that are\n    // version components.\n    return providers\n      .map(provider => {\n        if (isVersionServiceProvider(provider)) {\n          const service = provider.getImmediate();\n          return `${service.library}/${service.version}`;\n        } else {\n          return null;\n        }\n      })\n      .filter(logString => logString)\n      .join(' ');\n  }\n}\n/**\n *\n * @param provider check if this provider provides a VersionService\n *\n * NOTE: Using Provider<'app-version'> is a hack to indicate that the provider\n * provides VersionService. The provider is not necessarily a 'app-version'\n * provider.\n */\nfunction isVersionServiceProvider(\n  provider: Provider<Name>\n): provider is Provider<'app-version'> {\n  const component = provider.getComponent();\n  return component?.type === ComponentType.VERSION;\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from '@firebase/app';\nimport { FirebaseNamespace } from '@firebase/app-types';\nimport { _FirebaseNamespace } from '@firebase/app-types/private';\nimport { Database } from './src/api/Database';\nimport { DataSnapshot } from './src/api/DataSnapshot';\nimport { Query } from './src/api/Query';\nimport { Reference } from './src/api/Reference';\nimport { enableLogging } from './src/core/util/util';\nimport { RepoManager } from './src/core/RepoManager';\nimport * as INTERNAL from './src/api/internal';\nimport * as TEST_ACCESS from './src/api/test_access';\nimport { isNodeSdk } from '@firebase/util';\nimport * as types from '@firebase/database-types';\nimport { setSDKVersion } from './src/core/version';\nimport { Component, ComponentType } from '@firebase/component';\n\nimport { name, version } from './package.json';\n\nconst ServerValue = Database.ServerValue;\n\nexport function registerDatabase(instance: FirebaseNamespace) {\n  // set SDK_VERSION\n  setSDKVersion(instance.SDK_VERSION);\n\n  // Register the Database Service with the 'firebase' namespace.\n  const namespace = (instance as _FirebaseNamespace).INTERNAL.registerComponent(\n    new Component(\n      'database',\n      (container, url) => {\n        /* Dependencies */\n        // getImmediate for FirebaseApp will always succeed\n        const app = container.getProvider('app').getImmediate();\n        const authProvider = container.getProvider('auth-internal');\n\n        return RepoManager.getInstance().databaseFromApp(\n          app,\n          authProvider,\n          url\n        );\n      },\n      ComponentType.PUBLIC\n    )\n      .setServiceProps(\n        // firebase.database namespace properties\n        {\n          Reference,\n          Query,\n          Database,\n          DataSnapshot,\n          enableLogging,\n          INTERNAL,\n          ServerValue,\n          TEST_ACCESS\n        }\n      )\n      .setMultipleInstances(true)\n  );\n\n  instance.registerVersion(name, version);\n\n  if (isNodeSdk()) {\n    module.exports = namespace;\n  }\n}\n\nregisterDatabase(firebase);\n\n// Types to export for the admin SDK\nexport { Database, Query, Reference, enableLogging, ServerValue };\n\nexport { DataSnapshot } from './src/api/DataSnapshot';\nexport { OnDisconnect } from './src/api/onDisconnect';\n\ndeclare module '@firebase/app-types' {\n  interface FirebaseNamespace {\n    database?: {\n      (app?: FirebaseApp): types.FirebaseDatabase;\n      enableLogging: typeof types.enableLogging;\n      ServerValue: types.ServerValue;\n      Database: typeof types.FirebaseDatabase;\n    };\n  }\n  interface FirebaseApp {\n    database?(databaseURL?: string): types.FirebaseDatabase;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseNamespace } from '@firebase/app-types';\nimport { _FirebaseNamespace } from '@firebase/app-types/private';\nimport { Component, ComponentType } from '@firebase/component';\nimport { PlatformLoggerService } from './platformLoggerService';\nimport { name, version } from '../package.json';\n\nexport function registerCoreComponents(\n  firebase: FirebaseNamespace,\n  variant?: string\n): void {\n  (firebase as _FirebaseNamespace).INTERNAL.registerComponent(\n    new Component(\n      'platform-logger',\n      container => new PlatformLoggerService(container),\n      ComponentType.PRIVATE\n    )\n  );\n  // Register `app` package.\n  firebase.registerVersion(name, version, variant);\n  // Register platform SDK identifier (no version).\n  firebase.registerVersion('fire-js', '');\n}\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nif (process.env.NODE_ENV !== 'production') {\n  var REACT_ELEMENT_TYPE = (typeof Symbol === 'function' &&\n    Symbol.for &&\n    Symbol.for('react.element')) ||\n    0xeac7;\n\n  var isValidElement = function(object) {\n    return typeof object === 'object' &&\n      object !== null &&\n      object.$$typeof === REACT_ELEMENT_TYPE;\n  };\n\n  // By explicitly using `prop-types` you are opting into new development behavior.\n  // http://fb.me/prop-types-in-prod\n  var throwOnDirectAccess = true;\n  module.exports = require('./factoryWithTypeCheckers')(isValidElement, throwOnDirectAccess);\n} else {\n  // By explicitly using `prop-types` you are opting into new production behavior.\n  // http://fb.me/prop-types-in-prod\n  module.exports = require('./factoryWithThrowingShims')();\n}\n","/**\n * Copyright 2014-2015, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n'use strict';\n\n/**\n * Similar to invariant but only logs a warning if the condition is not met.\n * This can be used to log issues in development environments in critical\n * paths. Removing the logging code for production environments will keep the\n * same logic and follow the same code paths.\n */\n\nvar warning = function() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  warning = function(condition, format, args) {\n    var len = arguments.length;\n    args = new Array(len > 2 ? len - 2 : 0);\n    for (var key = 2; key < len; key++) {\n      args[key - 2] = arguments[key];\n    }\n    if (format === undefined) {\n      throw new Error(\n        '`warning(condition, format, ...args)` requires a warning ' +\n        'message argument'\n      );\n    }\n\n    if (format.length < 10 || (/^[s\\W]*$/).test(format)) {\n      throw new Error(\n        'The warning format should be able to uniquely identify this ' +\n        'warning. Please, use a more descriptive format than: ' + format\n      );\n    }\n\n    if (!condition) {\n      var argIndex = 0;\n      var message = 'Warning: ' +\n        format.replace(/%s/g, function() {\n          return args[argIndex++];\n        });\n      if (typeof console !== 'undefined') {\n        console.error(message);\n      }\n      try {\n        // This error was thrown as a convenience so that you can use this stack\n        // to find the callsite that caused this warning to fire.\n        throw new Error(message);\n      } catch(x) {}\n    }\n  };\n}\n\nmodule.exports = warning;\n","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","function _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nexport default function _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}","import _typeof from \"../../helpers/esm/typeof\";\nimport assertThisInitialized from \"./assertThisInitialized\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\n/**\n * Similar to invariant but only logs a warning if the condition is not met.\n * This can be used to log issues in development environments in critical\n * paths. Removing the logging code for production environments will keep the\n * same logic and follow the same code paths.\n */\n\nvar __DEV__ = process.env.NODE_ENV !== 'production';\n\nvar warning = function() {};\n\nif (__DEV__) {\n  var printWarning = function printWarning(format, args) {\n    var len = arguments.length;\n    args = new Array(len > 2 ? len - 2 : 0);\n    for (var key = 2; key < len; key++) {\n      args[key - 2] = arguments[key];\n    }\n    var argIndex = 0;\n    var message = 'Warning: ' +\n      format.replace(/%s/g, function() {\n        return args[argIndex++];\n      });\n    if (typeof console !== 'undefined') {\n      console.error(message);\n    }\n    try {\n      // --- Welcome to debugging React ---\n      // This error was thrown as a convenience so that you can use this stack\n      // to find the callsite that caused this warning to fire.\n      throw new Error(message);\n    } catch (x) {}\n  }\n\n  warning = function(condition, format, args) {\n    var len = arguments.length;\n    args = new Array(len > 2 ? len - 2 : 0);\n    for (var key = 2; key < len; key++) {\n      args[key - 2] = arguments[key];\n    }\n    if (format === undefined) {\n      throw new Error(\n          '`warning(condition, format, ...args)` requires a warning ' +\n          'message argument'\n      );\n    }\n    if (!condition) {\n      printWarning.apply(null, [format].concat(args));\n    }\n  };\n}\n\nmodule.exports = warning;\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\n\nvar invariant = function(condition, format, a, b, c, d, e, f) {\n  if (process.env.NODE_ENV !== 'production') {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  }\n\n  if (!condition) {\n    var error;\n    if (format === undefined) {\n      error = new Error(\n        'Minified exception occurred; use the non-minified dev environment ' +\n        'for the full error message and additional helpful warnings.'\n      );\n    } else {\n      var args = [a, b, c, d, e, f];\n      var argIndex = 0;\n      error = new Error(\n        format.replace(/%s/g, function() { return args[argIndex++]; })\n      );\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1; // we don't care about invariant's own frame\n    throw error;\n  }\n};\n\nmodule.exports = invariant;\n","import defineProperty from \"./defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}","\"use strict\";\n\nvar _CSSTransition = _interopRequireDefault(require(\"./CSSTransition\"));\n\nvar _ReplaceTransition = _interopRequireDefault(require(\"./ReplaceTransition\"));\n\nvar _TransitionGroup = _interopRequireDefault(require(\"./TransitionGroup\"));\n\nvar _Transition = _interopRequireDefault(require(\"./Transition\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nmodule.exports = {\n  Transition: _Transition.default,\n  TransitionGroup: _TransitionGroup.default,\n  ReplaceTransition: _ReplaceTransition.default,\n  CSSTransition: _CSSTransition.default\n};","module.exports = require(\"regenerator-runtime\");\n","'use strict';\n\nfunction checkDCE() {\n  /* global __REACT_DEVTOOLS_GLOBAL_HOOK__ */\n  if (\n    typeof __REACT_DEVTOOLS_GLOBAL_HOOK__ === 'undefined' ||\n    typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE !== 'function'\n  ) {\n    return;\n  }\n  if (process.env.NODE_ENV !== 'production') {\n    // This branch is unreachable because this function is only called\n    // in production, but the condition is true only in development.\n    // Therefore if the branch is still here, dead code elimination wasn't\n    // properly applied.\n    // Don't change the message. React DevTools relies on it. Also make sure\n    // this message doesn't occur elsewhere in this function, or it will cause\n    // a false positive.\n    throw new Error('^_^');\n  }\n  try {\n    // Verify that the code above has been dead code eliminated (DCE'd).\n    __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE);\n  } catch (err) {\n    // DevTools shouldn't crash React, no matter what.\n    // We should still report in case we break this code.\n    console.error(err);\n  }\n}\n\nif (process.env.NODE_ENV === 'production') {\n  // DCE check should happen before ReactDOM bundle executes so that\n  // DevTools can report bad minification during injection.\n  checkDCE();\n  module.exports = require('./cjs/react-dom.production.min.js');\n} else {\n  module.exports = require('./cjs/react-dom.development.js');\n}\n","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import pathToRegexp from \"path-to-regexp\";\n\nvar patternCache = {};\nvar cacheLimit = 10000;\nvar cacheCount = 0;\n\nvar compilePath = function compilePath(pattern, options) {\n  var cacheKey = \"\" + options.end + options.strict + options.sensitive;\n  var cache = patternCache[cacheKey] || (patternCache[cacheKey] = {});\n\n  if (cache[pattern]) return cache[pattern];\n\n  var keys = [];\n  var re = pathToRegexp(pattern, keys, options);\n  var compiledPattern = { re: re, keys: keys };\n\n  if (cacheCount < cacheLimit) {\n    cache[pattern] = compiledPattern;\n    cacheCount++;\n  }\n\n  return compiledPattern;\n};\n\n/**\n * Public API for matching a URL pathname to a path pattern.\n */\nvar matchPath = function matchPath(pathname) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var parent = arguments[2];\n\n  if (typeof options === \"string\") options = { path: options };\n\n  var _options = options,\n      path = _options.path,\n      _options$exact = _options.exact,\n      exact = _options$exact === undefined ? false : _options$exact,\n      _options$strict = _options.strict,\n      strict = _options$strict === undefined ? false : _options$strict,\n      _options$sensitive = _options.sensitive,\n      sensitive = _options$sensitive === undefined ? false : _options$sensitive;\n\n\n  if (path == null) return parent;\n\n  var _compilePath = compilePath(path, { end: exact, strict: strict, sensitive: sensitive }),\n      re = _compilePath.re,\n      keys = _compilePath.keys;\n\n  var match = re.exec(pathname);\n\n  if (!match) return null;\n\n  var url = match[0],\n      values = match.slice(1);\n\n  var isExact = pathname === url;\n\n  if (exact && !isExact) return null;\n\n  return {\n    path: path, // the path pattern used to match\n    url: path === \"/\" && url === \"\" ? \"/\" : url, // the matched portion of the URL\n    isExact: isExact, // whether or not we matched exactly\n    params: keys.reduce(function (memo, key, index) {\n      memo[key.name] = values[index];\n      return memo;\n    }, {})\n  };\n};\n\nexport default matchPath;","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CONSTANTS } from './constants';\n\n/**\n * Throws an error if the provided assertion is falsy\n */\nexport const assert = function(assertion: unknown, message: string): void {\n  if (!assertion) {\n    throw assertionError(message);\n  }\n};\n\n/**\n * Returns an Error object suitable for throwing.\n */\nexport const assertionError = function(message: string): Error {\n  return new Error(\n    'Firebase Database (' +\n      CONSTANTS.SDK_VERSION +\n      ') INTERNAL ASSERT FAILED: ' +\n      message\n  );\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst stringToByteArray = function(str: string): number[] {\n  // TODO(user): Use native implementations if/when available\n  const out: number[] = [];\n  let p = 0;\n  for (let i = 0; i < str.length; i++) {\n    let c = str.charCodeAt(i);\n    if (c < 128) {\n      out[p++] = c;\n    } else if (c < 2048) {\n      out[p++] = (c >> 6) | 192;\n      out[p++] = (c & 63) | 128;\n    } else if (\n      (c & 0xfc00) === 0xd800 &&\n      i + 1 < str.length &&\n      (str.charCodeAt(i + 1) & 0xfc00) === 0xdc00\n    ) {\n      // Surrogate Pair\n      c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\n      out[p++] = (c >> 18) | 240;\n      out[p++] = ((c >> 12) & 63) | 128;\n      out[p++] = ((c >> 6) & 63) | 128;\n      out[p++] = (c & 63) | 128;\n    } else {\n      out[p++] = (c >> 12) | 224;\n      out[p++] = ((c >> 6) & 63) | 128;\n      out[p++] = (c & 63) | 128;\n    }\n  }\n  return out;\n};\n\n/**\n * Turns an array of numbers into the string given by the concatenation of the\n * characters to which the numbers correspond.\n * @param bytes Array of numbers representing characters.\n * @return Stringification of the array.\n */\nconst byteArrayToString = function(bytes: number[]): string {\n  // TODO(user): Use native implementations if/when available\n  const out: string[] = [];\n  let pos = 0,\n    c = 0;\n  while (pos < bytes.length) {\n    const c1 = bytes[pos++];\n    if (c1 < 128) {\n      out[c++] = String.fromCharCode(c1);\n    } else if (c1 > 191 && c1 < 224) {\n      const c2 = bytes[pos++];\n      out[c++] = String.fromCharCode(((c1 & 31) << 6) | (c2 & 63));\n    } else if (c1 > 239 && c1 < 365) {\n      // Surrogate Pair\n      const c2 = bytes[pos++];\n      const c3 = bytes[pos++];\n      const c4 = bytes[pos++];\n      const u =\n        (((c1 & 7) << 18) | ((c2 & 63) << 12) | ((c3 & 63) << 6) | (c4 & 63)) -\n        0x10000;\n      out[c++] = String.fromCharCode(0xd800 + (u >> 10));\n      out[c++] = String.fromCharCode(0xdc00 + (u & 1023));\n    } else {\n      const c2 = bytes[pos++];\n      const c3 = bytes[pos++];\n      out[c++] = String.fromCharCode(\n        ((c1 & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63)\n      );\n    }\n  }\n  return out.join('');\n};\n\ninterface Base64 {\n  byteToCharMap_: { [key: number]: string } | null;\n  charToByteMap_: { [key: string]: number } | null;\n  byteToCharMapWebSafe_: { [key: number]: string } | null;\n  charToByteMapWebSafe_: { [key: string]: number } | null;\n  ENCODED_VALS_BASE: string;\n  readonly ENCODED_VALS: string;\n  readonly ENCODED_VALS_WEBSAFE: string;\n  HAS_NATIVE_SUPPORT: boolean;\n  encodeByteArray(input: number[] | Uint8Array, webSafe?: boolean): string;\n  encodeString(input: string, webSafe?: boolean): string;\n  decodeString(input: string, webSafe: boolean): string;\n  decodeStringToByteArray(input: string, webSafe: boolean): number[];\n  init_(): void;\n}\n\n// We define it as an object literal instead of a class because a class compiled down to es5 can't\n// be treeshaked. https://github.com/rollup/rollup/issues/1691\n// Static lookup maps, lazily populated by init_()\nexport const base64: Base64 = {\n  /**\n   * Maps bytes to characters.\n   */\n  byteToCharMap_: null,\n\n  /**\n   * Maps characters to bytes.\n   */\n  charToByteMap_: null,\n\n  /**\n   * Maps bytes to websafe characters.\n   * @private\n   */\n  byteToCharMapWebSafe_: null,\n\n  /**\n   * Maps websafe characters to bytes.\n   * @private\n   */\n  charToByteMapWebSafe_: null,\n\n  /**\n   * Our default alphabet, shared between\n   * ENCODED_VALS and ENCODED_VALS_WEBSAFE\n   */\n  ENCODED_VALS_BASE:\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789',\n\n  /**\n   * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\n   */\n  get ENCODED_VALS() {\n    return this.ENCODED_VALS_BASE + '+/=';\n  },\n\n  /**\n   * Our websafe alphabet.\n   */\n  get ENCODED_VALS_WEBSAFE() {\n    return this.ENCODED_VALS_BASE + '-_.';\n  },\n\n  /**\n   * Whether this browser supports the atob and btoa functions. This extension\n   * started at Mozilla but is now implemented by many browsers. We use the\n   * ASSUME_* variables to avoid pulling in the full useragent detection library\n   * but still allowing the standard per-browser compilations.\n   *\n   */\n  HAS_NATIVE_SUPPORT: typeof atob === 'function',\n\n  /**\n   * Base64-encode an array of bytes.\n   *\n   * @param input An array of bytes (numbers with\n   *     value in [0, 255]) to encode.\n   * @param webSafe Boolean indicating we should use the\n   *     alternative alphabet.\n   * @return The base64 encoded string.\n   */\n  encodeByteArray(input: number[] | Uint8Array, webSafe?: boolean): string {\n    if (!Array.isArray(input)) {\n      throw Error('encodeByteArray takes an array as a parameter');\n    }\n\n    this.init_();\n\n    const byteToCharMap = webSafe\n      ? this.byteToCharMapWebSafe_!\n      : this.byteToCharMap_!;\n\n    const output = [];\n\n    for (let i = 0; i < input.length; i += 3) {\n      const byte1 = input[i];\n      const haveByte2 = i + 1 < input.length;\n      const byte2 = haveByte2 ? input[i + 1] : 0;\n      const haveByte3 = i + 2 < input.length;\n      const byte3 = haveByte3 ? input[i + 2] : 0;\n\n      const outByte1 = byte1 >> 2;\n      const outByte2 = ((byte1 & 0x03) << 4) | (byte2 >> 4);\n      let outByte3 = ((byte2 & 0x0f) << 2) | (byte3 >> 6);\n      let outByte4 = byte3 & 0x3f;\n\n      if (!haveByte3) {\n        outByte4 = 64;\n\n        if (!haveByte2) {\n          outByte3 = 64;\n        }\n      }\n\n      output.push(\n        byteToCharMap[outByte1],\n        byteToCharMap[outByte2],\n        byteToCharMap[outByte3],\n        byteToCharMap[outByte4]\n      );\n    }\n\n    return output.join('');\n  },\n\n  /**\n   * Base64-encode a string.\n   *\n   * @param input A string to encode.\n   * @param webSafe If true, we should use the\n   *     alternative alphabet.\n   * @return The base64 encoded string.\n   */\n  encodeString(input: string, webSafe?: boolean): string {\n    // Shortcut for Mozilla browsers that implement\n    // a native base64 encoder in the form of \"btoa/atob\"\n    if (this.HAS_NATIVE_SUPPORT && !webSafe) {\n      return btoa(input);\n    }\n    return this.encodeByteArray(stringToByteArray(input), webSafe);\n  },\n\n  /**\n   * Base64-decode a string.\n   *\n   * @param input to decode.\n   * @param webSafe True if we should use the\n   *     alternative alphabet.\n   * @return string representing the decoded value.\n   */\n  decodeString(input: string, webSafe: boolean): string {\n    // Shortcut for Mozilla browsers that implement\n    // a native base64 encoder in the form of \"btoa/atob\"\n    if (this.HAS_NATIVE_SUPPORT && !webSafe) {\n      return atob(input);\n    }\n    return byteArrayToString(this.decodeStringToByteArray(input, webSafe));\n  },\n\n  /**\n   * Base64-decode a string.\n   *\n   * In base-64 decoding, groups of four characters are converted into three\n   * bytes.  If the encoder did not apply padding, the input length may not\n   * be a multiple of 4.\n   *\n   * In this case, the last group will have fewer than 4 characters, and\n   * padding will be inferred.  If the group has one or two characters, it decodes\n   * to one byte.  If the group has three characters, it decodes to two bytes.\n   *\n   * @param input Input to decode.\n   * @param webSafe True if we should use the web-safe alphabet.\n   * @return bytes representing the decoded value.\n   */\n  decodeStringToByteArray(input: string, webSafe: boolean): number[] {\n    this.init_();\n\n    const charToByteMap = webSafe\n      ? this.charToByteMapWebSafe_!\n      : this.charToByteMap_!;\n\n    const output: number[] = [];\n\n    for (let i = 0; i < input.length; ) {\n      const byte1 = charToByteMap[input.charAt(i++)];\n\n      const haveByte2 = i < input.length;\n      const byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;\n      ++i;\n\n      const haveByte3 = i < input.length;\n      const byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;\n      ++i;\n\n      const haveByte4 = i < input.length;\n      const byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;\n      ++i;\n\n      if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {\n        throw Error();\n      }\n\n      const outByte1 = (byte1 << 2) | (byte2 >> 4);\n      output.push(outByte1);\n\n      if (byte3 !== 64) {\n        const outByte2 = ((byte2 << 4) & 0xf0) | (byte3 >> 2);\n        output.push(outByte2);\n\n        if (byte4 !== 64) {\n          const outByte3 = ((byte3 << 6) & 0xc0) | byte4;\n          output.push(outByte3);\n        }\n      }\n    }\n\n    return output;\n  },\n\n  /**\n   * Lazy static initialization function. Called before\n   * accessing any of the static map variables.\n   * @private\n   */\n  init_() {\n    if (!this.byteToCharMap_) {\n      this.byteToCharMap_ = {};\n      this.charToByteMap_ = {};\n      this.byteToCharMapWebSafe_ = {};\n      this.charToByteMapWebSafe_ = {};\n\n      // We want quick mappings back and forth, so we precompute two maps.\n      for (let i = 0; i < this.ENCODED_VALS.length; i++) {\n        this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);\n        this.charToByteMap_[this.byteToCharMap_[i]] = i;\n        this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);\n        this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;\n\n        // Be forgiving when decoding and correctly decode both encodings.\n        if (i >= this.ENCODED_VALS_BASE.length) {\n          this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;\n          this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;\n        }\n      }\n    }\n  }\n};\n\n/**\n * URL-safe base64 encoding\n */\nexport const base64Encode = function(str: string): string {\n  const utf8Bytes = stringToByteArray(str);\n  return base64.encodeByteArray(utf8Bytes, true);\n};\n\n/**\n * URL-safe base64 decoding\n *\n * NOTE: DO NOT use the global atob() function - it does NOT support the\n * base64Url variant encoding.\n *\n * @param str To be decoded\n * @return Decoded result, if possible\n */\nexport const base64Decode = function(str: string): string | null {\n  try {\n    return base64.decodeString(str, true);\n  } catch (e) {\n    console.error('base64Decode failed: ', e);\n  }\n  return null;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Do a deep-copy of basic JavaScript Objects or Arrays.\n */\nexport function deepCopy<T>(value: T): T {\n  return deepExtend(undefined, value) as T;\n}\n\n/**\n * Copy properties from source to target (recursively allows extension\n * of Objects and Arrays).  Scalar values in the target are over-written.\n * If target is undefined, an object of the appropriate type will be created\n * (and returned).\n *\n * We recursively copy all child properties of plain Objects in the source- so\n * that namespace- like dictionaries are merged.\n *\n * Note that the target can be a function, in which case the properties in\n * the source Object are copied onto it as static properties of the Function.\n */\nexport function deepExtend(target: unknown, source: unknown): unknown {\n  if (!(source instanceof Object)) {\n    return source;\n  }\n\n  switch (source.constructor) {\n    case Date:\n      // Treat Dates like scalars; if the target date object had any child\n      // properties - they will be lost!\n      const dateValue = source as Date;\n      return new Date(dateValue.getTime());\n\n    case Object:\n      if (target === undefined) {\n        target = {};\n      }\n      break;\n    case Array:\n      // Always copy the array source and overwrite the target.\n      target = [];\n      break;\n\n    default:\n      // Not a plain Object - treat it as a scalar.\n      return source;\n  }\n\n  for (const prop in source) {\n    if (!source.hasOwnProperty(prop)) {\n      continue;\n    }\n    (target as { [key: string]: unknown })[prop] = deepExtend(\n      (target as { [key: string]: unknown })[prop],\n      (source as { [key: string]: unknown })[prop]\n    );\n  }\n\n  return target;\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport class Deferred<R> {\n  promise: Promise<R>;\n  reject: (value?: unknown) => void = () => {};\n  resolve: (value?: unknown) => void = () => {};\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.resolve = resolve as (value?: unknown) => void;\n      this.reject = reject as (value?: unknown) => void;\n    });\n  }\n\n  /**\n   * Our API internals are not promiseified and cannot because our callback APIs have subtle expectations around\n   * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\n   * and returns a node-style callback which will resolve or reject the Deferred's promise.\n   */\n  wrapCallback(\n    callback?: (error?: unknown, value?: unknown) => void\n  ): (error: unknown, value?: unknown) => void {\n    return (error, value?) => {\n      if (error) {\n        this.reject(error);\n      } else {\n        this.resolve(value);\n      }\n      if (typeof callback === 'function') {\n        // Attaching noop handler just in case developer wasn't expecting\n        // promises\n        this.promise.catch(() => {});\n\n        // Some of our callbacks don't expect a value and our own tests\n        // assert that the parameter length is 1\n        if (callback.length === 1) {\n          callback(error);\n        } else {\n          callback(error, value);\n        }\n      }\n    };\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CONSTANTS } from './constants';\n\n/**\n * Returns navigator.userAgent string or '' if it's not defined.\n * @return user agent string\n */\nexport function getUA(): string {\n  if (\n    typeof navigator !== 'undefined' &&\n    typeof navigator['userAgent'] === 'string'\n  ) {\n    return navigator['userAgent'];\n  } else {\n    return '';\n  }\n}\n\n/**\n * Detect Cordova / PhoneGap / Ionic frameworks on a mobile device.\n *\n * Deliberately does not rely on checking `file://` URLs (as this fails PhoneGap\n * in the Ripple emulator) nor Cordova `onDeviceReady`, which would normally\n * wait for a callback.\n */\nexport function isMobileCordova(): boolean {\n  return (\n    typeof window !== 'undefined' &&\n    // @ts-ignore Setting up an broadly applicable index signature for Window\n    // just to deal with this case would probably be a bad idea.\n    !!(window['cordova'] || window['phonegap'] || window['PhoneGap']) &&\n    /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())\n  );\n}\n\n/**\n * Detect Node.js.\n *\n * @return true if Node.js environment is detected.\n */\n// Node detection logic from: https://github.com/iliakan/detect-node/\nexport function isNode(): boolean {\n  try {\n    return (\n      Object.prototype.toString.call(global.process) === '[object process]'\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Detect Browser Environment\n */\nexport function isBrowser(): boolean {\n  return typeof self === 'object' && self.self === self;\n}\n\n/**\n * Detect React Native.\n *\n * @return true if ReactNative environment is detected.\n */\nexport function isReactNative(): boolean {\n  return (\n    typeof navigator === 'object' && navigator['product'] === 'ReactNative'\n  );\n}\n\n/**\n * Detect whether the current SDK build is the Node version.\n *\n * @return true if it's the Node SDK build.\n */\nexport function isNodeSdk(): boolean {\n  return CONSTANTS.NODE_CLIENT === true || CONSTANTS.NODE_ADMIN === true;\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Evaluates a JSON string into a javascript object.\n *\n * @param {string} str A string containing JSON.\n * @return {*} The javascript object representing the specified JSON.\n */\nexport function jsonEval(str: string): unknown {\n  return JSON.parse(str);\n}\n\n/**\n * Returns JSON representing a javascript object.\n * @param {*} data Javascript object to be stringified.\n * @return {string} The JSON contents of the object.\n */\nexport function stringify(data: unknown): string {\n  return JSON.stringify(data);\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { base64Decode } from './crypt';\nimport { jsonEval } from './json';\n\ninterface Claims {\n  [key: string]: {};\n}\n\ninterface DecodedToken {\n  header: object;\n  claims: Claims;\n  data: object;\n  signature: string;\n}\n\n/**\n * Decodes a Firebase auth. token into constituent parts.\n *\n * Notes:\n * - May return with invalid / incomplete claims if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nexport const decode = function(token: string): DecodedToken {\n  let header = {},\n    claims: Claims = {},\n    data = {},\n    signature = '';\n\n  try {\n    const parts = token.split('.');\n    header = jsonEval(base64Decode(parts[0]) || '') as object;\n    claims = jsonEval(base64Decode(parts[1]) || '') as Claims;\n    signature = parts[2];\n    data = claims['d'] || {};\n    delete claims['d'];\n  } catch (e) {}\n\n  return {\n    header,\n    claims,\n    data,\n    signature\n  };\n};\n\ninterface DecodedToken {\n  header: object;\n  claims: Claims;\n  data: object;\n  signature: string;\n}\n\n/**\n * Decodes a Firebase auth. token and checks the validity of its time-based claims. Will return true if the\n * token is within the time window authorized by the 'nbf' (not-before) and 'iat' (issued-at) claims.\n *\n * Notes:\n * - May return a false negative if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nexport const isValidTimestamp = function(token: string): boolean {\n  const claims: Claims = decode(token).claims;\n  const now: number = Math.floor(new Date().getTime() / 1000);\n  let validSince: number = 0,\n    validUntil: number = 0;\n\n  if (typeof claims === 'object') {\n    if (claims.hasOwnProperty('nbf')) {\n      validSince = claims['nbf'] as number;\n    } else if (claims.hasOwnProperty('iat')) {\n      validSince = claims['iat'] as number;\n    }\n\n    if (claims.hasOwnProperty('exp')) {\n      validUntil = claims['exp'] as number;\n    } else {\n      // token will expire after 24h by default\n      validUntil = validSince + 86400;\n    }\n  }\n\n  return (\n    !!now &&\n    !!validSince &&\n    !!validUntil &&\n    now >= validSince &&\n    now <= validUntil\n  );\n};\n\n/**\n * Decodes a Firebase auth. token and returns its issued at time if valid, null otherwise.\n *\n * Notes:\n * - May return null if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nexport const issuedAtTime = function(token: string): number | null {\n  const claims: Claims = decode(token).claims;\n  if (typeof claims === 'object' && claims.hasOwnProperty('iat')) {\n    return claims['iat'] as number;\n  }\n  return null;\n};\n\n/**\n * Decodes a Firebase auth. token and checks the validity of its format. Expects a valid issued-at time.\n *\n * Notes:\n * - May return a false negative if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nexport const isValidFormat = function(token: string): boolean {\n  const decoded = decode(token),\n    claims = decoded.claims;\n\n  return !!claims && typeof claims === 'object' && claims.hasOwnProperty('iat');\n};\n\n/**\n * Attempts to peer into an auth token and determine if it's an admin auth token by looking at the claims portion.\n *\n * Notes:\n * - May return a false negative if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nexport const isAdmin = function(token: string): boolean {\n  const claims: Claims = decode(token).claims;\n  return typeof claims === 'object' && claims['admin'] === true;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview SHA-1 cryptographic hash.\n * Variable names follow the notation in FIPS PUB 180-3:\n * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\n *\n * Usage:\n *   var sha1 = new sha1();\n *   sha1.update(bytes);\n *   var hash = sha1.digest();\n *\n * Performance:\n *   Chrome 23:   ~400 Mbit/s\n *   Firefox 16:  ~250 Mbit/s\n *\n */\n\n/**\n * SHA-1 cryptographic hash constructor.\n *\n * The properties declared here are discussed in the above algorithm document.\n * @constructor\n * @final\n * @struct\n */\nexport class Sha1 {\n  /**\n   * Holds the previous values of accumulated variables a-e in the compress_\n   * function.\n   * @private\n   */\n  private chain_: number[] = [];\n\n  /**\n   * A buffer holding the partially computed hash result.\n   * @private\n   */\n  private buf_: number[] = [];\n\n  /**\n   * An array of 80 bytes, each a part of the message to be hashed.  Referred to\n   * as the message schedule in the docs.\n   * @private\n   */\n  private W_: number[] = [];\n\n  /**\n   * Contains data needed to pad messages less than 64 bytes.\n   * @private\n   */\n  private pad_: number[] = [];\n\n  /**\n   * @private {number}\n   */\n  private inbuf_: number = 0;\n\n  /**\n   * @private {number}\n   */\n  private total_: number = 0;\n\n  blockSize: number;\n\n  constructor() {\n    this.blockSize = 512 / 8;\n\n    this.pad_[0] = 128;\n    for (let i = 1; i < this.blockSize; ++i) {\n      this.pad_[i] = 0;\n    }\n\n    this.reset();\n  }\n\n  reset(): void {\n    this.chain_[0] = 0x67452301;\n    this.chain_[1] = 0xefcdab89;\n    this.chain_[2] = 0x98badcfe;\n    this.chain_[3] = 0x10325476;\n    this.chain_[4] = 0xc3d2e1f0;\n\n    this.inbuf_ = 0;\n    this.total_ = 0;\n  }\n\n  /**\n   * Internal compress helper function.\n   * @param buf Block to compress.\n   * @param offset Offset of the block in the buffer.\n   * @private\n   */\n  compress_(buf: number[] | Uint8Array | string, offset?: number): void {\n    if (!offset) {\n      offset = 0;\n    }\n\n    const W = this.W_;\n\n    // get 16 big endian words\n    if (typeof buf === 'string') {\n      for (let i = 0; i < 16; i++) {\n        // TODO(user): [bug 8140122] Recent versions of Safari for Mac OS and iOS\n        // have a bug that turns the post-increment ++ operator into pre-increment\n        // during JIT compilation.  We have code that depends heavily on SHA-1 for\n        // correctness and which is affected by this bug, so I've removed all uses\n        // of post-increment ++ in which the result value is used.  We can revert\n        // this change once the Safari bug\n        // (https://bugs.webkit.org/show_bug.cgi?id=109036) has been fixed and\n        // most clients have been updated.\n        W[i] =\n          (buf.charCodeAt(offset) << 24) |\n          (buf.charCodeAt(offset + 1) << 16) |\n          (buf.charCodeAt(offset + 2) << 8) |\n          buf.charCodeAt(offset + 3);\n        offset += 4;\n      }\n    } else {\n      for (let i = 0; i < 16; i++) {\n        W[i] =\n          (buf[offset] << 24) |\n          (buf[offset + 1] << 16) |\n          (buf[offset + 2] << 8) |\n          buf[offset + 3];\n        offset += 4;\n      }\n    }\n\n    // expand to 80 words\n    for (let i = 16; i < 80; i++) {\n      const t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\n      W[i] = ((t << 1) | (t >>> 31)) & 0xffffffff;\n    }\n\n    let a = this.chain_[0];\n    let b = this.chain_[1];\n    let c = this.chain_[2];\n    let d = this.chain_[3];\n    let e = this.chain_[4];\n    let f, k;\n\n    // TODO(user): Try to unroll this loop to speed up the computation.\n    for (let i = 0; i < 80; i++) {\n      if (i < 40) {\n        if (i < 20) {\n          f = d ^ (b & (c ^ d));\n          k = 0x5a827999;\n        } else {\n          f = b ^ c ^ d;\n          k = 0x6ed9eba1;\n        }\n      } else {\n        if (i < 60) {\n          f = (b & c) | (d & (b | c));\n          k = 0x8f1bbcdc;\n        } else {\n          f = b ^ c ^ d;\n          k = 0xca62c1d6;\n        }\n      }\n\n      const t = (((a << 5) | (a >>> 27)) + f + e + k + W[i]) & 0xffffffff;\n      e = d;\n      d = c;\n      c = ((b << 30) | (b >>> 2)) & 0xffffffff;\n      b = a;\n      a = t;\n    }\n\n    this.chain_[0] = (this.chain_[0] + a) & 0xffffffff;\n    this.chain_[1] = (this.chain_[1] + b) & 0xffffffff;\n    this.chain_[2] = (this.chain_[2] + c) & 0xffffffff;\n    this.chain_[3] = (this.chain_[3] + d) & 0xffffffff;\n    this.chain_[4] = (this.chain_[4] + e) & 0xffffffff;\n  }\n\n  update(bytes?: number[] | Uint8Array | string, length?: number): void {\n    // TODO(johnlenz): tighten the function signature and remove this check\n    if (bytes == null) {\n      return;\n    }\n\n    if (length === undefined) {\n      length = bytes.length;\n    }\n\n    const lengthMinusBlock = length - this.blockSize;\n    let n = 0;\n    // Using local instead of member variables gives ~5% speedup on Firefox 16.\n    const buf = this.buf_;\n    let inbuf = this.inbuf_;\n\n    // The outer while loop should execute at most twice.\n    while (n < length) {\n      // When we have no data in the block to top up, we can directly process the\n      // input buffer (assuming it contains sufficient data). This gives ~25%\n      // speedup on Chrome 23 and ~15% speedup on Firefox 16, but requires that\n      // the data is provided in large chunks (or in multiples of 64 bytes).\n      if (inbuf === 0) {\n        while (n <= lengthMinusBlock) {\n          this.compress_(bytes, n);\n          n += this.blockSize;\n        }\n      }\n\n      if (typeof bytes === 'string') {\n        while (n < length) {\n          buf[inbuf] = bytes.charCodeAt(n);\n          ++inbuf;\n          ++n;\n          if (inbuf === this.blockSize) {\n            this.compress_(buf);\n            inbuf = 0;\n            // Jump to the outer loop so we use the full-block optimization.\n            break;\n          }\n        }\n      } else {\n        while (n < length) {\n          buf[inbuf] = bytes[n];\n          ++inbuf;\n          ++n;\n          if (inbuf === this.blockSize) {\n            this.compress_(buf);\n            inbuf = 0;\n            // Jump to the outer loop so we use the full-block optimization.\n            break;\n          }\n        }\n      }\n    }\n\n    this.inbuf_ = inbuf;\n    this.total_ += length;\n  }\n\n  /** @override */\n  digest(): number[] {\n    const digest: number[] = [];\n    let totalBits = this.total_ * 8;\n\n    // Add pad 0x80 0x00*.\n    if (this.inbuf_ < 56) {\n      this.update(this.pad_, 56 - this.inbuf_);\n    } else {\n      this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));\n    }\n\n    // Add # bits.\n    for (let i = this.blockSize - 1; i >= 56; i--) {\n      this.buf_[i] = totalBits & 255;\n      totalBits /= 256; // Don't use bit-shifting here!\n    }\n\n    this.compress_(this.buf_);\n\n    let n = 0;\n    for (let i = 0; i < 5; i++) {\n      for (let j = 24; j >= 0; j -= 8) {\n        digest[n] = (this.chain_[i] >> j) & 255;\n        ++n;\n      }\n    }\n    return digest;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport type NextFn<T> = (value: T) => void;\nexport type ErrorFn = (error: Error) => void;\nexport type CompleteFn = () => void;\n\nexport interface Observer<T> {\n  // Called once for each value in a stream of values.\n  next: NextFn<T>;\n\n  // A stream terminates by a single call to EITHER error() or complete().\n  error: ErrorFn;\n\n  // No events will be sent to next() once complete() is called.\n  complete: CompleteFn;\n}\n\nexport type PartialObserver<T> = Partial<Observer<T>>;\n\n// TODO: Support also Unsubscribe.unsubscribe?\nexport type Unsubscribe = () => void;\n\n/**\n * The Subscribe interface has two forms - passing the inline function\n * callbacks, or a object interface with callback properties.\n */\nexport interface Subscribe<T> {\n  (next?: NextFn<T>, error?: ErrorFn, complete?: CompleteFn): Unsubscribe;\n  (observer: PartialObserver<T>): Unsubscribe;\n}\n\nexport interface Observable<T> {\n  // Subscribe method\n  subscribe: Subscribe<T>;\n}\n\nexport type Executor<T> = (observer: Observer<T>) => void;\n\n/**\n * Helper to make a Subscribe function (just like Promise helps make a\n * Thenable).\n *\n * @param executor Function which can make calls to a single Observer\n *     as a proxy.\n * @param onNoObservers Callback when count of Observers goes to zero.\n */\nexport function createSubscribe<T>(\n  executor: Executor<T>,\n  onNoObservers?: Executor<T>\n): Subscribe<T> {\n  const proxy = new ObserverProxy<T>(executor, onNoObservers);\n  return proxy.subscribe.bind(proxy);\n}\n\n/**\n * Implement fan-out for any number of Observers attached via a subscribe\n * function.\n */\nclass ObserverProxy<T> implements Observer<T> {\n  private observers: Array<Observer<T>> | undefined = [];\n  private unsubscribes: Unsubscribe[] = [];\n  private onNoObservers: Executor<T> | undefined;\n  private observerCount = 0;\n  // Micro-task scheduling by calling task.then().\n  private task = Promise.resolve();\n  private finalized = false;\n  private finalError?: Error;\n\n  /**\n   * @param executor Function which can make calls to a single Observer\n   *     as a proxy.\n   * @param onNoObservers Callback when count of Observers goes to zero.\n   */\n  constructor(executor: Executor<T>, onNoObservers?: Executor<T>) {\n    this.onNoObservers = onNoObservers;\n    // Call the executor asynchronously so subscribers that are called\n    // synchronously after the creation of the subscribe function\n    // can still receive the very first value generated in the executor.\n    this.task\n      .then(() => {\n        executor(this);\n      })\n      .catch(e => {\n        this.error(e);\n      });\n  }\n\n  next(value: T): void {\n    this.forEachObserver((observer: Observer<T>) => {\n      observer.next(value);\n    });\n  }\n\n  error(error: Error): void {\n    this.forEachObserver((observer: Observer<T>) => {\n      observer.error(error);\n    });\n    this.close(error);\n  }\n\n  complete(): void {\n    this.forEachObserver((observer: Observer<T>) => {\n      observer.complete();\n    });\n    this.close();\n  }\n\n  /**\n   * Subscribe function that can be used to add an Observer to the fan-out list.\n   *\n   * - We require that no event is sent to a subscriber sychronously to their\n   *   call to subscribe().\n   */\n  subscribe(\n    nextOrObserver?: PartialObserver<T> | Function,\n    error?: ErrorFn,\n    complete?: CompleteFn\n  ): Unsubscribe {\n    let observer: Observer<T>;\n\n    if (\n      nextOrObserver === undefined &&\n      error === undefined &&\n      complete === undefined\n    ) {\n      throw new Error('Missing Observer.');\n    }\n\n    // Assemble an Observer object when passed as callback functions.\n    if (\n      implementsAnyMethods(nextOrObserver as { [key: string]: unknown }, [\n        'next',\n        'error',\n        'complete'\n      ])\n    ) {\n      observer = nextOrObserver as Observer<T>;\n    } else {\n      observer = {\n        next: nextOrObserver as NextFn<T>,\n        error,\n        complete\n      } as Observer<T>;\n    }\n\n    if (observer.next === undefined) {\n      observer.next = noop as NextFn<T>;\n    }\n    if (observer.error === undefined) {\n      observer.error = noop as ErrorFn;\n    }\n    if (observer.complete === undefined) {\n      observer.complete = noop as CompleteFn;\n    }\n\n    const unsub = this.unsubscribeOne.bind(this, this.observers!.length);\n\n    // Attempt to subscribe to a terminated Observable - we\n    // just respond to the Observer with the final error or complete\n    // event.\n    if (this.finalized) {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.task.then(() => {\n        try {\n          if (this.finalError) {\n            observer.error(this.finalError);\n          } else {\n            observer.complete();\n          }\n        } catch (e) {\n          // nothing\n        }\n        return;\n      });\n    }\n\n    this.observers!.push(observer as Observer<T>);\n\n    return unsub;\n  }\n\n  // Unsubscribe is synchronous - we guarantee that no events are sent to\n  // any unsubscribed Observer.\n  private unsubscribeOne(i: number): void {\n    if (this.observers === undefined || this.observers[i] === undefined) {\n      return;\n    }\n\n    delete this.observers[i];\n\n    this.observerCount -= 1;\n    if (this.observerCount === 0 && this.onNoObservers !== undefined) {\n      this.onNoObservers(this);\n    }\n  }\n\n  private forEachObserver(fn: (observer: Observer<T>) => void): void {\n    if (this.finalized) {\n      // Already closed by previous event....just eat the additional values.\n      return;\n    }\n\n    // Since sendOne calls asynchronously - there is no chance that\n    // this.observers will become undefined.\n    for (let i = 0; i < this.observers!.length; i++) {\n      this.sendOne(i, fn);\n    }\n  }\n\n  // Call the Observer via one of it's callback function. We are careful to\n  // confirm that the observe has not been unsubscribed since this asynchronous\n  // function had been queued.\n  private sendOne(i: number, fn: (observer: Observer<T>) => void): void {\n    // Execute the callback asynchronously\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.task.then(() => {\n      if (this.observers !== undefined && this.observers[i] !== undefined) {\n        try {\n          fn(this.observers[i]);\n        } catch (e) {\n          // Ignore exceptions raised in Observers or missing methods of an\n          // Observer.\n          // Log error to console. b/31404806\n          if (typeof console !== 'undefined' && console.error) {\n            console.error(e);\n          }\n        }\n      }\n    });\n  }\n\n  private close(err?: Error): void {\n    if (this.finalized) {\n      return;\n    }\n    this.finalized = true;\n    if (err !== undefined) {\n      this.finalError = err;\n    }\n    // Proxy is no longer needed - garbage collect references\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.task.then(() => {\n      this.observers = undefined;\n      this.onNoObservers = undefined;\n    });\n  }\n}\n\n/** Turn synchronous function into one called asynchronously. */\nexport function async(fn: Function, onError?: ErrorFn): Function {\n  return (...args: unknown[]) => {\n    Promise.resolve(true)\n      .then(() => {\n        fn(...args);\n      })\n      .catch((error: Error) => {\n        if (onError) {\n          onError(error);\n        }\n      });\n  };\n}\n\n/**\n * Return true if the object passed in implements any of the named methods.\n */\nfunction implementsAnyMethods(\n  obj: { [key: string]: unknown },\n  methods: string[]\n): boolean {\n  if (typeof obj !== 'object' || obj === null) {\n    return false;\n  }\n\n  for (const method of methods) {\n    if (method in obj && typeof obj[method] === 'function') {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction noop(): void {\n  // do nothing\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Check to make sure the appropriate number of arguments are provided for a public function.\n * Throws an error if it fails.\n *\n * @param fnName The function name\n * @param minCount The minimum number of arguments to allow for the function call\n * @param maxCount The maximum number of argument to allow for the function call\n * @param argCount The actual number of arguments provided.\n */\nexport const validateArgCount = function(\n  fnName: string,\n  minCount: number,\n  maxCount: number,\n  argCount: number\n): void {\n  let argError;\n  if (argCount < minCount) {\n    argError = 'at least ' + minCount;\n  } else if (argCount > maxCount) {\n    argError = maxCount === 0 ? 'none' : 'no more than ' + maxCount;\n  }\n  if (argError) {\n    const error =\n      fnName +\n      ' failed: Was called with ' +\n      argCount +\n      (argCount === 1 ? ' argument.' : ' arguments.') +\n      ' Expects ' +\n      argError +\n      '.';\n    throw new Error(error);\n  }\n};\n\n/**\n * Generates a string to prefix an error message about failed argument validation\n *\n * @param fnName The function name\n * @param argumentNumber The index of the argument\n * @param optional Whether or not the argument is optional\n * @return The prefix to add to the error thrown for validation.\n */\nexport function errorPrefix(\n  fnName: string,\n  argumentNumber: number,\n  optional: boolean\n): string {\n  let argName = '';\n  switch (argumentNumber) {\n    case 1:\n      argName = optional ? 'first' : 'First';\n      break;\n    case 2:\n      argName = optional ? 'second' : 'Second';\n      break;\n    case 3:\n      argName = optional ? 'third' : 'Third';\n      break;\n    case 4:\n      argName = optional ? 'fourth' : 'Fourth';\n      break;\n    default:\n      throw new Error(\n        'errorPrefix called with argumentNumber > 4.  Need to update it?'\n      );\n  }\n\n  let error = fnName + ' failed: ';\n\n  error += argName + ' argument ';\n  return error;\n}\n\n/**\n * @param fnName\n * @param argumentNumber\n * @param namespace\n * @param optional\n */\nexport function validateNamespace(\n  fnName: string,\n  argumentNumber: number,\n  namespace: string,\n  optional: boolean\n): void {\n  if (optional && !namespace) {\n    return;\n  }\n  if (typeof namespace !== 'string') {\n    //TODO: I should do more validation here. We only allow certain chars in namespaces.\n    throw new Error(\n      errorPrefix(fnName, argumentNumber, optional) +\n        'must be a valid firebase namespace.'\n    );\n  }\n}\n\nexport function validateCallback(\n  fnName: string,\n  argumentNumber: number,\n  callback: Function,\n  optional: boolean\n): void {\n  if (optional && !callback) {\n    return;\n  }\n  if (typeof callback !== 'function') {\n    throw new Error(\n      errorPrefix(fnName, argumentNumber, optional) +\n        'must be a valid function.'\n    );\n  }\n}\n\nexport function validateContextObject(\n  fnName: string,\n  argumentNumber: number,\n  context: unknown,\n  optional: boolean\n): void {\n  if (optional && !context) {\n    return;\n  }\n  if (typeof context !== 'object' || context === null) {\n    throw new Error(\n      errorPrefix(fnName, argumentNumber, optional) +\n        'must be a valid context object.'\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport function contains<T extends object>(obj: T, key: keyof T): boolean {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nexport function safeGet<T extends object, K extends keyof T>(\n  obj: T,\n  key: K\n): T[K] | undefined {\n  if (Object.prototype.hasOwnProperty.call(obj, key)) {\n    return obj[key];\n  } else {\n    return undefined;\n  }\n}\n\nexport function isEmpty(obj: object): obj is {} {\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function map<K extends string, V, U>(\n  obj: { [key in K]: V },\n  fn: (value: V, key: K, obj: { [key in K]: V }) => U,\n  contextObj?: unknown\n): { [key in K]: U } {\n  const res: Partial<{ [key in K]: U }> = {};\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      res[key] = fn.call(contextObj, obj[key], key, obj);\n    }\n  }\n  return res as { [key in K]: U };\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Returns a querystring-formatted string (e.g. &arg=val&arg2=val2) from a\n * params object (e.g. {arg: 'val', arg2: 'val2'})\n * Note: You must prepend it with ? when adding it to a URL.\n */\nexport function querystring(querystringParams: {\n  [key: string]: string;\n}): string {\n  const params = [];\n  for (const [key, value] of Object.entries(querystringParams)) {\n    if (Array.isArray(value)) {\n      value.forEach(arrayVal => {\n        params.push(\n          encodeURIComponent(key) + '=' + encodeURIComponent(arrayVal)\n        );\n      });\n    } else {\n      params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\n    }\n  }\n  return params.length ? '&' + params.join('&') : '';\n}\n\n/**\n * Decodes a querystring (e.g. ?arg=val&arg2=val2) into a params object\n * (e.g. {arg: 'val', arg2: 'val2'})\n */\nexport function querystringDecode(querystring: string): object {\n  const obj: { [key: string]: unknown } = {};\n  const tokens = querystring.replace(/^\\?/, '').split('&');\n\n  tokens.forEach(token => {\n    if (token) {\n      const key = token.split('=');\n      obj[key[0]] = key[1];\n    }\n  });\n  return obj;\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from './assert';\n\n// Code originally came from goog.crypt.stringToUtf8ByteArray, but for some reason they\n// automatically replaced '\\r\\n' with '\\n', and they didn't handle surrogate pairs,\n// so it's been modified.\n\n// Note that not all Unicode characters appear as single characters in JavaScript strings.\n// fromCharCode returns the UTF-16 encoding of a character - so some Unicode characters\n// use 2 characters in Javascript.  All 4-byte UTF-8 characters begin with a first\n// character in the range 0xD800 - 0xDBFF (the first character of a so-called surrogate\n// pair).\n// See http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.3\n\n/**\n * @param {string} str\n * @return {Array}\n */\nexport const stringToByteArray = function(str: string): number[] {\n  const out: number[] = [];\n  let p = 0;\n  for (let i = 0; i < str.length; i++) {\n    let c = str.charCodeAt(i);\n\n    // Is this the lead surrogate in a surrogate pair?\n    if (c >= 0xd800 && c <= 0xdbff) {\n      const high = c - 0xd800; // the high 10 bits.\n      i++;\n      assert(i < str.length, 'Surrogate pair missing trail surrogate.');\n      const low = str.charCodeAt(i) - 0xdc00; // the low 10 bits.\n      c = 0x10000 + (high << 10) + low;\n    }\n\n    if (c < 128) {\n      out[p++] = c;\n    } else if (c < 2048) {\n      out[p++] = (c >> 6) | 192;\n      out[p++] = (c & 63) | 128;\n    } else if (c < 65536) {\n      out[p++] = (c >> 12) | 224;\n      out[p++] = ((c >> 6) & 63) | 128;\n      out[p++] = (c & 63) | 128;\n    } else {\n      out[p++] = (c >> 18) | 240;\n      out[p++] = ((c >> 12) & 63) | 128;\n      out[p++] = ((c >> 6) & 63) | 128;\n      out[p++] = (c & 63) | 128;\n    }\n  }\n  return out;\n};\n\n/**\n * Calculate length without actually converting; useful for doing cheaper validation.\n * @param {string} str\n * @return {number}\n */\nexport const stringLength = function(str: string): number {\n  let p = 0;\n  for (let i = 0; i < str.length; i++) {\n    const c = str.charCodeAt(i);\n    if (c < 128) {\n      p++;\n    } else if (c < 2048) {\n      p += 2;\n    } else if (c >= 0xd800 && c <= 0xdbff) {\n      // Lead surrogate of a surrogate pair.  The pair together will take 4 bytes to represent.\n      p += 4;\n      i++; // skip trail surrogate.\n    } else {\n      p += 3;\n    }\n  }\n  return p;\n};\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","\"use strict\";\n\nexports.__esModule = true;\nexports.default = exports.EXITING = exports.ENTERED = exports.ENTERING = exports.EXITED = exports.UNMOUNTED = void 0;\n\nvar PropTypes = _interopRequireWildcard(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactDom = _interopRequireDefault(require(\"react-dom\"));\n\nvar _reactLifecyclesCompat = require(\"react-lifecycles-compat\");\n\nvar _PropTypes = require(\"./utils/PropTypes\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nvar UNMOUNTED = 'unmounted';\nexports.UNMOUNTED = UNMOUNTED;\nvar EXITED = 'exited';\nexports.EXITED = EXITED;\nvar ENTERING = 'entering';\nexports.ENTERING = ENTERING;\nvar ENTERED = 'entered';\nexports.ENTERED = ENTERED;\nvar EXITING = 'exiting';\n/**\n * The Transition component lets you describe a transition from one component\n * state to another _over time_ with a simple declarative API. Most commonly\n * it's used to animate the mounting and unmounting of a component, but can also\n * be used to describe in-place transition states as well.\n *\n * By default the `Transition` component does not alter the behavior of the\n * component it renders, it only tracks \"enter\" and \"exit\" states for the components.\n * It's up to you to give meaning and effect to those states. For example we can\n * add styles to a component when it enters or exits:\n *\n * ```jsx\n * import Transition from 'react-transition-group/Transition';\n *\n * const duration = 300;\n *\n * const defaultStyle = {\n *   transition: `opacity ${duration}ms ease-in-out`,\n *   opacity: 0,\n * }\n *\n * const transitionStyles = {\n *   entering: { opacity: 0 },\n *   entered:  { opacity: 1 },\n * };\n *\n * const Fade = ({ in: inProp }) => (\n *   <Transition in={inProp} timeout={duration}>\n *     {(state) => (\n *       <div style={{\n *         ...defaultStyle,\n *         ...transitionStyles[state]\n *       }}>\n *         I'm a fade Transition!\n *       </div>\n *     )}\n *   </Transition>\n * );\n * ```\n *\n * As noted the `Transition` component doesn't _do_ anything by itself to its child component.\n * What it does do is track transition states over time so you can update the\n * component (such as by adding styles or classes) when it changes states.\n *\n * There are 4 main states a Transition can be in:\n *  - `'entering'`\n *  - `'entered'`\n *  - `'exiting'`\n *  - `'exited'`\n *\n * Transition state is toggled via the `in` prop. When `true` the component begins the\n * \"Enter\" stage. During this stage, the component will shift from its current transition state,\n * to `'entering'` for the duration of the transition and then to the `'entered'` stage once\n * it's complete. Let's take the following example:\n *\n * ```jsx\n * state = { in: false };\n *\n * toggleEnterState = () => {\n *   this.setState({ in: true });\n * }\n *\n * render() {\n *   return (\n *     <div>\n *       <Transition in={this.state.in} timeout={500} />\n *       <button onClick={this.toggleEnterState}>Click to Enter</button>\n *     </div>\n *   );\n * }\n * ```\n *\n * When the button is clicked the component will shift to the `'entering'` state and\n * stay there for 500ms (the value of `timeout`) before it finally switches to `'entered'`.\n *\n * When `in` is `false` the same thing happens except the state moves from `'exiting'` to `'exited'`.\n *\n * ## Timing\n *\n * Timing is often the trickiest part of animation, mistakes can result in slight delays\n * that are hard to pin down. A common example is when you want to add an exit transition,\n * you should set the desired final styles when the state is `'exiting'`. That's when the\n * transition to those styles will start and, if you matched the `timeout` prop with the\n * CSS Transition duration, it will end exactly when the state changes to `'exited'`.\n *\n * > **Note**: For simpler transitions the `Transition` component might be enough, but\n * > take into account that it's platform-agnostic, while the `CSSTransition` component\n * > [forces reflows](https://github.com/reactjs/react-transition-group/blob/5007303e729a74be66a21c3e2205e4916821524b/src/CSSTransition.js#L208-L215)\n * > in order to make more complex transitions more predictable. For example, even though\n * > classes `example-enter` and `example-enter-active` are applied immediately one after\n * > another, you can still transition from one to the other because of the forced reflow\n * > (read [this issue](https://github.com/reactjs/react-transition-group/issues/159#issuecomment-322761171)\n * > for more info). Take this into account when choosing between `Transition` and\n * > `CSSTransition`.\n */\n\nexports.EXITING = EXITING;\n\nvar Transition =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(Transition, _React$Component);\n\n  function Transition(props, context) {\n    var _this;\n\n    _this = _React$Component.call(this, props, context) || this;\n    var parentGroup = context.transitionGroup; // In the context of a TransitionGroup all enters are really appears\n\n    var appear = parentGroup && !parentGroup.isMounting ? props.enter : props.appear;\n    var initialStatus;\n    _this.appearStatus = null;\n\n    if (props.in) {\n      if (appear) {\n        initialStatus = EXITED;\n        _this.appearStatus = ENTERING;\n      } else {\n        initialStatus = ENTERED;\n      }\n    } else {\n      if (props.unmountOnExit || props.mountOnEnter) {\n        initialStatus = UNMOUNTED;\n      } else {\n        initialStatus = EXITED;\n      }\n    }\n\n    _this.state = {\n      status: initialStatus\n    };\n    _this.nextCallback = null;\n    return _this;\n  }\n\n  var _proto = Transition.prototype;\n\n  _proto.getChildContext = function getChildContext() {\n    return {\n      transitionGroup: null // allows for nested Transitions\n\n    };\n  };\n\n  Transition.getDerivedStateFromProps = function getDerivedStateFromProps(_ref, prevState) {\n    var nextIn = _ref.in;\n\n    if (nextIn && prevState.status === UNMOUNTED) {\n      return {\n        status: EXITED\n      };\n    }\n\n    return null;\n  }; // getSnapshotBeforeUpdate(prevProps) {\n  //   let nextStatus = null\n  //   if (prevProps !== this.props) {\n  //     const { status } = this.state\n  //     if (this.props.in) {\n  //       if (status !== ENTERING && status !== ENTERED) {\n  //         nextStatus = ENTERING\n  //       }\n  //     } else {\n  //       if (status === ENTERING || status === ENTERED) {\n  //         nextStatus = EXITING\n  //       }\n  //     }\n  //   }\n  //   return { nextStatus }\n  // }\n\n\n  _proto.componentDidMount = function componentDidMount() {\n    this.updateStatus(true, this.appearStatus);\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps) {\n    var nextStatus = null;\n\n    if (prevProps !== this.props) {\n      var status = this.state.status;\n\n      if (this.props.in) {\n        if (status !== ENTERING && status !== ENTERED) {\n          nextStatus = ENTERING;\n        }\n      } else {\n        if (status === ENTERING || status === ENTERED) {\n          nextStatus = EXITING;\n        }\n      }\n    }\n\n    this.updateStatus(false, nextStatus);\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    this.cancelNextCallback();\n  };\n\n  _proto.getTimeouts = function getTimeouts() {\n    var timeout = this.props.timeout;\n    var exit, enter, appear;\n    exit = enter = appear = timeout;\n\n    if (timeout != null && typeof timeout !== 'number') {\n      exit = timeout.exit;\n      enter = timeout.enter;\n      appear = timeout.appear;\n    }\n\n    return {\n      exit: exit,\n      enter: enter,\n      appear: appear\n    };\n  };\n\n  _proto.updateStatus = function updateStatus(mounting, nextStatus) {\n    if (mounting === void 0) {\n      mounting = false;\n    }\n\n    if (nextStatus !== null) {\n      // nextStatus will always be ENTERING or EXITING.\n      this.cancelNextCallback();\n\n      var node = _reactDom.default.findDOMNode(this);\n\n      if (nextStatus === ENTERING) {\n        this.performEnter(node, mounting);\n      } else {\n        this.performExit(node);\n      }\n    } else if (this.props.unmountOnExit && this.state.status === EXITED) {\n      this.setState({\n        status: UNMOUNTED\n      });\n    }\n  };\n\n  _proto.performEnter = function performEnter(node, mounting) {\n    var _this2 = this;\n\n    var enter = this.props.enter;\n    var appearing = this.context.transitionGroup ? this.context.transitionGroup.isMounting : mounting;\n    var timeouts = this.getTimeouts(); // no enter animation skip right to ENTERED\n    // if we are mounting and running this it means appear _must_ be set\n\n    if (!mounting && !enter) {\n      this.safeSetState({\n        status: ENTERED\n      }, function () {\n        _this2.props.onEntered(node);\n      });\n      return;\n    }\n\n    this.props.onEnter(node, appearing);\n    this.safeSetState({\n      status: ENTERING\n    }, function () {\n      _this2.props.onEntering(node, appearing); // FIXME: appear timeout?\n\n\n      _this2.onTransitionEnd(node, timeouts.enter, function () {\n        _this2.safeSetState({\n          status: ENTERED\n        }, function () {\n          _this2.props.onEntered(node, appearing);\n        });\n      });\n    });\n  };\n\n  _proto.performExit = function performExit(node) {\n    var _this3 = this;\n\n    var exit = this.props.exit;\n    var timeouts = this.getTimeouts(); // no exit animation skip right to EXITED\n\n    if (!exit) {\n      this.safeSetState({\n        status: EXITED\n      }, function () {\n        _this3.props.onExited(node);\n      });\n      return;\n    }\n\n    this.props.onExit(node);\n    this.safeSetState({\n      status: EXITING\n    }, function () {\n      _this3.props.onExiting(node);\n\n      _this3.onTransitionEnd(node, timeouts.exit, function () {\n        _this3.safeSetState({\n          status: EXITED\n        }, function () {\n          _this3.props.onExited(node);\n        });\n      });\n    });\n  };\n\n  _proto.cancelNextCallback = function cancelNextCallback() {\n    if (this.nextCallback !== null) {\n      this.nextCallback.cancel();\n      this.nextCallback = null;\n    }\n  };\n\n  _proto.safeSetState = function safeSetState(nextState, callback) {\n    // This shouldn't be necessary, but there are weird race conditions with\n    // setState callbacks and unmounting in testing, so always make sure that\n    // we can cancel any pending setState callbacks after we unmount.\n    callback = this.setNextCallback(callback);\n    this.setState(nextState, callback);\n  };\n\n  _proto.setNextCallback = function setNextCallback(callback) {\n    var _this4 = this;\n\n    var active = true;\n\n    this.nextCallback = function (event) {\n      if (active) {\n        active = false;\n        _this4.nextCallback = null;\n        callback(event);\n      }\n    };\n\n    this.nextCallback.cancel = function () {\n      active = false;\n    };\n\n    return this.nextCallback;\n  };\n\n  _proto.onTransitionEnd = function onTransitionEnd(node, timeout, handler) {\n    this.setNextCallback(handler);\n\n    if (node) {\n      if (this.props.addEndListener) {\n        this.props.addEndListener(node, this.nextCallback);\n      }\n\n      if (timeout != null) {\n        setTimeout(this.nextCallback, timeout);\n      }\n    } else {\n      setTimeout(this.nextCallback, 0);\n    }\n  };\n\n  _proto.render = function render() {\n    var status = this.state.status;\n\n    if (status === UNMOUNTED) {\n      return null;\n    }\n\n    var _this$props = this.props,\n        children = _this$props.children,\n        childProps = _objectWithoutPropertiesLoose(_this$props, [\"children\"]); // filter props for Transtition\n\n\n    delete childProps.in;\n    delete childProps.mountOnEnter;\n    delete childProps.unmountOnExit;\n    delete childProps.appear;\n    delete childProps.enter;\n    delete childProps.exit;\n    delete childProps.timeout;\n    delete childProps.addEndListener;\n    delete childProps.onEnter;\n    delete childProps.onEntering;\n    delete childProps.onEntered;\n    delete childProps.onExit;\n    delete childProps.onExiting;\n    delete childProps.onExited;\n\n    if (typeof children === 'function') {\n      return children(status, childProps);\n    }\n\n    var child = _react.default.Children.only(children);\n\n    return _react.default.cloneElement(child, childProps);\n  };\n\n  return Transition;\n}(_react.default.Component);\n\nTransition.contextTypes = {\n  transitionGroup: PropTypes.object\n};\nTransition.childContextTypes = {\n  transitionGroup: function transitionGroup() {}\n};\nTransition.propTypes = process.env.NODE_ENV !== \"production\" ? {\n  /**\n   * A `function` child can be used instead of a React element.\n   * This function is called with the current transition status\n   * ('entering', 'entered', 'exiting', 'exited', 'unmounted'), which can be used\n   * to apply context specific props to a component.\n   *\n   * ```jsx\n   * <Transition timeout={150}>\n   *   {(status) => (\n   *     <MyComponent className={`fade fade-${status}`} />\n   *   )}\n   * </Transition>\n   * ```\n   */\n  children: PropTypes.oneOfType([PropTypes.func.isRequired, PropTypes.element.isRequired]).isRequired,\n\n  /**\n   * Show the component; triggers the enter or exit states\n   */\n  in: PropTypes.bool,\n\n  /**\n   * By default the child component is mounted immediately along with\n   * the parent `Transition` component. If you want to \"lazy mount\" the component on the\n   * first `in={true}` you can set `mountOnEnter`. After the first enter transition the component will stay\n   * mounted, even on \"exited\", unless you also specify `unmountOnExit`.\n   */\n  mountOnEnter: PropTypes.bool,\n\n  /**\n   * By default the child component stays mounted after it reaches the `'exited'` state.\n   * Set `unmountOnExit` if you'd prefer to unmount the component after it finishes exiting.\n   */\n  unmountOnExit: PropTypes.bool,\n\n  /**\n   * Normally a component is not transitioned if it is shown when the `<Transition>` component mounts.\n   * If you want to transition on the first mount set `appear` to `true`, and the\n   * component will transition in as soon as the `<Transition>` mounts.\n   *\n   * > Note: there are no specific \"appear\" states. `appear` only adds an additional `enter` transition.\n   */\n  appear: PropTypes.bool,\n\n  /**\n   * Enable or disable enter transitions.\n   */\n  enter: PropTypes.bool,\n\n  /**\n   * Enable or disable exit transitions.\n   */\n  exit: PropTypes.bool,\n\n  /**\n   * The duration of the transition, in milliseconds.\n   * Required unless `addEndListener` is provided\n   *\n   * You may specify a single timeout for all transitions like: `timeout={500}`,\n   * or individually like:\n   *\n   * ```jsx\n   * timeout={{\n   *  enter: 300,\n   *  exit: 500,\n   * }}\n   * ```\n   *\n   * @type {number | { enter?: number, exit?: number }}\n   */\n  timeout: function timeout(props) {\n    var pt = process.env.NODE_ENV !== \"production\" ? _PropTypes.timeoutsShape : {};;\n    if (!props.addEndListener) pt = pt.isRequired;\n\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    return pt.apply(void 0, [props].concat(args));\n  },\n\n  /**\n   * Add a custom transition end trigger. Called with the transitioning\n   * DOM node and a `done` callback. Allows for more fine grained transition end\n   * logic. **Note:** Timeouts are still used as a fallback if provided.\n   *\n   * ```jsx\n   * addEndListener={(node, done) => {\n   *   // use the css transitionend event to mark the finish of a transition\n   *   node.addEventListener('transitionend', done, false);\n   * }}\n   * ```\n   */\n  addEndListener: PropTypes.func,\n\n  /**\n   * Callback fired before the \"entering\" status is applied. An extra parameter\n   * `isAppearing` is supplied to indicate if the enter stage is occurring on the initial mount\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool) -> void\n   */\n  onEnter: PropTypes.func,\n\n  /**\n   * Callback fired after the \"entering\" status is applied. An extra parameter\n   * `isAppearing` is supplied to indicate if the enter stage is occurring on the initial mount\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool)\n   */\n  onEntering: PropTypes.func,\n\n  /**\n   * Callback fired after the \"entered\" status is applied. An extra parameter\n   * `isAppearing` is supplied to indicate if the enter stage is occurring on the initial mount\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool) -> void\n   */\n  onEntered: PropTypes.func,\n\n  /**\n   * Callback fired before the \"exiting\" status is applied.\n   *\n   * @type Function(node: HtmlElement) -> void\n   */\n  onExit: PropTypes.func,\n\n  /**\n   * Callback fired after the \"exiting\" status is applied.\n   *\n   * @type Function(node: HtmlElement) -> void\n   */\n  onExiting: PropTypes.func,\n\n  /**\n   * Callback fired after the \"exited\" status is applied.\n   *\n   * @type Function(node: HtmlElement) -> void\n   */\n  onExited: PropTypes.func // Name the function so it is clearer in the documentation\n\n} : {};\n\nfunction noop() {}\n\nTransition.defaultProps = {\n  in: false,\n  mountOnEnter: false,\n  unmountOnExit: false,\n  appear: false,\n  enter: true,\n  exit: true,\n  onEnter: noop,\n  onEntering: noop,\n  onEntered: noop,\n  onExit: noop,\n  onExiting: noop,\n  onExited: noop\n};\nTransition.UNMOUNTED = 0;\nTransition.EXITED = 1;\nTransition.ENTERING = 2;\nTransition.ENTERED = 3;\nTransition.EXITING = 4;\n\nvar _default = (0, _reactLifecyclesCompat.polyfill)(Transition);\n\nexports.default = _default;","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nfunction componentWillMount() {\n  // Call this.constructor.gDSFP to support sub-classes.\n  var state = this.constructor.getDerivedStateFromProps(this.props, this.state);\n  if (state !== null && state !== undefined) {\n    this.setState(state);\n  }\n}\n\nfunction componentWillReceiveProps(nextProps) {\n  // Call this.constructor.gDSFP to support sub-classes.\n  // Use the setState() updater to ensure state isn't stale in certain edge cases.\n  function updater(prevState) {\n    var state = this.constructor.getDerivedStateFromProps(nextProps, prevState);\n    return state !== null && state !== undefined ? state : null;\n  }\n  // Binding \"this\" is important for shallow renderer support.\n  this.setState(updater.bind(this));\n}\n\nfunction componentWillUpdate(nextProps, nextState) {\n  try {\n    var prevProps = this.props;\n    var prevState = this.state;\n    this.props = nextProps;\n    this.state = nextState;\n    this.__reactInternalSnapshotFlag = true;\n    this.__reactInternalSnapshot = this.getSnapshotBeforeUpdate(\n      prevProps,\n      prevState\n    );\n  } finally {\n    this.props = prevProps;\n    this.state = prevState;\n  }\n}\n\n// React may warn about cWM/cWRP/cWU methods being deprecated.\n// Add a flag to suppress these warnings for this special case.\ncomponentWillMount.__suppressDeprecationWarning = true;\ncomponentWillReceiveProps.__suppressDeprecationWarning = true;\ncomponentWillUpdate.__suppressDeprecationWarning = true;\n\nfunction polyfill(Component) {\n  var prototype = Component.prototype;\n\n  if (!prototype || !prototype.isReactComponent) {\n    throw new Error('Can only polyfill class components');\n  }\n\n  if (\n    typeof Component.getDerivedStateFromProps !== 'function' &&\n    typeof prototype.getSnapshotBeforeUpdate !== 'function'\n  ) {\n    return Component;\n  }\n\n  // If new component APIs are defined, \"unsafe\" lifecycles won't be called.\n  // Error if any of these lifecycles are present,\n  // Because they would work differently between older and newer (16.3+) versions of React.\n  var foundWillMountName = null;\n  var foundWillReceivePropsName = null;\n  var foundWillUpdateName = null;\n  if (typeof prototype.componentWillMount === 'function') {\n    foundWillMountName = 'componentWillMount';\n  } else if (typeof prototype.UNSAFE_componentWillMount === 'function') {\n    foundWillMountName = 'UNSAFE_componentWillMount';\n  }\n  if (typeof prototype.componentWillReceiveProps === 'function') {\n    foundWillReceivePropsName = 'componentWillReceiveProps';\n  } else if (typeof prototype.UNSAFE_componentWillReceiveProps === 'function') {\n    foundWillReceivePropsName = 'UNSAFE_componentWillReceiveProps';\n  }\n  if (typeof prototype.componentWillUpdate === 'function') {\n    foundWillUpdateName = 'componentWillUpdate';\n  } else if (typeof prototype.UNSAFE_componentWillUpdate === 'function') {\n    foundWillUpdateName = 'UNSAFE_componentWillUpdate';\n  }\n  if (\n    foundWillMountName !== null ||\n    foundWillReceivePropsName !== null ||\n    foundWillUpdateName !== null\n  ) {\n    var componentName = Component.displayName || Component.name;\n    var newApiName =\n      typeof Component.getDerivedStateFromProps === 'function'\n        ? 'getDerivedStateFromProps()'\n        : 'getSnapshotBeforeUpdate()';\n\n    throw Error(\n      'Unsafe legacy lifecycles will not be called for components using new component APIs.\\n\\n' +\n        componentName +\n        ' uses ' +\n        newApiName +\n        ' but also contains the following legacy lifecycles:' +\n        (foundWillMountName !== null ? '\\n  ' + foundWillMountName : '') +\n        (foundWillReceivePropsName !== null\n          ? '\\n  ' + foundWillReceivePropsName\n          : '') +\n        (foundWillUpdateName !== null ? '\\n  ' + foundWillUpdateName : '') +\n        '\\n\\nThe above lifecycles should be removed. Learn more about this warning here:\\n' +\n        'https://fb.me/react-async-component-lifecycle-hooks'\n    );\n  }\n\n  // React <= 16.2 does not support static getDerivedStateFromProps.\n  // As a workaround, use cWM and cWRP to invoke the new static lifecycle.\n  // Newer versions of React will ignore these lifecycles if gDSFP exists.\n  if (typeof Component.getDerivedStateFromProps === 'function') {\n    prototype.componentWillMount = componentWillMount;\n    prototype.componentWillReceiveProps = componentWillReceiveProps;\n  }\n\n  // React <= 16.2 does not support getSnapshotBeforeUpdate.\n  // As a workaround, use cWU to invoke the new lifecycle.\n  // Newer versions of React will ignore that lifecycle if gSBU exists.\n  if (typeof prototype.getSnapshotBeforeUpdate === 'function') {\n    if (typeof prototype.componentDidUpdate !== 'function') {\n      throw new Error(\n        'Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype'\n      );\n    }\n\n    prototype.componentWillUpdate = componentWillUpdate;\n\n    var componentDidUpdate = prototype.componentDidUpdate;\n\n    prototype.componentDidUpdate = function componentDidUpdatePolyfill(\n      prevProps,\n      prevState,\n      maybeSnapshot\n    ) {\n      // 16.3+ will not execute our will-update method;\n      // It will pass a snapshot value to did-update though.\n      // Older versions will require our polyfilled will-update value.\n      // We need to handle both cases, but can't just check for the presence of \"maybeSnapshot\",\n      // Because for <= 15.x versions this might be a \"prevContext\" object.\n      // We also can't just check \"__reactInternalSnapshot\",\n      // Because get-snapshot might return a falsy value.\n      // So check for the explicit __reactInternalSnapshotFlag flag to determine behavior.\n      var snapshot = this.__reactInternalSnapshotFlag\n        ? this.__reactInternalSnapshot\n        : maybeSnapshot;\n\n      componentDidUpdate.call(this, prevProps, prevState, snapshot);\n    };\n  }\n\n  return Component;\n}\n\nexport { polyfill };\n","\"use strict\";\n\nexports.__esModule = true;\nexports.transitionTimeout = transitionTimeout;\nexports.classNamesShape = exports.timeoutsShape = void 0;\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction transitionTimeout(transitionType) {\n  var timeoutPropName = 'transition' + transitionType + 'Timeout';\n  var enabledPropName = 'transition' + transitionType;\n  return function (props) {\n    // If the transition is enabled\n    if (props[enabledPropName]) {\n      // If no timeout duration is provided\n      if (props[timeoutPropName] == null) {\n        return new Error(timeoutPropName + ' wasn\\'t supplied to CSSTransitionGroup: ' + 'this can cause unreliable animations and won\\'t be supported in ' + 'a future version of React. See ' + 'https://fb.me/react-animation-transition-group-timeout for more ' + 'information.'); // If the duration isn't a number\n      } else if (typeof props[timeoutPropName] !== 'number') {\n        return new Error(timeoutPropName + ' must be a number (in milliseconds)');\n      }\n    }\n\n    return null;\n  };\n}\n\nvar timeoutsShape = _propTypes.default.oneOfType([_propTypes.default.number, _propTypes.default.shape({\n  enter: _propTypes.default.number,\n  exit: _propTypes.default.number\n}).isRequired]);\n\nexports.timeoutsShape = timeoutsShape;\n\nvar classNamesShape = _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.shape({\n  enter: _propTypes.default.string,\n  exit: _propTypes.default.string,\n  active: _propTypes.default.string\n}), _propTypes.default.shape({\n  enter: _propTypes.default.string,\n  enterDone: _propTypes.default.string,\n  enterActive: _propTypes.default.string,\n  exit: _propTypes.default.string,\n  exitDone: _propTypes.default.string,\n  exitActive: _propTypes.default.string\n})]);\n\nexports.classNamesShape = classNamesShape;","\"use strict\";\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactLifecyclesCompat = require(\"react-lifecycles-compat\");\n\nvar _ChildMapping = require(\"./utils/ChildMapping\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nvar values = Object.values || function (obj) {\n  return Object.keys(obj).map(function (k) {\n    return obj[k];\n  });\n};\n\nvar propTypes = process.env.NODE_ENV !== \"production\" ? {\n  /**\n   * `<TransitionGroup>` renders a `<div>` by default. You can change this\n   * behavior by providing a `component` prop.\n   * If you use React v16+ and would like to avoid a wrapping `<div>` element\n   * you can pass in `component={null}`. This is useful if the wrapping div\n   * borks your css styles.\n   */\n  component: _propTypes.default.any,\n\n  /**\n   * A set of `<Transition>` components, that are toggled `in` and out as they\n   * leave. the `<TransitionGroup>` will inject specific transition props, so\n   * remember to spread them through if you are wrapping the `<Transition>` as\n   * with our `<Fade>` example.\n   */\n  children: _propTypes.default.node,\n\n  /**\n   * A convenience prop that enables or disables appear animations\n   * for all children. Note that specifying this will override any defaults set\n   * on individual children Transitions.\n   */\n  appear: _propTypes.default.bool,\n\n  /**\n   * A convenience prop that enables or disables enter animations\n   * for all children. Note that specifying this will override any defaults set\n   * on individual children Transitions.\n   */\n  enter: _propTypes.default.bool,\n\n  /**\n   * A convenience prop that enables or disables exit animations\n   * for all children. Note that specifying this will override any defaults set\n   * on individual children Transitions.\n   */\n  exit: _propTypes.default.bool,\n\n  /**\n   * You may need to apply reactive updates to a child as it is exiting.\n   * This is generally done by using `cloneElement` however in the case of an exiting\n   * child the element has already been removed and not accessible to the consumer.\n   *\n   * If you do need to update a child as it leaves you can provide a `childFactory`\n   * to wrap every child, even the ones that are leaving.\n   *\n   * @type Function(child: ReactElement) -> ReactElement\n   */\n  childFactory: _propTypes.default.func\n} : {};;\nvar defaultProps = {\n  component: 'div',\n  childFactory: function childFactory(child) {\n    return child;\n  }\n  /**\n   * The `<TransitionGroup>` component manages a set of transition components\n   * (`<Transition>` and `<CSSTransition>`) in a list. Like with the transition\n   * components, `<TransitionGroup>` is a state machine for managing the mounting\n   * and unmounting of components over time.\n   *\n   * Consider the example below. As items are removed or added to the TodoList the\n   * `in` prop is toggled automatically by the `<TransitionGroup>`.\n   *\n   * Note that `<TransitionGroup>`  does not define any animation behavior!\n   * Exactly _how_ a list item animates is up to the individual transition\n   * component. This means you can mix and match animations across different list\n   * items.\n   */\n\n};\n\nvar TransitionGroup =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(TransitionGroup, _React$Component);\n\n  function TransitionGroup(props, context) {\n    var _this;\n\n    _this = _React$Component.call(this, props, context) || this;\n\n    var handleExited = _this.handleExited.bind(_assertThisInitialized(_assertThisInitialized(_this))); // Initial children should all be entering, dependent on appear\n\n\n    _this.state = {\n      handleExited: handleExited,\n      firstRender: true\n    };\n    return _this;\n  }\n\n  var _proto = TransitionGroup.prototype;\n\n  _proto.getChildContext = function getChildContext() {\n    return {\n      transitionGroup: {\n        isMounting: !this.appeared\n      }\n    };\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    this.appeared = true;\n    this.mounted = true;\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    this.mounted = false;\n  };\n\n  TransitionGroup.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, _ref) {\n    var prevChildMapping = _ref.children,\n        handleExited = _ref.handleExited,\n        firstRender = _ref.firstRender;\n    return {\n      children: firstRender ? (0, _ChildMapping.getInitialChildMapping)(nextProps, handleExited) : (0, _ChildMapping.getNextChildMapping)(nextProps, prevChildMapping, handleExited),\n      firstRender: false\n    };\n  };\n\n  _proto.handleExited = function handleExited(child, node) {\n    var currentChildMapping = (0, _ChildMapping.getChildMapping)(this.props.children);\n    if (child.key in currentChildMapping) return;\n\n    if (child.props.onExited) {\n      child.props.onExited(node);\n    }\n\n    if (this.mounted) {\n      this.setState(function (state) {\n        var children = _extends({}, state.children);\n\n        delete children[child.key];\n        return {\n          children: children\n        };\n      });\n    }\n  };\n\n  _proto.render = function render() {\n    var _this$props = this.props,\n        Component = _this$props.component,\n        childFactory = _this$props.childFactory,\n        props = _objectWithoutPropertiesLoose(_this$props, [\"component\", \"childFactory\"]);\n\n    var children = values(this.state.children).map(childFactory);\n    delete props.appear;\n    delete props.enter;\n    delete props.exit;\n\n    if (Component === null) {\n      return children;\n    }\n\n    return _react.default.createElement(Component, props, children);\n  };\n\n  return TransitionGroup;\n}(_react.default.Component);\n\nTransitionGroup.childContextTypes = {\n  transitionGroup: _propTypes.default.object.isRequired\n};\nTransitionGroup.propTypes = process.env.NODE_ENV !== \"production\" ? propTypes : {};\nTransitionGroup.defaultProps = defaultProps;\n\nvar _default = (0, _reactLifecyclesCompat.polyfill)(TransitionGroup);\n\nexports.default = _default;\nmodule.exports = exports[\"default\"];","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  InstantiationMode,\n  InstanceFactory,\n  ComponentType,\n  Dictionary,\n  Name\n} from './types';\n\n/**\n * Component for service name T, e.g. `auth`, `auth-internal`\n */\nexport class Component<T extends Name = Name> {\n  multipleInstances = false;\n  /**\n   * Properties to be added to the service namespace\n   */\n  serviceProps: Dictionary = {};\n\n  instantiationMode = InstantiationMode.LAZY;\n\n  /**\n   *\n   * @param name The public service name, e.g. app, auth, firestore, database\n   * @param instanceFactory Service factory responsible for creating the public interface\n   * @param type whehter the service provided by the component is public or private\n   */\n  constructor(\n    readonly name: T,\n    readonly instanceFactory: InstanceFactory<T>,\n    readonly type: ComponentType\n  ) {}\n\n  setInstantiationMode(mode: InstantiationMode): this {\n    this.instantiationMode = mode;\n    return this;\n  }\n\n  setMultipleInstances(multipleInstances: boolean): this {\n    this.multipleInstances = multipleInstances;\n    return this;\n  }\n\n  setServiceProps(props: Dictionary): this {\n    this.serviceProps = props;\n    return this;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Deferred } from '@firebase/util';\nimport { ComponentContainer } from './component_container';\nimport { DEFAULT_ENTRY_NAME } from './constants';\nimport { InstantiationMode, Name, NameServiceMapping } from './types';\nimport { Component } from './component';\n\n/**\n * Provider for instance for service name T, e.g. 'auth', 'auth-internal'\n * NameServiceMapping[T] is an alias for the type of the instance\n */\nexport class Provider<T extends Name> {\n  private component: Component<T> | null = null;\n  private readonly instances: Map<string, NameServiceMapping[T]> = new Map();\n  private readonly instancesDeferred: Map<\n    string,\n    Deferred<NameServiceMapping[T]>\n  > = new Map();\n\n  constructor(\n    private readonly name: T,\n    private readonly container: ComponentContainer\n  ) {}\n\n  /**\n   * @param identifier A provider can provide mulitple instances of a service\n   * if this.component.multipleInstances is true.\n   */\n  get(identifier: string = DEFAULT_ENTRY_NAME): Promise<NameServiceMapping[T]> {\n    // if multipleInstances is not supported, use the default name\n    const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\n\n    if (!this.instancesDeferred.has(normalizedIdentifier)) {\n      const deferred = new Deferred<NameServiceMapping[T]>();\n      this.instancesDeferred.set(normalizedIdentifier, deferred);\n      // If the service instance is available, resolve the promise with it immediately\n      try {\n        const instance = this.getOrInitializeService(normalizedIdentifier);\n        if (instance) {\n          deferred.resolve(instance);\n        }\n      } catch (e) {\n        // when the instance factory throws an exception during get(), it should not cause\n        // a fatal error. We just return the unresolved promise in this case.\n      }\n    }\n\n    return this.instancesDeferred.get(normalizedIdentifier)!.promise;\n  }\n\n  /**\n   *\n   * @param options.identifier A provider can provide mulitple instances of a service\n   * if this.component.multipleInstances is true.\n   * @param options.optional If optional is false or not provided, the method throws an error when\n   * the service is not immediately available.\n   * If optional is true, the method returns null if the service is not immediately available.\n   */\n  getImmediate(options: {\n    identifier?: string;\n    optional: true;\n  }): NameServiceMapping[T] | null;\n  getImmediate(options?: {\n    identifier?: string;\n    optional?: false;\n  }): NameServiceMapping[T];\n  getImmediate(options?: {\n    identifier?: string;\n    optional?: boolean;\n  }): NameServiceMapping[T] | null {\n    const { identifier, optional } = {\n      identifier: DEFAULT_ENTRY_NAME,\n      optional: false,\n      ...options\n    };\n    // if multipleInstances is not supported, use the default name\n    const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\n    try {\n      const instance = this.getOrInitializeService(normalizedIdentifier);\n\n      if (!instance) {\n        if (optional) {\n          return null;\n        }\n        throw Error(`Service ${this.name} is not available`);\n      }\n      return instance;\n    } catch (e) {\n      if (optional) {\n        return null;\n      } else {\n        throw e;\n      }\n    }\n  }\n\n  getComponent(): Component<T> | null {\n    return this.component;\n  }\n\n  setComponent(component: Component<T>): void {\n    if (component.name !== this.name) {\n      throw Error(\n        `Mismatching Component ${component.name} for Provider ${this.name}.`\n      );\n    }\n\n    if (this.component) {\n      throw Error(`Component for ${this.name} has already been provided`);\n    }\n\n    this.component = component;\n    // if the service is eager, initialize the default instance\n    if (isComponentEager(component)) {\n      try {\n        this.getOrInitializeService(DEFAULT_ENTRY_NAME);\n      } catch (e) {\n        // when the instance factory for an eager Component throws an exception during the eager\n        // initialization, it should not cause a fatal error.\n        // TODO: Investigate if we need to make it configurable, because some component may want to cause\n        // a fatal error in this case?\n      }\n    }\n\n    // Create service instances for the pending promises and resolve them\n    // NOTE: if this.multipleInstances is false, only the default instance will be created\n    // and all promises with resolve with it regardless of the identifier.\n    for (const [\n      instanceIdentifier,\n      instanceDeferred\n    ] of this.instancesDeferred.entries()) {\n      const normalizedIdentifier = this.normalizeInstanceIdentifier(\n        instanceIdentifier\n      );\n\n      try {\n        // `getOrInitializeService()` should always return a valid instance since a component is guaranteed. use ! to make typescript happy.\n        const instance = this.getOrInitializeService(normalizedIdentifier)!;\n        instanceDeferred.resolve(instance);\n      } catch (e) {\n        // when the instance factory throws an exception, it should not cause\n        // a fatal error. We just leave the promise unresolved.\n      }\n    }\n  }\n\n  clearInstance(identifier: string = DEFAULT_ENTRY_NAME): void {\n    this.instancesDeferred.delete(identifier);\n    this.instances.delete(identifier);\n  }\n\n  // app.delete() will call this method on every provider to delete the services\n  // TODO: should we mark the provider as deleted?\n  async delete(): Promise<void> {\n    const services = Array.from(this.instances.values());\n\n    await Promise.all(\n      services\n        .filter(service => 'INTERNAL' in service)\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        .map(service => (service as any).INTERNAL!.delete())\n    );\n  }\n\n  isComponentSet(): boolean {\n    return this.component != null;\n  }\n\n  private getOrInitializeService(\n    identifier: string\n  ): NameServiceMapping[T] | null {\n    let instance = this.instances.get(identifier);\n    if (!instance && this.component) {\n      instance = this.component.instanceFactory(\n        this.container,\n        normalizeIdentifierForFactory(identifier)\n      ) as NameServiceMapping[T];\n      this.instances.set(identifier, instance);\n    }\n\n    return instance || null;\n  }\n\n  private normalizeInstanceIdentifier(identifier: string): string {\n    if (this.component) {\n      return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME;\n    } else {\n      return identifier; // assume multiple instances are supported before the component is provided.\n    }\n  }\n}\n\n// undefined should be passed to the service factory for the default instance\nfunction normalizeIdentifierForFactory(identifier: string): string | undefined {\n  return identifier === DEFAULT_ENTRY_NAME ? undefined : identifier;\n}\n\nfunction isComponentEager(component: Component<Name>): boolean {\n  return component.instantiationMode === InstantiationMode.EAGER;\n}\n","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Provider } from './provider';\nimport { Component } from './component';\nimport { Name } from './types';\n\n/**\n * ComponentContainer that provides Providers for service name T, e.g. `auth`, `auth-internal`\n */\nexport class ComponentContainer {\n  private readonly providers = new Map<string, Provider<Name>>();\n\n  constructor(private readonly name: string) {}\n\n  /**\n   *\n   * @param component Component being added\n   * @param overwrite When a component with the same name has already been registered,\n   * if overwrite is true: overwrite the existing component with the new component and create a new\n   * provider with the new component. It can be useful in tests where you want to use different mocks\n   * for different tests.\n   * if overwrite is false: throw an exception\n   */\n  addComponent<T extends Name>(component: Component<T>): void {\n    const provider = this.getProvider(component.name);\n    if (provider.isComponentSet()) {\n      throw new Error(\n        `Component ${component.name} has already been registered with ${this.name}`\n      );\n    }\n\n    provider.setComponent(component);\n  }\n\n  addOrOverwriteComponent<T extends Name>(component: Component<T>): void {\n    const provider = this.getProvider(component.name);\n    if (provider.isComponentSet()) {\n      // delete the existing provider from the container, so we can register the new component\n      this.providers.delete(component.name);\n    }\n\n    this.addComponent(component);\n  }\n\n  /**\n   * getProvider provides a type safe interface where it can only be called with a field name\n   * present in NameServiceMapping interface.\n   *\n   * Firebase SDKs providing services should extend NameServiceMapping interface to register\n   * themselves.\n   */\n  getProvider<T extends Name>(name: T): Provider<T> {\n    if (this.providers.has(name)) {\n      return this.providers.get(name) as Provider<T>;\n    }\n\n    // create a Provider for a service that hasn't registered with Firebase\n    const provider = new Provider<T>(name, this);\n    this.providers.set(name, provider);\n\n    return provider as Provider<T>;\n  }\n\n  getProviders(): Array<Provider<Name>> {\n    return Array.from(this.providers.values());\n  }\n}\n","module.exports = require('./dist/bundle.js');\n\n","var isarray = require('isarray')\n\n/**\n * Expose `pathToRegexp`.\n */\nmodule.exports = pathToRegexp\nmodule.exports.parse = parse\nmodule.exports.compile = compile\nmodule.exports.tokensToFunction = tokensToFunction\nmodule.exports.tokensToRegExp = tokensToRegExp\n\n/**\n * The main path matching regexp utility.\n *\n * @type {RegExp}\n */\nvar PATH_REGEXP = new RegExp([\n  // Match escaped characters that would otherwise appear in future matches.\n  // This allows the user to escape special characters that won't transform.\n  '(\\\\\\\\.)',\n  // Match Express-style parameters and un-named parameters with a prefix\n  // and optional suffixes. Matches appear as:\n  //\n  // \"/:test(\\\\d+)?\" => [\"/\", \"test\", \"\\d+\", undefined, \"?\", undefined]\n  // \"/route(\\\\d+)\"  => [undefined, undefined, undefined, \"\\d+\", undefined, undefined]\n  // \"/*\"            => [\"/\", undefined, undefined, undefined, undefined, \"*\"]\n  '([\\\\/.])?(?:(?:\\\\:(\\\\w+)(?:\\\\(((?:\\\\\\\\.|[^\\\\\\\\()])+)\\\\))?|\\\\(((?:\\\\\\\\.|[^\\\\\\\\()])+)\\\\))([+*?])?|(\\\\*))'\n].join('|'), 'g')\n\n/**\n * Parse a string for the raw tokens.\n *\n * @param  {string}  str\n * @param  {Object=} options\n * @return {!Array}\n */\nfunction parse (str, options) {\n  var tokens = []\n  var key = 0\n  var index = 0\n  var path = ''\n  var defaultDelimiter = options && options.delimiter || '/'\n  var res\n\n  while ((res = PATH_REGEXP.exec(str)) != null) {\n    var m = res[0]\n    var escaped = res[1]\n    var offset = res.index\n    path += str.slice(index, offset)\n    index = offset + m.length\n\n    // Ignore already escaped sequences.\n    if (escaped) {\n      path += escaped[1]\n      continue\n    }\n\n    var next = str[index]\n    var prefix = res[2]\n    var name = res[3]\n    var capture = res[4]\n    var group = res[5]\n    var modifier = res[6]\n    var asterisk = res[7]\n\n    // Push the current path onto the tokens.\n    if (path) {\n      tokens.push(path)\n      path = ''\n    }\n\n    var partial = prefix != null && next != null && next !== prefix\n    var repeat = modifier === '+' || modifier === '*'\n    var optional = modifier === '?' || modifier === '*'\n    var delimiter = res[2] || defaultDelimiter\n    var pattern = capture || group\n\n    tokens.push({\n      name: name || key++,\n      prefix: prefix || '',\n      delimiter: delimiter,\n      optional: optional,\n      repeat: repeat,\n      partial: partial,\n      asterisk: !!asterisk,\n      pattern: pattern ? escapeGroup(pattern) : (asterisk ? '.*' : '[^' + escapeString(delimiter) + ']+?')\n    })\n  }\n\n  // Match any characters still remaining.\n  if (index < str.length) {\n    path += str.substr(index)\n  }\n\n  // If the path exists, push it onto the end.\n  if (path) {\n    tokens.push(path)\n  }\n\n  return tokens\n}\n\n/**\n * Compile a string to a template function for the path.\n *\n * @param  {string}             str\n * @param  {Object=}            options\n * @return {!function(Object=, Object=)}\n */\nfunction compile (str, options) {\n  return tokensToFunction(parse(str, options))\n}\n\n/**\n * Prettier encoding of URI path segments.\n *\n * @param  {string}\n * @return {string}\n */\nfunction encodeURIComponentPretty (str) {\n  return encodeURI(str).replace(/[\\/?#]/g, function (c) {\n    return '%' + c.charCodeAt(0).toString(16).toUpperCase()\n  })\n}\n\n/**\n * Encode the asterisk parameter. Similar to `pretty`, but allows slashes.\n *\n * @param  {string}\n * @return {string}\n */\nfunction encodeAsterisk (str) {\n  return encodeURI(str).replace(/[?#]/g, function (c) {\n    return '%' + c.charCodeAt(0).toString(16).toUpperCase()\n  })\n}\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nfunction tokensToFunction (tokens) {\n  // Compile all the tokens into regexps.\n  var matches = new Array(tokens.length)\n\n  // Compile all the patterns before compilation.\n  for (var i = 0; i < tokens.length; i++) {\n    if (typeof tokens[i] === 'object') {\n      matches[i] = new RegExp('^(?:' + tokens[i].pattern + ')$')\n    }\n  }\n\n  return function (obj, opts) {\n    var path = ''\n    var data = obj || {}\n    var options = opts || {}\n    var encode = options.pretty ? encodeURIComponentPretty : encodeURIComponent\n\n    for (var i = 0; i < tokens.length; i++) {\n      var token = tokens[i]\n\n      if (typeof token === 'string') {\n        path += token\n\n        continue\n      }\n\n      var value = data[token.name]\n      var segment\n\n      if (value == null) {\n        if (token.optional) {\n          // Prepend partial segment prefixes.\n          if (token.partial) {\n            path += token.prefix\n          }\n\n          continue\n        } else {\n          throw new TypeError('Expected \"' + token.name + '\" to be defined')\n        }\n      }\n\n      if (isarray(value)) {\n        if (!token.repeat) {\n          throw new TypeError('Expected \"' + token.name + '\" to not repeat, but received `' + JSON.stringify(value) + '`')\n        }\n\n        if (value.length === 0) {\n          if (token.optional) {\n            continue\n          } else {\n            throw new TypeError('Expected \"' + token.name + '\" to not be empty')\n          }\n        }\n\n        for (var j = 0; j < value.length; j++) {\n          segment = encode(value[j])\n\n          if (!matches[i].test(segment)) {\n            throw new TypeError('Expected all \"' + token.name + '\" to match \"' + token.pattern + '\", but received `' + JSON.stringify(segment) + '`')\n          }\n\n          path += (j === 0 ? token.prefix : token.delimiter) + segment\n        }\n\n        continue\n      }\n\n      segment = token.asterisk ? encodeAsterisk(value) : encode(value)\n\n      if (!matches[i].test(segment)) {\n        throw new TypeError('Expected \"' + token.name + '\" to match \"' + token.pattern + '\", but received \"' + segment + '\"')\n      }\n\n      path += token.prefix + segment\n    }\n\n    return path\n  }\n}\n\n/**\n * Escape a regular expression string.\n *\n * @param  {string} str\n * @return {string}\n */\nfunction escapeString (str) {\n  return str.replace(/([.+*?=^!:${}()[\\]|\\/\\\\])/g, '\\\\$1')\n}\n\n/**\n * Escape the capturing group by escaping special characters and meaning.\n *\n * @param  {string} group\n * @return {string}\n */\nfunction escapeGroup (group) {\n  return group.replace(/([=!:$\\/()])/g, '\\\\$1')\n}\n\n/**\n * Attach the keys as a property of the regexp.\n *\n * @param  {!RegExp} re\n * @param  {Array}   keys\n * @return {!RegExp}\n */\nfunction attachKeys (re, keys) {\n  re.keys = keys\n  return re\n}\n\n/**\n * Get the flags for a regexp from the options.\n *\n * @param  {Object} options\n * @return {string}\n */\nfunction flags (options) {\n  return options.sensitive ? '' : 'i'\n}\n\n/**\n * Pull out keys from a regexp.\n *\n * @param  {!RegExp} path\n * @param  {!Array}  keys\n * @return {!RegExp}\n */\nfunction regexpToRegexp (path, keys) {\n  // Use a negative lookahead to match only capturing groups.\n  var groups = path.source.match(/\\((?!\\?)/g)\n\n  if (groups) {\n    for (var i = 0; i < groups.length; i++) {\n      keys.push({\n        name: i,\n        prefix: null,\n        delimiter: null,\n        optional: false,\n        repeat: false,\n        partial: false,\n        asterisk: false,\n        pattern: null\n      })\n    }\n  }\n\n  return attachKeys(path, keys)\n}\n\n/**\n * Transform an array into a regexp.\n *\n * @param  {!Array}  path\n * @param  {Array}   keys\n * @param  {!Object} options\n * @return {!RegExp}\n */\nfunction arrayToRegexp (path, keys, options) {\n  var parts = []\n\n  for (var i = 0; i < path.length; i++) {\n    parts.push(pathToRegexp(path[i], keys, options).source)\n  }\n\n  var regexp = new RegExp('(?:' + parts.join('|') + ')', flags(options))\n\n  return attachKeys(regexp, keys)\n}\n\n/**\n * Create a path regexp from string input.\n *\n * @param  {string}  path\n * @param  {!Array}  keys\n * @param  {!Object} options\n * @return {!RegExp}\n */\nfunction stringToRegexp (path, keys, options) {\n  return tokensToRegExp(parse(path, options), keys, options)\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n *\n * @param  {!Array}          tokens\n * @param  {(Array|Object)=} keys\n * @param  {Object=}         options\n * @return {!RegExp}\n */\nfunction tokensToRegExp (tokens, keys, options) {\n  if (!isarray(keys)) {\n    options = /** @type {!Object} */ (keys || options)\n    keys = []\n  }\n\n  options = options || {}\n\n  var strict = options.strict\n  var end = options.end !== false\n  var route = ''\n\n  // Iterate over the tokens and create our regexp string.\n  for (var i = 0; i < tokens.length; i++) {\n    var token = tokens[i]\n\n    if (typeof token === 'string') {\n      route += escapeString(token)\n    } else {\n      var prefix = escapeString(token.prefix)\n      var capture = '(?:' + token.pattern + ')'\n\n      keys.push(token)\n\n      if (token.repeat) {\n        capture += '(?:' + prefix + capture + ')*'\n      }\n\n      if (token.optional) {\n        if (!token.partial) {\n          capture = '(?:' + prefix + '(' + capture + '))?'\n        } else {\n          capture = prefix + '(' + capture + ')?'\n        }\n      } else {\n        capture = prefix + '(' + capture + ')'\n      }\n\n      route += capture\n    }\n  }\n\n  var delimiter = escapeString(options.delimiter || '/')\n  var endsWithDelimiter = route.slice(-delimiter.length) === delimiter\n\n  // In non-strict mode we allow a slash at the end of match. If the path to\n  // match already ends with a slash, we remove it for consistency. The slash\n  // is valid at the end of a path match, not in the middle. This is important\n  // in non-ending mode, where \"/test/\" shouldn't match \"/test//route\".\n  if (!strict) {\n    route = (endsWithDelimiter ? route.slice(0, -delimiter.length) : route) + '(?:' + delimiter + '(?=$))?'\n  }\n\n  if (end) {\n    route += '$'\n  } else {\n    // In non-ending mode, we need the capturing groups to match as much as\n    // possible by using a positive lookahead to the end or next path segment.\n    route += strict && endsWithDelimiter ? '' : '(?=' + delimiter + '|$)'\n  }\n\n  return attachKeys(new RegExp('^' + route, flags(options)), keys)\n}\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n *\n * @param  {(string|RegExp|Array)} path\n * @param  {(Array|Object)=}       keys\n * @param  {Object=}               options\n * @return {!RegExp}\n */\nfunction pathToRegexp (path, keys, options) {\n  if (!isarray(keys)) {\n    options = /** @type {!Object} */ (keys || options)\n    keys = []\n  }\n\n  options = options || {}\n\n  if (path instanceof RegExp) {\n    return regexpToRegexp(path, /** @type {!Array} */ (keys))\n  }\n\n  if (isarray(path)) {\n    return arrayToRegexp(/** @type {!Array} */ (path), /** @type {!Array} */ (keys), options)\n  }\n\n  return stringToRegexp(/** @type {string} */ (path), /** @type {!Array} */ (keys), options)\n}\n","/** @license React v16.6.1\n * react.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';var k=require(\"object-assign\"),n=\"function\"===typeof Symbol&&Symbol.for,p=n?Symbol.for(\"react.element\"):60103,q=n?Symbol.for(\"react.portal\"):60106,r=n?Symbol.for(\"react.fragment\"):60107,t=n?Symbol.for(\"react.strict_mode\"):60108,u=n?Symbol.for(\"react.profiler\"):60114,v=n?Symbol.for(\"react.provider\"):60109,w=n?Symbol.for(\"react.context\"):60110,x=n?Symbol.for(\"react.concurrent_mode\"):60111,y=n?Symbol.for(\"react.forward_ref\"):60112,z=n?Symbol.for(\"react.suspense\"):60113,A=n?Symbol.for(\"react.memo\"):\n60115,B=n?Symbol.for(\"react.lazy\"):60116,C=\"function\"===typeof Symbol&&Symbol.iterator;function aa(a,b,e,c,d,g,h,f){if(!a){a=void 0;if(void 0===b)a=Error(\"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.\");else{var l=[e,c,d,g,h,f],m=0;a=Error(b.replace(/%s/g,function(){return l[m++]}));a.name=\"Invariant Violation\"}a.framesToPop=1;throw a;}}\nfunction D(a){for(var b=arguments.length-1,e=\"https://reactjs.org/docs/error-decoder.html?invariant=\"+a,c=0;c<b;c++)e+=\"&args[]=\"+encodeURIComponent(arguments[c+1]);aa(!1,\"Minified React error #\"+a+\"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. \",e)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},F={};\nfunction G(a,b,e){this.props=a;this.context=b;this.refs=F;this.updater=e||E}G.prototype.isReactComponent={};G.prototype.setState=function(a,b){\"object\"!==typeof a&&\"function\"!==typeof a&&null!=a?D(\"85\"):void 0;this.updater.enqueueSetState(this,a,b,\"setState\")};G.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,\"forceUpdate\")};function H(){}H.prototype=G.prototype;function I(a,b,e){this.props=a;this.context=b;this.refs=F;this.updater=e||E}var J=I.prototype=new H;\nJ.constructor=I;k(J,G.prototype);J.isPureReactComponent=!0;var K={current:null,currentDispatcher:null},L=Object.prototype.hasOwnProperty,M={key:!0,ref:!0,__self:!0,__source:!0};\nfunction N(a,b,e){var c=void 0,d={},g=null,h=null;if(null!=b)for(c in void 0!==b.ref&&(h=b.ref),void 0!==b.key&&(g=\"\"+b.key),b)L.call(b,c)&&!M.hasOwnProperty(c)&&(d[c]=b[c]);var f=arguments.length-2;if(1===f)d.children=e;else if(1<f){for(var l=Array(f),m=0;m<f;m++)l[m]=arguments[m+2];d.children=l}if(a&&a.defaultProps)for(c in f=a.defaultProps,f)void 0===d[c]&&(d[c]=f[c]);return{$$typeof:p,type:a,key:g,ref:h,props:d,_owner:K.current}}\nfunction ba(a,b){return{$$typeof:p,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function O(a){return\"object\"===typeof a&&null!==a&&a.$$typeof===p}function escape(a){var b={\"=\":\"=0\",\":\":\"=2\"};return\"$\"+(\"\"+a).replace(/[=:]/g,function(a){return b[a]})}var P=/\\/+/g,Q=[];function R(a,b,e,c){if(Q.length){var d=Q.pop();d.result=a;d.keyPrefix=b;d.func=e;d.context=c;d.count=0;return d}return{result:a,keyPrefix:b,func:e,context:c,count:0}}\nfunction S(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>Q.length&&Q.push(a)}\nfunction T(a,b,e,c){var d=typeof a;if(\"undefined\"===d||\"boolean\"===d)a=null;var g=!1;if(null===a)g=!0;else switch(d){case \"string\":case \"number\":g=!0;break;case \"object\":switch(a.$$typeof){case p:case q:g=!0}}if(g)return e(c,a,\"\"===b?\".\"+U(a,0):b),1;g=0;b=\"\"===b?\".\":b+\":\";if(Array.isArray(a))for(var h=0;h<a.length;h++){d=a[h];var f=b+U(d,h);g+=T(d,f,e,c)}else if(null===a||\"object\"!==typeof a?f=null:(f=C&&a[C]||a[\"@@iterator\"],f=\"function\"===typeof f?f:null),\"function\"===typeof f)for(a=f.call(a),h=\n0;!(d=a.next()).done;)d=d.value,f=b+U(d,h++),g+=T(d,f,e,c);else\"object\"===d&&(e=\"\"+a,D(\"31\",\"[object Object]\"===e?\"object with keys {\"+Object.keys(a).join(\", \")+\"}\":e,\"\"));return g}function V(a,b,e){return null==a?0:T(a,\"\",b,e)}function U(a,b){return\"object\"===typeof a&&null!==a&&null!=a.key?escape(a.key):b.toString(36)}function ca(a,b){a.func.call(a.context,b,a.count++)}\nfunction da(a,b,e){var c=a.result,d=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?W(a,c,e,function(a){return a}):null!=a&&(O(a)&&(a=ba(a,d+(!a.key||b&&b.key===a.key?\"\":(\"\"+a.key).replace(P,\"$&/\")+\"/\")+e)),c.push(a))}function W(a,b,e,c,d){var g=\"\";null!=e&&(g=(\"\"+e).replace(P,\"$&/\")+\"/\");b=R(b,g,c,d);V(a,da,b);S(b)}\nvar X={Children:{map:function(a,b,e){if(null==a)return a;var c=[];W(a,c,null,b,e);return c},forEach:function(a,b,e){if(null==a)return a;b=R(null,null,b,e);V(a,ca,b);S(b)},count:function(a){return V(a,function(){return null},null)},toArray:function(a){var b=[];W(a,b,null,function(a){return a});return b},only:function(a){O(a)?void 0:D(\"143\");return a}},createRef:function(){return{current:null}},Component:G,PureComponent:I,createContext:function(a,b){void 0===b&&(b=null);a={$$typeof:w,_calculateChangedBits:b,\n_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:v,_context:a};return a.Consumer=a},forwardRef:function(a){return{$$typeof:y,render:a}},lazy:function(a){return{$$typeof:B,_ctor:a,_status:-1,_result:null}},memo:function(a,b){return{$$typeof:A,type:a,compare:void 0===b?null:b}},Fragment:r,StrictMode:t,Suspense:z,createElement:N,cloneElement:function(a,b,e){null===a||void 0===a?D(\"267\",a):void 0;var c=void 0,d=k({},a.props),g=a.key,h=a.ref,f=a._owner;\nif(null!=b){void 0!==b.ref&&(h=b.ref,f=K.current);void 0!==b.key&&(g=\"\"+b.key);var l=void 0;a.type&&a.type.defaultProps&&(l=a.type.defaultProps);for(c in b)L.call(b,c)&&!M.hasOwnProperty(c)&&(d[c]=void 0===b[c]&&void 0!==l?l[c]:b[c])}c=arguments.length-2;if(1===c)d.children=e;else if(1<c){l=Array(c);for(var m=0;m<c;m++)l[m]=arguments[m+2];d.children=l}return{$$typeof:p,type:a.type,key:g,ref:h,props:d,_owner:f}},createFactory:function(a){var b=N.bind(null,a);b.type=a;return b},isValidElement:O,version:\"16.6.3\",\n__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:K,assign:k}};X.unstable_ConcurrentMode=x;X.unstable_Profiler=u;var Y={default:X},Z=Y&&X||Y;module.exports=Z.default||Z;\n","/** @license React v16.6.1\n * react-dom.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n/*\n Modernizr 3.0.0pre (Custom Build) | MIT\n*/\n'use strict';var aa=require(\"react\"),n=require(\"object-assign\"),ba=require(\"scheduler\");function ca(a,b,c,d,e,f,g,h){if(!a){a=void 0;if(void 0===b)a=Error(\"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.\");else{var k=[c,d,e,f,g,h],l=0;a=Error(b.replace(/%s/g,function(){return k[l++]}));a.name=\"Invariant Violation\"}a.framesToPop=1;throw a;}}\nfunction t(a){for(var b=arguments.length-1,c=\"https://reactjs.org/docs/error-decoder.html?invariant=\"+a,d=0;d<b;d++)c+=\"&args[]=\"+encodeURIComponent(arguments[d+1]);ca(!1,\"Minified React error #\"+a+\"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. \",c)}aa?void 0:t(\"227\");function da(a,b,c,d,e,f,g,h,k){var l=Array.prototype.slice.call(arguments,3);try{b.apply(c,l)}catch(m){this.onError(m)}}\nvar ea=!1,fa=null,ha=!1,ia=null,ja={onError:function(a){ea=!0;fa=a}};function ka(a,b,c,d,e,f,g,h,k){ea=!1;fa=null;da.apply(ja,arguments)}function la(a,b,c,d,e,f,g,h,k){ka.apply(this,arguments);if(ea){if(ea){var l=fa;ea=!1;fa=null}else t(\"198\"),l=void 0;ha||(ha=!0,ia=l)}}var ma=null,na={};\nfunction oa(){if(ma)for(var a in na){var b=na[a],c=ma.indexOf(a);-1<c?void 0:t(\"96\",a);if(!pa[c]){b.extractEvents?void 0:t(\"97\",a);pa[c]=b;c=b.eventTypes;for(var d in c){var e=void 0;var f=c[d],g=b,h=d;qa.hasOwnProperty(h)?t(\"99\",h):void 0;qa[h]=f;var k=f.phasedRegistrationNames;if(k){for(e in k)k.hasOwnProperty(e)&&ra(k[e],g,h);e=!0}else f.registrationName?(ra(f.registrationName,g,h),e=!0):e=!1;e?void 0:t(\"98\",d,a)}}}}\nfunction ra(a,b,c){sa[a]?t(\"100\",a):void 0;sa[a]=b;ta[a]=b.eventTypes[c].dependencies}var pa=[],qa={},sa={},ta={},ua=null,va=null,wa=null;function xa(a,b,c){var d=a.type||\"unknown-event\";a.currentTarget=wa(c);la(d,b,void 0,a);a.currentTarget=null}function ya(a,b){null==b?t(\"30\"):void 0;if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}\nfunction za(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}var Aa=null;function Ba(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)xa(a,b[d],c[d]);else b&&xa(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}}\nvar Ca={injectEventPluginOrder:function(a){ma?t(\"101\"):void 0;ma=Array.prototype.slice.call(a);oa()},injectEventPluginsByName:function(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];na.hasOwnProperty(c)&&na[c]===d||(na[c]?t(\"102\",c):void 0,na[c]=d,b=!0)}b&&oa()}};\nfunction Da(a,b){var c=a.stateNode;if(!c)return null;var d=ua(c);if(!d)return null;c=d[b];a:switch(b){case \"onClick\":case \"onClickCapture\":case \"onDoubleClick\":case \"onDoubleClickCapture\":case \"onMouseDown\":case \"onMouseDownCapture\":case \"onMouseMove\":case \"onMouseMoveCapture\":case \"onMouseUp\":case \"onMouseUpCapture\":(d=!d.disabled)||(a=a.type,d=!(\"button\"===a||\"input\"===a||\"select\"===a||\"textarea\"===a));a=!d;break a;default:a=!1}if(a)return null;c&&\"function\"!==typeof c?t(\"231\",b,typeof c):void 0;\nreturn c}function Ea(a){null!==a&&(Aa=ya(Aa,a));a=Aa;Aa=null;if(a&&(za(a,Ba),Aa?t(\"95\"):void 0,ha))throw a=ia,ha=!1,ia=null,a;}var Fa=Math.random().toString(36).slice(2),Ga=\"__reactInternalInstance$\"+Fa,Ha=\"__reactEventHandlers$\"+Fa;function Ia(a){if(a[Ga])return a[Ga];for(;!a[Ga];)if(a.parentNode)a=a.parentNode;else return null;a=a[Ga];return 5===a.tag||6===a.tag?a:null}function Ja(a){a=a[Ga];return!a||5!==a.tag&&6!==a.tag?null:a}\nfunction Ka(a){if(5===a.tag||6===a.tag)return a.stateNode;t(\"33\")}function La(a){return a[Ha]||null}function Ma(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function Na(a,b,c){if(b=Da(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=ya(c._dispatchListeners,b),c._dispatchInstances=ya(c._dispatchInstances,a)}\nfunction Oa(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=Ma(b);for(b=c.length;0<b--;)Na(c[b],\"captured\",a);for(b=0;b<c.length;b++)Na(c[b],\"bubbled\",a)}}function Pa(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=Da(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=ya(c._dispatchListeners,b),c._dispatchInstances=ya(c._dispatchInstances,a))}function Qa(a){a&&a.dispatchConfig.registrationName&&Pa(a._targetInst,null,a)}\nfunction Ra(a){za(a,Oa)}var Sa=!(\"undefined\"===typeof window||!window.document||!window.document.createElement);function Ta(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c[\"Webkit\"+a]=\"webkit\"+b;c[\"Moz\"+a]=\"moz\"+b;return c}var Ua={animationend:Ta(\"Animation\",\"AnimationEnd\"),animationiteration:Ta(\"Animation\",\"AnimationIteration\"),animationstart:Ta(\"Animation\",\"AnimationStart\"),transitionend:Ta(\"Transition\",\"TransitionEnd\")},Va={},Wa={};\nSa&&(Wa=document.createElement(\"div\").style,\"AnimationEvent\"in window||(delete Ua.animationend.animation,delete Ua.animationiteration.animation,delete Ua.animationstart.animation),\"TransitionEvent\"in window||delete Ua.transitionend.transition);function Xa(a){if(Va[a])return Va[a];if(!Ua[a])return a;var b=Ua[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Wa)return Va[a]=b[c];return a}\nvar Ya=Xa(\"animationend\"),Za=Xa(\"animationiteration\"),$a=Xa(\"animationstart\"),ab=Xa(\"transitionend\"),bb=\"abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting\".split(\" \"),cb=null,eb=null,fb=null;\nfunction gb(){if(fb)return fb;var a,b=eb,c=b.length,d,e=\"value\"in cb?cb.value:cb.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return fb=e.slice(a,1<d?1-d:void 0)}function hb(){return!0}function ib(){return!1}\nfunction A(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):\"target\"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?hb:ib;this.isPropagationStopped=ib;return this}\nn(A.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():\"unknown\"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=hb)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():\"unknown\"!==typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=hb)},persist:function(){this.isPersistent=hb},isPersistent:ib,destructor:function(){var a=this.constructor.Interface,\nb;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=ib;this._dispatchInstances=this._dispatchListeners=null}});A.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};\nA.extend=function(a){function b(){}function c(){return d.apply(this,arguments)}var d=this;b.prototype=d.prototype;var e=new b;n(e,c.prototype);c.prototype=e;c.prototype.constructor=c;c.Interface=n({},d.Interface,a);c.extend=d.extend;jb(c);return c};jb(A);function kb(a,b,c,d){if(this.eventPool.length){var e=this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function lb(a){a instanceof this?void 0:t(\"279\");a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}\nfunction jb(a){a.eventPool=[];a.getPooled=kb;a.release=lb}var mb=A.extend({data:null}),nb=A.extend({data:null}),ob=[9,13,27,32],pb=Sa&&\"CompositionEvent\"in window,qb=null;Sa&&\"documentMode\"in document&&(qb=document.documentMode);\nvar rb=Sa&&\"TextEvent\"in window&&!qb,sb=Sa&&(!pb||qb&&8<qb&&11>=qb),tb=String.fromCharCode(32),ub={beforeInput:{phasedRegistrationNames:{bubbled:\"onBeforeInput\",captured:\"onBeforeInputCapture\"},dependencies:[\"compositionend\",\"keypress\",\"textInput\",\"paste\"]},compositionEnd:{phasedRegistrationNames:{bubbled:\"onCompositionEnd\",captured:\"onCompositionEndCapture\"},dependencies:\"blur compositionend keydown keypress keyup mousedown\".split(\" \")},compositionStart:{phasedRegistrationNames:{bubbled:\"onCompositionStart\",\ncaptured:\"onCompositionStartCapture\"},dependencies:\"blur compositionstart keydown keypress keyup mousedown\".split(\" \")},compositionUpdate:{phasedRegistrationNames:{bubbled:\"onCompositionUpdate\",captured:\"onCompositionUpdateCapture\"},dependencies:\"blur compositionupdate keydown keypress keyup mousedown\".split(\" \")}},vb=!1;\nfunction wb(a,b){switch(a){case \"keyup\":return-1!==ob.indexOf(b.keyCode);case \"keydown\":return 229!==b.keyCode;case \"keypress\":case \"mousedown\":case \"blur\":return!0;default:return!1}}function xb(a){a=a.detail;return\"object\"===typeof a&&\"data\"in a?a.data:null}var yb=!1;function zb(a,b){switch(a){case \"compositionend\":return xb(b);case \"keypress\":if(32!==b.which)return null;vb=!0;return tb;case \"textInput\":return a=b.data,a===tb&&vb?null:a;default:return null}}\nfunction Ab(a,b){if(yb)return\"compositionend\"===a||!pb&&wb(a,b)?(a=gb(),fb=eb=cb=null,yb=!1,a):null;switch(a){case \"paste\":return null;case \"keypress\":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case \"compositionend\":return sb&&\"ko\"!==b.locale?null:b.data;default:return null}}\nvar Bb={eventTypes:ub,extractEvents:function(a,b,c,d){var e=void 0;var f=void 0;if(pb)b:{switch(a){case \"compositionstart\":e=ub.compositionStart;break b;case \"compositionend\":e=ub.compositionEnd;break b;case \"compositionupdate\":e=ub.compositionUpdate;break b}e=void 0}else yb?wb(a,c)&&(e=ub.compositionEnd):\"keydown\"===a&&229===c.keyCode&&(e=ub.compositionStart);e?(sb&&\"ko\"!==c.locale&&(yb||e!==ub.compositionStart?e===ub.compositionEnd&&yb&&(f=gb()):(cb=d,eb=\"value\"in cb?cb.value:cb.textContent,yb=\n!0)),e=mb.getPooled(e,b,c,d),f?e.data=f:(f=xb(c),null!==f&&(e.data=f)),Ra(e),f=e):f=null;(a=rb?zb(a,c):Ab(a,c))?(b=nb.getPooled(ub.beforeInput,b,c,d),b.data=a,Ra(b)):b=null;return null===f?b:null===b?f:[f,b]}},Cb=null,Db=null,Eb=null;function Hb(a){if(a=va(a)){\"function\"!==typeof Cb?t(\"280\"):void 0;var b=ua(a.stateNode);Cb(a.stateNode,a.type,b)}}function Ib(a){Db?Eb?Eb.push(a):Eb=[a]:Db=a}function Jb(){if(Db){var a=Db,b=Eb;Eb=Db=null;Hb(a);if(b)for(a=0;a<b.length;a++)Hb(b[a])}}\nfunction Kb(a,b){return a(b)}function Lb(a,b,c){return a(b,c)}function Mb(){}var Nb=!1;function Ob(a,b){if(Nb)return a(b);Nb=!0;try{return Kb(a,b)}finally{if(Nb=!1,null!==Db||null!==Eb)Mb(),Jb()}}var Pb={color:!0,date:!0,datetime:!0,\"datetime-local\":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qb(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return\"input\"===b?!!Pb[a.type]:\"textarea\"===b?!0:!1}\nfunction Rb(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:a}function Sb(a){if(!Sa)return!1;a=\"on\"+a;var b=a in document;b||(b=document.createElement(\"div\"),b.setAttribute(a,\"return;\"),b=\"function\"===typeof b[a]);return b}function Tb(a){var b=a.type;return(a=a.nodeName)&&\"input\"===a.toLowerCase()&&(\"checkbox\"===b||\"radio\"===b)}\nfunction Ub(a){var b=Tb(a)?\"checked\":\"value\",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=\"\"+a[b];if(!a.hasOwnProperty(b)&&\"undefined\"!==typeof c&&\"function\"===typeof c.get&&\"function\"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=\"\"+a;f.call(this,a)}});Object.defineProperty(a,b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=\"\"+a},stopTracking:function(){a._valueTracker=\nnull;delete a[b]}}}}function Vb(a){a._valueTracker||(a._valueTracker=Ub(a))}function Wb(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d=\"\";a&&(d=Tb(a)?a.checked?\"true\":\"false\":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}\nvar Xb=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Yb=/^(.*)[\\\\\\/]/,D=\"function\"===typeof Symbol&&Symbol.for,Zb=D?Symbol.for(\"react.element\"):60103,$b=D?Symbol.for(\"react.portal\"):60106,ac=D?Symbol.for(\"react.fragment\"):60107,bc=D?Symbol.for(\"react.strict_mode\"):60108,cc=D?Symbol.for(\"react.profiler\"):60114,dc=D?Symbol.for(\"react.provider\"):60109,ec=D?Symbol.for(\"react.context\"):60110,fc=D?Symbol.for(\"react.concurrent_mode\"):60111,gc=D?Symbol.for(\"react.forward_ref\"):60112,hc=D?Symbol.for(\"react.suspense\"):\n60113,ic=D?Symbol.for(\"react.memo\"):60115,jc=D?Symbol.for(\"react.lazy\"):60116,kc=\"function\"===typeof Symbol&&Symbol.iterator;function lc(a){if(null===a||\"object\"!==typeof a)return null;a=kc&&a[kc]||a[\"@@iterator\"];return\"function\"===typeof a?a:null}\nfunction mc(a){if(null==a)return null;if(\"function\"===typeof a)return a.displayName||a.name||null;if(\"string\"===typeof a)return a;switch(a){case fc:return\"ConcurrentMode\";case ac:return\"Fragment\";case $b:return\"Portal\";case cc:return\"Profiler\";case bc:return\"StrictMode\";case hc:return\"Suspense\"}if(\"object\"===typeof a)switch(a.$$typeof){case ec:return\"Context.Consumer\";case dc:return\"Context.Provider\";case gc:var b=a.render;b=b.displayName||b.name||\"\";return a.displayName||(\"\"!==b?\"ForwardRef(\"+b+\n\")\":\"ForwardRef\");case ic:return mc(a.type);case jc:if(a=1===a._status?a._result:null)return mc(a)}return null}function nc(a){var b=\"\";do{a:switch(a.tag){case 2:case 16:case 0:case 1:case 5:case 8:case 13:var c=a._debugOwner,d=a._debugSource,e=mc(a.type);var f=null;c&&(f=mc(c.type));c=e;e=\"\";d?e=\" (at \"+d.fileName.replace(Yb,\"\")+\":\"+d.lineNumber+\")\":f&&(e=\" (created by \"+f+\")\");f=\"\\n    in \"+(c||\"Unknown\")+e;break a;default:f=\"\"}b+=f;a=a.return}while(a);return b}\nvar oc=/^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$/,pc=Object.prototype.hasOwnProperty,qc={},rc={};\nfunction sc(a){if(pc.call(rc,a))return!0;if(pc.call(qc,a))return!1;if(oc.test(a))return rc[a]=!0;qc[a]=!0;return!1}function tc(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case \"function\":case \"symbol\":return!0;case \"boolean\":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return\"data-\"!==a&&\"aria-\"!==a;default:return!1}}\nfunction uc(a,b,c,d){if(null===b||\"undefined\"===typeof b||tc(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function E(a,b,c,d,e){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b}var F={};\n\"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style\".split(\" \").forEach(function(a){F[a]=new E(a,0,!1,a,null)});[[\"acceptCharset\",\"accept-charset\"],[\"className\",\"class\"],[\"htmlFor\",\"for\"],[\"httpEquiv\",\"http-equiv\"]].forEach(function(a){var b=a[0];F[b]=new E(b,1,!1,a[1],null)});[\"contentEditable\",\"draggable\",\"spellCheck\",\"value\"].forEach(function(a){F[a]=new E(a,2,!1,a.toLowerCase(),null)});\n[\"autoReverse\",\"externalResourcesRequired\",\"focusable\",\"preserveAlpha\"].forEach(function(a){F[a]=new E(a,2,!1,a,null)});\"allowFullScreen async autoFocus autoPlay controls default defer disabled formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope\".split(\" \").forEach(function(a){F[a]=new E(a,3,!1,a.toLowerCase(),null)});[\"checked\",\"multiple\",\"muted\",\"selected\"].forEach(function(a){F[a]=new E(a,3,!0,a,null)});\n[\"capture\",\"download\"].forEach(function(a){F[a]=new E(a,4,!1,a,null)});[\"cols\",\"rows\",\"size\",\"span\"].forEach(function(a){F[a]=new E(a,6,!1,a,null)});[\"rowSpan\",\"start\"].forEach(function(a){F[a]=new E(a,5,!1,a.toLowerCase(),null)});var vc=/[\\-:]([a-z])/g;function xc(a){return a[1].toUpperCase()}\n\"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height\".split(\" \").forEach(function(a){var b=a.replace(vc,\nxc);F[b]=new E(b,1,!1,a,null)});\"xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type\".split(\" \").forEach(function(a){var b=a.replace(vc,xc);F[b]=new E(b,1,!1,a,\"http://www.w3.org/1999/xlink\")});[\"xml:base\",\"xml:lang\",\"xml:space\"].forEach(function(a){var b=a.replace(vc,xc);F[b]=new E(b,1,!1,a,\"http://www.w3.org/XML/1998/namespace\")});F.tabIndex=new E(\"tabIndex\",1,!1,\"tabindex\",null);\nfunction yc(a,b,c,d){var e=F.hasOwnProperty(b)?F[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||\"o\"!==b[0]&&\"O\"!==b[0]||\"n\"!==b[1]&&\"N\"!==b[1]?!1:!0;f||(uc(b,c,e,d)&&(c=null),d||null===e?sc(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,\"\"+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:\"\":c:(b=e.attributeName,d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?\"\":\"\"+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}\nfunction zc(a){switch(typeof a){case \"boolean\":case \"number\":case \"object\":case \"string\":case \"undefined\":return a;default:return\"\"}}function Ac(a,b){var c=b.checked;return n({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=c?c:a._wrapperState.initialChecked})}\nfunction Bc(a,b){var c=null==b.defaultValue?\"\":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=zc(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:\"checkbox\"===b.type||\"radio\"===b.type?null!=b.checked:null!=b.value}}function Cc(a,b){b=b.checked;null!=b&&yc(a,\"checked\",b,!1)}\nfunction Dc(a,b){Cc(a,b);var c=zc(b.value),d=b.type;if(null!=c)if(\"number\"===d){if(0===c&&\"\"===a.value||a.value!=c)a.value=\"\"+c}else a.value!==\"\"+c&&(a.value=\"\"+c);else if(\"submit\"===d||\"reset\"===d){a.removeAttribute(\"value\");return}b.hasOwnProperty(\"value\")?Ec(a,b.type,c):b.hasOwnProperty(\"defaultValue\")&&Ec(a,b.type,zc(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}\nfunction Fc(a,b,c){if(b.hasOwnProperty(\"value\")||b.hasOwnProperty(\"defaultValue\")){var d=b.type;if(!(\"submit\"!==d&&\"reset\"!==d||void 0!==b.value&&null!==b.value))return;b=\"\"+a._wrapperState.initialValue;c||b===a.value||(a.value=b);a.defaultValue=b}c=a.name;\"\"!==c&&(a.name=\"\");a.defaultChecked=!a.defaultChecked;a.defaultChecked=!!a._wrapperState.initialChecked;\"\"!==c&&(a.name=c)}\nfunction Ec(a,b,c){if(\"number\"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=\"\"+a._wrapperState.initialValue:a.defaultValue!==\"\"+c&&(a.defaultValue=\"\"+c)}var Gc={change:{phasedRegistrationNames:{bubbled:\"onChange\",captured:\"onChangeCapture\"},dependencies:\"blur change click focus input keydown keyup selectionchange\".split(\" \")}};function Hc(a,b,c){a=A.getPooled(Gc.change,a,b,c);a.type=\"change\";Ib(c);Ra(a);return a}var Jc=null,Kc=null;function Lc(a){Ea(a)}\nfunction Mc(a){var b=Ka(a);if(Wb(b))return a}function Nc(a,b){if(\"change\"===a)return b}var Oc=!1;Sa&&(Oc=Sb(\"input\")&&(!document.documentMode||9<document.documentMode));function Pc(){Jc&&(Jc.detachEvent(\"onpropertychange\",Qc),Kc=Jc=null)}function Qc(a){\"value\"===a.propertyName&&Mc(Kc)&&(a=Hc(Kc,a,Rb(a)),Ob(Lc,a))}function Rc(a,b,c){\"focus\"===a?(Pc(),Jc=b,Kc=c,Jc.attachEvent(\"onpropertychange\",Qc)):\"blur\"===a&&Pc()}function Sc(a){if(\"selectionchange\"===a||\"keyup\"===a||\"keydown\"===a)return Mc(Kc)}\nfunction Tc(a,b){if(\"click\"===a)return Mc(b)}function Uc(a,b){if(\"input\"===a||\"change\"===a)return Mc(b)}\nvar Vc={eventTypes:Gc,_isInputEventSupported:Oc,extractEvents:function(a,b,c,d){var e=b?Ka(b):window,f=void 0,g=void 0,h=e.nodeName&&e.nodeName.toLowerCase();\"select\"===h||\"input\"===h&&\"file\"===e.type?f=Nc:Qb(e)?Oc?f=Uc:(f=Sc,g=Rc):(h=e.nodeName)&&\"input\"===h.toLowerCase()&&(\"checkbox\"===e.type||\"radio\"===e.type)&&(f=Tc);if(f&&(f=f(a,b)))return Hc(f,c,d);g&&g(a,e,b);\"blur\"===a&&(a=e._wrapperState)&&a.controlled&&\"number\"===e.type&&Ec(e,\"number\",e.value)}},Wc=A.extend({view:null,detail:null}),Xc={Alt:\"altKey\",\nControl:\"ctrlKey\",Meta:\"metaKey\",Shift:\"shiftKey\"};function Yc(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Xc[a])?!!b[a]:!1}function Zc(){return Yc}\nvar $c=0,ad=0,bd=!1,cd=!1,dd=Wc.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Zc,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if(\"movementX\"in a)return a.movementX;var b=$c;$c=a.screenX;return bd?\"mousemove\"===a.type?a.screenX-b:0:(bd=!0,0)},movementY:function(a){if(\"movementY\"in a)return a.movementY;\nvar b=ad;ad=a.screenY;return cd?\"mousemove\"===a.type?a.screenY-b:0:(cd=!0,0)}}),ed=dd.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fd={mouseEnter:{registrationName:\"onMouseEnter\",dependencies:[\"mouseout\",\"mouseover\"]},mouseLeave:{registrationName:\"onMouseLeave\",dependencies:[\"mouseout\",\"mouseover\"]},pointerEnter:{registrationName:\"onPointerEnter\",dependencies:[\"pointerout\",\"pointerover\"]},pointerLeave:{registrationName:\"onPointerLeave\",\ndependencies:[\"pointerout\",\"pointerover\"]}},gd={eventTypes:fd,extractEvents:function(a,b,c,d){var e=\"mouseover\"===a||\"pointerover\"===a,f=\"mouseout\"===a||\"pointerout\"===a;if(e&&(c.relatedTarget||c.fromElement)||!f&&!e)return null;e=d.window===d?d:(e=d.ownerDocument)?e.defaultView||e.parentWindow:window;f?(f=b,b=(b=c.relatedTarget||c.toElement)?Ia(b):null):f=null;if(f===b)return null;var g=void 0,h=void 0,k=void 0,l=void 0;if(\"mouseout\"===a||\"mouseover\"===a)g=dd,h=fd.mouseLeave,k=fd.mouseEnter,l=\"mouse\";\nelse if(\"pointerout\"===a||\"pointerover\"===a)g=ed,h=fd.pointerLeave,k=fd.pointerEnter,l=\"pointer\";var m=null==f?e:Ka(f);e=null==b?e:Ka(b);a=g.getPooled(h,f,c,d);a.type=l+\"leave\";a.target=m;a.relatedTarget=e;c=g.getPooled(k,b,c,d);c.type=l+\"enter\";c.target=e;c.relatedTarget=m;d=b;if(f&&d)a:{b=f;e=d;l=0;for(g=b;g;g=Ma(g))l++;g=0;for(k=e;k;k=Ma(k))g++;for(;0<l-g;)b=Ma(b),l--;for(;0<g-l;)e=Ma(e),g--;for(;l--;){if(b===e||b===e.alternate)break a;b=Ma(b);e=Ma(e)}b=null}else b=null;e=b;for(b=[];f&&f!==e;){l=\nf.alternate;if(null!==l&&l===e)break;b.push(f);f=Ma(f)}for(f=[];d&&d!==e;){l=d.alternate;if(null!==l&&l===e)break;f.push(d);d=Ma(d)}for(d=0;d<b.length;d++)Pa(b[d],\"bubbled\",a);for(d=f.length;0<d--;)Pa(f[d],\"captured\",c);return[a,c]}},hd=Object.prototype.hasOwnProperty;function id(a,b){return a===b?0!==a||0!==b||1/a===1/b:a!==a&&b!==b}\nfunction jd(a,b){if(id(a,b))return!0;if(\"object\"!==typeof a||null===a||\"object\"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!hd.call(b,c[d])||!id(a[c[d]],b[c[d]]))return!1;return!0}function kd(a){var b=a;if(a.alternate)for(;b.return;)b=b.return;else{if(0!==(b.effectTag&2))return 1;for(;b.return;)if(b=b.return,0!==(b.effectTag&2))return 1}return 3===b.tag?2:3}function ld(a){2!==kd(a)?t(\"188\"):void 0}\nfunction md(a){var b=a.alternate;if(!b)return b=kd(a),3===b?t(\"188\"):void 0,1===b?null:a;for(var c=a,d=b;;){var e=c.return,f=e?e.alternate:null;if(!e||!f)break;if(e.child===f.child){for(var g=e.child;g;){if(g===c)return ld(e),a;if(g===d)return ld(e),b;g=g.sibling}t(\"188\")}if(c.return!==d.return)c=e,d=f;else{g=!1;for(var h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}g?\nvoid 0:t(\"189\")}}c.alternate!==d?t(\"190\"):void 0}3!==c.tag?t(\"188\"):void 0;return c.stateNode.current===c?a:b}function nd(a){a=md(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}\nvar od=A.extend({animationName:null,elapsedTime:null,pseudoElement:null}),pd=A.extend({clipboardData:function(a){return\"clipboardData\"in a?a.clipboardData:window.clipboardData}}),qd=Wc.extend({relatedTarget:null});function rd(a){var b=a.keyCode;\"charCode\"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}\nvar sd={Esc:\"Escape\",Spacebar:\" \",Left:\"ArrowLeft\",Up:\"ArrowUp\",Right:\"ArrowRight\",Down:\"ArrowDown\",Del:\"Delete\",Win:\"OS\",Menu:\"ContextMenu\",Apps:\"ContextMenu\",Scroll:\"ScrollLock\",MozPrintableKey:\"Unidentified\"},td={8:\"Backspace\",9:\"Tab\",12:\"Clear\",13:\"Enter\",16:\"Shift\",17:\"Control\",18:\"Alt\",19:\"Pause\",20:\"CapsLock\",27:\"Escape\",32:\" \",33:\"PageUp\",34:\"PageDown\",35:\"End\",36:\"Home\",37:\"ArrowLeft\",38:\"ArrowUp\",39:\"ArrowRight\",40:\"ArrowDown\",45:\"Insert\",46:\"Delete\",112:\"F1\",113:\"F2\",114:\"F3\",115:\"F4\",\n116:\"F5\",117:\"F6\",118:\"F7\",119:\"F8\",120:\"F9\",121:\"F10\",122:\"F11\",123:\"F12\",144:\"NumLock\",145:\"ScrollLock\",224:\"Meta\"},ud=Wc.extend({key:function(a){if(a.key){var b=sd[a.key]||a.key;if(\"Unidentified\"!==b)return b}return\"keypress\"===a.type?(a=rd(a),13===a?\"Enter\":String.fromCharCode(a)):\"keydown\"===a.type||\"keyup\"===a.type?td[a.keyCode]||\"Unidentified\":\"\"},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Zc,charCode:function(a){return\"keypress\"===\na.type?rd(a):0},keyCode:function(a){return\"keydown\"===a.type||\"keyup\"===a.type?a.keyCode:0},which:function(a){return\"keypress\"===a.type?rd(a):\"keydown\"===a.type||\"keyup\"===a.type?a.keyCode:0}}),vd=dd.extend({dataTransfer:null}),wd=Wc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Zc}),xd=A.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),yd=dd.extend({deltaX:function(a){return\"deltaX\"in a?a.deltaX:\"wheelDeltaX\"in\na?-a.wheelDeltaX:0},deltaY:function(a){return\"deltaY\"in a?a.deltaY:\"wheelDeltaY\"in a?-a.wheelDeltaY:\"wheelDelta\"in a?-a.wheelDelta:0},deltaZ:null,deltaMode:null}),zd=[[\"abort\",\"abort\"],[Ya,\"animationEnd\"],[Za,\"animationIteration\"],[$a,\"animationStart\"],[\"canplay\",\"canPlay\"],[\"canplaythrough\",\"canPlayThrough\"],[\"drag\",\"drag\"],[\"dragenter\",\"dragEnter\"],[\"dragexit\",\"dragExit\"],[\"dragleave\",\"dragLeave\"],[\"dragover\",\"dragOver\"],[\"durationchange\",\"durationChange\"],[\"emptied\",\"emptied\"],[\"encrypted\",\"encrypted\"],\n[\"ended\",\"ended\"],[\"error\",\"error\"],[\"gotpointercapture\",\"gotPointerCapture\"],[\"load\",\"load\"],[\"loadeddata\",\"loadedData\"],[\"loadedmetadata\",\"loadedMetadata\"],[\"loadstart\",\"loadStart\"],[\"lostpointercapture\",\"lostPointerCapture\"],[\"mousemove\",\"mouseMove\"],[\"mouseout\",\"mouseOut\"],[\"mouseover\",\"mouseOver\"],[\"playing\",\"playing\"],[\"pointermove\",\"pointerMove\"],[\"pointerout\",\"pointerOut\"],[\"pointerover\",\"pointerOver\"],[\"progress\",\"progress\"],[\"scroll\",\"scroll\"],[\"seeking\",\"seeking\"],[\"stalled\",\"stalled\"],\n[\"suspend\",\"suspend\"],[\"timeupdate\",\"timeUpdate\"],[\"toggle\",\"toggle\"],[\"touchmove\",\"touchMove\"],[ab,\"transitionEnd\"],[\"waiting\",\"waiting\"],[\"wheel\",\"wheel\"]],Ad={},Bd={};function Cd(a,b){var c=a[0];a=a[1];var d=\"on\"+(a[0].toUpperCase()+a.slice(1));b={phasedRegistrationNames:{bubbled:d,captured:d+\"Capture\"},dependencies:[c],isInteractive:b};Ad[a]=b;Bd[c]=b}\n[[\"blur\",\"blur\"],[\"cancel\",\"cancel\"],[\"click\",\"click\"],[\"close\",\"close\"],[\"contextmenu\",\"contextMenu\"],[\"copy\",\"copy\"],[\"cut\",\"cut\"],[\"auxclick\",\"auxClick\"],[\"dblclick\",\"doubleClick\"],[\"dragend\",\"dragEnd\"],[\"dragstart\",\"dragStart\"],[\"drop\",\"drop\"],[\"focus\",\"focus\"],[\"input\",\"input\"],[\"invalid\",\"invalid\"],[\"keydown\",\"keyDown\"],[\"keypress\",\"keyPress\"],[\"keyup\",\"keyUp\"],[\"mousedown\",\"mouseDown\"],[\"mouseup\",\"mouseUp\"],[\"paste\",\"paste\"],[\"pause\",\"pause\"],[\"play\",\"play\"],[\"pointercancel\",\"pointerCancel\"],\n[\"pointerdown\",\"pointerDown\"],[\"pointerup\",\"pointerUp\"],[\"ratechange\",\"rateChange\"],[\"reset\",\"reset\"],[\"seeked\",\"seeked\"],[\"submit\",\"submit\"],[\"touchcancel\",\"touchCancel\"],[\"touchend\",\"touchEnd\"],[\"touchstart\",\"touchStart\"],[\"volumechange\",\"volumeChange\"]].forEach(function(a){Cd(a,!0)});zd.forEach(function(a){Cd(a,!1)});\nvar Dd={eventTypes:Ad,isInteractiveTopLevelEventType:function(a){a=Bd[a];return void 0!==a&&!0===a.isInteractive},extractEvents:function(a,b,c,d){var e=Bd[a];if(!e)return null;switch(a){case \"keypress\":if(0===rd(c))return null;case \"keydown\":case \"keyup\":a=ud;break;case \"blur\":case \"focus\":a=qd;break;case \"click\":if(2===c.button)return null;case \"auxclick\":case \"dblclick\":case \"mousedown\":case \"mousemove\":case \"mouseup\":case \"mouseout\":case \"mouseover\":case \"contextmenu\":a=dd;break;case \"drag\":case \"dragend\":case \"dragenter\":case \"dragexit\":case \"dragleave\":case \"dragover\":case \"dragstart\":case \"drop\":a=\nvd;break;case \"touchcancel\":case \"touchend\":case \"touchmove\":case \"touchstart\":a=wd;break;case Ya:case Za:case $a:a=od;break;case ab:a=xd;break;case \"scroll\":a=Wc;break;case \"wheel\":a=yd;break;case \"copy\":case \"cut\":case \"paste\":a=pd;break;case \"gotpointercapture\":case \"lostpointercapture\":case \"pointercancel\":case \"pointerdown\":case \"pointermove\":case \"pointerout\":case \"pointerover\":case \"pointerup\":a=ed;break;default:a=A}b=a.getPooled(e,b,c,d);Ra(b);return b}},Ed=Dd.isInteractiveTopLevelEventType,\nFd=[];function Gd(a){var b=a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d;for(d=c;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo;if(!d)break;a.ancestors.push(c);c=Ia(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Rb(a.nativeEvent);d=a.topLevelType;for(var f=a.nativeEvent,g=null,h=0;h<pa.length;h++){var k=pa[h];k&&(k=k.extractEvents(d,b,f,e))&&(g=ya(g,k))}Ea(g)}}var Hd=!0;\nfunction G(a,b){if(!b)return null;var c=(Ed(a)?Id:Jd).bind(null,a);b.addEventListener(a,c,!1)}function Kd(a,b){if(!b)return null;var c=(Ed(a)?Id:Jd).bind(null,a);b.addEventListener(a,c,!0)}function Id(a,b){Lb(Jd,a,b)}\nfunction Jd(a,b){if(Hd){var c=Rb(b);c=Ia(c);null===c||\"number\"!==typeof c.tag||2===kd(c)||(c=null);if(Fd.length){var d=Fd.pop();d.topLevelType=a;d.nativeEvent=b;d.targetInst=c;a=d}else a={topLevelType:a,nativeEvent:b,targetInst:c,ancestors:[]};try{Ob(Gd,a)}finally{a.topLevelType=null,a.nativeEvent=null,a.targetInst=null,a.ancestors.length=0,10>Fd.length&&Fd.push(a)}}}var Ld={},Md=0,Nd=\"_reactListenersID\"+(\"\"+Math.random()).slice(2);\nfunction Od(a){Object.prototype.hasOwnProperty.call(a,Nd)||(a[Nd]=Md++,Ld[a[Nd]]={});return Ld[a[Nd]]}function Pd(a){a=a||(\"undefined\"!==typeof document?document:void 0);if(\"undefined\"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function Qd(a){for(;a&&a.firstChild;)a=a.firstChild;return a}\nfunction Rd(a,b){var c=Qd(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=Qd(c)}}function Sd(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?Sd(a,b.parentNode):\"contains\"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}\nfunction Td(){for(var a=window,b=Pd();b instanceof a.HTMLIFrameElement;){try{a=b.contentDocument.defaultView}catch(c){break}b=Pd(a.document)}return b}function Ud(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&(\"input\"===b&&(\"text\"===a.type||\"search\"===a.type||\"tel\"===a.type||\"url\"===a.type||\"password\"===a.type)||\"textarea\"===b||\"true\"===a.contentEditable)}\nvar Vd=Sa&&\"documentMode\"in document&&11>=document.documentMode,Wd={select:{phasedRegistrationNames:{bubbled:\"onSelect\",captured:\"onSelectCapture\"},dependencies:\"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange\".split(\" \")}},Xd=null,Yd=null,Zd=null,$d=!1;\nfunction ae(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if($d||null==Xd||Xd!==Pd(c))return null;c=Xd;\"selectionStart\"in c&&Ud(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Zd&&jd(Zd,c)?null:(Zd=c,a=A.getPooled(Wd.select,Yd,a,b),a.type=\"select\",a.target=Xd,Ra(a),a)}\nvar be={eventTypes:Wd,extractEvents:function(a,b,c,d){var e=d.window===d?d.document:9===d.nodeType?d:d.ownerDocument,f;if(!(f=!e)){a:{e=Od(e);f=ta.onSelect;for(var g=0;g<f.length;g++){var h=f[g];if(!e.hasOwnProperty(h)||!e[h]){e=!1;break a}}e=!0}f=!e}if(f)return null;e=b?Ka(b):window;switch(a){case \"focus\":if(Qb(e)||\"true\"===e.contentEditable)Xd=e,Yd=b,Zd=null;break;case \"blur\":Zd=Yd=Xd=null;break;case \"mousedown\":$d=!0;break;case \"contextmenu\":case \"mouseup\":case \"dragend\":return $d=!1,ae(c,d);case \"selectionchange\":if(Vd)break;\ncase \"keydown\":case \"keyup\":return ae(c,d)}return null}};Ca.injectEventPluginOrder(\"ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin\".split(\" \"));ua=La;va=Ja;wa=Ka;Ca.injectEventPluginsByName({SimpleEventPlugin:Dd,EnterLeaveEventPlugin:gd,ChangeEventPlugin:Vc,SelectEventPlugin:be,BeforeInputEventPlugin:Bb});function de(a){var b=\"\";aa.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}\nfunction ee(a,b){a=n({children:void 0},b);if(b=de(b.children))a.children=b;return a}function fe(a,b,c,d){a=a.options;if(b){b={};for(var e=0;e<c.length;e++)b[\"$\"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty(\"$\"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=\"\"+zc(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}\nfunction ge(a,b){null!=b.dangerouslySetInnerHTML?t(\"91\"):void 0;return n({},b,{value:void 0,defaultValue:void 0,children:\"\"+a._wrapperState.initialValue})}function he(a,b){var c=b.value;null==c&&(c=b.defaultValue,b=b.children,null!=b&&(null!=c?t(\"92\"):void 0,Array.isArray(b)&&(1>=b.length?void 0:t(\"93\"),b=b[0]),c=b),null==c&&(c=\"\"));a._wrapperState={initialValue:zc(c)}}\nfunction ie(a,b){var c=zc(b.value),d=zc(b.defaultValue);null!=c&&(c=\"\"+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=\"\"+d)}function je(a){var b=a.textContent;b===a._wrapperState.initialValue&&(a.value=b)}var ke={html:\"http://www.w3.org/1999/xhtml\",mathml:\"http://www.w3.org/1998/Math/MathML\",svg:\"http://www.w3.org/2000/svg\"};\nfunction le(a){switch(a){case \"svg\":return\"http://www.w3.org/2000/svg\";case \"math\":return\"http://www.w3.org/1998/Math/MathML\";default:return\"http://www.w3.org/1999/xhtml\"}}function me(a,b){return null==a||\"http://www.w3.org/1999/xhtml\"===a?le(b):\"http://www.w3.org/2000/svg\"===a&&\"foreignObject\"===b?\"http://www.w3.org/1999/xhtml\":a}\nvar ne=void 0,oe=function(a){return\"undefined\"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if(a.namespaceURI!==ke.svg||\"innerHTML\"in a)a.innerHTML=b;else{ne=ne||document.createElement(\"div\");ne.innerHTML=\"<svg>\"+b+\"</svg>\";for(b=ne.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}});\nfunction pe(a,b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b}\nvar qe={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,\nfloodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},re=[\"Webkit\",\"ms\",\"Moz\",\"O\"];Object.keys(qe).forEach(function(a){re.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);qe[b]=qe[a]})});function se(a,b,c){return null==b||\"boolean\"===typeof b||\"\"===b?\"\":c||\"number\"!==typeof b||0===b||qe.hasOwnProperty(a)&&qe[a]?(\"\"+b).trim():b+\"px\"}\nfunction te(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf(\"--\"),e=se(c,b[c],d);\"float\"===c&&(c=\"cssFloat\");d?a.setProperty(c,e):a[c]=e}}var ue=n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});\nfunction ve(a,b){b&&(ue[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML?t(\"137\",a,\"\"):void 0),null!=b.dangerouslySetInnerHTML&&(null!=b.children?t(\"60\"):void 0,\"object\"===typeof b.dangerouslySetInnerHTML&&\"__html\"in b.dangerouslySetInnerHTML?void 0:t(\"61\")),null!=b.style&&\"object\"!==typeof b.style?t(\"62\",\"\"):void 0)}\nfunction we(a,b){if(-1===a.indexOf(\"-\"))return\"string\"===typeof b.is;switch(a){case \"annotation-xml\":case \"color-profile\":case \"font-face\":case \"font-face-src\":case \"font-face-uri\":case \"font-face-format\":case \"font-face-name\":case \"missing-glyph\":return!1;default:return!0}}\nfunction xe(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Od(a);b=ta[b];for(var d=0;d<b.length;d++){var e=b[d];if(!c.hasOwnProperty(e)||!c[e]){switch(e){case \"scroll\":Kd(\"scroll\",a);break;case \"focus\":case \"blur\":Kd(\"focus\",a);Kd(\"blur\",a);c.blur=!0;c.focus=!0;break;case \"cancel\":case \"close\":Sb(e)&&Kd(e,a);break;case \"invalid\":case \"submit\":case \"reset\":break;default:-1===bb.indexOf(e)&&G(e,a)}c[e]=!0}}}function ye(){}var ze=null,Ae=null;\nfunction Be(a,b){switch(a){case \"button\":case \"input\":case \"select\":case \"textarea\":return!!b.autoFocus}return!1}function Ce(a,b){return\"textarea\"===a||\"option\"===a||\"noscript\"===a||\"string\"===typeof b.children||\"number\"===typeof b.children||\"object\"===typeof b.dangerouslySetInnerHTML&&null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}var De=\"function\"===typeof setTimeout?setTimeout:void 0,Ee=\"function\"===typeof clearTimeout?clearTimeout:void 0;\nfunction Fe(a){for(a=a.nextSibling;a&&1!==a.nodeType&&3!==a.nodeType;)a=a.nextSibling;return a}function Ge(a){for(a=a.firstChild;a&&1!==a.nodeType&&3!==a.nodeType;)a=a.nextSibling;return a}new Set;var He=[],Ie=-1;function H(a){0>Ie||(a.current=He[Ie],He[Ie]=null,Ie--)}function I(a,b){Ie++;He[Ie]=a.current;a.current=b}var Je={},J={current:Je},K={current:!1},Ke=Je;\nfunction Le(a,b){var c=a.type.contextTypes;if(!c)return Je;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function L(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Me(a){H(K,a);H(J,a)}function Ne(a){H(K,a);H(J,a)}\nfunction Oe(a,b,c){J.current!==Je?t(\"168\"):void 0;I(J,b,a);I(K,c,a)}function Pe(a,b,c){var d=a.stateNode;a=b.childContextTypes;if(\"function\"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)e in a?void 0:t(\"108\",mc(b)||\"Unknown\",e);return n({},c,d)}function Qe(a){var b=a.stateNode;b=b&&b.__reactInternalMemoizedMergedChildContext||Je;Ke=J.current;I(J,b,a);I(K,K.current,a);return!0}\nfunction Re(a,b,c){var d=a.stateNode;d?void 0:t(\"169\");c?(b=Pe(a,b,Ke),d.__reactInternalMemoizedMergedChildContext=b,H(K,a),H(J,a),I(J,b,a)):H(K,a);I(K,c,a)}var Se=null,Te=null;function Ue(a){return function(b){try{return a(b)}catch(c){}}}\nfunction Ve(a){if(\"undefined\"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=b.inject(a);Se=Ue(function(a){return b.onCommitFiberRoot(c,a)});Te=Ue(function(a){return b.onCommitFiberUnmount(c,a)})}catch(d){}return!0}\nfunction We(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.firstContextDependency=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function M(a,b,c,d){return new We(a,b,c,d)}\nfunction Xe(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Ye(a){if(\"function\"===typeof a)return Xe(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===gc)return 11;if(a===ic)return 14}return 2}\nfunction Ze(a,b){var c=a.alternate;null===c?(c=M(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;c.firstContextDependency=a.firstContextDependency;c.sibling=a.sibling;\nc.index=a.index;c.ref=a.ref;return c}\nfunction $e(a,b,c,d,e,f){var g=2;d=a;if(\"function\"===typeof a)Xe(a)&&(g=1);else if(\"string\"===typeof a)g=5;else a:switch(a){case ac:return af(c.children,e,f,b);case fc:return bf(c,e|3,f,b);case bc:return bf(c,e|2,f,b);case cc:return a=M(12,c,b,e|4),a.elementType=cc,a.type=cc,a.expirationTime=f,a;case hc:return a=M(13,c,b,e),a.elementType=hc,a.type=hc,a.expirationTime=f,a;default:if(\"object\"===typeof a&&null!==a)switch(a.$$typeof){case dc:g=10;break a;case ec:g=9;break a;case gc:g=11;break a;case ic:g=\n14;break a;case jc:g=16;d=null;break a}t(\"130\",null==a?a:typeof a,\"\")}b=M(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function af(a,b,c,d){a=M(7,a,d,b);a.expirationTime=c;return a}function bf(a,b,c,d){a=M(8,a,d,b);b=0===(b&1)?bc:fc;a.elementType=b;a.type=b;a.expirationTime=c;return a}function cf(a,b,c){a=M(6,a,null,b);a.expirationTime=c;return a}\nfunction df(a,b,c){b=M(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function ef(a,b){a.didError=!1;var c=a.earliestPendingTime;0===c?a.earliestPendingTime=a.latestPendingTime=b:c<b?a.earliestPendingTime=b:a.latestPendingTime>b&&(a.latestPendingTime=b);ff(b,a)}\nfunction gf(a,b){a.didError=!1;var c=a.latestPingedTime;0!==c&&c>=b&&(a.latestPingedTime=0);c=a.earliestPendingTime;var d=a.latestPendingTime;c===b?a.earliestPendingTime=d===b?a.latestPendingTime=0:d:d===b&&(a.latestPendingTime=c);c=a.earliestSuspendedTime;d=a.latestSuspendedTime;0===c?a.earliestSuspendedTime=a.latestSuspendedTime=b:c<b?a.earliestSuspendedTime=b:d>b&&(a.latestSuspendedTime=b);ff(b,a)}\nfunction hf(a,b){var c=a.earliestPendingTime;a=a.earliestSuspendedTime;c>b&&(b=c);a>b&&(b=a);return b}function ff(a,b){var c=b.earliestSuspendedTime,d=b.latestSuspendedTime,e=b.earliestPendingTime,f=b.latestPingedTime;e=0!==e?e:f;0===e&&(0===a||d<a)&&(e=d);a=e;0!==a&&c>a&&(a=c);b.nextExpirationTimeToWorkOn=e;b.expirationTime=a}var jf=!1;\nfunction kf(a){return{baseState:a,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function lf(a){return{baseState:a.baseState,firstUpdate:a.firstUpdate,lastUpdate:a.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}\nfunction mf(a){return{expirationTime:a,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function nf(a,b){null===a.lastUpdate?a.firstUpdate=a.lastUpdate=b:(a.lastUpdate.next=b,a.lastUpdate=b)}\nfunction of(a,b){var c=a.alternate;if(null===c){var d=a.updateQueue;var e=null;null===d&&(d=a.updateQueue=kf(a.memoizedState))}else d=a.updateQueue,e=c.updateQueue,null===d?null===e?(d=a.updateQueue=kf(a.memoizedState),e=c.updateQueue=kf(c.memoizedState)):d=a.updateQueue=lf(e):null===e&&(e=c.updateQueue=lf(d));null===e||d===e?nf(d,b):null===d.lastUpdate||null===e.lastUpdate?(nf(d,b),nf(e,b)):(nf(d,b),e.lastUpdate=b)}\nfunction pf(a,b){var c=a.updateQueue;c=null===c?a.updateQueue=kf(a.memoizedState):qf(a,c);null===c.lastCapturedUpdate?c.firstCapturedUpdate=c.lastCapturedUpdate=b:(c.lastCapturedUpdate.next=b,c.lastCapturedUpdate=b)}function qf(a,b){var c=a.alternate;null!==c&&b===c.updateQueue&&(b=a.updateQueue=lf(b));return b}\nfunction rf(a,b,c,d,e,f){switch(c.tag){case 1:return a=c.payload,\"function\"===typeof a?a.call(f,d,e):a;case 3:a.effectTag=a.effectTag&-2049|64;case 0:a=c.payload;e=\"function\"===typeof a?a.call(f,d,e):a;if(null===e||void 0===e)break;return n({},d,e);case 2:jf=!0}return d}\nfunction sf(a,b,c,d,e){jf=!1;b=qf(a,b);for(var f=b.baseState,g=null,h=0,k=b.firstUpdate,l=f;null!==k;){var m=k.expirationTime;m<e?(null===g&&(g=k,f=l),h<m&&(h=m)):(l=rf(a,b,k,l,c,d),null!==k.callback&&(a.effectTag|=32,k.nextEffect=null,null===b.lastEffect?b.firstEffect=b.lastEffect=k:(b.lastEffect.nextEffect=k,b.lastEffect=k)));k=k.next}m=null;for(k=b.firstCapturedUpdate;null!==k;){var q=k.expirationTime;q<e?(null===m&&(m=k,null===g&&(f=l)),h<q&&(h=q)):(l=rf(a,b,k,l,c,d),null!==k.callback&&(a.effectTag|=\n32,k.nextEffect=null,null===b.lastCapturedEffect?b.firstCapturedEffect=b.lastCapturedEffect=k:(b.lastCapturedEffect.nextEffect=k,b.lastCapturedEffect=k)));k=k.next}null===g&&(b.lastUpdate=null);null===m?b.lastCapturedUpdate=null:a.effectTag|=32;null===g&&null===m&&(f=l);b.baseState=f;b.firstUpdate=g;b.firstCapturedUpdate=m;a.expirationTime=h;a.memoizedState=l}\nfunction tf(a,b,c){null!==b.firstCapturedUpdate&&(null!==b.lastUpdate&&(b.lastUpdate.next=b.firstCapturedUpdate,b.lastUpdate=b.lastCapturedUpdate),b.firstCapturedUpdate=b.lastCapturedUpdate=null);uf(b.firstEffect,c);b.firstEffect=b.lastEffect=null;uf(b.firstCapturedEffect,c);b.firstCapturedEffect=b.lastCapturedEffect=null}function uf(a,b){for(;null!==a;){var c=a.callback;if(null!==c){a.callback=null;var d=b;\"function\"!==typeof c?t(\"191\",c):void 0;c.call(d)}a=a.nextEffect}}\nfunction vf(a,b){return{value:a,source:b,stack:nc(b)}}var wf={current:null},xf=null,yf=null,zf=null;function Af(a,b){var c=a.type._context;I(wf,c._currentValue,a);c._currentValue=b}function Bf(a){var b=wf.current;H(wf,a);a.type._context._currentValue=b}function Cf(a){xf=a;zf=yf=null;a.firstContextDependency=null}\nfunction Df(a,b){if(zf!==a&&!1!==b&&0!==b){if(\"number\"!==typeof b||1073741823===b)zf=a,b=1073741823;b={context:a,observedBits:b,next:null};null===yf?(null===xf?t(\"293\"):void 0,xf.firstContextDependency=yf=b):yf=yf.next=b}return a._currentValue}var Ef={},N={current:Ef},Ff={current:Ef},Gf={current:Ef};function Hf(a){a===Ef?t(\"174\"):void 0;return a}\nfunction If(a,b){I(Gf,b,a);I(Ff,a,a);I(N,Ef,a);var c=b.nodeType;switch(c){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:me(null,\"\");break;default:c=8===c?b.parentNode:b,b=c.namespaceURI||null,c=c.tagName,b=me(b,c)}H(N,a);I(N,b,a)}function Jf(a){H(N,a);H(Ff,a);H(Gf,a)}function Kf(a){Hf(Gf.current);var b=Hf(N.current);var c=me(b,a.type);b!==c&&(I(Ff,a,a),I(N,c,a))}function Lf(a){Ff.current===a&&(H(N,a),H(Ff,a))}\nfunction O(a,b){if(a&&a.defaultProps){b=n({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function Mf(a){var b=a._result;switch(a._status){case 1:return b;case 2:throw b;case 0:throw b;default:throw a._status=0,b=a._ctor,b=b(),b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)}),a._result=b,b;}}var Nf=Xb.ReactCurrentOwner,Of=(new aa.Component).refs;\nfunction Pf(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:n({},b,c);a.memoizedState=c;d=a.updateQueue;null!==d&&0===a.expirationTime&&(d.baseState=c)}\nvar Uf={isMounted:function(a){return(a=a._reactInternalFiber)?2===kd(a):!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=Qf();d=Rf(d,a);var e=mf(d);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Sf();of(a,e);Tf(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=Qf();d=Rf(d,a);var e=mf(d);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Sf();of(a,e);Tf(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=Qf();c=Rf(c,a);var d=mf(c);d.tag=\n2;void 0!==b&&null!==b&&(d.callback=b);Sf();of(a,d);Tf(a,c)}};function Vf(a,b,c,d,e,f,g){a=a.stateNode;return\"function\"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,f,g):b.prototype&&b.prototype.isPureReactComponent?!jd(c,d)||!jd(e,f):!0}\nfunction Wf(a,b,c){var d=!1,e=Je;var f=b.contextType;\"object\"===typeof f&&null!==f?f=Nf.currentDispatcher.readContext(f):(e=L(b)?Ke:J.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?Le(a,e):Je);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Uf;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}\nfunction Xf(a,b,c,d){a=b.state;\"function\"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);\"function\"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Uf.enqueueReplaceState(b,b.state,null)}\nfunction Yf(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=Of;var f=b.contextType;\"object\"===typeof f&&null!==f?e.context=Nf.currentDispatcher.readContext(f):(f=L(b)?Ke:J.current,e.context=Le(a,f));f=a.updateQueue;null!==f&&(sf(a,f,c,e,d),e.state=a.memoizedState);f=b.getDerivedStateFromProps;\"function\"===typeof f&&(Pf(a,b,f,c),e.state=a.memoizedState);\"function\"===typeof b.getDerivedStateFromProps||\"function\"===typeof e.getSnapshotBeforeUpdate||\"function\"!==typeof e.UNSAFE_componentWillMount&&\n\"function\"!==typeof e.componentWillMount||(b=e.state,\"function\"===typeof e.componentWillMount&&e.componentWillMount(),\"function\"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Uf.enqueueReplaceState(e,e.state,null),f=a.updateQueue,null!==f&&(sf(a,f,c,e,d),e.state=a.memoizedState));\"function\"===typeof e.componentDidMount&&(a.effectTag|=4)}var Zf=Array.isArray;\nfunction $f(a,b,c){a=c.ref;if(null!==a&&\"function\"!==typeof a&&\"object\"!==typeof a){if(c._owner){c=c._owner;var d=void 0;c&&(1!==c.tag?t(\"289\"):void 0,d=c.stateNode);d?void 0:t(\"147\",a);var e=\"\"+a;if(null!==b&&null!==b.ref&&\"function\"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===Of&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}\"string\"!==typeof a?t(\"284\"):void 0;c._owner?void 0:t(\"290\",a)}return a}\nfunction ag(a,b){\"textarea\"!==a.type&&t(\"31\",\"[object Object]\"===Object.prototype.toString.call(b)?\"object with keys {\"+Object.keys(b).join(\", \")+\"}\":b,\"\")}\nfunction bg(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,b),b=b.sibling;return a}function e(a,b,c){a=Ze(a,b,c);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=\n2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=cf(c,a.mode,d),b.return=a,b;b=e(b,c,d);b.return=a;return b}function k(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props,d),d.ref=$f(a,b,c),d.return=a,d;d=$e(c.type,c.key,c.props,null,a.mode,d);d.ref=$f(a,b,c);d.return=a;return d}function l(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==\nc.implementation)return b=df(c,a.mode,d),b.return=a,b;b=e(b,c.children||[],d);b.return=a;return b}function m(a,b,c,d,g){if(null===b||7!==b.tag)return b=af(c,a.mode,d,g),b.return=a,b;b=e(b,c,d);b.return=a;return b}function q(a,b,c){if(\"string\"===typeof b||\"number\"===typeof b)return b=cf(\"\"+b,a.mode,c),b.return=a,b;if(\"object\"===typeof b&&null!==b){switch(b.$$typeof){case Zb:return c=$e(b.type,b.key,b.props,null,a.mode,c),c.ref=$f(a,null,b),c.return=a,c;case $b:return b=df(b,a.mode,c),b.return=a,b}if(Zf(b)||\nlc(b))return b=af(b,a.mode,c,null),b.return=a,b;ag(a,b)}return null}function x(a,b,c,d){var e=null!==b?b.key:null;if(\"string\"===typeof c||\"number\"===typeof c)return null!==e?null:h(a,b,\"\"+c,d);if(\"object\"===typeof c&&null!==c){switch(c.$$typeof){case Zb:return c.key===e?c.type===ac?m(a,b,c.props.children,d,e):k(a,b,c,d):null;case $b:return c.key===e?l(a,b,c,d):null}if(Zf(c)||lc(c))return null!==e?null:m(a,b,c,d,null);ag(a,c)}return null}function z(a,b,c,d,e){if(\"string\"===typeof d||\"number\"===typeof d)return a=\na.get(c)||null,h(b,a,\"\"+d,e);if(\"object\"===typeof d&&null!==d){switch(d.$$typeof){case Zb:return a=a.get(null===d.key?c:d.key)||null,d.type===ac?m(b,a,d.props.children,e,d.key):k(b,a,d,e);case $b:return a=a.get(null===d.key?c:d.key)||null,l(b,a,d,e)}if(Zf(d)||lc(d))return a=a.get(c)||null,m(b,a,d,e,null);ag(b,d)}return null}function B(e,g,h,k){for(var l=null,r=null,m=g,u=g=0,p=null;null!==m&&u<h.length;u++){m.index>u?(p=m,m=null):p=m.sibling;var v=x(e,m,h[u],k);if(null===v){null===m&&(m=p);break}a&&\nm&&null===v.alternate&&b(e,m);g=f(v,g,u);null===r?l=v:r.sibling=v;r=v;m=p}if(u===h.length)return c(e,m),l;if(null===m){for(;u<h.length;u++)if(m=q(e,h[u],k))g=f(m,g,u),null===r?l=m:r.sibling=m,r=m;return l}for(m=d(e,m);u<h.length;u++)if(p=z(m,e,u,h[u],k))a&&null!==p.alternate&&m.delete(null===p.key?u:p.key),g=f(p,g,u),null===r?l=p:r.sibling=p,r=p;a&&m.forEach(function(a){return b(e,a)});return l}function Q(e,g,h,k){var l=lc(h);\"function\"!==typeof l?t(\"150\"):void 0;h=l.call(h);null==h?t(\"151\"):void 0;\nfor(var m=l=null,r=g,u=g=0,p=null,v=h.next();null!==r&&!v.done;u++,v=h.next()){r.index>u?(p=r,r=null):p=r.sibling;var y=x(e,r,v.value,k);if(null===y){r||(r=p);break}a&&r&&null===y.alternate&&b(e,r);g=f(y,g,u);null===m?l=y:m.sibling=y;m=y;r=p}if(v.done)return c(e,r),l;if(null===r){for(;!v.done;u++,v=h.next())v=q(e,v.value,k),null!==v&&(g=f(v,g,u),null===m?l=v:m.sibling=v,m=v);return l}for(r=d(e,r);!v.done;u++,v=h.next())v=z(r,e,u,v.value,k),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?u:\nv.key),g=f(v,g,u),null===m?l=v:m.sibling=v,m=v);a&&r.forEach(function(a){return b(e,a)});return l}return function(a,d,f,h){var k=\"object\"===typeof f&&null!==f&&f.type===ac&&null===f.key;k&&(f=f.props.children);var l=\"object\"===typeof f&&null!==f;if(l)switch(f.$$typeof){case Zb:a:{l=f.key;for(k=d;null!==k;){if(k.key===l)if(7===k.tag?f.type===ac:k.elementType===f.type){c(a,k.sibling);d=e(k,f.type===ac?f.props.children:f.props,h);d.ref=$f(a,k,f);d.return=a;a=d;break a}else{c(a,k);break}else b(a,k);k=\nk.sibling}f.type===ac?(d=af(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=$e(f.type,f.key,f.props,null,a.mode,h),h.ref=$f(a,d,f),h.return=a,a=h)}return g(a);case $b:a:{for(k=f.key;null!==d;){if(d.key===k)if(4===d.tag&&d.stateNode.containerInfo===f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[],h);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=df(f,a.mode,h);d.return=a;a=d}return g(a)}if(\"string\"===typeof f||\"number\"===typeof f)return f=\n\"\"+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f,h),d.return=a,a=d):(c(a,d),d=cf(f,a.mode,h),d.return=a,a=d),g(a);if(Zf(f))return B(a,d,f,h);if(lc(f))return Q(a,d,f,h);l&&ag(a,f);if(\"undefined\"===typeof f&&!k)switch(a.tag){case 1:case 0:h=a.type,t(\"152\",h.displayName||h.name||\"Component\")}return c(a,d)}}var cg=bg(!0),dg=bg(!1),eg=null,fg=null,gg=!1;\nfunction hg(a,b){var c=M(5,null,null,0);c.elementType=\"DELETED\";c.type=\"DELETED\";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function ig(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=\"\"===a.pendingProps||3!==b.nodeType?null:b,null!==b?(a.stateNode=b,!0):!1;default:return!1}}\nfunction jg(a){if(gg){var b=fg;if(b){var c=b;if(!ig(a,b)){b=Fe(c);if(!b||!ig(a,b)){a.effectTag|=2;gg=!1;eg=a;return}hg(eg,c)}eg=a;fg=Ge(b)}else a.effectTag|=2,gg=!1,eg=a}}function kg(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag;)a=a.return;eg=a}function lg(a){if(a!==eg)return!1;if(!gg)return kg(a),gg=!0,!1;var b=a.type;if(5!==a.tag||\"head\"!==b&&\"body\"!==b&&!Ce(b,a.memoizedProps))for(b=fg;b;)hg(a,b),b=Fe(b);kg(a);fg=eg?Fe(a.stateNode):null;return!0}function mg(){fg=eg=null;gg=!1}var ng=Xb.ReactCurrentOwner;\nfunction P(a,b,c,d){b.child=null===a?dg(b,null,c,d):cg(b,a.child,c,d)}function og(a,b,c,d,e){c=c.render;var f=b.ref;Cf(b,e);d=c(d,f);b.effectTag|=1;P(a,b,d,e);return b.child}\nfunction pg(a,b,c,d,e,f){if(null===a){var g=c.type;if(\"function\"===typeof g&&!Xe(g)&&void 0===g.defaultProps&&null===c.compare)return b.tag=15,b.type=g,qg(a,b,g,d,e,f);a=$e(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:jd,c(e,d)&&a.ref===b.ref))return rg(a,b,f);b.effectTag|=1;a=Ze(g,d,f);a.ref=b.ref;a.return=b;return b.child=a}\nfunction qg(a,b,c,d,e,f){return null!==a&&e<f&&jd(a.memoizedProps,d)&&a.ref===b.ref?rg(a,b,f):sg(a,b,c,d,f)}function tg(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function sg(a,b,c,d,e){var f=L(c)?Ke:J.current;f=Le(b,f);Cf(b,e);c=c(d,f);b.effectTag|=1;P(a,b,c,e);return b.child}\nfunction ug(a,b,c,d,e){if(L(c)){var f=!0;Qe(b)}else f=!1;Cf(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Wf(b,c,d,e),Yf(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var k=g.context,l=c.contextType;\"object\"===typeof l&&null!==l?l=Nf.currentDispatcher.readContext(l):(l=L(c)?Ke:J.current,l=Le(b,l));var m=c.getDerivedStateFromProps,q=\"function\"===typeof m||\"function\"===typeof g.getSnapshotBeforeUpdate;q||\"function\"!==typeof g.UNSAFE_componentWillReceiveProps&&\n\"function\"!==typeof g.componentWillReceiveProps||(h!==d||k!==l)&&Xf(b,g,d,l);jf=!1;var x=b.memoizedState;k=g.state=x;var z=b.updateQueue;null!==z&&(sf(b,z,d,g,e),k=b.memoizedState);h!==d||x!==k||K.current||jf?(\"function\"===typeof m&&(Pf(b,c,m,d),k=b.memoizedState),(h=jf||Vf(b,c,h,d,x,k,l))?(q||\"function\"!==typeof g.UNSAFE_componentWillMount&&\"function\"!==typeof g.componentWillMount||(\"function\"===typeof g.componentWillMount&&g.componentWillMount(),\"function\"===typeof g.UNSAFE_componentWillMount&&\ng.UNSAFE_componentWillMount()),\"function\"===typeof g.componentDidMount&&(b.effectTag|=4)):(\"function\"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=k),g.props=d,g.state=k,g.context=l,d=h):(\"function\"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,h=b.memoizedProps,g.props=b.type===b.elementType?h:O(b.type,h),k=g.context,l=c.contextType,\"object\"===typeof l&&null!==l?l=Nf.currentDispatcher.readContext(l):(l=L(c)?Ke:J.current,l=Le(b,l)),m=c.getDerivedStateFromProps,\n(q=\"function\"===typeof m||\"function\"===typeof g.getSnapshotBeforeUpdate)||\"function\"!==typeof g.UNSAFE_componentWillReceiveProps&&\"function\"!==typeof g.componentWillReceiveProps||(h!==d||k!==l)&&Xf(b,g,d,l),jf=!1,k=b.memoizedState,x=g.state=k,z=b.updateQueue,null!==z&&(sf(b,z,d,g,e),x=b.memoizedState),h!==d||k!==x||K.current||jf?(\"function\"===typeof m&&(Pf(b,c,m,d),x=b.memoizedState),(m=jf||Vf(b,c,h,d,k,x,l))?(q||\"function\"!==typeof g.UNSAFE_componentWillUpdate&&\"function\"!==typeof g.componentWillUpdate||\n(\"function\"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,x,l),\"function\"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,x,l)),\"function\"===typeof g.componentDidUpdate&&(b.effectTag|=4),\"function\"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):(\"function\"!==typeof g.componentDidUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=4),\"function\"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=256),b.memoizedProps=\nd,b.memoizedState=x),g.props=d,g.state=x,g.context=l,d=m):(\"function\"!==typeof g.componentDidUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=4),\"function\"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=256),d=!1);return vg(a,b,c,d,f,e)}\nfunction vg(a,b,c,d,e,f){tg(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Re(b,c,!1),rg(a,b,f);d=b.stateNode;ng.current=b;var h=g&&\"function\"!==typeof c.getDerivedStateFromError?null:d.render();b.effectTag|=1;null!==a&&g?(b.child=cg(b,a.child,null,f),b.child=cg(b,null,h,f)):P(a,b,h,f);b.memoizedState=d.state;e&&Re(b,c,!0);return b.child}function wg(a){var b=a.stateNode;b.pendingContext?Oe(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Oe(a,b.context,!1);If(a,b.containerInfo)}\nfunction xg(a,b,c){var d=b.mode,e=b.pendingProps,f=b.memoizedState;if(0===(b.effectTag&64)){f=null;var g=!1}else f={timedOutAt:null!==f?f.timedOutAt:0},g=!0,b.effectTag&=-65;null===a?g?(g=e.fallback,e=af(null,d,0,null),0===(b.mode&1)&&(e.child=null!==b.memoizedState?b.child.child:b.child),d=af(g,d,c,null),e.sibling=d,c=e,c.return=d.return=b):c=d=dg(b,null,e.children,c):null!==a.memoizedState?(d=a.child,a=d.sibling,g?(c=e.fallback,e=Ze(d,d.pendingProps,0),0===(b.mode&1)&&(g=null!==b.memoizedState?\nb.child.child:b.child,g!==d.child&&(e.child=g)),d=e.sibling=Ze(a,c,a.expirationTime),c=e,e.childExpirationTime=0,c.return=d.return=b):c=d=cg(b,d.child,e.children,c)):(a=a.child,g?(g=e.fallback,e=af(null,d,0,null),e.child=a,0===(b.mode&1)&&(e.child=null!==b.memoizedState?b.child.child:b.child),d=e.sibling=af(g,d,c,null),d.effectTag|=2,c=e,e.childExpirationTime=0,c.return=d.return=b):d=c=cg(b,a,e.children,c));b.memoizedState=f;b.child=c;return d}\nfunction rg(a,b,c){null!==a&&(b.firstContextDependency=a.firstContextDependency);if(b.childExpirationTime<c)return null;null!==a&&b.child!==a.child?t(\"153\"):void 0;if(null!==b.child){a=b.child;c=Ze(a,a.pendingProps,a.expirationTime);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Ze(a,a.pendingProps,a.expirationTime),c.return=b;c.sibling=null}return b.child}\nfunction yg(a,b,c){var d=b.expirationTime;if(null!==a&&a.memoizedProps===b.pendingProps&&!K.current&&d<c){switch(b.tag){case 3:wg(b);mg();break;case 5:Kf(b);break;case 1:L(b.type)&&Qe(b);break;case 4:If(b,b.stateNode.containerInfo);break;case 10:Af(b,b.memoizedProps.value);break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;if(0!==d&&d>=c)return xg(a,b,c);b=rg(a,b,c);return null!==b?b.sibling:null}}return rg(a,b,c)}b.expirationTime=0;switch(b.tag){case 2:d=b.elementType;null!==\na&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;var e=Le(b,J.current);Cf(b,c);e=d(a,e);b.effectTag|=1;if(\"object\"===typeof e&&null!==e&&\"function\"===typeof e.render&&void 0===e.$$typeof){b.tag=1;if(L(d)){var f=!0;Qe(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;var g=d.getDerivedStateFromProps;\"function\"===typeof g&&Pf(b,d,g,a);e.updater=Uf;b.stateNode=e;e._reactInternalFiber=b;Yf(b,d,a,c);b=vg(null,b,d,!0,f,c)}else b.tag=0,P(null,b,e,c),b=b.child;\nreturn b;case 16:e=b.elementType;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);f=b.pendingProps;a=Mf(e);b.type=a;e=b.tag=Ye(a);f=O(a,f);g=void 0;switch(e){case 0:g=sg(null,b,a,f,c);break;case 1:g=ug(null,b,a,f,c);break;case 11:g=og(null,b,a,f,c);break;case 14:g=pg(null,b,a,O(a.type,f),d,c);break;default:t(\"283\",a)}return g;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:O(d,e),sg(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:O(d,e),ug(a,b,d,\ne,c);case 3:wg(b);d=b.updateQueue;null===d?t(\"282\"):void 0;e=b.memoizedState;e=null!==e?e.element:null;sf(b,d,b.pendingProps,null,c);d=b.memoizedState.element;if(d===e)mg(),b=rg(a,b,c);else{e=b.stateNode;if(e=(null===a||null===a.child)&&e.hydrate)fg=Ge(b.stateNode.containerInfo),eg=b,e=gg=!0;e?(b.effectTag|=2,b.child=dg(b,null,d,c)):(P(a,b,d,c),mg());b=b.child}return b;case 5:return Kf(b),null===a&&jg(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:null,g=e.children,Ce(d,e)?g=null:null!==\nf&&Ce(d,f)&&(b.effectTag|=16),tg(a,b),1!==c&&b.mode&1&&e.hidden?(b.expirationTime=1,b=null):(P(a,b,g,c),b=b.child),b;case 6:return null===a&&jg(b),null;case 13:return xg(a,b,c);case 4:return If(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=cg(b,null,d,c):P(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:O(d,e),og(a,b,d,e,c);case 7:return P(a,b,b.pendingProps,c),b.child;case 8:return P(a,b,b.pendingProps.children,c),b.child;case 12:return P(a,b,b.pendingProps.children,\nc),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;Af(b,f);if(null!==g){var h=g.value;f=h===f&&(0!==h||1/h===1/f)||h!==h&&f!==f?0:(\"function\"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0;if(0===f){if(g.children===e.children&&!K.current){b=rg(a,b,c);break a}}else for(g=b.child,null!==g&&(g.return=b);null!==g;){h=g.firstContextDependency;if(null!==h){do{if(h.context===d&&0!==(h.observedBits&f)){if(1===g.tag){var k=mf(c);k.tag=2;of(g,k)}g.expirationTime<\nc&&(g.expirationTime=c);k=g.alternate;null!==k&&k.expirationTime<c&&(k.expirationTime=c);for(var l=g.return;null!==l;){k=l.alternate;if(l.childExpirationTime<c)l.childExpirationTime=c,null!==k&&k.childExpirationTime<c&&(k.childExpirationTime=c);else if(null!==k&&k.childExpirationTime<c)k.childExpirationTime=c;else break;l=l.return}}k=g.child;h=h.next}while(null!==h)}else k=10===g.tag?g.type===b.type?null:g.child:g.child;if(null!==k)k.return=g;else for(k=g;null!==k;){if(k===b){k=null;break}g=k.sibling;\nif(null!==g){g.return=k.return;k=g;break}k=k.return}g=k}}P(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,Cf(b,c),e=Df(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,P(a,b,d,c),b.child;case 14:return e=b.type,f=O(e.type,b.pendingProps),pg(a,b,e,f,d,c);case 15:return qg(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:O(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,L(d)?(a=!0,Qe(b)):\na=!1,Cf(b,c),Wf(b,d,e,c),Yf(b,d,e,c),vg(null,b,d,!0,a,c);default:t(\"156\")}}function zg(a){a.effectTag|=4}var Ag=void 0,Bg=void 0,Fg=void 0,Gg=void 0;Ag=function(a,b){for(var c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};Bg=function(){};\nFg=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Hf(N.current);a=null;switch(c){case \"input\":f=Ac(g,f);d=Ac(g,d);a=[];break;case \"option\":f=ee(g,f);d=ee(g,d);a=[];break;case \"select\":f=n({},f,{value:void 0});d=n({},d,{value:void 0});a=[];break;case \"textarea\":f=ge(g,f);d=ge(g,d);a=[];break;default:\"function\"!==typeof f.onClick&&\"function\"===typeof d.onClick&&(g.onclick=ye)}ve(c,d);g=c=void 0;var h=null;for(c in f)if(!d.hasOwnProperty(c)&&f.hasOwnProperty(c)&&null!=f[c])if(\"style\"===\nc){var k=f[c];for(g in k)k.hasOwnProperty(g)&&(h||(h={}),h[g]=\"\")}else\"dangerouslySetInnerHTML\"!==c&&\"children\"!==c&&\"suppressContentEditableWarning\"!==c&&\"suppressHydrationWarning\"!==c&&\"autoFocus\"!==c&&(sa.hasOwnProperty(c)?a||(a=[]):(a=a||[]).push(c,null));for(c in d){var l=d[c];k=null!=f?f[c]:void 0;if(d.hasOwnProperty(c)&&l!==k&&(null!=l||null!=k))if(\"style\"===c)if(k){for(g in k)!k.hasOwnProperty(g)||l&&l.hasOwnProperty(g)||(h||(h={}),h[g]=\"\");for(g in l)l.hasOwnProperty(g)&&k[g]!==l[g]&&(h||\n(h={}),h[g]=l[g])}else h||(a||(a=[]),a.push(c,h)),h=l;else\"dangerouslySetInnerHTML\"===c?(l=l?l.__html:void 0,k=k?k.__html:void 0,null!=l&&k!==l&&(a=a||[]).push(c,\"\"+l)):\"children\"===c?k===l||\"string\"!==typeof l&&\"number\"!==typeof l||(a=a||[]).push(c,\"\"+l):\"suppressContentEditableWarning\"!==c&&\"suppressHydrationWarning\"!==c&&(sa.hasOwnProperty(c)?(null!=l&&xe(e,c),a||k===l||(a=[])):(a=a||[]).push(c,l))}h&&(a=a||[]).push(\"style\",h);e=a;(b.updateQueue=e)&&zg(b)}};Gg=function(a,b,c,d){c!==d&&zg(b)};\nfunction Hg(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=nc(c));null!==c&&mc(c.type);b=b.value;null!==a&&1===a.tag&&mc(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function Ig(a){var b=a.ref;if(null!==b)if(\"function\"===typeof b)try{b(null)}catch(c){Jg(a,c)}else b.current=null}\nfunction Kg(a){\"function\"===typeof Te&&Te(a);switch(a.tag){case 0:case 11:case 14:case 15:var b=a.updateQueue;if(null!==b&&(b=b.lastEffect,null!==b)){var c=b=b.next;do{var d=c.destroy;if(null!==d){var e=a;try{d()}catch(f){Jg(e,f)}}c=c.next}while(c!==b)}break;case 1:Ig(a);b=a.stateNode;if(\"function\"===typeof b.componentWillUnmount)try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(f){Jg(a,f)}break;case 5:Ig(a);break;case 4:Lg(a)}}\nfunction Mg(a){return 5===a.tag||3===a.tag||4===a.tag}\nfunction Ng(a){a:{for(var b=a.return;null!==b;){if(Mg(b)){var c=b;break a}b=b.return}t(\"160\");c=void 0}var d=b=void 0;switch(c.tag){case 5:b=c.stateNode;d=!1;break;case 3:b=c.stateNode.containerInfo;d=!0;break;case 4:b=c.stateNode.containerInfo;d=!0;break;default:t(\"161\")}c.effectTag&16&&(pe(b,\"\"),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Mg(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag;){if(c.effectTag&2)continue b;\nif(null===c.child||4===c.tag)continue b;else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}for(var e=a;;){if(5===e.tag||6===e.tag)if(c)if(d){var f=b,g=e.stateNode,h=c;8===f.nodeType?f.parentNode.insertBefore(g,h):f.insertBefore(g,h)}else b.insertBefore(e.stateNode,c);else d?(g=b,h=e.stateNode,8===g.nodeType?(f=g.parentNode,f.insertBefore(h,g)):(f=g,f.appendChild(h)),g=g._reactRootContainer,null!==g&&void 0!==g||null!==f.onclick||(f.onclick=ye)):b.appendChild(e.stateNode);\nelse if(4!==e.tag&&null!==e.child){e.child.return=e;e=e.child;continue}if(e===a)break;for(;null===e.sibling;){if(null===e.return||e.return===a)return;e=e.return}e.sibling.return=e.return;e=e.sibling}}\nfunction Lg(a){for(var b=a,c=!1,d=void 0,e=void 0;;){if(!c){c=b.return;a:for(;;){null===c?t(\"160\"):void 0;switch(c.tag){case 5:d=c.stateNode;e=!1;break a;case 3:d=c.stateNode.containerInfo;e=!0;break a;case 4:d=c.stateNode.containerInfo;e=!0;break a}c=c.return}c=!0}if(5===b.tag||6===b.tag){a:for(var f=b,g=f;;)if(Kg(g),null!==g.child&&4!==g.tag)g.child.return=g,g=g.child;else{if(g===f)break;for(;null===g.sibling;){if(null===g.return||g.return===f)break a;g=g.return}g.sibling.return=g.return;g=g.sibling}e?\n(f=d,g=b.stateNode,8===f.nodeType?f.parentNode.removeChild(g):f.removeChild(g)):d.removeChild(b.stateNode)}else if(4===b.tag?(d=b.stateNode.containerInfo,e=!0):Kg(b),null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return;b=b.return;4===b.tag&&(c=!1)}b.sibling.return=b.return;b=b.sibling}}\nfunction Og(a,b){switch(b.tag){case 0:case 11:case 14:case 15:break;case 1:break;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[Ha]=d;\"input\"===a&&\"radio\"===d.type&&null!=d.name&&Cc(c,d);we(a,e);b=we(a,d);for(e=0;e<f.length;e+=2){var g=f[e],h=f[e+1];\"style\"===g?te(c,h):\"dangerouslySetInnerHTML\"===g?oe(c,h):\"children\"===g?pe(c,h):yc(c,g,h,b)}switch(a){case \"input\":Dc(c,d);break;case \"textarea\":ie(c,\nd);break;case \"select\":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?fe(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?fe(c,!!d.multiple,d.defaultValue,!0):fe(c,!!d.multiple,d.multiple?[]:\"\",!1))}}}break;case 6:null===b.stateNode?t(\"162\"):void 0;b.stateNode.nodeValue=b.memoizedProps;break;case 3:break;case 12:break;case 13:c=b.memoizedState;a=b;null===c?d=!1:(d=!0,a=b.child,0===c.timedOutAt&&(c.timedOutAt=Qf()));if(null!==a)a:for(b=c=a;;){if(5===\nb.tag)a=b.stateNode,d?a.style.display=\"none\":(a=b.stateNode,f=b.memoizedProps.style,f=void 0!==f&&null!==f&&f.hasOwnProperty(\"display\")?f.display:null,a.style.display=se(\"display\",f));else if(6===b.tag)b.stateNode.nodeValue=d?\"\":b.memoizedProps;else if(13===b.tag&&null!==b.memoizedState){a=b.child.sibling;a.return=b;b=a;continue}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===c)break a;for(;null===b.sibling;){if(null===b.return||b.return===c)break a;b=b.return}b.sibling.return=\nb.return;b=b.sibling}break;case 17:break;default:t(\"163\")}}function Pg(a,b,c){c=mf(c);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){Qg(d);Hg(a,b)};return c}\nfunction Rg(a,b,c){c=mf(c);c.tag=3;var d=a.type.getDerivedStateFromError;if(\"function\"===typeof d){var e=b.value;c.payload=function(){return d(e)}}var f=a.stateNode;null!==f&&\"function\"===typeof f.componentDidCatch&&(c.callback=function(){\"function\"!==typeof d&&(null===Sg?Sg=new Set([this]):Sg.add(this));var c=b.value,e=b.stack;Hg(a,b);this.componentDidCatch(c,{componentStack:null!==e?e:\"\"})});return c}\nfunction Tg(a){switch(a.tag){case 1:L(a.type)&&Me(a);var b=a.effectTag;return b&2048?(a.effectTag=b&-2049|64,a):null;case 3:return Jf(a),Ne(a),b=a.effectTag,0!==(b&64)?t(\"285\"):void 0,a.effectTag=b&-2049|64,a;case 5:return Lf(a),null;case 13:return b=a.effectTag,b&2048?(a.effectTag=b&-2049|64,a):null;case 4:return Jf(a),null;case 10:return Bf(a),null;default:return null}}\nvar Ug={readContext:Df},Vg=Xb.ReactCurrentOwner,Wg=1073741822,Xg=0,Yg=!1,R=null,S=null,T=0,Zg=-1,$g=!1,U=null,ah=!1,bh=null,ch=null,Sg=null;function dh(){if(null!==R)for(var a=R.return;null!==a;){var b=a;switch(b.tag){case 1:var c=b.type.childContextTypes;null!==c&&void 0!==c&&Me(b);break;case 3:Jf(b);Ne(b);break;case 5:Lf(b);break;case 4:Jf(b);break;case 10:Bf(b)}a=a.return}S=null;T=0;Zg=-1;$g=!1;R=null}function Sf(){null!==ch&&(ba.unstable_cancelCallback(bh),ch())}\nfunction eh(a){for(;;){var b=a.alternate,c=a.return,d=a.sibling;if(0===(a.effectTag&1024)){R=a;a:{var e=b;b=a;var f=T;var g=b.pendingProps;switch(b.tag){case 2:break;case 16:break;case 15:case 0:break;case 1:L(b.type)&&Me(b);break;case 3:Jf(b);Ne(b);g=b.stateNode;g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null);if(null===e||null===e.child)lg(b),b.effectTag&=-3;Bg(b);break;case 5:Lf(b);var h=Hf(Gf.current);f=b.type;if(null!==e&&null!=b.stateNode)Fg(e,b,f,g,h),e.ref!==b.ref&&(b.effectTag|=\n128);else if(g){var k=Hf(N.current);if(lg(b)){g=b;e=g.stateNode;var l=g.type,m=g.memoizedProps,q=h;e[Ga]=g;e[Ha]=m;f=void 0;h=l;switch(h){case \"iframe\":case \"object\":G(\"load\",e);break;case \"video\":case \"audio\":for(l=0;l<bb.length;l++)G(bb[l],e);break;case \"source\":G(\"error\",e);break;case \"img\":case \"image\":case \"link\":G(\"error\",e);G(\"load\",e);break;case \"form\":G(\"reset\",e);G(\"submit\",e);break;case \"details\":G(\"toggle\",e);break;case \"input\":Bc(e,m);G(\"invalid\",e);xe(q,\"onChange\");break;case \"select\":e._wrapperState=\n{wasMultiple:!!m.multiple};G(\"invalid\",e);xe(q,\"onChange\");break;case \"textarea\":he(e,m),G(\"invalid\",e),xe(q,\"onChange\")}ve(h,m);l=null;for(f in m)m.hasOwnProperty(f)&&(k=m[f],\"children\"===f?\"string\"===typeof k?e.textContent!==k&&(l=[\"children\",k]):\"number\"===typeof k&&e.textContent!==\"\"+k&&(l=[\"children\",\"\"+k]):sa.hasOwnProperty(f)&&null!=k&&xe(q,f));switch(h){case \"input\":Vb(e);Fc(e,m,!0);break;case \"textarea\":Vb(e);je(e,m);break;case \"select\":case \"option\":break;default:\"function\"===typeof m.onClick&&\n(e.onclick=ye)}f=l;g.updateQueue=f;g=null!==f?!0:!1;g&&zg(b)}else{m=b;e=f;q=g;l=9===h.nodeType?h:h.ownerDocument;k===ke.html&&(k=le(e));k===ke.html?\"script\"===e?(e=l.createElement(\"div\"),e.innerHTML=\"<script>\\x3c/script>\",l=e.removeChild(e.firstChild)):\"string\"===typeof q.is?l=l.createElement(e,{is:q.is}):(l=l.createElement(e),\"select\"===e&&q.multiple&&(l.multiple=!0)):l=l.createElementNS(k,e);e=l;e[Ga]=m;e[Ha]=g;Ag(e,b,!1,!1);q=e;l=f;m=g;var x=h,z=we(l,m);switch(l){case \"iframe\":case \"object\":G(\"load\",\nq);h=m;break;case \"video\":case \"audio\":for(h=0;h<bb.length;h++)G(bb[h],q);h=m;break;case \"source\":G(\"error\",q);h=m;break;case \"img\":case \"image\":case \"link\":G(\"error\",q);G(\"load\",q);h=m;break;case \"form\":G(\"reset\",q);G(\"submit\",q);h=m;break;case \"details\":G(\"toggle\",q);h=m;break;case \"input\":Bc(q,m);h=Ac(q,m);G(\"invalid\",q);xe(x,\"onChange\");break;case \"option\":h=ee(q,m);break;case \"select\":q._wrapperState={wasMultiple:!!m.multiple};h=n({},m,{value:void 0});G(\"invalid\",q);xe(x,\"onChange\");break;case \"textarea\":he(q,\nm);h=ge(q,m);G(\"invalid\",q);xe(x,\"onChange\");break;default:h=m}ve(l,h);k=void 0;var B=l,Q=q,v=h;for(k in v)if(v.hasOwnProperty(k)){var r=v[k];\"style\"===k?te(Q,r):\"dangerouslySetInnerHTML\"===k?(r=r?r.__html:void 0,null!=r&&oe(Q,r)):\"children\"===k?\"string\"===typeof r?(\"textarea\"!==B||\"\"!==r)&&pe(Q,r):\"number\"===typeof r&&pe(Q,\"\"+r):\"suppressContentEditableWarning\"!==k&&\"suppressHydrationWarning\"!==k&&\"autoFocus\"!==k&&(sa.hasOwnProperty(k)?null!=r&&xe(x,k):null!=r&&yc(Q,k,r,z))}switch(l){case \"input\":Vb(q);\nFc(q,m,!1);break;case \"textarea\":Vb(q);je(q,m);break;case \"option\":null!=m.value&&q.setAttribute(\"value\",\"\"+zc(m.value));break;case \"select\":h=q;h.multiple=!!m.multiple;q=m.value;null!=q?fe(h,!!m.multiple,q,!1):null!=m.defaultValue&&fe(h,!!m.multiple,m.defaultValue,!0);break;default:\"function\"===typeof h.onClick&&(q.onclick=ye)}(g=Be(f,g))&&zg(b);b.stateNode=e}null!==b.ref&&(b.effectTag|=128)}else null===b.stateNode?t(\"166\"):void 0;break;case 6:e&&null!=b.stateNode?Gg(e,b,e.memoizedProps,g):(\"string\"!==\ntypeof g&&(null===b.stateNode?t(\"166\"):void 0),e=Hf(Gf.current),Hf(N.current),lg(b)?(g=b,f=g.stateNode,e=g.memoizedProps,f[Ga]=g,(g=f.nodeValue!==e)&&zg(b)):(f=b,g=(9===e.nodeType?e:e.ownerDocument).createTextNode(g),g[Ga]=b,f.stateNode=g));break;case 11:break;case 13:g=b.memoizedState;if(0!==(b.effectTag&64)){b.expirationTime=f;R=b;break a}g=null!==g;f=null!==e&&null!==e.memoizedState;null!==e&&!g&&f&&(e=e.child.sibling,null!==e&&(h=b.firstEffect,null!==h?(b.firstEffect=e,e.nextEffect=h):(b.firstEffect=\nb.lastEffect=e,e.nextEffect=null),e.effectTag=8));if(g!==f||0===(b.effectTag&1)&&g)b.effectTag|=4;break;case 7:break;case 8:break;case 12:break;case 4:Jf(b);Bg(b);break;case 10:Bf(b);break;case 9:break;case 14:break;case 17:L(b.type)&&Me(b);break;default:t(\"156\")}R=null}b=a;if(1===T||1!==b.childExpirationTime){g=0;for(f=b.child;null!==f;)e=f.expirationTime,h=f.childExpirationTime,e>g&&(g=e),h>g&&(g=h),f=f.sibling;b.childExpirationTime=g}if(null!==R)return R;null!==c&&0===(c.effectTag&1024)&&(null===\nc.firstEffect&&(c.firstEffect=a.firstEffect),null!==a.lastEffect&&(null!==c.lastEffect&&(c.lastEffect.nextEffect=a.firstEffect),c.lastEffect=a.lastEffect),1<a.effectTag&&(null!==c.lastEffect?c.lastEffect.nextEffect=a:c.firstEffect=a,c.lastEffect=a))}else{a=Tg(a,T);if(null!==a)return a.effectTag&=1023,a;null!==c&&(c.firstEffect=c.lastEffect=null,c.effectTag|=1024)}if(null!==d)return d;if(null!==c)a=c;else break}return null}\nfunction fh(a){var b=yg(a.alternate,a,T);a.memoizedProps=a.pendingProps;null===b&&(b=eh(a));Vg.current=null;return b}\nfunction gh(a,b){Yg?t(\"243\"):void 0;Sf();Yg=!0;Vg.currentDispatcher=Ug;var c=a.nextExpirationTimeToWorkOn;if(c!==T||a!==S||null===R)dh(),S=a,T=c,R=Ze(S.current,null,T),a.pendingCommitExpirationTime=0;var d=!1;do{try{if(b)for(;null!==R&&!hh();)R=fh(R);else for(;null!==R;)R=fh(R)}catch(B){if(zf=yf=xf=null,null===R)d=!0,Qg(B);else{null===R?t(\"271\"):void 0;var e=R,f=e.return;if(null===f)d=!0,Qg(B);else{a:{var g=a,h=f,k=e,l=B;f=T;k.effectTag|=1024;k.firstEffect=k.lastEffect=null;if(null!==l&&\"object\"===\ntypeof l&&\"function\"===typeof l.then){var m=l;l=h;var q=-1,x=-1;do{if(13===l.tag){var z=l.alternate;if(null!==z&&(z=z.memoizedState,null!==z)){x=10*(1073741822-z.timedOutAt);break}z=l.pendingProps.maxDuration;if(\"number\"===typeof z)if(0>=z)q=0;else if(-1===q||z<q)q=z}l=l.return}while(null!==l);l=h;do{if(z=13===l.tag)z=void 0===l.memoizedProps.fallback?!1:null===l.memoizedState;if(z){h=ih.bind(null,g,l,k,0===(l.mode&1)?1073741823:f);m.then(h,h);if(0===(l.mode&1)){l.effectTag|=64;k.effectTag&=-1957;\n1===k.tag&&null===k.alternate&&(k.tag=17);k.expirationTime=f;break a}-1===q?g=1073741823:(-1===x&&(x=10*(1073741822-hf(g,f))-5E3),g=x+q);0<=g&&Zg<g&&(Zg=g);l.effectTag|=2048;l.expirationTime=f;break a}l=l.return}while(null!==l);l=Error((mc(k.type)||\"A React component\")+\" suspended while rendering, but no fallback UI was specified.\\n\\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.\"+nc(k))}$g=!0;l=vf(l,k);g=h;do{switch(g.tag){case 3:k=\nl;g.effectTag|=2048;g.expirationTime=f;f=Pg(g,k,f);pf(g,f);break a;case 1:if(k=l,h=g.type,m=g.stateNode,0===(g.effectTag&64)&&(\"function\"===typeof h.getDerivedStateFromError||null!==m&&\"function\"===typeof m.componentDidCatch&&(null===Sg||!Sg.has(m)))){g.effectTag|=2048;g.expirationTime=f;f=Rg(g,k,f);pf(g,f);break a}}g=g.return}while(null!==g)}R=eh(e);continue}}}break}while(1);Yg=!1;zf=yf=xf=Vg.currentDispatcher=null;if(d)S=null,a.finishedWork=null;else if(null!==R)a.finishedWork=null;else{d=a.current.alternate;\nnull===d?t(\"281\"):void 0;S=null;if($g){e=a.latestPendingTime;f=a.latestSuspendedTime;g=a.latestPingedTime;if(0!==e&&e<c||0!==f&&f<c||0!==g&&g<c){gf(a,c);jh(a,d,c,a.expirationTime,-1);return}if(!a.didError&&b){a.didError=!0;c=a.nextExpirationTimeToWorkOn=c;b=a.expirationTime=1073741823;jh(a,d,c,b,-1);return}}b&&-1!==Zg?(gf(a,c),b=10*(1073741822-hf(a,c)),b<Zg&&(Zg=b),b=10*(1073741822-Qf()),b=Zg-b,jh(a,d,c,a.expirationTime,0>b?0:b)):(a.pendingCommitExpirationTime=c,a.finishedWork=d)}}\nfunction Jg(a,b){for(var c=a.return;null!==c;){switch(c.tag){case 1:var d=c.stateNode;if(\"function\"===typeof c.type.getDerivedStateFromError||\"function\"===typeof d.componentDidCatch&&(null===Sg||!Sg.has(d))){a=vf(b,a);a=Rg(c,a,1073741823);of(c,a);Tf(c,1073741823);return}break;case 3:a=vf(b,a);a=Pg(c,a,1073741823);of(c,a);Tf(c,1073741823);return}c=c.return}3===a.tag&&(c=vf(b,a),c=Pg(a,c,1073741823),of(a,c),Tf(a,1073741823))}\nfunction Rf(a,b){0!==Xg?a=Xg:Yg?a=ah?1073741823:T:b.mode&1?(a=kh?1073741822-10*(((1073741822-a+15)/10|0)+1):1073741822-25*(((1073741822-a+500)/25|0)+1),null!==S&&a===T&&--a):a=1073741823;kh&&(0===lh||a<lh)&&(lh=a);return a}\nfunction ih(a,b,c,d){var e=a.earliestSuspendedTime;var f=a.latestSuspendedTime;if(0!==e&&d<=e&&d>=f){f=e=d;a.didError=!1;var g=a.latestPingedTime;if(0===g||g>f)a.latestPingedTime=f;ff(f,a)}else e=Qf(),e=Rf(e,b),ef(a,e);0!==(b.mode&1)&&a===S&&T===d&&(S=null);mh(b,e);0===(b.mode&1)&&(mh(c,e),1===c.tag&&null!==c.stateNode&&(b=mf(e),b.tag=2,of(c,b)));c=a.expirationTime;0!==c&&nh(a,c)}\nfunction mh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}return e}\nfunction Tf(a,b){a=mh(a,b);null!==a&&(!Yg&&0!==T&&b>T&&dh(),ef(a,b),Yg&&!ah&&S===a||nh(a,a.expirationTime),oh>ph&&(oh=0,t(\"185\")))}function qh(a,b,c,d,e){var f=Xg;Xg=1073741823;try{return a(b,c,d,e)}finally{Xg=f}}var rh=null,V=null,sh=0,th=void 0,W=!1,uh=null,X=0,lh=0,vh=!1,wh=null,Z=!1,xh=!1,kh=!1,yh=null,zh=ba.unstable_now(),Ah=1073741822-(zh/10|0),Bh=Ah,ph=50,oh=0,Ch=null;function Dh(){Ah=1073741822-((ba.unstable_now()-zh)/10|0)}\nfunction Eh(a,b){if(0!==sh){if(b<sh)return;null!==th&&ba.unstable_cancelCallback(th)}sh=b;a=ba.unstable_now()-zh;th=ba.unstable_scheduleCallback(Fh,{timeout:10*(1073741822-b)-a})}function jh(a,b,c,d,e){a.expirationTime=d;0!==e||hh()?0<e&&(a.timeoutHandle=De(Gh.bind(null,a,b,c),e)):(a.pendingCommitExpirationTime=c,a.finishedWork=b)}function Gh(a,b,c){a.pendingCommitExpirationTime=c;a.finishedWork=b;Dh();Bh=Ah;Hh(a,c)}function Qf(){if(W)return Bh;Ih();if(0===X||1===X)Dh(),Bh=Ah;return Bh}\nfunction nh(a,b){null===a.nextScheduledRoot?(a.expirationTime=b,null===V?(rh=V=a,a.nextScheduledRoot=a):(V=V.nextScheduledRoot=a,V.nextScheduledRoot=rh)):b>a.expirationTime&&(a.expirationTime=b);W||(Z?xh&&(uh=a,X=1073741823,Jh(a,1073741823,!1)):1073741823===b?Kh(1073741823,!1):Eh(a,b))}\nfunction Ih(){var a=0,b=null;if(null!==V)for(var c=V,d=rh;null!==d;){var e=d.expirationTime;if(0===e){null===c||null===V?t(\"244\"):void 0;if(d===d.nextScheduledRoot){rh=V=d.nextScheduledRoot=null;break}else if(d===rh)rh=e=d.nextScheduledRoot,V.nextScheduledRoot=e,d.nextScheduledRoot=null;else if(d===V){V=c;V.nextScheduledRoot=rh;d.nextScheduledRoot=null;break}else c.nextScheduledRoot=d.nextScheduledRoot,d.nextScheduledRoot=null;d=c.nextScheduledRoot}else{e>a&&(a=e,b=d);if(d===V)break;if(1073741823===\na)break;c=d;d=d.nextScheduledRoot}}uh=b;X=a}var Lh=!1;function hh(){return Lh?!0:ba.unstable_shouldYield()?Lh=!0:!1}function Fh(){try{if(!hh()&&null!==rh){Dh();var a=rh;do{var b=a.expirationTime;0!==b&&Ah<=b&&(a.nextExpirationTimeToWorkOn=Ah);a=a.nextScheduledRoot}while(a!==rh)}Kh(0,!0)}finally{Lh=!1}}\nfunction Kh(a,b){Ih();if(b)for(Dh(),Bh=Ah;null!==uh&&0!==X&&a<=X&&!(Lh&&Ah>X);)Jh(uh,X,Ah>X),Ih(),Dh(),Bh=Ah;else for(;null!==uh&&0!==X&&a<=X;)Jh(uh,X,!1),Ih();b&&(sh=0,th=null);0!==X&&Eh(uh,X);oh=0;Ch=null;if(null!==yh)for(a=yh,yh=null,b=0;b<a.length;b++){var c=a[b];try{c._onComplete()}catch(d){vh||(vh=!0,wh=d)}}if(vh)throw a=wh,wh=null,vh=!1,a;}function Hh(a,b){W?t(\"253\"):void 0;uh=a;X=b;Jh(a,b,!1);Kh(1073741823,!1)}\nfunction Jh(a,b,c){W?t(\"245\"):void 0;W=!0;if(c){var d=a.finishedWork;null!==d?Mh(a,d,b):(a.finishedWork=null,d=a.timeoutHandle,-1!==d&&(a.timeoutHandle=-1,Ee(d)),gh(a,c),d=a.finishedWork,null!==d&&(hh()?a.finishedWork=d:Mh(a,d,b)))}else d=a.finishedWork,null!==d?Mh(a,d,b):(a.finishedWork=null,d=a.timeoutHandle,-1!==d&&(a.timeoutHandle=-1,Ee(d)),gh(a,c),d=a.finishedWork,null!==d&&Mh(a,d,b));W=!1}\nfunction Mh(a,b,c){var d=a.firstBatch;if(null!==d&&d._expirationTime>=c&&(null===yh?yh=[d]:yh.push(d),d._defer)){a.finishedWork=b;a.expirationTime=0;return}a.finishedWork=null;a===Ch?oh++:(Ch=a,oh=0);ah=Yg=!0;a.current===b?t(\"177\"):void 0;c=a.pendingCommitExpirationTime;0===c?t(\"261\"):void 0;a.pendingCommitExpirationTime=0;d=b.expirationTime;var e=b.childExpirationTime;d=e>d?e:d;a.didError=!1;0===d?(a.earliestPendingTime=0,a.latestPendingTime=0,a.earliestSuspendedTime=0,a.latestSuspendedTime=0,a.latestPingedTime=\n0):(e=a.latestPendingTime,0!==e&&(e>d?a.earliestPendingTime=a.latestPendingTime=0:a.earliestPendingTime>d&&(a.earliestPendingTime=a.latestPendingTime)),e=a.earliestSuspendedTime,0===e?ef(a,d):d<a.latestSuspendedTime?(a.earliestSuspendedTime=0,a.latestSuspendedTime=0,a.latestPingedTime=0,ef(a,d)):d>e&&ef(a,d));ff(0,a);Vg.current=null;1<b.effectTag?null!==b.lastEffect?(b.lastEffect.nextEffect=b,d=b.firstEffect):d=b:d=b.firstEffect;ze=Hd;e=Td();if(Ud(e)){if(\"selectionStart\"in e)var f={start:e.selectionStart,\nend:e.selectionEnd};else a:{f=(f=e.ownerDocument)&&f.defaultView||window;var g=f.getSelection&&f.getSelection();if(g&&0!==g.rangeCount){f=g.anchorNode;var h=g.anchorOffset,k=g.focusNode;g=g.focusOffset;try{f.nodeType,k.nodeType}catch(db){f=null;break a}var l=0,m=-1,q=-1,x=0,z=0,B=e,Q=null;b:for(;;){for(var v;;){B!==f||0!==h&&3!==B.nodeType||(m=l+h);B!==k||0!==g&&3!==B.nodeType||(q=l+g);3===B.nodeType&&(l+=B.nodeValue.length);if(null===(v=B.firstChild))break;Q=B;B=v}for(;;){if(B===e)break b;Q===f&&\n++x===h&&(m=l);Q===k&&++z===g&&(q=l);if(null!==(v=B.nextSibling))break;B=Q;Q=B.parentNode}B=v}f=-1===m||-1===q?null:{start:m,end:q}}else f=null}f=f||{start:0,end:0}}else f=null;Ae={focusedElem:e,selectionRange:f};Hd=!1;for(U=d;null!==U;){e=!1;f=void 0;try{for(;null!==U;){if(U.effectTag&256)a:{var r=U.alternate;h=U;switch(h.tag){case 0:case 11:case 15:break a;case 1:if(h.effectTag&256&&null!==r){var u=r.memoizedProps,y=r.memoizedState,Y=h.stateNode,Th=Y.getSnapshotBeforeUpdate(h.elementType===h.type?\nu:O(h.type,u),y);Y.__reactInternalSnapshotBeforeUpdate=Th}break a;case 3:case 5:case 6:case 4:case 17:break a;default:t(\"163\")}}U=U.nextEffect}}catch(db){e=!0,f=db}e&&(null===U?t(\"178\"):void 0,Jg(U,f),null!==U&&(U=U.nextEffect))}for(U=d;null!==U;){r=!1;u=void 0;try{for(;null!==U;){var w=U.effectTag;w&16&&pe(U.stateNode,\"\");if(w&128){var C=U.alternate;if(null!==C){var p=C.ref;null!==p&&(\"function\"===typeof p?p(null):p.current=null)}}switch(w&14){case 2:Ng(U);U.effectTag&=-3;break;case 6:Ng(U);U.effectTag&=\n-3;Og(U.alternate,U);break;case 4:Og(U.alternate,U);break;case 8:y=U,Lg(y),y.return=null,y.child=null,y.alternate&&(y.alternate.child=null,y.alternate.return=null)}U=U.nextEffect}}catch(db){r=!0,u=db}r&&(null===U?t(\"178\"):void 0,Jg(U,u),null!==U&&(U=U.nextEffect))}p=Ae;C=Td();w=p.focusedElem;u=p.selectionRange;if(C!==w&&w&&w.ownerDocument&&Sd(w.ownerDocument.documentElement,w)){null!==u&&Ud(w)&&(C=u.start,p=u.end,void 0===p&&(p=C),\"selectionStart\"in w?(w.selectionStart=C,w.selectionEnd=Math.min(p,\nw.value.length)):(p=(C=w.ownerDocument||document)&&C.defaultView||window,p.getSelection&&(p=p.getSelection(),y=w.textContent.length,r=Math.min(u.start,y),u=void 0===u.end?r:Math.min(u.end,y),!p.extend&&r>u&&(y=u,u=r,r=y),y=Rd(w,r),Y=Rd(w,u),y&&Y&&(1!==p.rangeCount||p.anchorNode!==y.node||p.anchorOffset!==y.offset||p.focusNode!==Y.node||p.focusOffset!==Y.offset)&&(C=C.createRange(),C.setStart(y.node,y.offset),p.removeAllRanges(),r>u?(p.addRange(C),p.extend(Y.node,Y.offset)):(C.setEnd(Y.node,Y.offset),\np.addRange(C))))));C=[];for(p=w;p=p.parentNode;)1===p.nodeType&&C.push({element:p,left:p.scrollLeft,top:p.scrollTop});\"function\"===typeof w.focus&&w.focus();for(w=0;w<C.length;w++)p=C[w],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}Ae=null;Hd=!!ze;ze=null;a.current=b;for(U=d;null!==U;){d=!1;w=void 0;try{for(C=c;null!==U;){var Fb=U.effectTag;if(Fb&36){var Gb=U.alternate;p=U;r=C;switch(p.tag){case 0:case 11:case 15:break;case 1:var wc=p.stateNode;if(p.effectTag&4)if(null===Gb)wc.componentDidMount();\nelse{var ci=p.elementType===p.type?Gb.memoizedProps:O(p.type,Gb.memoizedProps);wc.componentDidUpdate(ci,Gb.memoizedState,wc.__reactInternalSnapshotBeforeUpdate)}var Cg=p.updateQueue;null!==Cg&&tf(p,Cg,wc,r);break;case 3:var Dg=p.updateQueue;if(null!==Dg){u=null;if(null!==p.child)switch(p.child.tag){case 5:u=p.child.stateNode;break;case 1:u=p.child.stateNode}tf(p,Dg,u,r)}break;case 5:var di=p.stateNode;null===Gb&&p.effectTag&4&&Be(p.type,p.memoizedProps)&&di.focus();break;case 6:break;case 4:break;\ncase 12:break;case 13:break;case 17:break;default:t(\"163\")}}if(Fb&128){var Ic=U.ref;if(null!==Ic){var Eg=U.stateNode;switch(U.tag){case 5:var ce=Eg;break;default:ce=Eg}\"function\"===typeof Ic?Ic(ce):Ic.current=ce}}U=U.nextEffect}}catch(db){d=!0,w=db}d&&(null===U?t(\"178\"):void 0,Jg(U,w),null!==U&&(U=U.nextEffect))}Yg=ah=!1;\"function\"===typeof Se&&Se(b.stateNode);Fb=b.expirationTime;b=b.childExpirationTime;b=b>Fb?b:Fb;0===b&&(Sg=null);a.expirationTime=b;a.finishedWork=null}\nfunction Qg(a){null===uh?t(\"246\"):void 0;uh.expirationTime=0;vh||(vh=!0,wh=a)}function Nh(a,b){var c=Z;Z=!0;try{return a(b)}finally{(Z=c)||W||Kh(1073741823,!1)}}function Oh(a,b){if(Z&&!xh){xh=!0;try{return a(b)}finally{xh=!1}}return a(b)}function Ph(a,b,c){if(kh)return a(b,c);Z||W||0===lh||(Kh(lh,!1),lh=0);var d=kh,e=Z;Z=kh=!0;try{return a(b,c)}finally{kh=d,(Z=e)||W||Kh(1073741823,!1)}}\nfunction Qh(a,b,c,d,e){var f=b.current;a:if(c){c=c._reactInternalFiber;b:{2===kd(c)&&1===c.tag?void 0:t(\"170\");var g=c;do{switch(g.tag){case 3:g=g.stateNode.context;break b;case 1:if(L(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break b}}g=g.return}while(null!==g);t(\"171\");g=void 0}if(1===c.tag){var h=c.type;if(L(h)){c=Pe(c,h,g);break a}}c=g}else c=Je;null===b.context?b.context=c:b.pendingContext=c;b=e;e=mf(d);e.payload={element:a};b=void 0===b?null:b;null!==b&&(e.callback=b);\nSf();of(f,e);Tf(f,d);return d}function Rh(a,b,c,d){var e=b.current,f=Qf();e=Rf(f,e);return Qh(a,b,c,e,d)}function Sh(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Uh(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:$b,key:null==d?null:\"\"+d,children:a,containerInfo:b,implementation:c}}\nCb=function(a,b,c){switch(b){case \"input\":Dc(a,c);b=c.name;if(\"radio\"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll(\"input[name=\"+JSON.stringify(\"\"+b)+'][type=\"radio\"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=La(d);e?void 0:t(\"90\");Wb(d);Dc(d,e)}}}break;case \"textarea\":ie(a,c);break;case \"select\":b=c.value,null!=b&&fe(a,!!c.multiple,b,!1)}};\nfunction Vh(a){var b=1073741822-25*(((1073741822-Qf()+500)/25|0)+1);b>=Wg&&(b=Wg-1);this._expirationTime=Wg=b;this._root=a;this._callbacks=this._next=null;this._hasChildren=this._didComplete=!1;this._children=null;this._defer=!0}Vh.prototype.render=function(a){this._defer?void 0:t(\"250\");this._hasChildren=!0;this._children=a;var b=this._root._internalRoot,c=this._expirationTime,d=new Wh;Qh(a,b,null,c,d._onCommit);return d};\nVh.prototype.then=function(a){if(this._didComplete)a();else{var b=this._callbacks;null===b&&(b=this._callbacks=[]);b.push(a)}};\nVh.prototype.commit=function(){var a=this._root._internalRoot,b=a.firstBatch;this._defer&&null!==b?void 0:t(\"251\");if(this._hasChildren){var c=this._expirationTime;if(b!==this){this._hasChildren&&(c=this._expirationTime=b._expirationTime,this.render(this._children));for(var d=null,e=b;e!==this;)d=e,e=e._next;null===d?t(\"251\"):void 0;d._next=e._next;this._next=b;a.firstBatch=this}this._defer=!1;Hh(a,c);b=this._next;this._next=null;b=a.firstBatch=b;null!==b&&b._hasChildren&&b.render(b._children)}else this._next=\nnull,this._defer=!1};Vh.prototype._onComplete=function(){if(!this._didComplete){this._didComplete=!0;var a=this._callbacks;if(null!==a)for(var b=0;b<a.length;b++)(0,a[b])()}};function Wh(){this._callbacks=null;this._didCommit=!1;this._onCommit=this._onCommit.bind(this)}Wh.prototype.then=function(a){if(this._didCommit)a();else{var b=this._callbacks;null===b&&(b=this._callbacks=[]);b.push(a)}};\nWh.prototype._onCommit=function(){if(!this._didCommit){this._didCommit=!0;var a=this._callbacks;if(null!==a)for(var b=0;b<a.length;b++){var c=a[b];\"function\"!==typeof c?t(\"191\",c):void 0;c()}}};\nfunction Xh(a,b,c){b=M(3,null,null,b?3:0);a={current:b,containerInfo:a,pendingChildren:null,earliestPendingTime:0,latestPendingTime:0,earliestSuspendedTime:0,latestSuspendedTime:0,latestPingedTime:0,didError:!1,pendingCommitExpirationTime:0,finishedWork:null,timeoutHandle:-1,context:null,pendingContext:null,hydrate:c,nextExpirationTimeToWorkOn:0,expirationTime:0,firstBatch:null,nextScheduledRoot:null};this._internalRoot=b.stateNode=a}\nXh.prototype.render=function(a,b){var c=this._internalRoot,d=new Wh;b=void 0===b?null:b;null!==b&&d.then(b);Rh(a,c,null,d._onCommit);return d};Xh.prototype.unmount=function(a){var b=this._internalRoot,c=new Wh;a=void 0===a?null:a;null!==a&&c.then(a);Rh(null,b,null,c._onCommit);return c};Xh.prototype.legacy_renderSubtreeIntoContainer=function(a,b,c){var d=this._internalRoot,e=new Wh;c=void 0===c?null:c;null!==c&&e.then(c);Rh(b,d,a,e._onCommit);return e};\nXh.prototype.createBatch=function(){var a=new Vh(this),b=a._expirationTime,c=this._internalRoot,d=c.firstBatch;if(null===d)c.firstBatch=a,a._next=null;else{for(c=null;null!==d&&d._expirationTime>=b;)c=d,d=d._next;a._next=d;null!==c&&(c._next=a)}return a};function Yh(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||\" react-mount-point-unstable \"!==a.nodeValue))}Kb=Nh;Lb=Ph;Mb=function(){W||0===lh||(Kh(lh,!1),lh=0)};\nfunction Zh(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute(\"data-reactroot\")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new Xh(a,!1,b)}\nfunction $h(a,b,c,d,e){Yh(c)?void 0:t(\"200\");var f=c._reactRootContainer;if(f){if(\"function\"===typeof e){var g=e;e=function(){var a=Sh(f._internalRoot);g.call(a)}}null!=a?f.legacy_renderSubtreeIntoContainer(a,b,e):f.render(b,e)}else{f=c._reactRootContainer=Zh(c,d);if(\"function\"===typeof e){var h=e;e=function(){var a=Sh(f._internalRoot);h.call(a)}}Oh(function(){null!=a?f.legacy_renderSubtreeIntoContainer(a,b,e):f.render(b,e)})}return Sh(f._internalRoot)}\nfunction ai(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;Yh(b)?void 0:t(\"200\");return Uh(a,b,null,c)}\nvar bi={createPortal:ai,findDOMNode:function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;void 0===b&&(\"function\"===typeof a.render?t(\"188\"):t(\"268\",Object.keys(a)));a=nd(b);a=null===a?null:a.stateNode;return a},hydrate:function(a,b,c){return $h(null,a,b,!0,c)},render:function(a,b,c){return $h(null,a,b,!1,c)},unstable_renderSubtreeIntoContainer:function(a,b,c,d){null==a||void 0===a._reactInternalFiber?t(\"38\"):void 0;return $h(a,b,c,!1,d)},unmountComponentAtNode:function(a){Yh(a)?\nvoid 0:t(\"40\");return a._reactRootContainer?(Oh(function(){$h(null,null,a,!1,function(){a._reactRootContainer=null})}),!0):!1},unstable_createPortal:function(){return ai.apply(void 0,arguments)},unstable_batchedUpdates:Nh,unstable_interactiveUpdates:Ph,flushSync:function(a,b){W?t(\"187\"):void 0;var c=Z;Z=!0;try{return qh(a,b)}finally{Z=c,Kh(1073741823,!1)}},unstable_flushControlled:function(a){var b=Z;Z=!0;try{qh(a)}finally{(Z=b)||W||Kh(1073741823,!1)}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[Ja,\nKa,La,Ca.injectEventPluginsByName,qa,Ra,function(a){za(a,Qa)},Ib,Jb,Jd,Ea]},unstable_createRoot:function(a,b){Yh(a)?void 0:t(\"299\",\"unstable_createRoot\");return new Xh(a,!0,null!=b&&!0===b.hydrate)}};(function(a){var b=a.findFiberByHostInstance;return Ve(n({},a,{findHostInstanceByFiber:function(a){a=nd(a);return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null}}))})({findFiberByHostInstance:Ia,bundleType:0,version:\"16.6.3\",rendererPackageName:\"react-dom\"});\nvar ei={default:bi},fi=ei&&bi||ei;module.exports=fi.default||fi;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/scheduler.production.min.js');\n} else {\n  module.exports = require('./cjs/scheduler.development.js');\n}\n","/** @license React v0.11.3\n * scheduler.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';Object.defineProperty(exports,\"__esModule\",{value:!0});var d=null,f=!1,h=3,k=-1,l=-1,m=!1,n=!1;function p(){if(!m){var a=d.expirationTime;n?q():n=!0;r(t,a)}}\nfunction u(){var a=d,b=d.next;if(d===b)d=null;else{var c=d.previous;d=c.next=b;b.previous=c}a.next=a.previous=null;c=a.callback;b=a.expirationTime;a=a.priorityLevel;var e=h,Q=l;h=a;l=b;try{var g=c()}finally{h=e,l=Q}if(\"function\"===typeof g)if(g={callback:g,priorityLevel:a,expirationTime:b,next:null,previous:null},null===d)d=g.next=g.previous=g;else{c=null;a=d;do{if(a.expirationTime>=b){c=a;break}a=a.next}while(a!==d);null===c?c=d:c===d&&(d=g,p());b=c.previous;b.next=c.previous=g;g.next=c;g.previous=\nb}}function v(){if(-1===k&&null!==d&&1===d.priorityLevel){m=!0;try{do u();while(null!==d&&1===d.priorityLevel)}finally{m=!1,null!==d?p():n=!1}}}function t(a){m=!0;var b=f;f=a;try{if(a)for(;null!==d;){var c=exports.unstable_now();if(d.expirationTime<=c){do u();while(null!==d&&d.expirationTime<=c)}else break}else if(null!==d){do u();while(null!==d&&!w())}}finally{m=!1,f=b,null!==d?p():n=!1,v()}}\nvar x=Date,y=\"function\"===typeof setTimeout?setTimeout:void 0,z=\"function\"===typeof clearTimeout?clearTimeout:void 0,A=\"function\"===typeof requestAnimationFrame?requestAnimationFrame:void 0,B=\"function\"===typeof cancelAnimationFrame?cancelAnimationFrame:void 0,C,D;function E(a){C=A(function(b){z(D);a(b)});D=y(function(){B(C);a(exports.unstable_now())},100)}\nif(\"object\"===typeof performance&&\"function\"===typeof performance.now){var F=performance;exports.unstable_now=function(){return F.now()}}else exports.unstable_now=function(){return x.now()};var r,q,w,G=null;\"undefined\"!==typeof window?G=window:\"undefined\"!==typeof global&&(G=global);\nif(G&&G._schedMock){var H=G._schedMock;r=H[0];q=H[1];w=H[2];exports.unstable_now=H[3]}else if(\"undefined\"===typeof window||\"function\"!==typeof MessageChannel){var I=null,J=function(a){if(null!==I)try{I(a)}finally{I=null}};r=function(a){null!==I?setTimeout(r,0,a):(I=a,setTimeout(J,0,!1))};q=function(){I=null};w=function(){return!1}}else{\"undefined\"!==typeof console&&(\"function\"!==typeof A&&console.error(\"This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\"),\n\"function\"!==typeof B&&console.error(\"This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\"));var K=null,L=!1,M=-1,N=!1,O=!1,P=0,R=33,S=33;w=function(){return P<=exports.unstable_now()};var T=new MessageChannel,U=T.port2;T.port1.onmessage=function(){L=!1;var a=K,b=M;K=null;M=-1;var c=exports.unstable_now(),e=!1;if(0>=P-c)if(-1!==b&&b<=c)e=!0;else{N||(N=!0,E(V));K=a;M=b;return}if(null!==a){O=!0;try{a(e)}finally{O=!1}}};\nvar V=function(a){if(null!==K){E(V);var b=a-P+S;b<S&&R<S?(8>b&&(b=8),S=b<R?R:b):R=b;P=a+S;L||(L=!0,U.postMessage(void 0))}else N=!1};r=function(a,b){K=a;M=b;O||0>b?U.postMessage(void 0):N||(N=!0,E(V))};q=function(){K=null;L=!1;M=-1}}exports.unstable_ImmediatePriority=1;exports.unstable_UserBlockingPriority=2;exports.unstable_NormalPriority=3;exports.unstable_IdlePriority=5;exports.unstable_LowPriority=4;\nexports.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=h,e=k;h=a;k=exports.unstable_now();try{return b()}finally{h=c,k=e,v()}};\nexports.unstable_scheduleCallback=function(a,b){var c=-1!==k?k:exports.unstable_now();if(\"object\"===typeof b&&null!==b&&\"number\"===typeof b.timeout)b=c+b.timeout;else switch(h){case 1:b=c+-1;break;case 2:b=c+250;break;case 5:b=c+1073741823;break;case 4:b=c+1E4;break;default:b=c+5E3}a={callback:a,priorityLevel:h,expirationTime:b,next:null,previous:null};if(null===d)d=a.next=a.previous=a,p();else{c=null;var e=d;do{if(e.expirationTime>b){c=e;break}e=e.next}while(e!==d);null===c?c=d:c===d&&(d=a,p());\nb=c.previous;b.next=c.previous=a;a.next=c;a.previous=b}return a};exports.unstable_cancelCallback=function(a){var b=a.next;if(null!==b){if(b===a)d=null;else{a===d&&(d=b);var c=a.previous;c.next=b;b.previous=c}a.next=a.previous=null}};exports.unstable_wrapCallback=function(a){var b=h;return function(){var c=h,e=k;h=b;k=exports.unstable_now();try{return a.apply(this,arguments)}finally{h=c,k=e,v()}}};exports.unstable_getCurrentPriorityLevel=function(){return h};\nexports.unstable_shouldYield=function(){return!f&&(null!==d&&d.expirationTime<l||w())};\n","\"use strict\";\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar PropTypes = _interopRequireWildcard(require(\"prop-types\"));\n\nvar _addClass = _interopRequireDefault(require(\"dom-helpers/class/addClass\"));\n\nvar _removeClass = _interopRequireDefault(require(\"dom-helpers/class/removeClass\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _Transition = _interopRequireDefault(require(\"./Transition\"));\n\nvar _PropTypes = require(\"./utils/PropTypes\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nvar addClass = function addClass(node, classes) {\n  return node && classes && classes.split(' ').forEach(function (c) {\n    return (0, _addClass.default)(node, c);\n  });\n};\n\nvar removeClass = function removeClass(node, classes) {\n  return node && classes && classes.split(' ').forEach(function (c) {\n    return (0, _removeClass.default)(node, c);\n  });\n};\n\nvar propTypes = process.env.NODE_ENV !== \"production\" ? _extends({}, _Transition.default.propTypes, {\n  /**\n   * The animation classNames applied to the component as it enters, exits or has finished the transition.\n   * A single name can be provided and it will be suffixed for each stage: e.g.\n   *\n   * `classNames=\"fade\"` applies `fade-enter`, `fade-enter-active`, `fade-enter-done`,\n   * `fade-exit`, `fade-exit-active`, `fade-exit-done`, `fade-appear`, and `fade-appear-active`.\n   * Each individual classNames can also be specified independently like:\n   *\n   * ```js\n   * classNames={{\n   *  appear: 'my-appear',\n   *  appearActive: 'my-active-appear',\n   *  enter: 'my-enter',\n   *  enterActive: 'my-active-enter',\n   *  enterDone: 'my-done-enter',\n   *  exit: 'my-exit',\n   *  exitActive: 'my-active-exit',\n   *  exitDone: 'my-done-exit',\n   * }}\n   * ```\n   *\n   * If you want to set these classes using CSS Modules:\n   *\n   * ```js\n   * import styles from './styles.css';\n   * ```\n   *\n   * you might want to use camelCase in your CSS file, that way could simply spread\n   * them instead of listing them one by one:\n   *\n   * ```js\n   * classNames={{ ...styles }}\n   * ```\n   *\n   * @type {string | {\n   *  appear?: string,\n   *  appearActive?: string,\n   *  enter?: string,\n   *  enterActive?: string,\n   *  enterDone?: string,\n   *  exit?: string,\n   *  exitActive?: string,\n   *  exitDone?: string,\n   * }}\n   */\n  classNames: _PropTypes.classNamesShape,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'enter' or 'appear' class is\n   * applied.\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool)\n   */\n  onEnter: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'enter-active' or\n   * 'appear-active' class is applied.\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool)\n   */\n  onEntering: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'enter' or\n   * 'appear' classes are **removed** and the `done` class is added to the DOM node.\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool)\n   */\n  onEntered: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'exit' class is\n   * applied.\n   *\n   * @type Function(node: HtmlElement)\n   */\n  onExit: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'exit-active' is applied.\n   *\n   * @type Function(node: HtmlElement\n   */\n  onExiting: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'exit' classes\n   * are **removed** and the `exit-done` class is added to the DOM node.\n   *\n   * @type Function(node: HtmlElement)\n   */\n  onExited: PropTypes.func\n}) : {};;\n/**\n * A `Transition` component using CSS transitions and animations.\n * It's inspired by the excellent [ng-animate](http://www.nganimate.org/) library.\n *\n * `CSSTransition` applies a pair of class names during the `appear`, `enter`,\n * and `exit` stages of the transition. The first class is applied and then a\n * second \"active\" class in order to activate the css animation. After the animation,\n * matching `done` class names are applied to persist the animation state.\n *\n * When the `in` prop is toggled to `true` the Component will get\n * the `example-enter` CSS class and the `example-enter-active` CSS class\n * added in the next tick. This is a convention based on the `classNames` prop.\n */\n\nvar CSSTransition =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(CSSTransition, _React$Component);\n\n  function CSSTransition() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$Component.call.apply(_React$Component, [this].concat(args)) || this;\n\n    _this.onEnter = function (node, appearing) {\n      var _this$getClassNames = _this.getClassNames(appearing ? 'appear' : 'enter'),\n          className = _this$getClassNames.className;\n\n      _this.removeClasses(node, 'exit');\n\n      addClass(node, className);\n\n      if (_this.props.onEnter) {\n        _this.props.onEnter(node);\n      }\n    };\n\n    _this.onEntering = function (node, appearing) {\n      var _this$getClassNames2 = _this.getClassNames(appearing ? 'appear' : 'enter'),\n          activeClassName = _this$getClassNames2.activeClassName;\n\n      _this.reflowAndAddClass(node, activeClassName);\n\n      if (_this.props.onEntering) {\n        _this.props.onEntering(node);\n      }\n    };\n\n    _this.onEntered = function (node, appearing) {\n      var _this$getClassNames3 = _this.getClassNames('enter'),\n          doneClassName = _this$getClassNames3.doneClassName;\n\n      _this.removeClasses(node, appearing ? 'appear' : 'enter');\n\n      addClass(node, doneClassName);\n\n      if (_this.props.onEntered) {\n        _this.props.onEntered(node);\n      }\n    };\n\n    _this.onExit = function (node) {\n      var _this$getClassNames4 = _this.getClassNames('exit'),\n          className = _this$getClassNames4.className;\n\n      _this.removeClasses(node, 'appear');\n\n      _this.removeClasses(node, 'enter');\n\n      addClass(node, className);\n\n      if (_this.props.onExit) {\n        _this.props.onExit(node);\n      }\n    };\n\n    _this.onExiting = function (node) {\n      var _this$getClassNames5 = _this.getClassNames('exit'),\n          activeClassName = _this$getClassNames5.activeClassName;\n\n      _this.reflowAndAddClass(node, activeClassName);\n\n      if (_this.props.onExiting) {\n        _this.props.onExiting(node);\n      }\n    };\n\n    _this.onExited = function (node) {\n      var _this$getClassNames6 = _this.getClassNames('exit'),\n          doneClassName = _this$getClassNames6.doneClassName;\n\n      _this.removeClasses(node, 'exit');\n\n      addClass(node, doneClassName);\n\n      if (_this.props.onExited) {\n        _this.props.onExited(node);\n      }\n    };\n\n    _this.getClassNames = function (type) {\n      var classNames = _this.props.classNames;\n      var className = typeof classNames !== 'string' ? classNames[type] : classNames + '-' + type;\n      var activeClassName = typeof classNames !== 'string' ? classNames[type + 'Active'] : className + '-active';\n      var doneClassName = typeof classNames !== 'string' ? classNames[type + 'Done'] : className + '-done';\n      return {\n        className: className,\n        activeClassName: activeClassName,\n        doneClassName: doneClassName\n      };\n    };\n\n    return _this;\n  }\n\n  var _proto = CSSTransition.prototype;\n\n  _proto.removeClasses = function removeClasses(node, type) {\n    var _this$getClassNames7 = this.getClassNames(type),\n        className = _this$getClassNames7.className,\n        activeClassName = _this$getClassNames7.activeClassName,\n        doneClassName = _this$getClassNames7.doneClassName;\n\n    className && removeClass(node, className);\n    activeClassName && removeClass(node, activeClassName);\n    doneClassName && removeClass(node, doneClassName);\n  };\n\n  _proto.reflowAndAddClass = function reflowAndAddClass(node, className) {\n    // This is for to force a repaint,\n    // which is necessary in order to transition styles when adding a class name.\n    if (className) {\n      /* eslint-disable no-unused-expressions */\n      node && node.scrollTop;\n      /* eslint-enable no-unused-expressions */\n\n      addClass(node, className);\n    }\n  };\n\n  _proto.render = function render() {\n    var props = _extends({}, this.props);\n\n    delete props.classNames;\n    return _react.default.createElement(_Transition.default, _extends({}, props, {\n      onEnter: this.onEnter,\n      onEntered: this.onEntered,\n      onEntering: this.onEntering,\n      onExit: this.onExit,\n      onExiting: this.onExiting,\n      onExited: this.onExited\n    }));\n  };\n\n  return CSSTransition;\n}(_react.default.Component);\n\nCSSTransition.propTypes = process.env.NODE_ENV !== \"production\" ? propTypes : {};\nvar _default = CSSTransition;\nexports.default = _default;\nmodule.exports = exports[\"default\"];","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = require('./lib/ReactPropTypesSecret');\n\nfunction emptyFunction() {}\n\nmodule.exports = function() {\n  function shim(props, propName, componentName, location, propFullName, secret) {\n    if (secret === ReactPropTypesSecret) {\n      // It is still safe when called from React.\n      return;\n    }\n    var err = new Error(\n      'Calling PropTypes validators directly is not supported by the `prop-types` package. ' +\n      'Use PropTypes.checkPropTypes() to call them. ' +\n      'Read more at http://fb.me/use-check-prop-types'\n    );\n    err.name = 'Invariant Violation';\n    throw err;\n  };\n  shim.isRequired = shim;\n  function getShim() {\n    return shim;\n  };\n  // Important!\n  // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.\n  var ReactPropTypes = {\n    array: shim,\n    bool: shim,\n    func: shim,\n    number: shim,\n    object: shim,\n    string: shim,\n    symbol: shim,\n\n    any: shim,\n    arrayOf: getShim,\n    element: shim,\n    instanceOf: getShim,\n    node: shim,\n    objectOf: getShim,\n    oneOf: getShim,\n    oneOfType: getShim,\n    shape: getShim,\n    exact: getShim\n  };\n\n  ReactPropTypes.checkPropTypes = emptyFunction;\n  ReactPropTypes.PropTypes = ReactPropTypes;\n\n  return ReactPropTypes;\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';\n\nmodule.exports = ReactPropTypesSecret;\n","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.default = addClass;\n\nvar _hasClass = _interopRequireDefault(require(\"./hasClass\"));\n\nfunction addClass(element, className) {\n  if (element.classList) element.classList.add(className);else if (!(0, _hasClass.default)(element, className)) if (typeof element.className === 'string') element.className = element.className + ' ' + className;else element.setAttribute('class', (element.className && element.className.baseVal || '') + ' ' + className);\n}\n\nmodule.exports = exports[\"default\"];","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nmodule.exports = _interopRequireDefault;","\"use strict\";\n\nexports.__esModule = true;\nexports.default = hasClass;\n\nfunction hasClass(element, className) {\n  if (element.classList) return !!className && element.classList.contains(className);else return (\" \" + (element.className.baseVal || element.className) + \" \").indexOf(\" \" + className + \" \") !== -1;\n}\n\nmodule.exports = exports[\"default\"];","'use strict';\n\nfunction replaceClassName(origClass, classToRemove) {\n  return origClass.replace(new RegExp('(^|\\\\s)' + classToRemove + '(?:\\\\s|$)', 'g'), '$1').replace(/\\s+/g, ' ').replace(/^\\s*|\\s*$/g, '');\n}\n\nmodule.exports = function removeClass(element, className) {\n  if (element.classList) element.classList.remove(className);else if (typeof element.className === 'string') element.className = replaceClassName(element.className, className);else element.setAttribute('class', replaceClassName(element.className && element.className.baseVal || '', className));\n};","\"use strict\";\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactDom = require(\"react-dom\");\n\nvar _TransitionGroup = _interopRequireDefault(require(\"./TransitionGroup\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nvar propTypes = process.env.NODE_ENV !== \"production\" ? {\n  in: _propTypes.default.bool.isRequired,\n  children: function children(props, propName) {\n    if (_react.default.Children.count(props[propName]) !== 2) return new Error(\"\\\"\" + propName + \"\\\" must be exactly two transition components.\");\n    return null;\n  }\n} : {};;\n/**\n * The `<ReplaceTransition>` component is a specialized `Transition` component\n * that animates between two children.\n *\n * ```jsx\n * <ReplaceTransition in>\n *   <Fade><div>I appear first</div></Fade>\n *   <Fade><div>I replace the above</div></Fade>\n * </ReplaceTransition>\n * ```\n */\n\nvar ReplaceTransition =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(ReplaceTransition, _React$Component);\n\n  function ReplaceTransition() {\n    var _this;\n\n    for (var _len = arguments.length, _args = new Array(_len), _key = 0; _key < _len; _key++) {\n      _args[_key] = arguments[_key];\n    }\n\n    _this = _React$Component.call.apply(_React$Component, [this].concat(_args)) || this;\n\n    _this.handleEnter = function () {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      return _this.handleLifecycle('onEnter', 0, args);\n    };\n\n    _this.handleEntering = function () {\n      for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        args[_key3] = arguments[_key3];\n      }\n\n      return _this.handleLifecycle('onEntering', 0, args);\n    };\n\n    _this.handleEntered = function () {\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      return _this.handleLifecycle('onEntered', 0, args);\n    };\n\n    _this.handleExit = function () {\n      for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n        args[_key5] = arguments[_key5];\n      }\n\n      return _this.handleLifecycle('onExit', 1, args);\n    };\n\n    _this.handleExiting = function () {\n      for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n        args[_key6] = arguments[_key6];\n      }\n\n      return _this.handleLifecycle('onExiting', 1, args);\n    };\n\n    _this.handleExited = function () {\n      for (var _len7 = arguments.length, args = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n        args[_key7] = arguments[_key7];\n      }\n\n      return _this.handleLifecycle('onExited', 1, args);\n    };\n\n    return _this;\n  }\n\n  var _proto = ReplaceTransition.prototype;\n\n  _proto.handleLifecycle = function handleLifecycle(handler, idx, originalArgs) {\n    var _child$props;\n\n    var children = this.props.children;\n\n    var child = _react.default.Children.toArray(children)[idx];\n\n    if (child.props[handler]) (_child$props = child.props)[handler].apply(_child$props, originalArgs);\n    if (this.props[handler]) this.props[handler]((0, _reactDom.findDOMNode)(this));\n  };\n\n  _proto.render = function render() {\n    var _this$props = this.props,\n        children = _this$props.children,\n        inProp = _this$props.in,\n        props = _objectWithoutPropertiesLoose(_this$props, [\"children\", \"in\"]);\n\n    var _React$Children$toArr = _react.default.Children.toArray(children),\n        first = _React$Children$toArr[0],\n        second = _React$Children$toArr[1];\n\n    delete props.onEnter;\n    delete props.onEntering;\n    delete props.onEntered;\n    delete props.onExit;\n    delete props.onExiting;\n    delete props.onExited;\n    return _react.default.createElement(_TransitionGroup.default, props, inProp ? _react.default.cloneElement(first, {\n      key: 'first',\n      onEnter: this.handleEnter,\n      onEntering: this.handleEntering,\n      onEntered: this.handleEntered\n    }) : _react.default.cloneElement(second, {\n      key: 'second',\n      onEnter: this.handleExit,\n      onEntering: this.handleExiting,\n      onEntered: this.handleExited\n    }));\n  };\n\n  return ReplaceTransition;\n}(_react.default.Component);\n\nReplaceTransition.propTypes = process.env.NODE_ENV !== \"production\" ? propTypes : {};\nvar _default = ReplaceTransition;\nexports.default = _default;\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nexports.__esModule = true;\nexports.getChildMapping = getChildMapping;\nexports.mergeChildMappings = mergeChildMappings;\nexports.getInitialChildMapping = getInitialChildMapping;\nexports.getNextChildMapping = getNextChildMapping;\n\nvar _react = require(\"react\");\n\n/**\n * Given `this.props.children`, return an object mapping key to child.\n *\n * @param {*} children `this.props.children`\n * @return {object} Mapping of key to child\n */\nfunction getChildMapping(children, mapFn) {\n  var mapper = function mapper(child) {\n    return mapFn && (0, _react.isValidElement)(child) ? mapFn(child) : child;\n  };\n\n  var result = Object.create(null);\n  if (children) _react.Children.map(children, function (c) {\n    return c;\n  }).forEach(function (child) {\n    // run the map function here instead so that the key is the computed one\n    result[child.key] = mapper(child);\n  });\n  return result;\n}\n/**\n * When you're adding or removing children some may be added or removed in the\n * same render pass. We want to show *both* since we want to simultaneously\n * animate elements in and out. This function takes a previous set of keys\n * and a new set of keys and merges them with its best guess of the correct\n * ordering. In the future we may expose some of the utilities in\n * ReactMultiChild to make this easy, but for now React itself does not\n * directly have this concept of the union of prevChildren and nextChildren\n * so we implement it here.\n *\n * @param {object} prev prev children as returned from\n * `ReactTransitionChildMapping.getChildMapping()`.\n * @param {object} next next children as returned from\n * `ReactTransitionChildMapping.getChildMapping()`.\n * @return {object} a key set that contains all keys in `prev` and all keys\n * in `next` in a reasonable order.\n */\n\n\nfunction mergeChildMappings(prev, next) {\n  prev = prev || {};\n  next = next || {};\n\n  function getValueForKey(key) {\n    return key in next ? next[key] : prev[key];\n  } // For each key of `next`, the list of keys to insert before that key in\n  // the combined list\n\n\n  var nextKeysPending = Object.create(null);\n  var pendingKeys = [];\n\n  for (var prevKey in prev) {\n    if (prevKey in next) {\n      if (pendingKeys.length) {\n        nextKeysPending[prevKey] = pendingKeys;\n        pendingKeys = [];\n      }\n    } else {\n      pendingKeys.push(prevKey);\n    }\n  }\n\n  var i;\n  var childMapping = {};\n\n  for (var nextKey in next) {\n    if (nextKeysPending[nextKey]) {\n      for (i = 0; i < nextKeysPending[nextKey].length; i++) {\n        var pendingNextKey = nextKeysPending[nextKey][i];\n        childMapping[nextKeysPending[nextKey][i]] = getValueForKey(pendingNextKey);\n      }\n    }\n\n    childMapping[nextKey] = getValueForKey(nextKey);\n  } // Finally, add the keys which didn't appear before any key in `next`\n\n\n  for (i = 0; i < pendingKeys.length; i++) {\n    childMapping[pendingKeys[i]] = getValueForKey(pendingKeys[i]);\n  }\n\n  return childMapping;\n}\n\nfunction getProp(child, prop, props) {\n  return props[prop] != null ? props[prop] : child.props[prop];\n}\n\nfunction getInitialChildMapping(props, onExited) {\n  return getChildMapping(props.children, function (child) {\n    return (0, _react.cloneElement)(child, {\n      onExited: onExited.bind(null, child),\n      in: true,\n      appear: getProp(child, 'appear', props),\n      enter: getProp(child, 'enter', props),\n      exit: getProp(child, 'exit', props)\n    });\n  });\n}\n\nfunction getNextChildMapping(nextProps, prevChildMapping, onExited) {\n  var nextChildMapping = getChildMapping(nextProps.children);\n  var children = mergeChildMappings(prevChildMapping, nextChildMapping);\n  Object.keys(children).forEach(function (key) {\n    var child = children[key];\n    if (!(0, _react.isValidElement)(child)) return;\n    var hasPrev = key in prevChildMapping;\n    var hasNext = key in nextChildMapping;\n    var prevChild = prevChildMapping[key];\n    var isLeaving = (0, _react.isValidElement)(prevChild) && !prevChild.props.in; // item is new (entering)\n\n    if (hasNext && (!hasPrev || isLeaving)) {\n      // console.log('entering', key)\n      children[key] = (0, _react.cloneElement)(child, {\n        onExited: onExited.bind(null, child),\n        in: true,\n        exit: getProp(child, 'exit', nextProps),\n        enter: getProp(child, 'enter', nextProps)\n      });\n    } else if (!hasNext && hasPrev && !isLeaving) {\n      // item is old (exiting)\n      // console.log('leaving', key)\n      children[key] = (0, _react.cloneElement)(child, {\n        in: false\n      });\n    } else if (hasNext && hasPrev && (0, _react.isValidElement)(prevChild)) {\n      // item hasn't changed transition states\n      // copy over the last transition props;\n      // console.log('unchanged', key)\n      children[key] = (0, _react.cloneElement)(child, {\n        onExited: onExited.bind(null, child),\n        in: prevChild.props.in,\n        exit: getProp(child, 'exit', nextProps),\n        enter: getProp(child, 'enter', nextProps)\n      });\n    }\n  });\n  return children;\n}","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Bootstrap for the Google JS Library (Closure).\n *\n * In uncompiled mode base.js will attempt to load Closure's deps file, unless\n * the global <code>CLOSURE_NO_DEPS</code> is set to true.  This allows projects\n * to include their own deps file(s) from different locations.\n *\n * Avoid including base.js more than once. This is strictly discouraged and not\n * supported. goog.require(...) won't work properly in that case.\n *\n * @provideGoog\n */\n\n\n/**\n * @define {boolean} Overridden to true by the compiler.\n */\nvar COMPILED = false;\n\n\n/**\n * Base namespace for the Closure library.  Checks to see goog is already\n * defined in the current scope before assigning to prevent clobbering if\n * base.js is loaded more than once.\n *\n * @const\n */\nvar goog = goog || {};\n\n/**\n * Reference to the global object.\n * https://www.ecma-international.org/ecma-262/9.0/index.html#sec-global-object\n *\n * More info on this implementation here:\n * https://docs.google.com/document/d/1NAeW4Wk7I7FV0Y2tcUFvQdGMc89k2vdgSXInw8_nvCI/edit\n *\n * @const\n * @suppress {undefinedVars} self won't be referenced unless `this` is falsy.\n * @type {!Global}\n */\ngoog.global =\n    // Check `this` first for backwards compatibility.\n    // Valid unless running as an ES module or in a function wrapper called\n    //   without setting `this` properly.\n    // Note that base.js can't usefully be imported as an ES module, but it may\n    // be compiled into bundles that are loadable as ES modules.\n    this ||\n    // https://developer.mozilla.org/en-US/docs/Web/API/Window/self\n    // For in-page browser environments and workers.\n    self;\n\n\n/**\n * A hook for overriding the define values in uncompiled mode.\n *\n * In uncompiled mode, `CLOSURE_UNCOMPILED_DEFINES` may be defined before\n * loading base.js.  If a key is defined in `CLOSURE_UNCOMPILED_DEFINES`,\n * `goog.define` will use the value instead of the default value.  This\n * allows flags to be overwritten without compilation (this is normally\n * accomplished with the compiler's \"define\" flag).\n *\n * Example:\n * <pre>\n *   var CLOSURE_UNCOMPILED_DEFINES = {'goog.DEBUG': false};\n * </pre>\n *\n * @type {Object<string, (string|number|boolean)>|undefined}\n */\ngoog.global.CLOSURE_UNCOMPILED_DEFINES;\n\n\n/**\n * A hook for overriding the define values in uncompiled or compiled mode,\n * like CLOSURE_UNCOMPILED_DEFINES but effective in compiled code.  In\n * uncompiled code CLOSURE_UNCOMPILED_DEFINES takes precedence.\n *\n * Also unlike CLOSURE_UNCOMPILED_DEFINES the values must be number, boolean or\n * string literals or the compiler will emit an error.\n *\n * While any @define value may be set, only those set with goog.define will be\n * effective for uncompiled code.\n *\n * Example:\n * <pre>\n *   var CLOSURE_DEFINES = {'goog.DEBUG': false} ;\n * </pre>\n *\n * @type {Object<string, (string|number|boolean)>|undefined}\n */\ngoog.global.CLOSURE_DEFINES;\n\n\n/**\n * Returns true if the specified value is not undefined.\n *\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is defined.\n */\ngoog.isDef = function(val) {\n  // void 0 always evaluates to undefined and hence we do not need to depend on\n  // the definition of the global variable named 'undefined'.\n  return val !== void 0;\n};\n\n/**\n * Returns true if the specified value is a string.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is a string.\n */\ngoog.isString = function(val) {\n  return typeof val == 'string';\n};\n\n\n/**\n * Returns true if the specified value is a boolean.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is boolean.\n */\ngoog.isBoolean = function(val) {\n  return typeof val == 'boolean';\n};\n\n\n/**\n * Returns true if the specified value is a number.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is a number.\n */\ngoog.isNumber = function(val) {\n  return typeof val == 'number';\n};\n\n\n/**\n * Builds an object structure for the provided namespace path, ensuring that\n * names that already exist are not overwritten. For example:\n * \"a.b.c\" -> a = {};a.b={};a.b.c={};\n * Used by goog.provide and goog.exportSymbol.\n * @param {string} name name of the object that this file defines.\n * @param {*=} opt_object the object to expose at the end of the path.\n * @param {Object=} opt_objectToExportTo The object to add the path to; default\n *     is `goog.global`.\n * @private\n */\ngoog.exportPath_ = function(name, opt_object, opt_objectToExportTo) {\n  var parts = name.split('.');\n  var cur = opt_objectToExportTo || goog.global;\n\n  // Internet Explorer exhibits strange behavior when throwing errors from\n  // methods externed in this manner.  See the testExportSymbolExceptions in\n  // base_test.html for an example.\n  if (!(parts[0] in cur) && typeof cur.execScript != 'undefined') {\n    cur.execScript('var ' + parts[0]);\n  }\n\n  for (var part; parts.length && (part = parts.shift());) {\n    if (!parts.length && goog.isDef(opt_object)) {\n      // last part and we have an object; use it\n      cur[part] = opt_object;\n    } else if (cur[part] && cur[part] !== Object.prototype[part]) {\n      cur = cur[part];\n    } else {\n      cur = cur[part] = {};\n    }\n  }\n};\n\n\n/**\n * Defines a named value. In uncompiled mode, the value is retrieved from\n * CLOSURE_DEFINES or CLOSURE_UNCOMPILED_DEFINES if the object is defined and\n * has the property specified, and otherwise used the defined defaultValue.\n * When compiled the default can be overridden using the compiler options or the\n * value set in the CLOSURE_DEFINES object. Returns the defined value so that it\n * can be used safely in modules. Note that the value type MUST be either\n * boolean, number, or string.\n *\n * @param {string} name The distinguished name to provide.\n * @param {T} defaultValue\n * @return {T} The defined value.\n * @template T\n */\ngoog.define = function(name, defaultValue) {\n  var value = defaultValue;\n  if (!COMPILED) {\n    var uncompiledDefines = goog.global.CLOSURE_UNCOMPILED_DEFINES;\n    var defines = goog.global.CLOSURE_DEFINES;\n    if (uncompiledDefines &&\n        // Anti DOM-clobbering runtime check (b/37736576).\n        /** @type {?} */ (uncompiledDefines).nodeType === undefined &&\n        Object.prototype.hasOwnProperty.call(uncompiledDefines, name)) {\n      value = uncompiledDefines[name];\n    } else if (\n        defines &&\n        // Anti DOM-clobbering runtime check (b/37736576).\n        /** @type {?} */ (defines).nodeType === undefined &&\n        Object.prototype.hasOwnProperty.call(defines, name)) {\n      value = defines[name];\n    }\n  }\n  return value;\n};\n\n\n/**\n * @define {number} Integer year indicating the set of browser features that are\n * guaranteed to be present.  This is defined to include exactly features that\n * work correctly on all \"modern\" browsers that are stable on January 1 of the\n * specified year.  For example,\n * ```js\n * if (goog.FEATURESET_YEAR >= 2019) {\n *   // use APIs known to be available on all major stable browsers Jan 1, 2019\n * } else {\n *   // polyfill for older browsers\n * }\n * ```\n * This is intended to be the primary define for removing\n * unnecessary browser compatibility code (such as ponyfills and workarounds),\n * and should inform the default value for most other defines:\n * ```js\n * const ASSUME_NATIVE_PROMISE =\n *     goog.define('ASSUME_NATIVE_PROMISE', goog.FEATURESET_YEAR >= 2016);\n * ```\n *\n * The default assumption is that IE9 is the lowest supported browser, which was\n * first available Jan 1, 2012.\n *\n * TODO(user): Reference more thorough documentation when it's available.\n */\ngoog.FEATURESET_YEAR = goog.define('goog.FEATURESET_YEAR', 2012);\n\n\n/**\n * @define {boolean} DEBUG is provided as a convenience so that debugging code\n * that should not be included in a production. It can be easily stripped\n * by specifying --define goog.DEBUG=false to the Closure Compiler aka\n * JSCompiler. For example, most toString() methods should be declared inside an\n * \"if (goog.DEBUG)\" conditional because they are generally used for debugging\n * purposes and it is difficult for the JSCompiler to statically determine\n * whether they are used.\n */\ngoog.DEBUG = goog.define('goog.DEBUG', true);\n\n\n/**\n * @define {string} LOCALE defines the locale being used for compilation. It is\n * used to select locale specific data to be compiled in js binary. BUILD rule\n * can specify this value by \"--define goog.LOCALE=<locale_name>\" as a compiler\n * option.\n *\n * Take into account that the locale code format is important. You should use\n * the canonical Unicode format with hyphen as a delimiter. Language must be\n * lowercase, Language Script - Capitalized, Region - UPPERCASE.\n * There are few examples: pt-BR, en, en-US, sr-Latin-BO, zh-Hans-CN.\n *\n * See more info about locale codes here:\n * http://www.unicode.org/reports/tr35/#Unicode_Language_and_Locale_Identifiers\n *\n * For language codes you should use values defined by ISO 693-1. See it here\n * http://www.w3.org/WAI/ER/IG/ert/iso639.htm. There is only one exception from\n * this rule: the Hebrew language. For legacy reasons the old code (iw) should\n * be used instead of the new code (he).\n *\n */\ngoog.LOCALE = goog.define('goog.LOCALE', 'en');  // default to en\n\n\n/**\n * @define {boolean} Whether this code is running on trusted sites.\n *\n * On untrusted sites, several native functions can be defined or overridden by\n * external libraries like Prototype, Datejs, and JQuery and setting this flag\n * to false forces closure to use its own implementations when possible.\n *\n * If your JavaScript can be loaded by a third party site and you are wary about\n * relying on non-standard implementations, specify\n * \"--define goog.TRUSTED_SITE=false\" to the compiler.\n */\ngoog.TRUSTED_SITE = goog.define('goog.TRUSTED_SITE', true);\n\n\n/**\n * @define {boolean} Whether a project is expected to be running in strict mode.\n *\n * This define can be used to trigger alternate implementations compatible with\n * running in EcmaScript Strict mode or warn about unavailable functionality.\n * @see https://goo.gl/PudQ4y\n *\n */\ngoog.STRICT_MODE_COMPATIBLE = goog.define('goog.STRICT_MODE_COMPATIBLE', false);\n\n\n/**\n * @define {boolean} Whether code that calls {@link goog.setTestOnly} should\n *     be disallowed in the compilation unit.\n */\ngoog.DISALLOW_TEST_ONLY_CODE =\n    goog.define('goog.DISALLOW_TEST_ONLY_CODE', COMPILED && !goog.DEBUG);\n\n\n/**\n * @define {boolean} Whether to use a Chrome app CSP-compliant method for\n *     loading scripts via goog.require. @see appendScriptSrcNode_.\n */\ngoog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING =\n    goog.define('goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING', false);\n\n\n/**\n * Defines a namespace in Closure.\n *\n * A namespace may only be defined once in a codebase. It may be defined using\n * goog.provide() or goog.module().\n *\n * The presence of one or more goog.provide() calls in a file indicates\n * that the file defines the given objects/namespaces.\n * Provided symbols must not be null or undefined.\n *\n * In addition, goog.provide() creates the object stubs for a namespace\n * (for example, goog.provide(\"goog.foo.bar\") will create the object\n * goog.foo.bar if it does not already exist).\n *\n * Build tools also scan for provide/require/module statements\n * to discern dependencies, build dependency files (see deps.js), etc.\n *\n * @see goog.require\n * @see goog.module\n * @param {string} name Namespace provided by this file in the form\n *     \"goog.package.part\".\n */\ngoog.provide = function(name) {\n  if (goog.isInModuleLoader_()) {\n    throw new Error('goog.provide cannot be used within a module.');\n  }\n  if (!COMPILED) {\n    // Ensure that the same namespace isn't provided twice.\n    // A goog.module/goog.provide maps a goog.require to a specific file\n    if (goog.isProvided_(name)) {\n      throw new Error('Namespace \"' + name + '\" already declared.');\n    }\n  }\n\n  goog.constructNamespace_(name);\n};\n\n\n/**\n * @param {string} name Namespace provided by this file in the form\n *     \"goog.package.part\".\n * @param {Object=} opt_obj The object to embed in the namespace.\n * @private\n */\ngoog.constructNamespace_ = function(name, opt_obj) {\n  if (!COMPILED) {\n    delete goog.implicitNamespaces_[name];\n\n    var namespace = name;\n    while ((namespace = namespace.substring(0, namespace.lastIndexOf('.')))) {\n      if (goog.getObjectByName(namespace)) {\n        break;\n      }\n      goog.implicitNamespaces_[namespace] = true;\n    }\n  }\n\n  goog.exportPath_(name, opt_obj);\n};\n\n\n/**\n * Returns CSP nonce, if set for any script tag.\n * @param {?Window=} opt_window The window context used to retrieve the nonce.\n *     Defaults to global context.\n * @return {string} CSP nonce or empty string if no nonce is present.\n */\ngoog.getScriptNonce = function(opt_window) {\n  if (opt_window && opt_window != goog.global) {\n    return goog.getScriptNonce_(opt_window.document);\n  }\n  if (goog.cspNonce_ === null) {\n    goog.cspNonce_ = goog.getScriptNonce_(goog.global.document);\n  }\n  return goog.cspNonce_;\n};\n\n\n/**\n * According to the CSP3 spec a nonce must be a valid base64 string.\n * @see https://www.w3.org/TR/CSP3/#grammardef-base64-value\n * @private @const\n */\ngoog.NONCE_PATTERN_ = /^[\\w+/_-]+[=]{0,2}$/;\n\n\n/**\n * @private {?string}\n */\ngoog.cspNonce_ = null;\n\n\n/**\n * Returns CSP nonce, if set for any script tag.\n * @param {!Document} doc\n * @return {string} CSP nonce or empty string if no nonce is present.\n * @private\n */\ngoog.getScriptNonce_ = function(doc) {\n  var script = doc.querySelector && doc.querySelector('script[nonce]');\n  if (script) {\n    // Try to get the nonce from the IDL property first, because browsers that\n    // implement additional nonce protection features (currently only Chrome) to\n    // prevent nonce stealing via CSS do not expose the nonce via attributes.\n    // See https://github.com/whatwg/html/issues/2369\n    var nonce = script['nonce'] || script.getAttribute('nonce');\n    if (nonce && goog.NONCE_PATTERN_.test(nonce)) {\n      return nonce;\n    }\n  }\n  return '';\n};\n\n\n/**\n * Module identifier validation regexp.\n * Note: This is a conservative check, it is very possible to be more lenient,\n *   the primary exclusion here is \"/\" and \"\\\" and a leading \".\", these\n *   restrictions are intended to leave the door open for using goog.require\n *   with relative file paths rather than module identifiers.\n * @private\n */\ngoog.VALID_MODULE_RE_ = /^[a-zA-Z_$][a-zA-Z0-9._$]*$/;\n\n\n/**\n * Defines a module in Closure.\n *\n * Marks that this file must be loaded as a module and claims the namespace.\n *\n * A namespace may only be defined once in a codebase. It may be defined using\n * goog.provide() or goog.module().\n *\n * goog.module() has three requirements:\n * - goog.module may not be used in the same file as goog.provide.\n * - goog.module must be the first statement in the file.\n * - only one goog.module is allowed per file.\n *\n * When a goog.module annotated file is loaded, it is enclosed in\n * a strict function closure. This means that:\n * - any variables declared in a goog.module file are private to the file\n * (not global), though the compiler is expected to inline the module.\n * - The code must obey all the rules of \"strict\" JavaScript.\n * - the file will be marked as \"use strict\"\n *\n * NOTE: unlike goog.provide, goog.module does not declare any symbols by\n * itself. If declared symbols are desired, use\n * goog.module.declareLegacyNamespace().\n *\n *\n * See the public goog.module proposal: http://goo.gl/Va1hin\n *\n * @param {string} name Namespace provided by this file in the form\n *     \"goog.package.part\", is expected but not required.\n * @return {void}\n */\ngoog.module = function(name) {\n  if (!goog.isString(name) || !name ||\n      name.search(goog.VALID_MODULE_RE_) == -1) {\n    throw new Error('Invalid module identifier');\n  }\n  if (!goog.isInGoogModuleLoader_()) {\n    throw new Error(\n        'Module ' + name + ' has been loaded incorrectly. Note, ' +\n        'modules cannot be loaded as normal scripts. They require some kind of ' +\n        'pre-processing step. You\\'re likely trying to load a module via a ' +\n        'script tag or as a part of a concatenated bundle without rewriting the ' +\n        'module. For more info see: ' +\n        'https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.');\n  }\n  if (goog.moduleLoaderState_.moduleName) {\n    throw new Error('goog.module may only be called once per module.');\n  }\n\n  // Store the module name for the loader.\n  goog.moduleLoaderState_.moduleName = name;\n  if (!COMPILED) {\n    // Ensure that the same namespace isn't provided twice.\n    // A goog.module/goog.provide maps a goog.require to a specific file\n    if (goog.isProvided_(name)) {\n      throw new Error('Namespace \"' + name + '\" already declared.');\n    }\n    delete goog.implicitNamespaces_[name];\n  }\n};\n\n\n/**\n * @param {string} name The module identifier.\n * @return {?} The module exports for an already loaded module or null.\n *\n * Note: This is not an alternative to goog.require, it does not\n * indicate a hard dependency, instead it is used to indicate\n * an optional dependency or to access the exports of a module\n * that has already been loaded.\n * @suppress {missingProvide}\n */\ngoog.module.get = function(name) {\n\n  return goog.module.getInternal_(name);\n};\n\n\n/**\n * @param {string} name The module identifier.\n * @return {?} The module exports for an already loaded module or null.\n * @private\n */\ngoog.module.getInternal_ = function(name) {\n  if (!COMPILED) {\n    if (name in goog.loadedModules_) {\n      return goog.loadedModules_[name].exports;\n    } else if (!goog.implicitNamespaces_[name]) {\n      var ns = goog.getObjectByName(name);\n      return ns != null ? ns : null;\n    }\n  }\n  return null;\n};\n\n\n/**\n * Types of modules the debug loader can load.\n * @enum {string}\n */\ngoog.ModuleType = {\n  ES6: 'es6',\n  GOOG: 'goog'\n};\n\n\n/**\n * @private {?{\n *   moduleName: (string|undefined),\n *   declareLegacyNamespace:boolean,\n *   type: ?goog.ModuleType\n * }}\n */\ngoog.moduleLoaderState_ = null;\n\n\n/**\n * @private\n * @return {boolean} Whether a goog.module or an es6 module is currently being\n *     initialized.\n */\ngoog.isInModuleLoader_ = function() {\n  return goog.isInGoogModuleLoader_() || goog.isInEs6ModuleLoader_();\n};\n\n\n/**\n * @private\n * @return {boolean} Whether a goog.module is currently being initialized.\n */\ngoog.isInGoogModuleLoader_ = function() {\n  return !!goog.moduleLoaderState_ &&\n      goog.moduleLoaderState_.type == goog.ModuleType.GOOG;\n};\n\n\n/**\n * @private\n * @return {boolean} Whether an es6 module is currently being initialized.\n */\ngoog.isInEs6ModuleLoader_ = function() {\n  var inLoader = !!goog.moduleLoaderState_ &&\n      goog.moduleLoaderState_.type == goog.ModuleType.ES6;\n\n  if (inLoader) {\n    return true;\n  }\n\n  var jscomp = goog.global['$jscomp'];\n\n  if (jscomp) {\n    // jscomp may not have getCurrentModulePath if this is a compiled bundle\n    // that has some of the runtime, but not all of it. This can happen if\n    // optimizations are turned on so the unused runtime is removed but renaming\n    // and Closure pass are off (so $jscomp is still named $jscomp and the\n    // goog.provide/require calls still exist).\n    if (typeof jscomp.getCurrentModulePath != 'function') {\n      return false;\n    }\n\n    // Bundled ES6 module.\n    return !!jscomp.getCurrentModulePath();\n  }\n\n  return false;\n};\n\n\n/**\n * Provide the module's exports as a globally accessible object under the\n * module's declared name.  This is intended to ease migration to goog.module\n * for files that have existing usages.\n * @suppress {missingProvide}\n */\ngoog.module.declareLegacyNamespace = function() {\n  if (!COMPILED && !goog.isInGoogModuleLoader_()) {\n    throw new Error(\n        'goog.module.declareLegacyNamespace must be called from ' +\n        'within a goog.module');\n  }\n  if (!COMPILED && !goog.moduleLoaderState_.moduleName) {\n    throw new Error(\n        'goog.module must be called prior to ' +\n        'goog.module.declareLegacyNamespace.');\n  }\n  goog.moduleLoaderState_.declareLegacyNamespace = true;\n};\n\n\n/**\n * Associates an ES6 module with a Closure module ID so that is available via\n * goog.require. The associated ID  acts like a goog.module ID - it does not\n * create any global names, it is merely available via goog.require /\n * goog.module.get / goog.forwardDeclare / goog.requireType. goog.require and\n * goog.module.get will return the entire module as if it was import *'d. This\n * allows Closure files to reference ES6 modules for the sake of migration.\n *\n * @param {string} namespace\n * @suppress {missingProvide}\n */\ngoog.declareModuleId = function(namespace) {\n  if (!COMPILED) {\n    if (!goog.isInEs6ModuleLoader_()) {\n      throw new Error(\n          'goog.declareModuleId may only be called from ' +\n          'within an ES6 module');\n    }\n    if (goog.moduleLoaderState_ && goog.moduleLoaderState_.moduleName) {\n      throw new Error(\n          'goog.declareModuleId may only be called once per module.');\n    }\n    if (namespace in goog.loadedModules_) {\n      throw new Error(\n          'Module with namespace \"' + namespace + '\" already exists.');\n    }\n  }\n  if (goog.moduleLoaderState_) {\n    // Not bundled - debug loading.\n    goog.moduleLoaderState_.moduleName = namespace;\n  } else {\n    // Bundled - not debug loading, no module loader state.\n    var jscomp = goog.global['$jscomp'];\n    if (!jscomp || typeof jscomp.getCurrentModulePath != 'function') {\n      throw new Error(\n          'Module with namespace \"' + namespace +\n          '\" has been loaded incorrectly.');\n    }\n    var exports = jscomp.require(jscomp.getCurrentModulePath());\n    goog.loadedModules_[namespace] = {\n      exports: exports,\n      type: goog.ModuleType.ES6,\n      moduleId: namespace\n    };\n  }\n};\n\n\n/**\n * Marks that the current file should only be used for testing, and never for\n * live code in production.\n *\n * In the case of unit tests, the message may optionally be an exact namespace\n * for the test (e.g. 'goog.stringTest'). The linter will then ignore the extra\n * provide (if not explicitly defined in the code).\n *\n * @param {string=} opt_message Optional message to add to the error that's\n *     raised when used in production code.\n */\ngoog.setTestOnly = function(opt_message) {\n  if (goog.DISALLOW_TEST_ONLY_CODE) {\n    opt_message = opt_message || '';\n    throw new Error(\n        'Importing test-only code into non-debug environment' +\n        (opt_message ? ': ' + opt_message : '.'));\n  }\n};\n\n\n/**\n * Forward declares a symbol. This is an indication to the compiler that the\n * symbol may be used in the source yet is not required and may not be provided\n * in compilation.\n *\n * The most common usage of forward declaration is code that takes a type as a\n * function parameter but does not need to require it. By forward declaring\n * instead of requiring, no hard dependency is made, and (if not required\n * elsewhere) the namespace may never be required and thus, not be pulled\n * into the JavaScript binary. If it is required elsewhere, it will be type\n * checked as normal.\n *\n * Before using goog.forwardDeclare, please read the documentation at\n * https://github.com/google/closure-compiler/wiki/Bad-Type-Annotation to\n * understand the options and tradeoffs when working with forward declarations.\n *\n * @param {string} name The namespace to forward declare in the form of\n *     \"goog.package.part\".\n */\ngoog.forwardDeclare = function(name) {};\n\n\n/**\n * Forward declare type information. Used to assign types to goog.global\n * referenced object that would otherwise result in unknown type references\n * and thus block property disambiguation.\n */\ngoog.forwardDeclare('Document');\ngoog.forwardDeclare('HTMLScriptElement');\ngoog.forwardDeclare('XMLHttpRequest');\n\n\nif (!COMPILED) {\n  /**\n   * Check if the given name has been goog.provided. This will return false for\n   * names that are available only as implicit namespaces.\n   * @param {string} name name of the object to look for.\n   * @return {boolean} Whether the name has been provided.\n   * @private\n   */\n  goog.isProvided_ = function(name) {\n    return (name in goog.loadedModules_) ||\n        (!goog.implicitNamespaces_[name] &&\n         goog.isDefAndNotNull(goog.getObjectByName(name)));\n  };\n\n  /**\n   * Namespaces implicitly defined by goog.provide. For example,\n   * goog.provide('goog.events.Event') implicitly declares that 'goog' and\n   * 'goog.events' must be namespaces.\n   *\n   * @type {!Object<string, (boolean|undefined)>}\n   * @private\n   */\n  goog.implicitNamespaces_ = {'goog.module': true};\n\n  // NOTE: We add goog.module as an implicit namespace as goog.module is defined\n  // here and because the existing module package has not been moved yet out of\n  // the goog.module namespace. This satisifies both the debug loader and\n  // ahead-of-time dependency management.\n}\n\n\n/**\n * Returns an object based on its fully qualified external name.  The object\n * is not found if null or undefined.  If you are using a compilation pass that\n * renames property names beware that using this function will not find renamed\n * properties.\n *\n * @param {string} name The fully qualified name.\n * @param {Object=} opt_obj The object within which to look; default is\n *     |goog.global|.\n * @return {?} The value (object or primitive) or, if not found, null.\n */\ngoog.getObjectByName = function(name, opt_obj) {\n  var parts = name.split('.');\n  var cur = opt_obj || goog.global;\n  for (var i = 0; i < parts.length; i++) {\n    cur = cur[parts[i]];\n    if (!goog.isDefAndNotNull(cur)) {\n      return null;\n    }\n  }\n  return cur;\n};\n\n\n/**\n * Globalizes a whole namespace, such as goog or goog.lang.\n *\n * @param {!Object} obj The namespace to globalize.\n * @param {Object=} opt_global The object to add the properties to.\n * @deprecated Properties may be explicitly exported to the global scope, but\n *     this should no longer be done in bulk.\n */\ngoog.globalize = function(obj, opt_global) {\n  var global = opt_global || goog.global;\n  for (var x in obj) {\n    global[x] = obj[x];\n  }\n};\n\n\n/**\n * Adds a dependency from a file to the files it requires.\n * @param {string} relPath The path to the js file.\n * @param {!Array<string>} provides An array of strings with\n *     the names of the objects this file provides.\n * @param {!Array<string>} requires An array of strings with\n *     the names of the objects this file requires.\n * @param {boolean|!Object<string>=} opt_loadFlags Parameters indicating\n *     how the file must be loaded.  The boolean 'true' is equivalent\n *     to {'module': 'goog'} for backwards-compatibility.  Valid properties\n *     and values include {'module': 'goog'} and {'lang': 'es6'}.\n */\ngoog.addDependency = function(relPath, provides, requires, opt_loadFlags) {\n  if (!COMPILED && goog.DEPENDENCIES_ENABLED) {\n    goog.debugLoader_.addDependency(relPath, provides, requires, opt_loadFlags);\n  }\n};\n\n\n\n\n// NOTE(nnaze): The debug DOM loader was included in base.js as an original way\n// to do \"debug-mode\" development.  The dependency system can sometimes be\n// confusing, as can the debug DOM loader's asynchronous nature.\n//\n// With the DOM loader, a call to goog.require() is not blocking -- the script\n// will not load until some point after the current script.  If a namespace is\n// needed at runtime, it needs to be defined in a previous script, or loaded via\n// require() with its registered dependencies.\n//\n// User-defined namespaces may need their own deps file. For a reference on\n// creating a deps file, see:\n// Externally: https://developers.google.com/closure/library/docs/depswriter\n//\n// Because of legacy clients, the DOM loader can't be easily removed from\n// base.js.  Work was done to make it disableable or replaceable for\n// different environments (DOM-less JavaScript interpreters like Rhino or V8,\n// for example). See bootstrap/ for more information.\n\n\n/**\n * @define {boolean} Whether to enable the debug loader.\n *\n * If enabled, a call to goog.require() will attempt to load the namespace by\n * appending a script tag to the DOM (if the namespace has been registered).\n *\n * If disabled, goog.require() will simply assert that the namespace has been\n * provided (and depend on the fact that some outside tool correctly ordered\n * the script).\n */\ngoog.ENABLE_DEBUG_LOADER = goog.define('goog.ENABLE_DEBUG_LOADER', true);\n\n\n/**\n * @param {string} msg\n * @private\n */\ngoog.logToConsole_ = function(msg) {\n  if (goog.global.console) {\n    goog.global.console['error'](msg);\n  }\n};\n\n\n/**\n * Implements a system for the dynamic resolution of dependencies that works in\n * parallel with the BUILD system.\n *\n * Note that all calls to goog.require will be stripped by the compiler.\n *\n * @see goog.provide\n * @param {string} namespace Namespace (as was given in goog.provide,\n *     goog.module, or goog.declareModuleId) in the form\n *     \"goog.package.part\".\n * @return {?} If called within a goog.module or ES6 module file, the associated\n *     namespace or module otherwise null.\n */\ngoog.require = function(namespace) {\n  if (!COMPILED) {\n    // Might need to lazy load on old IE.\n    if (goog.ENABLE_DEBUG_LOADER) {\n      goog.debugLoader_.requested(namespace);\n    }\n\n    // If the object already exists we do not need to do anything.\n    if (goog.isProvided_(namespace)) {\n      if (goog.isInModuleLoader_()) {\n        return goog.module.getInternal_(namespace);\n      }\n    } else if (goog.ENABLE_DEBUG_LOADER) {\n      var moduleLoaderState = goog.moduleLoaderState_;\n      goog.moduleLoaderState_ = null;\n      try {\n        goog.debugLoader_.load_(namespace);\n      } finally {\n        goog.moduleLoaderState_ = moduleLoaderState;\n      }\n    }\n\n    return null;\n  }\n};\n\n\n/**\n * Requires a symbol for its type information. This is an indication to the\n * compiler that the symbol may appear in type annotations, yet it is not\n * referenced at runtime.\n *\n * When called within a goog.module or ES6 module file, the return value may be\n * assigned to or destructured into a variable, but it may not be otherwise used\n * in code outside of a type annotation.\n *\n * Note that all calls to goog.requireType will be stripped by the compiler.\n *\n * @param {string} namespace Namespace (as was given in goog.provide,\n *     goog.module, or goog.declareModuleId) in the form\n *     \"goog.package.part\".\n * @return {?}\n */\ngoog.requireType = function(namespace) {\n  // Return an empty object so that single-level destructuring of the return\n  // value doesn't crash at runtime when using the debug loader. Multi-level\n  // destructuring isn't supported.\n  return {};\n};\n\n\n/**\n * Path for included scripts.\n * @type {string}\n */\ngoog.basePath = '';\n\n\n/**\n * A hook for overriding the base path.\n * @type {string|undefined}\n */\ngoog.global.CLOSURE_BASE_PATH;\n\n\n/**\n * Whether to attempt to load Closure's deps file. By default, when uncompiled,\n * deps files will attempt to be loaded.\n * @type {boolean|undefined}\n */\ngoog.global.CLOSURE_NO_DEPS;\n\n\n/**\n * A function to import a single script. This is meant to be overridden when\n * Closure is being run in non-HTML contexts, such as web workers. It's defined\n * in the global scope so that it can be set before base.js is loaded, which\n * allows deps.js to be imported properly.\n *\n * The first parameter the script source, which is a relative URI. The second,\n * optional parameter is the script contents, in the event the script needed\n * transformation. It should return true if the script was imported, false\n * otherwise.\n * @type {(function(string, string=): boolean)|undefined}\n */\ngoog.global.CLOSURE_IMPORT_SCRIPT;\n\n\n/**\n * Null function used for default values of callbacks, etc.\n * @return {void} Nothing.\n */\ngoog.nullFunction = function() {};\n\n\n/**\n * When defining a class Foo with an abstract method bar(), you can do:\n * Foo.prototype.bar = goog.abstractMethod\n *\n * Now if a subclass of Foo fails to override bar(), an error will be thrown\n * when bar() is invoked.\n *\n * @type {!Function}\n * @throws {Error} when invoked to indicate the method should be overridden.\n */\ngoog.abstractMethod = function() {\n  throw new Error('unimplemented abstract method');\n};\n\n\n/**\n * Adds a `getInstance` static method that always returns the same\n * instance object.\n * @param {!Function} ctor The constructor for the class to add the static\n *     method to.\n * @suppress {missingProperties} 'instance_' isn't a property on 'Function'\n *     but we don't have a better type to use here.\n */\ngoog.addSingletonGetter = function(ctor) {\n  // instance_ is immediately set to prevent issues with sealed constructors\n  // such as are encountered when a constructor is returned as the export object\n  // of a goog.module in unoptimized code.\n  // Delcare type to avoid conformance violations that ctor.instance_ is unknown\n  /** @type {undefined|!Object} @suppress {underscore} */\n  ctor.instance_ = undefined;\n  ctor.getInstance = function() {\n    if (ctor.instance_) {\n      return ctor.instance_;\n    }\n    if (goog.DEBUG) {\n      // NOTE: JSCompiler can't optimize away Array#push.\n      goog.instantiatedSingletons_[goog.instantiatedSingletons_.length] = ctor;\n    }\n    // Cast to avoid conformance violations that ctor.instance_ is unknown\n    return /** @type {!Object|undefined} */ (ctor.instance_) = new ctor;\n  };\n};\n\n\n/**\n * All singleton classes that have been instantiated, for testing. Don't read\n * it directly, use the `goog.testing.singleton` module. The compiler\n * removes this variable if unused.\n * @type {!Array<!Function>}\n * @private\n */\ngoog.instantiatedSingletons_ = [];\n\n\n/**\n * @define {boolean} Whether to load goog.modules using `eval` when using\n * the debug loader.  This provides a better debugging experience as the\n * source is unmodified and can be edited using Chrome Workspaces or similar.\n * However in some environments the use of `eval` is banned\n * so we provide an alternative.\n */\ngoog.LOAD_MODULE_USING_EVAL = goog.define('goog.LOAD_MODULE_USING_EVAL', true);\n\n\n/**\n * @define {boolean} Whether the exports of goog.modules should be sealed when\n * possible.\n */\ngoog.SEAL_MODULE_EXPORTS = goog.define('goog.SEAL_MODULE_EXPORTS', goog.DEBUG);\n\n\n/**\n * The registry of initialized modules:\n * The module identifier or path to module exports map.\n * @private @const {!Object<string, {exports:?,type:string,moduleId:string}>}\n */\ngoog.loadedModules_ = {};\n\n\n/**\n * True if the debug loader enabled and used.\n * @const {boolean}\n */\ngoog.DEPENDENCIES_ENABLED = !COMPILED && goog.ENABLE_DEBUG_LOADER;\n\n\n/**\n * @define {string} How to decide whether to transpile.  Valid values\n * are 'always', 'never', and 'detect'.  The default ('detect') is to\n * use feature detection to determine which language levels need\n * transpilation.\n */\n// NOTE(sdh): we could expand this to accept a language level to bypass\n// detection: e.g. goog.TRANSPILE == 'es5' would transpile ES6 files but\n// would leave ES3 and ES5 files alone.\ngoog.TRANSPILE = goog.define('goog.TRANSPILE', 'detect');\n\n/**\n * @define {boolean} If true assume that ES modules have already been\n * transpiled by the jscompiler (in the same way that transpile.js would\n * transpile them - to jscomp modules). Useful only for servers that wish to use\n * the debug loader and transpile server side. Thus this is only respected if\n * goog.TRANSPILE is \"never\".\n */\ngoog.ASSUME_ES_MODULES_TRANSPILED =\n    goog.define('goog.ASSUME_ES_MODULES_TRANSPILED', false);\n\n\n/**\n * @define {string} If a file needs to be transpiled what the output language\n * should be. By default this is the highest language level this file detects\n * the current environment supports. Generally this flag should not be set, but\n * it could be useful to override. Example: If the current environment supports\n * ES6 then by default ES7+ files will be transpiled to ES6, unless this is\n * overridden.\n *\n * Valid values include: es3, es5, es6, es7, and es8. Anything not recognized\n * is treated as es3.\n *\n * Note that setting this value does not force transpilation. Just if\n * transpilation occurs this will be the output. So this is most useful when\n * goog.TRANSPILE is set to 'always' and then forcing the language level to be\n * something lower than what the environment detects.\n */\ngoog.TRANSPILE_TO_LANGUAGE = goog.define('goog.TRANSPILE_TO_LANGUAGE', '');\n\n\n/**\n * @define {string} Path to the transpiler.  Executing the script at this\n * path (relative to base.js) should define a function $jscomp.transpile.\n */\ngoog.TRANSPILER = goog.define('goog.TRANSPILER', 'transpile.js');\n\n\n/**\n * @package {?boolean}\n * Visible for testing.\n */\ngoog.hasBadLetScoping = null;\n\n\n/**\n * @return {boolean}\n * @package Visible for testing.\n */\ngoog.useSafari10Workaround = function() {\n  if (goog.hasBadLetScoping == null) {\n    var hasBadLetScoping;\n    try {\n      hasBadLetScoping = !eval(\n          '\"use strict\";' +\n          'let x = 1; function f() { return typeof x; };' +\n          'f() == \"number\";');\n    } catch (e) {\n      // Assume that ES6 syntax isn't supported.\n      hasBadLetScoping = false;\n    }\n    goog.hasBadLetScoping = hasBadLetScoping;\n  }\n  return goog.hasBadLetScoping;\n};\n\n\n/**\n * @param {string} moduleDef\n * @return {string}\n * @package Visible for testing.\n */\ngoog.workaroundSafari10EvalBug = function(moduleDef) {\n  return '(function(){' + moduleDef +\n      '\\n' +  // Terminate any trailing single line comment.\n      ';' +   // Terminate any trailing expression.\n      '})();\\n';\n};\n\n\n/**\n * @param {function(?):?|string} moduleDef The module definition.\n */\ngoog.loadModule = function(moduleDef) {\n  // NOTE: we allow function definitions to be either in the from\n  // of a string to eval (which keeps the original source intact) or\n  // in a eval forbidden environment (CSP) we allow a function definition\n  // which in its body must call `goog.module`, and return the exports\n  // of the module.\n  var previousState = goog.moduleLoaderState_;\n  try {\n    goog.moduleLoaderState_ = {\n      moduleName: '',\n      declareLegacyNamespace: false,\n      type: goog.ModuleType.GOOG\n    };\n    var exports;\n    if (goog.isFunction(moduleDef)) {\n      exports = moduleDef.call(undefined, {});\n    } else if (goog.isString(moduleDef)) {\n      if (goog.useSafari10Workaround()) {\n        moduleDef = goog.workaroundSafari10EvalBug(moduleDef);\n      }\n\n      exports = goog.loadModuleFromSource_.call(undefined, moduleDef);\n    } else {\n      throw new Error('Invalid module definition');\n    }\n\n    var moduleName = goog.moduleLoaderState_.moduleName;\n    if (goog.isString(moduleName) && moduleName) {\n      // Don't seal legacy namespaces as they may be used as a parent of\n      // another namespace\n      if (goog.moduleLoaderState_.declareLegacyNamespace) {\n        goog.constructNamespace_(moduleName, exports);\n      } else if (\n          goog.SEAL_MODULE_EXPORTS && Object.seal &&\n          typeof exports == 'object' && exports != null) {\n        Object.seal(exports);\n      }\n\n      var data = {\n        exports: exports,\n        type: goog.ModuleType.GOOG,\n        moduleId: goog.moduleLoaderState_.moduleName\n      };\n      goog.loadedModules_[moduleName] = data;\n    } else {\n      throw new Error('Invalid module name \\\"' + moduleName + '\\\"');\n    }\n  } finally {\n    goog.moduleLoaderState_ = previousState;\n  }\n};\n\n\n/**\n * @private @const\n */\ngoog.loadModuleFromSource_ = /** @type {function(string):?} */ (function() {\n  // NOTE: we avoid declaring parameters or local variables here to avoid\n  // masking globals or leaking values into the module definition.\n  'use strict';\n  var exports = {};\n  eval(arguments[0]);\n  return exports;\n});\n\n\n/**\n * Normalize a file path by removing redundant \"..\" and extraneous \".\" file\n * path components.\n * @param {string} path\n * @return {string}\n * @private\n */\ngoog.normalizePath_ = function(path) {\n  var components = path.split('/');\n  var i = 0;\n  while (i < components.length) {\n    if (components[i] == '.') {\n      components.splice(i, 1);\n    } else if (\n        i && components[i] == '..' && components[i - 1] &&\n        components[i - 1] != '..') {\n      components.splice(--i, 2);\n    } else {\n      i++;\n    }\n  }\n  return components.join('/');\n};\n\n\n/**\n * Provides a hook for loading a file when using Closure's goog.require() API\n * with goog.modules.  In particular this hook is provided to support Node.js.\n *\n * @type {(function(string):string)|undefined}\n */\ngoog.global.CLOSURE_LOAD_FILE_SYNC;\n\n\n/**\n * Loads file by synchronous XHR. Should not be used in production environments.\n * @param {string} src Source URL.\n * @return {?string} File contents, or null if load failed.\n * @private\n */\ngoog.loadFileSync_ = function(src) {\n  if (goog.global.CLOSURE_LOAD_FILE_SYNC) {\n    return goog.global.CLOSURE_LOAD_FILE_SYNC(src);\n  } else {\n    try {\n      /** @type {XMLHttpRequest} */\n      var xhr = new goog.global['XMLHttpRequest']();\n      xhr.open('get', src, false);\n      xhr.send();\n      // NOTE: Successful http: requests have a status of 200, but successful\n      // file: requests may have a status of zero.  Any other status, or a\n      // thrown exception (particularly in case of file: requests) indicates\n      // some sort of error, which we treat as a missing or unavailable file.\n      return xhr.status == 0 || xhr.status == 200 ? xhr.responseText : null;\n    } catch (err) {\n      // No need to rethrow or log, since errors should show up on their own.\n      return null;\n    }\n  }\n};\n\n\n/**\n * Lazily retrieves the transpiler and applies it to the source.\n * @param {string} code JS code.\n * @param {string} path Path to the code.\n * @param {string} target Language level output.\n * @return {string} The transpiled code.\n * @private\n */\ngoog.transpile_ = function(code, path, target) {\n  var jscomp = goog.global['$jscomp'];\n  if (!jscomp) {\n    goog.global['$jscomp'] = jscomp = {};\n  }\n  var transpile = jscomp.transpile;\n  if (!transpile) {\n    var transpilerPath = goog.basePath + goog.TRANSPILER;\n    var transpilerCode = goog.loadFileSync_(transpilerPath);\n    if (transpilerCode) {\n      // This must be executed synchronously, since by the time we know we\n      // need it, we're about to load and write the ES6 code synchronously,\n      // so a normal script-tag load will be too slow. Wrapped in a function\n      // so that code is eval'd in the global scope.\n      (function() {\n        (0, eval)(transpilerCode + '\\n//# sourceURL=' + transpilerPath);\n      }).call(goog.global);\n      // Even though the transpiler is optional, if $gwtExport is found, it's\n      // a sign the transpiler was loaded and the $jscomp.transpile *should*\n      // be there.\n      if (goog.global['$gwtExport'] && goog.global['$gwtExport']['$jscomp'] &&\n          !goog.global['$gwtExport']['$jscomp']['transpile']) {\n        throw new Error(\n            'The transpiler did not properly export the \"transpile\" ' +\n            'method. $gwtExport: ' + JSON.stringify(goog.global['$gwtExport']));\n      }\n      // transpile.js only exports a single $jscomp function, transpile. We\n      // grab just that and add it to the existing definition of $jscomp which\n      // contains the polyfills.\n      goog.global['$jscomp'].transpile =\n          goog.global['$gwtExport']['$jscomp']['transpile'];\n      jscomp = goog.global['$jscomp'];\n      transpile = jscomp.transpile;\n    }\n  }\n  if (!transpile) {\n    // The transpiler is an optional component.  If it's not available then\n    // replace it with a pass-through function that simply logs.\n    var suffix = ' requires transpilation but no transpiler was found.';\n    transpile = jscomp.transpile = function(code, path) {\n      // TODO(sdh): figure out some way to get this error to show up\n      // in test results, noting that the failure may occur in many\n      // different ways, including in loadModule() before the test\n      // runner even comes up.\n      goog.logToConsole_(path + suffix);\n      return code;\n    };\n  }\n  // Note: any transpilation errors/warnings will be logged to the console.\n  return transpile(code, path, target);\n};\n\n//==============================================================================\n// Language Enhancements\n//==============================================================================\n\n\n/**\n * This is a \"fixed\" version of the typeof operator.  It differs from the typeof\n * operator in such a way that null returns 'null' and arrays return 'array'.\n * @param {?} value The value to get the type of.\n * @return {string} The name of the type.\n */\ngoog.typeOf = function(value) {\n  var s = typeof value;\n  if (s == 'object') {\n    if (value) {\n      // Check these first, so we can avoid calling Object.prototype.toString if\n      // possible.\n      //\n      // IE improperly marshals typeof across execution contexts, but a\n      // cross-context object will still return false for \"instanceof Object\".\n      if (value instanceof Array) {\n        return 'array';\n      } else if (value instanceof Object) {\n        return s;\n      }\n\n      // HACK: In order to use an Object prototype method on the arbitrary\n      //   value, the compiler requires the value be cast to type Object,\n      //   even though the ECMA spec explicitly allows it.\n      var className = Object.prototype.toString.call(\n          /** @type {!Object} */ (value));\n      // In Firefox 3.6, attempting to access iframe window objects' length\n      // property throws an NS_ERROR_FAILURE, so we need to special-case it\n      // here.\n      if (className == '[object Window]') {\n        return 'object';\n      }\n\n      // We cannot always use constructor == Array or instanceof Array because\n      // different frames have different Array objects. In IE6, if the iframe\n      // where the array was created is destroyed, the array loses its\n      // prototype. Then dereferencing val.splice here throws an exception, so\n      // we can't use goog.isFunction. Calling typeof directly returns 'unknown'\n      // so that will work. In this case, this function will return false and\n      // most array functions will still work because the array is still\n      // array-like (supports length and []) even though it has lost its\n      // prototype.\n      // Mark Miller noticed that Object.prototype.toString\n      // allows access to the unforgeable [[Class]] property.\n      //  15.2.4.2 Object.prototype.toString ( )\n      //  When the toString method is called, the following steps are taken:\n      //      1. Get the [[Class]] property of this object.\n      //      2. Compute a string value by concatenating the three strings\n      //         \"[object \", Result(1), and \"]\".\n      //      3. Return Result(2).\n      // and this behavior survives the destruction of the execution context.\n      if ((className == '[object Array]' ||\n           // In IE all non value types are wrapped as objects across window\n           // boundaries (not iframe though) so we have to do object detection\n           // for this edge case.\n           typeof value.length == 'number' &&\n               typeof value.splice != 'undefined' &&\n               typeof value.propertyIsEnumerable != 'undefined' &&\n               !value.propertyIsEnumerable('splice')\n\n               )) {\n        return 'array';\n      }\n      // HACK: There is still an array case that fails.\n      //     function ArrayImpostor() {}\n      //     ArrayImpostor.prototype = [];\n      //     var impostor = new ArrayImpostor;\n      // this can be fixed by getting rid of the fast path\n      // (value instanceof Array) and solely relying on\n      // (value && Object.prototype.toString.vall(value) === '[object Array]')\n      // but that would require many more function calls and is not warranted\n      // unless closure code is receiving objects from untrusted sources.\n\n      // IE in cross-window calls does not correctly marshal the function type\n      // (it appears just as an object) so we cannot use just typeof val ==\n      // 'function'. However, if the object has a call property, it is a\n      // function.\n      if ((className == '[object Function]' ||\n           typeof value.call != 'undefined' &&\n               typeof value.propertyIsEnumerable != 'undefined' &&\n               !value.propertyIsEnumerable('call'))) {\n        return 'function';\n      }\n\n    } else {\n      return 'null';\n    }\n\n  } else if (s == 'function' && typeof value.call == 'undefined') {\n    // In Safari typeof nodeList returns 'function', and on Firefox typeof\n    // behaves similarly for HTML{Applet,Embed,Object}, Elements and RegExps. We\n    // would like to return object for those and we can detect an invalid\n    // function by making sure that the function object has a call method.\n    return 'object';\n  }\n  return s;\n};\n\n\n/**\n * Returns true if the specified value is null.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is null.\n */\ngoog.isNull = function(val) {\n  return val === null;\n};\n\n\n/**\n * Returns true if the specified value is defined and not null.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is defined and not null.\n */\ngoog.isDefAndNotNull = function(val) {\n  // Note that undefined == null.\n  return val != null;\n};\n\n\n/**\n * Returns true if the specified value is an array.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is an array.\n */\ngoog.isArray = function(val) {\n  return goog.typeOf(val) == 'array';\n};\n\n\n/**\n * Returns true if the object looks like an array. To qualify as array like\n * the value needs to be either a NodeList or an object with a Number length\n * property. Note that for this function neither strings nor functions are\n * considered \"array-like\".\n *\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is an array.\n */\ngoog.isArrayLike = function(val) {\n  var type = goog.typeOf(val);\n  // We do not use goog.isObject here in order to exclude function values.\n  return type == 'array' || type == 'object' && typeof val.length == 'number';\n};\n\n\n/**\n * Returns true if the object looks like a Date. To qualify as Date-like the\n * value needs to be an object and have a getFullYear() function.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is a like a Date.\n */\ngoog.isDateLike = function(val) {\n  return goog.isObject(val) && typeof val.getFullYear == 'function';\n};\n\n\n/**\n * Returns true if the specified value is a function.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is a function.\n */\ngoog.isFunction = function(val) {\n  return goog.typeOf(val) == 'function';\n};\n\n\n/**\n * Returns true if the specified value is an object.  This includes arrays and\n * functions.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is an object.\n */\ngoog.isObject = function(val) {\n  var type = typeof val;\n  return type == 'object' && val != null || type == 'function';\n  // return Object(val) === val also works, but is slower, especially if val is\n  // not an object.\n};\n\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. The unique ID is\n * guaranteed to be unique across the current session amongst objects that are\n * passed into `getUid`. There is no guarantee that the ID is unique or\n * consistent across sessions. It is unsafe to generate unique ID for function\n * prototypes.\n *\n * @param {Object} obj The object to get the unique ID for.\n * @return {number} The unique ID for the object.\n */\ngoog.getUid = function(obj) {\n  // TODO(arv): Make the type stricter, do not accept null.\n\n  // In Opera window.hasOwnProperty exists but always returns false so we avoid\n  // using it. As a consequence the unique ID generated for BaseClass.prototype\n  // and SubClass.prototype will be the same.\n  return obj[goog.UID_PROPERTY_] ||\n      (obj[goog.UID_PROPERTY_] = ++goog.uidCounter_);\n};\n\n\n/**\n * Whether the given object is already assigned a unique ID.\n *\n * This does not modify the object.\n *\n * @param {!Object} obj The object to check.\n * @return {boolean} Whether there is an assigned unique id for the object.\n */\ngoog.hasUid = function(obj) {\n  return !!obj[goog.UID_PROPERTY_];\n};\n\n\n/**\n * Removes the unique ID from an object. This is useful if the object was\n * previously mutated using `goog.getUid` in which case the mutation is\n * undone.\n * @param {Object} obj The object to remove the unique ID field from.\n */\ngoog.removeUid = function(obj) {\n  // TODO(arv): Make the type stricter, do not accept null.\n\n  // In IE, DOM nodes are not instances of Object and throw an exception if we\n  // try to delete.  Instead we try to use removeAttribute.\n  if (obj !== null && 'removeAttribute' in obj) {\n    obj.removeAttribute(goog.UID_PROPERTY_);\n  }\n\n  try {\n    delete obj[goog.UID_PROPERTY_];\n  } catch (ex) {\n  }\n};\n\n\n/**\n * Name for unique ID property. Initialized in a way to help avoid collisions\n * with other closure JavaScript on the same page.\n * @type {string}\n * @private\n */\ngoog.UID_PROPERTY_ = 'closure_uid_' + ((Math.random() * 1e9) >>> 0);\n\n\n/**\n * Counter for UID.\n * @type {number}\n * @private\n */\ngoog.uidCounter_ = 0;\n\n\n/**\n * Adds a hash code field to an object. The hash code is unique for the\n * given object.\n * @param {Object} obj The object to get the hash code for.\n * @return {number} The hash code for the object.\n * @deprecated Use goog.getUid instead.\n */\ngoog.getHashCode = goog.getUid;\n\n\n/**\n * Removes the hash code field from an object.\n * @param {Object} obj The object to remove the field from.\n * @deprecated Use goog.removeUid instead.\n */\ngoog.removeHashCode = goog.removeUid;\n\n\n/**\n * Clones a value. The input may be an Object, Array, or basic type. Objects and\n * arrays will be cloned recursively.\n *\n * WARNINGS:\n * <code>goog.cloneObject</code> does not detect reference loops. Objects that\n * refer to themselves will cause infinite recursion.\n *\n * <code>goog.cloneObject</code> is unaware of unique identifiers, and copies\n * UIDs created by <code>getUid</code> into cloned results.\n *\n * @param {*} obj The value to clone.\n * @return {*} A clone of the input value.\n * @deprecated goog.cloneObject is unsafe. Prefer the goog.object methods.\n */\ngoog.cloneObject = function(obj) {\n  var type = goog.typeOf(obj);\n  if (type == 'object' || type == 'array') {\n    if (typeof obj.clone === 'function') {\n      return obj.clone();\n    }\n    var clone = type == 'array' ? [] : {};\n    for (var key in obj) {\n      clone[key] = goog.cloneObject(obj[key]);\n    }\n    return clone;\n  }\n\n  return obj;\n};\n\n\n/**\n * A native implementation of goog.bind.\n * @param {?function(this:T, ...)} fn A function to partially apply.\n * @param {T} selfObj Specifies the object which this should point to when the\n *     function is run.\n * @param {...*} var_args Additional arguments that are partially applied to the\n *     function.\n * @return {!Function} A partially-applied form of the function goog.bind() was\n *     invoked as a method of.\n * @template T\n * @private\n */\ngoog.bindNative_ = function(fn, selfObj, var_args) {\n  return /** @type {!Function} */ (fn.call.apply(fn.bind, arguments));\n};\n\n\n/**\n * A pure-JS implementation of goog.bind.\n * @param {?function(this:T, ...)} fn A function to partially apply.\n * @param {T} selfObj Specifies the object which this should point to when the\n *     function is run.\n * @param {...*} var_args Additional arguments that are partially applied to the\n *     function.\n * @return {!Function} A partially-applied form of the function goog.bind() was\n *     invoked as a method of.\n * @template T\n * @private\n */\ngoog.bindJs_ = function(fn, selfObj, var_args) {\n  if (!fn) {\n    throw new Error();\n  }\n\n  if (arguments.length > 2) {\n    var boundArgs = Array.prototype.slice.call(arguments, 2);\n    return function() {\n      // Prepend the bound arguments to the current arguments.\n      var newArgs = Array.prototype.slice.call(arguments);\n      Array.prototype.unshift.apply(newArgs, boundArgs);\n      return fn.apply(selfObj, newArgs);\n    };\n\n  } else {\n    return function() {\n      return fn.apply(selfObj, arguments);\n    };\n  }\n};\n\n\n/**\n * Partially applies this function to a particular 'this object' and zero or\n * more arguments. The result is a new function with some arguments of the first\n * function pre-filled and the value of this 'pre-specified'.\n *\n * Remaining arguments specified at call-time are appended to the pre-specified\n * ones.\n *\n * Also see: {@link #partial}.\n *\n * Usage:\n * <pre>var barMethBound = goog.bind(myFunction, myObj, 'arg1', 'arg2');\n * barMethBound('arg3', 'arg4');</pre>\n *\n * @param {?function(this:T, ...)} fn A function to partially apply.\n * @param {T} selfObj Specifies the object which this should point to when the\n *     function is run.\n * @param {...*} var_args Additional arguments that are partially applied to the\n *     function.\n * @return {!Function} A partially-applied form of the function goog.bind() was\n *     invoked as a method of.\n * @template T\n * @suppress {deprecated} See above.\n */\ngoog.bind = function(fn, selfObj, var_args) {\n  // TODO(nicksantos): narrow the type signature.\n  if (Function.prototype.bind &&\n      // NOTE(nicksantos): Somebody pulled base.js into the default Chrome\n      // extension environment. This means that for Chrome extensions, they get\n      // the implementation of Function.prototype.bind that calls goog.bind\n      // instead of the native one. Even worse, we don't want to introduce a\n      // circular dependency between goog.bind and Function.prototype.bind, so\n      // we have to hack this to make sure it works correctly.\n      Function.prototype.bind.toString().indexOf('native code') != -1) {\n    goog.bind = goog.bindNative_;\n  } else {\n    goog.bind = goog.bindJs_;\n  }\n  return goog.bind.apply(null, arguments);\n};\n\n\n/**\n * Like goog.bind(), except that a 'this object' is not required. Useful when\n * the target function is already bound.\n *\n * Usage:\n * var g = goog.partial(f, arg1, arg2);\n * g(arg3, arg4);\n *\n * @param {Function} fn A function to partially apply.\n * @param {...*} var_args Additional arguments that are partially applied to fn.\n * @return {!Function} A partially-applied form of the function goog.partial()\n *     was invoked as a method of.\n */\ngoog.partial = function(fn, var_args) {\n  var args = Array.prototype.slice.call(arguments, 1);\n  return function() {\n    // Clone the array (with slice()) and append additional arguments\n    // to the existing arguments.\n    var newArgs = args.slice();\n    newArgs.push.apply(newArgs, arguments);\n    return fn.apply(/** @type {?} */ (this), newArgs);\n  };\n};\n\n\n/**\n * Copies all the members of a source object to a target object. This method\n * does not work on all browsers for all objects that contain keys such as\n * toString or hasOwnProperty. Use goog.object.extend for this purpose.\n * @param {Object} target Target.\n * @param {Object} source Source.\n */\ngoog.mixin = function(target, source) {\n  for (var x in source) {\n    target[x] = source[x];\n  }\n\n  // For IE7 or lower, the for-in-loop does not contain any properties that are\n  // not enumerable on the prototype object (for example, isPrototypeOf from\n  // Object.prototype) but also it will not include 'replace' on objects that\n  // extend String and change 'replace' (not that it is common for anyone to\n  // extend anything except Object).\n};\n\n\n/**\n * @return {number} An integer value representing the number of milliseconds\n *     between midnight, January 1, 1970 and the current time.\n */\ngoog.now = (goog.TRUSTED_SITE && Date.now) || (function() {\n             // Unary plus operator converts its operand to a number which in\n             // the case of\n             // a date is done by calling getTime().\n             return +new Date();\n           });\n\n\n/**\n * Evals JavaScript in the global scope.  In IE this uses execScript, other\n * browsers use goog.global.eval. If goog.global.eval does not evaluate in the\n * global scope (for example, in Safari), appends a script tag instead.\n * Throws an exception if neither execScript or eval is defined.\n * @param {string} script JavaScript string.\n */\ngoog.globalEval = function(script) {\n  if (goog.global.execScript) {\n    goog.global.execScript(script, 'JavaScript');\n  } else if (goog.global.eval) {\n    // Test to see if eval works\n    if (goog.evalWorksForGlobals_ == null) {\n      try {\n        goog.global.eval('var _evalTest_ = 1;');\n      } catch (ignore) {\n      }\n      if (typeof goog.global['_evalTest_'] != 'undefined') {\n        try {\n          delete goog.global['_evalTest_'];\n        } catch (ignore) {\n          // Microsoft edge fails the deletion above in strict mode.\n        }\n        goog.evalWorksForGlobals_ = true;\n      } else {\n        goog.evalWorksForGlobals_ = false;\n      }\n    }\n\n    if (goog.evalWorksForGlobals_) {\n      goog.global.eval(script);\n    } else {\n      /** @type {!Document} */\n      var doc = goog.global.document;\n      var scriptElt =\n          /** @type {!HTMLScriptElement} */ (doc.createElement('SCRIPT'));\n      scriptElt.type = 'text/javascript';\n      scriptElt.defer = false;\n      // Note(user): can't use .innerHTML since \"t('<test>')\" will fail and\n      // .text doesn't work in Safari 2.  Therefore we append a text node.\n      scriptElt.appendChild(doc.createTextNode(script));\n      doc.head.appendChild(scriptElt);\n      doc.head.removeChild(scriptElt);\n    }\n  } else {\n    throw new Error('goog.globalEval not available');\n  }\n};\n\n\n/**\n * Indicates whether or not we can call 'eval' directly to eval code in the\n * global scope. Set to a Boolean by the first call to goog.globalEval (which\n * empirically tests whether eval works for globals). @see goog.globalEval\n * @type {?boolean}\n * @private\n */\ngoog.evalWorksForGlobals_ = null;\n\n\n/**\n * Optional map of CSS class names to obfuscated names used with\n * goog.getCssName().\n * @private {!Object<string, string>|undefined}\n * @see goog.setCssNameMapping\n */\ngoog.cssNameMapping_;\n\n\n/**\n * Optional obfuscation style for CSS class names. Should be set to either\n * 'BY_WHOLE' or 'BY_PART' if defined.\n * @type {string|undefined}\n * @private\n * @see goog.setCssNameMapping\n */\ngoog.cssNameMappingStyle_;\n\n\n\n/**\n * A hook for modifying the default behavior goog.getCssName. The function\n * if present, will receive the standard output of the goog.getCssName as\n * its input.\n *\n * @type {(function(string):string)|undefined}\n */\ngoog.global.CLOSURE_CSS_NAME_MAP_FN;\n\n\n/**\n * Handles strings that are intended to be used as CSS class names.\n *\n * This function works in tandem with @see goog.setCssNameMapping.\n *\n * Without any mapping set, the arguments are simple joined with a hyphen and\n * passed through unaltered.\n *\n * When there is a mapping, there are two possible styles in which these\n * mappings are used. In the BY_PART style, each part (i.e. in between hyphens)\n * of the passed in css name is rewritten according to the map. In the BY_WHOLE\n * style, the full css name is looked up in the map directly. If a rewrite is\n * not specified by the map, the compiler will output a warning.\n *\n * When the mapping is passed to the compiler, it will replace calls to\n * goog.getCssName with the strings from the mapping, e.g.\n *     var x = goog.getCssName('foo');\n *     var y = goog.getCssName(this.baseClass, 'active');\n *  becomes:\n *     var x = 'foo';\n *     var y = this.baseClass + '-active';\n *\n * If one argument is passed it will be processed, if two are passed only the\n * modifier will be processed, as it is assumed the first argument was generated\n * as a result of calling goog.getCssName.\n *\n * @param {string} className The class name.\n * @param {string=} opt_modifier A modifier to be appended to the class name.\n * @return {string} The class name or the concatenation of the class name and\n *     the modifier.\n */\ngoog.getCssName = function(className, opt_modifier) {\n  // String() is used for compatibility with compiled soy where the passed\n  // className can be non-string objects.\n  if (String(className).charAt(0) == '.') {\n    throw new Error(\n        'className passed in goog.getCssName must not start with \".\".' +\n        ' You passed: ' + className);\n  }\n\n  var getMapping = function(cssName) {\n    return goog.cssNameMapping_[cssName] || cssName;\n  };\n\n  var renameByParts = function(cssName) {\n    // Remap all the parts individually.\n    var parts = cssName.split('-');\n    var mapped = [];\n    for (var i = 0; i < parts.length; i++) {\n      mapped.push(getMapping(parts[i]));\n    }\n    return mapped.join('-');\n  };\n\n  var rename;\n  if (goog.cssNameMapping_) {\n    rename =\n        goog.cssNameMappingStyle_ == 'BY_WHOLE' ? getMapping : renameByParts;\n  } else {\n    rename = function(a) {\n      return a;\n    };\n  }\n\n  var result =\n      opt_modifier ? className + '-' + rename(opt_modifier) : rename(className);\n\n  // The special CLOSURE_CSS_NAME_MAP_FN allows users to specify further\n  // processing of the class name.\n  if (goog.global.CLOSURE_CSS_NAME_MAP_FN) {\n    return goog.global.CLOSURE_CSS_NAME_MAP_FN(result);\n  }\n\n  return result;\n};\n\n\n/**\n * Sets the map to check when returning a value from goog.getCssName(). Example:\n * <pre>\n * goog.setCssNameMapping({\n *   \"goog\": \"a\",\n *   \"disabled\": \"b\",\n * });\n *\n * var x = goog.getCssName('goog');\n * // The following evaluates to: \"a a-b\".\n * goog.getCssName('goog') + ' ' + goog.getCssName(x, 'disabled')\n * </pre>\n * When declared as a map of string literals to string literals, the JSCompiler\n * will replace all calls to goog.getCssName() using the supplied map if the\n * --process_closure_primitives flag is set.\n *\n * @param {!Object} mapping A map of strings to strings where keys are possible\n *     arguments to goog.getCssName() and values are the corresponding values\n *     that should be returned.\n * @param {string=} opt_style The style of css name mapping. There are two valid\n *     options: 'BY_PART', and 'BY_WHOLE'.\n * @see goog.getCssName for a description.\n */\ngoog.setCssNameMapping = function(mapping, opt_style) {\n  goog.cssNameMapping_ = mapping;\n  goog.cssNameMappingStyle_ = opt_style;\n};\n\n\n/**\n * To use CSS renaming in compiled mode, one of the input files should have a\n * call to goog.setCssNameMapping() with an object literal that the JSCompiler\n * can extract and use to replace all calls to goog.getCssName(). In uncompiled\n * mode, JavaScript code should be loaded before this base.js file that declares\n * a global variable, CLOSURE_CSS_NAME_MAPPING, which is used below. This is\n * to ensure that the mapping is loaded before any calls to goog.getCssName()\n * are made in uncompiled mode.\n *\n * A hook for overriding the CSS name mapping.\n * @type {!Object<string, string>|undefined}\n */\ngoog.global.CLOSURE_CSS_NAME_MAPPING;\n\n\nif (!COMPILED && goog.global.CLOSURE_CSS_NAME_MAPPING) {\n  // This does not call goog.setCssNameMapping() because the JSCompiler\n  // requires that goog.setCssNameMapping() be called with an object literal.\n  goog.cssNameMapping_ = goog.global.CLOSURE_CSS_NAME_MAPPING;\n}\n\n\n/**\n * Gets a localized message.\n *\n * This function is a compiler primitive. If you give the compiler a localized\n * message bundle, it will replace the string at compile-time with a localized\n * version, and expand goog.getMsg call to a concatenated string.\n *\n * Messages must be initialized in the form:\n * <code>\n * var MSG_NAME = goog.getMsg('Hello {$placeholder}', {'placeholder': 'world'});\n * </code>\n *\n * This function produces a string which should be treated as plain text. Use\n * {@link goog.html.SafeHtmlFormatter} in conjunction with goog.getMsg to\n * produce SafeHtml.\n *\n * @param {string} str Translatable string, places holders in the form {$foo}.\n * @param {Object<string, string>=} opt_values Maps place holder name to value.\n * @return {string} message with placeholders filled.\n */\ngoog.getMsg = function(str, opt_values) {\n  if (opt_values) {\n    str = str.replace(/\\{\\$([^}]+)}/g, function(match, key) {\n      return (opt_values != null && key in opt_values) ? opt_values[key] :\n                                                         match;\n    });\n  }\n  return str;\n};\n\n\n/**\n * Gets a localized message. If the message does not have a translation, gives a\n * fallback message.\n *\n * This is useful when introducing a new message that has not yet been\n * translated into all languages.\n *\n * This function is a compiler primitive. Must be used in the form:\n * <code>var x = goog.getMsgWithFallback(MSG_A, MSG_B);</code>\n * where MSG_A and MSG_B were initialized with goog.getMsg.\n *\n * @param {string} a The preferred message.\n * @param {string} b The fallback message.\n * @return {string} The best translated message.\n */\ngoog.getMsgWithFallback = function(a, b) {\n  return a;\n};\n\n\n/**\n * Exposes an unobfuscated global namespace path for the given object.\n * Note that fields of the exported object *will* be obfuscated, unless they are\n * exported in turn via this function or goog.exportProperty.\n *\n * Also handy for making public items that are defined in anonymous closures.\n *\n * ex. goog.exportSymbol('public.path.Foo', Foo);\n *\n * ex. goog.exportSymbol('public.path.Foo.staticFunction', Foo.staticFunction);\n *     public.path.Foo.staticFunction();\n *\n * ex. goog.exportSymbol('public.path.Foo.prototype.myMethod',\n *                       Foo.prototype.myMethod);\n *     new public.path.Foo().myMethod();\n *\n * @param {string} publicPath Unobfuscated name to export.\n * @param {*} object Object the name should point to.\n * @param {Object=} opt_objectToExportTo The object to add the path to; default\n *     is goog.global.\n */\ngoog.exportSymbol = function(publicPath, object, opt_objectToExportTo) {\n  goog.exportPath_(publicPath, object, opt_objectToExportTo);\n};\n\n\n/**\n * Exports a property unobfuscated into the object's namespace.\n * ex. goog.exportProperty(Foo, 'staticFunction', Foo.staticFunction);\n * ex. goog.exportProperty(Foo.prototype, 'myMethod', Foo.prototype.myMethod);\n * @param {Object} object Object whose static property is being exported.\n * @param {string} publicName Unobfuscated name to export.\n * @param {*} symbol Object the name should point to.\n */\ngoog.exportProperty = function(object, publicName, symbol) {\n  object[publicName] = symbol;\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * Usage:\n * <pre>\n * function ParentClass(a, b) { }\n * ParentClass.prototype.foo = function(a) { };\n *\n * function ChildClass(a, b, c) {\n *   ChildClass.base(this, 'constructor', a, b);\n * }\n * goog.inherits(ChildClass, ParentClass);\n *\n * var child = new ChildClass('a', 'b', 'see');\n * child.foo(); // This works.\n * </pre>\n *\n * @param {!Function} childCtor Child class.\n * @param {!Function} parentCtor Parent class.\n * @suppress {strictMissingProperties} superClass_ and base is not defined on\n *    Function.\n */\ngoog.inherits = function(childCtor, parentCtor) {\n  /** @constructor */\n  function tempCtor() {}\n  tempCtor.prototype = parentCtor.prototype;\n  childCtor.superClass_ = parentCtor.prototype;\n  childCtor.prototype = new tempCtor();\n  /** @override */\n  childCtor.prototype.constructor = childCtor;\n\n  /**\n   * Calls superclass constructor/method.\n   *\n   * This function is only available if you use goog.inherits to\n   * express inheritance relationships between classes.\n   *\n   * NOTE: This is a replacement for goog.base and for superClass_\n   * property defined in childCtor.\n   *\n   * @param {!Object} me Should always be \"this\".\n   * @param {string} methodName The method name to call. Calling\n   *     superclass constructor can be done with the special string\n   *     'constructor'.\n   * @param {...*} var_args The arguments to pass to superclass\n   *     method/constructor.\n   * @return {*} The return value of the superclass method/constructor.\n   */\n  childCtor.base = function(me, methodName, var_args) {\n    // Copying using loop to avoid deop due to passing arguments object to\n    // function. This is faster in many JS engines as of late 2014.\n    var args = new Array(arguments.length - 2);\n    for (var i = 2; i < arguments.length; i++) {\n      args[i - 2] = arguments[i];\n    }\n    return parentCtor.prototype[methodName].apply(me, args);\n  };\n};\n\n\n/**\n * Call up to the superclass.\n *\n * If this is called from a constructor, then this calls the superclass\n * constructor with arguments 1-N.\n *\n * If this is called from a prototype method, then you must pass the name of the\n * method as the second argument to this function. If you do not, you will get a\n * runtime error. This calls the superclass' method with arguments 2-N.\n *\n * This function only works if you use goog.inherits to express inheritance\n * relationships between your classes.\n *\n * This function is a compiler primitive. At compile-time, the compiler will do\n * macro expansion to remove a lot of the extra overhead that this function\n * introduces. The compiler will also enforce a lot of the assumptions that this\n * function makes, and treat it as a compiler error if you break them.\n *\n * @param {!Object} me Should always be \"this\".\n * @param {*=} opt_methodName The method name if calling a super method.\n * @param {...*} var_args The rest of the arguments.\n * @return {*} The return value of the superclass method.\n * @suppress {es5Strict} This method can not be used in strict mode, but\n *     all Closure Library consumers must depend on this file.\n * @deprecated goog.base is not strict mode compatible.  Prefer the static\n *     \"base\" method added to the constructor by goog.inherits\n *     or ES6 classes and the \"super\" keyword.\n */\ngoog.base = function(me, opt_methodName, var_args) {\n  var caller = arguments.callee.caller;\n\n  if (goog.STRICT_MODE_COMPATIBLE || (goog.DEBUG && !caller)) {\n    throw new Error(\n        'arguments.caller not defined.  goog.base() cannot be used ' +\n        'with strict mode code. See ' +\n        'http://www.ecma-international.org/ecma-262/5.1/#sec-C');\n  }\n\n  if (typeof caller.superClass_ !== 'undefined') {\n    // Copying using loop to avoid deop due to passing arguments object to\n    // function. This is faster in many JS engines as of late 2014.\n    var ctorArgs = new Array(arguments.length - 1);\n    for (var i = 1; i < arguments.length; i++) {\n      ctorArgs[i - 1] = arguments[i];\n    }\n    // This is a constructor. Call the superclass constructor.\n    return /** @type {!Function} */ (caller.superClass_)\n        .constructor.apply(me, ctorArgs);\n  }\n\n  if (typeof opt_methodName != 'string' && typeof opt_methodName != 'symbol') {\n    throw new Error(\n        'method names provided to goog.base must be a string or a symbol');\n  }\n\n  // Copying using loop to avoid deop due to passing arguments object to\n  // function. This is faster in many JS engines as of late 2014.\n  var args = new Array(arguments.length - 2);\n  for (var i = 2; i < arguments.length; i++) {\n    args[i - 2] = arguments[i];\n  }\n  var foundCaller = false;\n  for (var proto = me.constructor.prototype; proto;\n       proto = Object.getPrototypeOf(proto)) {\n    if (proto[opt_methodName] === caller) {\n      foundCaller = true;\n    } else if (foundCaller) {\n      return proto[opt_methodName].apply(me, args);\n    }\n  }\n\n  // If we did not find the caller in the prototype chain, then one of two\n  // things happened:\n  // 1) The caller is an instance method.\n  // 2) This method was not called by the right caller.\n  if (me[opt_methodName] === caller) {\n    return me.constructor.prototype[opt_methodName].apply(me, args);\n  } else {\n    throw new Error(\n        'goog.base called from a method of one name ' +\n        'to a method of a different name');\n  }\n};\n\n\n/**\n * Allow for aliasing within scope functions.  This function exists for\n * uncompiled code - in compiled code the calls will be inlined and the aliases\n * applied.  In uncompiled code the function is simply run since the aliases as\n * written are valid JavaScript.\n *\n *\n * @param {function()} fn Function to call.  This function can contain aliases\n *     to namespaces (e.g. \"var dom = goog.dom\") or classes\n *     (e.g. \"var Timer = goog.Timer\").\n */\ngoog.scope = function(fn) {\n  if (goog.isInModuleLoader_()) {\n    throw new Error('goog.scope is not supported within a module.');\n  }\n  fn.call(goog.global);\n};\n\n\n/*\n * To support uncompiled, strict mode bundles that use eval to divide source\n * like so:\n *    eval('someSource;//# sourceUrl sourcefile.js');\n * We need to export the globally defined symbols \"goog\" and \"COMPILED\".\n * Exporting \"goog\" breaks the compiler optimizations, so we required that\n * be defined externally.\n * NOTE: We don't use goog.exportSymbol here because we don't want to trigger\n * extern generation when that compiler option is enabled.\n */\nif (!COMPILED) {\n  goog.global['COMPILED'] = COMPILED;\n}\n\n\n//==============================================================================\n// goog.defineClass implementation\n//==============================================================================\n\n\n/**\n * Creates a restricted form of a Closure \"class\":\n *   - from the compiler's perspective, the instance returned from the\n *     constructor is sealed (no new properties may be added).  This enables\n *     better checks.\n *   - the compiler will rewrite this definition to a form that is optimal\n *     for type checking and optimization (initially this will be a more\n *     traditional form).\n *\n * @param {Function} superClass The superclass, Object or null.\n * @param {goog.defineClass.ClassDescriptor} def\n *     An object literal describing\n *     the class.  It may have the following properties:\n *     \"constructor\": the constructor function\n *     \"statics\": an object literal containing methods to add to the constructor\n *        as \"static\" methods or a function that will receive the constructor\n *        function as its only parameter to which static properties can\n *        be added.\n *     all other properties are added to the prototype.\n * @return {!Function} The class constructor.\n * @deprecated Use ES6 class syntax instead.\n */\ngoog.defineClass = function(superClass, def) {\n  // TODO(johnlenz): consider making the superClass an optional parameter.\n  var constructor = def.constructor;\n  var statics = def.statics;\n  // Wrap the constructor prior to setting up the prototype and static methods.\n  if (!constructor || constructor == Object.prototype.constructor) {\n    constructor = function() {\n      throw new Error(\n          'cannot instantiate an interface (no constructor defined).');\n    };\n  }\n\n  var cls = goog.defineClass.createSealingConstructor_(constructor, superClass);\n  if (superClass) {\n    goog.inherits(cls, superClass);\n  }\n\n  // Remove all the properties that should not be copied to the prototype.\n  delete def.constructor;\n  delete def.statics;\n\n  goog.defineClass.applyProperties_(cls.prototype, def);\n  if (statics != null) {\n    if (statics instanceof Function) {\n      statics(cls);\n    } else {\n      goog.defineClass.applyProperties_(cls, statics);\n    }\n  }\n\n  return cls;\n};\n\n\n/**\n * @typedef {{\n *   constructor: (!Function|undefined),\n *   statics: (Object|undefined|function(Function):void)\n * }}\n */\ngoog.defineClass.ClassDescriptor;\n\n\n/**\n * @define {boolean} Whether the instances returned by goog.defineClass should\n *     be sealed when possible.\n *\n * When sealing is disabled the constructor function will not be wrapped by\n * goog.defineClass, making it incompatible with ES6 class methods.\n */\ngoog.defineClass.SEAL_CLASS_INSTANCES =\n    goog.define('goog.defineClass.SEAL_CLASS_INSTANCES', goog.DEBUG);\n\n\n/**\n * If goog.defineClass.SEAL_CLASS_INSTANCES is enabled and Object.seal is\n * defined, this function will wrap the constructor in a function that seals the\n * results of the provided constructor function.\n *\n * @param {!Function} ctr The constructor whose results maybe be sealed.\n * @param {Function} superClass The superclass constructor.\n * @return {!Function} The replacement constructor.\n * @private\n */\ngoog.defineClass.createSealingConstructor_ = function(ctr, superClass) {\n  if (!goog.defineClass.SEAL_CLASS_INSTANCES) {\n    // Do now wrap the constructor when sealing is disabled. Angular code\n    // depends on this for injection to work properly.\n    return ctr;\n  }\n\n  // Compute whether the constructor is sealable at definition time, rather\n  // than when the instance is being constructed.\n  var superclassSealable = !goog.defineClass.isUnsealable_(superClass);\n\n  /**\n   * @this {Object}\n   * @return {?}\n   */\n  var wrappedCtr = function() {\n    // Don't seal an instance of a subclass when it calls the constructor of\n    // its super class as there is most likely still setup to do.\n    var instance = ctr.apply(this, arguments) || this;\n    instance[goog.UID_PROPERTY_] = instance[goog.UID_PROPERTY_];\n\n    if (this.constructor === wrappedCtr && superclassSealable &&\n        Object.seal instanceof Function) {\n      Object.seal(instance);\n    }\n    return instance;\n  };\n\n  return wrappedCtr;\n};\n\n\n/**\n * @param {Function} ctr The constructor to test.\n * @return {boolean} Whether the constructor has been tagged as unsealable\n *     using goog.tagUnsealableClass.\n * @private\n */\ngoog.defineClass.isUnsealable_ = function(ctr) {\n  return ctr && ctr.prototype &&\n      ctr.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_];\n};\n\n\n// TODO(johnlenz): share these values with the goog.object\n/**\n * The names of the fields that are defined on Object.prototype.\n * @type {!Array<string>}\n * @private\n * @const\n */\ngoog.defineClass.OBJECT_PROTOTYPE_FIELDS_ = [\n  'constructor', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable',\n  'toLocaleString', 'toString', 'valueOf'\n];\n\n\n// TODO(johnlenz): share this function with the goog.object\n/**\n * @param {!Object} target The object to add properties to.\n * @param {!Object} source The object to copy properties from.\n * @private\n */\ngoog.defineClass.applyProperties_ = function(target, source) {\n  // TODO(johnlenz): update this to support ES5 getters/setters\n\n  var key;\n  for (key in source) {\n    if (Object.prototype.hasOwnProperty.call(source, key)) {\n      target[key] = source[key];\n    }\n  }\n\n  // For IE the for-in-loop does not contain any properties that are not\n  // enumerable on the prototype object (for example isPrototypeOf from\n  // Object.prototype) and it will also not include 'replace' on objects that\n  // extend String and change 'replace' (not that it is common for anyone to\n  // extend anything except Object).\n  for (var i = 0; i < goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length; i++) {\n    key = goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[i];\n    if (Object.prototype.hasOwnProperty.call(source, key)) {\n      target[key] = source[key];\n    }\n  }\n};\n\n\n/**\n * Sealing classes breaks the older idiom of assigning properties on the\n * prototype rather than in the constructor. As such, goog.defineClass\n * must not seal subclasses of these old-style classes until they are fixed.\n * Until then, this marks a class as \"broken\", instructing defineClass\n * not to seal subclasses.\n * @param {!Function} ctr The legacy constructor to tag as unsealable.\n */\ngoog.tagUnsealableClass = function(ctr) {\n  if (!COMPILED && goog.defineClass.SEAL_CLASS_INSTANCES) {\n    ctr.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_] = true;\n  }\n};\n\n\n/**\n * Name for unsealable tag property.\n * @const @private {string}\n */\ngoog.UNSEALABLE_CONSTRUCTOR_PROPERTY_ = 'goog_defineClass_legacy_unsealable';\n\n\n// There's a bug in the compiler where without collapse properties the\n// Closure namespace defines do not guard code correctly. To help reduce code\n// size also check for !COMPILED even though it redundant until this is fixed.\nif (!COMPILED && goog.DEPENDENCIES_ENABLED) {\n\n  /**\n   * Tries to detect whether is in the context of an HTML document.\n   * @return {boolean} True if it looks like HTML document.\n   * @private\n   */\n  goog.inHtmlDocument_ = function() {\n    /** @type {!Document} */\n    var doc = goog.global.document;\n    return doc != null && 'write' in doc;  // XULDocument misses write.\n  };\n\n\n  /**\n   * We'd like to check for if the document readyState is 'loading'; however\n   * there are bugs on IE 10 and below where the readyState being anything other\n   * than 'complete' is not reliable.\n   * @return {boolean}\n   * @private\n   */\n  goog.isDocumentLoading_ = function() {\n    // attachEvent is available on IE 6 thru 10 only, and thus can be used to\n    // detect those browsers.\n    /** @type {!HTMLDocument} */\n    var doc = goog.global.document;\n    return doc.attachEvent ? doc.readyState != 'complete' :\n                             doc.readyState == 'loading';\n  };\n\n\n  /**\n   * Tries to detect the base path of base.js script that bootstraps Closure.\n   * @private\n   */\n  goog.findBasePath_ = function() {\n    if (goog.isDef(goog.global.CLOSURE_BASE_PATH) &&\n        // Anti DOM-clobbering runtime check (b/37736576).\n        goog.isString(goog.global.CLOSURE_BASE_PATH)) {\n      goog.basePath = goog.global.CLOSURE_BASE_PATH;\n      return;\n    } else if (!goog.inHtmlDocument_()) {\n      return;\n    }\n    /** @type {!Document} */\n    var doc = goog.global.document;\n    // If we have a currentScript available, use it exclusively.\n    var currentScript = doc.currentScript;\n    if (currentScript) {\n      var scripts = [currentScript];\n    } else {\n      var scripts = doc.getElementsByTagName('SCRIPT');\n    }\n    // Search backwards since the current script is in almost all cases the one\n    // that has base.js.\n    for (var i = scripts.length - 1; i >= 0; --i) {\n      var script = /** @type {!HTMLScriptElement} */ (scripts[i]);\n      var src = script.src;\n      var qmark = src.lastIndexOf('?');\n      var l = qmark == -1 ? src.length : qmark;\n      if (src.substr(l - 7, 7) == 'base.js') {\n        goog.basePath = src.substr(0, l - 7);\n        return;\n      }\n    }\n  };\n\n  goog.findBasePath_();\n\n  /** @struct @constructor @final */\n  goog.Transpiler = function() {\n    /** @private {?Object<string, boolean>} */\n    this.requiresTranspilation_ = null;\n    /** @private {string} */\n    this.transpilationTarget_ = goog.TRANSPILE_TO_LANGUAGE;\n  };\n\n\n  /**\n   * Returns a newly created map from language mode string to a boolean\n   * indicating whether transpilation should be done for that mode as well as\n   * the highest level language that this environment supports.\n   *\n   * Guaranteed invariant:\n   * For any two modes, l1 and l2 where l2 is a newer mode than l1,\n   * `map[l1] == true` implies that `map[l2] == true`.\n   *\n   * Note this method is extracted and used elsewhere, so it cannot rely on\n   * anything external (it should easily be able to be transformed into a\n   * standalone, top level function).\n   *\n   * @private\n   * @return {{\n   *   target: string,\n   *   map: !Object<string, boolean>\n   * }}\n   */\n  goog.Transpiler.prototype.createRequiresTranspilation_ = function() {\n    var transpilationTarget = 'es3';\n    var /** !Object<string, boolean> */ requiresTranspilation = {'es3': false};\n    var transpilationRequiredForAllLaterModes = false;\n\n    /**\n     * Adds an entry to requiresTranspliation for the given language mode.\n     *\n     * IMPORTANT: Calls must be made in order from oldest to newest language\n     * mode.\n     * @param {string} modeName\n     * @param {function(): boolean} isSupported Returns true if the JS engine\n     *     supports the given mode.\n     */\n    function addNewerLanguageTranspilationCheck(modeName, isSupported) {\n      if (transpilationRequiredForAllLaterModes) {\n        requiresTranspilation[modeName] = true;\n      } else if (isSupported()) {\n        transpilationTarget = modeName;\n        requiresTranspilation[modeName] = false;\n      } else {\n        requiresTranspilation[modeName] = true;\n        transpilationRequiredForAllLaterModes = true;\n      }\n    }\n\n    /**\n     * Does the given code evaluate without syntax errors and return a truthy\n     * result?\n     */\n    function /** boolean */ evalCheck(/** string */ code) {\n      try {\n        return !!eval(code);\n      } catch (ignored) {\n        return false;\n      }\n    }\n\n    var userAgent = goog.global.navigator && goog.global.navigator.userAgent ?\n        goog.global.navigator.userAgent :\n        '';\n\n    // Identify ES3-only browsers by their incorrect treatment of commas.\n    addNewerLanguageTranspilationCheck('es5', function() {\n      return evalCheck('[1,].length==1');\n    });\n    addNewerLanguageTranspilationCheck('es6', function() {\n      // Edge has a non-deterministic (i.e., not reproducible) bug with ES6:\n      // https://github.com/Microsoft/ChakraCore/issues/1496.\n      var re = /Edge\\/(\\d+)(\\.\\d)*/i;\n      var edgeUserAgent = userAgent.match(re);\n      if (edgeUserAgent) {\n        // The Reflect.construct test below is flaky on Edge. It can sometimes\n        // pass or fail on 40 15.15063, so just exit early for Edge and treat\n        // it as ES5. Until we're on a more up to date version just always use\n        // ES5. See https://github.com/Microsoft/ChakraCore/issues/3217.\n        return false;\n      }\n      // Test es6: [FF50 (?), Edge 14 (?), Chrome 50]\n      //   (a) default params (specifically shadowing locals),\n      //   (b) destructuring, (c) block-scoped functions,\n      //   (d) for-of (const), (e) new.target/Reflect.construct\n      var es6fullTest =\n          'class X{constructor(){if(new.target!=String)throw 1;this.x=42}}' +\n          'let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof ' +\n          'String))throw 1;for(const a of[2,3]){if(a==2)continue;function ' +\n          'f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()' +\n          '==3}';\n\n      return evalCheck('(()=>{\"use strict\";' + es6fullTest + '})()');\n    });\n    // ** and **= are the only new features in 'es7'\n    addNewerLanguageTranspilationCheck('es7', function() {\n      return evalCheck('2 ** 2 == 4');\n    });\n    // async functions are the only new features in 'es8'\n    addNewerLanguageTranspilationCheck('es8', function() {\n      return evalCheck('async () => 1, true');\n    });\n    addNewerLanguageTranspilationCheck('es9', function() {\n      return evalCheck('({...rest} = {}), true');\n    });\n    addNewerLanguageTranspilationCheck('es_next', function() {\n      return false;  // assume it always need to transpile\n    });\n    return {target: transpilationTarget, map: requiresTranspilation};\n  };\n\n\n  /**\n   * Determines whether the given language needs to be transpiled.\n   * @param {string} lang\n   * @param {string|undefined} module\n   * @return {boolean}\n   */\n  goog.Transpiler.prototype.needsTranspile = function(lang, module) {\n    if (goog.TRANSPILE == 'always') {\n      return true;\n    } else if (goog.TRANSPILE == 'never') {\n      return false;\n    } else if (!this.requiresTranspilation_) {\n      var obj = this.createRequiresTranspilation_();\n      this.requiresTranspilation_ = obj.map;\n      this.transpilationTarget_ = this.transpilationTarget_ || obj.target;\n    }\n    if (lang in this.requiresTranspilation_) {\n      if (this.requiresTranspilation_[lang]) {\n        return true;\n      } else if (\n          goog.inHtmlDocument_() && module == 'es6' &&\n          !('noModule' in goog.global.document.createElement('script'))) {\n        return true;\n      } else {\n        return false;\n      }\n    } else {\n      throw new Error('Unknown language mode: ' + lang);\n    }\n  };\n\n\n  /**\n   * Lazily retrieves the transpiler and applies it to the source.\n   * @param {string} code JS code.\n   * @param {string} path Path to the code.\n   * @return {string} The transpiled code.\n   */\n  goog.Transpiler.prototype.transpile = function(code, path) {\n    // TODO(johnplaisted): We should delete goog.transpile_ and just have this\n    // function. But there's some compile error atm where goog.global is being\n    // stripped incorrectly without this.\n    return goog.transpile_(code, path, this.transpilationTarget_);\n  };\n\n\n  /** @private @final {!goog.Transpiler} */\n  goog.transpiler_ = new goog.Transpiler();\n\n  /**\n   * Rewrites closing script tags in input to avoid ending an enclosing script\n   * tag.\n   *\n   * @param {string} str\n   * @return {string}\n   * @private\n   */\n  goog.protectScriptTag_ = function(str) {\n    return str.replace(/<\\/(SCRIPT)/ig, '\\\\x3c/$1');\n  };\n\n\n  /**\n   * A debug loader is responsible for downloading and executing javascript\n   * files in an unbundled, uncompiled environment.\n   *\n   * This can be custimized via the setDependencyFactory method, or by\n   * CLOSURE_IMPORT_SCRIPT/CLOSURE_LOAD_FILE_SYNC.\n   *\n   * @struct @constructor @final @private\n   */\n  goog.DebugLoader_ = function() {\n    /** @private @const {!Object<string, !goog.Dependency>} */\n    this.dependencies_ = {};\n    /** @private @const {!Object<string, string>} */\n    this.idToPath_ = {};\n    /** @private @const {!Object<string, boolean>} */\n    this.written_ = {};\n    /** @private @const {!Array<!goog.Dependency>} */\n    this.loadingDeps_ = [];\n    /** @private {!Array<!goog.Dependency>} */\n    this.depsToLoad_ = [];\n    /** @private {boolean} */\n    this.paused_ = false;\n    /** @private {!goog.DependencyFactory} */\n    this.factory_ = new goog.DependencyFactory(goog.transpiler_);\n    /** @private @const {!Object<string, !Function>} */\n    this.deferredCallbacks_ = {};\n    /** @private @const {!Array<string>} */\n    this.deferredQueue_ = [];\n  };\n\n  /**\n   * @param {!Array<string>} namespaces\n   * @param {function(): undefined} callback Function to call once all the\n   *     namespaces have loaded.\n   */\n  goog.DebugLoader_.prototype.bootstrap = function(namespaces, callback) {\n    var cb = callback;\n    function resolve() {\n      if (cb) {\n        goog.global.setTimeout(cb, 0);\n        cb = null;\n      }\n    }\n\n    if (!namespaces.length) {\n      resolve();\n      return;\n    }\n\n    var deps = [];\n    for (var i = 0; i < namespaces.length; i++) {\n      var path = this.getPathFromDeps_(namespaces[i]);\n      if (!path) {\n        throw new Error('Unregonized namespace: ' + namespaces[i]);\n      }\n      deps.push(this.dependencies_[path]);\n    }\n\n    var require = goog.require;\n    var loaded = 0;\n    for (var i = 0; i < namespaces.length; i++) {\n      require(namespaces[i]);\n      deps[i].onLoad(function() {\n        if (++loaded == namespaces.length) {\n          resolve();\n        }\n      });\n    }\n  };\n\n\n  /**\n   * Loads the Closure Dependency file.\n   *\n   * Exposed a public function so CLOSURE_NO_DEPS can be set to false, base\n   * loaded, setDependencyFactory called, and then this called. i.e. allows\n   * custom loading of the deps file.\n   */\n  goog.DebugLoader_.prototype.loadClosureDeps = function() {\n    // Circumvent addDependency, which would try to transpile deps.js if\n    // transpile is set to always.\n    var relPath = 'deps.js';\n    this.depsToLoad_.push(this.factory_.createDependency(\n        goog.normalizePath_(goog.basePath + relPath), relPath, [], [], {},\n        false));\n    this.loadDeps_();\n  };\n\n\n  /**\n   * Notifies the debug loader when a dependency has been requested.\n   *\n   * @param {string} absPathOrId Path of the dependency or goog id.\n   * @param {boolean=} opt_force\n   */\n  goog.DebugLoader_.prototype.requested = function(absPathOrId, opt_force) {\n    var path = this.getPathFromDeps_(absPathOrId);\n    if (path &&\n        (opt_force || this.areDepsLoaded_(this.dependencies_[path].requires))) {\n      var callback = this.deferredCallbacks_[path];\n      if (callback) {\n        delete this.deferredCallbacks_[path];\n        callback();\n      }\n    }\n  };\n\n\n  /**\n   * Sets the dependency factory, which can be used to create custom\n   * goog.Dependency implementations to control how dependencies are loaded.\n   *\n   * @param {!goog.DependencyFactory} factory\n   */\n  goog.DebugLoader_.prototype.setDependencyFactory = function(factory) {\n    this.factory_ = factory;\n  };\n\n\n  /**\n   * Travserses the dependency graph and queues the given dependency, and all of\n   * its transitive dependencies, for loading and then starts loading if not\n   * paused.\n   *\n   * @param {string} namespace\n   * @private\n   */\n  goog.DebugLoader_.prototype.load_ = function(namespace) {\n    if (!this.getPathFromDeps_(namespace)) {\n      var errorMessage = 'goog.require could not find: ' + namespace;\n\n      goog.logToConsole_(errorMessage);\n      throw Error(errorMessage);\n    } else {\n      var loader = this;\n\n      var deps = [];\n\n      /** @param {string} namespace */\n      var visit = function(namespace) {\n        var path = loader.getPathFromDeps_(namespace);\n\n        if (!path) {\n          throw new Error('Bad dependency path or symbol: ' + namespace);\n        }\n\n        if (loader.written_[path]) {\n          return;\n        }\n\n        loader.written_[path] = true;\n\n        var dep = loader.dependencies_[path];\n        for (var i = 0; i < dep.requires.length; i++) {\n          if (!goog.isProvided_(dep.requires[i])) {\n            visit(dep.requires[i]);\n          }\n        }\n\n        deps.push(dep);\n      };\n\n      visit(namespace);\n\n      var wasLoading = !!this.depsToLoad_.length;\n      this.depsToLoad_ = this.depsToLoad_.concat(deps);\n\n      if (!this.paused_ && !wasLoading) {\n        this.loadDeps_();\n      }\n    }\n  };\n\n\n  /**\n   * Loads any queued dependencies until they are all loaded or paused.\n   *\n   * @private\n   */\n  goog.DebugLoader_.prototype.loadDeps_ = function() {\n    var loader = this;\n    var paused = this.paused_;\n\n    while (this.depsToLoad_.length && !paused) {\n      (function() {\n        var loadCallDone = false;\n        var dep = loader.depsToLoad_.shift();\n\n        var loaded = false;\n        loader.loading_(dep);\n\n        var controller = {\n          pause: function() {\n            if (loadCallDone) {\n              throw new Error('Cannot call pause after the call to load.');\n            } else {\n              paused = true;\n            }\n          },\n          resume: function() {\n            if (loadCallDone) {\n              loader.resume_();\n            } else {\n              // Some dep called pause and then resume in the same load call.\n              // Just keep running this same loop.\n              paused = false;\n            }\n          },\n          loaded: function() {\n            if (loaded) {\n              throw new Error('Double call to loaded.');\n            }\n\n            loaded = true;\n            loader.loaded_(dep);\n          },\n          pending: function() {\n            // Defensive copy.\n            var pending = [];\n            for (var i = 0; i < loader.loadingDeps_.length; i++) {\n              pending.push(loader.loadingDeps_[i]);\n            }\n            return pending;\n          },\n          /**\n           * @param {goog.ModuleType} type\n           */\n          setModuleState: function(type) {\n            goog.moduleLoaderState_ = {\n              type: type,\n              moduleName: '',\n              declareLegacyNamespace: false\n            };\n          },\n          /** @type {function(string, string, string=)} */\n          registerEs6ModuleExports: function(\n              path, exports, opt_closureNamespace) {\n            if (opt_closureNamespace) {\n              goog.loadedModules_[opt_closureNamespace] = {\n                exports: exports,\n                type: goog.ModuleType.ES6,\n                moduleId: opt_closureNamespace || ''\n              };\n            }\n          },\n          /** @type {function(string, ?)} */\n          registerGoogModuleExports: function(moduleId, exports) {\n            goog.loadedModules_[moduleId] = {\n              exports: exports,\n              type: goog.ModuleType.GOOG,\n              moduleId: moduleId\n            };\n          },\n          clearModuleState: function() {\n            goog.moduleLoaderState_ = null;\n          },\n          defer: function(callback) {\n            if (loadCallDone) {\n              throw new Error(\n                  'Cannot register with defer after the call to load.');\n            }\n            loader.defer_(dep, callback);\n          },\n          areDepsLoaded: function() {\n            return loader.areDepsLoaded_(dep.requires);\n          }\n        };\n\n        try {\n          dep.load(controller);\n        } finally {\n          loadCallDone = true;\n        }\n      })();\n    }\n\n    if (paused) {\n      this.pause_();\n    }\n  };\n\n\n  /** @private */\n  goog.DebugLoader_.prototype.pause_ = function() {\n    this.paused_ = true;\n  };\n\n\n  /** @private */\n  goog.DebugLoader_.prototype.resume_ = function() {\n    if (this.paused_) {\n      this.paused_ = false;\n      this.loadDeps_();\n    }\n  };\n\n\n  /**\n   * Marks the given dependency as loading (load has been called but it has not\n   * yet marked itself as finished). Useful for dependencies that want to know\n   * what else is loading. Example: goog.modules cannot eval if there are\n   * loading dependencies.\n   *\n   * @param {!goog.Dependency} dep\n   * @private\n   */\n  goog.DebugLoader_.prototype.loading_ = function(dep) {\n    this.loadingDeps_.push(dep);\n  };\n\n\n  /**\n   * Marks the given dependency as having finished loading and being available\n   * for require.\n   *\n   * @param {!goog.Dependency} dep\n   * @private\n   */\n  goog.DebugLoader_.prototype.loaded_ = function(dep) {\n    for (var i = 0; i < this.loadingDeps_.length; i++) {\n      if (this.loadingDeps_[i] == dep) {\n        this.loadingDeps_.splice(i, 1);\n        break;\n      }\n    }\n\n    for (var i = 0; i < this.deferredQueue_.length; i++) {\n      if (this.deferredQueue_[i] == dep.path) {\n        this.deferredQueue_.splice(i, 1);\n        break;\n      }\n    }\n\n    if (this.loadingDeps_.length == this.deferredQueue_.length &&\n        !this.depsToLoad_.length) {\n      // Something has asked to load these, but they may not be directly\n      // required again later, so load them now that we know we're done loading\n      // everything else. e.g. a goog module entry point.\n      while (this.deferredQueue_.length) {\n        this.requested(this.deferredQueue_.shift(), true);\n      }\n    }\n\n    dep.loaded();\n  };\n\n\n  /**\n   * @param {!Array<string>} pathsOrIds\n   * @return {boolean}\n   * @private\n   */\n  goog.DebugLoader_.prototype.areDepsLoaded_ = function(pathsOrIds) {\n    for (var i = 0; i < pathsOrIds.length; i++) {\n      var path = this.getPathFromDeps_(pathsOrIds[i]);\n      if (!path ||\n          (!(path in this.deferredCallbacks_) &&\n           !goog.isProvided_(pathsOrIds[i]))) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n\n  /**\n   * @param {string} absPathOrId\n   * @return {?string}\n   * @private\n   */\n  goog.DebugLoader_.prototype.getPathFromDeps_ = function(absPathOrId) {\n    if (absPathOrId in this.idToPath_) {\n      return this.idToPath_[absPathOrId];\n    } else if (absPathOrId in this.dependencies_) {\n      return absPathOrId;\n    } else {\n      return null;\n    }\n  };\n\n\n  /**\n   * @param {!goog.Dependency} dependency\n   * @param {!Function} callback\n   * @private\n   */\n  goog.DebugLoader_.prototype.defer_ = function(dependency, callback) {\n    this.deferredCallbacks_[dependency.path] = callback;\n    this.deferredQueue_.push(dependency.path);\n  };\n\n\n  /**\n   * Interface for goog.Dependency implementations to have some control over\n   * loading of dependencies.\n   *\n   * @record\n   */\n  goog.LoadController = function() {};\n\n\n  /**\n   * Tells the controller to halt loading of more dependencies.\n   */\n  goog.LoadController.prototype.pause = function() {};\n\n\n  /**\n   * Tells the controller to resume loading of more dependencies if paused.\n   */\n  goog.LoadController.prototype.resume = function() {};\n\n\n  /**\n   * Tells the controller that this dependency has finished loading.\n   *\n   * This causes this to be removed from pending() and any load callbacks to\n   * fire.\n   */\n  goog.LoadController.prototype.loaded = function() {};\n\n\n  /**\n   * List of dependencies on which load has been called but which have not\n   * called loaded on their controller. This includes the current dependency.\n   *\n   * @return {!Array<!goog.Dependency>}\n   */\n  goog.LoadController.prototype.pending = function() {};\n\n\n  /**\n   * Registers an object as an ES6 module's exports so that goog.modules may\n   * require it by path.\n   *\n   * @param {string} path Full path of the module.\n   * @param {?} exports\n   * @param {string=} opt_closureNamespace Closure namespace to associate with\n   *     this module.\n   */\n  goog.LoadController.prototype.registerEs6ModuleExports = function(\n      path, exports, opt_closureNamespace) {};\n\n\n  /**\n   * Sets the current module state.\n   *\n   * @param {goog.ModuleType} type Type of module.\n   */\n  goog.LoadController.prototype.setModuleState = function(type) {};\n\n\n  /**\n   * Clears the current module state.\n   */\n  goog.LoadController.prototype.clearModuleState = function() {};\n\n\n  /**\n   * Registers a callback to call once the dependency is actually requested\n   * via goog.require + all of the immediate dependencies have been loaded or\n   * all other files have been loaded. Allows for lazy loading until\n   * require'd without pausing dependency loading, which is needed on old IE.\n   *\n   * @param {!Function} callback\n   */\n  goog.LoadController.prototype.defer = function(callback) {};\n\n\n  /**\n   * @return {boolean}\n   */\n  goog.LoadController.prototype.areDepsLoaded = function() {};\n\n\n  /**\n   * Basic super class for all dependencies Closure Library can load.\n   *\n   * This default implementation is designed to load untranspiled, non-module\n   * scripts in a web broswer.\n   *\n   * For transpiled non-goog.module files {@see goog.TranspiledDependency}.\n   * For goog.modules see {@see goog.GoogModuleDependency}.\n   * For untranspiled ES6 modules {@see goog.Es6ModuleDependency}.\n   *\n   * @param {string} path Absolute path of this script.\n   * @param {string} relativePath Path of this script relative to goog.basePath.\n   * @param {!Array<string>} provides goog.provided or goog.module symbols\n   *     in this file.\n   * @param {!Array<string>} requires goog symbols or relative paths to Closure\n   *     this depends on.\n   * @param {!Object<string, string>} loadFlags\n   * @struct @constructor\n   */\n  goog.Dependency = function(\n      path, relativePath, provides, requires, loadFlags) {\n    /** @const */\n    this.path = path;\n    /** @const */\n    this.relativePath = relativePath;\n    /** @const */\n    this.provides = provides;\n    /** @const */\n    this.requires = requires;\n    /** @const */\n    this.loadFlags = loadFlags;\n    /** @private {boolean} */\n    this.loaded_ = false;\n    /** @private {!Array<function()>} */\n    this.loadCallbacks_ = [];\n  };\n\n\n  /**\n   * @return {string} The pathname part of this dependency's path if it is a\n   *     URI.\n   */\n  goog.Dependency.prototype.getPathName = function() {\n    var pathName = this.path;\n    var protocolIndex = pathName.indexOf('://');\n    if (protocolIndex >= 0) {\n      pathName = pathName.substring(protocolIndex + 3);\n      var slashIndex = pathName.indexOf('/');\n      if (slashIndex >= 0) {\n        pathName = pathName.substring(slashIndex + 1);\n      }\n    }\n    return pathName;\n  };\n\n\n  /**\n   * @param {function()} callback Callback to fire as soon as this has loaded.\n   * @final\n   */\n  goog.Dependency.prototype.onLoad = function(callback) {\n    if (this.loaded_) {\n      callback();\n    } else {\n      this.loadCallbacks_.push(callback);\n    }\n  };\n\n\n  /**\n   * Marks this dependency as loaded and fires any callbacks registered with\n   * onLoad.\n   * @final\n   */\n  goog.Dependency.prototype.loaded = function() {\n    this.loaded_ = true;\n    var callbacks = this.loadCallbacks_;\n    this.loadCallbacks_ = [];\n    for (var i = 0; i < callbacks.length; i++) {\n      callbacks[i]();\n    }\n  };\n\n\n  /**\n   * Whether or not document.written / appended script tags should be deferred.\n   *\n   * @private {boolean}\n   */\n  goog.Dependency.defer_ = false;\n\n\n  /**\n   * Map of script ready / state change callbacks. Old IE cannot handle putting\n   * these properties on goog.global.\n   *\n   * @private @const {!Object<string, function(?):undefined>}\n   */\n  goog.Dependency.callbackMap_ = {};\n\n\n  /**\n   * @param {function(...?):?} callback\n   * @return {string}\n   * @private\n   */\n  goog.Dependency.registerCallback_ = function(callback) {\n    var key = Math.random().toString(32);\n    goog.Dependency.callbackMap_[key] = callback;\n    return key;\n  };\n\n\n  /**\n   * @param {string} key\n   * @private\n   */\n  goog.Dependency.unregisterCallback_ = function(key) {\n    delete goog.Dependency.callbackMap_[key];\n  };\n\n\n  /**\n   * @param {string} key\n   * @param {...?} var_args\n   * @private\n   * @suppress {unusedPrivateMembers}\n   */\n  goog.Dependency.callback_ = function(key, var_args) {\n    if (key in goog.Dependency.callbackMap_) {\n      var callback = goog.Dependency.callbackMap_[key];\n      var args = [];\n      for (var i = 1; i < arguments.length; i++) {\n        args.push(arguments[i]);\n      }\n      callback.apply(undefined, args);\n    } else {\n      var errorMessage = 'Callback key ' + key +\n          ' does not exist (was base.js loaded more than once?).';\n      throw Error(errorMessage);\n    }\n  };\n\n\n  /**\n   * Starts loading this dependency. This dependency can pause loading if it\n   * needs to and resume it later via the controller interface.\n   *\n   * When this is loaded it should call controller.loaded(). Note that this will\n   * end up calling the loaded method of this dependency; there is no need to\n   * call it explicitly.\n   *\n   * @param {!goog.LoadController} controller\n   */\n  goog.Dependency.prototype.load = function(controller) {\n    if (goog.global.CLOSURE_IMPORT_SCRIPT) {\n      if (goog.global.CLOSURE_IMPORT_SCRIPT(this.path)) {\n        controller.loaded();\n      } else {\n        controller.pause();\n      }\n      return;\n    }\n\n    if (!goog.inHtmlDocument_()) {\n      goog.logToConsole_(\n          'Cannot use default debug loader outside of HTML documents.');\n      if (this.relativePath == 'deps.js') {\n        // Some old code is relying on base.js auto loading deps.js failing with\n        // no error before later setting CLOSURE_IMPORT_SCRIPT.\n        // CLOSURE_IMPORT_SCRIPT should be set *before* base.js is loaded, or\n        // CLOSURE_NO_DEPS set to true.\n        goog.logToConsole_(\n            'Consider setting CLOSURE_IMPORT_SCRIPT before loading base.js, ' +\n            'or setting CLOSURE_NO_DEPS to true.');\n        controller.loaded();\n      } else {\n        controller.pause();\n      }\n      return;\n    }\n\n    /** @type {!HTMLDocument} */\n    var doc = goog.global.document;\n\n    // If the user tries to require a new symbol after document load,\n    // something has gone terribly wrong. Doing a document.write would\n    // wipe out the page. This does not apply to the CSP-compliant method\n    // of writing script tags.\n    if (doc.readyState == 'complete' &&\n        !goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING) {\n      // Certain test frameworks load base.js multiple times, which tries\n      // to write deps.js each time. If that happens, just fail silently.\n      // These frameworks wipe the page between each load of base.js, so this\n      // is OK.\n      var isDeps = /\\bdeps.js$/.test(this.path);\n      if (isDeps) {\n        controller.loaded();\n        return;\n      } else {\n        throw Error('Cannot write \"' + this.path + '\" after document load');\n      }\n    }\n\n    if (!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING &&\n        goog.isDocumentLoading_()) {\n      var key = goog.Dependency.registerCallback_(function(script) {\n        if (!goog.DebugLoader_.IS_OLD_IE_ || script.readyState == 'complete') {\n          goog.Dependency.unregisterCallback_(key);\n          controller.loaded();\n        }\n      });\n      var nonceAttr = !goog.DebugLoader_.IS_OLD_IE_ && goog.getScriptNonce() ?\n          ' nonce=\"' + goog.getScriptNonce() + '\"' :\n          '';\n      var event =\n          goog.DebugLoader_.IS_OLD_IE_ ? 'onreadystatechange' : 'onload';\n      var defer = goog.Dependency.defer_ ? 'defer' : '';\n      var script = '<script src=\"' + this.path + '\" ' + event +\n          '=\"goog.Dependency.callback_(\\'' + key +\n          '\\', this)\" type=\"text/javascript\" ' + defer + nonceAttr + '><' +\n          '/script>';\n      doc.write(\n          goog.TRUSTED_TYPES_POLICY_ ?\n              goog.TRUSTED_TYPES_POLICY_.createHTML(script) :\n              script);\n    } else {\n      var scriptEl =\n          /** @type {!HTMLScriptElement} */ (doc.createElement('script'));\n      scriptEl.defer = goog.Dependency.defer_;\n      scriptEl.async = false;\n      scriptEl.type = 'text/javascript';\n\n      // If CSP nonces are used, propagate them to dynamically created scripts.\n      // This is necessary to allow nonce-based CSPs without 'strict-dynamic'.\n      var nonce = goog.getScriptNonce();\n      if (nonce) {\n        scriptEl.setAttribute('nonce', nonce);\n      }\n\n      if (goog.DebugLoader_.IS_OLD_IE_) {\n        // Execution order is not guaranteed on old IE, halt loading and write\n        // these scripts one at a time, after each loads.\n        controller.pause();\n        scriptEl.onreadystatechange = function() {\n          if (scriptEl.readyState == 'loaded' ||\n              scriptEl.readyState == 'complete') {\n            controller.loaded();\n            controller.resume();\n          }\n        };\n      } else {\n        scriptEl.onload = function() {\n          scriptEl.onload = null;\n          controller.loaded();\n        };\n      }\n\n      scriptEl.src = goog.TRUSTED_TYPES_POLICY_ ?\n          goog.TRUSTED_TYPES_POLICY_.createScriptURL(this.path) :\n          this.path;\n      doc.head.appendChild(scriptEl);\n    }\n  };\n\n\n  /**\n   * @param {string} path Absolute path of this script.\n   * @param {string} relativePath Path of this script relative to goog.basePath.\n   * @param {!Array<string>} provides Should be an empty array.\n   *     TODO(johnplaisted) add support for adding closure namespaces to ES6\n   *     modules for interop purposes.\n   * @param {!Array<string>} requires goog symbols or relative paths to Closure\n   *     this depends on.\n   * @param {!Object<string, string>} loadFlags\n   * @struct @constructor\n   * @extends {goog.Dependency}\n   */\n  goog.Es6ModuleDependency = function(\n      path, relativePath, provides, requires, loadFlags) {\n    goog.Es6ModuleDependency.base(\n        this, 'constructor', path, relativePath, provides, requires, loadFlags);\n  };\n  goog.inherits(goog.Es6ModuleDependency, goog.Dependency);\n\n\n  /** @override */\n  goog.Es6ModuleDependency.prototype.load = function(controller) {\n    if (goog.global.CLOSURE_IMPORT_SCRIPT) {\n      if (goog.global.CLOSURE_IMPORT_SCRIPT(this.path)) {\n        controller.loaded();\n      } else {\n        controller.pause();\n      }\n      return;\n    }\n\n    if (!goog.inHtmlDocument_()) {\n      goog.logToConsole_(\n          'Cannot use default debug loader outside of HTML documents.');\n      controller.pause();\n      return;\n    }\n\n    /** @type {!HTMLDocument} */\n    var doc = goog.global.document;\n\n    var dep = this;\n\n    // TODO(johnplaisted): Does document.writing really speed up anything? Any\n    // difference between this and just waiting for interactive mode and then\n    // appending?\n    function write(src, contents) {\n      if (contents) {\n        var script = '<script type=\"module\" crossorigin>' + contents + '</' +\n            'script>';\n        doc.write(\n            goog.TRUSTED_TYPES_POLICY_ ?\n                goog.TRUSTED_TYPES_POLICY_.createHTML(script) :\n                script);\n      } else {\n        var script = '<script type=\"module\" crossorigin src=\"' + src + '\"></' +\n            'script>';\n        doc.write(\n            goog.TRUSTED_TYPES_POLICY_ ?\n                goog.TRUSTED_TYPES_POLICY_.createHTML(script) :\n                script);\n      }\n    }\n\n    function append(src, contents) {\n      var scriptEl =\n          /** @type {!HTMLScriptElement} */ (doc.createElement('script'));\n      scriptEl.defer = true;\n      scriptEl.async = false;\n      scriptEl.type = 'module';\n      scriptEl.setAttribute('crossorigin', true);\n\n      // If CSP nonces are used, propagate them to dynamically created scripts.\n      // This is necessary to allow nonce-based CSPs without 'strict-dynamic'.\n      var nonce = goog.getScriptNonce();\n      if (nonce) {\n        scriptEl.setAttribute('nonce', nonce);\n      }\n\n      if (contents) {\n        scriptEl.textContent = goog.TRUSTED_TYPES_POLICY_ ?\n            goog.TRUSTED_TYPES_POLICY_.createScript(contents) :\n            contents;\n      } else {\n        scriptEl.src = goog.TRUSTED_TYPES_POLICY_ ?\n            goog.TRUSTED_TYPES_POLICY_.createScriptURL(src) :\n            src;\n      }\n\n      doc.head.appendChild(scriptEl);\n    }\n\n    var create;\n\n    if (goog.isDocumentLoading_()) {\n      create = write;\n      // We can ONLY call document.write if we are guaranteed that any\n      // non-module script tags document.written after this are deferred.\n      // Small optimization, in theory document.writing is faster.\n      goog.Dependency.defer_ = true;\n    } else {\n      create = append;\n    }\n\n    // Write 4 separate tags here:\n    // 1) Sets the module state at the correct time (just before execution).\n    // 2) A src node for this, which just hopefully lets the browser load it a\n    //    little early (no need to parse #3).\n    // 3) Import the module and register it.\n    // 4) Clear the module state at the correct time. Guaranteed to run even\n    //    if there is an error in the module (#3 will not run if there is an\n    //    error in the module).\n    var beforeKey = goog.Dependency.registerCallback_(function() {\n      goog.Dependency.unregisterCallback_(beforeKey);\n      controller.setModuleState(goog.ModuleType.ES6);\n    });\n    create(undefined, 'goog.Dependency.callback_(\"' + beforeKey + '\")');\n\n    // TODO(johnplaisted): Does this really speed up anything?\n    create(this.path, undefined);\n\n    var registerKey = goog.Dependency.registerCallback_(function(exports) {\n      goog.Dependency.unregisterCallback_(registerKey);\n      controller.registerEs6ModuleExports(\n          dep.path, exports, goog.moduleLoaderState_.moduleName);\n    });\n    create(\n        undefined,\n        'import * as m from \"' + this.path + '\"; goog.Dependency.callback_(\"' +\n            registerKey + '\", m)');\n\n    var afterKey = goog.Dependency.registerCallback_(function() {\n      goog.Dependency.unregisterCallback_(afterKey);\n      controller.clearModuleState();\n      controller.loaded();\n    });\n    create(undefined, 'goog.Dependency.callback_(\"' + afterKey + '\")');\n  };\n\n\n  /**\n   * Superclass of any dependency that needs to be loaded into memory,\n   * transformed, and then eval'd (goog.modules and transpiled files).\n   *\n   * @param {string} path Absolute path of this script.\n   * @param {string} relativePath Path of this script relative to goog.basePath.\n   * @param {!Array<string>} provides goog.provided or goog.module symbols\n   *     in this file.\n   * @param {!Array<string>} requires goog symbols or relative paths to Closure\n   *     this depends on.\n   * @param {!Object<string, string>} loadFlags\n   * @struct @constructor @abstract\n   * @extends {goog.Dependency}\n   */\n  goog.TransformedDependency = function(\n      path, relativePath, provides, requires, loadFlags) {\n    goog.TransformedDependency.base(\n        this, 'constructor', path, relativePath, provides, requires, loadFlags);\n    /** @private {?string} */\n    this.contents_ = null;\n\n    /**\n     * Whether to lazily make the synchronous XHR (when goog.require'd) or make\n     * the synchronous XHR when initially loading. On FireFox 61 there is a bug\n     * where an ES6 module cannot make a synchronous XHR (rather, it can, but if\n     * it does then no other ES6 modules will load after).\n     *\n     * tl;dr we lazy load due to bugs on older browsers and eager load due to\n     * bugs on newer ones.\n     *\n     * https://bugzilla.mozilla.org/show_bug.cgi?id=1477090\n     *\n     * @private @const {boolean}\n     */\n    this.lazyFetch_ = !goog.inHtmlDocument_() ||\n        !('noModule' in goog.global.document.createElement('script'));\n  };\n  goog.inherits(goog.TransformedDependency, goog.Dependency);\n\n\n  /** @override */\n  goog.TransformedDependency.prototype.load = function(controller) {\n    var dep = this;\n\n    function fetch() {\n      dep.contents_ = goog.loadFileSync_(dep.path);\n\n      if (dep.contents_) {\n        dep.contents_ = dep.transform(dep.contents_);\n        if (dep.contents_) {\n          dep.contents_ += '\\n//# sourceURL=' + dep.path;\n        }\n      }\n    }\n\n    if (goog.global.CLOSURE_IMPORT_SCRIPT) {\n      fetch();\n      if (this.contents_ &&\n          goog.global.CLOSURE_IMPORT_SCRIPT('', this.contents_)) {\n        this.contents_ = null;\n        controller.loaded();\n      } else {\n        controller.pause();\n      }\n      return;\n    }\n\n\n    var isEs6 = this.loadFlags['module'] == goog.ModuleType.ES6;\n\n    if (!this.lazyFetch_) {\n      fetch();\n    }\n\n    function load() {\n      if (dep.lazyFetch_) {\n        fetch();\n      }\n\n      if (!dep.contents_) {\n        // loadFileSync_ or transform are responsible. Assume they logged an\n        // error.\n        return;\n      }\n\n      if (isEs6) {\n        controller.setModuleState(goog.ModuleType.ES6);\n      }\n\n      var namespace;\n\n      try {\n        var contents = dep.contents_;\n        dep.contents_ = null;\n        goog.globalEval(contents);\n        if (isEs6) {\n          namespace = goog.moduleLoaderState_.moduleName;\n        }\n      } finally {\n        if (isEs6) {\n          controller.clearModuleState();\n        }\n      }\n\n      if (isEs6) {\n        // Due to circular dependencies this may not be available for require\n        // right now.\n        goog.global['$jscomp']['require']['ensure'](\n            [dep.getPathName()], function() {\n              controller.registerEs6ModuleExports(\n                  dep.path,\n                  goog.global['$jscomp']['require'](dep.getPathName()),\n                  namespace);\n            });\n      }\n\n      controller.loaded();\n    }\n\n    // Do not fetch now; in FireFox 47 the synchronous XHR doesn't block all\n    // events. If we fetched now and then document.write'd the contents the\n    // document.write would be an eval and would execute too soon! Instead write\n    // a script tag to fetch and eval synchronously at the correct time.\n    function fetchInOwnScriptThenLoad() {\n      /** @type {!HTMLDocument} */\n      var doc = goog.global.document;\n\n      var key = goog.Dependency.registerCallback_(function() {\n        goog.Dependency.unregisterCallback_(key);\n        load();\n      });\n\n      var script = '<script type=\"text/javascript\">' +\n          goog.protectScriptTag_('goog.Dependency.callback_(\"' + key + '\");') +\n          '</' +\n          'script>';\n      doc.write(\n          goog.TRUSTED_TYPES_POLICY_ ?\n              goog.TRUSTED_TYPES_POLICY_.createHTML(script) :\n              script);\n    }\n\n    // If one thing is pending it is this.\n    var anythingElsePending = controller.pending().length > 1;\n\n    // If anything else is loading we need to lazy load due to bugs in old IE.\n    // Specifically script tags with src and script tags with contents could\n    // execute out of order if document.write is used, so we cannot use\n    // document.write. Do not pause here; it breaks old IE as well.\n    var useOldIeWorkAround =\n        anythingElsePending && goog.DebugLoader_.IS_OLD_IE_;\n\n    // Additionally if we are meant to defer scripts but the page is still\n    // loading (e.g. an ES6 module is loading) then also defer. Or if we are\n    // meant to defer and anything else is pending then defer (those may be\n    // scripts that did not need transformation and are just script tags with\n    // defer set to true, and we need to evaluate after that deferred script).\n    var needsAsyncLoading = goog.Dependency.defer_ &&\n        (anythingElsePending || goog.isDocumentLoading_());\n\n    if (useOldIeWorkAround || needsAsyncLoading) {\n      // Note that we only defer when we have to rather than 100% of the time.\n      // Always defering would work, but then in theory the order of\n      // goog.require calls would then matter. We want to enforce that most of\n      // the time the order of the require calls does not matter.\n      controller.defer(function() {\n        load();\n      });\n      return;\n    }\n    // TODO(johnplaisted): Externs are missing onreadystatechange for\n    // HTMLDocument.\n    /** @type {?} */\n    var doc = goog.global.document;\n\n    var isInternetExplorer =\n        goog.inHtmlDocument_() && 'ActiveXObject' in goog.global;\n\n    // Don't delay in any version of IE. There's bug around this that will\n    // cause out of order script execution. This means that on older IE ES6\n    // modules will load too early (while the document is still loading + the\n    // dom is not available). The other option is to load too late (when the\n    // document is complete and the onload even will never fire). This seems\n    // to be the lesser of two evils as scripts already act like the former.\n    if (isEs6 && goog.inHtmlDocument_() && goog.isDocumentLoading_() &&\n        !isInternetExplorer) {\n      goog.Dependency.defer_ = true;\n      // Transpiled ES6 modules still need to load like regular ES6 modules,\n      // aka only after the document is interactive.\n      controller.pause();\n      var oldCallback = doc.onreadystatechange;\n      doc.onreadystatechange = function() {\n        if (doc.readyState == 'interactive') {\n          doc.onreadystatechange = oldCallback;\n          load();\n          controller.resume();\n        }\n        if (goog.isFunction(oldCallback)) {\n          oldCallback.apply(undefined, arguments);\n        }\n      };\n    } else {\n      // Always eval on old IE.\n      if (goog.DebugLoader_.IS_OLD_IE_ || !goog.inHtmlDocument_() ||\n          !goog.isDocumentLoading_()) {\n        load();\n      } else {\n        fetchInOwnScriptThenLoad();\n      }\n    }\n  };\n\n\n  /**\n   * @param {string} contents\n   * @return {string}\n   * @abstract\n   */\n  goog.TransformedDependency.prototype.transform = function(contents) {};\n\n\n  /**\n   * Any non-goog.module dependency which needs to be transpiled before eval.\n   *\n   * @param {string} path Absolute path of this script.\n   * @param {string} relativePath Path of this script relative to goog.basePath.\n   * @param {!Array<string>} provides goog.provided or goog.module symbols\n   *     in this file.\n   * @param {!Array<string>} requires goog symbols or relative paths to Closure\n   *     this depends on.\n   * @param {!Object<string, string>} loadFlags\n   * @param {!goog.Transpiler} transpiler\n   * @struct @constructor\n   * @extends {goog.TransformedDependency}\n   */\n  goog.TranspiledDependency = function(\n      path, relativePath, provides, requires, loadFlags, transpiler) {\n    goog.TranspiledDependency.base(\n        this, 'constructor', path, relativePath, provides, requires, loadFlags);\n    /** @protected @const*/\n    this.transpiler = transpiler;\n  };\n  goog.inherits(goog.TranspiledDependency, goog.TransformedDependency);\n\n\n  /** @override */\n  goog.TranspiledDependency.prototype.transform = function(contents) {\n    // Transpile with the pathname so that ES6 modules are domain agnostic.\n    return this.transpiler.transpile(contents, this.getPathName());\n  };\n\n\n  /**\n   * An ES6 module dependency that was transpiled to a jscomp module outside\n   * of the debug loader, e.g. server side.\n   *\n   * @param {string} path Absolute path of this script.\n   * @param {string} relativePath Path of this script relative to goog.basePath.\n   * @param {!Array<string>} provides goog.provided or goog.module symbols\n   *     in this file.\n   * @param {!Array<string>} requires goog symbols or relative paths to Closure\n   *     this depends on.\n   * @param {!Object<string, string>} loadFlags\n   * @struct @constructor\n   * @extends {goog.TransformedDependency}\n   */\n  goog.PreTranspiledEs6ModuleDependency = function(\n      path, relativePath, provides, requires, loadFlags) {\n    goog.PreTranspiledEs6ModuleDependency.base(\n        this, 'constructor', path, relativePath, provides, requires, loadFlags);\n  };\n  goog.inherits(\n      goog.PreTranspiledEs6ModuleDependency, goog.TransformedDependency);\n\n\n  /** @override */\n  goog.PreTranspiledEs6ModuleDependency.prototype.transform = function(\n      contents) {\n    return contents;\n  };\n\n\n  /**\n   * A goog.module, transpiled or not. Will always perform some minimal\n   * transformation even when not transpiled to wrap in a goog.loadModule\n   * statement.\n   *\n   * @param {string} path Absolute path of this script.\n   * @param {string} relativePath Path of this script relative to goog.basePath.\n   * @param {!Array<string>} provides goog.provided or goog.module symbols\n   *     in this file.\n   * @param {!Array<string>} requires goog symbols or relative paths to Closure\n   *     this depends on.\n   * @param {!Object<string, string>} loadFlags\n   * @param {boolean} needsTranspile\n   * @param {!goog.Transpiler} transpiler\n   * @struct @constructor\n   * @extends {goog.TransformedDependency}\n   */\n  goog.GoogModuleDependency = function(\n      path, relativePath, provides, requires, loadFlags, needsTranspile,\n      transpiler) {\n    goog.GoogModuleDependency.base(\n        this, 'constructor', path, relativePath, provides, requires, loadFlags);\n    /** @private @const */\n    this.needsTranspile_ = needsTranspile;\n    /** @private @const */\n    this.transpiler_ = transpiler;\n  };\n  goog.inherits(goog.GoogModuleDependency, goog.TransformedDependency);\n\n\n  /** @override */\n  goog.GoogModuleDependency.prototype.transform = function(contents) {\n    if (this.needsTranspile_) {\n      contents = this.transpiler_.transpile(contents, this.getPathName());\n    }\n\n    if (!goog.LOAD_MODULE_USING_EVAL || !goog.isDef(goog.global.JSON)) {\n      return '' +\n          'goog.loadModule(function(exports) {' +\n          '\"use strict\";' + contents +\n          '\\n' +  // terminate any trailing single line comment.\n          ';return exports' +\n          '});' +\n          '\\n//# sourceURL=' + this.path + '\\n';\n    } else {\n      return '' +\n          'goog.loadModule(' +\n          goog.global.JSON.stringify(\n              contents + '\\n//# sourceURL=' + this.path + '\\n') +\n          ');';\n    }\n  };\n\n\n  /**\n   * Whether the browser is IE9 or earlier, which needs special handling\n   * for deferred modules.\n   * @const @private {boolean}\n   */\n  goog.DebugLoader_.IS_OLD_IE_ = !!(\n      !goog.global.atob && goog.global.document && goog.global.document['all']);\n\n\n  /**\n   * @param {string} relPath\n   * @param {!Array<string>|undefined} provides\n   * @param {!Array<string>} requires\n   * @param {boolean|!Object<string>=} opt_loadFlags\n   * @see goog.addDependency\n   */\n  goog.DebugLoader_.prototype.addDependency = function(\n      relPath, provides, requires, opt_loadFlags) {\n    provides = provides || [];\n    relPath = relPath.replace(/\\\\/g, '/');\n    var path = goog.normalizePath_(goog.basePath + relPath);\n    if (!opt_loadFlags || typeof opt_loadFlags === 'boolean') {\n      opt_loadFlags = opt_loadFlags ? {'module': goog.ModuleType.GOOG} : {};\n    }\n    var dep = this.factory_.createDependency(\n        path, relPath, provides, requires, opt_loadFlags,\n        goog.transpiler_.needsTranspile(\n            opt_loadFlags['lang'] || 'es3', opt_loadFlags['module']));\n    this.dependencies_[path] = dep;\n    for (var i = 0; i < provides.length; i++) {\n      this.idToPath_[provides[i]] = path;\n    }\n    this.idToPath_[relPath] = path;\n  };\n\n\n  /**\n   * Creates goog.Dependency instances for the debug loader to load.\n   *\n   * Should be overridden to have the debug loader use custom subclasses of\n   * goog.Dependency.\n   *\n   * @param {!goog.Transpiler} transpiler\n   * @struct @constructor\n   */\n  goog.DependencyFactory = function(transpiler) {\n    /** @protected @const */\n    this.transpiler = transpiler;\n  };\n\n\n  /**\n   * @param {string} path Absolute path of the file.\n   * @param {string} relativePath Path relative to closures base.js.\n   * @param {!Array<string>} provides Array of provided goog.provide/module ids.\n   * @param {!Array<string>} requires Array of required goog.provide/module /\n   *     relative ES6 module paths.\n   * @param {!Object<string, string>} loadFlags\n   * @param {boolean} needsTranspile True if the file needs to be transpiled\n   *     per the goog.Transpiler.\n   * @return {!goog.Dependency}\n   */\n  goog.DependencyFactory.prototype.createDependency = function(\n      path, relativePath, provides, requires, loadFlags, needsTranspile) {\n\n    if (loadFlags['module'] == goog.ModuleType.GOOG) {\n      return new goog.GoogModuleDependency(\n          path, relativePath, provides, requires, loadFlags, needsTranspile,\n          this.transpiler);\n    } else if (needsTranspile) {\n      return new goog.TranspiledDependency(\n          path, relativePath, provides, requires, loadFlags, this.transpiler);\n    } else {\n      if (loadFlags['module'] == goog.ModuleType.ES6) {\n        if (goog.TRANSPILE == 'never' && goog.ASSUME_ES_MODULES_TRANSPILED) {\n          return new goog.PreTranspiledEs6ModuleDependency(\n              path, relativePath, provides, requires, loadFlags);\n        } else {\n          return new goog.Es6ModuleDependency(\n              path, relativePath, provides, requires, loadFlags);\n        }\n      } else {\n        return new goog.Dependency(\n            path, relativePath, provides, requires, loadFlags);\n      }\n    }\n  };\n\n\n  /** @private @const */\n  goog.debugLoader_ = new goog.DebugLoader_();\n\n\n  /**\n   * Loads the Closure Dependency file.\n   *\n   * Exposed a public function so CLOSURE_NO_DEPS can be set to false, base\n   * loaded, setDependencyFactory called, and then this called. i.e. allows\n   * custom loading of the deps file.\n   */\n  goog.loadClosureDeps = function() {\n    goog.debugLoader_.loadClosureDeps();\n  };\n\n\n  /**\n   * Sets the dependency factory, which can be used to create custom\n   * goog.Dependency implementations to control how dependencies are loaded.\n   *\n   * Note: if you wish to call this function and provide your own implemnetation\n   * it is a wise idea to set CLOSURE_NO_DEPS to true, otherwise the dependency\n   * file and all of its goog.addDependency calls will use the default factory.\n   * You can call goog.loadClosureDeps to load the Closure dependency file\n   * later, after your factory is injected.\n   *\n   * @param {!goog.DependencyFactory} factory\n   */\n  goog.setDependencyFactory = function(factory) {\n    goog.debugLoader_.setDependencyFactory(factory);\n  };\n\n\n  if (!goog.global.CLOSURE_NO_DEPS) {\n    goog.debugLoader_.loadClosureDeps();\n  }\n\n\n  /**\n   * Bootstraps the given namespaces and calls the callback once they are\n   * available either via goog.require. This is a replacement for using\n   * `goog.require` to bootstrap Closure JavaScript. Previously a `goog.require`\n   * in an HTML file would guarantee that the require'd namespace was available\n   * in the next immediate script tag. With ES6 modules this no longer a\n   * guarantee.\n   *\n   * @param {!Array<string>} namespaces\n   * @param {function(): ?} callback Function to call once all the namespaces\n   *     have loaded. Always called asynchronously.\n   */\n  goog.bootstrap = function(namespaces, callback) {\n    goog.debugLoader_.bootstrap(namespaces, callback);\n  };\n}\n\n\n/**\n * @define {string} Trusted Types policy name. If non-empty then Closure will\n * use Trusted Types.\n */\ngoog.TRUSTED_TYPES_POLICY_NAME =\n    goog.define('goog.TRUSTED_TYPES_POLICY_NAME', '');\n\n\n/**\n * Returns the parameter.\n * @param {string} s\n * @return {string}\n * @private\n */\ngoog.identity_ = function(s) {\n  return s;\n};\n\n\n/**\n * Creates Trusted Types policy if Trusted Types are supported by the browser.\n * The policy just blesses any string as a Trusted Type. It is not visibility\n * restricted because anyone can also call TrustedTypes.createPolicy directly.\n * However, the allowed names should be restricted by a HTTP header and the\n * reference to the created policy should be visibility restricted.\n * @param {string} name\n * @return {?TrustedTypePolicy}\n */\ngoog.createTrustedTypesPolicy = function(name) {\n  var policy = null;\n  if (typeof TrustedTypes === 'undefined' || !TrustedTypes.createPolicy) {\n    return policy;\n  }\n  // TrustedTypes.createPolicy throws if called with a name that is already\n  // registered, even in report-only mode. Until the API changes, catch the\n  // error not to break the applications functionally. In such case, the code\n  // will fall back to using regular Safe Types.\n  // TODO(koto): Remove catching once createPolicy API stops throwing.\n  try {\n    policy = TrustedTypes.createPolicy(name, {\n      createHTML: goog.identity_,\n      createScript: goog.identity_,\n      createScriptURL: goog.identity_,\n      createURL: goog.identity_\n    });\n  } catch (e) {\n    goog.logToConsole_(e.message);\n  }\n  return policy;\n};\n\n\n/** @private @const {?TrustedTypePolicy} */\ngoog.TRUSTED_TYPES_POLICY_ = goog.TRUSTED_TYPES_POLICY_NAME ?\n    goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME + '#base') :\n    null;\n",null,null,null,null,null,null,"// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\ngoog.provide('goog.Thenable');\n\n/** @suppress {extraRequire} */\ngoog.forwardDeclare('goog.Promise'); // for the type reference.\n\n\n\n/**\n * Provides a more strict interface for Thenables in terms of\n * http://promisesaplus.com for interop with {@see goog.Promise}.\n *\n * @interface\n * @extends {IThenable<TYPE>}\n * @template TYPE\n */\ngoog.Thenable = function() {};\n\n\n/**\n * Adds callbacks that will operate on the result of the Thenable, returning a\n * new child Promise.\n *\n * If the Thenable is fulfilled, the `onFulfilled` callback will be\n * invoked with the fulfillment value as argument, and the child Promise will\n * be fulfilled with the return value of the callback. If the callback throws\n * an exception, the child Promise will be rejected with the thrown value\n * instead.\n *\n * If the Thenable is rejected, the `onRejected` callback will be invoked\n * with the rejection reason as argument, and the child Promise will be rejected\n * with the return value of the callback or thrown value.\n *\n * @param {?(function(this:THIS, TYPE): VALUE)=} opt_onFulfilled A\n *     function that will be invoked with the fulfillment value if the Promise\n *     is fulfilled.\n * @param {?(function(this:THIS, *): *)=} opt_onRejected A function that will\n *     be invoked with the rejection reason if the Promise is rejected.\n * @param {THIS=} opt_context An optional context object that will be the\n *     execution context for the callbacks. By default, functions are executed\n *     with the default this.\n *\n * @return {RESULT} A new Promise that will receive the result\n *     of the fulfillment or rejection callback.\n * @template VALUE\n * @template THIS\n *\n * When a Promise (or thenable) is returned from the fulfilled callback,\n * the result is the payload of that promise, not the promise itself.\n *\n * @template RESULT := type('goog.Promise',\n *     cond(isUnknown(VALUE), unknown(),\n *       mapunion(VALUE, (V) =>\n *         cond(isTemplatized(V) && sub(rawTypeOf(V), 'IThenable'),\n *           templateTypeOf(V, 0),\n *           cond(sub(V, 'Thenable'),\n *              unknown(),\n *              V)))))\n *  =:\n *\n */\ngoog.Thenable.prototype.then = function(\n    opt_onFulfilled, opt_onRejected, opt_context) {};\n\n\n/**\n * An expando property to indicate that an object implements\n * `goog.Thenable`.\n *\n * {@see addImplementation}.\n *\n * @const\n */\ngoog.Thenable.IMPLEMENTED_BY_PROP = '$goog_Thenable';\n\n\n/**\n * Marks a given class (constructor) as an implementation of Thenable, so\n * that we can query that fact at runtime. The class must have already\n * implemented the interface.\n * Exports a 'then' method on the constructor prototype, so that the objects\n * also implement the extern {@see goog.Thenable} interface for interop with\n * other Promise implementations.\n * @param {function(new:goog.Thenable,...?)} ctor The class constructor. The\n *     corresponding class must have already implemented the interface.\n */\ngoog.Thenable.addImplementation = function(ctor) {\n  if (COMPILED) {\n    ctor.prototype[goog.Thenable.IMPLEMENTED_BY_PROP] = true;\n  } else {\n    // Avoids dictionary access in uncompiled mode.\n    ctor.prototype.$goog_Thenable = true;\n  }\n};\n\n\n/**\n * @param {?} object\n * @return {boolean} Whether a given instance implements `goog.Thenable`.\n *     The class/superclass of the instance must call `addImplementation`.\n */\ngoog.Thenable.isImplementedBy = function(object) {\n  if (!object) {\n    return false;\n  }\n  try {\n    if (COMPILED) {\n      return !!object[goog.Thenable.IMPLEMENTED_BY_PROP];\n    }\n    return !!object.$goog_Thenable;\n  } catch (e) {\n    // Property access seems to be forbidden.\n    return false;\n  }\n};\n","// Copyright 2009 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Provides a base class for custom Error objects such that the\n * stack is correctly maintained.\n *\n * You should never need to throw goog.debug.Error(msg) directly, Error(msg) is\n * sufficient.\n *\n */\n\ngoog.provide('goog.debug.Error');\n\n\n\n/**\n * Base class for custom error objects.\n * @param {*=} opt_msg The message associated with the error.\n * @constructor\n * @extends {Error}\n */\ngoog.debug.Error = function(opt_msg) {\n\n  // Attempt to ensure there is a stack trace.\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(this, goog.debug.Error);\n  } else {\n    var stack = new Error().stack;\n    if (stack) {\n      /** @override */\n      this.stack = stack;\n    }\n  }\n\n  if (opt_msg) {\n    /** @override */\n    this.message = String(opt_msg);\n  }\n\n  /**\n   * Whether to report this error to the server. Setting this to false will\n   * cause the error reporter to not report the error back to the server,\n   * which can be useful if the client knows that the error has already been\n   * logged on the server.\n   * @type {boolean}\n   */\n  this.reportErrorToServer = true;\n};\ngoog.inherits(goog.debug.Error, Error);\n\n\n/** @override */\ngoog.debug.Error.prototype.name = 'CustomError';\n","// Copyright 2008 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Utilities to check the preconditions, postconditions and\n * invariants runtime.\n *\n * Methods in this package are given special treatment by the compiler\n * for type-inference. For example, <code>goog.asserts.assert(foo)</code>\n * will make the compiler treat <code>foo</code> as non-nullable. Similarly,\n * <code>goog.asserts.assertNumber(foo)</code> informs the compiler about the\n * type of <code>foo</code>. Where applicable, such assertions are preferable to\n * casts by jsdoc with <code>@type</code>.\n *\n * The compiler has an option to disable asserts. So code like:\n * <code>\n * var x = goog.asserts.assert(foo());\n * goog.asserts.assert(bar());\n * </code>\n * will be transformed into:\n * <code>\n * var x = foo();\n * </code>\n * The compiler will leave in foo() (because its return value is used),\n * but it will remove bar() because it assumes it does not have side-effects.\n *\n * Additionally, note the compiler will consider the type to be \"tightened\" for\n * all statements <em>after</em> the assertion. For example:\n * <code>\n * const /** ?Object &#ast;/ value = foo();\n * goog.asserts.assert(value);\n * // \"value\" is of type {!Object} at this point.\n * </code>\n *\n * @author agrieve@google.com (Andrew Grieve)\n */\n\ngoog.provide('goog.asserts');\ngoog.provide('goog.asserts.AssertionError');\n\ngoog.require('goog.debug.Error');\ngoog.require('goog.dom.NodeType');\n\n\n/**\n * @define {boolean} Whether to strip out asserts or to leave them in.\n */\ngoog.asserts.ENABLE_ASSERTS =\n    goog.define('goog.asserts.ENABLE_ASSERTS', goog.DEBUG);\n\n\n\n/**\n * Error object for failed assertions.\n * @param {string} messagePattern The pattern that was used to form message.\n * @param {!Array<*>} messageArgs The items to substitute into the pattern.\n * @constructor\n * @extends {goog.debug.Error}\n * @final\n */\ngoog.asserts.AssertionError = function(messagePattern, messageArgs) {\n  goog.debug.Error.call(this, goog.asserts.subs_(messagePattern, messageArgs));\n\n  /**\n   * The message pattern used to format the error message. Error handlers can\n   * use this to uniquely identify the assertion.\n   * @type {string}\n   */\n  this.messagePattern = messagePattern;\n};\ngoog.inherits(goog.asserts.AssertionError, goog.debug.Error);\n\n\n/** @override */\ngoog.asserts.AssertionError.prototype.name = 'AssertionError';\n\n\n/**\n * The default error handler.\n * @param {!goog.asserts.AssertionError} e The exception to be handled.\n */\ngoog.asserts.DEFAULT_ERROR_HANDLER = function(e) {\n  throw e;\n};\n\n\n/**\n * The handler responsible for throwing or logging assertion errors.\n * @private {function(!goog.asserts.AssertionError)}\n */\ngoog.asserts.errorHandler_ = goog.asserts.DEFAULT_ERROR_HANDLER;\n\n\n/**\n * Does simple python-style string substitution.\n * subs(\"foo%s hot%s\", \"bar\", \"dog\") becomes \"foobar hotdog\".\n * @param {string} pattern The string containing the pattern.\n * @param {!Array<*>} subs The items to substitute into the pattern.\n * @return {string} A copy of `str` in which each occurrence of\n *     {@code %s} has been replaced an argument from `var_args`.\n * @private\n */\ngoog.asserts.subs_ = function(pattern, subs) {\n  var splitParts = pattern.split('%s');\n  var returnString = '';\n\n  // Replace up to the last split part. We are inserting in the\n  // positions between split parts.\n  var subLast = splitParts.length - 1;\n  for (var i = 0; i < subLast; i++) {\n    // keep unsupplied as '%s'\n    var sub = (i < subs.length) ? subs[i] : '%s';\n    returnString += splitParts[i] + sub;\n  }\n  return returnString + splitParts[subLast];\n};\n\n\n/**\n * Throws an exception with the given message and \"Assertion failed\" prefixed\n * onto it.\n * @param {string} defaultMessage The message to use if givenMessage is empty.\n * @param {Array<*>} defaultArgs The substitution arguments for defaultMessage.\n * @param {string|undefined} givenMessage Message supplied by the caller.\n * @param {Array<*>} givenArgs The substitution arguments for givenMessage.\n * @throws {goog.asserts.AssertionError} When the value is not a number.\n * @private\n */\ngoog.asserts.doAssertFailure_ = function(\n    defaultMessage, defaultArgs, givenMessage, givenArgs) {\n  var message = 'Assertion failed';\n  if (givenMessage) {\n    message += ': ' + givenMessage;\n    var args = givenArgs;\n  } else if (defaultMessage) {\n    message += ': ' + defaultMessage;\n    args = defaultArgs;\n  }\n  // The '' + works around an Opera 10 bug in the unit tests. Without it,\n  // a stack trace is added to var message above. With this, a stack trace is\n  // not added until this line (it causes the extra garbage to be added after\n  // the assertion message instead of in the middle of it).\n  var e = new goog.asserts.AssertionError('' + message, args || []);\n  goog.asserts.errorHandler_(e);\n};\n\n\n/**\n * Sets a custom error handler that can be used to customize the behavior of\n * assertion failures, for example by turning all assertion failures into log\n * messages.\n * @param {function(!goog.asserts.AssertionError)} errorHandler\n */\ngoog.asserts.setErrorHandler = function(errorHandler) {\n  if (goog.asserts.ENABLE_ASSERTS) {\n    goog.asserts.errorHandler_ = errorHandler;\n  }\n};\n\n\n/**\n * Checks if the condition evaluates to true if goog.asserts.ENABLE_ASSERTS is\n * true.\n * @template T\n * @param {T} condition The condition to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @return {T} The value of the condition.\n * @throws {goog.asserts.AssertionError} When the condition evaluates to false.\n * @closurePrimitive {asserts.truthy}\n */\ngoog.asserts.assert = function(condition, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS && !condition) {\n    goog.asserts.doAssertFailure_(\n        '', null, opt_message, Array.prototype.slice.call(arguments, 2));\n  }\n  return condition;\n};\n\n\n/**\n * Checks if `value` is `null` or `undefined` if goog.asserts.ENABLE_ASSERTS is\n * true.\n *\n * @param {T} value The value to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @return {R} `value` with its type narrowed to exclude `null` and `undefined`.\n *\n * @template T\n * @template R :=\n *     mapunion(T, (V) =>\n *         cond(eq(V, 'null'),\n *             none(),\n *             cond(eq(V, 'undefined'),\n *                 none(),\n *                 V)))\n *  =:\n *\n * @throws {!goog.asserts.AssertionError} When `value` is `null` or `undefined`.\n * @closurePrimitive {asserts.matchesReturn}\n */\ngoog.asserts.assertExists = function(value, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS && value == null) {\n    goog.asserts.doAssertFailure_(\n        'Expected to exist: %s.', [value], opt_message,\n        Array.prototype.slice.call(arguments, 2));\n  }\n  return value;\n};\n\n\n/**\n * Fails if goog.asserts.ENABLE_ASSERTS is true. This function is useful in case\n * when we want to add a check in the unreachable area like switch-case\n * statement:\n *\n * <pre>\n *  switch(type) {\n *    case FOO: doSomething(); break;\n *    case BAR: doSomethingElse(); break;\n *    default: goog.asserts.fail('Unrecognized type: ' + type);\n *      // We have only 2 types - \"default:\" section is unreachable code.\n *  }\n * </pre>\n *\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @throws {goog.asserts.AssertionError} Failure.\n * @closurePrimitive {asserts.fail}\n */\ngoog.asserts.fail = function(opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS) {\n    goog.asserts.errorHandler_(\n        new goog.asserts.AssertionError(\n            'Failure' + (opt_message ? ': ' + opt_message : ''),\n            Array.prototype.slice.call(arguments, 1)));\n  }\n};\n\n\n/**\n * Checks if the value is a number if goog.asserts.ENABLE_ASSERTS is true.\n * @param {*} value The value to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @return {number} The value, guaranteed to be a number when asserts enabled.\n * @throws {goog.asserts.AssertionError} When the value is not a number.\n * @closurePrimitive {asserts.matchesReturn}\n */\ngoog.asserts.assertNumber = function(value, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS && !goog.isNumber(value)) {\n    goog.asserts.doAssertFailure_(\n        'Expected number but got %s: %s.', [goog.typeOf(value), value],\n        opt_message, Array.prototype.slice.call(arguments, 2));\n  }\n  return /** @type {number} */ (value);\n};\n\n\n/**\n * Checks if the value is a string if goog.asserts.ENABLE_ASSERTS is true.\n * @param {*} value The value to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @return {string} The value, guaranteed to be a string when asserts enabled.\n * @throws {goog.asserts.AssertionError} When the value is not a string.\n * @closurePrimitive {asserts.matchesReturn}\n */\ngoog.asserts.assertString = function(value, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS && !goog.isString(value)) {\n    goog.asserts.doAssertFailure_(\n        'Expected string but got %s: %s.', [goog.typeOf(value), value],\n        opt_message, Array.prototype.slice.call(arguments, 2));\n  }\n  return /** @type {string} */ (value);\n};\n\n\n/**\n * Checks if the value is a function if goog.asserts.ENABLE_ASSERTS is true.\n * @param {*} value The value to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @return {!Function} The value, guaranteed to be a function when asserts\n *     enabled.\n * @throws {goog.asserts.AssertionError} When the value is not a function.\n * @closurePrimitive {asserts.matchesReturn}\n */\ngoog.asserts.assertFunction = function(value, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS && !goog.isFunction(value)) {\n    goog.asserts.doAssertFailure_(\n        'Expected function but got %s: %s.', [goog.typeOf(value), value],\n        opt_message, Array.prototype.slice.call(arguments, 2));\n  }\n  return /** @type {!Function} */ (value);\n};\n\n\n/**\n * Checks if the value is an Object if goog.asserts.ENABLE_ASSERTS is true.\n * @param {*} value The value to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @return {!Object} The value, guaranteed to be a non-null object.\n * @throws {goog.asserts.AssertionError} When the value is not an object.\n * @closurePrimitive {asserts.matchesReturn}\n */\ngoog.asserts.assertObject = function(value, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS && !goog.isObject(value)) {\n    goog.asserts.doAssertFailure_(\n        'Expected object but got %s: %s.', [goog.typeOf(value), value],\n        opt_message, Array.prototype.slice.call(arguments, 2));\n  }\n  return /** @type {!Object} */ (value);\n};\n\n\n/**\n * Checks if the value is an Array if goog.asserts.ENABLE_ASSERTS is true.\n * @param {*} value The value to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @return {!Array<?>} The value, guaranteed to be a non-null array.\n * @throws {goog.asserts.AssertionError} When the value is not an array.\n * @closurePrimitive {asserts.matchesReturn}\n */\ngoog.asserts.assertArray = function(value, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS && !goog.isArray(value)) {\n    goog.asserts.doAssertFailure_(\n        'Expected array but got %s: %s.', [goog.typeOf(value), value],\n        opt_message, Array.prototype.slice.call(arguments, 2));\n  }\n  return /** @type {!Array<?>} */ (value);\n};\n\n\n/**\n * Checks if the value is a boolean if goog.asserts.ENABLE_ASSERTS is true.\n * @param {*} value The value to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @return {boolean} The value, guaranteed to be a boolean when asserts are\n *     enabled.\n * @throws {goog.asserts.AssertionError} When the value is not a boolean.\n * @closurePrimitive {asserts.matchesReturn}\n */\ngoog.asserts.assertBoolean = function(value, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS && !goog.isBoolean(value)) {\n    goog.asserts.doAssertFailure_(\n        'Expected boolean but got %s: %s.', [goog.typeOf(value), value],\n        opt_message, Array.prototype.slice.call(arguments, 2));\n  }\n  return /** @type {boolean} */ (value);\n};\n\n\n/**\n * Checks if the value is a DOM Element if goog.asserts.ENABLE_ASSERTS is true.\n * @param {*} value The value to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @return {!Element} The value, likely to be a DOM Element when asserts are\n *     enabled.\n * @throws {goog.asserts.AssertionError} When the value is not an Element.\n * @closurePrimitive {asserts.matchesReturn}\n */\ngoog.asserts.assertElement = function(value, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS &&\n      (!goog.isObject(value) || value.nodeType != goog.dom.NodeType.ELEMENT)) {\n    goog.asserts.doAssertFailure_(\n        'Expected Element but got %s: %s.', [goog.typeOf(value), value],\n        opt_message, Array.prototype.slice.call(arguments, 2));\n  }\n  return /** @type {!Element} */ (value);\n};\n\n\n/**\n * Checks if the value is an instance of the user-defined type if\n * goog.asserts.ENABLE_ASSERTS is true.\n *\n * The compiler may tighten the type returned by this function.\n *\n * @param {?} value The value to check.\n * @param {function(new: T, ...)} type A user-defined constructor.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @throws {goog.asserts.AssertionError} When the value is not an instance of\n *     type.\n * @return {T}\n * @template T\n * @closurePrimitive {asserts.matchesReturn}\n */\ngoog.asserts.assertInstanceof = function(value, type, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS && !(value instanceof type)) {\n    goog.asserts.doAssertFailure_(\n        'Expected instanceof %s but got %s.',\n        [goog.asserts.getType_(type), goog.asserts.getType_(value)],\n        opt_message, Array.prototype.slice.call(arguments, 3));\n  }\n  return value;\n};\n\n\n/**\n * Checks whether the value is a finite number, if goog.asserts.ENABLE_ASSERTS\n * is true.\n *\n * @param {*} value The value to check.\n * @param {string=} opt_message Error message in case of failure.\n * @param {...*} var_args The items to substitute into the failure message.\n * @throws {goog.asserts.AssertionError} When the value is not a number, or is\n *     a non-finite number such as NaN, Infinity or -Infinity.\n * @return {number} The value initially passed in.\n */\ngoog.asserts.assertFinite = function(value, opt_message, var_args) {\n  if (goog.asserts.ENABLE_ASSERTS &&\n      (typeof value != 'number' || !isFinite(value))) {\n    goog.asserts.doAssertFailure_(\n        'Expected %s to be a finite number but it is not.', [value],\n        opt_message, Array.prototype.slice.call(arguments, 2));\n  }\n  return /** @type {number} */ (value);\n};\n\n/**\n * Checks that no enumerable keys are present in Object.prototype. Such keys\n * would break most code that use {@code for (var ... in ...)} loops.\n */\ngoog.asserts.assertObjectPrototypeIsIntact = function() {\n  for (var key in Object.prototype) {\n    goog.asserts.fail(key + ' should not be enumerable in Object.prototype.');\n  }\n};\n\n\n/**\n * Returns the type of a value. If a constructor is passed, and a suitable\n * string cannot be found, 'unknown type name' will be returned.\n * @param {*} value A constructor, object, or primitive.\n * @return {string} The best display name for the value, or 'unknown type name'.\n * @private\n */\ngoog.asserts.getType_ = function(value) {\n  if (value instanceof Function) {\n    return value.displayName || value.name || 'unknown type name';\n  } else if (value instanceof Object) {\n    return /** @type {string} */ (value.constructor.displayName) ||\n        value.constructor.name || Object.prototype.toString.call(value);\n  } else {\n    return value === null ? 'null' : typeof value;\n  }\n};\n","// Copyright 2015 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Simple freelist.\n *\n * An anterative to goog.structs.SimplePool, it imposes the requirement that the\n * objects in the list contain a \"next\" property that can be used to maintain\n * the pool.\n */\n\ngoog.provide('goog.async.FreeList');\n\n\n/**\n * @template ITEM\n */\ngoog.async.FreeList = goog.defineClass(null, {\n  /**\n   * @param {function():ITEM} create\n   * @param {function(ITEM):void} reset\n   * @param {number} limit\n   */\n  constructor: function(create, reset, limit) {\n    /** @private @const {number} */\n    this.limit_ = limit;\n    /** @private @const {function()} */\n    this.create_ = create;\n    /** @private @const {function(ITEM):void} */\n    this.reset_ = reset;\n\n    /** @private {number} */\n    this.occupants_ = 0;\n    /** @private {ITEM} */\n    this.head_ = null;\n  },\n\n  /**\n   * @return {ITEM}\n   */\n  get: function() {\n    var item;\n    if (this.occupants_ > 0) {\n      this.occupants_--;\n      item = this.head_;\n      this.head_ = item.next;\n      item.next = null;\n    } else {\n      item = this.create_();\n    }\n    return item;\n  },\n\n  /**\n   * @param {ITEM} item An item available for possible future reuse.\n   */\n  put: function(item) {\n    this.reset_(item);\n    if (this.occupants_ < this.limit_) {\n      this.occupants_++;\n      item.next = this.head_;\n      this.head_ = item;\n    }\n  },\n\n  /**\n   * Visible for testing.\n   * @package\n   * @return {number}\n   */\n  occupants: function() { return this.occupants_; }\n});\n","// Copyright 2015 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\ngoog.provide('goog.async.WorkItem');\ngoog.provide('goog.async.WorkQueue');\n\ngoog.require('goog.asserts');\ngoog.require('goog.async.FreeList');\n\n\n// TODO(johnlenz): generalize the WorkQueue if this is used by more\n// than goog.async.run.\n\n\n\n/**\n * A low GC workqueue. The key elements of this design:\n *   - avoids the need for goog.bind or equivalent by carrying scope\n *   - avoids the need for array reallocation by using a linked list\n *   - minimizes work entry objects allocation by recycling objects\n * @constructor\n * @final\n * @struct\n */\ngoog.async.WorkQueue = function() {\n  this.workHead_ = null;\n  this.workTail_ = null;\n};\n\n\n/** @define {number} The maximum number of entries to keep for recycling. */\ngoog.async.WorkQueue.DEFAULT_MAX_UNUSED =\n    goog.define('goog.async.WorkQueue.DEFAULT_MAX_UNUSED', 100);\n\n\n/** @const @private {goog.async.FreeList<goog.async.WorkItem>} */\ngoog.async.WorkQueue.freelist_ = new goog.async.FreeList(\n    function() { return new goog.async.WorkItem(); },\n    function(item) { item.reset(); }, goog.async.WorkQueue.DEFAULT_MAX_UNUSED);\n\n\n/**\n * @param {function()} fn\n * @param {Object|null|undefined} scope\n */\ngoog.async.WorkQueue.prototype.add = function(fn, scope) {\n  var item = this.getUnusedItem_();\n  item.set(fn, scope);\n\n  if (this.workTail_) {\n    this.workTail_.next = item;\n    this.workTail_ = item;\n  } else {\n    goog.asserts.assert(!this.workHead_);\n    this.workHead_ = item;\n    this.workTail_ = item;\n  }\n};\n\n\n/**\n * @return {goog.async.WorkItem}\n */\ngoog.async.WorkQueue.prototype.remove = function() {\n  var item = null;\n\n  if (this.workHead_) {\n    item = this.workHead_;\n    this.workHead_ = this.workHead_.next;\n    if (!this.workHead_) {\n      this.workTail_ = null;\n    }\n    item.next = null;\n  }\n  return item;\n};\n\n\n/**\n * @param {goog.async.WorkItem} item\n */\ngoog.async.WorkQueue.prototype.returnUnused = function(item) {\n  goog.async.WorkQueue.freelist_.put(item);\n};\n\n\n/**\n * @return {goog.async.WorkItem}\n * @private\n */\ngoog.async.WorkQueue.prototype.getUnusedItem_ = function() {\n  return goog.async.WorkQueue.freelist_.get();\n};\n\n\n\n/**\n * @constructor\n * @final\n * @struct\n */\ngoog.async.WorkItem = function() {\n  /** @type {?function()} */\n  this.fn = null;\n  /** @type {?Object|null|undefined} */\n  this.scope = null;\n  /** @type {?goog.async.WorkItem} */\n  this.next = null;\n};\n\n\n/**\n * @param {function()} fn\n * @param {Object|null|undefined} scope\n */\ngoog.async.WorkItem.prototype.set = function(fn, scope) {\n  this.fn = fn;\n  this.scope = scope;\n  this.next = null;\n};\n\n\n/** Reset the work item so they don't prevent GC before reuse */\ngoog.async.WorkItem.prototype.reset = function() {\n  this.fn = null;\n  this.scope = null;\n  this.next = null;\n};\n","// Copyright 2017 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\ngoog.provide('goog.dom.asserts');\n\ngoog.require('goog.asserts');\n\n/**\n * @fileoverview Custom assertions to ensure that an element has the appropriate\n * type.\n *\n * Using a goog.dom.safe wrapper on an object on the incorrect type (via an\n * incorrect static type cast) can result in security bugs: For instance,\n * g.d.s.setAnchorHref ensures that the URL assigned to the .href attribute\n * satisfies the SafeUrl contract, i.e., is safe to dereference as a hyperlink.\n * However, the value assigned to a HTMLLinkElement's .href property requires\n * the stronger TrustedResourceUrl contract, since it can refer to a stylesheet.\n * Thus, using g.d.s.setAnchorHref on an (incorrectly statically typed) object\n * of type HTMLLinkElement can result in a security vulnerability.\n * Assertions of the correct run-time type help prevent such incorrect use.\n *\n * In some cases, code using the DOM API is tested using mock objects (e.g., a\n * plain object such as {'href': url} instead of an actual Location object).\n * To allow such mocking, the assertions permit objects of types that are not\n * relevant DOM API objects at all (for instance, not Element or Location).\n *\n * Note that instanceof checks don't work straightforwardly in older versions of\n * IE, or across frames (see,\n * http://stackoverflow.com/questions/384286/javascript-isdom-how-do-you-check-if-a-javascript-object-is-a-dom-object,\n * http://stackoverflow.com/questions/26248599/instanceof-htmlelement-in-iframe-is-not-element-or-object).\n *\n * Hence, these assertions may pass vacuously in such scenarios. The resulting\n * risk of security bugs is limited by the following factors:\n *  - A bug can only arise in scenarios involving incorrect static typing (the\n *    wrapper methods are statically typed to demand objects of the appropriate,\n *    precise type).\n *  - Typically, code is tested and exercised in multiple browsers.\n */\n\n/**\n * Asserts that a given object is a Location.\n *\n * To permit this assertion to pass in the context of tests where DOM APIs might\n * be mocked, also accepts any other type except for subtypes of {!Element}.\n * This is to ensure that, for instance, HTMLLinkElement is not being used in\n * place of a Location, since this could result in security bugs due to stronger\n * contracts required for assignments to the href property of the latter.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!Location}\n */\ngoog.dom.asserts.assertIsLocation = function(o) {\n  if (goog.asserts.ENABLE_ASSERTS) {\n    var win = goog.dom.asserts.getWindow_(o);\n    if (win) {\n      if (!o || (!(o instanceof win.Location) && o instanceof win.Element)) {\n        goog.asserts.fail(\n            'Argument is not a Location (or a non-Element mock); got: %s',\n            goog.dom.asserts.debugStringForType_(o));\n      }\n    }\n  }\n  return /** @type {!Location} */ (o);\n};\n\n\n/**\n * Asserts that a given object is either the given subtype of Element\n * or a non-Element, non-Location Mock.\n *\n * To permit this assertion to pass in the context of tests where DOM\n * APIs might be mocked, also accepts any other type except for\n * subtypes of {!Element}.  This is to ensure that, for instance,\n * HTMLScriptElement is not being used in place of a HTMLImageElement,\n * since this could result in security bugs due to stronger contracts\n * required for assignments to the src property of the latter.\n *\n * The DOM type is looked up in the window the object belongs to.  In\n * some contexts, this might not be possible (e.g. when running tests\n * outside a browser, cross-domain lookup). In this case, the\n * assertions are skipped.\n *\n * @param {?Object} o The object whose type to assert.\n * @param {string} typename The name of the DOM type.\n * @return {!Element} The object.\n * @private\n */\n// TODO(bangert): Make an analog of goog.dom.TagName to correctly handle casts?\ngoog.dom.asserts.assertIsElementType_ = function(o, typename) {\n  if (goog.asserts.ENABLE_ASSERTS) {\n    var win = goog.dom.asserts.getWindow_(o);\n    if (win && typeof win[typename] != 'undefined') {\n      if (!o ||\n          (!(o instanceof win[typename]) &&\n           (o instanceof win.Location || o instanceof win.Element))) {\n        goog.asserts.fail(\n            'Argument is not a %s (or a non-Element, non-Location mock); ' +\n                'got: %s',\n            typename, goog.dom.asserts.debugStringForType_(o));\n      }\n    }\n  }\n  return /** @type {!Element} */ (o);\n};\n\n/**\n * Asserts that a given object is a HTMLAnchorElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not of type Location nor a subtype\n * of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLAnchorElement}\n */\ngoog.dom.asserts.assertIsHTMLAnchorElement = function(o) {\n  return /** @type {!HTMLAnchorElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLAnchorElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLButtonElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLButtonElement}\n */\ngoog.dom.asserts.assertIsHTMLButtonElement = function(o) {\n  return /** @type {!HTMLButtonElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLButtonElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLLinkElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLLinkElement}\n */\ngoog.dom.asserts.assertIsHTMLLinkElement = function(o) {\n  return /** @type {!HTMLLinkElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLLinkElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLImageElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLImageElement}\n */\ngoog.dom.asserts.assertIsHTMLImageElement = function(o) {\n  return /** @type {!HTMLImageElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLImageElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLAudioElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLAudioElement}\n */\ngoog.dom.asserts.assertIsHTMLAudioElement = function(o) {\n  return /** @type {!HTMLAudioElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLAudioElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLVideoElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLVideoElement}\n */\ngoog.dom.asserts.assertIsHTMLVideoElement = function(o) {\n  return /** @type {!HTMLVideoElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLVideoElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLInputElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLInputElement}\n */\ngoog.dom.asserts.assertIsHTMLInputElement = function(o) {\n  return /** @type {!HTMLInputElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLInputElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLTextAreaElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLTextAreaElement}\n */\ngoog.dom.asserts.assertIsHTMLTextAreaElement = function(o) {\n  return /** @type {!HTMLTextAreaElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLTextAreaElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLCanvasElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLCanvasElement}\n */\ngoog.dom.asserts.assertIsHTMLCanvasElement = function(o) {\n  return /** @type {!HTMLCanvasElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLCanvasElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLEmbedElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLEmbedElement}\n */\ngoog.dom.asserts.assertIsHTMLEmbedElement = function(o) {\n  return /** @type {!HTMLEmbedElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLEmbedElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLFormElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLFormElement}\n */\ngoog.dom.asserts.assertIsHTMLFormElement = function(o) {\n  return /** @type {!HTMLFormElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLFormElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLFrameElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLFrameElement}\n */\ngoog.dom.asserts.assertIsHTMLFrameElement = function(o) {\n  return /** @type {!HTMLFrameElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLFrameElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLIFrameElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLIFrameElement}\n */\ngoog.dom.asserts.assertIsHTMLIFrameElement = function(o) {\n  return /** @type {!HTMLIFrameElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLIFrameElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLObjectElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLObjectElement}\n */\ngoog.dom.asserts.assertIsHTMLObjectElement = function(o) {\n  return /** @type {!HTMLObjectElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLObjectElement'));\n};\n\n/**\n * Asserts that a given object is a HTMLScriptElement.\n *\n * To permit this assertion to pass in the context of tests where elements might\n * be mocked, also accepts objects that are not a subtype of Element.\n *\n * @param {?Object} o The object whose type to assert.\n * @return {!HTMLScriptElement}\n */\ngoog.dom.asserts.assertIsHTMLScriptElement = function(o) {\n  return /** @type {!HTMLScriptElement} */ (\n      goog.dom.asserts.assertIsElementType_(o, 'HTMLScriptElement'));\n};\n\n/**\n * Returns a string representation of a value's type.\n *\n * @param {*} value An object, or primitive.\n * @return {string} The best display name for the value.\n * @private\n */\ngoog.dom.asserts.debugStringForType_ = function(value) {\n  if (goog.isObject(value)) {\n    try {\n      return value.constructor.displayName || value.constructor.name ||\n          Object.prototype.toString.call(value);\n    } catch (e) {\n      return '<object could not be stringified>';\n    }\n  } else {\n    return value === undefined ? 'undefined' :\n                                 value === null ? 'null' : typeof value;\n  }\n};\n\n/**\n * Gets window of element.\n * @param {?Object} o\n * @return {?Window}\n * @private\n * @suppress {strictMissingProperties} ownerDocument not defined on Object\n */\ngoog.dom.asserts.getWindow_ = function(o) {\n  try {\n    var doc = o && o.ownerDocument;\n    // This can throw Blocked a frame with origin \"chrome-extension://...\" from\n    // accessing a cross-origin frame in Chrome extension.\n    var win =\n        doc && /** @type {?Window} */ (doc.defaultView || doc.parentWindow);\n    win = win || /** @type {!Window} */ (goog.global);\n    // This can throw Permission denied to access property \"Element\" on\n    // cross-origin object.\n    if (win.Element && win.Location) {\n      return win;\n    }\n  } catch (ex) {\n  }\n  return null;\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Utilities for manipulating arrays.\n *\n * @author arv@google.com (Erik Arvidsson)\n */\n\n\ngoog.provide('goog.array');\n\ngoog.require('goog.asserts');\n\n\n/**\n * @define {boolean} NATIVE_ARRAY_PROTOTYPES indicates whether the code should\n * rely on Array.prototype functions, if available.\n *\n * The Array.prototype functions can be defined by external libraries like\n * Prototype and setting this flag to false forces closure to use its own\n * goog.array implementation.\n *\n * If your javascript can be loaded by a third party site and you are wary about\n * relying on the prototype functions, specify\n * \"--define goog.NATIVE_ARRAY_PROTOTYPES=false\" to the JSCompiler.\n *\n * Setting goog.TRUSTED_SITE to false will automatically set\n * NATIVE_ARRAY_PROTOTYPES to false.\n */\ngoog.NATIVE_ARRAY_PROTOTYPES =\n    goog.define('goog.NATIVE_ARRAY_PROTOTYPES', goog.TRUSTED_SITE);\n\n\n/**\n * @define {boolean} If true, JSCompiler will use the native implementation of\n * array functions where appropriate (e.g., `Array#filter`) and remove the\n * unused pure JS implementation.\n */\ngoog.array.ASSUME_NATIVE_FUNCTIONS =\n    goog.define('goog.array.ASSUME_NATIVE_FUNCTIONS', false);\n\n\n/**\n * Returns the last element in an array without removing it.\n * Same as goog.array.last.\n * @param {IArrayLike<T>|string} array The array.\n * @return {T} Last item in array.\n * @template T\n */\ngoog.array.peek = function(array) {\n  return array[array.length - 1];\n};\n\n\n/**\n * Returns the last element in an array without removing it.\n * Same as goog.array.peek.\n * @param {IArrayLike<T>|string} array The array.\n * @return {T} Last item in array.\n * @template T\n */\ngoog.array.last = goog.array.peek;\n\n// NOTE(arv): Since most of the array functions are generic it allows you to\n// pass an array-like object. Strings have a length and are considered array-\n// like. However, the 'in' operator does not work on strings so we cannot just\n// use the array path even if the browser supports indexing into strings. We\n// therefore end up splitting the string.\n\n\n/**\n * Returns the index of the first element of an array with a specified value, or\n * -1 if the element is not present in the array.\n *\n * See {@link http://tinyurl.com/developer-mozilla-org-array-indexof}\n *\n * @param {IArrayLike<T>|string} arr The array to be searched.\n * @param {T} obj The object for which we are searching.\n * @param {number=} opt_fromIndex The index at which to start the search. If\n *     omitted the search starts at index 0.\n * @return {number} The index of the first matching array element.\n * @template T\n */\ngoog.array.indexOf = goog.NATIVE_ARRAY_PROTOTYPES &&\n        (goog.array.ASSUME_NATIVE_FUNCTIONS || Array.prototype.indexOf) ?\n    function(arr, obj, opt_fromIndex) {\n      goog.asserts.assert(arr.length != null);\n\n      return Array.prototype.indexOf.call(arr, obj, opt_fromIndex);\n    } :\n    function(arr, obj, opt_fromIndex) {\n      var fromIndex = opt_fromIndex == null ?\n          0 :\n          (opt_fromIndex < 0 ? Math.max(0, arr.length + opt_fromIndex) :\n                               opt_fromIndex);\n\n      if (goog.isString(arr)) {\n        // Array.prototype.indexOf uses === so only strings should be found.\n        if (!goog.isString(obj) || obj.length != 1) {\n          return -1;\n        }\n        return arr.indexOf(obj, fromIndex);\n      }\n\n      for (var i = fromIndex; i < arr.length; i++) {\n        if (i in arr && arr[i] === obj) return i;\n      }\n      return -1;\n    };\n\n\n/**\n * Returns the index of the last element of an array with a specified value, or\n * -1 if the element is not present in the array.\n *\n * See {@link http://tinyurl.com/developer-mozilla-org-array-lastindexof}\n *\n * @param {!IArrayLike<T>|string} arr The array to be searched.\n * @param {T} obj The object for which we are searching.\n * @param {?number=} opt_fromIndex The index at which to start the search. If\n *     omitted the search starts at the end of the array.\n * @return {number} The index of the last matching array element.\n * @template T\n */\ngoog.array.lastIndexOf = goog.NATIVE_ARRAY_PROTOTYPES &&\n        (goog.array.ASSUME_NATIVE_FUNCTIONS || Array.prototype.lastIndexOf) ?\n    function(arr, obj, opt_fromIndex) {\n      goog.asserts.assert(arr.length != null);\n\n      // Firefox treats undefined and null as 0 in the fromIndex argument which\n      // leads it to always return -1\n      var fromIndex = opt_fromIndex == null ? arr.length - 1 : opt_fromIndex;\n      return Array.prototype.lastIndexOf.call(arr, obj, fromIndex);\n    } :\n    function(arr, obj, opt_fromIndex) {\n      var fromIndex = opt_fromIndex == null ? arr.length - 1 : opt_fromIndex;\n\n      if (fromIndex < 0) {\n        fromIndex = Math.max(0, arr.length + fromIndex);\n      }\n\n      if (goog.isString(arr)) {\n        // Array.prototype.lastIndexOf uses === so only strings should be found.\n        if (!goog.isString(obj) || obj.length != 1) {\n          return -1;\n        }\n        return arr.lastIndexOf(obj, fromIndex);\n      }\n\n      for (var i = fromIndex; i >= 0; i--) {\n        if (i in arr && arr[i] === obj) return i;\n      }\n      return -1;\n    };\n\n\n/**\n * Calls a function for each element in an array. Skips holes in the array.\n * See {@link http://tinyurl.com/developer-mozilla-org-array-foreach}\n *\n * @param {IArrayLike<T>|string} arr Array or array like object over\n *     which to iterate.\n * @param {?function(this: S, T, number, ?): ?} f The function to call for every\n *     element. This function takes 3 arguments (the element, the index and the\n *     array). The return value is ignored.\n * @param {S=} opt_obj The object to be used as the value of 'this' within f.\n * @template T,S\n */\ngoog.array.forEach = goog.NATIVE_ARRAY_PROTOTYPES &&\n        (goog.array.ASSUME_NATIVE_FUNCTIONS || Array.prototype.forEach) ?\n    function(arr, f, opt_obj) {\n      goog.asserts.assert(arr.length != null);\n\n      Array.prototype.forEach.call(arr, f, opt_obj);\n    } :\n    function(arr, f, opt_obj) {\n      var l = arr.length;  // must be fixed during loop... see docs\n      var arr2 = goog.isString(arr) ? arr.split('') : arr;\n      for (var i = 0; i < l; i++) {\n        if (i in arr2) {\n          f.call(/** @type {?} */ (opt_obj), arr2[i], i, arr);\n        }\n      }\n    };\n\n\n/**\n * Calls a function for each element in an array, starting from the last\n * element rather than the first.\n *\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this: S, T, number, ?): ?} f The function to call for every\n *     element. This function\n *     takes 3 arguments (the element, the index and the array). The return\n *     value is ignored.\n * @param {S=} opt_obj The object to be used as the value of 'this'\n *     within f.\n * @template T,S\n */\ngoog.array.forEachRight = function(arr, f, opt_obj) {\n  var l = arr.length;  // must be fixed during loop... see docs\n  var arr2 = goog.isString(arr) ? arr.split('') : arr;\n  for (var i = l - 1; i >= 0; --i) {\n    if (i in arr2) {\n      f.call(/** @type {?} */ (opt_obj), arr2[i], i, arr);\n    }\n  }\n};\n\n\n/**\n * Calls a function for each element in an array, and if the function returns\n * true adds the element to a new array.\n *\n * See {@link http://tinyurl.com/developer-mozilla-org-array-filter}\n *\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, T, number, ?):boolean} f The function to call for\n *     every element. This function\n *     takes 3 arguments (the element, the index and the array) and must\n *     return a Boolean. If the return value is true the element is added to the\n *     result array. If it is false the element is not included.\n * @param {S=} opt_obj The object to be used as the value of 'this'\n *     within f.\n * @return {!Array<T>} a new array in which only elements that passed the test\n *     are present.\n * @template T,S\n */\ngoog.array.filter = goog.NATIVE_ARRAY_PROTOTYPES &&\n        (goog.array.ASSUME_NATIVE_FUNCTIONS || Array.prototype.filter) ?\n    function(arr, f, opt_obj) {\n      goog.asserts.assert(arr.length != null);\n\n      return Array.prototype.filter.call(arr, f, opt_obj);\n    } :\n    function(arr, f, opt_obj) {\n      var l = arr.length;  // must be fixed during loop... see docs\n      var res = [];\n      var resLength = 0;\n      var arr2 = goog.isString(arr) ? arr.split('') : arr;\n      for (var i = 0; i < l; i++) {\n        if (i in arr2) {\n          var val = arr2[i];  // in case f mutates arr2\n          if (f.call(/** @type {?} */ (opt_obj), val, i, arr)) {\n            res[resLength++] = val;\n          }\n        }\n      }\n      return res;\n    };\n\n\n/**\n * Calls a function for each element in an array and inserts the result into a\n * new array.\n *\n * See {@link http://tinyurl.com/developer-mozilla-org-array-map}\n *\n * @param {IArrayLike<VALUE>|string} arr Array or array like object\n *     over which to iterate.\n * @param {function(this:THIS, VALUE, number, ?): RESULT} f The function to call\n *     for every element. This function takes 3 arguments (the element,\n *     the index and the array) and should return something. The result will be\n *     inserted into a new array.\n * @param {THIS=} opt_obj The object to be used as the value of 'this' within f.\n * @return {!Array<RESULT>} a new array with the results from f.\n * @template THIS, VALUE, RESULT\n */\ngoog.array.map = goog.NATIVE_ARRAY_PROTOTYPES &&\n        (goog.array.ASSUME_NATIVE_FUNCTIONS || Array.prototype.map) ?\n    function(arr, f, opt_obj) {\n      goog.asserts.assert(arr.length != null);\n\n      return Array.prototype.map.call(arr, f, opt_obj);\n    } :\n    function(arr, f, opt_obj) {\n      var l = arr.length;  // must be fixed during loop... see docs\n      var res = new Array(l);\n      var arr2 = goog.isString(arr) ? arr.split('') : arr;\n      for (var i = 0; i < l; i++) {\n        if (i in arr2) {\n          res[i] = f.call(/** @type {?} */ (opt_obj), arr2[i], i, arr);\n        }\n      }\n      return res;\n    };\n\n\n/**\n * Passes every element of an array into a function and accumulates the result.\n *\n * See {@link http://tinyurl.com/developer-mozilla-org-array-reduce}\n *\n * For example:\n * var a = [1, 2, 3, 4];\n * goog.array.reduce(a, function(r, v, i, arr) {return r + v;}, 0);\n * returns 10\n *\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {function(this:S, R, T, number, ?) : R} f The function to call for\n *     every element. This function\n *     takes 4 arguments (the function's previous result or the initial value,\n *     the value of the current array element, the current array index, and the\n *     array itself)\n *     function(previousValue, currentValue, index, array).\n * @param {?} val The initial value to pass into the function on the first call.\n * @param {S=} opt_obj  The object to be used as the value of 'this'\n *     within f.\n * @return {R} Result of evaluating f repeatedly across the values of the array.\n * @template T,S,R\n */\ngoog.array.reduce = goog.NATIVE_ARRAY_PROTOTYPES &&\n        (goog.array.ASSUME_NATIVE_FUNCTIONS || Array.prototype.reduce) ?\n    function(arr, f, val, opt_obj) {\n      goog.asserts.assert(arr.length != null);\n      if (opt_obj) {\n        f = goog.bind(f, opt_obj);\n      }\n      return Array.prototype.reduce.call(arr, f, val);\n    } :\n    function(arr, f, val, opt_obj) {\n      var rval = val;\n      goog.array.forEach(arr, function(val, index) {\n        rval = f.call(/** @type {?} */ (opt_obj), rval, val, index, arr);\n      });\n      return rval;\n    };\n\n\n/**\n * Passes every element of an array into a function and accumulates the result,\n * starting from the last element and working towards the first.\n *\n * See {@link http://tinyurl.com/developer-mozilla-org-array-reduceright}\n *\n * For example:\n * var a = ['a', 'b', 'c'];\n * goog.array.reduceRight(a, function(r, v, i, arr) {return r + v;}, '');\n * returns 'cba'\n *\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, R, T, number, ?) : R} f The function to call for\n *     every element. This function\n *     takes 4 arguments (the function's previous result or the initial value,\n *     the value of the current array element, the current array index, and the\n *     array itself)\n *     function(previousValue, currentValue, index, array).\n * @param {?} val The initial value to pass into the function on the first call.\n * @param {S=} opt_obj The object to be used as the value of 'this'\n *     within f.\n * @return {R} Object returned as a result of evaluating f repeatedly across the\n *     values of the array.\n * @template T,S,R\n */\ngoog.array.reduceRight = goog.NATIVE_ARRAY_PROTOTYPES &&\n        (goog.array.ASSUME_NATIVE_FUNCTIONS || Array.prototype.reduceRight) ?\n    function(arr, f, val, opt_obj) {\n      goog.asserts.assert(arr.length != null);\n      goog.asserts.assert(f != null);\n      if (opt_obj) {\n        f = goog.bind(f, opt_obj);\n      }\n      return Array.prototype.reduceRight.call(arr, f, val);\n    } :\n    function(arr, f, val, opt_obj) {\n      var rval = val;\n      goog.array.forEachRight(arr, function(val, index) {\n        rval = f.call(/** @type {?} */ (opt_obj), rval, val, index, arr);\n      });\n      return rval;\n    };\n\n\n/**\n * Calls f for each element of an array. If any call returns true, some()\n * returns true (without checking the remaining elements). If all calls\n * return false, some() returns false.\n *\n * See {@link http://tinyurl.com/developer-mozilla-org-array-some}\n *\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, T, number, ?) : boolean} f The function to call for\n *     for every element. This function takes 3 arguments (the element, the\n *     index and the array) and should return a boolean.\n * @param {S=} opt_obj  The object to be used as the value of 'this'\n *     within f.\n * @return {boolean} true if any element passes the test.\n * @template T,S\n */\ngoog.array.some = goog.NATIVE_ARRAY_PROTOTYPES &&\n        (goog.array.ASSUME_NATIVE_FUNCTIONS || Array.prototype.some) ?\n    function(arr, f, opt_obj) {\n      goog.asserts.assert(arr.length != null);\n\n      return Array.prototype.some.call(arr, f, opt_obj);\n    } :\n    function(arr, f, opt_obj) {\n      var l = arr.length;  // must be fixed during loop... see docs\n      var arr2 = goog.isString(arr) ? arr.split('') : arr;\n      for (var i = 0; i < l; i++) {\n        if (i in arr2 && f.call(/** @type {?} */ (opt_obj), arr2[i], i, arr)) {\n          return true;\n        }\n      }\n      return false;\n    };\n\n\n/**\n * Call f for each element of an array. If all calls return true, every()\n * returns true. If any call returns false, every() returns false and\n * does not continue to check the remaining elements.\n *\n * See {@link http://tinyurl.com/developer-mozilla-org-array-every}\n *\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, T, number, ?) : boolean} f The function to call for\n *     for every element. This function takes 3 arguments (the element, the\n *     index and the array) and should return a boolean.\n * @param {S=} opt_obj The object to be used as the value of 'this'\n *     within f.\n * @return {boolean} false if any element fails the test.\n * @template T,S\n */\ngoog.array.every = goog.NATIVE_ARRAY_PROTOTYPES &&\n        (goog.array.ASSUME_NATIVE_FUNCTIONS || Array.prototype.every) ?\n    function(arr, f, opt_obj) {\n      goog.asserts.assert(arr.length != null);\n\n      return Array.prototype.every.call(arr, f, opt_obj);\n    } :\n    function(arr, f, opt_obj) {\n      var l = arr.length;  // must be fixed during loop... see docs\n      var arr2 = goog.isString(arr) ? arr.split('') : arr;\n      for (var i = 0; i < l; i++) {\n        if (i in arr2 && !f.call(/** @type {?} */ (opt_obj), arr2[i], i, arr)) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n\n/**\n * Counts the array elements that fulfill the predicate, i.e. for which the\n * callback function returns true. Skips holes in the array.\n *\n * @param {!IArrayLike<T>|string} arr Array or array like object\n *     over which to iterate.\n * @param {function(this: S, T, number, ?): boolean} f The function to call for\n *     every element. Takes 3 arguments (the element, the index and the array).\n * @param {S=} opt_obj The object to be used as the value of 'this' within f.\n * @return {number} The number of the matching elements.\n * @template T,S\n */\ngoog.array.count = function(arr, f, opt_obj) {\n  var count = 0;\n  goog.array.forEach(arr, function(element, index, arr) {\n    if (f.call(/** @type {?} */ (opt_obj), element, index, arr)) {\n      ++count;\n    }\n  }, opt_obj);\n  return count;\n};\n\n\n/**\n * Search an array for the first element that satisfies a given condition and\n * return that element.\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, T, number, ?) : boolean} f The function to call\n *     for every element. This function takes 3 arguments (the element, the\n *     index and the array) and should return a boolean.\n * @param {S=} opt_obj An optional \"this\" context for the function.\n * @return {T|null} The first array element that passes the test, or null if no\n *     element is found.\n * @template T,S\n */\ngoog.array.find = function(arr, f, opt_obj) {\n  var i = goog.array.findIndex(arr, f, opt_obj);\n  return i < 0 ? null : goog.isString(arr) ? arr.charAt(i) : arr[i];\n};\n\n\n/**\n * Search an array for the first element that satisfies a given condition and\n * return its index.\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, T, number, ?) : boolean} f The function to call for\n *     every element. This function\n *     takes 3 arguments (the element, the index and the array) and should\n *     return a boolean.\n * @param {S=} opt_obj An optional \"this\" context for the function.\n * @return {number} The index of the first array element that passes the test,\n *     or -1 if no element is found.\n * @template T,S\n */\ngoog.array.findIndex = function(arr, f, opt_obj) {\n  var l = arr.length;  // must be fixed during loop... see docs\n  var arr2 = goog.isString(arr) ? arr.split('') : arr;\n  for (var i = 0; i < l; i++) {\n    if (i in arr2 && f.call(/** @type {?} */ (opt_obj), arr2[i], i, arr)) {\n      return i;\n    }\n  }\n  return -1;\n};\n\n\n/**\n * Search an array (in reverse order) for the last element that satisfies a\n * given condition and return that element.\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, T, number, ?) : boolean} f The function to call\n *     for every element. This function\n *     takes 3 arguments (the element, the index and the array) and should\n *     return a boolean.\n * @param {S=} opt_obj An optional \"this\" context for the function.\n * @return {T|null} The last array element that passes the test, or null if no\n *     element is found.\n * @template T,S\n */\ngoog.array.findRight = function(arr, f, opt_obj) {\n  var i = goog.array.findIndexRight(arr, f, opt_obj);\n  return i < 0 ? null : goog.isString(arr) ? arr.charAt(i) : arr[i];\n};\n\n\n/**\n * Search an array (in reverse order) for the last element that satisfies a\n * given condition and return its index.\n * @param {IArrayLike<T>|string} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, T, number, ?) : boolean} f The function to call\n *     for every element. This function\n *     takes 3 arguments (the element, the index and the array) and should\n *     return a boolean.\n * @param {S=} opt_obj An optional \"this\" context for the function.\n * @return {number} The index of the last array element that passes the test,\n *     or -1 if no element is found.\n * @template T,S\n */\ngoog.array.findIndexRight = function(arr, f, opt_obj) {\n  var l = arr.length;  // must be fixed during loop... see docs\n  var arr2 = goog.isString(arr) ? arr.split('') : arr;\n  for (var i = l - 1; i >= 0; i--) {\n    if (i in arr2 && f.call(/** @type {?} */ (opt_obj), arr2[i], i, arr)) {\n      return i;\n    }\n  }\n  return -1;\n};\n\n\n/**\n * Whether the array contains the given object.\n * @param {IArrayLike<?>|string} arr The array to test for the presence of the\n *     element.\n * @param {*} obj The object for which to test.\n * @return {boolean} true if obj is present.\n */\ngoog.array.contains = function(arr, obj) {\n  return goog.array.indexOf(arr, obj) >= 0;\n};\n\n\n/**\n * Whether the array is empty.\n * @param {IArrayLike<?>|string} arr The array to test.\n * @return {boolean} true if empty.\n */\ngoog.array.isEmpty = function(arr) {\n  return arr.length == 0;\n};\n\n\n/**\n * Clears the array.\n * @param {IArrayLike<?>} arr Array or array like object to clear.\n */\ngoog.array.clear = function(arr) {\n  // For non real arrays we don't have the magic length so we delete the\n  // indices.\n  if (!goog.isArray(arr)) {\n    for (var i = arr.length - 1; i >= 0; i--) {\n      delete arr[i];\n    }\n  }\n  arr.length = 0;\n};\n\n\n/**\n * Pushes an item into an array, if it's not already in the array.\n * @param {Array<T>} arr Array into which to insert the item.\n * @param {T} obj Value to add.\n * @template T\n */\ngoog.array.insert = function(arr, obj) {\n  if (!goog.array.contains(arr, obj)) {\n    arr.push(obj);\n  }\n};\n\n\n/**\n * Inserts an object at the given index of the array.\n * @param {IArrayLike<?>} arr The array to modify.\n * @param {*} obj The object to insert.\n * @param {number=} opt_i The index at which to insert the object. If omitted,\n *      treated as 0. A negative index is counted from the end of the array.\n */\ngoog.array.insertAt = function(arr, obj, opt_i) {\n  goog.array.splice(arr, opt_i, 0, obj);\n};\n\n\n/**\n * Inserts at the given index of the array, all elements of another array.\n * @param {IArrayLike<?>} arr The array to modify.\n * @param {IArrayLike<?>} elementsToAdd The array of elements to add.\n * @param {number=} opt_i The index at which to insert the object. If omitted,\n *      treated as 0. A negative index is counted from the end of the array.\n */\ngoog.array.insertArrayAt = function(arr, elementsToAdd, opt_i) {\n  goog.partial(goog.array.splice, arr, opt_i, 0).apply(null, elementsToAdd);\n};\n\n\n/**\n * Inserts an object into an array before a specified object.\n * @param {Array<T>} arr The array to modify.\n * @param {T} obj The object to insert.\n * @param {T=} opt_obj2 The object before which obj should be inserted. If obj2\n *     is omitted or not found, obj is inserted at the end of the array.\n * @template T\n */\ngoog.array.insertBefore = function(arr, obj, opt_obj2) {\n  var i;\n  if (arguments.length == 2 || (i = goog.array.indexOf(arr, opt_obj2)) < 0) {\n    arr.push(obj);\n  } else {\n    goog.array.insertAt(arr, obj, i);\n  }\n};\n\n\n/**\n * Removes the first occurrence of a particular value from an array.\n * @param {IArrayLike<T>} arr Array from which to remove\n *     value.\n * @param {T} obj Object to remove.\n * @return {boolean} True if an element was removed.\n * @template T\n */\ngoog.array.remove = function(arr, obj) {\n  var i = goog.array.indexOf(arr, obj);\n  var rv;\n  if ((rv = i >= 0)) {\n    goog.array.removeAt(arr, i);\n  }\n  return rv;\n};\n\n\n/**\n * Removes the last occurrence of a particular value from an array.\n * @param {!IArrayLike<T>} arr Array from which to remove value.\n * @param {T} obj Object to remove.\n * @return {boolean} True if an element was removed.\n * @template T\n */\ngoog.array.removeLast = function(arr, obj) {\n  var i = goog.array.lastIndexOf(arr, obj);\n  if (i >= 0) {\n    goog.array.removeAt(arr, i);\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * Removes from an array the element at index i\n * @param {IArrayLike<?>} arr Array or array like object from which to\n *     remove value.\n * @param {number} i The index to remove.\n * @return {boolean} True if an element was removed.\n */\ngoog.array.removeAt = function(arr, i) {\n  goog.asserts.assert(arr.length != null);\n\n  // use generic form of splice\n  // splice returns the removed items and if successful the length of that\n  // will be 1\n  return Array.prototype.splice.call(arr, i, 1).length == 1;\n};\n\n\n/**\n * Removes the first value that satisfies the given condition.\n * @param {IArrayLike<T>} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, T, number, ?) : boolean} f The function to call\n *     for every element. This function\n *     takes 3 arguments (the element, the index and the array) and should\n *     return a boolean.\n * @param {S=} opt_obj An optional \"this\" context for the function.\n * @return {boolean} True if an element was removed.\n * @template T,S\n */\ngoog.array.removeIf = function(arr, f, opt_obj) {\n  var i = goog.array.findIndex(arr, f, opt_obj);\n  if (i >= 0) {\n    goog.array.removeAt(arr, i);\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * Removes all values that satisfy the given condition.\n * @param {IArrayLike<T>} arr Array or array\n *     like object over which to iterate.\n * @param {?function(this:S, T, number, ?) : boolean} f The function to call\n *     for every element. This function\n *     takes 3 arguments (the element, the index and the array) and should\n *     return a boolean.\n * @param {S=} opt_obj An optional \"this\" context for the function.\n * @return {number} The number of items removed\n * @template T,S\n */\ngoog.array.removeAllIf = function(arr, f, opt_obj) {\n  var removedCount = 0;\n  goog.array.forEachRight(arr, function(val, index) {\n    if (f.call(/** @type {?} */ (opt_obj), val, index, arr)) {\n      if (goog.array.removeAt(arr, index)) {\n        removedCount++;\n      }\n    }\n  });\n  return removedCount;\n};\n\n\n/**\n * Returns a new array that is the result of joining the arguments.  If arrays\n * are passed then their items are added, however, if non-arrays are passed they\n * will be added to the return array as is.\n *\n * Note that ArrayLike objects will be added as is, rather than having their\n * items added.\n *\n * goog.array.concat([1, 2], [3, 4]) -> [1, 2, 3, 4]\n * goog.array.concat(0, [1, 2]) -> [0, 1, 2]\n * goog.array.concat([1, 2], null) -> [1, 2, null]\n *\n * There is bug in all current versions of IE (6, 7 and 8) where arrays created\n * in an iframe become corrupted soon (not immediately) after the iframe is\n * destroyed. This is common if loading data via goog.net.IframeIo, for example.\n * This corruption only affects the concat method which will start throwing\n * Catastrophic Errors (#-2147418113).\n *\n * See http://endoflow.com/scratch/corrupted-arrays.html for a test case.\n *\n * Internally goog.array should use this, so that all methods will continue to\n * work on these broken array objects.\n *\n * @param {...*} var_args Items to concatenate.  Arrays will have each item\n *     added, while primitives and objects will be added as is.\n * @return {!Array<?>} The new resultant array.\n */\ngoog.array.concat = function(var_args) {\n  return Array.prototype.concat.apply([], arguments);\n};\n\n\n/**\n * Returns a new array that contains the contents of all the arrays passed.\n * @param {...!Array<T>} var_args\n * @return {!Array<T>}\n * @template T\n */\ngoog.array.join = function(var_args) {\n  return Array.prototype.concat.apply([], arguments);\n};\n\n\n/**\n * Converts an object to an array.\n * @param {IArrayLike<T>|string} object  The object to convert to an\n *     array.\n * @return {!Array<T>} The object converted into an array. If object has a\n *     length property, every property indexed with a non-negative number\n *     less than length will be included in the result. If object does not\n *     have a length property, an empty array will be returned.\n * @template T\n */\ngoog.array.toArray = function(object) {\n  var length = object.length;\n\n  // If length is not a number the following is false. This case is kept for\n  // backwards compatibility since there are callers that pass objects that are\n  // not array like.\n  if (length > 0) {\n    var rv = new Array(length);\n    for (var i = 0; i < length; i++) {\n      rv[i] = object[i];\n    }\n    return rv;\n  }\n  return [];\n};\n\n\n/**\n * Does a shallow copy of an array.\n * @param {IArrayLike<T>|string} arr  Array or array-like object to\n *     clone.\n * @return {!Array<T>} Clone of the input array.\n * @template T\n */\ngoog.array.clone = goog.array.toArray;\n\n\n/**\n * Extends an array with another array, element, or \"array like\" object.\n * This function operates 'in-place', it does not create a new Array.\n *\n * Example:\n * var a = [];\n * goog.array.extend(a, [0, 1]);\n * a; // [0, 1]\n * goog.array.extend(a, 2);\n * a; // [0, 1, 2]\n *\n * @param {Array<VALUE>} arr1  The array to modify.\n * @param {...(IArrayLike<VALUE>|VALUE)} var_args The elements or arrays of\n *     elements to add to arr1.\n * @template VALUE\n */\ngoog.array.extend = function(arr1, var_args) {\n  for (var i = 1; i < arguments.length; i++) {\n    var arr2 = arguments[i];\n    if (goog.isArrayLike(arr2)) {\n      var len1 = arr1.length || 0;\n      var len2 = arr2.length || 0;\n      arr1.length = len1 + len2;\n      for (var j = 0; j < len2; j++) {\n        arr1[len1 + j] = arr2[j];\n      }\n    } else {\n      arr1.push(arr2);\n    }\n  }\n};\n\n\n/**\n * Adds or removes elements from an array. This is a generic version of Array\n * splice. This means that it might work on other objects similar to arrays,\n * such as the arguments object.\n *\n * @param {IArrayLike<T>} arr The array to modify.\n * @param {number|undefined} index The index at which to start changing the\n *     array. If not defined, treated as 0.\n * @param {number} howMany How many elements to remove (0 means no removal. A\n *     value below 0 is treated as zero and so is any other non number. Numbers\n *     are floored).\n * @param {...T} var_args Optional, additional elements to insert into the\n *     array.\n * @return {!Array<T>} the removed elements.\n * @template T\n */\ngoog.array.splice = function(arr, index, howMany, var_args) {\n  goog.asserts.assert(arr.length != null);\n\n  return Array.prototype.splice.apply(arr, goog.array.slice(arguments, 1));\n};\n\n\n/**\n * Returns a new array from a segment of an array. This is a generic version of\n * Array slice. This means that it might work on other objects similar to\n * arrays, such as the arguments object.\n *\n * @param {IArrayLike<T>|string} arr The array from\n * which to copy a segment.\n * @param {number} start The index of the first element to copy.\n * @param {number=} opt_end The index after the last element to copy.\n * @return {!Array<T>} A new array containing the specified segment of the\n *     original array.\n * @template T\n */\ngoog.array.slice = function(arr, start, opt_end) {\n  goog.asserts.assert(arr.length != null);\n\n  // passing 1 arg to slice is not the same as passing 2 where the second is\n  // null or undefined (in that case the second argument is treated as 0).\n  // we could use slice on the arguments object and then use apply instead of\n  // testing the length\n  if (arguments.length <= 2) {\n    return Array.prototype.slice.call(arr, start);\n  } else {\n    return Array.prototype.slice.call(arr, start, opt_end);\n  }\n};\n\n\n/**\n * Removes all duplicates from an array (retaining only the first\n * occurrence of each array element).  This function modifies the\n * array in place and doesn't change the order of the non-duplicate items.\n *\n * For objects, duplicates are identified as having the same unique ID as\n * defined by {@link goog.getUid}.\n *\n * Alternatively you can specify a custom hash function that returns a unique\n * value for each item in the array it should consider unique.\n *\n * Runtime: N,\n * Worstcase space: 2N (no dupes)\n *\n * @param {IArrayLike<T>} arr The array from which to remove\n *     duplicates.\n * @param {Array=} opt_rv An optional array in which to return the results,\n *     instead of performing the removal inplace.  If specified, the original\n *     array will remain unchanged.\n * @param {function(T):string=} opt_hashFn An optional function to use to\n *     apply to every item in the array. This function should return a unique\n *     value for each item in the array it should consider unique.\n * @template T\n */\ngoog.array.removeDuplicates = function(arr, opt_rv, opt_hashFn) {\n  var returnArray = opt_rv || arr;\n  var defaultHashFn = function(item) {\n    // Prefix each type with a single character representing the type to\n    // prevent conflicting keys (e.g. true and 'true').\n    return goog.isObject(item) ? 'o' + goog.getUid(item) :\n                                 (typeof item).charAt(0) + item;\n  };\n  var hashFn = opt_hashFn || defaultHashFn;\n\n  var seen = {}, cursorInsert = 0, cursorRead = 0;\n  while (cursorRead < arr.length) {\n    var current = arr[cursorRead++];\n    var key = hashFn(current);\n    if (!Object.prototype.hasOwnProperty.call(seen, key)) {\n      seen[key] = true;\n      returnArray[cursorInsert++] = current;\n    }\n  }\n  returnArray.length = cursorInsert;\n};\n\n\n/**\n * Searches the specified array for the specified target using the binary\n * search algorithm.  If no opt_compareFn is specified, elements are compared\n * using <code>goog.array.defaultCompare</code>, which compares the elements\n * using the built in < and > operators.  This will produce the expected\n * behavior for homogeneous arrays of String(s) and Number(s). The array\n * specified <b>must</b> be sorted in ascending order (as defined by the\n * comparison function).  If the array is not sorted, results are undefined.\n * If the array contains multiple instances of the specified target value, any\n * of these instances may be found.\n *\n * Runtime: O(log n)\n *\n * @param {IArrayLike<VALUE>} arr The array to be searched.\n * @param {TARGET} target The sought value.\n * @param {function(TARGET, VALUE): number=} opt_compareFn Optional comparison\n *     function by which the array is ordered. Should take 2 arguments to\n *     compare, the target value and an element from your array, and return a\n *     negative number, zero, or a positive number depending on whether the\n *     first argument is less than, equal to, or greater than the second.\n * @return {number} Lowest index of the target value if found, otherwise\n *     (-(insertion point) - 1). The insertion point is where the value should\n *     be inserted into arr to preserve the sorted property.  Return value >= 0\n *     iff target is found.\n * @template TARGET, VALUE\n */\ngoog.array.binarySearch = function(arr, target, opt_compareFn) {\n  return goog.array.binarySearch_(\n      arr, opt_compareFn || goog.array.defaultCompare, false /* isEvaluator */,\n      target);\n};\n\n\n/**\n * Selects an index in the specified array using the binary search algorithm.\n * The evaluator receives an element and determines whether the desired index\n * is before, at, or after it.  The evaluator must be consistent (formally,\n * goog.array.map(goog.array.map(arr, evaluator, opt_obj), goog.math.sign)\n * must be monotonically non-increasing).\n *\n * Runtime: O(log n)\n *\n * @param {IArrayLike<VALUE>} arr The array to be searched.\n * @param {function(this:THIS, VALUE, number, ?): number} evaluator\n *     Evaluator function that receives 3 arguments (the element, the index and\n *     the array). Should return a negative number, zero, or a positive number\n *     depending on whether the desired index is before, at, or after the\n *     element passed to it.\n * @param {THIS=} opt_obj The object to be used as the value of 'this'\n *     within evaluator.\n * @return {number} Index of the leftmost element matched by the evaluator, if\n *     such exists; otherwise (-(insertion point) - 1). The insertion point is\n *     the index of the first element for which the evaluator returns negative,\n *     or arr.length if no such element exists. The return value is non-negative\n *     iff a match is found.\n * @template THIS, VALUE\n */\ngoog.array.binarySelect = function(arr, evaluator, opt_obj) {\n  return goog.array.binarySearch_(\n      arr, evaluator, true /* isEvaluator */, undefined /* opt_target */,\n      opt_obj);\n};\n\n\n/**\n * Implementation of a binary search algorithm which knows how to use both\n * comparison functions and evaluators. If an evaluator is provided, will call\n * the evaluator with the given optional data object, conforming to the\n * interface defined in binarySelect. Otherwise, if a comparison function is\n * provided, will call the comparison function against the given data object.\n *\n * This implementation purposefully does not use goog.bind or goog.partial for\n * performance reasons.\n *\n * Runtime: O(log n)\n *\n * @param {IArrayLike<?>} arr The array to be searched.\n * @param {function(?, ?, ?): number | function(?, ?): number} compareFn\n *     Either an evaluator or a comparison function, as defined by binarySearch\n *     and binarySelect above.\n * @param {boolean} isEvaluator Whether the function is an evaluator or a\n *     comparison function.\n * @param {?=} opt_target If the function is a comparison function, then\n *     this is the target to binary search for.\n * @param {Object=} opt_selfObj If the function is an evaluator, this is an\n *     optional this object for the evaluator.\n * @return {number} Lowest index of the target value if found, otherwise\n *     (-(insertion point) - 1). The insertion point is where the value should\n *     be inserted into arr to preserve the sorted property.  Return value >= 0\n *     iff target is found.\n * @private\n */\ngoog.array.binarySearch_ = function(\n    arr, compareFn, isEvaluator, opt_target, opt_selfObj) {\n  var left = 0;            // inclusive\n  var right = arr.length;  // exclusive\n  var found;\n  while (left < right) {\n    var middle = (left + right) >> 1;\n    var compareResult;\n    if (isEvaluator) {\n      compareResult = compareFn.call(opt_selfObj, arr[middle], middle, arr);\n    } else {\n      // NOTE(dimvar): To avoid this cast, we'd have to use function overloading\n      // for the type of binarySearch_, which the type system can't express yet.\n      compareResult = /** @type {function(?, ?): number} */ (compareFn)(\n          opt_target, arr[middle]);\n    }\n    if (compareResult > 0) {\n      left = middle + 1;\n    } else {\n      right = middle;\n      // We are looking for the lowest index so we can't return immediately.\n      found = !compareResult;\n    }\n  }\n  // left is the index if found, or the insertion point otherwise.\n  // ~left is a shorthand for -left - 1.\n  return found ? left : ~left;\n};\n\n\n/**\n * Sorts the specified array into ascending order.  If no opt_compareFn is\n * specified, elements are compared using\n * <code>goog.array.defaultCompare</code>, which compares the elements using\n * the built in < and > operators.  This will produce the expected behavior\n * for homogeneous arrays of String(s) and Number(s), unlike the native sort,\n * but will give unpredictable results for heterogeneous lists of strings and\n * numbers with different numbers of digits.\n *\n * This sort is not guaranteed to be stable.\n *\n * Runtime: Same as <code>Array.prototype.sort</code>\n *\n * @param {Array<T>} arr The array to be sorted.\n * @param {?function(T,T):number=} opt_compareFn Optional comparison\n *     function by which the\n *     array is to be ordered. Should take 2 arguments to compare, and return a\n *     negative number, zero, or a positive number depending on whether the\n *     first argument is less than, equal to, or greater than the second.\n * @template T\n */\ngoog.array.sort = function(arr, opt_compareFn) {\n  // TODO(arv): Update type annotation since null is not accepted.\n  arr.sort(opt_compareFn || goog.array.defaultCompare);\n};\n\n\n/**\n * Sorts the specified array into ascending order in a stable way.  If no\n * opt_compareFn is specified, elements are compared using\n * <code>goog.array.defaultCompare</code>, which compares the elements using\n * the built in < and > operators.  This will produce the expected behavior\n * for homogeneous arrays of String(s) and Number(s).\n *\n * Runtime: Same as <code>Array.prototype.sort</code>, plus an additional\n * O(n) overhead of copying the array twice.\n *\n * @param {Array<T>} arr The array to be sorted.\n * @param {?function(T, T): number=} opt_compareFn Optional comparison function\n *     by which the array is to be ordered. Should take 2 arguments to compare,\n *     and return a negative number, zero, or a positive number depending on\n *     whether the first argument is less than, equal to, or greater than the\n *     second.\n * @template T\n */\ngoog.array.stableSort = function(arr, opt_compareFn) {\n  var compArr = new Array(arr.length);\n  for (var i = 0; i < arr.length; i++) {\n    compArr[i] = {index: i, value: arr[i]};\n  }\n  var valueCompareFn = opt_compareFn || goog.array.defaultCompare;\n  function stableCompareFn(obj1, obj2) {\n    return valueCompareFn(obj1.value, obj2.value) || obj1.index - obj2.index;\n  }\n  goog.array.sort(compArr, stableCompareFn);\n  for (var i = 0; i < arr.length; i++) {\n    arr[i] = compArr[i].value;\n  }\n};\n\n\n/**\n * Sort the specified array into ascending order based on item keys\n * returned by the specified key function.\n * If no opt_compareFn is specified, the keys are compared in ascending order\n * using <code>goog.array.defaultCompare</code>.\n *\n * Runtime: O(S(f(n)), where S is runtime of <code>goog.array.sort</code>\n * and f(n) is runtime of the key function.\n *\n * @param {Array<T>} arr The array to be sorted.\n * @param {function(T): K} keyFn Function taking array element and returning\n *     a key used for sorting this element.\n * @param {?function(K, K): number=} opt_compareFn Optional comparison function\n *     by which the keys are to be ordered. Should take 2 arguments to compare,\n *     and return a negative number, zero, or a positive number depending on\n *     whether the first argument is less than, equal to, or greater than the\n *     second.\n * @template T,K\n */\ngoog.array.sortByKey = function(arr, keyFn, opt_compareFn) {\n  var keyCompareFn = opt_compareFn || goog.array.defaultCompare;\n  goog.array.sort(\n      arr, function(a, b) { return keyCompareFn(keyFn(a), keyFn(b)); });\n};\n\n\n/**\n * Sorts an array of objects by the specified object key and compare\n * function. If no compare function is provided, the key values are\n * compared in ascending order using <code>goog.array.defaultCompare</code>.\n * This won't work for keys that get renamed by the compiler. So use\n * {'foo': 1, 'bar': 2} rather than {foo: 1, bar: 2}.\n * @param {Array<Object>} arr An array of objects to sort.\n * @param {string} key The object key to sort by.\n * @param {Function=} opt_compareFn The function to use to compare key\n *     values.\n */\ngoog.array.sortObjectsByKey = function(arr, key, opt_compareFn) {\n  goog.array.sortByKey(arr, function(obj) { return obj[key]; }, opt_compareFn);\n};\n\n\n/**\n * Tells if the array is sorted.\n * @param {!IArrayLike<T>} arr The array.\n * @param {?function(T,T):number=} opt_compareFn Function to compare the\n *     array elements.\n *     Should take 2 arguments to compare, and return a negative number, zero,\n *     or a positive number depending on whether the first argument is less\n *     than, equal to, or greater than the second.\n * @param {boolean=} opt_strict If true no equal elements are allowed.\n * @return {boolean} Whether the array is sorted.\n * @template T\n */\ngoog.array.isSorted = function(arr, opt_compareFn, opt_strict) {\n  var compare = opt_compareFn || goog.array.defaultCompare;\n  for (var i = 1; i < arr.length; i++) {\n    var compareResult = compare(arr[i - 1], arr[i]);\n    if (compareResult > 0 || compareResult == 0 && opt_strict) {\n      return false;\n    }\n  }\n  return true;\n};\n\n\n/**\n * Compares two arrays for equality. Two arrays are considered equal if they\n * have the same length and their corresponding elements are equal according to\n * the comparison function.\n *\n * @param {IArrayLike<?>} arr1 The first array to compare.\n * @param {IArrayLike<?>} arr2 The second array to compare.\n * @param {Function=} opt_equalsFn Optional comparison function.\n *     Should take 2 arguments to compare, and return true if the arguments\n *     are equal. Defaults to {@link goog.array.defaultCompareEquality} which\n *     compares the elements using the built-in '===' operator.\n * @return {boolean} Whether the two arrays are equal.\n */\ngoog.array.equals = function(arr1, arr2, opt_equalsFn) {\n  if (!goog.isArrayLike(arr1) || !goog.isArrayLike(arr2) ||\n      arr1.length != arr2.length) {\n    return false;\n  }\n  var l = arr1.length;\n  var equalsFn = opt_equalsFn || goog.array.defaultCompareEquality;\n  for (var i = 0; i < l; i++) {\n    if (!equalsFn(arr1[i], arr2[i])) {\n      return false;\n    }\n  }\n  return true;\n};\n\n\n/**\n * 3-way array compare function.\n * @param {!IArrayLike<VALUE>} arr1 The first array to\n *     compare.\n * @param {!IArrayLike<VALUE>} arr2 The second array to\n *     compare.\n * @param {function(VALUE, VALUE): number=} opt_compareFn Optional comparison\n *     function by which the array is to be ordered. Should take 2 arguments to\n *     compare, and return a negative number, zero, or a positive number\n *     depending on whether the first argument is less than, equal to, or\n *     greater than the second.\n * @return {number} Negative number, zero, or a positive number depending on\n *     whether the first argument is less than, equal to, or greater than the\n *     second.\n * @template VALUE\n */\ngoog.array.compare3 = function(arr1, arr2, opt_compareFn) {\n  var compare = opt_compareFn || goog.array.defaultCompare;\n  var l = Math.min(arr1.length, arr2.length);\n  for (var i = 0; i < l; i++) {\n    var result = compare(arr1[i], arr2[i]);\n    if (result != 0) {\n      return result;\n    }\n  }\n  return goog.array.defaultCompare(arr1.length, arr2.length);\n};\n\n\n/**\n * Compares its two arguments for order, using the built in < and >\n * operators.\n * @param {VALUE} a The first object to be compared.\n * @param {VALUE} b The second object to be compared.\n * @return {number} A negative number, zero, or a positive number as the first\n *     argument is less than, equal to, or greater than the second,\n *     respectively.\n * @template VALUE\n */\ngoog.array.defaultCompare = function(a, b) {\n  return a > b ? 1 : a < b ? -1 : 0;\n};\n\n\n/**\n * Compares its two arguments for inverse order, using the built in < and >\n * operators.\n * @param {VALUE} a The first object to be compared.\n * @param {VALUE} b The second object to be compared.\n * @return {number} A negative number, zero, or a positive number as the first\n *     argument is greater than, equal to, or less than the second,\n *     respectively.\n * @template VALUE\n */\ngoog.array.inverseDefaultCompare = function(a, b) {\n  return -goog.array.defaultCompare(a, b);\n};\n\n\n/**\n * Compares its two arguments for equality, using the built in === operator.\n * @param {*} a The first object to compare.\n * @param {*} b The second object to compare.\n * @return {boolean} True if the two arguments are equal, false otherwise.\n */\ngoog.array.defaultCompareEquality = function(a, b) {\n  return a === b;\n};\n\n\n/**\n * Inserts a value into a sorted array. The array is not modified if the\n * value is already present.\n * @param {IArrayLike<VALUE>} array The array to modify.\n * @param {VALUE} value The object to insert.\n * @param {function(VALUE, VALUE): number=} opt_compareFn Optional comparison\n *     function by which the array is ordered. Should take 2 arguments to\n *     compare, and return a negative number, zero, or a positive number\n *     depending on whether the first argument is less than, equal to, or\n *     greater than the second.\n * @return {boolean} True if an element was inserted.\n * @template VALUE\n */\ngoog.array.binaryInsert = function(array, value, opt_compareFn) {\n  var index = goog.array.binarySearch(array, value, opt_compareFn);\n  if (index < 0) {\n    goog.array.insertAt(array, value, -(index + 1));\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * Removes a value from a sorted array.\n * @param {!IArrayLike<VALUE>} array The array to modify.\n * @param {VALUE} value The object to remove.\n * @param {function(VALUE, VALUE): number=} opt_compareFn Optional comparison\n *     function by which the array is ordered. Should take 2 arguments to\n *     compare, and return a negative number, zero, or a positive number\n *     depending on whether the first argument is less than, equal to, or\n *     greater than the second.\n * @return {boolean} True if an element was removed.\n * @template VALUE\n */\ngoog.array.binaryRemove = function(array, value, opt_compareFn) {\n  var index = goog.array.binarySearch(array, value, opt_compareFn);\n  return (index >= 0) ? goog.array.removeAt(array, index) : false;\n};\n\n\n/**\n * Splits an array into disjoint buckets according to a splitting function.\n * @param {IArrayLike<T>} array The array.\n * @param {function(this:S, T, number, !IArrayLike<T>):?} sorter Function to\n *     call for every element.  This takes 3 arguments (the element, the index\n *     and the array) and must return a valid object key (a string, number,\n *     etc), or undefined, if that object should not be placed in a bucket.\n * @param {S=} opt_obj The object to be used as the value of 'this' within\n *     sorter.\n * @return {!Object<!Array<T>>} An object, with keys being all of the unique\n *     return values of sorter, and values being arrays containing the items for\n *     which the splitter returned that key.\n * @template T,S\n */\ngoog.array.bucket = function(array, sorter, opt_obj) {\n  var buckets = {};\n\n  for (var i = 0; i < array.length; i++) {\n    var value = array[i];\n    var key = sorter.call(/** @type {?} */ (opt_obj), value, i, array);\n    if (goog.isDef(key)) {\n      // Push the value to the right bucket, creating it if necessary.\n      var bucket = buckets[key] || (buckets[key] = []);\n      bucket.push(value);\n    }\n  }\n\n  return buckets;\n};\n\n\n/**\n * Creates a new object built from the provided array and the key-generation\n * function.\n * @param {IArrayLike<T>} arr Array or array like object over\n *     which to iterate whose elements will be the values in the new object.\n * @param {?function(this:S, T, number, ?) : string} keyFunc The function to\n *     call for every element. This function takes 3 arguments (the element, the\n *     index and the array) and should return a string that will be used as the\n *     key for the element in the new object. If the function returns the same\n *     key for more than one element, the value for that key is\n *     implementation-defined.\n * @param {S=} opt_obj The object to be used as the value of 'this'\n *     within keyFunc.\n * @return {!Object<T>} The new object.\n * @template T,S\n */\ngoog.array.toObject = function(arr, keyFunc, opt_obj) {\n  var ret = {};\n  goog.array.forEach(arr, function(element, index) {\n    ret[keyFunc.call(/** @type {?} */ (opt_obj), element, index, arr)] =\n        element;\n  });\n  return ret;\n};\n\n\n/**\n * Creates a range of numbers in an arithmetic progression.\n *\n * Range takes 1, 2, or 3 arguments:\n * <pre>\n * range(5) is the same as range(0, 5, 1) and produces [0, 1, 2, 3, 4]\n * range(2, 5) is the same as range(2, 5, 1) and produces [2, 3, 4]\n * range(-2, -5, -1) produces [-2, -3, -4]\n * range(-2, -5, 1) produces [], since stepping by 1 wouldn't ever reach -5.\n * </pre>\n *\n * @param {number} startOrEnd The starting value of the range if an end argument\n *     is provided. Otherwise, the start value is 0, and this is the end value.\n * @param {number=} opt_end The optional end value of the range.\n * @param {number=} opt_step The step size between range values. Defaults to 1\n *     if opt_step is undefined or 0.\n * @return {!Array<number>} An array of numbers for the requested range. May be\n *     an empty array if adding the step would not converge toward the end\n *     value.\n */\ngoog.array.range = function(startOrEnd, opt_end, opt_step) {\n  var array = [];\n  var start = 0;\n  var end = startOrEnd;\n  var step = opt_step || 1;\n  if (opt_end !== undefined) {\n    start = startOrEnd;\n    end = opt_end;\n  }\n\n  if (step * (end - start) < 0) {\n    // Sign mismatch: start + step will never reach the end value.\n    return [];\n  }\n\n  if (step > 0) {\n    for (var i = start; i < end; i += step) {\n      array.push(i);\n    }\n  } else {\n    for (var i = start; i > end; i += step) {\n      array.push(i);\n    }\n  }\n  return array;\n};\n\n\n/**\n * Returns an array consisting of the given value repeated N times.\n *\n * @param {VALUE} value The value to repeat.\n * @param {number} n The repeat count.\n * @return {!Array<VALUE>} An array with the repeated value.\n * @template VALUE\n */\ngoog.array.repeat = function(value, n) {\n  var array = [];\n  for (var i = 0; i < n; i++) {\n    array[i] = value;\n  }\n  return array;\n};\n\n\n/**\n * Returns an array consisting of every argument with all arrays\n * expanded in-place recursively.\n *\n * @param {...*} var_args The values to flatten.\n * @return {!Array<?>} An array containing the flattened values.\n */\ngoog.array.flatten = function(var_args) {\n  var CHUNK_SIZE = 8192;\n\n  var result = [];\n  for (var i = 0; i < arguments.length; i++) {\n    var element = arguments[i];\n    if (goog.isArray(element)) {\n      for (var c = 0; c < element.length; c += CHUNK_SIZE) {\n        var chunk = goog.array.slice(element, c, c + CHUNK_SIZE);\n        var recurseResult = goog.array.flatten.apply(null, chunk);\n        for (var r = 0; r < recurseResult.length; r++) {\n          result.push(recurseResult[r]);\n        }\n      }\n    } else {\n      result.push(element);\n    }\n  }\n  return result;\n};\n\n\n/**\n * Rotates an array in-place. After calling this method, the element at\n * index i will be the element previously at index (i - n) %\n * array.length, for all values of i between 0 and array.length - 1,\n * inclusive.\n *\n * For example, suppose list comprises [t, a, n, k, s]. After invoking\n * rotate(array, 1) (or rotate(array, -4)), array will comprise [s, t, a, n, k].\n *\n * @param {!Array<T>} array The array to rotate.\n * @param {number} n The amount to rotate.\n * @return {!Array<T>} The array.\n * @template T\n */\ngoog.array.rotate = function(array, n) {\n  goog.asserts.assert(array.length != null);\n\n  if (array.length) {\n    n %= array.length;\n    if (n > 0) {\n      Array.prototype.unshift.apply(array, array.splice(-n, n));\n    } else if (n < 0) {\n      Array.prototype.push.apply(array, array.splice(0, -n));\n    }\n  }\n  return array;\n};\n\n\n/**\n * Moves one item of an array to a new position keeping the order of the rest\n * of the items. Example use case: keeping a list of JavaScript objects\n * synchronized with the corresponding list of DOM elements after one of the\n * elements has been dragged to a new position.\n * @param {!IArrayLike<?>} arr The array to modify.\n * @param {number} fromIndex Index of the item to move between 0 and\n *     {@code arr.length - 1}.\n * @param {number} toIndex Target index between 0 and {@code arr.length - 1}.\n */\ngoog.array.moveItem = function(arr, fromIndex, toIndex) {\n  goog.asserts.assert(fromIndex >= 0 && fromIndex < arr.length);\n  goog.asserts.assert(toIndex >= 0 && toIndex < arr.length);\n  // Remove 1 item at fromIndex.\n  var removedItems = Array.prototype.splice.call(arr, fromIndex, 1);\n  // Insert the removed item at toIndex.\n  Array.prototype.splice.call(arr, toIndex, 0, removedItems[0]);\n  // We don't use goog.array.insertAt and goog.array.removeAt, because they're\n  // significantly slower than splice.\n};\n\n\n/**\n * Creates a new array for which the element at position i is an array of the\n * ith element of the provided arrays.  The returned array will only be as long\n * as the shortest array provided; additional values are ignored.  For example,\n * the result of zipping [1, 2] and [3, 4, 5] is [[1,3], [2, 4]].\n *\n * This is similar to the zip() function in Python.  See {@link\n * http://docs.python.org/library/functions.html#zip}\n *\n * @param {...!IArrayLike<?>} var_args Arrays to be combined.\n * @return {!Array<!Array<?>>} A new array of arrays created from\n *     provided arrays.\n */\ngoog.array.zip = function(var_args) {\n  if (!arguments.length) {\n    return [];\n  }\n  var result = [];\n  var minLen = arguments[0].length;\n  for (var i = 1; i < arguments.length; i++) {\n    if (arguments[i].length < minLen) {\n      minLen = arguments[i].length;\n    }\n  }\n  for (var i = 0; i < minLen; i++) {\n    var value = [];\n    for (var j = 0; j < arguments.length; j++) {\n      value.push(arguments[j][i]);\n    }\n    result.push(value);\n  }\n  return result;\n};\n\n\n/**\n * Shuffles the values in the specified array using the Fisher-Yates in-place\n * shuffle (also known as the Knuth Shuffle). By default, calls Math.random()\n * and so resets the state of that random number generator. Similarly, may reset\n * the state of any other specified random number generator.\n *\n * Runtime: O(n)\n *\n * @param {!Array<?>} arr The array to be shuffled.\n * @param {function():number=} opt_randFn Optional random function to use for\n *     shuffling.\n *     Takes no arguments, and returns a random number on the interval [0, 1).\n *     Defaults to Math.random() using JavaScript's built-in Math library.\n */\ngoog.array.shuffle = function(arr, opt_randFn) {\n  var randFn = opt_randFn || Math.random;\n\n  for (var i = arr.length - 1; i > 0; i--) {\n    // Choose a random array index in [0, i] (inclusive with i).\n    var j = Math.floor(randFn() * (i + 1));\n\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n  }\n};\n\n\n/**\n * Returns a new array of elements from arr, based on the indexes of elements\n * provided by index_arr. For example, the result of index copying\n * ['a', 'b', 'c'] with index_arr [1,0,0,2] is ['b', 'a', 'a', 'c'].\n *\n * @param {!IArrayLike<T>} arr The array to get a indexed copy from.\n * @param {!IArrayLike<number>} index_arr An array of indexes to get from arr.\n * @return {!Array<T>} A new array of elements from arr in index_arr order.\n * @template T\n */\ngoog.array.copyByIndex = function(arr, index_arr) {\n  var result = [];\n  goog.array.forEach(index_arr, function(index) { result.push(arr[index]); });\n  return result;\n};\n\n\n/**\n * Maps each element of the input array into zero or more elements of the output\n * array.\n *\n * @param {!IArrayLike<VALUE>|string} arr Array or array like object\n *     over which to iterate.\n * @param {function(this:THIS, VALUE, number, ?): !Array<RESULT>} f The function\n *     to call for every element. This function takes 3 arguments (the element,\n *     the index and the array) and should return an array. The result will be\n *     used to extend a new array.\n * @param {THIS=} opt_obj The object to be used as the value of 'this' within f.\n * @return {!Array<RESULT>} a new array with the concatenation of all arrays\n *     returned from f.\n * @template THIS, VALUE, RESULT\n */\ngoog.array.concatMap = function(arr, f, opt_obj) {\n  return goog.array.concat.apply([], goog.array.map(arr, f, opt_obj));\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Utilities for manipulating objects/maps/hashes.\n * @author arv@google.com (Erik Arvidsson)\n */\n\ngoog.provide('goog.object');\n\n\n/**\n * Whether two values are not observably distinguishable. This\n * correctly detects that 0 is not the same as -0 and two NaNs are\n * practically equivalent.\n *\n * The implementation is as suggested by harmony:egal proposal.\n *\n * @param {*} v The first value to compare.\n * @param {*} v2 The second value to compare.\n * @return {boolean} Whether two values are not observably distinguishable.\n * @see http://wiki.ecmascript.org/doku.php?id=harmony:egal\n */\ngoog.object.is = function(v, v2) {\n  if (v === v2) {\n    // 0 === -0, but they are not identical.\n    // We need the cast because the compiler requires that v2 is a\n    // number (although 1/v2 works with non-number). We cast to ? to\n    // stop the compiler from type-checking this statement.\n    return v !== 0 || 1 / v === 1 / /** @type {?} */ (v2);\n  }\n\n  // NaN is non-reflexive: NaN !== NaN, although they are identical.\n  return v !== v && v2 !== v2;\n};\n\n\n/**\n * Calls a function for each element in an object/map/hash.\n *\n * @param {Object<K,V>} obj The object over which to iterate.\n * @param {function(this:T,V,?,Object<K,V>):?} f The function to call\n *     for every element. This function takes 3 arguments (the value, the\n *     key and the object) and the return value is ignored.\n * @param {T=} opt_obj This is used as the 'this' object within f.\n * @template T,K,V\n */\ngoog.object.forEach = function(obj, f, opt_obj) {\n  for (var key in obj) {\n    f.call(/** @type {?} */ (opt_obj), obj[key], key, obj);\n  }\n};\n\n\n/**\n * Calls a function for each element in an object/map/hash. If that call returns\n * true, adds the element to a new object.\n *\n * @param {Object<K,V>} obj The object over which to iterate.\n * @param {function(this:T,V,?,Object<K,V>):boolean} f The function to call\n *     for every element. This\n *     function takes 3 arguments (the value, the key and the object)\n *     and should return a boolean. If the return value is true the\n *     element is added to the result object. If it is false the\n *     element is not included.\n * @param {T=} opt_obj This is used as the 'this' object within f.\n * @return {!Object<K,V>} a new object in which only elements that passed the\n *     test are present.\n * @template T,K,V\n */\ngoog.object.filter = function(obj, f, opt_obj) {\n  var res = {};\n  for (var key in obj) {\n    if (f.call(/** @type {?} */ (opt_obj), obj[key], key, obj)) {\n      res[key] = obj[key];\n    }\n  }\n  return res;\n};\n\n\n/**\n * For every element in an object/map/hash calls a function and inserts the\n * result into a new object.\n *\n * @param {Object<K,V>} obj The object over which to iterate.\n * @param {function(this:T,V,?,Object<K,V>):R} f The function to call\n *     for every element. This function\n *     takes 3 arguments (the value, the key and the object)\n *     and should return something. The result will be inserted\n *     into a new object.\n * @param {T=} opt_obj This is used as the 'this' object within f.\n * @return {!Object<K,R>} a new object with the results from f.\n * @template T,K,V,R\n */\ngoog.object.map = function(obj, f, opt_obj) {\n  var res = {};\n  for (var key in obj) {\n    res[key] = f.call(/** @type {?} */ (opt_obj), obj[key], key, obj);\n  }\n  return res;\n};\n\n\n/**\n * Calls a function for each element in an object/map/hash. If any\n * call returns true, returns true (without checking the rest). If\n * all calls return false, returns false.\n *\n * @param {Object<K,V>} obj The object to check.\n * @param {function(this:T,V,?,Object<K,V>):boolean} f The function to\n *     call for every element. This function\n *     takes 3 arguments (the value, the key and the object) and should\n *     return a boolean.\n * @param {T=} opt_obj This is used as the 'this' object within f.\n * @return {boolean} true if any element passes the test.\n * @template T,K,V\n */\ngoog.object.some = function(obj, f, opt_obj) {\n  for (var key in obj) {\n    if (f.call(/** @type {?} */ (opt_obj), obj[key], key, obj)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * Calls a function for each element in an object/map/hash. If\n * all calls return true, returns true. If any call returns false, returns\n * false at this point and does not continue to check the remaining elements.\n *\n * @param {Object<K,V>} obj The object to check.\n * @param {?function(this:T,V,?,Object<K,V>):boolean} f The function to\n *     call for every element. This function\n *     takes 3 arguments (the value, the key and the object) and should\n *     return a boolean.\n * @param {T=} opt_obj This is used as the 'this' object within f.\n * @return {boolean} false if any element fails the test.\n * @template T,K,V\n */\ngoog.object.every = function(obj, f, opt_obj) {\n  for (var key in obj) {\n    if (!f.call(/** @type {?} */ (opt_obj), obj[key], key, obj)) {\n      return false;\n    }\n  }\n  return true;\n};\n\n\n/**\n * Returns the number of key-value pairs in the object map.\n *\n * @param {Object} obj The object for which to get the number of key-value\n *     pairs.\n * @return {number} The number of key-value pairs in the object map.\n */\ngoog.object.getCount = function(obj) {\n  var rv = 0;\n  for (var key in obj) {\n    rv++;\n  }\n  return rv;\n};\n\n\n/**\n * Returns one key from the object map, if any exists.\n * For map literals the returned key will be the first one in most of the\n * browsers (a know exception is Konqueror).\n *\n * @param {Object} obj The object to pick a key from.\n * @return {string|undefined} The key or undefined if the object is empty.\n */\ngoog.object.getAnyKey = function(obj) {\n  for (var key in obj) {\n    return key;\n  }\n};\n\n\n/**\n * Returns one value from the object map, if any exists.\n * For map literals the returned value will be the first one in most of the\n * browsers (a know exception is Konqueror).\n *\n * @param {Object<K,V>} obj The object to pick a value from.\n * @return {V|undefined} The value or undefined if the object is empty.\n * @template K,V\n */\ngoog.object.getAnyValue = function(obj) {\n  for (var key in obj) {\n    return obj[key];\n  }\n};\n\n\n/**\n * Whether the object/hash/map contains the given object as a value.\n * An alias for goog.object.containsValue(obj, val).\n *\n * @param {Object<K,V>} obj The object in which to look for val.\n * @param {V} val The object for which to check.\n * @return {boolean} true if val is present.\n * @template K,V\n */\ngoog.object.contains = function(obj, val) {\n  return goog.object.containsValue(obj, val);\n};\n\n\n/**\n * Returns the values of the object/map/hash.\n *\n * @param {Object<K,V>} obj The object from which to get the values.\n * @return {!Array<V>} The values in the object/map/hash.\n * @template K,V\n */\ngoog.object.getValues = function(obj) {\n  var res = [];\n  var i = 0;\n  for (var key in obj) {\n    res[i++] = obj[key];\n  }\n  return res;\n};\n\n\n/**\n * Returns the keys of the object/map/hash.\n *\n * @param {Object} obj The object from which to get the keys.\n * @return {!Array<string>} Array of property keys.\n */\ngoog.object.getKeys = function(obj) {\n  var res = [];\n  var i = 0;\n  for (var key in obj) {\n    res[i++] = key;\n  }\n  return res;\n};\n\n\n/**\n * Get a value from an object multiple levels deep.  This is useful for\n * pulling values from deeply nested objects, such as JSON responses.\n * Example usage: getValueByKeys(jsonObj, 'foo', 'entries', 3)\n *\n * @param {!Object} obj An object to get the value from.  Can be array-like.\n * @param {...(string|number|!IArrayLike<number|string>)}\n *     var_args A number of keys\n *     (as strings, or numbers, for array-like objects).  Can also be\n *     specified as a single array of keys.\n * @return {*} The resulting value.  If, at any point, the value for a key\n *     in the current object is null or undefined, returns undefined.\n */\ngoog.object.getValueByKeys = function(obj, var_args) {\n  var isArrayLike = goog.isArrayLike(var_args);\n  var keys = isArrayLike ?\n      /** @type {!IArrayLike<number|string>} */ (var_args) :\n      arguments;\n\n  // Start with the 2nd parameter for the variable parameters syntax.\n  for (var i = isArrayLike ? 0 : 1; i < keys.length; i++) {\n    if (obj == null) return undefined;\n    obj = obj[keys[i]];\n  }\n\n  return obj;\n};\n\n\n/**\n * Whether the object/map/hash contains the given key.\n *\n * @param {Object} obj The object in which to look for key.\n * @param {?} key The key for which to check.\n * @return {boolean} true If the map contains the key.\n */\ngoog.object.containsKey = function(obj, key) {\n  return obj !== null && key in obj;\n};\n\n\n/**\n * Whether the object/map/hash contains the given value. This is O(n).\n *\n * @param {Object<K,V>} obj The object in which to look for val.\n * @param {V} val The value for which to check.\n * @return {boolean} true If the map contains the value.\n * @template K,V\n */\ngoog.object.containsValue = function(obj, val) {\n  for (var key in obj) {\n    if (obj[key] == val) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * Searches an object for an element that satisfies the given condition and\n * returns its key.\n * @param {Object<K,V>} obj The object to search in.\n * @param {function(this:T,V,string,Object<K,V>):boolean} f The\n *      function to call for every element. Takes 3 arguments (the value,\n *     the key and the object) and should return a boolean.\n * @param {T=} opt_this An optional \"this\" context for the function.\n * @return {string|undefined} The key of an element for which the function\n *     returns true or undefined if no such element is found.\n * @template T,K,V\n */\ngoog.object.findKey = function(obj, f, opt_this) {\n  for (var key in obj) {\n    if (f.call(/** @type {?} */ (opt_this), obj[key], key, obj)) {\n      return key;\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * Searches an object for an element that satisfies the given condition and\n * returns its value.\n * @param {Object<K,V>} obj The object to search in.\n * @param {function(this:T,V,string,Object<K,V>):boolean} f The function\n *     to call for every element. Takes 3 arguments (the value, the key\n *     and the object) and should return a boolean.\n * @param {T=} opt_this An optional \"this\" context for the function.\n * @return {V} The value of an element for which the function returns true or\n *     undefined if no such element is found.\n * @template T,K,V\n */\ngoog.object.findValue = function(obj, f, opt_this) {\n  var key = goog.object.findKey(obj, f, opt_this);\n  return key && obj[key];\n};\n\n\n/**\n * Whether the object/map/hash is empty.\n *\n * @param {Object} obj The object to test.\n * @return {boolean} true if obj is empty.\n */\ngoog.object.isEmpty = function(obj) {\n  for (var key in obj) {\n    return false;\n  }\n  return true;\n};\n\n\n/**\n * Removes all key value pairs from the object/map/hash.\n *\n * @param {Object} obj The object to clear.\n */\ngoog.object.clear = function(obj) {\n  for (var i in obj) {\n    delete obj[i];\n  }\n};\n\n\n/**\n * Removes a key-value pair based on the key.\n *\n * @param {Object} obj The object from which to remove the key.\n * @param {?} key The key to remove.\n * @return {boolean} Whether an element was removed.\n */\ngoog.object.remove = function(obj, key) {\n  var rv;\n  if (rv = key in /** @type {!Object} */ (obj)) {\n    delete obj[key];\n  }\n  return rv;\n};\n\n\n/**\n * Adds a key-value pair to the object. Throws an exception if the key is\n * already in use. Use set if you want to change an existing pair.\n *\n * @param {Object<K,V>} obj The object to which to add the key-value pair.\n * @param {string} key The key to add.\n * @param {V} val The value to add.\n * @template K,V\n */\ngoog.object.add = function(obj, key, val) {\n  if (obj !== null && key in obj) {\n    throw new Error('The object already contains the key \"' + key + '\"');\n  }\n  goog.object.set(obj, key, val);\n};\n\n\n/**\n * Returns the value for the given key.\n *\n * @param {Object<K,V>} obj The object from which to get the value.\n * @param {string} key The key for which to get the value.\n * @param {R=} opt_val The value to return if no item is found for the given\n *     key (default is undefined).\n * @return {V|R|undefined} The value for the given key.\n * @template K,V,R\n */\ngoog.object.get = function(obj, key, opt_val) {\n  if (obj !== null && key in obj) {\n    return obj[key];\n  }\n  return opt_val;\n};\n\n\n/**\n * Adds a key-value pair to the object/map/hash.\n *\n * @param {Object<K,V>} obj The object to which to add the key-value pair.\n * @param {string} key The key to add.\n * @param {V} value The value to add.\n * @template K,V\n */\ngoog.object.set = function(obj, key, value) {\n  obj[key] = value;\n};\n\n\n/**\n * Adds a key-value pair to the object/map/hash if it doesn't exist yet.\n *\n * @param {Object<K,V>} obj The object to which to add the key-value pair.\n * @param {string} key The key to add.\n * @param {V} value The value to add if the key wasn't present.\n * @return {V} The value of the entry at the end of the function.\n * @template K,V\n */\ngoog.object.setIfUndefined = function(obj, key, value) {\n  return key in /** @type {!Object} */ (obj) ? obj[key] : (obj[key] = value);\n};\n\n\n/**\n * Sets a key and value to an object if the key is not set. The value will be\n * the return value of the given function. If the key already exists, the\n * object will not be changed and the function will not be called (the function\n * will be lazily evaluated -- only called if necessary).\n *\n * This function is particularly useful when used with an `Object` which is\n * acting as a cache.\n *\n * @param {!Object<K,V>} obj The object to which to add the key-value pair.\n * @param {string} key The key to add.\n * @param {function():V} f The value to add if the key wasn't present.\n * @return {V} The value of the entry at the end of the function.\n * @template K,V\n */\ngoog.object.setWithReturnValueIfNotSet = function(obj, key, f) {\n  if (key in obj) {\n    return obj[key];\n  }\n\n  var val = f();\n  obj[key] = val;\n  return val;\n};\n\n\n/**\n * Compares two objects for equality using === on the values.\n *\n * @param {!Object<K,V>} a\n * @param {!Object<K,V>} b\n * @return {boolean}\n * @template K,V\n */\ngoog.object.equals = function(a, b) {\n  for (var k in a) {\n    if (!(k in b) || a[k] !== b[k]) {\n      return false;\n    }\n  }\n  for (var k in b) {\n    if (!(k in a)) {\n      return false;\n    }\n  }\n  return true;\n};\n\n\n/**\n * Returns a shallow clone of the object.\n *\n * @param {Object<K,V>} obj Object to clone.\n * @return {!Object<K,V>} Clone of the input object.\n * @template K,V\n */\ngoog.object.clone = function(obj) {\n  // We cannot use the prototype trick because a lot of methods depend on where\n  // the actual key is set.\n\n  var res = {};\n  for (var key in obj) {\n    res[key] = obj[key];\n  }\n  return res;\n  // We could also use goog.mixin but I wanted this to be independent from that.\n};\n\n\n/**\n * Clones a value. The input may be an Object, Array, or basic type. Objects and\n * arrays will be cloned recursively.\n *\n * WARNINGS:\n * <code>goog.object.unsafeClone</code> does not detect reference loops. Objects\n * that refer to themselves will cause infinite recursion.\n *\n * <code>goog.object.unsafeClone</code> is unaware of unique identifiers, and\n * copies UIDs created by <code>getUid</code> into cloned results.\n *\n * @param {T} obj The value to clone.\n * @return {T} A clone of the input value.\n * @template T\n */\ngoog.object.unsafeClone = function(obj) {\n  var type = goog.typeOf(obj);\n  if (type == 'object' || type == 'array') {\n    if (goog.isFunction(obj.clone)) {\n      return obj.clone();\n    }\n    var clone = type == 'array' ? [] : {};\n    for (var key in obj) {\n      clone[key] = goog.object.unsafeClone(obj[key]);\n    }\n    return clone;\n  }\n\n  return obj;\n};\n\n\n/**\n * Returns a new object in which all the keys and values are interchanged\n * (keys become values and values become keys). If multiple keys map to the\n * same value, the chosen transposed value is implementation-dependent.\n *\n * @param {Object} obj The object to transpose.\n * @return {!Object} The transposed object.\n */\ngoog.object.transpose = function(obj) {\n  var transposed = {};\n  for (var key in obj) {\n    transposed[obj[key]] = key;\n  }\n  return transposed;\n};\n\n\n/**\n * The names of the fields that are defined on Object.prototype.\n * @type {Array<string>}\n * @private\n */\ngoog.object.PROTOTYPE_FIELDS_ = [\n  'constructor', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable',\n  'toLocaleString', 'toString', 'valueOf'\n];\n\n\n/**\n * Extends an object with another object.\n * This operates 'in-place'; it does not create a new Object.\n *\n * Example:\n * var o = {};\n * goog.object.extend(o, {a: 0, b: 1});\n * o; // {a: 0, b: 1}\n * goog.object.extend(o, {b: 2, c: 3});\n * o; // {a: 0, b: 2, c: 3}\n *\n * @param {Object} target The object to modify. Existing properties will be\n *     overwritten if they are also present in one of the objects in\n *     `var_args`.\n * @param {...(Object|null|undefined)} var_args The objects from which values\n *     will be copied.\n */\ngoog.object.extend = function(target, var_args) {\n  var key, source;\n  for (var i = 1; i < arguments.length; i++) {\n    source = arguments[i];\n    for (key in source) {\n      target[key] = source[key];\n    }\n\n    // For IE the for-in-loop does not contain any properties that are not\n    // enumerable on the prototype object (for example isPrototypeOf from\n    // Object.prototype) and it will also not include 'replace' on objects that\n    // extend String and change 'replace' (not that it is common for anyone to\n    // extend anything except Object).\n\n    for (var j = 0; j < goog.object.PROTOTYPE_FIELDS_.length; j++) {\n      key = goog.object.PROTOTYPE_FIELDS_[j];\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n};\n\n\n/**\n * Creates a new object built from the key-value pairs provided as arguments.\n * @param {...*} var_args If only one argument is provided and it is an array\n *     then this is used as the arguments, otherwise even arguments are used as\n *     the property names and odd arguments are used as the property values.\n * @return {!Object} The new object.\n * @throws {Error} If there are uneven number of arguments or there is only one\n *     non array argument.\n */\ngoog.object.create = function(var_args) {\n  var argLength = arguments.length;\n  if (argLength == 1 && goog.isArray(arguments[0])) {\n    return goog.object.create.apply(null, arguments[0]);\n  }\n\n  if (argLength % 2) {\n    throw new Error('Uneven number of arguments');\n  }\n\n  var rv = {};\n  for (var i = 0; i < argLength; i += 2) {\n    rv[arguments[i]] = arguments[i + 1];\n  }\n  return rv;\n};\n\n\n/**\n * Creates a new object where the property names come from the arguments but\n * the value is always set to true\n * @param {...*} var_args If only one argument is provided and it is an array\n *     then this is used as the arguments, otherwise the arguments are used\n *     as the property names.\n * @return {!Object} The new object.\n */\ngoog.object.createSet = function(var_args) {\n  var argLength = arguments.length;\n  if (argLength == 1 && goog.isArray(arguments[0])) {\n    return goog.object.createSet.apply(null, arguments[0]);\n  }\n\n  var rv = {};\n  for (var i = 0; i < argLength; i++) {\n    rv[arguments[i]] = true;\n  }\n  return rv;\n};\n\n\n/**\n * Creates an immutable view of the underlying object, if the browser\n * supports immutable objects.\n *\n * In default mode, writes to this view will fail silently. In strict mode,\n * they will throw an error.\n *\n * @param {!Object<K,V>} obj An object.\n * @return {!Object<K,V>} An immutable view of that object, or the\n *     original object if this browser does not support immutables.\n * @template K,V\n */\ngoog.object.createImmutableView = function(obj) {\n  var result = obj;\n  if (Object.isFrozen && !Object.isFrozen(obj)) {\n    result = Object.create(obj);\n    Object.freeze(result);\n  }\n  return result;\n};\n\n\n/**\n * @param {!Object} obj An object.\n * @return {boolean} Whether this is an immutable view of the object.\n */\ngoog.object.isImmutableView = function(obj) {\n  return !!Object.isFrozen && Object.isFrozen(obj);\n};\n\n\n/**\n * Get all properties names on a given Object regardless of enumerability.\n *\n * <p> If the browser does not support `Object.getOwnPropertyNames` nor\n * `Object.getPrototypeOf` then this is equivalent to using\n * `goog.object.getKeys`\n *\n * @param {?Object} obj The object to get the properties of.\n * @param {boolean=} opt_includeObjectPrototype Whether properties defined on\n *     `Object.prototype` should be included in the result.\n * @param {boolean=} opt_includeFunctionPrototype Whether properties defined on\n *     `Function.prototype` should be included in the result.\n * @return {!Array<string>}\n * @public\n */\ngoog.object.getAllPropertyNames = function(\n    obj, opt_includeObjectPrototype, opt_includeFunctionPrototype) {\n  if (!obj) {\n    return [];\n  }\n\n  // Naively use a for..in loop to get the property names if the browser doesn't\n  // support any other APIs for getting it.\n  if (!Object.getOwnPropertyNames || !Object.getPrototypeOf) {\n    return goog.object.getKeys(obj);\n  }\n\n  var visitedSet = {};\n\n  // Traverse the prototype chain and add all properties to the visited set.\n  var proto = obj;\n  while (proto &&\n         (proto !== Object.prototype || !!opt_includeObjectPrototype) &&\n         (proto !== Function.prototype || !!opt_includeFunctionPrototype)) {\n    var names = Object.getOwnPropertyNames(proto);\n    for (var i = 0; i < names.length; i++) {\n      visitedSet[names[i]] = true;\n    }\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  return goog.object.getKeys(visitedSet);\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\ngoog.provide('goog.string.Const');\n\ngoog.require('goog.asserts');\ngoog.require('goog.string.TypedString');\n\n\n\n/**\n * Wrapper for compile-time-constant strings.\n *\n * Const is a wrapper for strings that can only be created from program\n * constants (i.e., string literals).  This property relies on a custom Closure\n * compiler check that `goog.string.Const.from` is only invoked on\n * compile-time-constant expressions.\n *\n * Const is useful in APIs whose correct and secure use requires that certain\n * arguments are not attacker controlled: Compile-time constants are inherently\n * under the control of the application and not under control of external\n * attackers, and hence are safe to use in such contexts.\n *\n * Instances of this type must be created via its factory method\n * `goog.string.Const.from` and not by invoking its constructor.  The\n * constructor intentionally takes no parameters and the type is immutable;\n * hence only a default instance corresponding to the empty string can be\n * obtained via constructor invocation.  Use goog.string.Const.EMPTY\n * instead of using this constructor to get an empty Const string.\n *\n * @see goog.string.Const#from\n * @constructor\n * @final\n * @struct\n * @implements {goog.string.TypedString}\n * @param {Object=} opt_token package-internal implementation detail.\n * @param {string=} opt_content package-internal implementation detail.\n */\ngoog.string.Const = function(opt_token, opt_content) {\n  /**\n   * The wrapped value of this Const object.  The field has a purposely ugly\n   * name to make (non-compiled) code that attempts to directly access this\n   * field stand out.\n   * @private {string}\n   */\n  this.stringConstValueWithSecurityContract__googStringSecurityPrivate_ =\n      ((opt_token ===\n        goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_) &&\n       opt_content) ||\n      '';\n\n  /**\n   * A type marker used to implement additional run-time type checking.\n   * @see goog.string.Const#unwrap\n   * @const {!Object}\n   * @private\n   */\n  this.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_ =\n      goog.string.Const.TYPE_MARKER_;\n};\n\n\n/**\n * @override\n * @const\n */\ngoog.string.Const.prototype.implementsGoogStringTypedString = true;\n\n\n/**\n * Returns this Const's value a string.\n *\n * IMPORTANT: In code where it is security-relevant that an object's type is\n * indeed `goog.string.Const`, use `goog.string.Const.unwrap`\n * instead of this method.\n *\n * @see goog.string.Const#unwrap\n * @override\n */\ngoog.string.Const.prototype.getTypedStringValue = function() {\n  return this.stringConstValueWithSecurityContract__googStringSecurityPrivate_;\n};\n\n\n/**\n * Returns a debug-string representation of this value.\n *\n * To obtain the actual string value wrapped inside an object of this type,\n * use `goog.string.Const.unwrap`.\n *\n * @see goog.string.Const#unwrap\n * @override\n */\ngoog.string.Const.prototype.toString = function() {\n  return 'Const{' +\n      this.stringConstValueWithSecurityContract__googStringSecurityPrivate_ +\n      '}';\n};\n\n\n/**\n * Performs a runtime check that the provided object is indeed an instance\n * of `goog.string.Const`, and returns its value.\n * @param {!goog.string.Const} stringConst The object to extract from.\n * @return {string} The Const object's contained string, unless the run-time\n *     type check fails. In that case, `unwrap` returns an innocuous\n *     string, or, if assertions are enabled, throws\n *     `goog.asserts.AssertionError`.\n */\ngoog.string.Const.unwrap = function(stringConst) {\n  // Perform additional run-time type-checking to ensure that stringConst is\n  // indeed an instance of the expected type.  This provides some additional\n  // protection against security bugs due to application code that disables type\n  // checks.\n  if (stringConst instanceof goog.string.Const &&\n      stringConst.constructor === goog.string.Const &&\n      stringConst.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_ ===\n          goog.string.Const.TYPE_MARKER_) {\n    return stringConst\n        .stringConstValueWithSecurityContract__googStringSecurityPrivate_;\n  } else {\n    goog.asserts.fail(\n        'expected object of type Const, got \\'' + stringConst + '\\'');\n    return 'type_error:Const';\n  }\n};\n\n\n/**\n * Creates a Const object from a compile-time constant string.\n *\n * It is illegal to invoke this function on an expression whose\n * compile-time-constant value cannot be determined by the Closure compiler.\n *\n * Correct invocations include,\n * <pre>\n *   var s = goog.string.Const.from('hello');\n *   var t = goog.string.Const.from('hello' + 'world');\n * </pre>\n *\n * In contrast, the following are illegal:\n * <pre>\n *   var s = goog.string.Const.from(getHello());\n *   var t = goog.string.Const.from('hello' + world);\n * </pre>\n *\n * @param {string} s A constant string from which to create a Const.\n * @return {!goog.string.Const} A Const object initialized to stringConst.\n */\ngoog.string.Const.from = function(s) {\n  return new goog.string.Const(\n      goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_, s);\n};\n\n/**\n * Type marker for the Const type, used to implement additional run-time\n * type checking.\n * @const {!Object}\n * @private\n */\ngoog.string.Const.TYPE_MARKER_ = {};\n\n/**\n * @type {!Object}\n * @private\n * @const\n */\ngoog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_ = {};\n\n/**\n * A Const instance wrapping the empty string.\n * @const {!goog.string.Const}\n */\ngoog.string.Const.EMPTY = goog.string.Const.from('');\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview The TrustedResourceUrl type and its builders.\n *\n * TODO(xtof): Link to document stating type contract.\n */\n\ngoog.provide('goog.html.TrustedResourceUrl');\n\ngoog.require('goog.asserts');\ngoog.require('goog.html.trustedtypes');\ngoog.require('goog.i18n.bidi.Dir');\ngoog.require('goog.i18n.bidi.DirectionalString');\ngoog.require('goog.string.Const');\ngoog.require('goog.string.TypedString');\n\n\n\n/**\n * A URL which is under application control and from which script, CSS, and\n * other resources that represent executable code, can be fetched.\n *\n * Given that the URL can only be constructed from strings under application\n * control and is used to load resources, bugs resulting in a malformed URL\n * should not have a security impact and are likely to be easily detectable\n * during testing. Given the wide number of non-RFC compliant URLs in use,\n * stricter validation could prevent some applications from being able to use\n * this type.\n *\n * Instances of this type must be created via the factory method,\n * (`fromConstant`, `fromConstants`, `format` or\n * `formatWithParams`), and not by invoking its constructor. The constructor\n * intentionally takes no parameters and the type is immutable; hence only a\n * default instance corresponding to the empty string can be obtained via\n * constructor invocation.\n *\n * @see goog.html.TrustedResourceUrl#fromConstant\n * @constructor\n * @final\n * @struct\n * @implements {goog.i18n.bidi.DirectionalString}\n * @implements {goog.string.TypedString}\n */\ngoog.html.TrustedResourceUrl = function() {\n  /**\n   * The contained value of this TrustedResourceUrl.  The field has a purposely\n   * ugly name to make (non-compiled) code that attempts to directly access this\n   * field stand out.\n   * @private {!TrustedScriptURL|string}\n   */\n  this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_ = '';\n\n  /**\n   * Value stored as TrustedURL. TrustedResourceURL corresponds to TrustedURL in\n   * some context thus we need to store it separately.\n   * @private {?TrustedURL}\n   */\n  this.trustedURL_ = null;\n\n  /**\n   * A type marker used to implement additional run-time type checking.\n   * @see goog.html.TrustedResourceUrl#unwrap\n   * @const {!Object}\n   * @private\n   */\n  this.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_ =\n      goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_;\n};\n\n\n/**\n * @override\n * @const\n */\ngoog.html.TrustedResourceUrl.prototype.implementsGoogStringTypedString = true;\n\n\n/**\n * Returns this TrustedResourceUrl's value as a string.\n *\n * IMPORTANT: In code where it is security relevant that an object's type is\n * indeed `TrustedResourceUrl`, use\n * `goog.html.TrustedResourceUrl.unwrap` instead of this method. If in\n * doubt, assume that it's security relevant. In particular, note that\n * goog.html functions which return a goog.html type do not guarantee that\n * the returned instance is of the right type. For example:\n *\n * <pre>\n * var fakeSafeHtml = new String('fake');\n * fakeSafeHtml.__proto__ = goog.html.SafeHtml.prototype;\n * var newSafeHtml = goog.html.SafeHtml.htmlEscape(fakeSafeHtml);\n * // newSafeHtml is just an alias for fakeSafeHtml, it's passed through by\n * // goog.html.SafeHtml.htmlEscape() as fakeSafeHtml instanceof\n * // goog.html.SafeHtml.\n * </pre>\n *\n * @see goog.html.TrustedResourceUrl#unwrap\n * @override\n */\ngoog.html.TrustedResourceUrl.prototype.getTypedStringValue = function() {\n  return this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_\n      .toString();\n};\n\n\n/**\n * @override\n * @const\n */\ngoog.html.TrustedResourceUrl.prototype.implementsGoogI18nBidiDirectionalString =\n    true;\n\n\n/**\n * Returns this URLs directionality, which is always `LTR`.\n * @override\n */\ngoog.html.TrustedResourceUrl.prototype.getDirection = function() {\n  return goog.i18n.bidi.Dir.LTR;\n};\n\n\n/**\n * Creates a new TrustedResourceUrl with params added to URL. Both search and\n * hash params can be specified.\n *\n * @param {string|?Object<string, *>|undefined} searchParams Search parameters\n *     to add to URL. See goog.html.TrustedResourceUrl.stringifyParams_ for\n *     exact format definition.\n * @param {(string|?Object<string, *>)=} opt_hashParams Hash parameters to add\n *     to URL. See goog.html.TrustedResourceUrl.stringifyParams_ for exact\n *     format definition.\n * @return {!goog.html.TrustedResourceUrl} New TrustedResourceUrl with params.\n */\ngoog.html.TrustedResourceUrl.prototype.cloneWithParams = function(\n    searchParams, opt_hashParams) {\n  var url = goog.html.TrustedResourceUrl.unwrap(this);\n  var parts = goog.html.TrustedResourceUrl.URL_PARAM_PARSER_.exec(url);\n  var urlBase = parts[1];\n  var urlSearch = parts[2] || '';\n  var urlHash = parts[3] || '';\n\n  return goog.html.TrustedResourceUrl\n      .createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(\n          urlBase +\n          goog.html.TrustedResourceUrl.stringifyParams_(\n              '?', urlSearch, searchParams) +\n          goog.html.TrustedResourceUrl.stringifyParams_(\n              '#', urlHash, opt_hashParams));\n};\n\n\nif (goog.DEBUG) {\n  /**\n   * Returns a debug string-representation of this value.\n   *\n   * To obtain the actual string value wrapped in a TrustedResourceUrl, use\n   * `goog.html.TrustedResourceUrl.unwrap`.\n   *\n   * @see goog.html.TrustedResourceUrl#unwrap\n   * @override\n   */\n  goog.html.TrustedResourceUrl.prototype.toString = function() {\n    return 'TrustedResourceUrl{' +\n        this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_ + '}';\n  };\n}\n\n\n/**\n * Performs a runtime check that the provided object is indeed a\n * TrustedResourceUrl object, and returns its value.\n *\n * @param {!goog.html.TrustedResourceUrl} trustedResourceUrl The object to\n *     extract from.\n * @return {string} The trustedResourceUrl object's contained string, unless\n *     the run-time type check fails. In that case, `unwrap` returns an\n *     innocuous string, or, if assertions are enabled, throws\n *     `goog.asserts.AssertionError`.\n */\ngoog.html.TrustedResourceUrl.unwrap = function(trustedResourceUrl) {\n  return goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(trustedResourceUrl)\n      .toString();\n};\n\n\n/**\n * Unwraps value as TrustedScriptURL if supported or as a string if not.\n * @param {!goog.html.TrustedResourceUrl} trustedResourceUrl\n * @return {!TrustedScriptURL|string}\n * @see goog.html.TrustedResourceUrl.unwrap\n */\ngoog.html.TrustedResourceUrl.unwrapTrustedScriptURL = function(\n    trustedResourceUrl) {\n  // Perform additional Run-time type-checking to ensure that\n  // trustedResourceUrl is indeed an instance of the expected type.  This\n  // provides some additional protection against security bugs due to\n  // application code that disables type checks.\n  // Specifically, the following checks are performed:\n  // 1. The object is an instance of the expected type.\n  // 2. The object is not an instance of a subclass.\n  // 3. The object carries a type marker for the expected type. \"Faking\" an\n  // object requires a reference to the type marker, which has names intended\n  // to stand out in code reviews.\n  if (trustedResourceUrl instanceof goog.html.TrustedResourceUrl &&\n      trustedResourceUrl.constructor === goog.html.TrustedResourceUrl &&\n      trustedResourceUrl\n              .TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_ ===\n          goog.html.TrustedResourceUrl\n              .TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_) {\n    return trustedResourceUrl\n        .privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_;\n  } else {\n    goog.asserts.fail('expected object of type TrustedResourceUrl, got \\'' +\n        trustedResourceUrl + '\\' of type ' + goog.typeOf(trustedResourceUrl));\n    return 'type_error:TrustedResourceUrl';\n  }\n};\n\n\n/**\n * Unwraps value as TrustedURL if supported or as a string if not.\n * @param {!goog.html.TrustedResourceUrl} trustedResourceUrl\n * @return {!TrustedURL|string}\n * @see goog.html.TrustedResourceUrl.unwrap\n */\ngoog.html.TrustedResourceUrl.unwrapTrustedURL = function(trustedResourceUrl) {\n  return trustedResourceUrl.trustedURL_ ?\n      trustedResourceUrl.trustedURL_ :\n      goog.html.TrustedResourceUrl.unwrap(trustedResourceUrl);\n};\n\n\n/**\n * Creates a TrustedResourceUrl from a format string and arguments.\n *\n * The arguments for interpolation into the format string map labels to values.\n * Values of type `goog.string.Const` are interpolated without modifcation.\n * Values of other types are cast to string and encoded with\n * encodeURIComponent.\n *\n * `%{<label>}` markers are used in the format string to indicate locations\n * to be interpolated with the valued mapped to the given label. `<label>`\n * must contain only alphanumeric and `_` characters.\n *\n * The format string must match goog.html.TrustedResourceUrl.BASE_URL_.\n *\n * Example usage:\n *\n *    var url = goog.html.TrustedResourceUrl.format(goog.string.Const.from(\n *        'https://www.google.com/search?q=%{query}'), {'query': searchTerm});\n *\n *    var url = goog.html.TrustedResourceUrl.format(goog.string.Const.from(\n *        '//www.youtube.com/v/%{videoId}?hl=en&fs=1%{autoplay}'), {\n *        'videoId': videoId,\n *        'autoplay': opt_autoplay ?\n *            goog.string.Const.from('&autoplay=1') : goog.string.Const.EMPTY\n *    });\n *\n * While this function can be used to create a TrustedResourceUrl from only\n * constants, fromConstant() and fromConstants() are generally preferable for\n * that purpose.\n *\n * @param {!goog.string.Const} format The format string.\n * @param {!Object<string, (string|number|!goog.string.Const)>} args Mapping\n *     of labels to values to be interpolated into the format string.\n *     goog.string.Const values are interpolated without encoding.\n * @return {!goog.html.TrustedResourceUrl}\n * @throws {!Error} On an invalid format string or if a label used in the\n *     the format string is not present in args.\n */\ngoog.html.TrustedResourceUrl.format = function(format, args) {\n  var formatStr = goog.string.Const.unwrap(format);\n  if (!goog.html.TrustedResourceUrl.BASE_URL_.test(formatStr)) {\n    throw new Error('Invalid TrustedResourceUrl format: ' + formatStr);\n  }\n  var result = formatStr.replace(\n      goog.html.TrustedResourceUrl.FORMAT_MARKER_, function(match, id) {\n        if (!Object.prototype.hasOwnProperty.call(args, id)) {\n          throw new Error(\n              'Found marker, \"' + id + '\", in format string, \"' + formatStr +\n              '\", but no valid label mapping found ' +\n              'in args: ' + JSON.stringify(args));\n        }\n        var arg = args[id];\n        if (arg instanceof goog.string.Const) {\n          return goog.string.Const.unwrap(arg);\n        } else {\n          return encodeURIComponent(String(arg));\n        }\n      });\n  return goog.html.TrustedResourceUrl\n      .createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(result);\n};\n\n\n/**\n * @private @const {!RegExp}\n */\ngoog.html.TrustedResourceUrl.FORMAT_MARKER_ = /%{(\\w+)}/g;\n\n\n/**\n * The URL must be absolute, scheme-relative or path-absolute. So it must\n * start with:\n * - https:// followed by allowed origin characters.\n * - // followed by allowed origin characters.\n * - Any absolute or relative path.\n *\n * Based on\n * https://url.spec.whatwg.org/commit-snapshots/56b74ce7cca8883eab62e9a12666e2fac665d03d/#url-parsing\n * an initial / which is not followed by another / or \\ will end up in the \"path\n * state\" and from there it can only go to \"fragment state\" and \"query state\".\n *\n * We don't enforce a well-formed domain name. So '.' or '1.2' are valid.\n * That's ok because the origin comes from a compile-time constant.\n *\n * A regular expression is used instead of goog.uri for several reasons:\n * - Strictness. E.g. we don't want any userinfo component and we don't\n *   want '/./, nor \\' in the first path component.\n * - Small trusted base. goog.uri is generic and might need to change,\n *   reasoning about all the ways it can parse a URL now and in the future\n *   is error-prone.\n * - Code size. We expect many calls to .format(), many of which might\n *   not be using goog.uri.\n * - Simplicity. Using goog.uri would likely not result in simpler nor shorter\n *   code.\n * @private @const {!RegExp}\n */\ngoog.html.TrustedResourceUrl.BASE_URL_ = new RegExp(\n    '^((https:)?//[0-9a-z.:[\\\\]-]+/'  // Origin.\n        + '|/[^/\\\\\\\\]'                // Absolute path.\n        + '|[^:/\\\\\\\\%]+/'             // Relative path.\n        + '|[^:/\\\\\\\\%]*[?#]'          // Query string or fragment.\n        + '|about:blank#'             // about:blank with fragment.\n        + ')',\n    'i');\n\n/**\n * RegExp for splitting a URL into the base, search field, and hash field.\n *\n * @private @const {!RegExp}\n */\ngoog.html.TrustedResourceUrl.URL_PARAM_PARSER_ =\n    /^([^?#]*)(\\?[^#]*)?(#[\\s\\S]*)?/;\n\n\n/**\n * Formats the URL same as TrustedResourceUrl.format and then adds extra URL\n * parameters.\n *\n * Example usage:\n *\n *     // Creates '//www.youtube.com/v/abc?autoplay=1' for videoId='abc' and\n *     // opt_autoplay=1. Creates '//www.youtube.com/v/abc' for videoId='abc'\n *     // and opt_autoplay=undefined.\n *     var url = goog.html.TrustedResourceUrl.formatWithParams(\n *         goog.string.Const.from('//www.youtube.com/v/%{videoId}'),\n *         {'videoId': videoId},\n *         {'autoplay': opt_autoplay});\n *\n * @param {!goog.string.Const} format The format string.\n * @param {!Object<string, (string|number|!goog.string.Const)>} args Mapping\n *     of labels to values to be interpolated into the format string.\n *     goog.string.Const values are interpolated without encoding.\n * @param {string|?Object<string, *>|undefined} searchParams Parameters to add\n *     to URL. See goog.html.TrustedResourceUrl.stringifyParams_ for exact\n *     format definition.\n * @param {(string|?Object<string, *>)=} opt_hashParams Hash parameters to add\n *     to URL. See goog.html.TrustedResourceUrl.stringifyParams_ for exact\n *     format definition.\n * @return {!goog.html.TrustedResourceUrl}\n * @throws {!Error} On an invalid format string or if a label used in the\n *     the format string is not present in args.\n */\ngoog.html.TrustedResourceUrl.formatWithParams = function(\n    format, args, searchParams, opt_hashParams) {\n  var url = goog.html.TrustedResourceUrl.format(format, args);\n  return url.cloneWithParams(searchParams, opt_hashParams);\n};\n\n\n/**\n * Creates a TrustedResourceUrl object from a compile-time constant string.\n *\n * Compile-time constant strings are inherently program-controlled and hence\n * trusted.\n *\n * @param {!goog.string.Const} url A compile-time-constant string from which to\n *     create a TrustedResourceUrl.\n * @return {!goog.html.TrustedResourceUrl} A TrustedResourceUrl object\n *     initialized to `url`.\n */\ngoog.html.TrustedResourceUrl.fromConstant = function(url) {\n  return goog.html.TrustedResourceUrl\n      .createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(\n          goog.string.Const.unwrap(url));\n};\n\n\n/**\n * Creates a TrustedResourceUrl object from a compile-time constant strings.\n *\n * Compile-time constant strings are inherently program-controlled and hence\n * trusted.\n *\n * @param {!Array<!goog.string.Const>} parts Compile-time-constant strings from\n *     which to create a TrustedResourceUrl.\n * @return {!goog.html.TrustedResourceUrl} A TrustedResourceUrl object\n *     initialized to concatenation of `parts`.\n */\ngoog.html.TrustedResourceUrl.fromConstants = function(parts) {\n  var unwrapped = '';\n  for (var i = 0; i < parts.length; i++) {\n    unwrapped += goog.string.Const.unwrap(parts[i]);\n  }\n  return goog.html.TrustedResourceUrl\n      .createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(unwrapped);\n};\n\n\n/**\n * Type marker for the TrustedResourceUrl type, used to implement additional\n * run-time type checking.\n * @const {!Object}\n * @private\n */\ngoog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_ = {};\n\n\n/**\n * Package-internal utility method to create TrustedResourceUrl instances.\n *\n * @param {string} url The string to initialize the TrustedResourceUrl object\n *     with.\n * @return {!goog.html.TrustedResourceUrl} The initialized TrustedResourceUrl\n *     object.\n * @package\n */\ngoog.html.TrustedResourceUrl\n    .createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse = function(url) {\n  var trustedResourceUrl = new goog.html.TrustedResourceUrl();\n  trustedResourceUrl.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_ =\n      goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY ?\n      goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY\n          .createScriptURL(url) :\n      url;\n  if (goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY) {\n    trustedResourceUrl.trustedURL_ =\n        goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createURL(\n            url);\n  }\n  return trustedResourceUrl;\n};\n\n\n/**\n * Stringifies the passed params to be used as either a search or hash field of\n * a URL.\n *\n * @param {string} prefix The prefix character for the given field ('?' or '#').\n * @param {string} currentString The existing field value (including the prefix\n *     character, if the field is present).\n * @param {string|?Object<string, *>|undefined} params The params to set or\n *     append to the field.\n * - If `undefined` or `null`, the field remains unchanged.\n * - If a string, then the string will be escaped and the field will be\n *   overwritten with that value.\n * - If an Object, that object is treated as a set of key-value pairs to be\n *   appended to the current field. Note that JavaScript doesn't guarantee the\n *   order of values in an object which might result in non-deterministic order\n *   of the parameters. However, browsers currently preserve the order. The\n *   rules for each entry:\n *   - If an array, it will be processed as if each entry were an additional\n *     parameter with exactly the same key, following the same logic below.\n *   - If `undefined` or `null`, it will be skipped.\n *   - Otherwise, it will be turned into a string, escaped, and appended.\n * @return {string}\n * @private\n */\ngoog.html.TrustedResourceUrl.stringifyParams_ = function(\n    prefix, currentString, params) {\n  if (params == null) {\n    // Do not modify the field.\n    return currentString;\n  }\n  if (goog.isString(params)) {\n    // Set field to the passed string.\n    return params ? prefix + encodeURIComponent(params) : '';\n  }\n  // Add on parameters to field from key-value object.\n  for (var key in params) {\n    var value = params[key];\n    var outputValues = goog.isArray(value) ? value : [value];\n    for (var i = 0; i < outputValues.length; i++) {\n      var outputValue = outputValues[i];\n      if (outputValue != null) {\n        if (!currentString) {\n          currentString = prefix;\n        }\n        currentString += (currentString.length > prefix.length ? '&' : '') +\n            encodeURIComponent(key) + '=' +\n            encodeURIComponent(String(outputValue));\n      }\n    }\n  }\n  return currentString;\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview String functions called from Closure packages that couldn't\n * depend on each other. Outside Closure, use goog.string function which\n * delegate to these.\n */\n\n\ngoog.provide('goog.string.internal');\n\n\n/**\n * Fast prefix-checker.\n * @param {string} str The string to check.\n * @param {string} prefix A string to look for at the start of `str`.\n * @return {boolean} True if `str` begins with `prefix`.\n * @see goog.string.startsWith\n */\ngoog.string.internal.startsWith = function(str, prefix) {\n  return str.lastIndexOf(prefix, 0) == 0;\n};\n\n\n/**\n * Fast suffix-checker.\n * @param {string} str The string to check.\n * @param {string} suffix A string to look for at the end of `str`.\n * @return {boolean} True if `str` ends with `suffix`.\n * @see goog.string.endsWith\n */\ngoog.string.internal.endsWith = function(str, suffix) {\n  var l = str.length - suffix.length;\n  return l >= 0 && str.indexOf(suffix, l) == l;\n};\n\n\n/**\n * Case-insensitive prefix-checker.\n * @param {string} str The string to check.\n * @param {string} prefix  A string to look for at the end of `str`.\n * @return {boolean} True if `str` begins with `prefix` (ignoring\n *     case).\n * @see goog.string.caseInsensitiveStartsWith\n */\ngoog.string.internal.caseInsensitiveStartsWith = function(str, prefix) {\n  return goog.string.internal.caseInsensitiveCompare(\n             prefix, str.substr(0, prefix.length)) == 0;\n};\n\n\n/**\n * Case-insensitive suffix-checker.\n * @param {string} str The string to check.\n * @param {string} suffix A string to look for at the end of `str`.\n * @return {boolean} True if `str` ends with `suffix` (ignoring\n *     case).\n * @see goog.string.caseInsensitiveEndsWith\n */\ngoog.string.internal.caseInsensitiveEndsWith = function(str, suffix) {\n  return (\n      goog.string.internal.caseInsensitiveCompare(\n          suffix, str.substr(str.length - suffix.length, suffix.length)) == 0);\n};\n\n\n/**\n * Case-insensitive equality checker.\n * @param {string} str1 First string to check.\n * @param {string} str2 Second string to check.\n * @return {boolean} True if `str1` and `str2` are the same string,\n *     ignoring case.\n * @see goog.string.caseInsensitiveEquals\n */\ngoog.string.internal.caseInsensitiveEquals = function(str1, str2) {\n  return str1.toLowerCase() == str2.toLowerCase();\n};\n\n\n/**\n * Checks if a string is empty or contains only whitespaces.\n * @param {string} str The string to check.\n * @return {boolean} Whether `str` is empty or whitespace only.\n * @see goog.string.isEmptyOrWhitespace\n */\ngoog.string.internal.isEmptyOrWhitespace = function(str) {\n  // testing length == 0 first is actually slower in all browsers (about the\n  // same in Opera).\n  // Since IE doesn't include non-breaking-space (0xa0) in their \\s character\n  // class (as required by section 7.2 of the ECMAScript spec), we explicitly\n  // include it in the regexp to enforce consistent cross-browser behavior.\n  return /^[\\s\\xa0]*$/.test(str);\n};\n\n\n/**\n * Trims white spaces to the left and right of a string.\n * @param {string} str The string to trim.\n * @return {string} A trimmed copy of `str`.\n */\ngoog.string.internal.trim =\n    (goog.TRUSTED_SITE && String.prototype.trim) ? function(str) {\n      return str.trim();\n    } : function(str) {\n      // Since IE doesn't include non-breaking-space (0xa0) in their \\s\n      // character class (as required by section 7.2 of the ECMAScript spec),\n      // we explicitly include it in the regexp to enforce consistent\n      // cross-browser behavior.\n      // NOTE: We don't use String#replace because it might have side effects\n      // causing this function to not compile to 0 bytes.\n      return /^[\\s\\xa0]*([\\s\\S]*?)[\\s\\xa0]*$/.exec(str)[1];\n    };\n\n\n/**\n * A string comparator that ignores case.\n * -1 = str1 less than str2\n *  0 = str1 equals str2\n *  1 = str1 greater than str2\n *\n * @param {string} str1 The string to compare.\n * @param {string} str2 The string to compare `str1` to.\n * @return {number} The comparator result, as described above.\n * @see goog.string.caseInsensitiveCompare\n */\ngoog.string.internal.caseInsensitiveCompare = function(str1, str2) {\n  var test1 = String(str1).toLowerCase();\n  var test2 = String(str2).toLowerCase();\n\n  if (test1 < test2) {\n    return -1;\n  } else if (test1 == test2) {\n    return 0;\n  } else {\n    return 1;\n  }\n};\n\n\n/**\n * Converts \\n to <br>s or <br />s.\n * @param {string} str The string in which to convert newlines.\n * @param {boolean=} opt_xml Whether to use XML compatible tags.\n * @return {string} A copy of `str` with converted newlines.\n * @see goog.string.newLineToBr\n */\ngoog.string.internal.newLineToBr = function(str, opt_xml) {\n  return str.replace(/(\\r\\n|\\r|\\n)/g, opt_xml ? '<br />' : '<br>');\n};\n\n\n/**\n * Escapes double quote '\"' and single quote '\\'' characters in addition to\n * '&', '<', and '>' so that a string can be included in an HTML tag attribute\n * value within double or single quotes.\n * @param {string} str string to be escaped.\n * @param {boolean=} opt_isLikelyToContainHtmlChars\n * @return {string} An escaped copy of `str`.\n * @see goog.string.htmlEscape\n */\ngoog.string.internal.htmlEscape = function(\n    str, opt_isLikelyToContainHtmlChars) {\n  if (opt_isLikelyToContainHtmlChars) {\n    str = str.replace(goog.string.internal.AMP_RE_, '&amp;')\n              .replace(goog.string.internal.LT_RE_, '&lt;')\n              .replace(goog.string.internal.GT_RE_, '&gt;')\n              .replace(goog.string.internal.QUOT_RE_, '&quot;')\n              .replace(goog.string.internal.SINGLE_QUOTE_RE_, '&#39;')\n              .replace(goog.string.internal.NULL_RE_, '&#0;');\n    return str;\n\n  } else {\n    // quick test helps in the case when there are no chars to replace, in\n    // worst case this makes barely a difference to the time taken\n    if (!goog.string.internal.ALL_RE_.test(str)) return str;\n\n    // str.indexOf is faster than regex.test in this case\n    if (str.indexOf('&') != -1) {\n      str = str.replace(goog.string.internal.AMP_RE_, '&amp;');\n    }\n    if (str.indexOf('<') != -1) {\n      str = str.replace(goog.string.internal.LT_RE_, '&lt;');\n    }\n    if (str.indexOf('>') != -1) {\n      str = str.replace(goog.string.internal.GT_RE_, '&gt;');\n    }\n    if (str.indexOf('\"') != -1) {\n      str = str.replace(goog.string.internal.QUOT_RE_, '&quot;');\n    }\n    if (str.indexOf('\\'') != -1) {\n      str = str.replace(goog.string.internal.SINGLE_QUOTE_RE_, '&#39;');\n    }\n    if (str.indexOf('\\x00') != -1) {\n      str = str.replace(goog.string.internal.NULL_RE_, '&#0;');\n    }\n    return str;\n  }\n};\n\n\n/**\n * Regular expression that matches an ampersand, for use in escaping.\n * @const {!RegExp}\n * @private\n */\ngoog.string.internal.AMP_RE_ = /&/g;\n\n\n/**\n * Regular expression that matches a less than sign, for use in escaping.\n * @const {!RegExp}\n * @private\n */\ngoog.string.internal.LT_RE_ = /</g;\n\n\n/**\n * Regular expression that matches a greater than sign, for use in escaping.\n * @const {!RegExp}\n * @private\n */\ngoog.string.internal.GT_RE_ = />/g;\n\n\n/**\n * Regular expression that matches a double quote, for use in escaping.\n * @const {!RegExp}\n * @private\n */\ngoog.string.internal.QUOT_RE_ = /\"/g;\n\n\n/**\n * Regular expression that matches a single quote, for use in escaping.\n * @const {!RegExp}\n * @private\n */\ngoog.string.internal.SINGLE_QUOTE_RE_ = /'/g;\n\n\n/**\n * Regular expression that matches null character, for use in escaping.\n * @const {!RegExp}\n * @private\n */\ngoog.string.internal.NULL_RE_ = /\\x00/g;\n\n\n/**\n * Regular expression that matches any character that needs to be escaped.\n * @const {!RegExp}\n * @private\n */\ngoog.string.internal.ALL_RE_ = /[\\x00&<>\"']/;\n\n\n/**\n * Do escaping of whitespace to preserve spatial formatting. We use character\n * entity #160 to make it safer for xml.\n * @param {string} str The string in which to escape whitespace.\n * @param {boolean=} opt_xml Whether to use XML compatible tags.\n * @return {string} An escaped copy of `str`.\n * @see goog.string.whitespaceEscape\n */\ngoog.string.internal.whitespaceEscape = function(str, opt_xml) {\n  // This doesn't use goog.string.preserveSpaces for backwards compatibility.\n  return goog.string.internal.newLineToBr(\n      str.replace(/  /g, ' &#160;'), opt_xml);\n};\n\n\n/**\n * Determines whether a string contains a substring.\n * @param {string} str The string to search.\n * @param {string} subString The substring to search for.\n * @return {boolean} Whether `str` contains `subString`.\n * @see goog.string.contains\n */\ngoog.string.internal.contains = function(str, subString) {\n  return str.indexOf(subString) != -1;\n};\n\n\n/**\n * Determines whether a string contains a substring, ignoring case.\n * @param {string} str The string to search.\n * @param {string} subString The substring to search for.\n * @return {boolean} Whether `str` contains `subString`.\n * @see goog.string.caseInsensitiveContains\n */\ngoog.string.internal.caseInsensitiveContains = function(str, subString) {\n  return goog.string.internal.contains(\n      str.toLowerCase(), subString.toLowerCase());\n};\n\n\n/**\n * Compares two version numbers.\n *\n * @param {string|number} version1 Version of first item.\n * @param {string|number} version2 Version of second item.\n *\n * @return {number}  1 if `version1` is higher.\n *                   0 if arguments are equal.\n *                  -1 if `version2` is higher.\n * @see goog.string.compareVersions\n */\ngoog.string.internal.compareVersions = function(version1, version2) {\n  var order = 0;\n  // Trim leading and trailing whitespace and split the versions into\n  // subversions.\n  var v1Subs = goog.string.internal.trim(String(version1)).split('.');\n  var v2Subs = goog.string.internal.trim(String(version2)).split('.');\n  var subCount = Math.max(v1Subs.length, v2Subs.length);\n\n  // Iterate over the subversions, as long as they appear to be equivalent.\n  for (var subIdx = 0; order == 0 && subIdx < subCount; subIdx++) {\n    var v1Sub = v1Subs[subIdx] || '';\n    var v2Sub = v2Subs[subIdx] || '';\n\n    do {\n      // Split the subversions into pairs of numbers and qualifiers (like 'b').\n      // Two different RegExp objects are use to make it clear the code\n      // is side-effect free\n      var v1Comp = /(\\d*)(\\D*)(.*)/.exec(v1Sub) || ['', '', '', ''];\n      var v2Comp = /(\\d*)(\\D*)(.*)/.exec(v2Sub) || ['', '', '', ''];\n      // Break if there are no more matches.\n      if (v1Comp[0].length == 0 && v2Comp[0].length == 0) {\n        break;\n      }\n\n      // Parse the numeric part of the subversion. A missing number is\n      // equivalent to 0.\n      var v1CompNum = v1Comp[1].length == 0 ? 0 : parseInt(v1Comp[1], 10);\n      var v2CompNum = v2Comp[1].length == 0 ? 0 : parseInt(v2Comp[1], 10);\n\n      // Compare the subversion components. The number has the highest\n      // precedence. Next, if the numbers are equal, a subversion without any\n      // qualifier is always higher than a subversion with any qualifier. Next,\n      // the qualifiers are compared as strings.\n      order = goog.string.internal.compareElements_(v1CompNum, v2CompNum) ||\n          goog.string.internal.compareElements_(\n              v1Comp[2].length == 0, v2Comp[2].length == 0) ||\n          goog.string.internal.compareElements_(v1Comp[2], v2Comp[2]);\n      // Stop as soon as an inequality is discovered.\n\n      v1Sub = v1Comp[3];\n      v2Sub = v2Comp[3];\n    } while (order == 0);\n  }\n\n  return order;\n};\n\n\n/**\n * Compares elements of a version number.\n *\n * @param {string|number|boolean} left An element from a version number.\n * @param {string|number|boolean} right An element from a version number.\n *\n * @return {number}  1 if `left` is higher.\n *                   0 if arguments are equal.\n *                  -1 if `right` is higher.\n * @private\n */\ngoog.string.internal.compareElements_ = function(left, right) {\n  if (left < right) {\n    return -1;\n  } else if (left > right) {\n    return 1;\n  }\n  return 0;\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview The SafeUrl type and its builders.\n *\n * TODO(xtof): Link to document stating type contract.\n */\n\ngoog.provide('goog.html.SafeUrl');\n\ngoog.require('goog.asserts');\ngoog.require('goog.fs.url');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.html.trustedtypes');\ngoog.require('goog.i18n.bidi.Dir');\ngoog.require('goog.i18n.bidi.DirectionalString');\ngoog.require('goog.string.Const');\ngoog.require('goog.string.TypedString');\ngoog.require('goog.string.internal');\n\n\n\n/**\n * A string that is safe to use in URL context in DOM APIs and HTML documents.\n *\n * A SafeUrl is a string-like object that carries the security type contract\n * that its value as a string will not cause untrusted script execution\n * when evaluated as a hyperlink URL in a browser.\n *\n * Values of this type are guaranteed to be safe to use in URL/hyperlink\n * contexts, such as assignment to URL-valued DOM properties, in the sense that\n * the use will not result in a Cross-Site-Scripting vulnerability. Similarly,\n * SafeUrls can be interpolated into the URL context of an HTML template (e.g.,\n * inside a href attribute). However, appropriate HTML-escaping must still be\n * applied.\n *\n * Note that, as documented in `goog.html.SafeUrl.unwrap`, this type's\n * contract does not guarantee that instances are safe to interpolate into HTML\n * without appropriate escaping.\n *\n * Note also that this type's contract does not imply any guarantees regarding\n * the resource the URL refers to.  In particular, SafeUrls are <b>not</b>\n * safe to use in a context where the referred-to resource is interpreted as\n * trusted code, e.g., as the src of a script tag.\n *\n * Instances of this type must be created via the factory methods\n * (`goog.html.SafeUrl.fromConstant`, `goog.html.SafeUrl.sanitize`),\n * etc and not by invoking its constructor.  The constructor intentionally\n * takes no parameters and the type is immutable; hence only a default instance\n * corresponding to the empty string can be obtained via constructor invocation.\n *\n * @see goog.html.SafeUrl#fromConstant\n * @see goog.html.SafeUrl#from\n * @see goog.html.SafeUrl#sanitize\n * @constructor\n * @final\n * @struct\n * @implements {goog.i18n.bidi.DirectionalString}\n * @implements {goog.string.TypedString}\n */\ngoog.html.SafeUrl = function() {\n  /**\n   * The contained value of this SafeUrl.  The field has a purposely ugly\n   * name to make (non-compiled) code that attempts to directly access this\n   * field stand out.\n   * @private {!TrustedURL|string}\n   */\n  this.privateDoNotAccessOrElseSafeUrlWrappedValue_ = '';\n\n  /**\n   * A type marker used to implement additional run-time type checking.\n   * @see goog.html.SafeUrl#unwrap\n   * @const {!Object}\n   * @private\n   */\n  this.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_ =\n      goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_;\n};\n\n\n/**\n * The innocuous string generated by goog.html.SafeUrl.sanitize when passed\n * an unsafe URL.\n *\n * about:invalid is registered in\n * http://www.w3.org/TR/css3-values/#about-invalid.\n * http://tools.ietf.org/html/rfc6694#section-2.2.1 permits about URLs to\n * contain a fragment, which is not to be considered when determining if an\n * about URL is well-known.\n *\n * Using about:invalid seems preferable to using a fixed data URL, since\n * browsers might choose to not report CSP violations on it, as legitimate\n * CSS function calls to attr() can result in this URL being produced. It is\n * also a standard URL which matches exactly the semantics we need:\n * \"The about:invalid URI references a non-existent document with a generic\n * error condition. It can be used when a URI is necessary, but the default\n * value shouldn't be resolveable as any type of document\".\n *\n * @const {string}\n */\ngoog.html.SafeUrl.INNOCUOUS_STRING = 'about:invalid#zClosurez';\n\n\n/**\n * @override\n * @const\n */\ngoog.html.SafeUrl.prototype.implementsGoogStringTypedString = true;\n\n\n/**\n * Returns this SafeUrl's value a string.\n *\n * IMPORTANT: In code where it is security relevant that an object's type is\n * indeed `SafeUrl`, use `goog.html.SafeUrl.unwrap` instead of this\n * method. If in doubt, assume that it's security relevant. In particular, note\n * that goog.html functions which return a goog.html type do not guarantee that\n * the returned instance is of the right type.\n *\n * IMPORTANT: The guarantees of the SafeUrl type contract only extend to the\n * behavior of browsers when interpreting URLs. Values of SafeUrl objects MUST\n * be appropriately escaped before embedding in a HTML document. Note that the\n * required escaping is context-sensitive (e.g. a different escaping is\n * required for embedding a URL in a style property within a style\n * attribute, as opposed to embedding in a href attribute).\n *\n * @see goog.html.SafeUrl#unwrap\n * @override\n */\ngoog.html.SafeUrl.prototype.getTypedStringValue = function() {\n  return this.privateDoNotAccessOrElseSafeUrlWrappedValue_.toString();\n};\n\n\n/**\n * @override\n * @const\n */\ngoog.html.SafeUrl.prototype.implementsGoogI18nBidiDirectionalString = true;\n\n\n/**\n * Returns this URLs directionality, which is always `LTR`.\n * @override\n */\ngoog.html.SafeUrl.prototype.getDirection = function() {\n  return goog.i18n.bidi.Dir.LTR;\n};\n\n\nif (goog.DEBUG) {\n  /**\n   * Returns a debug string-representation of this value.\n   *\n   * To obtain the actual string value wrapped in a SafeUrl, use\n   * `goog.html.SafeUrl.unwrap`.\n   *\n   * @see goog.html.SafeUrl#unwrap\n   * @override\n   */\n  goog.html.SafeUrl.prototype.toString = function() {\n    return 'SafeUrl{' + this.privateDoNotAccessOrElseSafeUrlWrappedValue_ + '}';\n  };\n}\n\n\n/**\n * Performs a runtime check that the provided object is indeed a SafeUrl\n * object, and returns its value.\n *\n * IMPORTANT: The guarantees of the SafeUrl type contract only extend to the\n * behavior of  browsers when interpreting URLs. Values of SafeUrl objects MUST\n * be appropriately escaped before embedding in a HTML document. Note that the\n * required escaping is context-sensitive (e.g. a different escaping is\n * required for embedding a URL in a style property within a style\n * attribute, as opposed to embedding in a href attribute).\n *\n * @param {!goog.html.SafeUrl} safeUrl The object to extract from.\n * @return {string} The SafeUrl object's contained string, unless the run-time\n *     type check fails. In that case, `unwrap` returns an innocuous\n *     string, or, if assertions are enabled, throws\n *     `goog.asserts.AssertionError`.\n */\ngoog.html.SafeUrl.unwrap = function(safeUrl) {\n  return goog.html.SafeUrl.unwrapTrustedURL(safeUrl).toString();\n};\n\n\n/**\n * Unwraps value as TrustedURL if supported or as a string if not.\n * @param {!goog.html.SafeUrl} safeUrl\n * @return {!TrustedURL|string}\n * @see goog.html.SafeUrl.unwrap\n */\ngoog.html.SafeUrl.unwrapTrustedURL = function(safeUrl) {\n  // Perform additional Run-time type-checking to ensure that safeUrl is indeed\n  // an instance of the expected type.  This provides some additional protection\n  // against security bugs due to application code that disables type checks.\n  // Specifically, the following checks are performed:\n  // 1. The object is an instance of the expected type.\n  // 2. The object is not an instance of a subclass.\n  // 3. The object carries a type marker for the expected type. \"Faking\" an\n  // object requires a reference to the type marker, which has names intended\n  // to stand out in code reviews.\n  if (safeUrl instanceof goog.html.SafeUrl &&\n      safeUrl.constructor === goog.html.SafeUrl &&\n      safeUrl.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_ ===\n          goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_) {\n    return safeUrl.privateDoNotAccessOrElseSafeUrlWrappedValue_;\n  } else {\n    goog.asserts.fail('expected object of type SafeUrl, got \\'' +\n        safeUrl + '\\' of type ' + goog.typeOf(safeUrl));\n    return 'type_error:SafeUrl';\n  }\n};\n\n\n/**\n * Creates a SafeUrl object from a compile-time constant string.\n *\n * Compile-time constant strings are inherently program-controlled and hence\n * trusted.\n *\n * @param {!goog.string.Const} url A compile-time-constant string from which to\n *         create a SafeUrl.\n * @return {!goog.html.SafeUrl} A SafeUrl object initialized to `url`.\n */\ngoog.html.SafeUrl.fromConstant = function(url) {\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n      goog.string.Const.unwrap(url));\n};\n\n\n/**\n * A pattern that matches Blob or data types that can have SafeUrls created\n * from URL.createObjectURL(blob) or via a data: URI.\n *\n * This has some parameter support (most notably, we haven't implemented the\n * more complex parts like %-encoded characters or non-alphanumerical ones for\n * simplicity's sake). The specs are fairly complex, and they don't\n * always match Chrome's behavior: we settled on a subset where we're confident\n * all parties involved agree.\n *\n * The spec is available at https://mimesniff.spec.whatwg.org/ (and see\n * https://tools.ietf.org/html/rfc2397 for data: urls, which override some of\n * it).\n * @const\n * @private\n */\ngoog.html.SAFE_MIME_TYPE_PATTERN_ = new RegExp(\n    // Note: Due to content-sniffing concerns, only add MIME types for\n    // media formats.\n    '^(?:audio/(?:3gpp2|3gpp|aac|L16|midi|mp3|mp4|mpeg|oga|ogg|opus|x-m4a|x-wav|wav|webm)|' +\n        'image/(?:bmp|gif|jpeg|jpg|png|tiff|webp|x-icon)|' +\n        // TODO(b/68188949): Due to content-sniffing concerns, text/csv should\n        // be removed from the whitelist.\n        'text/csv|' +\n        'video/(?:mpeg|mp4|ogg|webm|quicktime))' +\n        '(?:;\\\\w+=(?:\\\\w+|\"[\\\\w;=]+\"))*$',  // MIME type parameters\n    'i');\n\n\n/**\n * @param {string} mimeType The MIME type to check if safe.\n * @return {boolean} True if the MIME type is safe and creating a Blob via\n *   `SafeUrl.fromBlob()` with that type will not fail due to the type. False\n *   otherwise.\n */\ngoog.html.SafeUrl.isSafeMimeType = function(mimeType) {\n  return goog.html.SAFE_MIME_TYPE_PATTERN_.test(mimeType);\n};\n\n\n/**\n * Creates a SafeUrl wrapping a blob URL for the given `blob`.\n *\n * The blob URL is created with `URL.createObjectURL`. If the MIME type\n * for `blob` is not of a known safe audio, image or video MIME type,\n * then the SafeUrl will wrap {@link #INNOCUOUS_STRING}.\n *\n * @see http://www.w3.org/TR/FileAPI/#url\n * @param {!Blob} blob\n * @return {!goog.html.SafeUrl} The blob URL, or an innocuous string wrapped\n *   as a SafeUrl.\n */\ngoog.html.SafeUrl.fromBlob = function(blob) {\n  var url = goog.html.SAFE_MIME_TYPE_PATTERN_.test(blob.type) ?\n      goog.fs.url.createObjectUrl(blob) :\n      goog.html.SafeUrl.INNOCUOUS_STRING;\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(url);\n};\n\n\n/**\n * Matches a base-64 data URL, with the first match group being the MIME type.\n * @const\n * @private\n */\ngoog.html.DATA_URL_PATTERN_ = /^data:([^,]*);base64,[a-z0-9+\\/]+=*$/i;\n\n\n/**\n * Creates a SafeUrl wrapping a data: URL, after validating it matches a\n * known-safe audio, image or video MIME type.\n *\n * @param {string} dataUrl A valid base64 data URL with one of the whitelisted\n *     audio, image or video MIME types.\n * @return {!goog.html.SafeUrl} A matching safe URL, or {@link INNOCUOUS_STRING}\n *     wrapped as a SafeUrl if it does not pass.\n */\ngoog.html.SafeUrl.fromDataUrl = function(dataUrl) {\n  // RFC4648 suggest to ignore CRLF in base64 encoding.\n  // See https://tools.ietf.org/html/rfc4648.\n  // Remove the CR (%0D) and LF (%0A) from the dataUrl.\n  var filteredDataUrl = dataUrl.replace(/(%0A|%0D)/g, '');\n  // There's a slight risk here that a browser sniffs the content type if it\n  // doesn't know the MIME type and executes HTML within the data: URL. For this\n  // to cause XSS it would also have to execute the HTML in the same origin\n  // of the page with the link. It seems unlikely that both of these will\n  // happen, particularly in not really old IEs.\n  var match = filteredDataUrl.match(goog.html.DATA_URL_PATTERN_);\n  var valid = match && goog.html.SAFE_MIME_TYPE_PATTERN_.test(match[1]);\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n      valid ? filteredDataUrl : goog.html.SafeUrl.INNOCUOUS_STRING);\n};\n\n\n/**\n * Creates a SafeUrl wrapping a tel: URL.\n *\n * @param {string} telUrl A tel URL.\n * @return {!goog.html.SafeUrl} A matching safe URL, or {@link INNOCUOUS_STRING}\n *     wrapped as a SafeUrl if it does not pass.\n */\ngoog.html.SafeUrl.fromTelUrl = function(telUrl) {\n  // There's a risk that a tel: URL could immediately place a call once\n  // clicked, without requiring user confirmation. For that reason it is\n  // handled in this separate function.\n  if (!goog.string.internal.caseInsensitiveStartsWith(telUrl, 'tel:')) {\n    telUrl = goog.html.SafeUrl.INNOCUOUS_STRING;\n  }\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n      telUrl);\n};\n\n\n/**\n * Matches a sip/sips URL. We only allow urls that consist of an email address.\n * The characters '?' and '#' are not allowed in the local part of the email\n * address.\n * @const\n * @private\n */\ngoog.html.SIP_URL_PATTERN_ = new RegExp(\n    '^sip[s]?:[+a-z0-9_.!$%&\\'*\\\\/=^`{|}~-]+@([a-z0-9-]+\\\\.)+[a-z0-9]{2,63}$',\n    'i');\n\n\n/**\n * Creates a SafeUrl wrapping a sip: URL. We only allow urls that consist of an\n * email address. The characters '?' and '#' are not allowed in the local part\n * of the email address.\n *\n * @param {string} sipUrl A sip URL.\n * @return {!goog.html.SafeUrl} A matching safe URL, or {@link INNOCUOUS_STRING}\n *     wrapped as a SafeUrl if it does not pass.\n */\ngoog.html.SafeUrl.fromSipUrl = function(sipUrl) {\n  if (!goog.html.SIP_URL_PATTERN_.test(decodeURIComponent(sipUrl))) {\n    sipUrl = goog.html.SafeUrl.INNOCUOUS_STRING;\n  }\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n      sipUrl);\n};\n\n\n/**\n * Creates a SafeUrl wrapping a fb-messenger://share URL.\n *\n * @param {string} facebookMessengerUrl A facebook messenger URL.\n * @return {!goog.html.SafeUrl} A matching safe URL, or {@link INNOCUOUS_STRING}\n *     wrapped as a SafeUrl if it does not pass.\n */\ngoog.html.SafeUrl.fromFacebookMessengerUrl = function(facebookMessengerUrl) {\n  if (!goog.string.internal.caseInsensitiveStartsWith(\n          facebookMessengerUrl, 'fb-messenger://share')) {\n    facebookMessengerUrl = goog.html.SafeUrl.INNOCUOUS_STRING;\n  }\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n      facebookMessengerUrl);\n};\n\n/**\n * Creates a SafeUrl wrapping a whatsapp://send URL.\n *\n * @param {string} whatsAppUrl A WhatsApp URL.\n * @return {!goog.html.SafeUrl} A matching safe URL, or {@link INNOCUOUS_STRING}\n *     wrapped as a SafeUrl if it does not pass.\n */\ngoog.html.SafeUrl.fromWhatsAppUrl = function(whatsAppUrl) {\n  if (!goog.string.internal.caseInsensitiveStartsWith(\n          whatsAppUrl, 'whatsapp://send')) {\n    whatsAppUrl = goog.html.SafeUrl.INNOCUOUS_STRING;\n  }\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n      whatsAppUrl);\n};\n\n/**\n * Creates a SafeUrl wrapping a sms: URL.\n *\n * @param {string} smsUrl A sms URL.\n * @return {!goog.html.SafeUrl} A matching safe URL, or {@link INNOCUOUS_STRING}\n *     wrapped as a SafeUrl if it does not pass.\n */\ngoog.html.SafeUrl.fromSmsUrl = function(smsUrl) {\n  if (!goog.string.internal.caseInsensitiveStartsWith(smsUrl, 'sms:') ||\n      !goog.html.SafeUrl.isSmsUrlBodyValid_(smsUrl)) {\n    smsUrl = goog.html.SafeUrl.INNOCUOUS_STRING;\n  }\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n      smsUrl);\n};\n\n\n/**\n * Validates SMS URL `body` parameter, which is optional and should appear at\n * most once and should be percent-encoded if present. Rejects many malformed\n * bodies, but may spuriously reject some URLs and does not reject all malformed\n * sms: URLs.\n *\n * @param {string} smsUrl A sms URL.\n * @return {boolean} Whether SMS URL has a valid `body` parameter if it exists.\n * @private\n */\ngoog.html.SafeUrl.isSmsUrlBodyValid_ = function(smsUrl) {\n  var hash = smsUrl.indexOf('#');\n  if (hash > 0) {\n    smsUrl = smsUrl.substring(0, hash);\n  }\n  var bodyParams = smsUrl.match(/[?&]body=/gi);\n  // \"body\" param is optional\n  if (!bodyParams) {\n    return true;\n  }\n  // \"body\" MUST only appear once\n  if (bodyParams.length > 1) {\n    return false;\n  }\n  // Get the encoded `body` parameter value.\n  var bodyValue = smsUrl.match(/[?&]body=([^&]*)/)[1];\n  if (!bodyValue) {\n    return true;\n  }\n  try {\n    decodeURIComponent(bodyValue);\n  } catch (error) {\n    return false;\n  }\n  return /^(?:[a-z0-9\\-_.~]|%[0-9a-f]{2})+$/i.test(bodyValue);\n};\n\n\n/**\n * Creates a SafeUrl wrapping a ssh: URL.\n *\n * @param {string} sshUrl A ssh URL.\n * @return {!goog.html.SafeUrl} A matching safe URL, or {@link INNOCUOUS_STRING}\n *     wrapped as a SafeUrl if it does not pass.\n */\ngoog.html.SafeUrl.fromSshUrl = function(sshUrl) {\n  if (!goog.string.internal.caseInsensitiveStartsWith(sshUrl, 'ssh://')) {\n    sshUrl = goog.html.SafeUrl.INNOCUOUS_STRING;\n  }\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n      sshUrl);\n};\n\n/**\n * Sanitizes a Chrome extension URL to SafeUrl, given a compile-time-constant\n * extension identifier. Can also be restricted to chrome extensions.\n *\n * @param {string} url The url to sanitize. Should start with the extension\n *     scheme and the extension identifier.\n * @param {!goog.string.Const|!Array<!goog.string.Const>} extensionId The\n *     extension id to accept, as a compile-time constant or an array of those.\n *\n * @return {!goog.html.SafeUrl} Either `url` if it's deemed safe, or\n *     `INNOCUOUS_STRING` if it's not.\n */\ngoog.html.SafeUrl.sanitizeChromeExtensionUrl = function(url, extensionId) {\n  return goog.html.SafeUrl.sanitizeExtensionUrl_(\n      /^chrome-extension:\\/\\/([^\\/]+)\\//, url, extensionId);\n};\n\n/**\n * Sanitizes a Firefox extension URL to SafeUrl, given a compile-time-constant\n * extension identifier. Can also be restricted to chrome extensions.\n *\n * @param {string} url The url to sanitize. Should start with the extension\n *     scheme and the extension identifier.\n * @param {!goog.string.Const|!Array<!goog.string.Const>} extensionId The\n *     extension id to accept, as a compile-time constant or an array of those.\n *\n * @return {!goog.html.SafeUrl} Either `url` if it's deemed safe, or\n *     `INNOCUOUS_STRING` if it's not.\n */\ngoog.html.SafeUrl.sanitizeFirefoxExtensionUrl = function(url, extensionId) {\n  return goog.html.SafeUrl.sanitizeExtensionUrl_(\n      /^moz-extension:\\/\\/([^\\/]+)\\//, url, extensionId);\n};\n\n/**\n * Sanitizes a Edge extension URL to SafeUrl, given a compile-time-constant\n * extension identifier. Can also be restricted to chrome extensions.\n *\n * @param {string} url The url to sanitize. Should start with the extension\n *     scheme and the extension identifier.\n * @param {!goog.string.Const|!Array<!goog.string.Const>} extensionId The\n *     extension id to accept, as a compile-time constant or an array of those.\n *\n * @return {!goog.html.SafeUrl} Either `url` if it's deemed safe, or\n *     `INNOCUOUS_STRING` if it's not.\n */\ngoog.html.SafeUrl.sanitizeEdgeExtensionUrl = function(url, extensionId) {\n  return goog.html.SafeUrl.sanitizeExtensionUrl_(\n      /^ms-browser-extension:\\/\\/([^\\/]+)\\//, url, extensionId);\n};\n\n/**\n * Private helper for converting extension URLs to SafeUrl, given the scheme for\n * that particular extension type. Use the sanitizeFirefoxExtensionUrl,\n * sanitizeChromeExtensionUrl or sanitizeEdgeExtensionUrl unless you're building\n * new helpers.\n *\n * @private\n * @param {!RegExp} scheme The scheme to accept as a RegExp extracting the\n *     extension identifier.\n * @param {string} url The url to sanitize. Should start with the extension\n *     scheme and the extension identifier.\n * @param {!goog.string.Const|!Array<!goog.string.Const>} extensionId The\n *     extension id to accept, as a compile-time constant or an array of those.\n *\n * @return {!goog.html.SafeUrl} Either `url` if it's deemed safe, or\n *     `INNOCUOUS_STRING` if it's not.\n */\ngoog.html.SafeUrl.sanitizeExtensionUrl_ = function(scheme, url, extensionId) {\n  var matches = scheme.exec(url);\n  if (!matches) {\n    url = goog.html.SafeUrl.INNOCUOUS_STRING;\n  } else {\n    var extractedExtensionId = matches[1];\n    var acceptedExtensionIds;\n    if (extensionId instanceof goog.string.Const) {\n      acceptedExtensionIds = [goog.string.Const.unwrap(extensionId)];\n    } else {\n      acceptedExtensionIds = extensionId.map(function unwrap(x) {\n        return goog.string.Const.unwrap(x);\n      });\n    }\n    if (acceptedExtensionIds.indexOf(extractedExtensionId) == -1) {\n      url = goog.html.SafeUrl.INNOCUOUS_STRING;\n    }\n  }\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(url);\n};\n\n\n/**\n * Creates a SafeUrl from TrustedResourceUrl. This is safe because\n * TrustedResourceUrl is more tightly restricted than SafeUrl.\n *\n * @param {!goog.html.TrustedResourceUrl} trustedResourceUrl\n * @return {!goog.html.SafeUrl}\n */\ngoog.html.SafeUrl.fromTrustedResourceUrl = function(trustedResourceUrl) {\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n      goog.html.TrustedResourceUrl.unwrap(trustedResourceUrl));\n};\n\n\n/**\n * A pattern that recognizes a commonly useful subset of URLs that satisfy\n * the SafeUrl contract.\n *\n * This regular expression matches a subset of URLs that will not cause script\n * execution if used in URL context within a HTML document. Specifically, this\n * regular expression matches if (comment from here on and regex copied from\n * Soy's EscapingConventions):\n * (1) Either a protocol in a whitelist (http, https, mailto or ftp).\n * (2) or no protocol.  A protocol must be followed by a colon. The below\n *     allows that by allowing colons only after one of the characters [/?#].\n *     A colon after a hash (#) must be in the fragment.\n *     Otherwise, a colon after a (?) must be in a query.\n *     Otherwise, a colon after a single solidus (/) must be in a path.\n *     Otherwise, a colon after a double solidus (//) must be in the authority\n *     (before port).\n *\n * @private\n * @const {!RegExp}\n */\ngoog.html.SAFE_URL_PATTERN_ =\n    /^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;\n\n/**\n * Public version of goog.html.SAFE_URL_PATTERN_. Updating\n * goog.html.SAFE_URL_PATTERN_ doesn't seem to be backward compatible.\n * Namespace is also changed to goog.html.SafeUrl so it can be imported using\n * goog.require('goog.dom.SafeUrl').\n *\n * TODO(bangert): Remove SAFE_URL_PATTERN_\n * @const {!RegExp}\n */\ngoog.html.SafeUrl.SAFE_URL_PATTERN = goog.html.SAFE_URL_PATTERN_;\n\n\n/**\n * Creates a SafeUrl object from `url`. If `url` is a\n * goog.html.SafeUrl then it is simply returned. Otherwise the input string is\n * validated to match a pattern of commonly used safe URLs.\n *\n * `url` may be a URL with the http, https, mailto or ftp scheme,\n * or a relative URL (i.e., a URL without a scheme; specifically, a\n * scheme-relative, absolute-path-relative, or path-relative URL).\n *\n * @see http://url.spec.whatwg.org/#concept-relative-url\n * @param {string|!goog.string.TypedString} url The URL to validate.\n * @return {!goog.html.SafeUrl} The validated URL, wrapped as a SafeUrl.\n */\ngoog.html.SafeUrl.sanitize = function(url) {\n  if (url instanceof goog.html.SafeUrl) {\n    return url;\n  } else if (typeof url == 'object' && url.implementsGoogStringTypedString) {\n    url = /** @type {!goog.string.TypedString} */ (url).getTypedStringValue();\n  } else {\n    url = String(url);\n  }\n  if (!goog.html.SAFE_URL_PATTERN_.test(url)) {\n    url = goog.html.SafeUrl.INNOCUOUS_STRING;\n  }\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(url);\n};\n\n/**\n * Creates a SafeUrl object from `url`. If `url` is a\n * goog.html.SafeUrl then it is simply returned. Otherwise the input string is\n * validated to match a pattern of commonly used safe URLs.\n *\n * `url` may be a URL with the http, https, mailto or ftp scheme,\n * or a relative URL (i.e., a URL without a scheme; specifically, a\n * scheme-relative, absolute-path-relative, or path-relative URL).\n *\n * This function asserts (using goog.asserts) that the URL matches this pattern.\n * If it does not, in addition to failing the assert, an innocous URL will be\n * returned.\n *\n * @see http://url.spec.whatwg.org/#concept-relative-url\n * @param {string|!goog.string.TypedString} url The URL to validate.\n * @param {boolean=} opt_allowDataUrl Whether to allow valid data: URLs.\n * @return {!goog.html.SafeUrl} The validated URL, wrapped as a SafeUrl.\n */\ngoog.html.SafeUrl.sanitizeAssertUnchanged = function(url, opt_allowDataUrl) {\n  if (url instanceof goog.html.SafeUrl) {\n    return url;\n  } else if (typeof url == 'object' && url.implementsGoogStringTypedString) {\n    url = /** @type {!goog.string.TypedString} */ (url).getTypedStringValue();\n  } else {\n    url = String(url);\n  }\n  if (opt_allowDataUrl && /^data:/i.test(url)) {\n    var safeUrl = goog.html.SafeUrl.fromDataUrl(url);\n    if (safeUrl.getTypedStringValue() == url) {\n      return safeUrl;\n    }\n  }\n  if (!goog.asserts.assert(\n          goog.html.SAFE_URL_PATTERN_.test(url),\n          '%s does not match the safe URL pattern', url)) {\n    url = goog.html.SafeUrl.INNOCUOUS_STRING;\n  }\n  return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(url);\n};\n\n\n\n/**\n * Type marker for the SafeUrl type, used to implement additional run-time\n * type checking.\n * @const {!Object}\n * @private\n */\ngoog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_ = {};\n\n\n/**\n * Package-internal utility method to create SafeUrl instances.\n *\n * @param {string} url The string to initialize the SafeUrl object with.\n * @return {!goog.html.SafeUrl} The initialized SafeUrl object.\n * @package\n */\ngoog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse = function(\n    url) {\n  var safeUrl = new goog.html.SafeUrl();\n  safeUrl.privateDoNotAccessOrElseSafeUrlWrappedValue_ =\n      goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY ?\n      goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createURL(\n          url) :\n      url;\n  return safeUrl;\n};\n\n\n/**\n * A SafeUrl corresponding to the special about:blank url.\n * @const {!goog.html.SafeUrl}\n */\ngoog.html.SafeUrl.ABOUT_BLANK =\n    goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(\n        'about:blank');\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Utilities used by goog.labs.userAgent tools. These functions\n * should not be used outside of goog.labs.userAgent.*.\n *\n * @author nnaze@google.com (Nathan Naze)\n */\n\ngoog.provide('goog.labs.userAgent.util');\n\ngoog.require('goog.string.internal');\n\n\n/**\n * Gets the native userAgent string from navigator if it exists.\n * If navigator or navigator.userAgent string is missing, returns an empty\n * string.\n * @return {string}\n * @private\n */\ngoog.labs.userAgent.util.getNativeUserAgentString_ = function() {\n  var navigator = goog.labs.userAgent.util.getNavigator_();\n  if (navigator) {\n    var userAgent = navigator.userAgent;\n    if (userAgent) {\n      return userAgent;\n    }\n  }\n  return '';\n};\n\n\n/**\n * Getter for the native navigator.\n * This is a separate function so it can be stubbed out in testing.\n * @return {Navigator}\n * @private\n */\ngoog.labs.userAgent.util.getNavigator_ = function() {\n  return goog.global.navigator;\n};\n\n\n/**\n * A possible override for applications which wish to not check\n * navigator.userAgent but use a specified value for detection instead.\n * @private {string}\n */\ngoog.labs.userAgent.util.userAgent_ =\n    goog.labs.userAgent.util.getNativeUserAgentString_();\n\n\n/**\n * Applications may override browser detection on the built in\n * navigator.userAgent object by setting this string. Set to null to use the\n * browser object instead.\n * @param {?string=} opt_userAgent The User-Agent override.\n */\ngoog.labs.userAgent.util.setUserAgent = function(opt_userAgent) {\n  goog.labs.userAgent.util.userAgent_ =\n      opt_userAgent || goog.labs.userAgent.util.getNativeUserAgentString_();\n};\n\n\n/**\n * @return {string} The user agent string.\n */\ngoog.labs.userAgent.util.getUserAgent = function() {\n  return goog.labs.userAgent.util.userAgent_;\n};\n\n\n/**\n * @param {string} str\n * @return {boolean} Whether the user agent contains the given string.\n */\ngoog.labs.userAgent.util.matchUserAgent = function(str) {\n  var userAgent = goog.labs.userAgent.util.getUserAgent();\n  return goog.string.internal.contains(userAgent, str);\n};\n\n\n/**\n * @param {string} str\n * @return {boolean} Whether the user agent contains the given string, ignoring\n *     case.\n */\ngoog.labs.userAgent.util.matchUserAgentIgnoreCase = function(str) {\n  var userAgent = goog.labs.userAgent.util.getUserAgent();\n  return goog.string.internal.caseInsensitiveContains(userAgent, str);\n};\n\n\n/**\n * Parses the user agent into tuples for each section.\n * @param {string} userAgent\n * @return {!Array<!Array<string>>} Tuples of key, version, and the contents\n *     of the parenthetical.\n */\ngoog.labs.userAgent.util.extractVersionTuples = function(userAgent) {\n  // Matches each section of a user agent string.\n  // Example UA:\n  // Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us)\n  // AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405\n  // This has three version tuples: Mozilla, AppleWebKit, and Mobile.\n\n  var versionRegExp = new RegExp(\n      // Key. Note that a key may have a space.\n      // (i.e. 'Mobile Safari' in 'Mobile Safari/5.0')\n      '(\\\\w[\\\\w ]+)' +\n\n          '/' +                // slash\n          '([^\\\\s]+)' +        // version (i.e. '5.0b')\n          '\\\\s*' +             // whitespace\n          '(?:\\\\((.*?)\\\\))?',  // parenthetical info. parentheses not matched.\n      'g');\n\n  var data = [];\n  var match;\n\n  // Iterate and collect the version tuples.  Each iteration will be the\n  // next regex match.\n  while (match = versionRegExp.exec(userAgent)) {\n    data.push([\n      match[1],  // key\n      match[2],  // value\n      // || undefined as this is not undefined in IE7 and IE8\n      match[3] || undefined  // info\n    ]);\n  }\n\n  return data;\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n/**\n * @fileoverview The SafeHtml type and its builders.\n *\n * TODO(xtof): Link to document stating type contract.\n */\n\ngoog.provide('goog.html.SafeHtml');\n\ngoog.require('goog.array');\ngoog.require('goog.asserts');\ngoog.require('goog.dom.TagName');\ngoog.require('goog.dom.tags');\ngoog.require('goog.html.SafeScript');\ngoog.require('goog.html.SafeStyle');\ngoog.require('goog.html.SafeStyleSheet');\ngoog.require('goog.html.SafeUrl');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.html.trustedtypes');\ngoog.require('goog.i18n.bidi.Dir');\ngoog.require('goog.i18n.bidi.DirectionalString');\ngoog.require('goog.labs.userAgent.browser');\ngoog.require('goog.object');\ngoog.require('goog.string.Const');\ngoog.require('goog.string.TypedString');\ngoog.require('goog.string.internal');\n\n\n\n/**\n * A string that is safe to use in HTML context in DOM APIs and HTML documents.\n *\n * A SafeHtml is a string-like object that carries the security type contract\n * that its value as a string will not cause untrusted script execution when\n * evaluated as HTML in a browser.\n *\n * Values of this type are guaranteed to be safe to use in HTML contexts,\n * such as, assignment to the innerHTML DOM property, or interpolation into\n * a HTML template in HTML PC_DATA context, in the sense that the use will not\n * result in a Cross-Site-Scripting vulnerability.\n *\n * Instances of this type must be created via the factory methods\n * (`goog.html.SafeHtml.create`, `goog.html.SafeHtml.htmlEscape`),\n * etc and not by invoking its constructor.  The constructor intentionally\n * takes no parameters and the type is immutable; hence only a default instance\n * corresponding to the empty string can be obtained via constructor invocation.\n *\n * Note that there is no `goog.html.SafeHtml.fromConstant`. The reason is that\n * the following code would create an unsafe HTML:\n *\n * ```\n * goog.html.SafeHtml.concat(\n *     goog.html.SafeHtml.fromConstant(goog.string.Const.from('<script>')),\n *     goog.html.SafeHtml.htmlEscape(userInput),\n *     goog.html.SafeHtml.fromConstant(goog.string.Const.from('<\\/script>')));\n * ```\n *\n * There's `goog.dom.constHtmlToNode` to create a node from constant strings\n * only.\n *\n * @see goog.html.SafeHtml.create\n * @see goog.html.SafeHtml.htmlEscape\n * @constructor\n * @final\n * @struct\n * @implements {goog.i18n.bidi.DirectionalString}\n * @implements {goog.string.TypedString}\n */\ngoog.html.SafeHtml = function() {\n  /**\n   * The contained value of this SafeHtml.  The field has a purposely ugly\n   * name to make (non-compiled) code that attempts to directly access this\n   * field stand out.\n   * @private {!TrustedHTML|string}\n   */\n  this.privateDoNotAccessOrElseSafeHtmlWrappedValue_ = '';\n\n  /**\n   * A type marker used to implement additional run-time type checking.\n   * @see goog.html.SafeHtml.unwrap\n   * @const {!Object}\n   * @private\n   */\n  this.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_ =\n      goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_;\n\n  /**\n   * This SafeHtml's directionality, or null if unknown.\n   * @private {?goog.i18n.bidi.Dir}\n   */\n  this.dir_ = null;\n};\n\n\n/**\n * @override\n * @const\n */\ngoog.html.SafeHtml.prototype.implementsGoogI18nBidiDirectionalString = true;\n\n\n/** @override */\ngoog.html.SafeHtml.prototype.getDirection = function() {\n  return this.dir_;\n};\n\n\n/**\n * @override\n * @const\n */\ngoog.html.SafeHtml.prototype.implementsGoogStringTypedString = true;\n\n\n/**\n * Returns this SafeHtml's value as string.\n *\n * IMPORTANT: In code where it is security relevant that an object's type is\n * indeed `SafeHtml`, use `goog.html.SafeHtml.unwrap` instead of\n * this method. If in doubt, assume that it's security relevant. In particular,\n * note that goog.html functions which return a goog.html type do not guarantee\n * that the returned instance is of the right type. For example:\n *\n * <pre>\n * var fakeSafeHtml = new String('fake');\n * fakeSafeHtml.__proto__ = goog.html.SafeHtml.prototype;\n * var newSafeHtml = goog.html.SafeHtml.htmlEscape(fakeSafeHtml);\n * // newSafeHtml is just an alias for fakeSafeHtml, it's passed through by\n * // goog.html.SafeHtml.htmlEscape() as fakeSafeHtml\n * // instanceof goog.html.SafeHtml.\n * </pre>\n *\n * @see goog.html.SafeHtml.unwrap\n * @override\n */\ngoog.html.SafeHtml.prototype.getTypedStringValue = function() {\n  return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_.toString();\n};\n\n\nif (goog.DEBUG) {\n  /**\n   * Returns a debug string-representation of this value.\n   *\n   * To obtain the actual string value wrapped in a SafeHtml, use\n   * `goog.html.SafeHtml.unwrap`.\n   *\n   * @see goog.html.SafeHtml.unwrap\n   * @override\n   */\n  goog.html.SafeHtml.prototype.toString = function() {\n    return 'SafeHtml{' + this.privateDoNotAccessOrElseSafeHtmlWrappedValue_ +\n        '}';\n  };\n}\n\n\n/**\n * Performs a runtime check that the provided object is indeed a SafeHtml\n * object, and returns its value.\n * @param {!goog.html.SafeHtml} safeHtml The object to extract from.\n * @return {string} The SafeHtml object's contained string, unless the run-time\n *     type check fails. In that case, `unwrap` returns an innocuous\n *     string, or, if assertions are enabled, throws\n *     `goog.asserts.AssertionError`.\n */\ngoog.html.SafeHtml.unwrap = function(safeHtml) {\n  return goog.html.SafeHtml.unwrapTrustedHTML(safeHtml).toString();\n};\n\n\n/**\n * Unwraps value as TrustedHTML if supported or as a string if not.\n * @param {!goog.html.SafeHtml} safeHtml\n * @return {!TrustedHTML|string}\n * @see goog.html.SafeHtml.unwrap\n */\ngoog.html.SafeHtml.unwrapTrustedHTML = function(safeHtml) {\n  // Perform additional run-time type-checking to ensure that safeHtml is indeed\n  // an instance of the expected type.  This provides some additional protection\n  // against security bugs due to application code that disables type checks.\n  // Specifically, the following checks are performed:\n  // 1. The object is an instance of the expected type.\n  // 2. The object is not an instance of a subclass.\n  // 3. The object carries a type marker for the expected type. \"Faking\" an\n  // object requires a reference to the type marker, which has names intended\n  // to stand out in code reviews.\n  if (safeHtml instanceof goog.html.SafeHtml &&\n      safeHtml.constructor === goog.html.SafeHtml &&\n      safeHtml.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_ ===\n          goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_) {\n    return safeHtml.privateDoNotAccessOrElseSafeHtmlWrappedValue_;\n  } else {\n    goog.asserts.fail('expected object of type SafeHtml, got \\'' +\n        safeHtml + '\\' of type ' + goog.typeOf(safeHtml));\n    return 'type_error:SafeHtml';\n  }\n};\n\n\n/**\n * Shorthand for union of types that can sensibly be converted to strings\n * or might already be SafeHtml (as SafeHtml is a goog.string.TypedString).\n * @private\n * @typedef {string|number|boolean|!goog.string.TypedString|\n *           !goog.i18n.bidi.DirectionalString}\n */\ngoog.html.SafeHtml.TextOrHtml_;\n\n\n/**\n * Returns HTML-escaped text as a SafeHtml object.\n *\n * If text is of a type that implements\n * `goog.i18n.bidi.DirectionalString`, the directionality of the new\n * `SafeHtml` object is set to `text`'s directionality, if known.\n * Otherwise, the directionality of the resulting SafeHtml is unknown (i.e.,\n * `null`).\n *\n * @param {!goog.html.SafeHtml.TextOrHtml_} textOrHtml The text to escape. If\n *     the parameter is of type SafeHtml it is returned directly (no escaping\n *     is done).\n * @return {!goog.html.SafeHtml} The escaped text, wrapped as a SafeHtml.\n */\ngoog.html.SafeHtml.htmlEscape = function(textOrHtml) {\n  if (textOrHtml instanceof goog.html.SafeHtml) {\n    return textOrHtml;\n  }\n  var textIsObject = typeof textOrHtml == 'object';\n  var dir = null;\n  if (textIsObject && textOrHtml.implementsGoogI18nBidiDirectionalString) {\n    dir = /** @type {!goog.i18n.bidi.DirectionalString} */ (textOrHtml)\n              .getDirection();\n  }\n  var textAsString;\n  if (textIsObject && textOrHtml.implementsGoogStringTypedString) {\n    textAsString = /** @type {!goog.string.TypedString} */ (textOrHtml)\n                       .getTypedStringValue();\n  } else {\n    textAsString = String(textOrHtml);\n  }\n  return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n      goog.string.internal.htmlEscape(textAsString), dir);\n};\n\n\n/**\n * Returns HTML-escaped text as a SafeHtml object, with newlines changed to\n * &lt;br&gt;.\n * @param {!goog.html.SafeHtml.TextOrHtml_} textOrHtml The text to escape. If\n *     the parameter is of type SafeHtml it is returned directly (no escaping\n *     is done).\n * @return {!goog.html.SafeHtml} The escaped text, wrapped as a SafeHtml.\n */\ngoog.html.SafeHtml.htmlEscapePreservingNewlines = function(textOrHtml) {\n  if (textOrHtml instanceof goog.html.SafeHtml) {\n    return textOrHtml;\n  }\n  var html = goog.html.SafeHtml.htmlEscape(textOrHtml);\n  return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n      goog.string.internal.newLineToBr(goog.html.SafeHtml.unwrap(html)),\n      html.getDirection());\n};\n\n\n/**\n * Returns HTML-escaped text as a SafeHtml object, with newlines changed to\n * &lt;br&gt; and escaping whitespace to preserve spatial formatting. Character\n * entity #160 is used to make it safer for XML.\n * @param {!goog.html.SafeHtml.TextOrHtml_} textOrHtml The text to escape. If\n *     the parameter is of type SafeHtml it is returned directly (no escaping\n *     is done).\n * @return {!goog.html.SafeHtml} The escaped text, wrapped as a SafeHtml.\n */\ngoog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces = function(\n    textOrHtml) {\n  if (textOrHtml instanceof goog.html.SafeHtml) {\n    return textOrHtml;\n  }\n  var html = goog.html.SafeHtml.htmlEscape(textOrHtml);\n  return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n      goog.string.internal.whitespaceEscape(goog.html.SafeHtml.unwrap(html)),\n      html.getDirection());\n};\n\n\n/**\n * Coerces an arbitrary object into a SafeHtml object.\n *\n * If `textOrHtml` is already of type `goog.html.SafeHtml`, the same\n * object is returned. Otherwise, `textOrHtml` is coerced to string, and\n * HTML-escaped. If `textOrHtml` is of a type that implements\n * `goog.i18n.bidi.DirectionalString`, its directionality, if known, is\n * preserved.\n *\n * @param {!goog.html.SafeHtml.TextOrHtml_} textOrHtml The text or SafeHtml to\n *     coerce.\n * @return {!goog.html.SafeHtml} The resulting SafeHtml object.\n * @deprecated Use goog.html.SafeHtml.htmlEscape.\n */\ngoog.html.SafeHtml.from = goog.html.SafeHtml.htmlEscape;\n\n\n/**\n * @const\n * @private\n */\ngoog.html.SafeHtml.VALID_NAMES_IN_TAG_ = /^[a-zA-Z0-9-]+$/;\n\n\n/**\n * Set of attributes containing URL as defined at\n * http://www.w3.org/TR/html5/index.html#attributes-1.\n * @private @const {!Object<string,boolean>}\n */\ngoog.html.SafeHtml.URL_ATTRIBUTES_ = goog.object.createSet(\n    'action', 'cite', 'data', 'formaction', 'href', 'manifest', 'poster',\n    'src');\n\n\n/**\n * Tags which are unsupported via create(). They might be supported via a\n * tag-specific create method. These are tags which might require a\n * TrustedResourceUrl in one of their attributes or a restricted type for\n * their content.\n * @private @const {!Object<string,boolean>}\n */\ngoog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_ = goog.object.createSet(\n    goog.dom.TagName.APPLET, goog.dom.TagName.BASE, goog.dom.TagName.EMBED,\n    goog.dom.TagName.IFRAME, goog.dom.TagName.LINK, goog.dom.TagName.MATH,\n    goog.dom.TagName.META, goog.dom.TagName.OBJECT, goog.dom.TagName.SCRIPT,\n    goog.dom.TagName.STYLE, goog.dom.TagName.SVG, goog.dom.TagName.TEMPLATE);\n\n\n/**\n * @typedef {string|number|goog.string.TypedString|\n *     goog.html.SafeStyle.PropertyMap|undefined}\n */\ngoog.html.SafeHtml.AttributeValue;\n\n\n/**\n * Creates a SafeHtml content consisting of a tag with optional attributes and\n * optional content.\n *\n * For convenience tag names and attribute names are accepted as regular\n * strings, instead of goog.string.Const. Nevertheless, you should not pass\n * user-controlled values to these parameters. Note that these parameters are\n * syntactically validated at runtime, and invalid values will result in\n * an exception.\n *\n * Example usage:\n *\n * goog.html.SafeHtml.create('br');\n * goog.html.SafeHtml.create('div', {'class': 'a'});\n * goog.html.SafeHtml.create('p', {}, 'a');\n * goog.html.SafeHtml.create('p', {}, goog.html.SafeHtml.create('br'));\n *\n * goog.html.SafeHtml.create('span', {\n *   'style': {'margin': '0'}\n * });\n *\n * To guarantee SafeHtml's type contract is upheld there are restrictions on\n * attribute values and tag names.\n *\n * - For attributes which contain script code (on*), a goog.string.Const is\n *   required.\n * - For attributes which contain style (style), a goog.html.SafeStyle or a\n *   goog.html.SafeStyle.PropertyMap is required.\n * - For attributes which are interpreted as URLs (e.g. src, href) a\n *   goog.html.SafeUrl, goog.string.Const or string is required. If a string\n *   is passed, it will be sanitized with SafeUrl.sanitize().\n * - For tags which can load code or set security relevant page metadata,\n *   more specific goog.html.SafeHtml.create*() functions must be used. Tags\n *   which are not supported by this function are applet, base, embed, iframe,\n *   link, math, object, script, style, svg, and template.\n *\n * @param {!goog.dom.TagName|string} tagName The name of the tag. Only tag names\n *     consisting of [a-zA-Z0-9-] are allowed. Tag names documented above are\n *     disallowed.\n * @param {?Object<string, ?goog.html.SafeHtml.AttributeValue>=} opt_attributes\n *     Mapping from attribute names to their values. Only attribute names\n *     consisting of [a-zA-Z0-9-] are allowed. Value of null or undefined causes\n *     the attribute to be omitted.\n * @param {!goog.html.SafeHtml.TextOrHtml_|\n *     !Array<!goog.html.SafeHtml.TextOrHtml_>=} opt_content Content to\n *     HTML-escape and put inside the tag. This must be empty for void tags\n *     like <br>. Array elements are concatenated.\n * @return {!goog.html.SafeHtml} The SafeHtml content with the tag.\n * @throws {Error} If invalid tag name, attribute name, or attribute value is\n *     provided.\n * @throws {goog.asserts.AssertionError} If content for void tag is provided.\n */\ngoog.html.SafeHtml.create = function(tagName, opt_attributes, opt_content) {\n  goog.html.SafeHtml.verifyTagName(String(tagName));\n  return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(\n      String(tagName), opt_attributes, opt_content);\n};\n\n\n/**\n * Verifies if the tag name is valid and if it doesn't change the context.\n * E.g. STRONG is fine but SCRIPT throws because it changes context. See\n * goog.html.SafeHtml.create for an explanation of allowed tags.\n * @param {string} tagName\n * @throws {Error} If invalid tag name is provided.\n * @package\n */\ngoog.html.SafeHtml.verifyTagName = function(tagName) {\n  if (!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(tagName)) {\n    throw new Error('Invalid tag name <' + tagName + '>.');\n  }\n  if (tagName.toUpperCase() in goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_) {\n    throw new Error('Tag name <' + tagName + '> is not allowed for SafeHtml.');\n  }\n};\n\n\n/**\n * Creates a SafeHtml representing an iframe tag.\n *\n * This by default restricts the iframe as much as possible by setting the\n * sandbox attribute to the empty string. If the iframe requires less\n * restrictions, set the sandbox attribute as tight as possible, but do not rely\n * on the sandbox as a security feature because it is not supported by older\n * browsers. If a sandbox is essential to security (e.g. for third-party\n * frames), use createSandboxIframe which checks for browser support.\n *\n * @see https://developer.mozilla.org/en/docs/Web/HTML/Element/iframe#attr-sandbox\n *\n * @param {?goog.html.TrustedResourceUrl=} opt_src The value of the src\n *     attribute. If null or undefined src will not be set.\n * @param {?goog.html.SafeHtml=} opt_srcdoc The value of the srcdoc attribute.\n *     If null or undefined srcdoc will not be set.\n * @param {?Object<string, ?goog.html.SafeHtml.AttributeValue>=} opt_attributes\n *     Mapping from attribute names to their values. Only attribute names\n *     consisting of [a-zA-Z0-9-] are allowed. Value of null or undefined causes\n *     the attribute to be omitted.\n * @param {!goog.html.SafeHtml.TextOrHtml_|\n *     !Array<!goog.html.SafeHtml.TextOrHtml_>=} opt_content Content to\n *     HTML-escape and put inside the tag. Array elements are concatenated.\n * @return {!goog.html.SafeHtml} The SafeHtml content with the tag.\n * @throws {Error} If invalid tag name, attribute name, or attribute value is\n *     provided. If opt_attributes contains the src or srcdoc attributes.\n */\ngoog.html.SafeHtml.createIframe = function(\n    opt_src, opt_srcdoc, opt_attributes, opt_content) {\n  if (opt_src) {\n    // Check whether this is really TrustedResourceUrl.\n    goog.html.TrustedResourceUrl.unwrap(opt_src);\n  }\n\n  var fixedAttributes = {};\n  fixedAttributes['src'] = opt_src || null;\n  fixedAttributes['srcdoc'] =\n      opt_srcdoc && goog.html.SafeHtml.unwrap(opt_srcdoc);\n  var defaultAttributes = {'sandbox': ''};\n  var attributes = goog.html.SafeHtml.combineAttributes(\n      fixedAttributes, defaultAttributes, opt_attributes);\n  return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(\n      'iframe', attributes, opt_content);\n};\n\n\n/**\n * Creates a SafeHtml representing a sandboxed iframe tag.\n *\n * The sandbox attribute is enforced in its most restrictive mode, an empty\n * string. Consequently, the security requirements for the src and srcdoc\n * attributes are relaxed compared to SafeHtml.createIframe. This function\n * will throw on browsers that do not support the sandbox attribute, as\n * determined by SafeHtml.canUseSandboxIframe.\n *\n * The SafeHtml returned by this function can trigger downloads with no\n * user interaction on Chrome (though only a few, further attempts are blocked).\n * Firefox and IE will block all downloads from the sandbox.\n *\n * @see https://developer.mozilla.org/en/docs/Web/HTML/Element/iframe#attr-sandbox\n * @see https://lists.w3.org/Archives/Public/public-whatwg-archive/2013Feb/0112.html\n *\n * @param {string|!goog.html.SafeUrl=} opt_src The value of the src\n *     attribute. If null or undefined src will not be set.\n * @param {string=} opt_srcdoc The value of the srcdoc attribute.\n *     If null or undefined srcdoc will not be set. Will not be sanitized.\n * @param {!Object<string, ?goog.html.SafeHtml.AttributeValue>=} opt_attributes\n *     Mapping from attribute names to their values. Only attribute names\n *     consisting of [a-zA-Z0-9-] are allowed. Value of null or undefined causes\n *     the attribute to be omitted.\n * @param {!goog.html.SafeHtml.TextOrHtml_|\n *     !Array<!goog.html.SafeHtml.TextOrHtml_>=} opt_content Content to\n *     HTML-escape and put inside the tag. Array elements are concatenated.\n * @return {!goog.html.SafeHtml} The SafeHtml content with the tag.\n * @throws {Error} If invalid tag name, attribute name, or attribute value is\n *     provided. If opt_attributes contains the src, srcdoc or sandbox\n *     attributes. If browser does not support the sandbox attribute on iframe.\n */\ngoog.html.SafeHtml.createSandboxIframe = function(\n    opt_src, opt_srcdoc, opt_attributes, opt_content) {\n  if (!goog.html.SafeHtml.canUseSandboxIframe()) {\n    throw new Error('The browser does not support sandboxed iframes.');\n  }\n\n  var fixedAttributes = {};\n  if (opt_src) {\n    // Note that sanitize is a no-op on SafeUrl.\n    fixedAttributes['src'] =\n        goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(opt_src));\n  } else {\n    fixedAttributes['src'] = null;\n  }\n  fixedAttributes['srcdoc'] = opt_srcdoc || null;\n  fixedAttributes['sandbox'] = '';\n  var attributes =\n      goog.html.SafeHtml.combineAttributes(fixedAttributes, {}, opt_attributes);\n  return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(\n      'iframe', attributes, opt_content);\n};\n\n\n/**\n * Checks if the user agent supports sandboxed iframes.\n * @return {boolean}\n */\ngoog.html.SafeHtml.canUseSandboxIframe = function() {\n  return goog.global['HTMLIFrameElement'] &&\n      ('sandbox' in goog.global['HTMLIFrameElement'].prototype);\n};\n\n\n/**\n * Creates a SafeHtml representing a script tag with the src attribute.\n * @param {!goog.html.TrustedResourceUrl} src The value of the src\n * attribute.\n * @param {?Object<string, ?goog.html.SafeHtml.AttributeValue>=}\n * opt_attributes\n *     Mapping from attribute names to their values. Only attribute names\n *     consisting of [a-zA-Z0-9-] are allowed. Value of null or undefined\n *     causes the attribute to be omitted.\n * @return {!goog.html.SafeHtml} The SafeHtml content with the tag.\n * @throws {Error} If invalid attribute name or value is provided. If\n *     opt_attributes contains the src attribute.\n */\ngoog.html.SafeHtml.createScriptSrc = function(src, opt_attributes) {\n  // TODO(mlourenco): The charset attribute should probably be blocked. If\n  // its value is attacker controlled, the script contains attacker controlled\n  // sub-strings (even if properly escaped) and the server does not set charset\n  // then XSS is likely possible.\n  // https://html.spec.whatwg.org/multipage/scripting.html#dom-script-charset\n\n  // Check whether this is really TrustedResourceUrl.\n  goog.html.TrustedResourceUrl.unwrap(src);\n\n  var fixedAttributes = {'src': src};\n  var defaultAttributes = {};\n  var attributes = goog.html.SafeHtml.combineAttributes(\n      fixedAttributes, defaultAttributes, opt_attributes);\n  return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(\n      'script', attributes);\n};\n\n\n/**\n * Creates a SafeHtml representing a script tag. Does not allow the language,\n * src, text or type attributes to be set.\n * @param {!goog.html.SafeScript|!Array<!goog.html.SafeScript>}\n *     script Content to put inside the tag. Array elements are\n *     concatenated.\n * @param {?Object<string, ?goog.html.SafeHtml.AttributeValue>=} opt_attributes\n *     Mapping from attribute names to their values. Only attribute names\n *     consisting of [a-zA-Z0-9-] are allowed. Value of null or undefined causes\n *     the attribute to be omitted.\n * @return {!goog.html.SafeHtml} The SafeHtml content with the tag.\n * @throws {Error} If invalid attribute name or attribute value is provided. If\n *     opt_attributes contains the language, src, text or type attribute.\n */\ngoog.html.SafeHtml.createScript = function(script, opt_attributes) {\n  for (var attr in opt_attributes) {\n    var attrLower = attr.toLowerCase();\n    if (attrLower == 'language' || attrLower == 'src' || attrLower == 'text' ||\n        attrLower == 'type') {\n      throw new Error('Cannot set \"' + attrLower + '\" attribute');\n    }\n  }\n\n  var content = '';\n  script = goog.array.concat(script);\n  for (var i = 0; i < script.length; i++) {\n    content += goog.html.SafeScript.unwrap(script[i]);\n  }\n  // Convert to SafeHtml so that it's not HTML-escaped. This is safe because\n  // as part of its contract, SafeScript should have no dangerous '<'.\n  var htmlContent =\n      goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n          content, goog.i18n.bidi.Dir.NEUTRAL);\n  return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(\n      'script', opt_attributes, htmlContent);\n};\n\n\n/**\n * Creates a SafeHtml representing a style tag. The type attribute is set\n * to \"text/css\".\n * @param {!goog.html.SafeStyleSheet|!Array<!goog.html.SafeStyleSheet>}\n *     styleSheet Content to put inside the tag. Array elements are\n *     concatenated.\n * @param {?Object<string, ?goog.html.SafeHtml.AttributeValue>=} opt_attributes\n *     Mapping from attribute names to their values. Only attribute names\n *     consisting of [a-zA-Z0-9-] are allowed. Value of null or undefined causes\n *     the attribute to be omitted.\n * @return {!goog.html.SafeHtml} The SafeHtml content with the tag.\n * @throws {Error} If invalid attribute name or attribute value is provided. If\n *     opt_attributes contains the type attribute.\n */\ngoog.html.SafeHtml.createStyle = function(styleSheet, opt_attributes) {\n  var fixedAttributes = {'type': 'text/css'};\n  var defaultAttributes = {};\n  var attributes = goog.html.SafeHtml.combineAttributes(\n      fixedAttributes, defaultAttributes, opt_attributes);\n\n  var content = '';\n  styleSheet = goog.array.concat(styleSheet);\n  for (var i = 0; i < styleSheet.length; i++) {\n    content += goog.html.SafeStyleSheet.unwrap(styleSheet[i]);\n  }\n  // Convert to SafeHtml so that it's not HTML-escaped. This is safe because\n  // as part of its contract, SafeStyleSheet should have no dangerous '<'.\n  var htmlContent =\n      goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n          content, goog.i18n.bidi.Dir.NEUTRAL);\n  return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(\n      'style', attributes, htmlContent);\n};\n\n\n/**\n * Creates a SafeHtml representing a meta refresh tag.\n * @param {!goog.html.SafeUrl|string} url Where to redirect. If a string is\n *     passed, it will be sanitized with SafeUrl.sanitize().\n * @param {number=} opt_secs Number of seconds until the page should be\n *     reloaded. Will be set to 0 if unspecified.\n * @return {!goog.html.SafeHtml} The SafeHtml content with the tag.\n */\ngoog.html.SafeHtml.createMetaRefresh = function(url, opt_secs) {\n\n  // Note that sanitize is a no-op on SafeUrl.\n  var unwrappedUrl = goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(url));\n\n  if (goog.labs.userAgent.browser.isIE() ||\n      goog.labs.userAgent.browser.isEdge()) {\n    // IE/EDGE can't parse the content attribute if the url contains a\n    // semicolon. We can fix this by adding quotes around the url, but then we\n    // can't parse quotes in the URL correctly. Also, it seems that IE/EDGE\n    // did not unescape semicolons in these URLs at some point in the past. We\n    // take a best-effort approach.\n    //\n    // If the URL has semicolons (which may happen in some cases, see\n    // http://www.w3.org/TR/1999/REC-html401-19991224/appendix/notes.html#h-B.2\n    // for instance), wrap it in single quotes to protect the semicolons.\n    // If the URL has semicolons and single quotes, url-encode the single quotes\n    // as well.\n    //\n    // This is imperfect. Notice that both ' and ; are reserved characters in\n    // URIs, so this could do the wrong thing, but at least it will do the wrong\n    // thing in only rare cases.\n    if (goog.string.internal.contains(unwrappedUrl, ';')) {\n      unwrappedUrl = \"'\" + unwrappedUrl.replace(/'/g, '%27') + \"'\";\n    }\n  }\n  var attributes = {\n    'http-equiv': 'refresh',\n    'content': (opt_secs || 0) + '; url=' + unwrappedUrl\n  };\n\n  // This function will handle the HTML escaping for attributes.\n  return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(\n      'meta', attributes);\n};\n\n\n/**\n * @param {string} tagName The tag name.\n * @param {string} name The attribute name.\n * @param {!goog.html.SafeHtml.AttributeValue} value The attribute value.\n * @return {string} A \"name=value\" string.\n * @throws {Error} If attribute value is unsafe for the given tag and attribute.\n * @private\n */\ngoog.html.SafeHtml.getAttrNameAndValue_ = function(tagName, name, value) {\n  // If it's goog.string.Const, allow any valid attribute name.\n  if (value instanceof goog.string.Const) {\n    value = goog.string.Const.unwrap(value);\n  } else if (name.toLowerCase() == 'style') {\n    value = goog.html.SafeHtml.getStyleValue_(value);\n  } else if (/^on/i.test(name)) {\n    // TODO(jakubvrana): Disallow more attributes with a special meaning.\n    throw new Error(\n        'Attribute \"' + name + '\" requires goog.string.Const value, \"' + value +\n        '\" given.');\n    // URL attributes handled differently according to tag.\n  } else if (name.toLowerCase() in goog.html.SafeHtml.URL_ATTRIBUTES_) {\n    if (value instanceof goog.html.TrustedResourceUrl) {\n      value = goog.html.TrustedResourceUrl.unwrap(value);\n    } else if (value instanceof goog.html.SafeUrl) {\n      value = goog.html.SafeUrl.unwrap(value);\n    } else if (goog.isString(value)) {\n      value = goog.html.SafeUrl.sanitize(value).getTypedStringValue();\n    } else {\n      throw new Error(\n          'Attribute \"' + name + '\" on tag \"' + tagName +\n          '\" requires goog.html.SafeUrl, goog.string.Const, or string,' +\n          ' value \"' + value + '\" given.');\n    }\n  }\n\n  // Accept SafeUrl, TrustedResourceUrl, etc. for attributes which only require\n  // HTML-escaping.\n  if (value.implementsGoogStringTypedString) {\n    // Ok to call getTypedStringValue() since there's no reliance on the type\n    // contract for security here.\n    value =\n        /** @type {!goog.string.TypedString} */ (value).getTypedStringValue();\n  }\n\n  goog.asserts.assert(\n      goog.isString(value) || goog.isNumber(value),\n      'String or number value expected, got ' + (typeof value) +\n          ' with value: ' + value);\n  return name + '=\"' + goog.string.internal.htmlEscape(String(value)) + '\"';\n};\n\n\n/**\n * Gets value allowed in \"style\" attribute.\n * @param {!goog.html.SafeHtml.AttributeValue} value It could be SafeStyle or a\n *     map which will be passed to goog.html.SafeStyle.create.\n * @return {string} Unwrapped value.\n * @throws {Error} If string value is given.\n * @private\n */\ngoog.html.SafeHtml.getStyleValue_ = function(value) {\n  if (!goog.isObject(value)) {\n    throw new Error(\n        'The \"style\" attribute requires goog.html.SafeStyle or map ' +\n        'of style properties, ' + (typeof value) + ' given: ' + value);\n  }\n  if (!(value instanceof goog.html.SafeStyle)) {\n    // Process the property bag into a style object.\n    value = goog.html.SafeStyle.create(value);\n  }\n  return goog.html.SafeStyle.unwrap(value);\n};\n\n\n/**\n * Creates a SafeHtml content with known directionality consisting of a tag with\n * optional attributes and optional content.\n * @param {!goog.i18n.bidi.Dir} dir Directionality.\n * @param {string} tagName\n * @param {?Object<string, ?goog.html.SafeHtml.AttributeValue>=} opt_attributes\n * @param {!goog.html.SafeHtml.TextOrHtml_|\n *     !Array<!goog.html.SafeHtml.TextOrHtml_>=} opt_content\n * @return {!goog.html.SafeHtml} The SafeHtml content with the tag.\n */\ngoog.html.SafeHtml.createWithDir = function(\n    dir, tagName, opt_attributes, opt_content) {\n  var html = goog.html.SafeHtml.create(tagName, opt_attributes, opt_content);\n  html.dir_ = dir;\n  return html;\n};\n\n\n/**\n * Creates a new SafeHtml object by joining the parts with separator.\n * @param {!goog.html.SafeHtml.TextOrHtml_} separator\n * @param {!Array<!goog.html.SafeHtml.TextOrHtml_|\n *     !Array<!goog.html.SafeHtml.TextOrHtml_>>} parts Parts to join. If a part\n *     contains an array then each member of this array is also joined with the\n *     separator.\n * @return {!goog.html.SafeHtml}\n */\ngoog.html.SafeHtml.join = function(separator, parts) {\n  var separatorHtml = goog.html.SafeHtml.htmlEscape(separator);\n  var dir = separatorHtml.getDirection();\n  var content = [];\n\n  /**\n   * @param {!goog.html.SafeHtml.TextOrHtml_|\n   *     !Array<!goog.html.SafeHtml.TextOrHtml_>} argument\n   */\n  var addArgument = function(argument) {\n    if (goog.isArray(argument)) {\n      goog.array.forEach(argument, addArgument);\n    } else {\n      var html = goog.html.SafeHtml.htmlEscape(argument);\n      content.push(goog.html.SafeHtml.unwrap(html));\n      var htmlDir = html.getDirection();\n      if (dir == goog.i18n.bidi.Dir.NEUTRAL) {\n        dir = htmlDir;\n      } else if (htmlDir != goog.i18n.bidi.Dir.NEUTRAL && dir != htmlDir) {\n        dir = null;\n      }\n    }\n  };\n\n  goog.array.forEach(parts, addArgument);\n  return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n      content.join(goog.html.SafeHtml.unwrap(separatorHtml)), dir);\n};\n\n\n/**\n * Creates a new SafeHtml object by concatenating values.\n * @param {...(!goog.html.SafeHtml.TextOrHtml_|\n *     !Array<!goog.html.SafeHtml.TextOrHtml_>)} var_args Values to concatenate.\n * @return {!goog.html.SafeHtml}\n */\ngoog.html.SafeHtml.concat = function(var_args) {\n  return goog.html.SafeHtml.join(\n      goog.html.SafeHtml.EMPTY, Array.prototype.slice.call(arguments));\n};\n\n\n/**\n * Creates a new SafeHtml object with known directionality by concatenating the\n * values.\n * @param {!goog.i18n.bidi.Dir} dir Directionality.\n * @param {...(!goog.html.SafeHtml.TextOrHtml_|\n *     !Array<!goog.html.SafeHtml.TextOrHtml_>)} var_args Elements of array\n *     arguments would be processed recursively.\n * @return {!goog.html.SafeHtml}\n */\ngoog.html.SafeHtml.concatWithDir = function(dir, var_args) {\n  var html = goog.html.SafeHtml.concat(goog.array.slice(arguments, 1));\n  html.dir_ = dir;\n  return html;\n};\n\n\n/**\n * Type marker for the SafeHtml type, used to implement additional run-time\n * type checking.\n * @const {!Object}\n * @private\n */\ngoog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_ = {};\n\n\n/**\n * Package-internal utility method to create SafeHtml instances.\n *\n * @param {string} html The string to initialize the SafeHtml object with.\n * @param {?goog.i18n.bidi.Dir} dir The directionality of the SafeHtml to be\n *     constructed, or null if unknown.\n * @return {!goog.html.SafeHtml} The initialized SafeHtml object.\n * @package\n */\ngoog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse = function(\n    html, dir) {\n  return new goog.html.SafeHtml().initSecurityPrivateDoNotAccessOrElse_(\n      html, dir);\n};\n\n\n/**\n * Called from createSafeHtmlSecurityPrivateDoNotAccessOrElse(). This\n * method exists only so that the compiler can dead code eliminate static\n * fields (like EMPTY) when they're not accessed.\n * @param {string} html\n * @param {?goog.i18n.bidi.Dir} dir\n * @return {!goog.html.SafeHtml}\n * @private\n */\ngoog.html.SafeHtml.prototype.initSecurityPrivateDoNotAccessOrElse_ = function(\n    html, dir) {\n  this.privateDoNotAccessOrElseSafeHtmlWrappedValue_ =\n      goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY ?\n      goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createHTML(\n          html) :\n      html;\n  this.dir_ = dir;\n  return this;\n};\n\n\n/**\n * Like create() but does not restrict which tags can be constructed.\n *\n * @param {string} tagName Tag name. Set or validated by caller.\n * @param {?Object<string, ?goog.html.SafeHtml.AttributeValue>=} opt_attributes\n * @param {(!goog.html.SafeHtml.TextOrHtml_|\n *     !Array<!goog.html.SafeHtml.TextOrHtml_>)=} opt_content\n * @return {!goog.html.SafeHtml}\n * @throws {Error} If invalid or unsafe attribute name or value is provided.\n * @throws {goog.asserts.AssertionError} If content for void tag is provided.\n * @package\n */\ngoog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse = function(\n    tagName, opt_attributes, opt_content) {\n  var dir = null;\n  var result = '<' + tagName;\n  result += goog.html.SafeHtml.stringifyAttributes(tagName, opt_attributes);\n\n  var content = opt_content;\n  if (!goog.isDefAndNotNull(content)) {\n    content = [];\n  } else if (!goog.isArray(content)) {\n    content = [content];\n  }\n\n  if (goog.dom.tags.isVoidTag(tagName.toLowerCase())) {\n    goog.asserts.assert(\n        !content.length, 'Void tag <' + tagName + '> does not allow content.');\n    result += '>';\n  } else {\n    var html = goog.html.SafeHtml.concat(content);\n    result += '>' + goog.html.SafeHtml.unwrap(html) + '</' + tagName + '>';\n    dir = html.getDirection();\n  }\n\n  var dirAttribute = opt_attributes && opt_attributes['dir'];\n  if (dirAttribute) {\n    if (/^(ltr|rtl|auto)$/i.test(dirAttribute)) {\n      // If the tag has the \"dir\" attribute specified then its direction is\n      // neutral because it can be safely used in any context.\n      dir = goog.i18n.bidi.Dir.NEUTRAL;\n    } else {\n      dir = null;\n    }\n  }\n\n  return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n      result, dir);\n};\n\n\n/**\n * Creates a string with attributes to insert after tagName.\n * @param {string} tagName\n * @param {?Object<string, ?goog.html.SafeHtml.AttributeValue>=} opt_attributes\n * @return {string} Returns an empty string if there are no attributes, returns\n *     a string starting with a space otherwise.\n * @throws {Error} If attribute value is unsafe for the given tag and attribute.\n * @package\n */\ngoog.html.SafeHtml.stringifyAttributes = function(tagName, opt_attributes) {\n  var result = '';\n  if (opt_attributes) {\n    for (var name in opt_attributes) {\n      if (!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(name)) {\n        throw new Error('Invalid attribute name \"' + name + '\".');\n      }\n      var value = opt_attributes[name];\n      if (!goog.isDefAndNotNull(value)) {\n        continue;\n      }\n      result +=\n          ' ' + goog.html.SafeHtml.getAttrNameAndValue_(tagName, name, value);\n    }\n  }\n  return result;\n};\n\n\n/**\n * @param {!Object<string, ?goog.html.SafeHtml.AttributeValue>} fixedAttributes\n * @param {!Object<string, string>} defaultAttributes\n * @param {?Object<string, ?goog.html.SafeHtml.AttributeValue>=} opt_attributes\n *     Optional attributes passed to create*().\n * @return {!Object<string, ?goog.html.SafeHtml.AttributeValue>}\n * @throws {Error} If opt_attributes contains an attribute with the same name\n *     as an attribute in fixedAttributes.\n * @package\n */\ngoog.html.SafeHtml.combineAttributes = function(\n    fixedAttributes, defaultAttributes, opt_attributes) {\n  var combinedAttributes = {};\n  var name;\n\n  for (name in fixedAttributes) {\n    goog.asserts.assert(name.toLowerCase() == name, 'Must be lower case');\n    combinedAttributes[name] = fixedAttributes[name];\n  }\n  for (name in defaultAttributes) {\n    goog.asserts.assert(name.toLowerCase() == name, 'Must be lower case');\n    combinedAttributes[name] = defaultAttributes[name];\n  }\n\n  for (name in opt_attributes) {\n    var nameLower = name.toLowerCase();\n    if (nameLower in fixedAttributes) {\n      throw new Error(\n          'Cannot override \"' + nameLower + '\" attribute, got \"' + name +\n          '\" with value \"' + opt_attributes[name] + '\"');\n    }\n    if (nameLower in defaultAttributes) {\n      delete combinedAttributes[nameLower];\n    }\n    combinedAttributes[name] = opt_attributes[name];\n  }\n\n  return combinedAttributes;\n};\n\n\n/**\n * A SafeHtml instance corresponding to the HTML doctype: \"<!DOCTYPE html>\".\n * @const {!goog.html.SafeHtml}\n */\ngoog.html.SafeHtml.DOCTYPE_HTML =\n    goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n        '<!DOCTYPE html>', goog.i18n.bidi.Dir.NEUTRAL);\n\n\n/**\n * A SafeHtml instance corresponding to the empty string.\n * @const {!goog.html.SafeHtml}\n */\ngoog.html.SafeHtml.EMPTY =\n    goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n        '', goog.i18n.bidi.Dir.NEUTRAL);\n\n\n/**\n * A SafeHtml instance corresponding to the <br> tag.\n * @const {!goog.html.SafeHtml}\n */\ngoog.html.SafeHtml.BR =\n    goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(\n        '<br>', goog.i18n.bidi.Dir.NEUTRAL);\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Provides a function to schedule running a function as soon\n * as possible after the current JS execution stops and yields to the event\n * loop.\n *\n */\n\ngoog.provide('goog.async.nextTick');\ngoog.provide('goog.async.throwException');\n\ngoog.require('goog.debug.entryPointRegistry');\ngoog.require('goog.dom.TagName');\ngoog.require('goog.dom.safe');\ngoog.require('goog.functions');\ngoog.require('goog.html.SafeHtml');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.labs.userAgent.browser');\ngoog.require('goog.labs.userAgent.engine');\ngoog.require('goog.string.Const');\n\n\n/**\n * Throw an item without interrupting the current execution context.  For\n * example, if processing a group of items in a loop, sometimes it is useful\n * to report an error while still allowing the rest of the batch to be\n * processed.\n * @param {*} exception\n */\ngoog.async.throwException = function(exception) {\n  // Each throw needs to be in its own context.\n  goog.global.setTimeout(function() { throw exception; }, 0);\n};\n\n\n/**\n * Fires the provided callbacks as soon as possible after the current JS\n * execution context. setTimeout(, 0) takes at least 4ms when called from\n * within another setTimeout(, 0) for legacy reasons.\n *\n * This will not schedule the callback as a microtask (i.e. a task that can\n * preempt user input or networking callbacks). It is meant to emulate what\n * setTimeout(_, 0) would do if it were not throttled. If you desire microtask\n * behavior, use {@see goog.Promise} instead.\n *\n * @param {function(this:SCOPE)} callback Callback function to fire as soon as\n *     possible.\n * @param {SCOPE=} opt_context Object in whose scope to call the listener.\n * @param {boolean=} opt_useSetImmediate Avoid the IE workaround that\n *     ensures correctness at the cost of speed. See comments for details.\n * @template SCOPE\n */\ngoog.async.nextTick = function(callback, opt_context, opt_useSetImmediate) {\n  var cb = callback;\n  if (opt_context) {\n    cb = goog.bind(callback, opt_context);\n  }\n  cb = goog.async.nextTick.wrapCallback_(cb);\n  // Note we do allow callers to also request setImmediate if they are willing\n  // to accept the possible tradeoffs of incorrectness in exchange for speed.\n  // The IE fallback of readystate change is much slower. See useSetImmediate_\n  // for details.\n  if (goog.isFunction(goog.global.setImmediate) &&\n      (opt_useSetImmediate || goog.async.nextTick.useSetImmediate_())) {\n    goog.global.setImmediate(cb);\n    return;\n  }\n\n  // Look for and cache the custom fallback version of setImmediate.\n  if (!goog.async.nextTick.setImmediate_) {\n    goog.async.nextTick.setImmediate_ =\n        goog.async.nextTick.getSetImmediateEmulator_();\n  }\n  goog.async.nextTick.setImmediate_(cb);\n};\n\n\n/**\n * Returns whether should use setImmediate implementation currently on window.\n *\n * window.setImmediate was introduced and currently only supported by IE10+,\n * but due to a bug in the implementation it is not guaranteed that\n * setImmediate is faster than setTimeout nor that setImmediate N is before\n * setImmediate N+1. That is why we do not use the native version if\n * available. We do, however, call setImmediate if it is a non-native function\n * because that indicates that it has been replaced by goog.testing.MockClock\n * which we do want to support.\n * See\n * http://connect.microsoft.com/IE/feedback/details/801823/setimmediate-and-messagechannel-are-broken-in-ie10\n *\n * @return {boolean} Whether to use the implementation of setImmediate defined\n *     on Window.\n * @private\n * @suppress {missingProperties} For \"Window.prototype.setImmediate\"\n */\ngoog.async.nextTick.useSetImmediate_ = function() {\n  // Not a browser environment.\n  if (!goog.global.Window || !goog.global.Window.prototype) {\n    return true;\n  }\n\n  // MS Edge has window.setImmediate natively, but it's not on Window.prototype.\n  // Also, there's no clean way to detect if the goog.global.setImmediate has\n  // been replaced by mockClock as its replacement also shows up as \"[native\n  // code]\" when using toString. Therefore, just always use\n  // goog.global.setImmediate for Edge. It's unclear if it suffers the same\n  // issues as IE10/11, but based on\n  // https://dev.modern.ie/testdrive/demos/setimmediatesorting/\n  // it seems they've been working to ensure it's WAI.\n  if (goog.labs.userAgent.browser.isEdge() ||\n      goog.global.Window.prototype.setImmediate != goog.global.setImmediate) {\n    // Something redefined setImmediate in which case we decide to use it (This\n    // is so that we use the mockClock setImmediate).\n    return true;\n  }\n\n  return false;\n};\n\n\n/**\n * Cache for the setImmediate implementation.\n * @type {function(function())}\n * @private\n */\ngoog.async.nextTick.setImmediate_;\n\n\n/**\n * Determines the best possible implementation to run a function as soon as\n * the JS event loop is idle.\n * @return {function(function())} The \"setImmediate\" implementation.\n * @private\n */\ngoog.async.nextTick.getSetImmediateEmulator_ = function() {\n  // Create a private message channel and use it to postMessage empty messages\n  // to ourselves.\n  /** @type {!Function|undefined} */\n  var Channel = goog.global['MessageChannel'];\n  // If MessageChannel is not available and we are in a browser, implement\n  // an iframe based polyfill in browsers that have postMessage and\n  // document.addEventListener. The latter excludes IE8 because it has a\n  // synchronous postMessage implementation.\n  if (typeof Channel === 'undefined' && typeof window !== 'undefined' &&\n      window.postMessage && window.addEventListener &&\n      // Presto (The old pre-blink Opera engine) has problems with iframes\n      // and contentWindow.\n      !goog.labs.userAgent.engine.isPresto()) {\n    /** @constructor */\n    Channel = function() {\n      // Make an empty, invisible iframe.\n      var iframe = /** @type {!HTMLIFrameElement} */ (\n          document.createElement(String(goog.dom.TagName.IFRAME)));\n      iframe.style.display = 'none';\n      goog.dom.safe.setIframeSrc(\n          iframe,\n          goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.EMPTY));\n      document.documentElement.appendChild(iframe);\n      var win = iframe.contentWindow;\n      var doc = win.document;\n      doc.open();\n      goog.dom.safe.documentWrite(doc, goog.html.SafeHtml.EMPTY);\n      doc.close();\n      // Do not post anything sensitive over this channel, as the workaround for\n      // pages with file: origin could allow that information to be modified or\n      // intercepted.\n      var message = 'callImmediate' + Math.random();\n      // The same origin policy rejects attempts to postMessage from file: urls\n      // unless the origin is '*'.\n      var origin = win.location.protocol == 'file:' ?\n          '*' :\n          win.location.protocol + '//' + win.location.host;\n      var onmessage = goog.bind(function(e) {\n        // Validate origin and message to make sure that this message was\n        // intended for us. If the origin is set to '*' (see above) only the\n        // message needs to match since, for example, '*' != 'file://'. Allowing\n        // the wildcard is ok, as we are not concerned with security here.\n        if ((origin != '*' && e.origin != origin) || e.data != message) {\n          return;\n        }\n        this['port1'].onmessage();\n      }, this);\n      win.addEventListener('message', onmessage, false);\n      this['port1'] = {};\n      this['port2'] = {\n        postMessage: function() { win.postMessage(message, origin); }\n      };\n    };\n  }\n  if (typeof Channel !== 'undefined' && !goog.labs.userAgent.browser.isIE()) {\n    // Exclude all of IE due to\n    // http://codeforhire.com/2013/09/21/setimmediate-and-messagechannel-broken-on-internet-explorer-10/\n    // which allows starving postMessage with a busy setTimeout loop.\n    // This currently affects IE10 and IE11 which would otherwise be able\n    // to use the postMessage based fallbacks.\n    var channel = new Channel();\n    // Use a fifo linked list to call callbacks in the right order.\n    var head = {};\n    var tail = head;\n    channel['port1'].onmessage = function() {\n      if (goog.isDef(head.next)) {\n        head = head.next;\n        var cb = head.cb;\n        head.cb = null;\n        cb();\n      }\n    };\n    return function(cb) {\n      tail.next = {cb: cb};\n      tail = tail.next;\n      channel['port2'].postMessage(0);\n    };\n  }\n  // Implementation for IE6 to IE10: Script elements fire an asynchronous\n  // onreadystatechange event when inserted into the DOM.\n  if (typeof document !== 'undefined' &&\n      'onreadystatechange' in\n          document.createElement(String(goog.dom.TagName.SCRIPT))) {\n    return function(cb) {\n      var script = /** @type {!HTMLScriptElement} */ (\n          document.createElement(String(goog.dom.TagName.SCRIPT)));\n      script.onreadystatechange = function() {\n        // Clean up and call the callback.\n        script.onreadystatechange = null;\n        script.parentNode.removeChild(script);\n        script = null;\n        cb();\n        cb = null;\n      };\n      document.documentElement.appendChild(script);\n    };\n  }\n  // Fall back to setTimeout with 0. In browsers this creates a delay of 5ms\n  // or more.\n  // NOTE(user): This fallback is used for IE11.\n  return function(cb) {\n    goog.global.setTimeout(/** @type {function()} */ (cb), 0);\n  };\n};\n\n\n/**\n * Helper function that is overrided to protect callbacks with entry point\n * monitor if the application monitors entry points.\n * @param {function()} callback Callback function to fire as soon as possible.\n * @return {function()} The wrapped callback.\n * @private\n */\ngoog.async.nextTick.wrapCallback_ = goog.functions.identity;\n\n\n// Register the callback function as an entry point, so that it can be\n// monitored for exception handling, etc. This has to be done in this file\n// since it requires special code to handle all browsers.\ngoog.debug.entryPointRegistry.register(\n    /**\n     * @param {function(!Function): !Function} transformer The transforming\n     *     function.\n     */\n    function(transformer) { goog.async.nextTick.wrapCallback_ = transformer; });\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\ngoog.provide('goog.async.run');\n\ngoog.require('goog.async.WorkQueue');\ngoog.require('goog.async.nextTick');\ngoog.require('goog.async.throwException');\n\n/**\n * @define {boolean} If true, use the global Promise to implement goog.async.run\n * assuming either the native, or polyfill version will be used. Does still\n * permit tests to use forceNextTick.\n */\ngoog.ASSUME_NATIVE_PROMISE = goog.define('goog.ASSUME_NATIVE_PROMISE', false);\n\n/**\n * Fires the provided callback just before the current callstack unwinds, or as\n * soon as possible after the current JS execution context.\n * @param {function(this:THIS)} callback\n * @param {THIS=} opt_context Object to use as the \"this value\" when calling\n *     the provided function.\n * @template THIS\n */\ngoog.async.run = function(callback, opt_context) {\n  if (!goog.async.run.schedule_) {\n    goog.async.run.initializeRunner_();\n  }\n  if (!goog.async.run.workQueueScheduled_) {\n    // Nothing is currently scheduled, schedule it now.\n    goog.async.run.schedule_();\n    goog.async.run.workQueueScheduled_ = true;\n  }\n\n  goog.async.run.workQueue_.add(callback, opt_context);\n};\n\n\n/**\n * Initializes the function to use to process the work queue.\n * @private\n */\ngoog.async.run.initializeRunner_ = function() {\n  if (goog.ASSUME_NATIVE_PROMISE ||\n      (goog.global.Promise && goog.global.Promise.resolve)) {\n    // Use goog.global.Promise instead of just Promise because the relevant\n    // externs may be missing, and don't alias it because this could confuse the\n    // compiler into thinking the polyfill is required when it should be treated\n    // as optional.\n    var promise = goog.global.Promise.resolve(undefined);\n    goog.async.run.schedule_ = function() {\n      promise.then(goog.async.run.processWorkQueue);\n    };\n  } else {\n    goog.async.run.schedule_ = function() {\n      goog.async.nextTick(goog.async.run.processWorkQueue);\n    };\n  }\n};\n\n\n/**\n * Forces goog.async.run to use nextTick instead of Promise.\n *\n * This should only be done in unit tests. It's useful because MockClock\n * replaces nextTick, but not the browser Promise implementation, so it allows\n * Promise-based code to be tested with MockClock.\n *\n * However, we also want to run promises if the MockClock is no longer in\n * control so we schedule a backup \"setTimeout\" to the unmocked timeout if\n * provided.\n *\n * @param {function(function())=} opt_realSetTimeout\n */\ngoog.async.run.forceNextTick = function(opt_realSetTimeout) {\n  goog.async.run.schedule_ = function() {\n    goog.async.nextTick(goog.async.run.processWorkQueue);\n    if (opt_realSetTimeout) {\n      opt_realSetTimeout(goog.async.run.processWorkQueue);\n    }\n  };\n};\n\n\n/**\n * The function used to schedule work asynchronousely.\n * @private {function()}\n */\ngoog.async.run.schedule_;\n\n\n/** @private {boolean} */\ngoog.async.run.workQueueScheduled_ = false;\n\n\n/** @private {!goog.async.WorkQueue} */\ngoog.async.run.workQueue_ = new goog.async.WorkQueue();\n\n\nif (goog.DEBUG) {\n  /**\n   * Reset the work queue. Only available for tests in debug mode.\n   */\n  goog.async.run.resetQueue = function() {\n    goog.async.run.workQueueScheduled_ = false;\n    goog.async.run.workQueue_ = new goog.async.WorkQueue();\n  };\n}\n\n\n/**\n * Run any pending goog.async.run work items. This function is not intended\n * for general use, but for use by entry point handlers to run items ahead of\n * goog.async.nextTick.\n */\ngoog.async.run.processWorkQueue = function() {\n  // NOTE: additional work queue items may be added while processing.\n  var item = null;\n  while (item = goog.async.run.workQueue_.remove()) {\n    try {\n      item.fn.call(item.scope);\n    } catch (e) {\n      goog.async.throwException(e);\n    }\n    goog.async.run.workQueue_.returnUnused(item);\n  }\n\n  // There are no more work items, allow processing to be scheduled again.\n  goog.async.run.workQueueScheduled_ = false;\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Utilities for string manipulation.\n * @author arv@google.com (Erik Arvidsson)\n */\n\n\n/**\n * Namespace for string utilities\n */\ngoog.provide('goog.string');\ngoog.provide('goog.string.Unicode');\n\ngoog.require('goog.dom.safe');\ngoog.require('goog.html.uncheckedconversions');\ngoog.require('goog.string.Const');\ngoog.require('goog.string.internal');\n\n\n/**\n * @define {boolean} Enables HTML escaping of lowercase letter \"e\" which helps\n * with detection of double-escaping as this letter is frequently used.\n */\ngoog.string.DETECT_DOUBLE_ESCAPING =\n    goog.define('goog.string.DETECT_DOUBLE_ESCAPING', false);\n\n\n/**\n * @define {boolean} Whether to force non-dom html unescaping.\n */\ngoog.string.FORCE_NON_DOM_HTML_UNESCAPING =\n    goog.define('goog.string.FORCE_NON_DOM_HTML_UNESCAPING', false);\n\n\n/**\n * Common Unicode string characters.\n * @enum {string}\n */\ngoog.string.Unicode = {\n  NBSP: '\\xa0'\n};\n\n\n/**\n * Fast prefix-checker.\n * @param {string} str The string to check.\n * @param {string} prefix A string to look for at the start of `str`.\n * @return {boolean} True if `str` begins with `prefix`.\n */\ngoog.string.startsWith = goog.string.internal.startsWith;\n\n\n/**\n * Fast suffix-checker.\n * @param {string} str The string to check.\n * @param {string} suffix A string to look for at the end of `str`.\n * @return {boolean} True if `str` ends with `suffix`.\n */\ngoog.string.endsWith = goog.string.internal.endsWith;\n\n\n/**\n * Case-insensitive prefix-checker.\n * @param {string} str The string to check.\n * @param {string} prefix  A string to look for at the end of `str`.\n * @return {boolean} True if `str` begins with `prefix` (ignoring\n *     case).\n */\ngoog.string.caseInsensitiveStartsWith =\n    goog.string.internal.caseInsensitiveStartsWith;\n\n\n/**\n * Case-insensitive suffix-checker.\n * @param {string} str The string to check.\n * @param {string} suffix A string to look for at the end of `str`.\n * @return {boolean} True if `str` ends with `suffix` (ignoring\n *     case).\n */\ngoog.string.caseInsensitiveEndsWith =\n    goog.string.internal.caseInsensitiveEndsWith;\n\n\n/**\n * Case-insensitive equality checker.\n * @param {string} str1 First string to check.\n * @param {string} str2 Second string to check.\n * @return {boolean} True if `str1` and `str2` are the same string,\n *     ignoring case.\n */\ngoog.string.caseInsensitiveEquals = goog.string.internal.caseInsensitiveEquals;\n\n\n/**\n * Does simple python-style string substitution.\n * subs(\"foo%s hot%s\", \"bar\", \"dog\") becomes \"foobar hotdog\".\n * @param {string} str The string containing the pattern.\n * @param {...*} var_args The items to substitute into the pattern.\n * @return {string} A copy of `str` in which each occurrence of\n *     {@code %s} has been replaced an argument from `var_args`.\n */\ngoog.string.subs = function(str, var_args) {\n  var splitParts = str.split('%s');\n  var returnString = '';\n\n  var subsArguments = Array.prototype.slice.call(arguments, 1);\n  while (subsArguments.length &&\n         // Replace up to the last split part. We are inserting in the\n         // positions between split parts.\n         splitParts.length > 1) {\n    returnString += splitParts.shift() + subsArguments.shift();\n  }\n\n  return returnString + splitParts.join('%s');  // Join unused '%s'\n};\n\n\n/**\n * Converts multiple whitespace chars (spaces, non-breaking-spaces, new lines\n * and tabs) to a single space, and strips leading and trailing whitespace.\n * @param {string} str Input string.\n * @return {string} A copy of `str` with collapsed whitespace.\n */\ngoog.string.collapseWhitespace = function(str) {\n  // Since IE doesn't include non-breaking-space (0xa0) in their \\s character\n  // class (as required by section 7.2 of the ECMAScript spec), we explicitly\n  // include it in the regexp to enforce consistent cross-browser behavior.\n  return str.replace(/[\\s\\xa0]+/g, ' ').replace(/^\\s+|\\s+$/g, '');\n};\n\n\n/**\n * Checks if a string is empty or contains only whitespaces.\n * @param {string} str The string to check.\n * @return {boolean} Whether `str` is empty or whitespace only.\n */\ngoog.string.isEmptyOrWhitespace = goog.string.internal.isEmptyOrWhitespace;\n\n\n/**\n * Checks if a string is empty.\n * @param {string} str The string to check.\n * @return {boolean} Whether `str` is empty.\n */\ngoog.string.isEmptyString = function(str) {\n  return str.length == 0;\n};\n\n\n/**\n * Checks if a string is empty or contains only whitespaces.\n *\n * @param {string} str The string to check.\n * @return {boolean} Whether `str` is empty or whitespace only.\n * @deprecated Use goog.string.isEmptyOrWhitespace instead.\n */\ngoog.string.isEmpty = goog.string.isEmptyOrWhitespace;\n\n\n/**\n * Checks if a string is null, undefined, empty or contains only whitespaces.\n * @param {*} str The string to check.\n * @return {boolean} Whether `str` is null, undefined, empty, or\n *     whitespace only.\n * @deprecated Use goog.string.isEmptyOrWhitespace(goog.string.makeSafe(str))\n *     instead.\n */\ngoog.string.isEmptyOrWhitespaceSafe = function(str) {\n  return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(str));\n};\n\n\n/**\n * Checks if a string is null, undefined, empty or contains only whitespaces.\n *\n * @param {*} str The string to check.\n * @return {boolean} Whether `str` is null, undefined, empty, or\n *     whitespace only.\n * @deprecated Use goog.string.isEmptyOrWhitespace instead.\n */\ngoog.string.isEmptySafe = goog.string.isEmptyOrWhitespaceSafe;\n\n\n/**\n * Checks if a string is all breaking whitespace.\n * @param {string} str The string to check.\n * @return {boolean} Whether the string is all breaking whitespace.\n */\ngoog.string.isBreakingWhitespace = function(str) {\n  return !/[^\\t\\n\\r ]/.test(str);\n};\n\n\n/**\n * Checks if a string contains all letters.\n * @param {string} str string to check.\n * @return {boolean} True if `str` consists entirely of letters.\n */\ngoog.string.isAlpha = function(str) {\n  return !/[^a-zA-Z]/.test(str);\n};\n\n\n/**\n * Checks if a string contains only numbers.\n * @param {*} str string to check. If not a string, it will be\n *     casted to one.\n * @return {boolean} True if `str` is numeric.\n */\ngoog.string.isNumeric = function(str) {\n  return !/[^0-9]/.test(str);\n};\n\n\n/**\n * Checks if a string contains only numbers or letters.\n * @param {string} str string to check.\n * @return {boolean} True if `str` is alphanumeric.\n */\ngoog.string.isAlphaNumeric = function(str) {\n  return !/[^a-zA-Z0-9]/.test(str);\n};\n\n\n/**\n * Checks if a character is a space character.\n * @param {string} ch Character to check.\n * @return {boolean} True if `ch` is a space.\n */\ngoog.string.isSpace = function(ch) {\n  return ch == ' ';\n};\n\n\n/**\n * Checks if a character is a valid unicode character.\n * @param {string} ch Character to check.\n * @return {boolean} True if `ch` is a valid unicode character.\n */\ngoog.string.isUnicodeChar = function(ch) {\n  return ch.length == 1 && ch >= ' ' && ch <= '~' ||\n      ch >= '\\u0080' && ch <= '\\uFFFD';\n};\n\n\n/**\n * Takes a string and replaces newlines with a space. Multiple lines are\n * replaced with a single space.\n * @param {string} str The string from which to strip newlines.\n * @return {string} A copy of `str` stripped of newlines.\n */\ngoog.string.stripNewlines = function(str) {\n  return str.replace(/(\\r\\n|\\r|\\n)+/g, ' ');\n};\n\n\n/**\n * Replaces Windows and Mac new lines with unix style: \\r or \\r\\n with \\n.\n * @param {string} str The string to in which to canonicalize newlines.\n * @return {string} `str` A copy of {@code} with canonicalized newlines.\n */\ngoog.string.canonicalizeNewlines = function(str) {\n  return str.replace(/(\\r\\n|\\r|\\n)/g, '\\n');\n};\n\n\n/**\n * Normalizes whitespace in a string, replacing all whitespace chars with\n * a space.\n * @param {string} str The string in which to normalize whitespace.\n * @return {string} A copy of `str` with all whitespace normalized.\n */\ngoog.string.normalizeWhitespace = function(str) {\n  return str.replace(/\\xa0|\\s/g, ' ');\n};\n\n\n/**\n * Normalizes spaces in a string, replacing all consecutive spaces and tabs\n * with a single space. Replaces non-breaking space with a space.\n * @param {string} str The string in which to normalize spaces.\n * @return {string} A copy of `str` with all consecutive spaces and tabs\n *    replaced with a single space.\n */\ngoog.string.normalizeSpaces = function(str) {\n  return str.replace(/\\xa0|[ \\t]+/g, ' ');\n};\n\n\n/**\n * Removes the breaking spaces from the left and right of the string and\n * collapses the sequences of breaking spaces in the middle into single spaces.\n * The original and the result strings render the same way in HTML.\n * @param {string} str A string in which to collapse spaces.\n * @return {string} Copy of the string with normalized breaking spaces.\n */\ngoog.string.collapseBreakingSpaces = function(str) {\n  return str.replace(/[\\t\\r\\n ]+/g, ' ')\n      .replace(/^[\\t\\r\\n ]+|[\\t\\r\\n ]+$/g, '');\n};\n\n\n/**\n * Trims white spaces to the left and right of a string.\n * @param {string} str The string to trim.\n * @return {string} A trimmed copy of `str`.\n */\ngoog.string.trim = goog.string.internal.trim;\n\n\n/**\n * Trims whitespaces at the left end of a string.\n * @param {string} str The string to left trim.\n * @return {string} A trimmed copy of `str`.\n */\ngoog.string.trimLeft = function(str) {\n  // Since IE doesn't include non-breaking-space (0xa0) in their \\s character\n  // class (as required by section 7.2 of the ECMAScript spec), we explicitly\n  // include it in the regexp to enforce consistent cross-browser behavior.\n  return str.replace(/^[\\s\\xa0]+/, '');\n};\n\n\n/**\n * Trims whitespaces at the right end of a string.\n * @param {string} str The string to right trim.\n * @return {string} A trimmed copy of `str`.\n */\ngoog.string.trimRight = function(str) {\n  // Since IE doesn't include non-breaking-space (0xa0) in their \\s character\n  // class (as required by section 7.2 of the ECMAScript spec), we explicitly\n  // include it in the regexp to enforce consistent cross-browser behavior.\n  return str.replace(/[\\s\\xa0]+$/, '');\n};\n\n\n/**\n * A string comparator that ignores case.\n * -1 = str1 less than str2\n *  0 = str1 equals str2\n *  1 = str1 greater than str2\n *\n * @param {string} str1 The string to compare.\n * @param {string} str2 The string to compare `str1` to.\n * @return {number} The comparator result, as described above.\n */\ngoog.string.caseInsensitiveCompare =\n    goog.string.internal.caseInsensitiveCompare;\n\n\n/**\n * Compares two strings interpreting their numeric substrings as numbers.\n *\n * @param {string} str1 First string.\n * @param {string} str2 Second string.\n * @param {!RegExp} tokenizerRegExp Splits a string into substrings of\n *     non-negative integers, non-numeric characters and optionally fractional\n *     numbers starting with a decimal point.\n * @return {number} Negative if str1 < str2, 0 is str1 == str2, positive if\n *     str1 > str2.\n * @private\n */\ngoog.string.numberAwareCompare_ = function(str1, str2, tokenizerRegExp) {\n  if (str1 == str2) {\n    return 0;\n  }\n  if (!str1) {\n    return -1;\n  }\n  if (!str2) {\n    return 1;\n  }\n\n  // Using match to split the entire string ahead of time turns out to be faster\n  // for most inputs than using RegExp.exec or iterating over each character.\n  var tokens1 = str1.toLowerCase().match(tokenizerRegExp);\n  var tokens2 = str2.toLowerCase().match(tokenizerRegExp);\n\n  var count = Math.min(tokens1.length, tokens2.length);\n\n  for (var i = 0; i < count; i++) {\n    var a = tokens1[i];\n    var b = tokens2[i];\n\n    // Compare pairs of tokens, returning if one token sorts before the other.\n    if (a != b) {\n      // Only if both tokens are integers is a special comparison required.\n      // Decimal numbers are sorted as strings (e.g., '.09' < '.1').\n      var num1 = parseInt(a, 10);\n      if (!isNaN(num1)) {\n        var num2 = parseInt(b, 10);\n        if (!isNaN(num2) && num1 - num2) {\n          return num1 - num2;\n        }\n      }\n      return a < b ? -1 : 1;\n    }\n  }\n\n  // If one string is a substring of the other, the shorter string sorts first.\n  if (tokens1.length != tokens2.length) {\n    return tokens1.length - tokens2.length;\n  }\n\n  // The two strings must be equivalent except for case (perfect equality is\n  // tested at the head of the function.) Revert to default ASCII string\n  // comparison to stabilize the sort.\n  return str1 < str2 ? -1 : 1;\n};\n\n\n/**\n * String comparison function that handles non-negative integer numbers in a\n * way humans might expect. Using this function, the string 'File 2.jpg' sorts\n * before 'File 10.jpg', and 'Version 1.9' before 'Version 1.10'. The comparison\n * is mostly case-insensitive, though strings that are identical except for case\n * are sorted with the upper-case strings before lower-case.\n *\n * This comparison function is up to 50x slower than either the default or the\n * case-insensitive compare. It should not be used in time-critical code, but\n * should be fast enough to sort several hundred short strings (like filenames)\n * with a reasonable delay.\n *\n * @param {string} str1 The string to compare in a numerically sensitive way.\n * @param {string} str2 The string to compare `str1` to.\n * @return {number} less than 0 if str1 < str2, 0 if str1 == str2, greater than\n *     0 if str1 > str2.\n */\ngoog.string.intAwareCompare = function(str1, str2) {\n  return goog.string.numberAwareCompare_(str1, str2, /\\d+|\\D+/g);\n};\n\n\n/**\n * String comparison function that handles non-negative integer and fractional\n * numbers in a way humans might expect. Using this function, the string\n * 'File 2.jpg' sorts before 'File 10.jpg', and '3.14' before '3.2'. Equivalent\n * to {@link goog.string.intAwareCompare} apart from the way how it interprets\n * dots.\n *\n * @param {string} str1 The string to compare in a numerically sensitive way.\n * @param {string} str2 The string to compare `str1` to.\n * @return {number} less than 0 if str1 < str2, 0 if str1 == str2, greater than\n *     0 if str1 > str2.\n */\ngoog.string.floatAwareCompare = function(str1, str2) {\n  return goog.string.numberAwareCompare_(str1, str2, /\\d+|\\.\\d+|\\D+/g);\n};\n\n\n/**\n * Alias for {@link goog.string.floatAwareCompare}.\n *\n * @param {string} str1\n * @param {string} str2\n * @return {number}\n */\ngoog.string.numerateCompare = goog.string.floatAwareCompare;\n\n\n/**\n * URL-encodes a string\n * @param {*} str The string to url-encode.\n * @return {string} An encoded copy of `str` that is safe for urls.\n *     Note that '#', ':', and other characters used to delimit portions\n *     of URLs *will* be encoded.\n */\ngoog.string.urlEncode = function(str) {\n  return encodeURIComponent(String(str));\n};\n\n\n/**\n * URL-decodes the string. We need to specially handle '+'s because\n * the javascript library doesn't convert them to spaces.\n * @param {string} str The string to url decode.\n * @return {string} The decoded `str`.\n */\ngoog.string.urlDecode = function(str) {\n  return decodeURIComponent(str.replace(/\\+/g, ' '));\n};\n\n\n/**\n * Converts \\n to <br>s or <br />s.\n * @param {string} str The string in which to convert newlines.\n * @param {boolean=} opt_xml Whether to use XML compatible tags.\n * @return {string} A copy of `str` with converted newlines.\n */\ngoog.string.newLineToBr = goog.string.internal.newLineToBr;\n\n\n/**\n * Escapes double quote '\"' and single quote '\\'' characters in addition to\n * '&', '<', and '>' so that a string can be included in an HTML tag attribute\n * value within double or single quotes.\n *\n * It should be noted that > doesn't need to be escaped for the HTML or XML to\n * be valid, but it has been decided to escape it for consistency with other\n * implementations.\n *\n * With goog.string.DETECT_DOUBLE_ESCAPING, this function escapes also the\n * lowercase letter \"e\".\n *\n * NOTE(user):\n * HtmlEscape is often called during the generation of large blocks of HTML.\n * Using statics for the regular expressions and strings is an optimization\n * that can more than half the amount of time IE spends in this function for\n * large apps, since strings and regexes both contribute to GC allocations.\n *\n * Testing for the presence of a character before escaping increases the number\n * of function calls, but actually provides a speed increase for the average\n * case -- since the average case often doesn't require the escaping of all 4\n * characters and indexOf() is much cheaper than replace().\n * The worst case does suffer slightly from the additional calls, therefore the\n * opt_isLikelyToContainHtmlChars option has been included for situations\n * where all 4 HTML entities are very likely to be present and need escaping.\n *\n * Some benchmarks (times tended to fluctuate +-0.05ms):\n *                                     FireFox                     IE6\n * (no chars / average (mix of cases) / all 4 chars)\n * no checks                     0.13 / 0.22 / 0.22         0.23 / 0.53 / 0.80\n * indexOf                       0.08 / 0.17 / 0.26         0.22 / 0.54 / 0.84\n * indexOf + re test             0.07 / 0.17 / 0.28         0.19 / 0.50 / 0.85\n *\n * An additional advantage of checking if replace actually needs to be called\n * is a reduction in the number of object allocations, so as the size of the\n * application grows the difference between the various methods would increase.\n *\n * @param {string} str string to be escaped.\n * @param {boolean=} opt_isLikelyToContainHtmlChars Don't perform a check to see\n *     if the character needs replacing - use this option if you expect each of\n *     the characters to appear often. Leave false if you expect few html\n *     characters to occur in your strings, such as if you are escaping HTML.\n * @return {string} An escaped copy of `str`.\n */\ngoog.string.htmlEscape = function(str, opt_isLikelyToContainHtmlChars) {\n  str = goog.string.internal.htmlEscape(str, opt_isLikelyToContainHtmlChars);\n  if (goog.string.DETECT_DOUBLE_ESCAPING) {\n    str = str.replace(goog.string.E_RE_, '&#101;');\n  }\n  return str;\n};\n\n\n/**\n * Regular expression that matches a lowercase letter \"e\", for use in escaping.\n * @const {!RegExp}\n * @private\n */\ngoog.string.E_RE_ = /e/g;\n\n\n/**\n * Unescapes an HTML string.\n *\n * @param {string} str The string to unescape.\n * @return {string} An unescaped copy of `str`.\n */\ngoog.string.unescapeEntities = function(str) {\n  if (goog.string.contains(str, '&')) {\n    // We are careful not to use a DOM if we do not have one or we explicitly\n    // requested non-DOM html unescaping.\n    if (!goog.string.FORCE_NON_DOM_HTML_UNESCAPING &&\n        'document' in goog.global) {\n      return goog.string.unescapeEntitiesUsingDom_(str);\n    } else {\n      // Fall back on pure XML entities\n      return goog.string.unescapePureXmlEntities_(str);\n    }\n  }\n  return str;\n};\n\n\n/**\n * Unescapes a HTML string using the provided document.\n *\n * @param {string} str The string to unescape.\n * @param {!Document} document A document to use in escaping the string.\n * @return {string} An unescaped copy of `str`.\n */\ngoog.string.unescapeEntitiesWithDocument = function(str, document) {\n  if (goog.string.contains(str, '&')) {\n    return goog.string.unescapeEntitiesUsingDom_(str, document);\n  }\n  return str;\n};\n\n\n/**\n * Unescapes an HTML string using a DOM to resolve non-XML, non-numeric\n * entities. This function is XSS-safe and whitespace-preserving.\n * @private\n * @param {string} str The string to unescape.\n * @param {Document=} opt_document An optional document to use for creating\n *     elements. If this is not specified then the default window.document\n *     will be used.\n * @return {string} The unescaped `str` string.\n */\ngoog.string.unescapeEntitiesUsingDom_ = function(str, opt_document) {\n  /** @type {!Object<string, string>} */\n  var seen = {'&amp;': '&', '&lt;': '<', '&gt;': '>', '&quot;': '\"'};\n  /** @type {!Element} */\n  var div;\n  if (opt_document) {\n    div = opt_document.createElement('div');\n  } else {\n    div = goog.global.document.createElement('div');\n  }\n  // Match as many valid entity characters as possible. If the actual entity\n  // happens to be shorter, it will still work as innerHTML will return the\n  // trailing characters unchanged. Since the entity characters do not include\n  // open angle bracket, there is no chance of XSS from the innerHTML use.\n  // Since no whitespace is passed to innerHTML, whitespace is preserved.\n  return str.replace(goog.string.HTML_ENTITY_PATTERN_, function(s, entity) {\n    // Check for cached entity.\n    var value = seen[s];\n    if (value) {\n      return value;\n    }\n    // Check for numeric entity.\n    if (entity.charAt(0) == '#') {\n      // Prefix with 0 so that hex entities (e.g. &#x10) parse as hex numbers.\n      var n = Number('0' + entity.substr(1));\n      if (!isNaN(n)) {\n        value = String.fromCharCode(n);\n      }\n    }\n    // Fall back to innerHTML otherwise.\n    if (!value) {\n      // Append a non-entity character to avoid a bug in Webkit that parses\n      // an invalid entity at the end of innerHTML text as the empty string.\n      goog.dom.safe.setInnerHtml(\n          div,\n          goog.html.uncheckedconversions\n              .safeHtmlFromStringKnownToSatisfyTypeContract(\n                  goog.string.Const.from('Single HTML entity.'), s + ' '));\n      // Then remove the trailing character from the result.\n      value = div.firstChild.nodeValue.slice(0, -1);\n    }\n    // Cache and return.\n    return seen[s] = value;\n  });\n};\n\n\n/**\n * Unescapes XML entities.\n * @private\n * @param {string} str The string to unescape.\n * @return {string} An unescaped copy of `str`.\n */\ngoog.string.unescapePureXmlEntities_ = function(str) {\n  return str.replace(/&([^;]+);/g, function(s, entity) {\n    switch (entity) {\n      case 'amp':\n        return '&';\n      case 'lt':\n        return '<';\n      case 'gt':\n        return '>';\n      case 'quot':\n        return '\"';\n      default:\n        if (entity.charAt(0) == '#') {\n          // Prefix with 0 so that hex entities (e.g. &#x10) parse as hex.\n          var n = Number('0' + entity.substr(1));\n          if (!isNaN(n)) {\n            return String.fromCharCode(n);\n          }\n        }\n        // For invalid entities we just return the entity\n        return s;\n    }\n  });\n};\n\n\n/**\n * Regular expression that matches an HTML entity.\n * See also HTML5: Tokenization / Tokenizing character references.\n * @private\n * @type {!RegExp}\n */\ngoog.string.HTML_ENTITY_PATTERN_ = /&([^;\\s<&]+);?/g;\n\n\n/**\n * Do escaping of whitespace to preserve spatial formatting. We use character\n * entity #160 to make it safer for xml.\n * @param {string} str The string in which to escape whitespace.\n * @param {boolean=} opt_xml Whether to use XML compatible tags.\n * @return {string} An escaped copy of `str`.\n */\ngoog.string.whitespaceEscape = function(str, opt_xml) {\n  // This doesn't use goog.string.preserveSpaces for backwards compatibility.\n  return goog.string.newLineToBr(str.replace(/  /g, ' &#160;'), opt_xml);\n};\n\n\n/**\n * Preserve spaces that would be otherwise collapsed in HTML by replacing them\n * with non-breaking space Unicode characters.\n * @param {string} str The string in which to preserve whitespace.\n * @return {string} A copy of `str` with preserved whitespace.\n */\ngoog.string.preserveSpaces = function(str) {\n  return str.replace(/(^|[\\n ]) /g, '$1' + goog.string.Unicode.NBSP);\n};\n\n\n/**\n * Strip quote characters around a string.  The second argument is a string of\n * characters to treat as quotes.  This can be a single character or a string of\n * multiple character and in that case each of those are treated as possible\n * quote characters. For example:\n *\n * <pre>\n * goog.string.stripQuotes('\"abc\"', '\"`') --> 'abc'\n * goog.string.stripQuotes('`abc`', '\"`') --> 'abc'\n * </pre>\n *\n * @param {string} str The string to strip.\n * @param {string} quoteChars The quote characters to strip.\n * @return {string} A copy of `str` without the quotes.\n */\ngoog.string.stripQuotes = function(str, quoteChars) {\n  var length = quoteChars.length;\n  for (var i = 0; i < length; i++) {\n    var quoteChar = length == 1 ? quoteChars : quoteChars.charAt(i);\n    if (str.charAt(0) == quoteChar && str.charAt(str.length - 1) == quoteChar) {\n      return str.substring(1, str.length - 1);\n    }\n  }\n  return str;\n};\n\n\n/**\n * Truncates a string to a certain length and adds '...' if necessary.  The\n * length also accounts for the ellipsis, so a maximum length of 10 and a string\n * 'Hello World!' produces 'Hello W...'.\n * @param {string} str The string to truncate.\n * @param {number} chars Max number of characters.\n * @param {boolean=} opt_protectEscapedCharacters Whether to protect escaped\n *     characters from being cut off in the middle.\n * @return {string} The truncated `str` string.\n */\ngoog.string.truncate = function(str, chars, opt_protectEscapedCharacters) {\n  if (opt_protectEscapedCharacters) {\n    str = goog.string.unescapeEntities(str);\n  }\n\n  if (str.length > chars) {\n    str = str.substring(0, chars - 3) + '...';\n  }\n\n  if (opt_protectEscapedCharacters) {\n    str = goog.string.htmlEscape(str);\n  }\n\n  return str;\n};\n\n\n/**\n * Truncate a string in the middle, adding \"...\" if necessary,\n * and favoring the beginning of the string.\n * @param {string} str The string to truncate the middle of.\n * @param {number} chars Max number of characters.\n * @param {boolean=} opt_protectEscapedCharacters Whether to protect escaped\n *     characters from being cutoff in the middle.\n * @param {number=} opt_trailingChars Optional number of trailing characters to\n *     leave at the end of the string, instead of truncating as close to the\n *     middle as possible.\n * @return {string} A truncated copy of `str`.\n */\ngoog.string.truncateMiddle = function(\n    str, chars, opt_protectEscapedCharacters, opt_trailingChars) {\n  if (opt_protectEscapedCharacters) {\n    str = goog.string.unescapeEntities(str);\n  }\n\n  if (opt_trailingChars && str.length > chars) {\n    if (opt_trailingChars > chars) {\n      opt_trailingChars = chars;\n    }\n    var endPoint = str.length - opt_trailingChars;\n    var startPoint = chars - opt_trailingChars;\n    str = str.substring(0, startPoint) + '...' + str.substring(endPoint);\n  } else if (str.length > chars) {\n    // Favor the beginning of the string:\n    var half = Math.floor(chars / 2);\n    var endPos = str.length - half;\n    half += chars % 2;\n    str = str.substring(0, half) + '...' + str.substring(endPos);\n  }\n\n  if (opt_protectEscapedCharacters) {\n    str = goog.string.htmlEscape(str);\n  }\n\n  return str;\n};\n\n\n/**\n * Special chars that need to be escaped for goog.string.quote.\n * @private {!Object<string, string>}\n */\ngoog.string.specialEscapeChars_ = {\n  '\\0': '\\\\0',\n  '\\b': '\\\\b',\n  '\\f': '\\\\f',\n  '\\n': '\\\\n',\n  '\\r': '\\\\r',\n  '\\t': '\\\\t',\n  '\\x0B': '\\\\x0B',  // '\\v' is not supported in JScript\n  '\"': '\\\\\"',\n  '\\\\': '\\\\\\\\',\n  // To support the use case of embedding quoted strings inside of script\n  // tags, we have to make sure HTML comments and opening/closing script tags do\n  // not appear in the resulting string. The specific strings that must be\n  // escaped are documented at:\n  // https://html.spec.whatwg.org/multipage/scripting.html#restrictions-for-contents-of-script-elements\n  '<': '\\\\u003C'  // NOTE: JSON.parse crashes on '\\\\x3c'.\n};\n\n\n/**\n * Character mappings used internally for goog.string.escapeChar.\n * @private {!Object<string, string>}\n */\ngoog.string.jsEscapeCache_ = {\n  '\\'': '\\\\\\''\n};\n\n\n/**\n * Encloses a string in double quotes and escapes characters so that the\n * string is a valid JS string. The resulting string is safe to embed in\n * `<script>` tags as \"<\" is escaped.\n * @param {string} s The string to quote.\n * @return {string} A copy of `s` surrounded by double quotes.\n */\ngoog.string.quote = function(s) {\n  s = String(s);\n  var sb = ['\"'];\n  for (var i = 0; i < s.length; i++) {\n    var ch = s.charAt(i);\n    var cc = ch.charCodeAt(0);\n    sb[i + 1] = goog.string.specialEscapeChars_[ch] ||\n        ((cc > 31 && cc < 127) ? ch : goog.string.escapeChar(ch));\n  }\n  sb.push('\"');\n  return sb.join('');\n};\n\n\n/**\n * Takes a string and returns the escaped string for that input string.\n * @param {string} str The string to escape.\n * @return {string} An escaped string representing `str`.\n */\ngoog.string.escapeString = function(str) {\n  var sb = [];\n  for (var i = 0; i < str.length; i++) {\n    sb[i] = goog.string.escapeChar(str.charAt(i));\n  }\n  return sb.join('');\n};\n\n\n/**\n * Takes a character and returns the escaped string for that character. For\n * example escapeChar(String.fromCharCode(15)) -> \"\\\\x0E\".\n * @param {string} c The character to escape.\n * @return {string} An escaped string representing `c`.\n */\ngoog.string.escapeChar = function(c) {\n  if (c in goog.string.jsEscapeCache_) {\n    return goog.string.jsEscapeCache_[c];\n  }\n\n  if (c in goog.string.specialEscapeChars_) {\n    return goog.string.jsEscapeCache_[c] = goog.string.specialEscapeChars_[c];\n  }\n\n  var rv = c;\n  var cc = c.charCodeAt(0);\n  if (cc > 31 && cc < 127) {\n    rv = c;\n  } else {\n    // tab is 9 but handled above\n    if (cc < 256) {\n      rv = '\\\\x';\n      if (cc < 16 || cc > 256) {\n        rv += '0';\n      }\n    } else {\n      rv = '\\\\u';\n      if (cc < 4096) {  // \\u1000\n        rv += '0';\n      }\n    }\n    rv += cc.toString(16).toUpperCase();\n  }\n\n  return goog.string.jsEscapeCache_[c] = rv;\n};\n\n\n/**\n * Determines whether a string contains a substring.\n * @param {string} str The string to search.\n * @param {string} subString The substring to search for.\n * @return {boolean} Whether `str` contains `subString`.\n */\ngoog.string.contains = goog.string.internal.contains;\n\n\n/**\n * Determines whether a string contains a substring, ignoring case.\n * @param {string} str The string to search.\n * @param {string} subString The substring to search for.\n * @return {boolean} Whether `str` contains `subString`.\n */\ngoog.string.caseInsensitiveContains =\n    goog.string.internal.caseInsensitiveContains;\n\n\n/**\n * Returns the non-overlapping occurrences of ss in s.\n * If either s or ss evalutes to false, then returns zero.\n * @param {string} s The string to look in.\n * @param {string} ss The string to look for.\n * @return {number} Number of occurrences of ss in s.\n */\ngoog.string.countOf = function(s, ss) {\n  return s && ss ? s.split(ss).length - 1 : 0;\n};\n\n\n/**\n * Removes a substring of a specified length at a specific\n * index in a string.\n * @param {string} s The base string from which to remove.\n * @param {number} index The index at which to remove the substring.\n * @param {number} stringLength The length of the substring to remove.\n * @return {string} A copy of `s` with the substring removed or the full\n *     string if nothing is removed or the input is invalid.\n */\ngoog.string.removeAt = function(s, index, stringLength) {\n  var resultStr = s;\n  // If the index is greater or equal to 0 then remove substring\n  if (index >= 0 && index < s.length && stringLength > 0) {\n    resultStr = s.substr(0, index) +\n        s.substr(index + stringLength, s.length - index - stringLength);\n  }\n  return resultStr;\n};\n\n\n/**\n * Removes the first occurrence of a substring from a string.\n * @param {string} str The base string from which to remove.\n * @param {string} substr The string to remove.\n * @return {string} A copy of `str` with `substr` removed or the\n *     full string if nothing is removed.\n */\ngoog.string.remove = function(str, substr) {\n  return str.replace(substr, '');\n};\n\n\n/**\n *  Removes all occurrences of a substring from a string.\n *  @param {string} s The base string from which to remove.\n *  @param {string} ss The string to remove.\n *  @return {string} A copy of `s` with `ss` removed or the full\n *      string if nothing is removed.\n */\ngoog.string.removeAll = function(s, ss) {\n  var re = new RegExp(goog.string.regExpEscape(ss), 'g');\n  return s.replace(re, '');\n};\n\n\n/**\n *  Replaces all occurrences of a substring of a string with a new substring.\n *  @param {string} s The base string from which to remove.\n *  @param {string} ss The string to replace.\n *  @param {string} replacement The replacement string.\n *  @return {string} A copy of `s` with `ss` replaced by\n *      `replacement` or the original string if nothing is replaced.\n */\ngoog.string.replaceAll = function(s, ss, replacement) {\n  var re = new RegExp(goog.string.regExpEscape(ss), 'g');\n  return s.replace(re, replacement.replace(/\\$/g, '$$$$'));\n};\n\n\n/**\n * Escapes characters in the string that are not safe to use in a RegExp.\n * @param {*} s The string to escape. If not a string, it will be casted\n *     to one.\n * @return {string} A RegExp safe, escaped copy of `s`.\n */\ngoog.string.regExpEscape = function(s) {\n  return String(s)\n      .replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')\n      .replace(/\\x08/g, '\\\\x08');\n};\n\n\n/**\n * Repeats a string n times.\n * @param {string} string The string to repeat.\n * @param {number} length The number of times to repeat.\n * @return {string} A string containing `length` repetitions of\n *     `string`.\n */\ngoog.string.repeat = (String.prototype.repeat) ? function(string, length) {\n  // The native method is over 100 times faster than the alternative.\n  return string.repeat(length);\n} : function(string, length) {\n  return new Array(length + 1).join(string);\n};\n\n\n/**\n * Pads number to given length and optionally rounds it to a given precision.\n * For example:\n * <pre>padNumber(1.25, 2, 3) -> '01.250'\n * padNumber(1.25, 2) -> '01.25'\n * padNumber(1.25, 2, 1) -> '01.3'\n * padNumber(1.25, 0) -> '1.25'</pre>\n *\n * @param {number} num The number to pad.\n * @param {number} length The desired length.\n * @param {number=} opt_precision The desired precision.\n * @return {string} `num` as a string with the given options.\n */\ngoog.string.padNumber = function(num, length, opt_precision) {\n  var s = goog.isDef(opt_precision) ? num.toFixed(opt_precision) : String(num);\n  var index = s.indexOf('.');\n  if (index == -1) {\n    index = s.length;\n  }\n  return goog.string.repeat('0', Math.max(0, length - index)) + s;\n};\n\n\n/**\n * Returns a string representation of the given object, with\n * null and undefined being returned as the empty string.\n *\n * @param {*} obj The object to convert.\n * @return {string} A string representation of the `obj`.\n */\ngoog.string.makeSafe = function(obj) {\n  return obj == null ? '' : String(obj);\n};\n\n\n/**\n * Concatenates string expressions. This is useful\n * since some browsers are very inefficient when it comes to using plus to\n * concat strings. Be careful when using null and undefined here since\n * these will not be included in the result. If you need to represent these\n * be sure to cast the argument to a String first.\n * For example:\n * <pre>buildString('a', 'b', 'c', 'd') -> 'abcd'\n * buildString(null, undefined) -> ''\n * </pre>\n * @param {...*} var_args A list of strings to concatenate. If not a string,\n *     it will be casted to one.\n * @return {string} The concatenation of `var_args`.\n */\ngoog.string.buildString = function(var_args) {\n  return Array.prototype.join.call(arguments, '');\n};\n\n\n/**\n * Returns a string with at least 64-bits of randomness.\n *\n * Doesn't trust JavaScript's random function entirely. Uses a combination of\n * random and current timestamp, and then encodes the string in base-36 to\n * make it shorter.\n *\n * @return {string} A random string, e.g. sn1s7vb4gcic.\n */\ngoog.string.getRandomString = function() {\n  var x = 2147483648;\n  return Math.floor(Math.random() * x).toString(36) +\n      Math.abs(Math.floor(Math.random() * x) ^ goog.now()).toString(36);\n};\n\n\n/**\n * Compares two version numbers.\n *\n * @param {string|number} version1 Version of first item.\n * @param {string|number} version2 Version of second item.\n *\n * @return {number}  1 if `version1` is higher.\n *                   0 if arguments are equal.\n *                  -1 if `version2` is higher.\n */\ngoog.string.compareVersions = goog.string.internal.compareVersions;\n\n\n/**\n * String hash function similar to java.lang.String.hashCode().\n * The hash code for a string is computed as\n * s[0] * 31 ^ (n - 1) + s[1] * 31 ^ (n - 2) + ... + s[n - 1],\n * where s[i] is the ith character of the string and n is the length of\n * the string. We mod the result to make it between 0 (inclusive) and 2^32\n * (exclusive).\n * @param {string} str A string.\n * @return {number} Hash value for `str`, between 0 (inclusive) and 2^32\n *  (exclusive). The empty string returns 0.\n */\ngoog.string.hashCode = function(str) {\n  var result = 0;\n  for (var i = 0; i < str.length; ++i) {\n    // Normalize to 4 byte range, 0 ... 2^32.\n    result = (31 * result + str.charCodeAt(i)) >>> 0;\n  }\n  return result;\n};\n\n\n/**\n * The most recent unique ID. |0 is equivalent to Math.floor in this case.\n * @type {number}\n * @private\n */\ngoog.string.uniqueStringCounter_ = Math.random() * 0x80000000 | 0;\n\n\n/**\n * Generates and returns a string which is unique in the current document.\n * This is useful, for example, to create unique IDs for DOM elements.\n * @return {string} A unique id.\n */\ngoog.string.createUniqueString = function() {\n  return 'goog_' + goog.string.uniqueStringCounter_++;\n};\n\n\n/**\n * Converts the supplied string to a number, which may be Infinity or NaN.\n * This function strips whitespace: (toNumber(' 123') === 123)\n * This function accepts scientific notation: (toNumber('1e1') === 10)\n *\n * This is better than JavaScript's built-in conversions because, sadly:\n *     (Number(' ') === 0) and (parseFloat('123a') === 123)\n *\n * @param {string} str The string to convert.\n * @return {number} The number the supplied string represents, or NaN.\n */\ngoog.string.toNumber = function(str) {\n  var num = Number(str);\n  if (num == 0 && goog.string.isEmptyOrWhitespace(str)) {\n    return NaN;\n  }\n  return num;\n};\n\n\n/**\n * Returns whether the given string is lower camel case (e.g. \"isFooBar\").\n *\n * Note that this assumes the string is entirely letters.\n * @see http://en.wikipedia.org/wiki/CamelCase#Variations_and_synonyms\n *\n * @param {string} str String to test.\n * @return {boolean} Whether the string is lower camel case.\n */\ngoog.string.isLowerCamelCase = function(str) {\n  return /^[a-z]+([A-Z][a-z]*)*$/.test(str);\n};\n\n\n/**\n * Returns whether the given string is upper camel case (e.g. \"FooBarBaz\").\n *\n * Note that this assumes the string is entirely letters.\n * @see http://en.wikipedia.org/wiki/CamelCase#Variations_and_synonyms\n *\n * @param {string} str String to test.\n * @return {boolean} Whether the string is upper camel case.\n */\ngoog.string.isUpperCamelCase = function(str) {\n  return /^([A-Z][a-z]*)+$/.test(str);\n};\n\n\n/**\n * Converts a string from selector-case to camelCase (e.g. from\n * \"multi-part-string\" to \"multiPartString\"), useful for converting\n * CSS selectors and HTML dataset keys to their equivalent JS properties.\n * @param {string} str The string in selector-case form.\n * @return {string} The string in camelCase form.\n */\ngoog.string.toCamelCase = function(str) {\n  return String(str).replace(/\\-([a-z])/g, function(all, match) {\n    return match.toUpperCase();\n  });\n};\n\n\n/**\n * Converts a string from camelCase to selector-case (e.g. from\n * \"multiPartString\" to \"multi-part-string\"), useful for converting JS\n * style and dataset properties to equivalent CSS selectors and HTML keys.\n * @param {string} str The string in camelCase form.\n * @return {string} The string in selector-case form.\n */\ngoog.string.toSelectorCase = function(str) {\n  return String(str).replace(/([A-Z])/g, '-$1').toLowerCase();\n};\n\n\n/**\n * Converts a string into TitleCase. First character of the string is always\n * capitalized in addition to the first letter of every subsequent word.\n * Words are delimited by one or more whitespaces by default. Custom delimiters\n * can optionally be specified to replace the default, which doesn't preserve\n * whitespace delimiters and instead must be explicitly included if needed.\n *\n * Default delimiter => \" \":\n *    goog.string.toTitleCase('oneTwoThree')    => 'OneTwoThree'\n *    goog.string.toTitleCase('one two three')  => 'One Two Three'\n *    goog.string.toTitleCase('  one   two   ') => '  One   Two   '\n *    goog.string.toTitleCase('one_two_three')  => 'One_two_three'\n *    goog.string.toTitleCase('one-two-three')  => 'One-two-three'\n *\n * Custom delimiter => \"_-.\":\n *    goog.string.toTitleCase('oneTwoThree', '_-.')       => 'OneTwoThree'\n *    goog.string.toTitleCase('one two three', '_-.')     => 'One two three'\n *    goog.string.toTitleCase('  one   two   ', '_-.')    => '  one   two   '\n *    goog.string.toTitleCase('one_two_three', '_-.')     => 'One_Two_Three'\n *    goog.string.toTitleCase('one-two-three', '_-.')     => 'One-Two-Three'\n *    goog.string.toTitleCase('one...two...three', '_-.') => 'One...Two...Three'\n *    goog.string.toTitleCase('one. two. three', '_-.')   => 'One. two. three'\n *    goog.string.toTitleCase('one-two.three', '_-.')     => 'One-Two.Three'\n *\n * @param {string} str String value in camelCase form.\n * @param {string=} opt_delimiters Custom delimiter character set used to\n *      distinguish words in the string value. Each character represents a\n *      single delimiter. When provided, default whitespace delimiter is\n *      overridden and must be explicitly included if needed.\n * @return {string} String value in TitleCase form.\n */\ngoog.string.toTitleCase = function(str, opt_delimiters) {\n  var delimiters = goog.isString(opt_delimiters) ?\n      goog.string.regExpEscape(opt_delimiters) :\n      '\\\\s';\n\n  // For IE8, we need to prevent using an empty character set. Otherwise,\n  // incorrect matching will occur.\n  delimiters = delimiters ? '|[' + delimiters + ']+' : '';\n\n  var regexp = new RegExp('(^' + delimiters + ')([a-z])', 'g');\n  return str.replace(regexp, function(all, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n};\n\n\n/**\n * Capitalizes a string, i.e. converts the first letter to uppercase\n * and all other letters to lowercase, e.g.:\n *\n * goog.string.capitalize('one')     => 'One'\n * goog.string.capitalize('ONE')     => 'One'\n * goog.string.capitalize('one two') => 'One two'\n *\n * Note that this function does not trim initial whitespace.\n *\n * @param {string} str String value to capitalize.\n * @return {string} String value with first letter in uppercase.\n */\ngoog.string.capitalize = function(str) {\n  return String(str.charAt(0)).toUpperCase() +\n      String(str.substr(1)).toLowerCase();\n};\n\n\n/**\n * Parse a string in decimal or hexidecimal ('0xFFFF') form.\n *\n * To parse a particular radix, please use parseInt(string, radix) directly. See\n * https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/parseInt\n *\n * This is a wrapper for the built-in parseInt function that will only parse\n * numbers as base 10 or base 16.  Some JS implementations assume strings\n * starting with \"0\" are intended to be octal. ES3 allowed but discouraged\n * this behavior. ES5 forbids it.  This function emulates the ES5 behavior.\n *\n * For more information, see Mozilla JS Reference: http://goo.gl/8RiFj\n *\n * @param {string|number|null|undefined} value The value to be parsed.\n * @return {number} The number, parsed. If the string failed to parse, this\n *     will be NaN.\n */\ngoog.string.parseInt = function(value) {\n  // Force finite numbers to strings.\n  if (isFinite(value)) {\n    value = String(value);\n  }\n\n  if (goog.isString(value)) {\n    // If the string starts with '0x' or '-0x', parse as hex.\n    return /^\\s*-?0x/i.test(value) ? parseInt(value, 16) : parseInt(value, 10);\n  }\n\n  return NaN;\n};\n\n\n/**\n * Splits a string on a separator a limited number of times.\n *\n * This implementation is more similar to Python or Java, where the limit\n * parameter specifies the maximum number of splits rather than truncating\n * the number of results.\n *\n * See http://docs.python.org/2/library/stdtypes.html#str.split\n * See JavaDoc: http://goo.gl/F2AsY\n * See Mozilla reference: http://goo.gl/dZdZs\n *\n * @param {string} str String to split.\n * @param {string} separator The separator.\n * @param {number} limit The limit to the number of splits. The resulting array\n *     will have a maximum length of limit+1.  Negative numbers are the same\n *     as zero.\n * @return {!Array<string>} The string, split.\n */\ngoog.string.splitLimit = function(str, separator, limit) {\n  var parts = str.split(separator);\n  var returnVal = [];\n\n  // Only continue doing this while we haven't hit the limit and we have\n  // parts left.\n  while (limit > 0 && parts.length) {\n    returnVal.push(parts.shift());\n    limit--;\n  }\n\n  // If there are remaining parts, append them to the end.\n  if (parts.length) {\n    returnVal.push(parts.join(separator));\n  }\n\n  return returnVal;\n};\n\n\n/**\n * Finds the characters to the right of the last instance of any separator\n *\n * This function is similar to goog.string.path.baseName, except it can take a\n * list of characters to split the string on. It will return the rightmost\n * grouping of characters to the right of any separator as a left-to-right\n * oriented string.\n *\n * @see goog.string.path.baseName\n * @param {string} str The string\n * @param {string|!Array<string>} separators A list of separator characters\n * @return {string} The last part of the string with respect to the separators\n */\ngoog.string.lastComponent = function(str, separators) {\n  if (!separators) {\n    return str;\n  } else if (typeof separators == 'string') {\n    separators = [separators];\n  }\n\n  var lastSeparatorIndex = -1;\n  for (var i = 0; i < separators.length; i++) {\n    if (separators[i] == '') {\n      continue;\n    }\n    var currentSeparatorIndex = str.lastIndexOf(separators[i]);\n    if (currentSeparatorIndex > lastSeparatorIndex) {\n      lastSeparatorIndex = currentSeparatorIndex;\n    }\n  }\n  if (lastSeparatorIndex == -1) {\n    return str;\n  }\n  return str.slice(lastSeparatorIndex + 1);\n};\n\n\n/**\n * Computes the Levenshtein edit distance between two strings.\n * @param {string} a\n * @param {string} b\n * @return {number} The edit distance between the two strings.\n */\ngoog.string.editDistance = function(a, b) {\n  var v0 = [];\n  var v1 = [];\n\n  if (a == b) {\n    return 0;\n  }\n\n  if (!a.length || !b.length) {\n    return Math.max(a.length, b.length);\n  }\n\n  for (var i = 0; i < b.length + 1; i++) {\n    v0[i] = i;\n  }\n\n  for (var i = 0; i < a.length; i++) {\n    v1[0] = i + 1;\n\n    for (var j = 0; j < b.length; j++) {\n      var cost = Number(a[i] != b[j]);\n      // Cost for the substring is the minimum of adding one character, removing\n      // one character, or a swap.\n      v1[j + 1] = Math.min(v1[j] + 1, v0[j + 1] + 1, v0[j] + cost);\n    }\n\n    for (var j = 0; j < v0.length; j++) {\n      v0[j] = v1[j];\n    }\n  }\n\n  return v1[b.length];\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Closure user agent detection.\n * @see http://en.wikipedia.org/wiki/User_agent\n * For more information on browser brand, platform, or device see the other\n * sub-namespaces in goog.labs.userAgent (browser, platform, and device).\n *\n */\n\ngoog.provide('goog.labs.userAgent.engine');\n\ngoog.require('goog.array');\ngoog.require('goog.labs.userAgent.util');\ngoog.require('goog.string');\n\n\n/**\n * @return {boolean} Whether the rendering engine is Presto.\n */\ngoog.labs.userAgent.engine.isPresto = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Presto');\n};\n\n\n/**\n * @return {boolean} Whether the rendering engine is Trident.\n */\ngoog.labs.userAgent.engine.isTrident = function() {\n  // IE only started including the Trident token in IE8.\n  return goog.labs.userAgent.util.matchUserAgent('Trident') ||\n      goog.labs.userAgent.util.matchUserAgent('MSIE');\n};\n\n\n/**\n * @return {boolean} Whether the rendering engine is EdgeHTML.\n */\ngoog.labs.userAgent.engine.isEdge = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Edge');\n};\n\n\n/**\n * @return {boolean} Whether the rendering engine is WebKit. This will return\n * true for Chrome, Blink-based Opera (15+), Edge Chromium and Safari.\n */\ngoog.labs.userAgent.engine.isWebKit = function() {\n  return goog.labs.userAgent.util.matchUserAgentIgnoreCase('WebKit') &&\n      !goog.labs.userAgent.engine.isEdge();\n};\n\n\n/**\n * @return {boolean} Whether the rendering engine is Gecko.\n */\ngoog.labs.userAgent.engine.isGecko = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Gecko') &&\n      !goog.labs.userAgent.engine.isWebKit() &&\n      !goog.labs.userAgent.engine.isTrident() &&\n      !goog.labs.userAgent.engine.isEdge();\n};\n\n\n/**\n * @return {string} The rendering engine's version or empty string if version\n *     can't be determined.\n */\ngoog.labs.userAgent.engine.getVersion = function() {\n  var userAgentString = goog.labs.userAgent.util.getUserAgent();\n  if (userAgentString) {\n    var tuples = goog.labs.userAgent.util.extractVersionTuples(userAgentString);\n\n    var engineTuple = goog.labs.userAgent.engine.getEngineTuple_(tuples);\n    if (engineTuple) {\n      // In Gecko, the version string is either in the browser info or the\n      // Firefox version.  See Gecko user agent string reference:\n      // http://goo.gl/mULqa\n      if (engineTuple[0] == 'Gecko') {\n        return goog.labs.userAgent.engine.getVersionForKey_(tuples, 'Firefox');\n      }\n\n      return engineTuple[1];\n    }\n\n    // MSIE has only one version identifier, and the Trident version is\n    // specified in the parenthetical. IE Edge is covered in the engine tuple\n    // detection.\n    var browserTuple = tuples[0];\n    var info;\n    if (browserTuple && (info = browserTuple[2])) {\n      var match = /Trident\\/([^\\s;]+)/.exec(info);\n      if (match) {\n        return match[1];\n      }\n    }\n  }\n  return '';\n};\n\n\n/**\n * @param {!Array<!Array<string>>} tuples Extracted version tuples.\n * @return {!Array<string>|undefined} The engine tuple or undefined if not\n *     found.\n * @private\n */\ngoog.labs.userAgent.engine.getEngineTuple_ = function(tuples) {\n  if (!goog.labs.userAgent.engine.isEdge()) {\n    return tuples[1];\n  }\n  for (var i = 0; i < tuples.length; i++) {\n    var tuple = tuples[i];\n    if (tuple[0] == 'Edge') {\n      return tuple;\n    }\n  }\n};\n\n\n/**\n * @param {string|number} version The version to check.\n * @return {boolean} Whether the rendering engine version is higher or the same\n *     as the given version.\n */\ngoog.labs.userAgent.engine.isVersionOrHigher = function(version) {\n  return goog.string.compareVersions(\n             goog.labs.userAgent.engine.getVersion(), version) >= 0;\n};\n\n\n/**\n * @param {!Array<!Array<string>>} tuples Version tuples.\n * @param {string} key The key to look for.\n * @return {string} The version string of the given key, if present.\n *     Otherwise, the empty string.\n * @private\n */\ngoog.labs.userAgent.engine.getVersionForKey_ = function(tuples, key) {\n  // TODO(nnaze): Move to util if useful elsewhere.\n\n  var pair = goog.array.find(tuples, function(pair) { return key == pair[0]; });\n\n  return pair && pair[1] || '';\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Type-safe wrappers for unsafe DOM APIs.\n *\n * This file provides type-safe wrappers for DOM APIs that can result in\n * cross-site scripting (XSS) vulnerabilities, if the API is supplied with\n * untrusted (attacker-controlled) input.  Instead of plain strings, the type\n * safe wrappers consume values of types from the goog.html package whose\n * contract promises that values are safe to use in the corresponding context.\n *\n * Hence, a program that exclusively uses the wrappers in this file (i.e., whose\n * only reference to security-sensitive raw DOM APIs are in this file) is\n * guaranteed to be free of XSS due to incorrect use of such DOM APIs (modulo\n * correctness of code that produces values of the respective goog.html types,\n * and absent code that violates type safety).\n *\n * For example, assigning to an element's .innerHTML property a string that is\n * derived (even partially) from untrusted input typically results in an XSS\n * vulnerability. The type-safe wrapper goog.dom.safe.setInnerHtml consumes a\n * value of type goog.html.SafeHtml, whose contract states that using its values\n * in a HTML context will not result in XSS. Hence a program that is free of\n * direct assignments to any element's innerHTML property (with the exception of\n * the assignment to .innerHTML in this file) is guaranteed to be free of XSS\n * due to assignment of untrusted strings to the innerHTML property.\n */\n\ngoog.provide('goog.dom.safe');\ngoog.provide('goog.dom.safe.InsertAdjacentHtmlPosition');\n\ngoog.require('goog.asserts');\ngoog.require('goog.dom.asserts');\ngoog.require('goog.functions');\ngoog.require('goog.html.SafeHtml');\ngoog.require('goog.html.SafeScript');\ngoog.require('goog.html.SafeStyle');\ngoog.require('goog.html.SafeUrl');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.html.uncheckedconversions');\ngoog.require('goog.string.Const');\ngoog.require('goog.string.internal');\n\n\n/** @enum {string} */\ngoog.dom.safe.InsertAdjacentHtmlPosition = {\n  AFTERBEGIN: 'afterbegin',\n  AFTEREND: 'afterend',\n  BEFOREBEGIN: 'beforebegin',\n  BEFOREEND: 'beforeend'\n};\n\n\n/**\n * Inserts known-safe HTML into a Node, at the specified position.\n * @param {!Node} node The node on which to call insertAdjacentHTML.\n * @param {!goog.dom.safe.InsertAdjacentHtmlPosition} position Position where\n *     to insert the HTML.\n * @param {!goog.html.SafeHtml} html The known-safe HTML to insert.\n */\ngoog.dom.safe.insertAdjacentHtml = function(node, position, html) {\n  node.insertAdjacentHTML(position, goog.html.SafeHtml.unwrapTrustedHTML(html));\n};\n\n\n/**\n * Tags not allowed in goog.dom.safe.setInnerHtml.\n * @private @const {!Object<string, boolean>}\n */\ngoog.dom.safe.SET_INNER_HTML_DISALLOWED_TAGS_ = {\n  'MATH': true,\n  'SCRIPT': true,\n  'STYLE': true,\n  'SVG': true,\n  'TEMPLATE': true\n};\n\n\n/**\n * Whether assigning to innerHTML results in a non-spec-compliant clean-up. Used\n * to define goog.dom.safe.unsafeSetInnerHtmlDoNotUseOrElse.\n *\n * <p>As mentioned in https://stackoverflow.com/questions/28741528, re-rendering\n * an element in IE by setting innerHTML causes IE to recursively disconnect all\n * parent/children connections that were in the previous contents of the\n * element. Unfortunately, this can unexpectedly result in confusing cases where\n * a function is run (typically asynchronously) on element that has since\n * disconnected from the DOM but assumes the presence of its children. A simple\n * workaround is to remove all children first. Testing on IE11 via\n * https://jsperf.com/innerhtml-vs-removechild/239, removeChild seems to be\n * ~10x faster than innerHTML='' for a large number of children (perhaps due\n * to the latter's recursive behavior), implying that this workaround would\n * not hurt performance and might actually improve it.\n * @return {boolean}\n * @private\n */\ngoog.dom.safe.isInnerHtmlCleanupRecursive_ =\n    goog.functions.cacheReturnValue(function() {\n      // `document` missing in some test frameworks.\n      if (goog.DEBUG && typeof document === 'undefined') {\n        return false;\n      }\n      // Create 3 nested <div>s without using innerHTML.\n      // We're not chaining the appendChilds in one call,  as this breaks\n      // in a DocumentFragment.\n      var div = document.createElement('div');\n      var childDiv = document.createElement('div');\n      childDiv.appendChild(document.createElement('div'));\n      div.appendChild(childDiv);\n      // `firstChild` is null in Google Js Test.\n      if (goog.DEBUG && !div.firstChild) {\n        return false;\n      }\n      var innerChild = div.firstChild.firstChild;\n      div.innerHTML =\n          goog.html.SafeHtml.unwrapTrustedHTML(goog.html.SafeHtml.EMPTY);\n      return !innerChild.parentElement;\n    });\n\n\n/**\n * Assigns HTML to an element's innerHTML property. Helper to use only here and\n * in soy.js.\n * @param {?Element} elem The element whose innerHTML is to be assigned to.\n * @param {!goog.html.SafeHtml} html\n */\ngoog.dom.safe.unsafeSetInnerHtmlDoNotUseOrElse = function(elem, html) {\n  // See comment above goog.dom.safe.isInnerHtmlCleanupRecursive_.\n  if (goog.dom.safe.isInnerHtmlCleanupRecursive_()) {\n    while (elem.lastChild) {\n      elem.removeChild(elem.lastChild);\n    }\n  }\n  elem.innerHTML = goog.html.SafeHtml.unwrapTrustedHTML(html);\n};\n\n\n/**\n * Assigns known-safe HTML to an element's innerHTML property.\n * @param {!Element} elem The element whose innerHTML is to be assigned to.\n * @param {!goog.html.SafeHtml} html The known-safe HTML to assign.\n * @throws {Error} If called with one of these tags: math, script, style, svg,\n *     template.\n */\ngoog.dom.safe.setInnerHtml = function(elem, html) {\n  if (goog.asserts.ENABLE_ASSERTS) {\n    var tagName = elem.tagName.toUpperCase();\n    if (goog.dom.safe.SET_INNER_HTML_DISALLOWED_TAGS_[tagName]) {\n      throw new Error(\n          'goog.dom.safe.setInnerHtml cannot be used to set content of ' +\n          elem.tagName + '.');\n    }\n  }\n\n  goog.dom.safe.unsafeSetInnerHtmlDoNotUseOrElse(elem, html);\n};\n\n\n/**\n * Assigns known-safe HTML to an element's outerHTML property.\n * @param {!Element} elem The element whose outerHTML is to be assigned to.\n * @param {!goog.html.SafeHtml} html The known-safe HTML to assign.\n */\ngoog.dom.safe.setOuterHtml = function(elem, html) {\n  elem.outerHTML = goog.html.SafeHtml.unwrapTrustedHTML(html);\n};\n\n\n/**\n * Safely assigns a URL a form element's action property.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and assigned to\n * anchor's href property.  If url is of type string however, it is first\n * sanitized using goog.html.SafeUrl.sanitize.\n *\n * Example usage:\n *   goog.dom.safe.setFormElementAction(formEl, url);\n * which is a safe alternative to\n *   formEl.action = url;\n * The latter can result in XSS vulnerabilities if url is a\n * user-/attacker-controlled value.\n *\n * @param {!Element} form The form element whose action property\n *     is to be assigned to.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.setFormElementAction = function(form, url) {\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url);\n  }\n  goog.dom.asserts.assertIsHTMLFormElement(form).action =\n      goog.html.SafeUrl.unwrapTrustedURL(safeUrl);\n};\n\n/**\n * Safely assigns a URL to a button element's formaction property.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and assigned to\n * anchor's href property.  If url is of type string however, it is first\n * sanitized using goog.html.SafeUrl.sanitize.\n *\n * Example usage:\n *   goog.dom.safe.setButtonFormAction(buttonEl, url);\n * which is a safe alternative to\n *   buttonEl.action = url;\n * The latter can result in XSS vulnerabilities if url is a\n * user-/attacker-controlled value.\n *\n * @param {!Element} button The button element whose action property\n *     is to be assigned to.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.setButtonFormAction = function(button, url) {\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url);\n  }\n  goog.dom.asserts.assertIsHTMLButtonElement(button).formAction =\n      goog.html.SafeUrl.unwrapTrustedURL(safeUrl);\n};\n/**\n * Safely assigns a URL to an input element's formaction property.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and assigned to\n * anchor's href property.  If url is of type string however, it is first\n * sanitized using goog.html.SafeUrl.sanitize.\n *\n * Example usage:\n *   goog.dom.safe.setInputFormAction(inputEl, url);\n * which is a safe alternative to\n *   inputEl.action = url;\n * The latter can result in XSS vulnerabilities if url is a\n * user-/attacker-controlled value.\n *\n * @param {!Element} input The input element whose action property\n *     is to be assigned to.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.setInputFormAction = function(input, url) {\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url);\n  }\n  goog.dom.asserts.assertIsHTMLInputElement(input).formAction =\n      goog.html.SafeUrl.unwrapTrustedURL(safeUrl);\n};\n\n/**\n * Sets the given element's style property to the contents of the provided\n * SafeStyle object.\n * @param {!Element} elem\n * @param {!goog.html.SafeStyle} style\n */\ngoog.dom.safe.setStyle = function(elem, style) {\n  elem.style.cssText = goog.html.SafeStyle.unwrap(style);\n};\n\n\n/**\n * Writes known-safe HTML to a document.\n * @param {!Document} doc The document to be written to.\n * @param {!goog.html.SafeHtml} html The known-safe HTML to assign.\n */\ngoog.dom.safe.documentWrite = function(doc, html) {\n  doc.write(goog.html.SafeHtml.unwrapTrustedHTML(html));\n};\n\n\n/**\n * Safely assigns a URL to an anchor element's href property.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and assigned to\n * anchor's href property.  If url is of type string however, it is first\n * sanitized using goog.html.SafeUrl.sanitize.\n *\n * Example usage:\n *   goog.dom.safe.setAnchorHref(anchorEl, url);\n * which is a safe alternative to\n *   anchorEl.href = url;\n * The latter can result in XSS vulnerabilities if url is a\n * user-/attacker-controlled value.\n *\n * @param {!HTMLAnchorElement} anchor The anchor element whose href property\n *     is to be assigned to.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.setAnchorHref = function(anchor, url) {\n  goog.dom.asserts.assertIsHTMLAnchorElement(anchor);\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url);\n  }\n  anchor.href = goog.html.SafeUrl.unwrapTrustedURL(safeUrl);\n};\n\n\n/**\n * Safely assigns a URL to an image element's src property.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and assigned to\n * image's src property.  If url is of type string however, it is first\n * sanitized using goog.html.SafeUrl.sanitize.\n *\n * @param {!HTMLImageElement} imageElement The image element whose src property\n *     is to be assigned to.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.setImageSrc = function(imageElement, url) {\n  goog.dom.asserts.assertIsHTMLImageElement(imageElement);\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    var allowDataUrl = /^data:image\\//i.test(url);\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url, allowDataUrl);\n  }\n  imageElement.src = goog.html.SafeUrl.unwrapTrustedURL(safeUrl);\n};\n\n/**\n * Safely assigns a URL to a audio element's src property.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and assigned to\n * audio's src property.  If url is of type string however, it is first\n * sanitized using goog.html.SafeUrl.sanitize.\n *\n * @param {!HTMLAudioElement} audioElement The audio element whose src property\n *     is to be assigned to.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.setAudioSrc = function(audioElement, url) {\n  goog.dom.asserts.assertIsHTMLAudioElement(audioElement);\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    var allowDataUrl = /^data:audio\\//i.test(url);\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url, allowDataUrl);\n  }\n  audioElement.src = goog.html.SafeUrl.unwrapTrustedURL(safeUrl);\n};\n\n/**\n * Safely assigns a URL to a video element's src property.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and assigned to\n * video's src property.  If url is of type string however, it is first\n * sanitized using goog.html.SafeUrl.sanitize.\n *\n * @param {!HTMLVideoElement} videoElement The video element whose src property\n *     is to be assigned to.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.setVideoSrc = function(videoElement, url) {\n  goog.dom.asserts.assertIsHTMLVideoElement(videoElement);\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    var allowDataUrl = /^data:video\\//i.test(url);\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url, allowDataUrl);\n  }\n  videoElement.src = goog.html.SafeUrl.unwrapTrustedURL(safeUrl);\n};\n\n/**\n * Safely assigns a URL to an embed element's src property.\n *\n * Example usage:\n *   goog.dom.safe.setEmbedSrc(embedEl, url);\n * which is a safe alternative to\n *   embedEl.src = url;\n * The latter can result in loading untrusted code unless it is ensured that\n * the URL refers to a trustworthy resource.\n *\n * @param {!HTMLEmbedElement} embed The embed element whose src property\n *     is to be assigned to.\n * @param {!goog.html.TrustedResourceUrl} url The URL to assign.\n */\ngoog.dom.safe.setEmbedSrc = function(embed, url) {\n  goog.dom.asserts.assertIsHTMLEmbedElement(embed);\n  embed.src = goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(url);\n};\n\n\n/**\n * Safely assigns a URL to a frame element's src property.\n *\n * Example usage:\n *   goog.dom.safe.setFrameSrc(frameEl, url);\n * which is a safe alternative to\n *   frameEl.src = url;\n * The latter can result in loading untrusted code unless it is ensured that\n * the URL refers to a trustworthy resource.\n *\n * @param {!HTMLFrameElement} frame The frame element whose src property\n *     is to be assigned to.\n * @param {!goog.html.TrustedResourceUrl} url The URL to assign.\n */\ngoog.dom.safe.setFrameSrc = function(frame, url) {\n  goog.dom.asserts.assertIsHTMLFrameElement(frame);\n  frame.src = goog.html.TrustedResourceUrl.unwrapTrustedURL(url);\n};\n\n\n/**\n * Safely assigns a URL to an iframe element's src property.\n *\n * Example usage:\n *   goog.dom.safe.setIframeSrc(iframeEl, url);\n * which is a safe alternative to\n *   iframeEl.src = url;\n * The latter can result in loading untrusted code unless it is ensured that\n * the URL refers to a trustworthy resource.\n *\n * @param {!HTMLIFrameElement} iframe The iframe element whose src property\n *     is to be assigned to.\n * @param {!goog.html.TrustedResourceUrl} url The URL to assign.\n */\ngoog.dom.safe.setIframeSrc = function(iframe, url) {\n  goog.dom.asserts.assertIsHTMLIFrameElement(iframe);\n  iframe.src = goog.html.TrustedResourceUrl.unwrapTrustedURL(url);\n};\n\n\n/**\n * Safely assigns HTML to an iframe element's srcdoc property.\n *\n * Example usage:\n *   goog.dom.safe.setIframeSrcdoc(iframeEl, safeHtml);\n * which is a safe alternative to\n *   iframeEl.srcdoc = html;\n * The latter can result in loading untrusted code.\n *\n * @param {!HTMLIFrameElement} iframe The iframe element whose srcdoc property\n *     is to be assigned to.\n * @param {!goog.html.SafeHtml} html The HTML to assign.\n */\ngoog.dom.safe.setIframeSrcdoc = function(iframe, html) {\n  goog.dom.asserts.assertIsHTMLIFrameElement(iframe);\n  iframe.srcdoc = goog.html.SafeHtml.unwrapTrustedHTML(html);\n};\n\n\n/**\n * Safely sets a link element's href and rel properties. Whether or not\n * the URL assigned to href has to be a goog.html.TrustedResourceUrl\n * depends on the value of the rel property. If rel contains \"stylesheet\"\n * then a TrustedResourceUrl is required.\n *\n * Example usage:\n *   goog.dom.safe.setLinkHrefAndRel(linkEl, url, 'stylesheet');\n * which is a safe alternative to\n *   linkEl.rel = 'stylesheet';\n *   linkEl.href = url;\n * The latter can result in loading untrusted code unless it is ensured that\n * the URL refers to a trustworthy resource.\n *\n * @param {!HTMLLinkElement} link The link element whose href property\n *     is to be assigned to.\n * @param {string|!goog.html.SafeUrl|!goog.html.TrustedResourceUrl} url The URL\n *     to assign to the href property. Must be a TrustedResourceUrl if the\n *     value assigned to rel contains \"stylesheet\". A string value is\n *     sanitized with goog.html.SafeUrl.sanitize.\n * @param {string} rel The value to assign to the rel property.\n * @throws {Error} if rel contains \"stylesheet\" and url is not a\n *     TrustedResourceUrl\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.setLinkHrefAndRel = function(link, url, rel) {\n  goog.dom.asserts.assertIsHTMLLinkElement(link);\n  link.rel = rel;\n  if (goog.string.internal.caseInsensitiveContains(rel, 'stylesheet')) {\n    goog.asserts.assert(\n        url instanceof goog.html.TrustedResourceUrl,\n        'URL must be TrustedResourceUrl because \"rel\" contains \"stylesheet\"');\n    link.href = goog.html.TrustedResourceUrl.unwrapTrustedURL(url);\n  } else if (url instanceof goog.html.TrustedResourceUrl) {\n    link.href = goog.html.TrustedResourceUrl.unwrapTrustedURL(url);\n  } else if (url instanceof goog.html.SafeUrl) {\n    link.href = goog.html.SafeUrl.unwrapTrustedURL(url);\n  } else {  // string\n    // SafeUrl.sanitize must return legitimate SafeUrl when passed a string.\n    link.href = goog.html.SafeUrl.unwrapTrustedURL(\n        goog.html.SafeUrl.sanitizeAssertUnchanged(url));\n  }\n};\n\n\n/**\n * Safely assigns a URL to an object element's data property.\n *\n * Example usage:\n *   goog.dom.safe.setObjectData(objectEl, url);\n * which is a safe alternative to\n *   objectEl.data = url;\n * The latter can result in loading untrusted code unless setit is ensured that\n * the URL refers to a trustworthy resource.\n *\n * @param {!HTMLObjectElement} object The object element whose data property\n *     is to be assigned to.\n * @param {!goog.html.TrustedResourceUrl} url The URL to assign.\n */\ngoog.dom.safe.setObjectData = function(object, url) {\n  goog.dom.asserts.assertIsHTMLObjectElement(object);\n  object.data = goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(url);\n};\n\n\n/**\n * Safely assigns a URL to a script element's src property.\n *\n * Example usage:\n *   goog.dom.safe.setScriptSrc(scriptEl, url);\n * which is a safe alternative to\n *   scriptEl.src = url;\n * The latter can result in loading untrusted code unless it is ensured that\n * the URL refers to a trustworthy resource.\n *\n * @param {!HTMLScriptElement} script The script element whose src property\n *     is to be assigned to.\n * @param {!goog.html.TrustedResourceUrl} url The URL to assign.\n */\ngoog.dom.safe.setScriptSrc = function(script, url) {\n  goog.dom.asserts.assertIsHTMLScriptElement(script);\n  script.src = goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(url);\n\n  // If CSP nonces are used, propagate them to dynamically created scripts.\n  // This is necessary to allow nonce-based CSPs without 'strict-dynamic'.\n  var nonce = goog.getScriptNonce();\n  if (nonce) {\n    script.setAttribute('nonce', nonce);\n  }\n};\n\n\n/**\n * Safely assigns a value to a script element's content.\n *\n * Example usage:\n *   goog.dom.safe.setScriptContent(scriptEl, content);\n * which is a safe alternative to\n *   scriptEl.text = content;\n * The latter can result in executing untrusted code unless it is ensured that\n * the code is loaded from a trustworthy resource.\n *\n * @param {!HTMLScriptElement} script The script element whose content is being\n *     set.\n * @param {!goog.html.SafeScript} content The content to assign.\n */\ngoog.dom.safe.setScriptContent = function(script, content) {\n  goog.dom.asserts.assertIsHTMLScriptElement(script);\n  script.text = goog.html.SafeScript.unwrapTrustedScript(content);\n\n  // If CSP nonces are used, propagate them to dynamically created scripts.\n  // This is necessary to allow nonce-based CSPs without 'strict-dynamic'.\n  var nonce = goog.getScriptNonce();\n  if (nonce) {\n    script.setAttribute('nonce', nonce);\n  }\n};\n\n\n/**\n * Safely assigns a URL to a Location object's href property.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and assigned to\n * loc's href property.  If url is of type string however, it is first sanitized\n * using goog.html.SafeUrl.sanitize.\n *\n * Example usage:\n *   goog.dom.safe.setLocationHref(document.location, redirectUrl);\n * which is a safe alternative to\n *   document.location.href = redirectUrl;\n * The latter can result in XSS vulnerabilities if redirectUrl is a\n * user-/attacker-controlled value.\n *\n * @param {!Location} loc The Location object whose href property is to be\n *     assigned to.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.setLocationHref = function(loc, url) {\n  goog.dom.asserts.assertIsLocation(loc);\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url);\n  }\n  loc.href = goog.html.SafeUrl.unwrapTrustedURL(safeUrl);\n};\n\n/**\n * Safely assigns the URL of a Location object.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and\n * passed to Location#assign. If url is of type string however, it is\n * first sanitized using goog.html.SafeUrl.sanitize.\n *\n * Example usage:\n *   goog.dom.safe.assignLocation(document.location, newUrl);\n * which is a safe alternative to\n *   document.location.assign(newUrl);\n * The latter can result in XSS vulnerabilities if newUrl is a\n * user-/attacker-controlled value.\n *\n * This has the same behaviour as setLocationHref, however some test\n * mock Location.assign instead of a property assignment.\n *\n * @param {!Location} loc The Location object which is to be assigned.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.assignLocation = function(loc, url) {\n  goog.dom.asserts.assertIsLocation(loc);\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url);\n  }\n  loc.assign(goog.html.SafeUrl.unwrapTrustedURL(safeUrl));\n};\n\n\n/**\n * Safely replaces the URL of a Location object.\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and\n * passed to Location#replace. If url is of type string however, it is\n * first sanitized using goog.html.SafeUrl.sanitize.\n *\n * Example usage:\n *   goog.dom.safe.replaceLocation(document.location, newUrl);\n * which is a safe alternative to\n *   document.location.replace(newUrl);\n * The latter can result in XSS vulnerabilities if newUrl is a\n * user-/attacker-controlled value.\n *\n * @param {!Location} loc The Location object which is to be replaced.\n * @param {string|!goog.html.SafeUrl} url The URL to assign.\n * @see goog.html.SafeUrl#sanitize\n */\ngoog.dom.safe.replaceLocation = function(loc, url) {\n  goog.dom.asserts.assertIsLocation(loc);\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url);\n  }\n  loc.replace(goog.html.SafeUrl.unwrapTrustedURL(safeUrl));\n};\n\n\n/**\n * Safely opens a URL in a new window (via window.open).\n *\n * If url is of type goog.html.SafeUrl, its value is unwrapped and passed in to\n * window.open.  If url is of type string however, it is first sanitized\n * using goog.html.SafeUrl.sanitize.\n *\n * Note that this function does not prevent leakages via the referer that is\n * sent by window.open. It is advised to only use this to open 1st party URLs.\n *\n * Example usage:\n *   goog.dom.safe.openInWindow(url);\n * which is a safe alternative to\n *   window.open(url);\n * The latter can result in XSS vulnerabilities if redirectUrl is a\n * user-/attacker-controlled value.\n *\n * @param {string|!goog.html.SafeUrl} url The URL to open.\n * @param {Window=} opt_openerWin Window of which to call the .open() method.\n *     Defaults to the global window.\n * @param {!goog.string.Const=} opt_name Name of the window to open in. Can be\n *     _top, etc as allowed by window.open().\n * @param {string=} opt_specs Comma-separated list of specifications, same as\n *     in window.open().\n * @param {boolean=} opt_replace Whether to replace the current entry in browser\n *     history, same as in window.open().\n * @return {Window} Window the url was opened in.\n */\ngoog.dom.safe.openInWindow = function(\n    url, opt_openerWin, opt_name, opt_specs, opt_replace) {\n  /** @type {!goog.html.SafeUrl} */\n  var safeUrl;\n  if (url instanceof goog.html.SafeUrl) {\n    safeUrl = url;\n  } else {\n    safeUrl = goog.html.SafeUrl.sanitizeAssertUnchanged(url);\n  }\n  var win = opt_openerWin || goog.global;\n  return win.open(\n      goog.html.SafeUrl.unwrapTrustedURL(safeUrl),\n      // If opt_name is undefined, simply passing that in to open() causes IE to\n      // reuse the current window instead of opening a new one. Thus we pass ''\n      // in instead, which according to spec opens a new window. See\n      // https://html.spec.whatwg.org/multipage/browsers.html#dom-open .\n      opt_name ? goog.string.Const.unwrap(opt_name) : '', opt_specs,\n      opt_replace);\n};\n\n\n/**\n * Parses the HTML as 'text/html'.\n * @param {!DOMParser} parser\n * @param {!goog.html.SafeHtml} html The HTML to be parsed.\n * @return {?Document}\n */\ngoog.dom.safe.parseFromStringHtml = function(parser, html) {\n  return goog.dom.safe.parseFromString(parser, html, 'text/html');\n};\n\n\n/**\n * Parses the string.\n * @param {!DOMParser} parser\n * @param {!goog.html.SafeHtml} content Note: We don't have a special type for\n *     XML od SVG supported by this function so we use SafeHtml.\n * @param {string} type\n * @return {?Document}\n */\ngoog.dom.safe.parseFromString = function(parser, content, type) {\n  return parser.parseFromString(\n      goog.html.SafeHtml.unwrapTrustedHTML(content), type);\n};\n\n\n/**\n * Safely creates an HTMLImageElement from a Blob.\n *\n * Example usage:\n *     goog.dom.safe.createImageFromBlob(blob);\n * which is a safe alternative to\n *     image.src = createObjectUrl(blob)\n * The latter can result in executing malicious same-origin scripts from a bad\n * Blob.\n * @param {!Blob} blob The blob to create the image from.\n * @return {!HTMLImageElement} The image element created from the blob.\n * @throws {!Error} If called with a Blob with a MIME type other than image/.*.\n */\ngoog.dom.safe.createImageFromBlob = function(blob) {\n  // Any image/* MIME type is accepted as safe.\n  if (!/^image\\/.*/g.test(blob.type)) {\n    throw new Error(\n        'goog.dom.safe.createImageFromBlob only accepts MIME type image/.*.');\n  }\n  var objectUrl = goog.global.URL.createObjectURL(blob);\n  var image = new goog.global.Image();\n  image.onload = function() {\n    goog.global.URL.revokeObjectURL(objectUrl);\n  };\n  goog.dom.safe.setImageSrc(\n      image,\n      goog.html.uncheckedconversions\n          .safeUrlFromStringKnownToSatisfyTypeContract(\n              goog.string.Const.from('Image blob URL.'), objectUrl));\n  return image;\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Closure user agent detection (Browser).\n * @see <a href=\"http://www.useragentstring.com/\">User agent strings</a>\n * For more information on rendering engine, platform, or device see the other\n * sub-namespaces in goog.labs.userAgent, goog.labs.userAgent.platform,\n * goog.labs.userAgent.device respectively.)\n *\n * @author martone@google.com (Andy Martone)\n */\n\ngoog.provide('goog.labs.userAgent.browser');\n\ngoog.require('goog.array');\ngoog.require('goog.labs.userAgent.util');\ngoog.require('goog.object');\ngoog.require('goog.string.internal');\n\n\n// TODO(nnaze): Refactor to remove excessive exclusion logic in matching\n// functions.\n\n\n/**\n * @return {boolean} Whether the user's browser is Opera.  Note: Chromium\n *     based Opera (Opera 15+) is detected as Chrome to avoid unnecessary\n *     special casing.\n * @private\n */\ngoog.labs.userAgent.browser.matchOpera_ = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Opera');\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is IE.\n * @private\n */\ngoog.labs.userAgent.browser.matchIE_ = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Trident') ||\n      goog.labs.userAgent.util.matchUserAgent('MSIE');\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is Edge. This refers to EdgeHTML\n * based Edge.\n * @private\n */\ngoog.labs.userAgent.browser.matchEdgeHtml_ = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Edge');\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is Chromium based Edge.\n * @private\n */\ngoog.labs.userAgent.browser.matchEdgeChromium_ = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Edg/');\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is Chromium based Opera.\n * @private\n */\ngoog.labs.userAgent.browser.matchOperaChromium_ = function() {\n  return goog.labs.userAgent.util.matchUserAgent('OPR');\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is Firefox.\n * @private\n */\ngoog.labs.userAgent.browser.matchFirefox_ = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Firefox') ||\n      goog.labs.userAgent.util.matchUserAgent('FxiOS');\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is Safari.\n * @private\n */\ngoog.labs.userAgent.browser.matchSafari_ = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Safari') &&\n      !(goog.labs.userAgent.browser.matchChrome_() ||\n        goog.labs.userAgent.browser.matchCoast_() ||\n        goog.labs.userAgent.browser.matchOpera_() ||\n        goog.labs.userAgent.browser.matchEdgeHtml_() ||\n        goog.labs.userAgent.browser.matchEdgeChromium_() ||\n        goog.labs.userAgent.browser.matchOperaChromium_() ||\n        goog.labs.userAgent.browser.matchFirefox_() ||\n        goog.labs.userAgent.browser.isSilk() ||\n        goog.labs.userAgent.util.matchUserAgent('Android'));\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is Coast (Opera's Webkit-based\n *     iOS browser).\n * @private\n */\ngoog.labs.userAgent.browser.matchCoast_ = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Coast');\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is iOS Webview.\n * @private\n */\ngoog.labs.userAgent.browser.matchIosWebview_ = function() {\n  // iOS Webview does not show up as Chrome or Safari. Also check for Opera's\n  // WebKit-based iOS browser, Coast.\n  return (goog.labs.userAgent.util.matchUserAgent('iPad') ||\n          goog.labs.userAgent.util.matchUserAgent('iPhone')) &&\n      !goog.labs.userAgent.browser.matchSafari_() &&\n      !goog.labs.userAgent.browser.matchChrome_() &&\n      !goog.labs.userAgent.browser.matchCoast_() &&\n      !goog.labs.userAgent.browser.matchFirefox_() &&\n      goog.labs.userAgent.util.matchUserAgent('AppleWebKit');\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is any Chromium browser. This\n * returns true for Chrome, Opera 15+, and Edge Chromium.\n * @private\n */\ngoog.labs.userAgent.browser.matchChrome_ = function() {\n  return (goog.labs.userAgent.util.matchUserAgent('Chrome') ||\n          goog.labs.userAgent.util.matchUserAgent('CriOS')) &&\n      !goog.labs.userAgent.browser.matchEdgeHtml_();\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is the Android browser.\n * @private\n */\ngoog.labs.userAgent.browser.matchAndroidBrowser_ = function() {\n  // Android can appear in the user agent string for Chrome on Android.\n  // This is not the Android standalone browser if it does.\n  return goog.labs.userAgent.util.matchUserAgent('Android') &&\n      !(goog.labs.userAgent.browser.isChrome() ||\n        goog.labs.userAgent.browser.isFirefox() ||\n        goog.labs.userAgent.browser.isOpera() ||\n        goog.labs.userAgent.browser.isSilk());\n};\n\n\n/**\n * @return {boolean} Whether the user's browser is Opera.\n */\ngoog.labs.userAgent.browser.isOpera = goog.labs.userAgent.browser.matchOpera_;\n\n\n/**\n * @return {boolean} Whether the user's browser is IE.\n */\ngoog.labs.userAgent.browser.isIE = goog.labs.userAgent.browser.matchIE_;\n\n\n/**\n * @return {boolean} Whether the user's browser is EdgeHTML based Edge.\n */\ngoog.labs.userAgent.browser.isEdge = goog.labs.userAgent.browser.matchEdgeHtml_;\n\n\n/**\n * @return {boolean} Whether the user's browser is Chromium based Edge.\n */\ngoog.labs.userAgent.browser.isEdgeChromium =\n    goog.labs.userAgent.browser.matchEdgeChromium_;\n\n/**\n * @return {boolean} Whether the user's browser is Chromium based Opera.\n */\ngoog.labs.userAgent.browser.isOperaChromium =\n    goog.labs.userAgent.browser.matchOperaChromium_;\n\n/**\n * @return {boolean} Whether the user's browser is Firefox.\n */\ngoog.labs.userAgent.browser.isFirefox =\n    goog.labs.userAgent.browser.matchFirefox_;\n\n\n/**\n * @return {boolean} Whether the user's browser is Safari.\n */\ngoog.labs.userAgent.browser.isSafari = goog.labs.userAgent.browser.matchSafari_;\n\n\n/**\n * @return {boolean} Whether the user's browser is Coast (Opera's Webkit-based\n *     iOS browser).\n */\ngoog.labs.userAgent.browser.isCoast = goog.labs.userAgent.browser.matchCoast_;\n\n\n/**\n * @return {boolean} Whether the user's browser is iOS Webview.\n */\ngoog.labs.userAgent.browser.isIosWebview =\n    goog.labs.userAgent.browser.matchIosWebview_;\n\n\n/**\n * @return {boolean} Whether the user's browser is any Chromium based browser (\n * Chrome, Blink-based Opera (15+) and Edge Chromium).\n */\ngoog.labs.userAgent.browser.isChrome = goog.labs.userAgent.browser.matchChrome_;\n\n\n/**\n * @return {boolean} Whether the user's browser is the Android browser.\n */\ngoog.labs.userAgent.browser.isAndroidBrowser =\n    goog.labs.userAgent.browser.matchAndroidBrowser_;\n\n\n/**\n * For more information, see:\n * http://docs.aws.amazon.com/silk/latest/developerguide/user-agent.html\n * @return {boolean} Whether the user's browser is Silk.\n */\ngoog.labs.userAgent.browser.isSilk = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Silk');\n};\n\n\n/**\n * @return {string} The browser version or empty string if version cannot be\n *     determined. Note that for Internet Explorer, this returns the version of\n *     the browser, not the version of the rendering engine. (IE 8 in\n *     compatibility mode will return 8.0 rather than 7.0. To determine the\n *     rendering engine version, look at document.documentMode instead. See\n *     http://msdn.microsoft.com/en-us/library/cc196988(v=vs.85).aspx for more\n *     details.)\n */\ngoog.labs.userAgent.browser.getVersion = function() {\n  var userAgentString = goog.labs.userAgent.util.getUserAgent();\n  // Special case IE since IE's version is inside the parenthesis and\n  // without the '/'.\n  if (goog.labs.userAgent.browser.isIE()) {\n    return goog.labs.userAgent.browser.getIEVersion_(userAgentString);\n  }\n\n  var versionTuples =\n      goog.labs.userAgent.util.extractVersionTuples(userAgentString);\n\n  // Construct a map for easy lookup.\n  var versionMap = {};\n  goog.array.forEach(versionTuples, function(tuple) {\n    // Note that the tuple is of length three, but we only care about the\n    // first two.\n    var key = tuple[0];\n    var value = tuple[1];\n    versionMap[key] = value;\n  });\n\n  var versionMapHasKey = goog.partial(goog.object.containsKey, versionMap);\n\n  // Gives the value with the first key it finds, otherwise empty string.\n  function lookUpValueWithKeys(keys) {\n    var key = goog.array.find(keys, versionMapHasKey);\n    return versionMap[key] || '';\n  }\n\n  // Check Opera before Chrome since Opera 15+ has \"Chrome\" in the string.\n  // See\n  // http://my.opera.com/ODIN/blog/2013/07/15/opera-user-agent-strings-opera-15-and-beyond\n  if (goog.labs.userAgent.browser.isOpera()) {\n    // Opera 10 has Version/10.0 but Opera/9.8, so look for \"Version\" first.\n    // Opera uses 'OPR' for more recent UAs.\n    return lookUpValueWithKeys(['Version', 'Opera']);\n  }\n\n  // Check Edge before Chrome since it has Chrome in the string.\n  if (goog.labs.userAgent.browser.isEdge()) {\n    return lookUpValueWithKeys(['Edge']);\n  }\n\n  // Check Chromium Edge before Chrome since it has Chrome in the string.\n  if (goog.labs.userAgent.browser.isEdgeChromium()) {\n    return lookUpValueWithKeys(['Edg']);\n  }\n\n  if (goog.labs.userAgent.browser.isChrome()) {\n    return lookUpValueWithKeys(['Chrome', 'CriOS']);\n  }\n\n  // Usually products browser versions are in the third tuple after \"Mozilla\"\n  // and the engine.\n  var tuple = versionTuples[2];\n  return tuple && tuple[1] || '';\n};\n\n\n/**\n * @param {string|number} version The version to check.\n * @return {boolean} Whether the browser version is higher or the same as the\n *     given version.\n */\ngoog.labs.userAgent.browser.isVersionOrHigher = function(version) {\n  return goog.string.internal.compareVersions(\n             goog.labs.userAgent.browser.getVersion(), version) >= 0;\n};\n\n\n/**\n * Determines IE version. More information:\n * http://msdn.microsoft.com/en-us/library/ie/bg182625(v=vs.85).aspx#uaString\n * http://msdn.microsoft.com/en-us/library/hh869301(v=vs.85).aspx\n * http://blogs.msdn.com/b/ie/archive/2010/03/23/introducing-ie9-s-user-agent-string.aspx\n * http://blogs.msdn.com/b/ie/archive/2009/01/09/the-internet-explorer-8-user-agent-string-updated-edition.aspx\n *\n * @param {string} userAgent the User-Agent.\n * @return {string}\n * @private\n */\ngoog.labs.userAgent.browser.getIEVersion_ = function(userAgent) {\n  // IE11 may identify itself as MSIE 9.0 or MSIE 10.0 due to an IE 11 upgrade\n  // bug. Example UA:\n  // Mozilla/5.0 (MSIE 9.0; Windows NT 6.1; WOW64; Trident/7.0; rv:11.0)\n  // like Gecko.\n  // See http://www.whatismybrowser.com/developers/unknown-user-agent-fragments.\n  var rv = /rv: *([\\d\\.]*)/.exec(userAgent);\n  if (rv && rv[1]) {\n    return rv[1];\n  }\n\n  var version = '';\n  var msie = /MSIE +([\\d\\.]+)/.exec(userAgent);\n  if (msie && msie[1]) {\n    // IE in compatibility mode usually identifies itself as MSIE 7.0; in this\n    // case, use the Trident version to determine the version of IE. For more\n    // details, see the links above.\n    var tridentVersion = /Trident\\/(\\d.\\d)/.exec(userAgent);\n    if (msie[1] == '7.0') {\n      if (tridentVersion && tridentVersion[1]) {\n        switch (tridentVersion[1]) {\n          case '4.0':\n            version = '8.0';\n            break;\n          case '5.0':\n            version = '9.0';\n            break;\n          case '6.0':\n            version = '10.0';\n            break;\n          case '7.0':\n            version = '11.0';\n            break;\n        }\n      } else {\n        version = '7.0';\n      }\n    } else {\n      version = msie[1];\n    }\n  }\n  return version;\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\ngoog.provide('goog.Promise');\n\ngoog.require('goog.Thenable');\ngoog.require('goog.asserts');\ngoog.require('goog.async.FreeList');\ngoog.require('goog.async.run');\ngoog.require('goog.async.throwException');\ngoog.require('goog.debug.Error');\ngoog.require('goog.promise.Resolver');\n\n\n\n/**\n * NOTE: This class was created in anticipation of the built-in Promise type\n * being standardized and implemented across browsers. Now that Promise is\n * available in modern browsers, and is automatically polyfilled by the Closure\n * Compiler, by default, most new code should use native `Promise`\n * instead of `goog.Promise`. However, `goog.Promise` has the\n * concept of cancellation which native Promises do not yet have. So code\n * needing cancellation may still want to use `goog.Promise`.\n *\n * Promises provide a result that may be resolved asynchronously. A Promise may\n * be resolved by being fulfilled with a fulfillment value, rejected with a\n * rejection reason, or blocked by another Promise. A Promise is said to be\n * settled if it is either fulfilled or rejected. Once settled, the Promise\n * result is immutable.\n *\n * Promises may represent results of any type, including undefined. Rejection\n * reasons are typically Errors, but may also be of any type. Closure Promises\n * allow for optional type annotations that enforce that fulfillment values are\n * of the appropriate types at compile time.\n *\n * The result of a Promise is accessible by calling `then` and registering\n * `onFulfilled` and `onRejected` callbacks. Once the Promise\n * is settled, the relevant callbacks are invoked with the fulfillment value or\n * rejection reason as argument. Callbacks are always invoked in the order they\n * were registered, even when additional `then` calls are made from inside\n * another callback. A callback is always run asynchronously sometime after the\n * scope containing the registering `then` invocation has returned.\n *\n * If a Promise is resolved with another Promise, the first Promise will block\n * until the second is settled, and then assumes the same result as the second\n * Promise. This allows Promises to depend on the results of other Promises,\n * linking together multiple asynchronous operations.\n *\n * This implementation is compatible with the Promises/A+ specification and\n * passes that specification's conformance test suite. A Closure Promise may be\n * resolved with a Promise instance (or sufficiently compatible Promise-like\n * object) created by other Promise implementations. From the specification,\n * Promise-like objects are known as \"Thenables\".\n *\n * @see http://promisesaplus.com/\n *\n * @param {function(\n *             this:RESOLVER_CONTEXT,\n *             function((TYPE|IThenable<TYPE>|Thenable)=),\n *             function(*=)): void} resolver\n *     Initialization function that is invoked immediately with `resolve`\n *     and `reject` functions as arguments. The Promise is resolved or\n *     rejected with the first argument passed to either function.\n * @param {RESOLVER_CONTEXT=} opt_context An optional context for executing the\n *     resolver function. If unspecified, the resolver function will be executed\n *     in the default scope.\n * @constructor\n * @struct\n * @final\n * @implements {goog.Thenable<TYPE>}\n * @template TYPE,RESOLVER_CONTEXT\n */\ngoog.Promise = function(resolver, opt_context) {\n  /**\n   * The internal state of this Promise. Either PENDING, FULFILLED, REJECTED, or\n   * BLOCKED.\n   * @private {goog.Promise.State_}\n   */\n  this.state_ = goog.Promise.State_.PENDING;\n\n  /**\n   * The settled result of the Promise. Immutable once set with either a\n   * fulfillment value or rejection reason.\n   * @private {*}\n   */\n  this.result_ = undefined;\n\n  /**\n   * For Promises created by calling `then()`, the originating parent.\n   * @private {?goog.Promise}\n   */\n  this.parent_ = null;\n\n  /**\n   * The linked list of `onFulfilled` and `onRejected` callbacks\n   * added to this Promise by calls to `then()`.\n   * @private {?goog.Promise.CallbackEntry_}\n   */\n  this.callbackEntries_ = null;\n\n  /**\n   * The tail of the linked list of `onFulfilled` and `onRejected`\n   * callbacks added to this Promise by calls to `then()`.\n   * @private {?goog.Promise.CallbackEntry_}\n   */\n  this.callbackEntriesTail_ = null;\n\n  /**\n   * Whether the Promise is in the queue of Promises to execute.\n   * @private {boolean}\n   */\n  this.executing_ = false;\n\n  if (goog.Promise.UNHANDLED_REJECTION_DELAY > 0) {\n    /**\n     * A timeout ID used when the `UNHANDLED_REJECTION_DELAY` is greater\n     * than 0 milliseconds. The ID is set when the Promise is rejected, and\n     * cleared only if an `onRejected` callback is invoked for the\n     * Promise (or one of its descendants) before the delay is exceeded.\n     *\n     * If the rejection is not handled before the timeout completes, the\n     * rejection reason is passed to the unhandled rejection handler.\n     * @private {number}\n     */\n    this.unhandledRejectionId_ = 0;\n  } else if (goog.Promise.UNHANDLED_REJECTION_DELAY == 0) {\n    /**\n     * When the `UNHANDLED_REJECTION_DELAY` is set to 0 milliseconds, a\n     * boolean that is set if the Promise is rejected, and reset to false if an\n     * `onRejected` callback is invoked for the Promise (or one of its\n     * descendants). If the rejection is not handled before the next timestep,\n     * the rejection reason is passed to the unhandled rejection handler.\n     * @private {boolean}\n     */\n    this.hadUnhandledRejection_ = false;\n  }\n\n  if (goog.Promise.LONG_STACK_TRACES) {\n    /**\n     * A list of stack trace frames pointing to the locations where this Promise\n     * was created or had callbacks added to it. Saved to add additional context\n     * to stack traces when an exception is thrown.\n     * @private {!Array<string>}\n     */\n    this.stack_ = [];\n    this.addStackTrace_(new Error('created'));\n\n    /**\n     * Index of the most recently executed stack frame entry.\n     * @private {number}\n     */\n    this.currentStep_ = 0;\n  }\n\n  // As an optimization, we can skip this if resolver is goog.nullFunction.\n  // This value is passed internally when creating a promise which will be\n  // resolved through a more optimized path.\n  if (resolver != goog.nullFunction) {\n    try {\n      var self = this;\n      resolver.call(\n          opt_context,\n          function(value) {\n            self.resolve_(goog.Promise.State_.FULFILLED, value);\n          },\n          function(reason) {\n            if (goog.DEBUG &&\n                !(reason instanceof goog.Promise.CancellationError)) {\n              try {\n                // Promise was rejected. Step up one call frame to see why.\n                if (reason instanceof Error) {\n                  throw reason;\n                } else {\n                  throw new Error('Promise rejected.');\n                }\n              } catch (e) {\n                // Only thrown so browser dev tools can catch rejections of\n                // promises when the option to break on caught exceptions is\n                // activated.\n              }\n            }\n            self.resolve_(goog.Promise.State_.REJECTED, reason);\n          });\n    } catch (e) {\n      this.resolve_(goog.Promise.State_.REJECTED, e);\n    }\n  }\n};\n\n\n/**\n * @define {boolean} Whether traces of `then` calls should be included in\n * exceptions thrown\n */\ngoog.Promise.LONG_STACK_TRACES =\n    goog.define('goog.Promise.LONG_STACK_TRACES', false);\n\n\n/**\n * @define {number} The delay in milliseconds before a rejected Promise's reason\n * is passed to the rejection handler. By default, the rejection handler\n * rethrows the rejection reason so that it appears in the developer console or\n * `window.onerror` handler.\n *\n * Rejections are rethrown as quickly as possible by default. A negative value\n * disables rejection handling entirely.\n */\ngoog.Promise.UNHANDLED_REJECTION_DELAY =\n    goog.define('goog.Promise.UNHANDLED_REJECTION_DELAY', 0);\n\n\n/**\n * The possible internal states for a Promise. These states are not directly\n * observable to external callers.\n * @enum {number}\n * @private\n */\ngoog.Promise.State_ = {\n  /** The Promise is waiting for resolution. */\n  PENDING: 0,\n\n  /** The Promise is blocked waiting for the result of another Thenable. */\n  BLOCKED: 1,\n\n  /** The Promise has been resolved with a fulfillment value. */\n  FULFILLED: 2,\n\n  /** The Promise has been resolved with a rejection reason. */\n  REJECTED: 3\n};\n\n\n\n/**\n * Entries in the callback chain. Each call to `then`,\n * `thenCatch`, or `thenAlways` creates an entry containing the\n * functions that may be invoked once the Promise is settled.\n *\n * @private @final @struct @constructor\n */\ngoog.Promise.CallbackEntry_ = function() {\n  /** @type {?goog.Promise} */\n  this.child = null;\n  /** @type {?Function} */\n  this.onFulfilled = null;\n  /** @type {?Function} */\n  this.onRejected = null;\n  /** @type {?} */\n  this.context = null;\n  /** @type {?goog.Promise.CallbackEntry_} */\n  this.next = null;\n\n  /**\n   * A boolean value to indicate this is a \"thenAlways\" callback entry.\n   * Unlike a normal \"then/thenVoid\" a \"thenAlways doesn't participate\n   * in \"cancel\" considerations but is simply an observer and requires\n   * special handling.\n   * @type {boolean}\n   */\n  this.always = false;\n};\n\n\n/** clear the object prior to reuse */\ngoog.Promise.CallbackEntry_.prototype.reset = function() {\n  this.child = null;\n  this.onFulfilled = null;\n  this.onRejected = null;\n  this.context = null;\n  this.always = false;\n};\n\n\n/**\n * @define {number} The number of currently unused objects to keep around for\n *    reuse.\n */\ngoog.Promise.DEFAULT_MAX_UNUSED =\n    goog.define('goog.Promise.DEFAULT_MAX_UNUSED', 100);\n\n\n/** @const @private {goog.async.FreeList<!goog.Promise.CallbackEntry_>} */\ngoog.Promise.freelist_ = new goog.async.FreeList(\n    function() { return new goog.Promise.CallbackEntry_(); },\n    function(item) { item.reset(); }, goog.Promise.DEFAULT_MAX_UNUSED);\n\n\n/**\n * @param {Function} onFulfilled\n * @param {Function} onRejected\n * @param {?} context\n * @return {!goog.Promise.CallbackEntry_}\n * @private\n */\ngoog.Promise.getCallbackEntry_ = function(onFulfilled, onRejected, context) {\n  var entry = goog.Promise.freelist_.get();\n  entry.onFulfilled = onFulfilled;\n  entry.onRejected = onRejected;\n  entry.context = context;\n  return entry;\n};\n\n\n/**\n * @param {!goog.Promise.CallbackEntry_} entry\n * @private\n */\ngoog.Promise.returnEntry_ = function(entry) {\n  goog.Promise.freelist_.put(entry);\n};\n\n\n// NOTE: this is the same template expression as is used for\n// goog.IThenable.prototype.then\n\n\n/**\n * @param {VALUE=} opt_value\n * @return {RESULT} A new Promise that is immediately resolved\n *     with the given value. If the input value is already a goog.Promise, it\n *     will be returned immediately without creating a new instance.\n * @template VALUE\n * @template RESULT := type('goog.Promise',\n *     cond(isUnknown(VALUE), unknown(),\n *       mapunion(VALUE, (V) =>\n *         cond(isTemplatized(V) && sub(rawTypeOf(V), 'IThenable'),\n *           templateTypeOf(V, 0),\n *           cond(sub(V, 'Thenable'),\n *              unknown(),\n *              V)))))\n * =:\n */\ngoog.Promise.resolve = function(opt_value) {\n  if (opt_value instanceof goog.Promise) {\n    // Avoid creating a new object if we already have a promise object\n    // of the correct type.\n    return opt_value;\n  }\n\n  // Passing goog.nullFunction will cause the constructor to take an optimized\n  // path that skips calling the resolver function.\n  var promise = new goog.Promise(goog.nullFunction);\n  promise.resolve_(goog.Promise.State_.FULFILLED, opt_value);\n  return promise;\n};\n\n\n/**\n * @param {*=} opt_reason\n * @return {!goog.Promise} A new Promise that is immediately rejected with the\n *     given reason.\n */\ngoog.Promise.reject = function(opt_reason) {\n  return new goog.Promise(function(resolve, reject) { reject(opt_reason); });\n};\n\n\n/**\n * This is identical to\n * {@code goog.Promise.resolve(value).then(onFulfilled, onRejected)}, but it\n * avoids creating an unnecessary wrapper Promise when `value` is already\n * thenable.\n *\n * @param {?(goog.Thenable<TYPE>|Thenable|TYPE)} value\n * @param {function(TYPE): ?} onFulfilled\n * @param {function(*): *} onRejected\n * @template TYPE\n * @private\n */\ngoog.Promise.resolveThen_ = function(value, onFulfilled, onRejected) {\n  var isThenable =\n      goog.Promise.maybeThen_(value, onFulfilled, onRejected, null);\n  if (!isThenable) {\n    goog.async.run(goog.partial(onFulfilled, value));\n  }\n};\n\n\n/**\n * @param {!Array<?(goog.Promise<TYPE>|goog.Thenable<TYPE>|Thenable|*)>}\n *     promises\n * @return {!goog.Promise<TYPE>} A Promise that receives the result of the\n *     first Promise (or Promise-like) input to settle immediately after it\n *     settles.\n * @template TYPE\n */\ngoog.Promise.race = function(promises) {\n  return new goog.Promise(function(resolve, reject) {\n    if (!promises.length) {\n      resolve(undefined);\n    }\n    for (var i = 0, promise; i < promises.length; i++) {\n      promise = promises[i];\n      goog.Promise.resolveThen_(promise, resolve, reject);\n    }\n  });\n};\n\n\n/**\n * @param {!Array<?(goog.Promise<TYPE>|goog.Thenable<TYPE>|Thenable|*)>}\n *     promises\n * @return {!goog.Promise<!Array<TYPE>>} A Promise that receives a list of\n *     every fulfilled value once every input Promise (or Promise-like) is\n *     successfully fulfilled, or is rejected with the first rejection reason\n *     immediately after it is rejected.\n * @template TYPE\n */\ngoog.Promise.all = function(promises) {\n  return new goog.Promise(function(resolve, reject) {\n    var toFulfill = promises.length;\n    var values = [];\n\n    if (!toFulfill) {\n      resolve(values);\n      return;\n    }\n\n    var onFulfill = function(index, value) {\n      toFulfill--;\n      values[index] = value;\n      if (toFulfill == 0) {\n        resolve(values);\n      }\n    };\n\n    var onReject = function(reason) { reject(reason); };\n\n    for (var i = 0, promise; i < promises.length; i++) {\n      promise = promises[i];\n      goog.Promise.resolveThen_(promise, goog.partial(onFulfill, i), onReject);\n    }\n  });\n};\n\n\n/**\n * @param {!Array<?(goog.Promise<TYPE>|goog.Thenable<TYPE>|Thenable|*)>}\n *     promises\n * @return {!goog.Promise<!Array<{\n *     fulfilled: boolean,\n *     value: (TYPE|undefined),\n *     reason: (*|undefined)}>>} A Promise that resolves with a list of\n *         result objects once all input Promises (or Promise-like) have\n *         settled. Each result object contains a 'fulfilled' boolean indicating\n *         whether an input Promise was fulfilled or rejected. For fulfilled\n *         Promises, the resulting value is stored in the 'value' field. For\n *         rejected Promises, the rejection reason is stored in the 'reason'\n *         field.\n * @template TYPE\n */\ngoog.Promise.allSettled = function(promises) {\n  return new goog.Promise(function(resolve, reject) {\n    var toSettle = promises.length;\n    var results = [];\n\n    if (!toSettle) {\n      resolve(results);\n      return;\n    }\n\n    var onSettled = function(index, fulfilled, result) {\n      toSettle--;\n      results[index] = fulfilled ? {fulfilled: true, value: result} :\n                                   {fulfilled: false, reason: result};\n      if (toSettle == 0) {\n        resolve(results);\n      }\n    };\n\n    for (var i = 0, promise; i < promises.length; i++) {\n      promise = promises[i];\n      goog.Promise.resolveThen_(\n          promise, goog.partial(onSettled, i, true /* fulfilled */),\n          goog.partial(onSettled, i, false /* fulfilled */));\n    }\n  });\n};\n\n\n/**\n * @param {!Array<?(goog.Promise<TYPE>|goog.Thenable<TYPE>|Thenable|*)>}\n *     promises\n * @return {!goog.Promise<TYPE>} A Promise that receives the value of the first\n *     input to be fulfilled, or is rejected with a list of every rejection\n *     reason if all inputs are rejected.\n * @template TYPE\n */\ngoog.Promise.firstFulfilled = function(promises) {\n  return new goog.Promise(function(resolve, reject) {\n    var toReject = promises.length;\n    var reasons = [];\n\n    if (!toReject) {\n      resolve(undefined);\n      return;\n    }\n\n    var onFulfill = function(value) { resolve(value); };\n\n    var onReject = function(index, reason) {\n      toReject--;\n      reasons[index] = reason;\n      if (toReject == 0) {\n        reject(reasons);\n      }\n    };\n\n    for (var i = 0, promise; i < promises.length; i++) {\n      promise = promises[i];\n      goog.Promise.resolveThen_(promise, onFulfill, goog.partial(onReject, i));\n    }\n  });\n};\n\n\n/**\n * @return {!goog.promise.Resolver<TYPE>} Resolver wrapping the promise and its\n *     resolve / reject functions. Resolving or rejecting the resolver\n *     resolves or rejects the promise.\n * @template TYPE\n */\ngoog.Promise.withResolver = function() {\n  var resolve, reject;\n  var promise = new goog.Promise(function(rs, rj) {\n    resolve = rs;\n    reject = rj;\n  });\n  return new goog.Promise.Resolver_(promise, resolve, reject);\n};\n\n\n/**\n * Adds callbacks that will operate on the result of the Promise, returning a\n * new child Promise.\n *\n * If the Promise is fulfilled, the `onFulfilled` callback will be invoked\n * with the fulfillment value as argument, and the child Promise will be\n * fulfilled with the return value of the callback. If the callback throws an\n * exception, the child Promise will be rejected with the thrown value instead.\n *\n * If the Promise is rejected, the `onRejected` callback will be invoked\n * with the rejection reason as argument, and the child Promise will be resolved\n * with the return value or rejected with the thrown value of the callback.\n *\n * @override\n */\ngoog.Promise.prototype.then = function(\n    opt_onFulfilled, opt_onRejected, opt_context) {\n\n  if (opt_onFulfilled != null) {\n    goog.asserts.assertFunction(\n        opt_onFulfilled, 'opt_onFulfilled should be a function.');\n  }\n  if (opt_onRejected != null) {\n    goog.asserts.assertFunction(\n        opt_onRejected,\n        'opt_onRejected should be a function. Did you pass opt_context ' +\n            'as the second argument instead of the third?');\n  }\n\n  if (goog.Promise.LONG_STACK_TRACES) {\n    this.addStackTrace_(new Error('then'));\n  }\n\n  return this.addChildPromise_(\n      goog.isFunction(opt_onFulfilled) ? opt_onFulfilled : null,\n      goog.isFunction(opt_onRejected) ? opt_onRejected : null, opt_context);\n};\ngoog.Thenable.addImplementation(goog.Promise);\n\n\n/**\n * Adds callbacks that will operate on the result of the Promise without\n * returning a child Promise (unlike \"then\").\n *\n * If the Promise is fulfilled, the `onFulfilled` callback will be invoked\n * with the fulfillment value as argument.\n *\n * If the Promise is rejected, the `onRejected` callback will be invoked\n * with the rejection reason as argument.\n *\n * @param {?(function(this:THIS, TYPE):?)=} opt_onFulfilled A\n *     function that will be invoked with the fulfillment value if the Promise\n *     is fulfilled.\n * @param {?(function(this:THIS, *): *)=} opt_onRejected A function that will\n *     be invoked with the rejection reason if the Promise is rejected.\n * @param {THIS=} opt_context An optional context object that will be the\n *     execution context for the callbacks. By default, functions are executed\n *     with the default this.\n * @package\n * @template THIS\n */\ngoog.Promise.prototype.thenVoid = function(\n    opt_onFulfilled, opt_onRejected, opt_context) {\n\n  if (opt_onFulfilled != null) {\n    goog.asserts.assertFunction(\n        opt_onFulfilled, 'opt_onFulfilled should be a function.');\n  }\n  if (opt_onRejected != null) {\n    goog.asserts.assertFunction(\n        opt_onRejected,\n        'opt_onRejected should be a function. Did you pass opt_context ' +\n            'as the second argument instead of the third?');\n  }\n\n  if (goog.Promise.LONG_STACK_TRACES) {\n    this.addStackTrace_(new Error('then'));\n  }\n\n  // Note: no default rejection handler is provided here as we need to\n  // distinguish unhandled rejections.\n  this.addCallbackEntry_(\n      goog.Promise.getCallbackEntry_(\n          opt_onFulfilled || goog.nullFunction, opt_onRejected || null,\n          opt_context));\n};\n\n\n/**\n * Adds a callback that will be invoked when the Promise is settled (fulfilled\n * or rejected). The callback receives no argument, and no new child Promise is\n * created. This is useful for ensuring that cleanup takes place after certain\n * asynchronous operations. Callbacks added with `thenAlways` will be\n * executed in the same order with other calls to `then`,\n * `thenAlways`, or `thenCatch`.\n *\n * Since it does not produce a new child Promise, cancellation propagation is\n * not prevented by adding callbacks with `thenAlways`. A Promise that has\n * a cleanup handler added with `thenAlways` will be canceled if all of\n * its children created by `then` (or `thenCatch`) are canceled.\n * Additionally, since any rejections are not passed to the callback, it does\n * not stop the unhandled rejection handler from running.\n *\n * @param {function(this:THIS): void} onSettled A function that will be invoked\n *     when the Promise is settled (fulfilled or rejected).\n * @param {THIS=} opt_context An optional context object that will be the\n *     execution context for the callbacks. By default, functions are executed\n *     in the global scope.\n * @return {!goog.Promise<TYPE>} This Promise, for chaining additional calls.\n * @template THIS\n */\ngoog.Promise.prototype.thenAlways = function(onSettled, opt_context) {\n  if (goog.Promise.LONG_STACK_TRACES) {\n    this.addStackTrace_(new Error('thenAlways'));\n  }\n\n  var entry = goog.Promise.getCallbackEntry_(onSettled, onSettled, opt_context);\n  entry.always = true;\n  this.addCallbackEntry_(entry);\n  return this;\n};\n\n\n/**\n * Adds a callback that will be invoked only if the Promise is rejected. This\n * is equivalent to `then(null, onRejected)`.\n *\n * @param {function(this:THIS, *): *} onRejected A function that will be\n *     invoked with the rejection reason if this Promise is rejected.\n * @param {THIS=} opt_context An optional context object that will be the\n *     execution context for the callbacks. By default, functions are executed\n *     in the global scope.\n * @return {!goog.Promise} A new Promise that will resolve either to the\n *     value of this promise, or if this promise is rejected, the result of\n *     `onRejected`. The returned Promise will reject if `onRejected` throws.\n * @template THIS\n */\ngoog.Promise.prototype.thenCatch = function(onRejected, opt_context) {\n  if (goog.Promise.LONG_STACK_TRACES) {\n    this.addStackTrace_(new Error('thenCatch'));\n  }\n  return this.addChildPromise_(null, onRejected, opt_context);\n};\n\n\n/**\n * Cancels the Promise if it is still pending by rejecting it with a cancel\n * Error. No action is performed if the Promise is already resolved.\n *\n * All child Promises of the canceled Promise will be rejected with the same\n * cancel error, as with normal Promise rejection. If the Promise to be canceled\n * is the only child of a pending Promise, the parent Promise will also be\n * canceled. Cancellation may propagate upward through multiple generations.\n *\n * @param {string=} opt_message An optional debugging message for describing the\n *     cancellation reason.\n */\ngoog.Promise.prototype.cancel = function(opt_message) {\n  if (this.state_ == goog.Promise.State_.PENDING) {\n    goog.async.run(function() {\n      var err = new goog.Promise.CancellationError(opt_message);\n      this.cancelInternal_(err);\n    }, this);\n  }\n};\n\n\n/**\n * Cancels this Promise with the given error.\n *\n * @param {!Error} err The cancellation error.\n * @private\n */\ngoog.Promise.prototype.cancelInternal_ = function(err) {\n  if (this.state_ == goog.Promise.State_.PENDING) {\n    if (this.parent_) {\n      // Cancel the Promise and remove it from the parent's child list.\n      this.parent_.cancelChild_(this, err);\n      this.parent_ = null;\n    } else {\n      this.resolve_(goog.Promise.State_.REJECTED, err);\n    }\n  }\n};\n\n\n/**\n * Cancels a child Promise from the list of callback entries. If the Promise has\n * not already been resolved, reject it with a cancel error. If there are no\n * other children in the list of callback entries, propagate the cancellation\n * by canceling this Promise as well.\n *\n * @param {!goog.Promise} childPromise The Promise to cancel.\n * @param {!Error} err The cancel error to use for rejecting the Promise.\n * @private\n */\ngoog.Promise.prototype.cancelChild_ = function(childPromise, err) {\n  if (!this.callbackEntries_) {\n    return;\n  }\n  var childCount = 0;\n  var childEntry = null;\n  var beforeChildEntry = null;\n\n  // Find the callback entry for the childPromise, and count whether there are\n  // additional child Promises.\n  for (var entry = this.callbackEntries_; entry; entry = entry.next) {\n    if (!entry.always) {\n      childCount++;\n      if (entry.child == childPromise) {\n        childEntry = entry;\n      }\n      if (childEntry && childCount > 1) {\n        break;\n      }\n    }\n    if (!childEntry) {\n      beforeChildEntry = entry;\n    }\n  }\n\n  // Can a child entry be missing?\n\n  // If the child Promise was the only child, cancel this Promise as well.\n  // Otherwise, reject only the child Promise with the cancel error.\n  if (childEntry) {\n    if (this.state_ == goog.Promise.State_.PENDING && childCount == 1) {\n      this.cancelInternal_(err);\n    } else {\n      if (beforeChildEntry) {\n        this.removeEntryAfter_(beforeChildEntry);\n      } else {\n        this.popEntry_();\n      }\n\n      this.executeCallback_(childEntry, goog.Promise.State_.REJECTED, err);\n    }\n  }\n};\n\n\n/**\n * Adds a callback entry to the current Promise, and schedules callback\n * execution if the Promise has already been settled.\n *\n * @param {goog.Promise.CallbackEntry_} callbackEntry Record containing\n *     `onFulfilled` and `onRejected` callbacks to execute after\n *     the Promise is settled.\n * @private\n */\ngoog.Promise.prototype.addCallbackEntry_ = function(callbackEntry) {\n  if (!this.hasEntry_() && (this.state_ == goog.Promise.State_.FULFILLED ||\n                            this.state_ == goog.Promise.State_.REJECTED)) {\n    this.scheduleCallbacks_();\n  }\n  this.queueEntry_(callbackEntry);\n};\n\n\n/**\n * Creates a child Promise and adds it to the callback entry list. The result of\n * the child Promise is determined by the state of the parent Promise and the\n * result of the `onFulfilled` or `onRejected` callbacks as\n * specified in the Promise resolution procedure.\n *\n * @see http://promisesaplus.com/#the__method\n *\n * @param {?function(this:THIS, TYPE):\n *          (RESULT|goog.Promise<RESULT>|Thenable)} onFulfilled A callback that\n *     will be invoked if the Promise is fulfilled, or null.\n * @param {?function(this:THIS, *): *} onRejected A callback that will be\n *     invoked if the Promise is rejected, or null.\n * @param {THIS=} opt_context An optional execution context for the callbacks.\n *     in the default calling context.\n * @return {!goog.Promise} The child Promise.\n * @template RESULT,THIS\n * @private\n */\ngoog.Promise.prototype.addChildPromise_ = function(\n    onFulfilled, onRejected, opt_context) {\n\n  /** @type {goog.Promise.CallbackEntry_} */\n  var callbackEntry = goog.Promise.getCallbackEntry_(null, null, null);\n\n  callbackEntry.child = new goog.Promise(function(resolve, reject) {\n    // Invoke onFulfilled, or resolve with the parent's value if absent.\n    callbackEntry.onFulfilled = onFulfilled ? function(value) {\n      try {\n        var result = onFulfilled.call(opt_context, value);\n        resolve(result);\n      } catch (err) {\n        reject(err);\n      }\n    } : resolve;\n\n    // Invoke onRejected, or reject with the parent's reason if absent.\n    callbackEntry.onRejected = onRejected ? function(reason) {\n      try {\n        var result = onRejected.call(opt_context, reason);\n        if (!goog.isDef(result) &&\n            reason instanceof goog.Promise.CancellationError) {\n          // Propagate cancellation to children if no other result is returned.\n          reject(reason);\n        } else {\n          resolve(result);\n        }\n      } catch (err) {\n        reject(err);\n      }\n    } : reject;\n  });\n\n  callbackEntry.child.parent_ = this;\n  this.addCallbackEntry_(callbackEntry);\n  return callbackEntry.child;\n};\n\n\n/**\n * Unblocks the Promise and fulfills it with the given value.\n *\n * @param {TYPE} value\n * @private\n */\ngoog.Promise.prototype.unblockAndFulfill_ = function(value) {\n  goog.asserts.assert(this.state_ == goog.Promise.State_.BLOCKED);\n  this.state_ = goog.Promise.State_.PENDING;\n  this.resolve_(goog.Promise.State_.FULFILLED, value);\n};\n\n\n/**\n * Unblocks the Promise and rejects it with the given rejection reason.\n *\n * @param {*} reason\n * @private\n */\ngoog.Promise.prototype.unblockAndReject_ = function(reason) {\n  goog.asserts.assert(this.state_ == goog.Promise.State_.BLOCKED);\n  this.state_ = goog.Promise.State_.PENDING;\n  this.resolve_(goog.Promise.State_.REJECTED, reason);\n};\n\n\n/**\n * Attempts to resolve a Promise with a given resolution state and value. This\n * is a no-op if the given Promise has already been resolved.\n *\n * If the given result is a Thenable (such as another Promise), the Promise will\n * be settled with the same state and result as the Thenable once it is itself\n * settled.\n *\n * If the given result is not a Thenable, the Promise will be settled (fulfilled\n * or rejected) with that result based on the given state.\n *\n * @see http://promisesaplus.com/#the_promise_resolution_procedure\n *\n * @param {goog.Promise.State_} state\n * @param {*} x The result to apply to the Promise.\n * @private\n */\ngoog.Promise.prototype.resolve_ = function(state, x) {\n  if (this.state_ != goog.Promise.State_.PENDING) {\n    return;\n  }\n\n  if (this === x) {\n    state = goog.Promise.State_.REJECTED;\n    x = new TypeError('Promise cannot resolve to itself');\n  }\n\n  this.state_ = goog.Promise.State_.BLOCKED;\n  var isThenable = goog.Promise.maybeThen_(\n      x, this.unblockAndFulfill_, this.unblockAndReject_, this);\n  if (isThenable) {\n    return;\n  }\n\n  this.result_ = x;\n  this.state_ = state;\n  // Since we can no longer be canceled, remove link to parent, so that the\n  // child promise does not keep the parent promise alive.\n  this.parent_ = null;\n  this.scheduleCallbacks_();\n\n  if (state == goog.Promise.State_.REJECTED &&\n      !(x instanceof goog.Promise.CancellationError)) {\n    goog.Promise.addUnhandledRejection_(this, x);\n  }\n};\n\n\n/**\n * Invokes the \"then\" method of an input value if that value is a Thenable. This\n * is a no-op if the value is not thenable.\n *\n * @param {?} value A potentially thenable value.\n * @param {!Function} onFulfilled\n * @param {!Function} onRejected\n * @param {?} context\n * @return {boolean} Whether the input value was thenable.\n * @private\n */\ngoog.Promise.maybeThen_ = function(value, onFulfilled, onRejected, context) {\n  if (value instanceof goog.Promise) {\n    value.thenVoid(onFulfilled, onRejected, context);\n    return true;\n  } else if (goog.Thenable.isImplementedBy(value)) {\n    value = /** @type {!goog.Thenable} */ (value);\n    value.then(onFulfilled, onRejected, context);\n    return true;\n  } else if (goog.isObject(value)) {\n    try {\n      var then = value['then'];\n      if (goog.isFunction(then)) {\n        goog.Promise.tryThen_(value, then, onFulfilled, onRejected, context);\n        return true;\n      }\n    } catch (e) {\n      onRejected.call(context, e);\n      return true;\n    }\n  }\n\n  return false;\n};\n\n\n/**\n * Attempts to call the `then` method on an object in the hopes that it is\n * a Promise-compatible instance. This allows interoperation between different\n * Promise implementations, however a non-compliant object may cause a Promise\n * to hang indefinitely. If the `then` method throws an exception, the\n * dependent Promise will be rejected with the thrown value.\n *\n * @see http://promisesaplus.com/#point-70\n *\n * @param {Thenable} thenable An object with a `then` method that may be\n *     compatible with the Promise/A+ specification.\n * @param {!Function} then The `then` method of the Thenable object.\n * @param {!Function} onFulfilled\n * @param {!Function} onRejected\n * @param {*} context\n * @private\n */\ngoog.Promise.tryThen_ = function(\n    thenable, then, onFulfilled, onRejected, context) {\n\n  var called = false;\n  var resolve = function(value) {\n    if (!called) {\n      called = true;\n      onFulfilled.call(context, value);\n    }\n  };\n\n  var reject = function(reason) {\n    if (!called) {\n      called = true;\n      onRejected.call(context, reason);\n    }\n  };\n\n  try {\n    then.call(thenable, resolve, reject);\n  } catch (e) {\n    reject(e);\n  }\n};\n\n\n/**\n * Executes the pending callbacks of a settled Promise after a timeout.\n *\n * Section 2.2.4 of the Promises/A+ specification requires that Promise\n * callbacks must only be invoked from a call stack that only contains Promise\n * implementation code, which we accomplish by invoking callback execution after\n * a timeout. If `startExecution_` is called multiple times for the same\n * Promise, the callback chain will be evaluated only once. Additional callbacks\n * may be added during the evaluation phase, and will be executed in the same\n * event loop.\n *\n * All Promises added to the waiting list during the same browser event loop\n * will be executed in one batch to avoid using a separate timeout per Promise.\n *\n * @private\n */\ngoog.Promise.prototype.scheduleCallbacks_ = function() {\n  if (!this.executing_) {\n    this.executing_ = true;\n    goog.async.run(this.executeCallbacks_, this);\n  }\n};\n\n\n/**\n * @return {boolean} Whether there are any pending callbacks queued.\n * @private\n */\ngoog.Promise.prototype.hasEntry_ = function() {\n  return !!this.callbackEntries_;\n};\n\n\n/**\n * @param {goog.Promise.CallbackEntry_} entry\n * @private\n */\ngoog.Promise.prototype.queueEntry_ = function(entry) {\n  goog.asserts.assert(entry.onFulfilled != null);\n\n  if (this.callbackEntriesTail_) {\n    this.callbackEntriesTail_.next = entry;\n    this.callbackEntriesTail_ = entry;\n  } else {\n    // It the work queue was empty set the head too.\n    this.callbackEntries_ = entry;\n    this.callbackEntriesTail_ = entry;\n  }\n};\n\n\n/**\n * @return {goog.Promise.CallbackEntry_} entry\n * @private\n */\ngoog.Promise.prototype.popEntry_ = function() {\n  var entry = null;\n  if (this.callbackEntries_) {\n    entry = this.callbackEntries_;\n    this.callbackEntries_ = entry.next;\n    entry.next = null;\n  }\n  // It the work queue is empty clear the tail too.\n  if (!this.callbackEntries_) {\n    this.callbackEntriesTail_ = null;\n  }\n\n  if (entry != null) {\n    goog.asserts.assert(entry.onFulfilled != null);\n  }\n  return entry;\n};\n\n\n/**\n * @param {goog.Promise.CallbackEntry_} previous\n * @private\n */\ngoog.Promise.prototype.removeEntryAfter_ = function(previous) {\n  goog.asserts.assert(this.callbackEntries_);\n  goog.asserts.assert(previous != null);\n  // If the last entry is being removed, update the tail\n  if (previous.next == this.callbackEntriesTail_) {\n    this.callbackEntriesTail_ = previous;\n  }\n\n  previous.next = previous.next.next;\n};\n\n\n/**\n * Executes all pending callbacks for this Promise.\n *\n * @private\n */\ngoog.Promise.prototype.executeCallbacks_ = function() {\n  var entry = null;\n  while (entry = this.popEntry_()) {\n    if (goog.Promise.LONG_STACK_TRACES) {\n      this.currentStep_++;\n    }\n    this.executeCallback_(entry, this.state_, this.result_);\n  }\n  this.executing_ = false;\n};\n\n\n/**\n * Executes a pending callback for this Promise. Invokes an `onFulfilled`\n * or `onRejected` callback based on the settled state of the Promise.\n *\n * @param {!goog.Promise.CallbackEntry_} callbackEntry An entry containing the\n *     onFulfilled and/or onRejected callbacks for this step.\n * @param {goog.Promise.State_} state The resolution status of the Promise,\n *     either FULFILLED or REJECTED.\n * @param {*} result The settled result of the Promise.\n * @private\n */\ngoog.Promise.prototype.executeCallback_ = function(\n    callbackEntry, state, result) {\n  // Cancel an unhandled rejection if the then/thenVoid call had an onRejected.\n  if (state == goog.Promise.State_.REJECTED && callbackEntry.onRejected &&\n      !callbackEntry.always) {\n    this.removeUnhandledRejection_();\n  }\n\n  if (callbackEntry.child) {\n    // When the parent is settled, the child no longer needs to hold on to it,\n    // as the parent can no longer be canceled.\n    callbackEntry.child.parent_ = null;\n    goog.Promise.invokeCallback_(callbackEntry, state, result);\n  } else {\n    // Callbacks created with thenAlways or thenVoid do not have the rejection\n    // handling code normally set up in the child Promise.\n    try {\n      callbackEntry.always ?\n          callbackEntry.onFulfilled.call(callbackEntry.context) :\n          goog.Promise.invokeCallback_(callbackEntry, state, result);\n    } catch (err) {\n      goog.Promise.handleRejection_.call(null, err);\n    }\n  }\n  goog.Promise.returnEntry_(callbackEntry);\n};\n\n\n/**\n * Executes the onFulfilled or onRejected callback for a callbackEntry.\n *\n * @param {!goog.Promise.CallbackEntry_} callbackEntry\n * @param {goog.Promise.State_} state\n * @param {*} result\n * @private\n */\ngoog.Promise.invokeCallback_ = function(callbackEntry, state, result) {\n  if (state == goog.Promise.State_.FULFILLED) {\n    callbackEntry.onFulfilled.call(callbackEntry.context, result);\n  } else if (callbackEntry.onRejected) {\n    callbackEntry.onRejected.call(callbackEntry.context, result);\n  }\n};\n\n\n/**\n * Records a stack trace entry for functions that call `then` or the\n * Promise constructor. May be disabled by unsetting `LONG_STACK_TRACES`.\n *\n * @param {!Error} err An Error object created by the calling function for\n *     providing a stack trace.\n * @private\n */\ngoog.Promise.prototype.addStackTrace_ = function(err) {\n  if (goog.Promise.LONG_STACK_TRACES && goog.isString(err.stack)) {\n    // Extract the third line of the stack trace, which is the entry for the\n    // user function that called into Promise code.\n    var trace = err.stack.split('\\n', 4)[3];\n    var message = err.message;\n\n    // Pad the message to align the traces.\n    message += Array(11 - message.length).join(' ');\n    this.stack_.push(message + trace);\n  }\n};\n\n\n/**\n * Adds extra stack trace information to an exception for the list of\n * asynchronous `then` calls that have been run for this Promise. Stack\n * trace information is recorded in {@see #addStackTrace_}, and appended to\n * rethrown errors when `LONG_STACK_TRACES` is enabled.\n *\n * @param {?} err An unhandled exception captured during callback execution.\n * @private\n */\ngoog.Promise.prototype.appendLongStack_ = function(err) {\n  if (goog.Promise.LONG_STACK_TRACES && err && goog.isString(err.stack) &&\n      this.stack_.length) {\n    var longTrace = ['Promise trace:'];\n\n    for (var promise = this; promise; promise = promise.parent_) {\n      for (var i = this.currentStep_; i >= 0; i--) {\n        longTrace.push(promise.stack_[i]);\n      }\n      longTrace.push(\n          'Value: ' +\n          '[' + (promise.state_ == goog.Promise.State_.REJECTED ? 'REJECTED' :\n                                                                  'FULFILLED') +\n          '] ' +\n          '<' + String(promise.result_) + '>');\n    }\n    err.stack += '\\n\\n' + longTrace.join('\\n');\n  }\n};\n\n\n/**\n * Marks this rejected Promise as having being handled. Also marks any parent\n * Promises in the rejected state as handled. The rejection handler will no\n * longer be invoked for this Promise (if it has not been called already).\n *\n * @private\n */\ngoog.Promise.prototype.removeUnhandledRejection_ = function() {\n  if (goog.Promise.UNHANDLED_REJECTION_DELAY > 0) {\n    for (var p = this; p && p.unhandledRejectionId_; p = p.parent_) {\n      goog.global.clearTimeout(p.unhandledRejectionId_);\n      p.unhandledRejectionId_ = 0;\n    }\n  } else if (goog.Promise.UNHANDLED_REJECTION_DELAY == 0) {\n    for (var p = this; p && p.hadUnhandledRejection_; p = p.parent_) {\n      p.hadUnhandledRejection_ = false;\n    }\n  }\n};\n\n\n/**\n * Marks this rejected Promise as unhandled. If no `onRejected` callback\n * is called for this Promise before the `UNHANDLED_REJECTION_DELAY`\n * expires, the reason will be passed to the unhandled rejection handler. The\n * handler typically rethrows the rejection reason so that it becomes visible in\n * the developer console.\n *\n * @param {!goog.Promise} promise The rejected Promise.\n * @param {*} reason The Promise rejection reason.\n * @private\n */\ngoog.Promise.addUnhandledRejection_ = function(promise, reason) {\n  if (goog.Promise.UNHANDLED_REJECTION_DELAY > 0) {\n    promise.unhandledRejectionId_ = goog.global.setTimeout(function() {\n      promise.appendLongStack_(reason);\n      goog.Promise.handleRejection_.call(null, reason);\n    }, goog.Promise.UNHANDLED_REJECTION_DELAY);\n\n  } else if (goog.Promise.UNHANDLED_REJECTION_DELAY == 0) {\n    promise.hadUnhandledRejection_ = true;\n    goog.async.run(function() {\n      if (promise.hadUnhandledRejection_) {\n        promise.appendLongStack_(reason);\n        goog.Promise.handleRejection_.call(null, reason);\n      }\n    });\n  }\n};\n\n\n/**\n * A method that is invoked with the rejection reasons for Promises that are\n * rejected but have no `onRejected` callbacks registered yet.\n * @type {function(*)}\n * @private\n */\ngoog.Promise.handleRejection_ = goog.async.throwException;\n\n\n/**\n * Sets a handler that will be called with reasons from unhandled rejected\n * Promises. If the rejected Promise (or one of its descendants) has an\n * `onRejected` callback registered, the rejection will be considered\n * handled, and the rejection handler will not be called.\n *\n * By default, unhandled rejections are rethrown so that the error may be\n * captured by the developer console or a `window.onerror` handler.\n *\n * @param {function(*)} handler A function that will be called with reasons from\n *     rejected Promises. Defaults to `goog.async.throwException`.\n */\ngoog.Promise.setUnhandledRejectionHandler = function(handler) {\n  goog.Promise.handleRejection_ = handler;\n};\n\n\n\n/**\n * Error used as a rejection reason for canceled Promises.\n *\n * @param {string=} opt_message\n * @constructor\n * @extends {goog.debug.Error}\n * @final\n */\ngoog.Promise.CancellationError = function(opt_message) {\n  goog.Promise.CancellationError.base(this, 'constructor', opt_message);\n};\ngoog.inherits(goog.Promise.CancellationError, goog.debug.Error);\n\n\n/** @override */\ngoog.Promise.CancellationError.prototype.name = 'cancel';\n\n\n\n/**\n * Internal implementation of the resolver interface.\n *\n * @param {!goog.Promise<TYPE>} promise\n * @param {function((TYPE|goog.Promise<TYPE>|Thenable)=)} resolve\n * @param {function(*=): void} reject\n * @implements {goog.promise.Resolver<TYPE>}\n * @final @struct\n * @constructor\n * @private\n * @template TYPE\n */\ngoog.Promise.Resolver_ = function(promise, resolve, reject) {\n  /** @const */\n  this.promise = promise;\n\n  /** @const */\n  this.resolve = resolve;\n\n  /** @const */\n  this.reject = reject;\n};\n","// Copyright 2005 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Implements the disposable interface. The dispose method is used\n * to clean up references and resources.\n * @author arv@google.com (Erik Arvidsson)\n */\n\n\ngoog.provide('goog.Disposable');\ngoog.provide('goog.dispose');\ngoog.provide('goog.disposeAll');\n\ngoog.require('goog.disposable.IDisposable');\n\n\n\n/**\n * Class that provides the basic implementation for disposable objects. If your\n * class holds one or more references to COM objects, DOM nodes, or other\n * disposable objects, it should extend this class or implement the disposable\n * interface (defined in goog.disposable.IDisposable).\n * @constructor\n * @implements {goog.disposable.IDisposable}\n */\ngoog.Disposable = function() {\n  /**\n   * If monitoring the goog.Disposable instances is enabled, stores the creation\n   * stack trace of the Disposable instance.\n   * @type {string|undefined}\n   */\n  this.creationStack;\n\n  if (goog.Disposable.MONITORING_MODE != goog.Disposable.MonitoringMode.OFF) {\n    if (goog.Disposable.INCLUDE_STACK_ON_CREATION) {\n      this.creationStack = new Error().stack;\n    }\n    goog.Disposable.instances_[goog.getUid(this)] = this;\n  }\n  // Support sealing\n  this.disposed_ = this.disposed_;\n  this.onDisposeCallbacks_ = this.onDisposeCallbacks_;\n};\n\n\n/**\n * @enum {number} Different monitoring modes for Disposable.\n */\ngoog.Disposable.MonitoringMode = {\n  /**\n   * No monitoring.\n   */\n  OFF: 0,\n  /**\n   * Creating and disposing the goog.Disposable instances is monitored. All\n   * disposable objects need to call the `goog.Disposable` base\n   * constructor. The PERMANENT mode must be switched on before creating any\n   * goog.Disposable instances.\n   */\n  PERMANENT: 1,\n  /**\n   * INTERACTIVE mode can be switched on and off on the fly without producing\n   * errors. It also doesn't warn if the disposable objects don't call the\n   * `goog.Disposable` base constructor.\n   */\n  INTERACTIVE: 2\n};\n\n\n/**\n * @define {number} The monitoring mode of the goog.Disposable\n *     instances. Default is OFF. Switching on the monitoring is only\n *     recommended for debugging because it has a significant impact on\n *     performance and memory usage. If switched off, the monitoring code\n *     compiles down to 0 bytes.\n */\ngoog.Disposable.MONITORING_MODE =\n    goog.define('goog.Disposable.MONITORING_MODE', 0);\n\n\n/**\n * @define {boolean} Whether to attach creation stack to each created disposable\n *     instance; This is only relevant for when MonitoringMode != OFF.\n */\ngoog.Disposable.INCLUDE_STACK_ON_CREATION =\n    goog.define('goog.Disposable.INCLUDE_STACK_ON_CREATION', true);\n\n\n/**\n * Maps the unique ID of every undisposed `goog.Disposable` object to\n * the object itself.\n * @type {!Object<number, !goog.Disposable>}\n * @private\n */\ngoog.Disposable.instances_ = {};\n\n\n/**\n * @return {!Array<!goog.Disposable>} All `goog.Disposable` objects that\n *     haven't been disposed of.\n */\ngoog.Disposable.getUndisposedObjects = function() {\n  var ret = [];\n  for (var id in goog.Disposable.instances_) {\n    if (goog.Disposable.instances_.hasOwnProperty(id)) {\n      ret.push(goog.Disposable.instances_[Number(id)]);\n    }\n  }\n  return ret;\n};\n\n\n/**\n * Clears the registry of undisposed objects but doesn't dispose of them.\n */\ngoog.Disposable.clearUndisposedObjects = function() {\n  goog.Disposable.instances_ = {};\n};\n\n\n/**\n * Whether the object has been disposed of.\n * @type {boolean}\n * @private\n */\ngoog.Disposable.prototype.disposed_ = false;\n\n\n/**\n * Callbacks to invoke when this object is disposed.\n * @type {Array<!Function>}\n * @private\n */\ngoog.Disposable.prototype.onDisposeCallbacks_;\n\n\n/**\n * @return {boolean} Whether the object has been disposed of.\n * @override\n */\ngoog.Disposable.prototype.isDisposed = function() {\n  return this.disposed_;\n};\n\n\n/**\n * @return {boolean} Whether the object has been disposed of.\n * @deprecated Use {@link #isDisposed} instead.\n */\ngoog.Disposable.prototype.getDisposed = goog.Disposable.prototype.isDisposed;\n\n\n/**\n * Disposes of the object. If the object hasn't already been disposed of, calls\n * {@link #disposeInternal}. Classes that extend `goog.Disposable` should\n * override {@link #disposeInternal} in order to delete references to COM\n * objects, DOM nodes, and other disposable objects. Reentrant.\n *\n * @return {void} Nothing.\n * @override\n */\ngoog.Disposable.prototype.dispose = function() {\n  if (!this.disposed_) {\n    // Set disposed_ to true first, in case during the chain of disposal this\n    // gets disposed recursively.\n    this.disposed_ = true;\n    this.disposeInternal();\n    if (goog.Disposable.MONITORING_MODE != goog.Disposable.MonitoringMode.OFF) {\n      var uid = goog.getUid(this);\n      if (goog.Disposable.MONITORING_MODE ==\n              goog.Disposable.MonitoringMode.PERMANENT &&\n          !goog.Disposable.instances_.hasOwnProperty(uid)) {\n        throw new Error(\n            this + ' did not call the goog.Disposable base ' +\n            'constructor or was disposed of after a clearUndisposedObjects ' +\n            'call');\n      }\n      if (goog.Disposable.MONITORING_MODE !=\n              goog.Disposable.MonitoringMode.OFF &&\n          this.onDisposeCallbacks_ && this.onDisposeCallbacks_.length > 0) {\n        throw new Error(\n            this + ' did not empty its onDisposeCallbacks queue. This ' +\n            'probably means it overrode dispose() or disposeInternal() ' +\n            'without calling the superclass\\' method.');\n      }\n      delete goog.Disposable.instances_[uid];\n    }\n  }\n};\n\n\n/**\n * Associates a disposable object with this object so that they will be disposed\n * together.\n * @param {goog.disposable.IDisposable} disposable that will be disposed when\n *     this object is disposed.\n */\ngoog.Disposable.prototype.registerDisposable = function(disposable) {\n  this.addOnDisposeCallback(goog.partial(goog.dispose, disposable));\n};\n\n\n/**\n * Invokes a callback function when this object is disposed. Callbacks are\n * invoked in the order in which they were added. If a callback is added to\n * an already disposed Disposable, it will be called immediately.\n * @param {function(this:T):?} callback The callback function.\n * @param {T=} opt_scope An optional scope to call the callback in.\n * @template T\n */\ngoog.Disposable.prototype.addOnDisposeCallback = function(callback, opt_scope) {\n  if (this.disposed_) {\n    goog.isDef(opt_scope) ? callback.call(opt_scope) : callback();\n    return;\n  }\n  if (!this.onDisposeCallbacks_) {\n    this.onDisposeCallbacks_ = [];\n  }\n\n  this.onDisposeCallbacks_.push(\n      goog.isDef(opt_scope) ? goog.bind(callback, opt_scope) : callback);\n};\n\n\n/**\n * Deletes or nulls out any references to COM objects, DOM nodes, or other\n * disposable objects. Classes that extend `goog.Disposable` should\n * override this method.\n * Not reentrant. To avoid calling it twice, it must only be called from the\n * subclass' `disposeInternal` method. Everywhere else the public\n * `dispose` method must be used.\n * For example:\n * <pre>\n *   mypackage.MyClass = function() {\n *     mypackage.MyClass.base(this, 'constructor');\n *     // Constructor logic specific to MyClass.\n *     ...\n *   };\n *   goog.inherits(mypackage.MyClass, goog.Disposable);\n *\n *   mypackage.MyClass.prototype.disposeInternal = function() {\n *     // Dispose logic specific to MyClass.\n *     ...\n *     // Call superclass's disposeInternal at the end of the subclass's, like\n *     // in C++, to avoid hard-to-catch issues.\n *     mypackage.MyClass.base(this, 'disposeInternal');\n *   };\n * </pre>\n * @protected\n */\ngoog.Disposable.prototype.disposeInternal = function() {\n  if (this.onDisposeCallbacks_) {\n    while (this.onDisposeCallbacks_.length) {\n      this.onDisposeCallbacks_.shift()();\n    }\n  }\n};\n\n\n/**\n * Returns True if we can verify the object is disposed.\n * Calls `isDisposed` on the argument if it supports it.  If obj\n * is not an object with an isDisposed() method, return false.\n * @param {*} obj The object to investigate.\n * @return {boolean} True if we can verify the object is disposed.\n */\ngoog.Disposable.isDisposed = function(obj) {\n  if (obj && typeof obj.isDisposed == 'function') {\n    return obj.isDisposed();\n  }\n  return false;\n};\n\n\n/**\n * Calls `dispose` on the argument if it supports it. If obj is not an\n *     object with a dispose() method, this is a no-op.\n * @param {*} obj The object to dispose of.\n */\ngoog.dispose = function(obj) {\n  if (obj && typeof obj.dispose == 'function') {\n    obj.dispose();\n  }\n};\n\n\n/**\n * Calls `dispose` on each member of the list that supports it. (If the\n * member is an ArrayLike, then `goog.disposeAll()` will be called\n * recursively on each of its members.) If the member is not an object with a\n * `dispose()` method, then it is ignored.\n * @param {...*} var_args The list.\n */\ngoog.disposeAll = function(var_args) {\n  for (var i = 0, len = arguments.length; i < len; ++i) {\n    var disposable = arguments[i];\n    if (goog.isArrayLike(disposable)) {\n      goog.disposeAll.apply(null, disposable);\n    } else {\n      goog.dispose(disposable);\n    }\n  }\n};\n","// Copyright 2009 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Useful compiler idioms.\n *\n * @author johnlenz@google.com (John Lenz)\n */\n\ngoog.provide('goog.reflect');\n\n\n/**\n * Syntax for object literal casts.\n * @see http://go/jscompiler-renaming\n * @see https://goo.gl/CRs09P\n *\n * Use this if you have an object literal whose keys need to have the same names\n * as the properties of some class even after they are renamed by the compiler.\n *\n * @param {!Function} type Type to cast to.\n * @param {Object} object Object literal to cast.\n * @return {Object} The object literal.\n */\ngoog.reflect.object = function(type, object) {\n  return object;\n};\n\n/**\n * Syntax for renaming property strings.\n * @see http://go/jscompiler-renaming\n * @see https://goo.gl/CRs09P\n *\n * Use this if you have an need to access a property as a string, but want\n * to also have the property renamed by the compiler. In contrast to\n * goog.reflect.object, this method takes an instance of an object.\n *\n * Properties must be simple names (not qualified names).\n *\n * @param {string} prop Name of the property\n * @param {!Object} object Instance of the object whose type will be used\n *     for renaming\n * @return {string} The renamed property.\n */\ngoog.reflect.objectProperty = function(prop, object) {\n  return prop;\n};\n\n/**\n * To assert to the compiler that an operation is needed when it would\n * otherwise be stripped. For example:\n * <code>\n *     // Force a layout\n *     goog.reflect.sinkValue(dialog.offsetHeight);\n * </code>\n * @param {T} x\n * @return {T}\n * @template T\n */\ngoog.reflect.sinkValue = function(x) {\n  goog.reflect.sinkValue[' '](x);\n  return x;\n};\n\n\n/**\n * The compiler should optimize this function away iff no one ever uses\n * goog.reflect.sinkValue.\n */\ngoog.reflect.sinkValue[' '] = goog.nullFunction;\n\n\n/**\n * Check if a property can be accessed without throwing an exception.\n * @param {Object} obj The owner of the property.\n * @param {string} prop The property name.\n * @return {boolean} Whether the property is accessible. Will also return true\n *     if obj is null.\n */\ngoog.reflect.canAccessProperty = function(obj, prop) {\n\n  try {\n    goog.reflect.sinkValue(obj[prop]);\n    return true;\n  } catch (e) {\n  }\n  return false;\n};\n\n\n/**\n * Retrieves a value from a cache given a key. The compiler provides special\n * consideration for this call such that it is generally considered side-effect\n * free. However, if the `opt_keyFn` or `valueFn` have side-effects\n * then the entire call is considered to have side-effects.\n *\n * Conventionally storing the value on the cache would be considered a\n * side-effect and preclude unused calls from being pruned, ie. even if\n * the value was never used, it would still always be stored in the cache.\n *\n * Providing a side-effect free `valueFn` and `opt_keyFn`\n * allows unused calls to `goog.reflect.cache` to be pruned.\n *\n * @param {!Object<K, V>} cacheObj The object that contains the cached values.\n * @param {?} key The key to lookup in the cache. If it is not string or number\n *     then a `opt_keyFn` should be provided. The key is also used as the\n *     parameter to the `valueFn`.\n * @param {function(?):V} valueFn The value provider to use to calculate the\n *     value to store in the cache. This function should be side-effect free\n *     to take advantage of the optimization.\n * @param {function(?):K=} opt_keyFn The key provider to determine the cache\n *     map key. This should be used if the given key is not a string or number.\n *     If not provided then the given key is used. This function should be\n *     side-effect free to take advantage of the optimization.\n * @return {V} The cached or calculated value.\n * @template K\n * @template V\n */\ngoog.reflect.cache = function(cacheObj, key, valueFn, opt_keyFn) {\n  var storedKey = opt_keyFn ? opt_keyFn(key) : key;\n\n  if (Object.prototype.hasOwnProperty.call(cacheObj, storedKey)) {\n    return cacheObj[storedKey];\n  }\n\n  return (cacheObj[storedKey] = valueFn(key));\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Rendering engine detection.\n * @see <a href=\"http://www.useragentstring.com/\">User agent strings</a>\n * For information on the browser brand (such as Safari versus Chrome), see\n * goog.userAgent.product.\n * @author arv@google.com (Erik Arvidsson)\n * @see ../demos/useragent.html\n */\n\ngoog.provide('goog.userAgent');\n\ngoog.require('goog.labs.userAgent.browser');\ngoog.require('goog.labs.userAgent.engine');\ngoog.require('goog.labs.userAgent.platform');\ngoog.require('goog.labs.userAgent.util');\ngoog.require('goog.reflect');\ngoog.require('goog.string');\n\n\n/**\n * @define {boolean} Whether we know at compile-time that the browser is IE.\n */\ngoog.userAgent.ASSUME_IE = goog.define('goog.userAgent.ASSUME_IE', false);\n\n\n/**\n * @define {boolean} Whether we know at compile-time that the browser is EDGE,\n * referring to EdgeHTML based Edge.\n */\ngoog.userAgent.ASSUME_EDGE = goog.define('goog.userAgent.ASSUME_EDGE', false);\n\n\n/**\n * @define {boolean} Whether we know at compile-time that the browser is GECKO.\n */\ngoog.userAgent.ASSUME_GECKO = goog.define('goog.userAgent.ASSUME_GECKO', false);\n\n\n/**\n * @define {boolean} Whether we know at compile-time that the browser is WEBKIT.\n */\ngoog.userAgent.ASSUME_WEBKIT =\n    goog.define('goog.userAgent.ASSUME_WEBKIT', false);\n\n\n/**\n * @define {boolean} Whether we know at compile-time that the browser is a\n *     mobile device running WebKit e.g. iPhone or Android.\n */\ngoog.userAgent.ASSUME_MOBILE_WEBKIT =\n    goog.define('goog.userAgent.ASSUME_MOBILE_WEBKIT', false);\n\n\n/**\n * @define {boolean} Whether we know at compile-time that the browser is OPERA,\n * referring to Presto-based Opera.\n */\ngoog.userAgent.ASSUME_OPERA = goog.define('goog.userAgent.ASSUME_OPERA', false);\n\n\n/**\n * @define {boolean} Whether the\n *     `goog.userAgent.isVersionOrHigher`\n *     function will return true for any version.\n */\ngoog.userAgent.ASSUME_ANY_VERSION =\n    goog.define('goog.userAgent.ASSUME_ANY_VERSION', false);\n\n\n/**\n * Whether we know the browser engine at compile-time.\n * @type {boolean}\n * @private\n */\ngoog.userAgent.BROWSER_KNOWN_ = goog.userAgent.ASSUME_IE ||\n    goog.userAgent.ASSUME_EDGE || goog.userAgent.ASSUME_GECKO ||\n    goog.userAgent.ASSUME_MOBILE_WEBKIT || goog.userAgent.ASSUME_WEBKIT ||\n    goog.userAgent.ASSUME_OPERA;\n\n\n/**\n * Returns the userAgent string for the current browser.\n *\n * @return {string} The userAgent string.\n */\ngoog.userAgent.getUserAgentString = function() {\n  return goog.labs.userAgent.util.getUserAgent();\n};\n\n\n/**\n * @return {?Navigator} The native navigator object.\n */\ngoog.userAgent.getNavigatorTyped = function() {\n  // Need a local navigator reference instead of using the global one,\n  // to avoid the rare case where they reference different objects.\n  // (in a WorkerPool, for example).\n  return goog.global['navigator'] || null;\n};\n\n\n/**\n * TODO(nnaze): Change type to \"Navigator\" and update compilation targets.\n * @return {?Object} The native navigator object.\n */\ngoog.userAgent.getNavigator = function() {\n  return goog.userAgent.getNavigatorTyped();\n};\n\n\n/**\n * Whether the user agent is Presto-based Opera.\n * @type {boolean}\n */\ngoog.userAgent.OPERA = goog.userAgent.BROWSER_KNOWN_ ?\n    goog.userAgent.ASSUME_OPERA :\n    goog.labs.userAgent.browser.isOpera();\n\n\n/**\n * Whether the user agent is Internet Explorer.\n * @type {boolean}\n */\ngoog.userAgent.IE = goog.userAgent.BROWSER_KNOWN_ ?\n    goog.userAgent.ASSUME_IE :\n    goog.labs.userAgent.browser.isIE();\n\n\n/**\n * Whether the user agent is Microsoft Edge (EdgeHTML based).\n * @type {boolean}\n */\ngoog.userAgent.EDGE = goog.userAgent.BROWSER_KNOWN_ ?\n    goog.userAgent.ASSUME_EDGE :\n    goog.labs.userAgent.engine.isEdge();\n\n\n/**\n * Whether the user agent is MS Internet Explorer or MS Edge (EdgeHTML based).\n * @type {boolean}\n */\ngoog.userAgent.EDGE_OR_IE = goog.userAgent.EDGE || goog.userAgent.IE;\n\n\n/**\n * Whether the user agent is Gecko. Gecko is the rendering engine used by\n * Mozilla, Firefox, and others.\n * @type {boolean}\n */\ngoog.userAgent.GECKO = goog.userAgent.BROWSER_KNOWN_ ?\n    goog.userAgent.ASSUME_GECKO :\n    goog.labs.userAgent.engine.isGecko();\n\n\n/**\n * Whether the user agent is WebKit. WebKit is the rendering engine that\n * Safari, Edge Chromium, Opera Chromium, Android and others use.\n * @type {boolean}\n */\ngoog.userAgent.WEBKIT = goog.userAgent.BROWSER_KNOWN_ ?\n    goog.userAgent.ASSUME_WEBKIT || goog.userAgent.ASSUME_MOBILE_WEBKIT :\n    goog.labs.userAgent.engine.isWebKit();\n\n\n/**\n * Whether the user agent is running on a mobile device.\n *\n * This is a separate function so that the logic can be tested.\n *\n * TODO(nnaze): Investigate swapping in goog.labs.userAgent.device.isMobile().\n *\n * @return {boolean} Whether the user agent is running on a mobile device.\n * @private\n */\ngoog.userAgent.isMobile_ = function() {\n  return goog.userAgent.WEBKIT &&\n      goog.labs.userAgent.util.matchUserAgent('Mobile');\n};\n\n\n/**\n * Whether the user agent is running on a mobile device.\n *\n * TODO(nnaze): Consider deprecating MOBILE when labs.userAgent\n *   is promoted as the gecko/webkit logic is likely inaccurate.\n *\n * @type {boolean}\n */\ngoog.userAgent.MOBILE =\n    goog.userAgent.ASSUME_MOBILE_WEBKIT || goog.userAgent.isMobile_();\n\n\n/**\n * Used while transitioning code to use WEBKIT instead.\n * @type {boolean}\n * @deprecated Use {@link goog.userAgent.product.SAFARI} instead.\n * TODO(nicksantos): Delete this from goog.userAgent.\n */\ngoog.userAgent.SAFARI = goog.userAgent.WEBKIT;\n\n\n/**\n * @return {string} the platform (operating system) the user agent is running\n *     on. Default to empty string because navigator.platform may not be defined\n *     (on Rhino, for example).\n * @private\n */\ngoog.userAgent.determinePlatform_ = function() {\n  var navigator = goog.userAgent.getNavigatorTyped();\n  return navigator && navigator.platform || '';\n};\n\n\n/**\n * The platform (operating system) the user agent is running on. Default to\n * empty string because navigator.platform may not be defined (on Rhino, for\n * example).\n * @type {string}\n */\ngoog.userAgent.PLATFORM = goog.userAgent.determinePlatform_();\n\n\n/**\n * @define {boolean} Whether the user agent is running on a Macintosh operating\n *     system.\n */\ngoog.userAgent.ASSUME_MAC = goog.define('goog.userAgent.ASSUME_MAC', false);\n\n\n/**\n * @define {boolean} Whether the user agent is running on a Windows operating\n *     system.\n */\ngoog.userAgent.ASSUME_WINDOWS =\n    goog.define('goog.userAgent.ASSUME_WINDOWS', false);\n\n\n/**\n * @define {boolean} Whether the user agent is running on a Linux operating\n *     system.\n */\ngoog.userAgent.ASSUME_LINUX = goog.define('goog.userAgent.ASSUME_LINUX', false);\n\n\n/**\n * @define {boolean} Whether the user agent is running on a X11 windowing\n *     system.\n */\ngoog.userAgent.ASSUME_X11 = goog.define('goog.userAgent.ASSUME_X11', false);\n\n\n/**\n * @define {boolean} Whether the user agent is running on Android.\n */\ngoog.userAgent.ASSUME_ANDROID =\n    goog.define('goog.userAgent.ASSUME_ANDROID', false);\n\n\n/**\n * @define {boolean} Whether the user agent is running on an iPhone.\n */\ngoog.userAgent.ASSUME_IPHONE =\n    goog.define('goog.userAgent.ASSUME_IPHONE', false);\n\n\n/**\n * @define {boolean} Whether the user agent is running on an iPad.\n */\ngoog.userAgent.ASSUME_IPAD = goog.define('goog.userAgent.ASSUME_IPAD', false);\n\n\n/**\n * @define {boolean} Whether the user agent is running on an iPod.\n */\ngoog.userAgent.ASSUME_IPOD = goog.define('goog.userAgent.ASSUME_IPOD', false);\n\n\n/**\n * @define {boolean} Whether the user agent is running on KaiOS.\n */\ngoog.userAgent.ASSUME_KAIOS = goog.define('goog.userAgent.ASSUME_KAIOS', false);\n\n/**\n * @define {boolean} Whether the user agent is running on Go2Phone.\n */\ngoog.userAgent.ASSUME_GO2PHONE =\n    goog.define('goog.userAgent.ASSUME_GO2PHONE', false);\n\n\n/**\n * @type {boolean}\n * @private\n */\ngoog.userAgent.PLATFORM_KNOWN_ = goog.userAgent.ASSUME_MAC ||\n    goog.userAgent.ASSUME_WINDOWS || goog.userAgent.ASSUME_LINUX ||\n    goog.userAgent.ASSUME_X11 || goog.userAgent.ASSUME_ANDROID ||\n    goog.userAgent.ASSUME_IPHONE || goog.userAgent.ASSUME_IPAD ||\n    goog.userAgent.ASSUME_IPOD;\n\n\n/**\n * Whether the user agent is running on a Macintosh operating system.\n * @type {boolean}\n */\ngoog.userAgent.MAC = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_MAC :\n    goog.labs.userAgent.platform.isMacintosh();\n\n\n/**\n * Whether the user agent is running on a Windows operating system.\n * @type {boolean}\n */\ngoog.userAgent.WINDOWS = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_WINDOWS :\n    goog.labs.userAgent.platform.isWindows();\n\n\n/**\n * Whether the user agent is Linux per the legacy behavior of\n * goog.userAgent.LINUX, which considered ChromeOS to also be\n * Linux.\n * @return {boolean}\n * @private\n */\ngoog.userAgent.isLegacyLinux_ = function() {\n  return goog.labs.userAgent.platform.isLinux() ||\n      goog.labs.userAgent.platform.isChromeOS();\n};\n\n\n/**\n * Whether the user agent is running on a Linux operating system.\n *\n * Note that goog.userAgent.LINUX considers ChromeOS to be Linux,\n * while goog.labs.userAgent.platform considers ChromeOS and\n * Linux to be different OSes.\n *\n * @type {boolean}\n */\ngoog.userAgent.LINUX = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_LINUX :\n    goog.userAgent.isLegacyLinux_();\n\n\n/**\n * @return {boolean} Whether the user agent is an X11 windowing system.\n * @private\n */\ngoog.userAgent.isX11_ = function() {\n  var navigator = goog.userAgent.getNavigatorTyped();\n  return !!navigator &&\n      goog.string.contains(navigator['appVersion'] || '', 'X11');\n};\n\n\n/**\n * Whether the user agent is running on a X11 windowing system.\n * @type {boolean}\n */\ngoog.userAgent.X11 = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_X11 :\n    goog.userAgent.isX11_();\n\n\n/**\n * Whether the user agent is running on Android.\n * @type {boolean}\n */\ngoog.userAgent.ANDROID = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_ANDROID :\n    goog.labs.userAgent.platform.isAndroid();\n\n\n/**\n * Whether the user agent is running on an iPhone.\n * @type {boolean}\n */\ngoog.userAgent.IPHONE = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_IPHONE :\n    goog.labs.userAgent.platform.isIphone();\n\n\n/**\n * Whether the user agent is running on an iPad.\n * @type {boolean}\n */\ngoog.userAgent.IPAD = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_IPAD :\n    goog.labs.userAgent.platform.isIpad();\n\n\n/**\n * Whether the user agent is running on an iPod.\n * @type {boolean}\n */\ngoog.userAgent.IPOD = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_IPOD :\n    goog.labs.userAgent.platform.isIpod();\n\n\n/**\n * Whether the user agent is running on iOS.\n * @type {boolean}\n */\ngoog.userAgent.IOS = goog.userAgent.PLATFORM_KNOWN_ ?\n    (goog.userAgent.ASSUME_IPHONE || goog.userAgent.ASSUME_IPAD ||\n     goog.userAgent.ASSUME_IPOD) :\n    goog.labs.userAgent.platform.isIos();\n\n/**\n * Whether the user agent is running on KaiOS.\n * @type {boolean}\n */\ngoog.userAgent.KAIOS = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_KAIOS :\n    goog.labs.userAgent.platform.isKaiOS();\n\n/**\n * Whether the user agent is running on Go2Phone.\n * @type {boolean}\n */\ngoog.userAgent.GO2PHONE = goog.userAgent.PLATFORM_KNOWN_ ?\n    goog.userAgent.ASSUME_GO2PHONE :\n    goog.labs.userAgent.platform.isGo2Phone();\n\n\n/**\n * @return {string} The string that describes the version number of the user\n *     agent.\n * @private\n */\ngoog.userAgent.determineVersion_ = function() {\n  // All browsers have different ways to detect the version and they all have\n  // different naming schemes.\n  // version is a string rather than a number because it may contain 'b', 'a',\n  // and so on.\n  var version = '';\n  var arr = goog.userAgent.getVersionRegexResult_();\n  if (arr) {\n    version = arr ? arr[1] : '';\n  }\n\n  if (goog.userAgent.IE) {\n    // IE9 can be in document mode 9 but be reporting an inconsistent user agent\n    // version.  If it is identifying as a version lower than 9 we take the\n    // documentMode as the version instead.  IE8 has similar behavior.\n    // It is recommended to set the X-UA-Compatible header to ensure that IE9\n    // uses documentMode 9.\n    var docMode = goog.userAgent.getDocumentMode_();\n    if (docMode != null && docMode > parseFloat(version)) {\n      return String(docMode);\n    }\n  }\n\n  return version;\n};\n\n\n/**\n * @return {?IArrayLike<string>|undefined} The version regex matches from\n *     parsing the user\n *     agent string. These regex statements must be executed inline so they can\n *     be compiled out by the closure compiler with the rest of the useragent\n *     detection logic when ASSUME_* is specified.\n * @private\n */\ngoog.userAgent.getVersionRegexResult_ = function() {\n  var userAgent = goog.userAgent.getUserAgentString();\n  if (goog.userAgent.GECKO) {\n    return /rv\\:([^\\);]+)(\\)|;)/.exec(userAgent);\n  }\n  if (goog.userAgent.EDGE) {\n    return /Edge\\/([\\d\\.]+)/.exec(userAgent);\n  }\n  if (goog.userAgent.IE) {\n    return /\\b(?:MSIE|rv)[: ]([^\\);]+)(\\)|;)/.exec(userAgent);\n  }\n  if (goog.userAgent.WEBKIT) {\n    // WebKit/125.4\n    return /WebKit\\/(\\S+)/.exec(userAgent);\n  }\n  if (goog.userAgent.OPERA) {\n    // If none of the above browsers were detected but the browser is Opera, the\n    // only string that is of interest is 'Version/<number>'.\n    return /(?:Version)[ \\/]?(\\S+)/.exec(userAgent);\n  }\n  return undefined;\n};\n\n\n/**\n * @return {number|undefined} Returns the document mode (for testing).\n * @private\n */\ngoog.userAgent.getDocumentMode_ = function() {\n  // NOTE(user): goog.userAgent may be used in context where there is no DOM.\n  var doc = goog.global['document'];\n  return doc ? doc['documentMode'] : undefined;\n};\n\n\n/**\n * The version of the user agent. This is a string because it might contain\n * 'b' (as in beta) as well as multiple dots.\n * @type {string}\n */\ngoog.userAgent.VERSION = goog.userAgent.determineVersion_();\n\n\n/**\n * Compares two version numbers.\n *\n * @param {string} v1 Version of first item.\n * @param {string} v2 Version of second item.\n *\n * @return {number}  1 if first argument is higher\n *                   0 if arguments are equal\n *                  -1 if second argument is higher.\n * @deprecated Use goog.string.compareVersions.\n */\ngoog.userAgent.compare = function(v1, v2) {\n  return goog.string.compareVersions(v1, v2);\n};\n\n\n/**\n * Cache for {@link goog.userAgent.isVersionOrHigher}.\n * Calls to compareVersions are surprisingly expensive and, as a browser's\n * version number is unlikely to change during a session, we cache the results.\n * @const\n * @private\n */\ngoog.userAgent.isVersionOrHigherCache_ = {};\n\n\n/**\n * Whether the user agent version is higher or the same as the given version.\n * NOTE: When checking the version numbers for Firefox and Safari, be sure to\n * use the engine's version, not the browser's version number.  For example,\n * Firefox 3.0 corresponds to Gecko 1.9 and Safari 3.0 to Webkit 522.11.\n * Opera and Internet Explorer versions match the product release number.<br>\n * @see <a href=\"http://en.wikipedia.org/wiki/Safari_version_history\">\n *     Webkit</a>\n * @see <a href=\"http://en.wikipedia.org/wiki/Gecko_engine\">Gecko</a>\n *\n * @param {string|number} version The version to check.\n * @return {boolean} Whether the user agent version is higher or the same as\n *     the given version.\n */\ngoog.userAgent.isVersionOrHigher = function(version) {\n  return goog.userAgent.ASSUME_ANY_VERSION ||\n      goog.reflect.cache(\n          goog.userAgent.isVersionOrHigherCache_, version, function() {\n            return goog.string.compareVersions(\n                       goog.userAgent.VERSION, version) >= 0;\n          });\n};\n\n\n/**\n * Deprecated alias to `goog.userAgent.isVersionOrHigher`.\n * @param {string|number} version The version to check.\n * @return {boolean} Whether the user agent version is higher or the same as\n *     the given version.\n * @deprecated Use goog.userAgent.isVersionOrHigher().\n */\ngoog.userAgent.isVersion = goog.userAgent.isVersionOrHigher;\n\n\n/**\n * Whether the IE effective document mode is higher or the same as the given\n * document mode version.\n * NOTE: Only for IE, return false for another browser.\n *\n * @param {number} documentMode The document mode version to check.\n * @return {boolean} Whether the IE effective document mode is higher or the\n *     same as the given version.\n */\ngoog.userAgent.isDocumentModeOrHigher = function(documentMode) {\n  return Number(goog.userAgent.DOCUMENT_MODE) >= documentMode;\n};\n\n\n/**\n * Deprecated alias to `goog.userAgent.isDocumentModeOrHigher`.\n * @param {number} version The version to check.\n * @return {boolean} Whether the IE effective document mode is higher or the\n *      same as the given version.\n * @deprecated Use goog.userAgent.isDocumentModeOrHigher().\n */\ngoog.userAgent.isDocumentMode = goog.userAgent.isDocumentModeOrHigher;\n\n\n/**\n * For IE version < 7, documentMode is undefined, so attempt to use the\n * CSS1Compat property to see if we are in standards mode. If we are in\n * standards mode, treat the browser version as the document mode. Otherwise,\n * IE is emulating version 5.\n *\n * NOTE(2019/05/31): Support for IE < 7 is long gone, so this is now simplified.\n * It returns document.documentMode for IE and undefined for everything else.\n *\n * @type {number|undefined}\n * @const\n */\ngoog.userAgent.DOCUMENT_MODE = (function() {\n  var doc = goog.global['document'];\n  if (!doc || !goog.userAgent.IE) {\n    return undefined;\n  }\n  return goog.userAgent.getDocumentMode_();\n})();\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Logging and debugging utilities.\n *\n * @see ../demos/debug.html\n */\n\ngoog.provide('goog.debug');\n\ngoog.require('goog.array');\ngoog.require('goog.debug.errorcontext');\ngoog.require('goog.userAgent');\n\n\n/** @define {boolean} Whether logging should be enabled. */\ngoog.debug.LOGGING_ENABLED =\n    goog.define('goog.debug.LOGGING_ENABLED', goog.DEBUG);\n\n\n/** @define {boolean} Whether to force \"sloppy\" stack building. */\ngoog.debug.FORCE_SLOPPY_STACKS =\n    goog.define('goog.debug.FORCE_SLOPPY_STACKS', false);\n\n\n/**\n * Catches onerror events fired by windows and similar objects.\n * @param {function(Object)} logFunc The function to call with the error\n *    information.\n * @param {boolean=} opt_cancel Whether to stop the error from reaching the\n *    browser.\n * @param {Object=} opt_target Object that fires onerror events.\n * @suppress {strictMissingProperties} onerror is not defined as a property\n *    on Object.\n */\ngoog.debug.catchErrors = function(logFunc, opt_cancel, opt_target) {\n  var target = opt_target || goog.global;\n  var oldErrorHandler = target.onerror;\n  var retVal = !!opt_cancel;\n\n  // Chrome interprets onerror return value backwards (http://crbug.com/92062)\n  // until it was fixed in webkit revision r94061 (Webkit 535.3). This\n  // workaround still needs to be skipped in Safari after the webkit change\n  // gets pushed out in Safari.\n  // See https://bugs.webkit.org/show_bug.cgi?id=67119\n  if (goog.userAgent.WEBKIT && !goog.userAgent.isVersionOrHigher('535.3')) {\n    retVal = !retVal;\n  }\n\n  /**\n   * New onerror handler for this target. This onerror handler follows the spec\n   * according to\n   * http://www.whatwg.org/specs/web-apps/current-work/#runtime-script-errors\n   * The spec was changed in August 2013 to support receiving column information\n   * and an error object for all scripts on the same origin or cross origin\n   * scripts with the proper headers. See\n   * https://mikewest.org/2013/08/debugging-runtime-errors-with-window-onerror\n   *\n   * @param {string} message The error message. For cross-origin errors, this\n   *     will be scrubbed to just \"Script error.\". For new browsers that have\n   *     updated to follow the latest spec, errors that come from origins that\n   *     have proper cross origin headers will not be scrubbed.\n   * @param {string} url The URL of the script that caused the error. The URL\n   *     will be scrubbed to \"\" for cross origin scripts unless the script has\n   *     proper cross origin headers and the browser has updated to the latest\n   *     spec.\n   * @param {number} line The line number in the script that the error\n   *     occurred on.\n   * @param {number=} opt_col The optional column number that the error\n   *     occurred on. Only browsers that have updated to the latest spec will\n   *     include this.\n   * @param {Error=} opt_error The optional actual error object for this\n   *     error that should include the stack. Only browsers that have updated\n   *     to the latest spec will inlude this parameter.\n   * @return {boolean} Whether to prevent the error from reaching the browser.\n   */\n  target.onerror = function(message, url, line, opt_col, opt_error) {\n    if (oldErrorHandler) {\n      oldErrorHandler(message, url, line, opt_col, opt_error);\n    }\n    logFunc({\n      message: message,\n      fileName: url,\n      line: line,\n      lineNumber: line,\n      col: opt_col,\n      error: opt_error\n    });\n    return retVal;\n  };\n};\n\n\n/**\n * Creates a string representing an object and all its properties.\n * @param {Object|null|undefined} obj Object to expose.\n * @param {boolean=} opt_showFn Show the functions as well as the properties,\n *     default is false.\n * @return {string} The string representation of `obj`.\n */\ngoog.debug.expose = function(obj, opt_showFn) {\n  if (typeof obj == 'undefined') {\n    return 'undefined';\n  }\n  if (obj == null) {\n    return 'NULL';\n  }\n  var str = [];\n\n  for (var x in obj) {\n    if (!opt_showFn && goog.isFunction(obj[x])) {\n      continue;\n    }\n    var s = x + ' = ';\n\n    try {\n      s += obj[x];\n    } catch (e) {\n      s += '*** ' + e + ' ***';\n    }\n    str.push(s);\n  }\n  return str.join('\\n');\n};\n\n\n/**\n * Creates a string representing a given primitive or object, and for an\n * object, all its properties and nested objects. NOTE: The output will include\n * Uids on all objects that were exposed. Any added Uids will be removed before\n * returning.\n * @param {*} obj Object to expose.\n * @param {boolean=} opt_showFn Also show properties that are functions (by\n *     default, functions are omitted).\n * @return {string} A string representation of `obj`.\n */\ngoog.debug.deepExpose = function(obj, opt_showFn) {\n  var str = [];\n\n  // Track any objects where deepExpose added a Uid, so they can be cleaned up\n  // before return. We do this globally, rather than only on ancestors so that\n  // if the same object appears in the output, you can see it.\n  var uidsToCleanup = [];\n  var ancestorUids = {};\n\n  var helper = function(obj, space) {\n    var nestspace = space + '  ';\n\n    var indentMultiline = function(str) {\n      return str.replace(/\\n/g, '\\n' + space);\n    };\n\n\n    try {\n      if (!goog.isDef(obj)) {\n        str.push('undefined');\n      } else if (goog.isNull(obj)) {\n        str.push('NULL');\n      } else if (goog.isString(obj)) {\n        str.push('\"' + indentMultiline(obj) + '\"');\n      } else if (goog.isFunction(obj)) {\n        str.push(indentMultiline(String(obj)));\n      } else if (goog.isObject(obj)) {\n        // Add a Uid if needed. The struct calls implicitly adds them.\n        if (!goog.hasUid(obj)) {\n          uidsToCleanup.push(obj);\n        }\n        var uid = goog.getUid(obj);\n        if (ancestorUids[uid]) {\n          str.push('*** reference loop detected (id=' + uid + ') ***');\n        } else {\n          ancestorUids[uid] = true;\n          str.push('{');\n          for (var x in obj) {\n            if (!opt_showFn && goog.isFunction(obj[x])) {\n              continue;\n            }\n            str.push('\\n');\n            str.push(nestspace);\n            str.push(x + ' = ');\n            helper(obj[x], nestspace);\n          }\n          str.push('\\n' + space + '}');\n          delete ancestorUids[uid];\n        }\n      } else {\n        str.push(obj);\n      }\n    } catch (e) {\n      str.push('*** ' + e + ' ***');\n    }\n  };\n\n  helper(obj, '');\n\n  // Cleanup any Uids that were added by the deepExpose.\n  for (var i = 0; i < uidsToCleanup.length; i++) {\n    goog.removeUid(uidsToCleanup[i]);\n  }\n\n  return str.join('');\n};\n\n\n/**\n * Recursively outputs a nested array as a string.\n * @param {Array<?>} arr The array.\n * @return {string} String representing nested array.\n */\ngoog.debug.exposeArray = function(arr) {\n  var str = [];\n  for (var i = 0; i < arr.length; i++) {\n    if (goog.isArray(arr[i])) {\n      str.push(goog.debug.exposeArray(arr[i]));\n    } else {\n      str.push(arr[i]);\n    }\n  }\n  return '[ ' + str.join(', ') + ' ]';\n};\n\n\n/**\n * Normalizes the error/exception object between browsers.\n * @param {*} err Raw error object.\n * @return {{\n *    message: (?|undefined),\n *    name: (?|undefined),\n *    lineNumber: (?|undefined),\n *    fileName: (?|undefined),\n *    stack: (?|undefined)\n * }} Normalized error object.\n * @suppress {strictMissingProperties} properties not defined on err\n */\ngoog.debug.normalizeErrorObject = function(err) {\n  var href = goog.getObjectByName('window.location.href');\n  if (err == null) {\n    err = 'Unknown Error of type \"null/undefined\"';\n  }\n  if (goog.isString(err)) {\n    return {\n      'message': err,\n      'name': 'Unknown error',\n      'lineNumber': 'Not available',\n      'fileName': href,\n      'stack': 'Not available'\n    };\n  }\n\n  var lineNumber, fileName;\n  var threwError = false;\n\n  try {\n    lineNumber = err.lineNumber || err.line || 'Not available';\n  } catch (e) {\n    // Firefox 2 sometimes throws an error when accessing 'lineNumber':\n    // Message: Permission denied to get property UnnamedClass.lineNumber\n    lineNumber = 'Not available';\n    threwError = true;\n  }\n\n  try {\n    fileName = err.fileName || err.filename || err.sourceURL ||\n        // $googDebugFname may be set before a call to eval to set the filename\n        // that the eval is supposed to present.\n        goog.global['$googDebugFname'] || href;\n  } catch (e) {\n    // Firefox 2 may also throw an error when accessing 'filename'.\n    fileName = 'Not available';\n    threwError = true;\n  }\n\n  // The IE Error object contains only the name and the message.\n  // The Safari Error object uses the line and sourceURL fields.\n  if (threwError || !err.lineNumber || !err.fileName || !err.stack ||\n      !err.message || !err.name) {\n    var message = err.message;\n    if (message == null) {\n      if (err.constructor && err.constructor instanceof Function) {\n        var ctorName = err.constructor.name ?\n            err.constructor.name :\n            goog.debug.getFunctionName(err.constructor);\n        message = 'Unknown Error of type \"' + ctorName + '\"';\n      } else {\n        message = 'Unknown Error of unknown type';\n      }\n    }\n    return {\n      'message': message,\n      'name': err.name || 'UnknownError',\n      'lineNumber': lineNumber,\n      'fileName': fileName,\n      'stack': err.stack || 'Not available'\n    };\n  }\n\n  // Standards error object\n  // Typed !Object. Should be a subtype of the return type, but it's not.\n  return /** @type {?} */ (err);\n};\n\n\n/**\n * Converts an object to an Error using the object's toString if it's not\n * already an Error, adds a stacktrace if there isn't one, and optionally adds\n * an extra message.\n * @param {*} err The original thrown error, object, or string.\n * @param {string=} opt_message  optional additional message to add to the\n *     error.\n * @return {!Error} If err is an Error, it is enhanced and returned. Otherwise,\n *     it is converted to an Error which is enhanced and returned.\n */\ngoog.debug.enhanceError = function(err, opt_message) {\n  var error;\n  if (!(err instanceof Error)) {\n    error = Error(err);\n    if (Error.captureStackTrace) {\n      // Trim this function off the call stack, if we can.\n      Error.captureStackTrace(error, goog.debug.enhanceError);\n    }\n  } else {\n    error = err;\n  }\n\n  if (!error.stack) {\n    error.stack = goog.debug.getStacktrace(goog.debug.enhanceError);\n  }\n  if (opt_message) {\n    // find the first unoccupied 'messageX' property\n    var x = 0;\n    while (error['message' + x]) {\n      ++x;\n    }\n    error['message' + x] = String(opt_message);\n  }\n  return error;\n};\n\n\n/**\n * Converts an object to an Error using the object's toString if it's not\n * already an Error, adds a stacktrace if there isn't one, and optionally adds\n * context to the Error, which is reported by the closure error reporter.\n * @param {*} err The original thrown error, object, or string.\n * @param {!Object<string, string>=} opt_context Key-value context to add to the\n *     Error.\n * @return {!Error} If err is an Error, it is enhanced and returned. Otherwise,\n *     it is converted to an Error which is enhanced and returned.\n */\ngoog.debug.enhanceErrorWithContext = function(err, opt_context) {\n  var error = goog.debug.enhanceError(err);\n  if (opt_context) {\n    for (var key in opt_context) {\n      goog.debug.errorcontext.addErrorContext(error, key, opt_context[key]);\n    }\n  }\n  return error;\n};\n\n\n/**\n * Gets the current stack trace. Simple and iterative - doesn't worry about\n * catching circular references or getting the args.\n * @param {number=} opt_depth Optional maximum depth to trace back to.\n * @return {string} A string with the function names of all functions in the\n *     stack, separated by \\n.\n * @suppress {es5Strict}\n */\ngoog.debug.getStacktraceSimple = function(opt_depth) {\n  if (!goog.debug.FORCE_SLOPPY_STACKS) {\n    var stack = goog.debug.getNativeStackTrace_(goog.debug.getStacktraceSimple);\n    if (stack) {\n      return stack;\n    }\n    // NOTE: browsers that have strict mode support also have native \"stack\"\n    // properties.  Fall-through for legacy browser support.\n  }\n\n  var sb = [];\n  var fn = arguments.callee.caller;\n  var depth = 0;\n\n  while (fn && (!opt_depth || depth < opt_depth)) {\n    sb.push(goog.debug.getFunctionName(fn));\n    sb.push('()\\n');\n\n    try {\n      fn = fn.caller;\n    } catch (e) {\n      sb.push('[exception trying to get caller]\\n');\n      break;\n    }\n    depth++;\n    if (depth >= goog.debug.MAX_STACK_DEPTH) {\n      sb.push('[...long stack...]');\n      break;\n    }\n  }\n  if (opt_depth && depth >= opt_depth) {\n    sb.push('[...reached max depth limit...]');\n  } else {\n    sb.push('[end]');\n  }\n\n  return sb.join('');\n};\n\n\n/**\n * Max length of stack to try and output\n * @type {number}\n */\ngoog.debug.MAX_STACK_DEPTH = 50;\n\n\n/**\n * @param {Function} fn The function to start getting the trace from.\n * @return {?string}\n * @private\n */\ngoog.debug.getNativeStackTrace_ = function(fn) {\n  var tempErr = new Error();\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(tempErr, fn);\n    return String(tempErr.stack);\n  } else {\n    // IE10, only adds stack traces when an exception is thrown.\n    try {\n      throw tempErr;\n    } catch (e) {\n      tempErr = e;\n    }\n    var stack = tempErr.stack;\n    if (stack) {\n      return String(stack);\n    }\n  }\n  return null;\n};\n\n\n/**\n * Gets the current stack trace, either starting from the caller or starting\n * from a specified function that's currently on the call stack.\n * @param {?Function=} fn If provided, when collecting the stack trace all\n *     frames above the topmost call to this function, including that call,\n *     will be left out of the stack trace.\n * @return {string} Stack trace.\n * @suppress {es5Strict}\n */\ngoog.debug.getStacktrace = function(fn) {\n  var stack;\n  if (!goog.debug.FORCE_SLOPPY_STACKS) {\n    // Try to get the stack trace from the environment if it is available.\n    var contextFn = fn || goog.debug.getStacktrace;\n    stack = goog.debug.getNativeStackTrace_(contextFn);\n  }\n  if (!stack) {\n    // NOTE: browsers that have strict mode support also have native \"stack\"\n    // properties. This function will throw in strict mode.\n    stack = goog.debug.getStacktraceHelper_(fn || arguments.callee.caller, []);\n  }\n  return stack;\n};\n\n\n/**\n * Private helper for getStacktrace().\n * @param {?Function} fn If provided, when collecting the stack trace all\n *     frames above the topmost call to this function, including that call,\n *     will be left out of the stack trace.\n * @param {Array<!Function>} visited List of functions visited so far.\n * @return {string} Stack trace starting from function fn.\n * @suppress {es5Strict}\n * @private\n */\ngoog.debug.getStacktraceHelper_ = function(fn, visited) {\n  var sb = [];\n\n  // Circular reference, certain functions like bind seem to cause a recursive\n  // loop so we need to catch circular references\n  if (goog.array.contains(visited, fn)) {\n    sb.push('[...circular reference...]');\n\n    // Traverse the call stack until function not found or max depth is reached\n  } else if (fn && visited.length < goog.debug.MAX_STACK_DEPTH) {\n    sb.push(goog.debug.getFunctionName(fn) + '(');\n    var args = fn.arguments;\n    // Args may be null for some special functions such as host objects or eval.\n    for (var i = 0; args && i < args.length; i++) {\n      if (i > 0) {\n        sb.push(', ');\n      }\n      var argDesc;\n      var arg = args[i];\n      switch (typeof arg) {\n        case 'object':\n          argDesc = arg ? 'object' : 'null';\n          break;\n\n        case 'string':\n          argDesc = arg;\n          break;\n\n        case 'number':\n          argDesc = String(arg);\n          break;\n\n        case 'boolean':\n          argDesc = arg ? 'true' : 'false';\n          break;\n\n        case 'function':\n          argDesc = goog.debug.getFunctionName(arg);\n          argDesc = argDesc ? argDesc : '[fn]';\n          break;\n\n        case 'undefined':\n        default:\n          argDesc = typeof arg;\n          break;\n      }\n\n      if (argDesc.length > 40) {\n        argDesc = argDesc.substr(0, 40) + '...';\n      }\n      sb.push(argDesc);\n    }\n    visited.push(fn);\n    sb.push(')\\n');\n\n    try {\n      sb.push(goog.debug.getStacktraceHelper_(fn.caller, visited));\n    } catch (e) {\n      sb.push('[exception trying to get caller]\\n');\n    }\n\n  } else if (fn) {\n    sb.push('[...long stack...]');\n  } else {\n    sb.push('[end]');\n  }\n  return sb.join('');\n};\n\n\n/**\n * Gets a function name\n * @param {Function} fn Function to get name of.\n * @return {string} Function's name.\n */\ngoog.debug.getFunctionName = function(fn) {\n  if (goog.debug.fnNameCache_[fn]) {\n    return goog.debug.fnNameCache_[fn];\n  }\n\n  // Heuristically determine function name based on code.\n  var functionSource = String(fn);\n  if (!goog.debug.fnNameCache_[functionSource]) {\n    var matches = /function\\s+([^\\(]+)/m.exec(functionSource);\n    if (matches) {\n      var method = matches[1];\n      goog.debug.fnNameCache_[functionSource] = method;\n    } else {\n      goog.debug.fnNameCache_[functionSource] = '[Anonymous]';\n    }\n  }\n\n  return goog.debug.fnNameCache_[functionSource];\n};\n\n\n/**\n * Makes whitespace visible by replacing it with printable characters.\n * This is useful in finding diffrences between the expected and the actual\n * output strings of a testcase.\n * @param {string} string whose whitespace needs to be made visible.\n * @return {string} string whose whitespace is made visible.\n */\ngoog.debug.makeWhitespaceVisible = function(string) {\n  return string.replace(/ /g, '[_]')\n      .replace(/\\f/g, '[f]')\n      .replace(/\\n/g, '[n]\\n')\n      .replace(/\\r/g, '[r]')\n      .replace(/\\t/g, '[t]');\n};\n\n\n/**\n * Returns the type of a value. If a constructor is passed, and a suitable\n * string cannot be found, 'unknown type name' will be returned.\n *\n * <p>Forked rather than moved from {@link goog.asserts.getType_}\n * to avoid adding a dependency to goog.asserts.\n * @param {*} value A constructor, object, or primitive.\n * @return {string} The best display name for the value, or 'unknown type name'.\n */\ngoog.debug.runtimeType = function(value) {\n  if (value instanceof Function) {\n    return value.displayName || value.name || 'unknown type name';\n  } else if (value instanceof Object) {\n    return /** @type {string} */ (value.constructor.displayName) ||\n        value.constructor.name || Object.prototype.toString.call(value);\n  } else {\n    return value === null ? 'null' : typeof value;\n  }\n};\n\n\n/**\n * Hash map for storing function names that have already been looked up.\n * @type {Object}\n * @private\n */\ngoog.debug.fnNameCache_ = {};\n\n\n/**\n * Private internal function to support goog.debug.freeze.\n * @param {T} arg\n * @return {T}\n * @template T\n * @private\n */\ngoog.debug.freezeInternal_ = goog.DEBUG && Object.freeze || function(arg) {\n  return arg;\n};\n\n\n/**\n * Freezes the given object, but only in debug mode (and in browsers that\n * support it).  Note that this is a shallow freeze, so for deeply nested\n * objects it must be called at every level to ensure deep immutability.\n * @param {T} arg\n * @return {T}\n * @template T\n */\ngoog.debug.freeze = function(arg) {\n  // NOTE: this compiles to nothing, but hides the possible side effect of\n  // freezeInternal_ from the compiler so that the entire call can be\n  // removed if the result is not used.\n  return {\n    valueOf: function() {\n      return goog.debug.freezeInternal_(arg);\n    }\n  }.valueOf();\n};\n","// Copyright 2010 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Browser capability checks for the events package.\n *\n */\n\n\ngoog.provide('goog.events.BrowserFeature');\n\ngoog.require('goog.userAgent');\ngoog.scope(function() {\n\n\n\n/**\n * Enum of browser capabilities.\n * @enum {boolean}\n */\ngoog.events.BrowserFeature = {\n  /**\n   * Whether the button attribute of the event is W3C compliant.  False in\n   * Internet Explorer prior to version 9; document-version dependent.\n   */\n  HAS_W3C_BUTTON:\n      !goog.userAgent.IE || goog.userAgent.isDocumentModeOrHigher(9),\n\n  /**\n   * Whether the browser supports full W3C event model.\n   */\n  HAS_W3C_EVENT_SUPPORT:\n      !goog.userAgent.IE || goog.userAgent.isDocumentModeOrHigher(9),\n\n  /**\n   * To prevent default in IE7-8 for certain keydown events we need set the\n   * keyCode to -1.\n   */\n  SET_KEY_CODE_TO_PREVENT_DEFAULT:\n      goog.userAgent.IE && !goog.userAgent.isVersionOrHigher('9'),\n\n  /**\n   * Whether the `navigator.onLine` property is supported.\n   */\n  HAS_NAVIGATOR_ONLINE_PROPERTY:\n      !goog.userAgent.WEBKIT || goog.userAgent.isVersionOrHigher('528'),\n\n  /**\n   * Whether HTML5 network online/offline events are supported.\n   */\n  HAS_HTML5_NETWORK_EVENT_SUPPORT:\n      goog.userAgent.GECKO && goog.userAgent.isVersionOrHigher('1.9b') ||\n      goog.userAgent.IE && goog.userAgent.isVersionOrHigher('8') ||\n      goog.userAgent.OPERA && goog.userAgent.isVersionOrHigher('9.5') ||\n      goog.userAgent.WEBKIT && goog.userAgent.isVersionOrHigher('528'),\n\n  /**\n   * Whether HTML5 network events fire on document.body, or otherwise the\n   * window.\n   */\n  HTML5_NETWORK_EVENTS_FIRE_ON_BODY:\n      goog.userAgent.GECKO && !goog.userAgent.isVersionOrHigher('8') ||\n      goog.userAgent.IE && !goog.userAgent.isVersionOrHigher('9'),\n\n  /**\n   * Whether touch is enabled in the browser.\n   */\n  TOUCH_ENABLED:\n      ('ontouchstart' in goog.global ||\n       !!(goog.global['document'] && document.documentElement &&\n          'ontouchstart' in document.documentElement) ||\n       // IE10 uses non-standard touch events, so it has a different check.\n       !!(goog.global['navigator'] &&\n          (goog.global['navigator']['maxTouchPoints'] ||\n           goog.global['navigator']['msMaxTouchPoints']))),\n\n  /**\n   * Whether addEventListener supports W3C standard pointer events.\n   * http://www.w3.org/TR/pointerevents/\n   */\n  POINTER_EVENTS: ('PointerEvent' in goog.global),\n\n  /**\n   * Whether addEventListener supports MSPointer events (only used in IE10).\n   * http://msdn.microsoft.com/en-us/library/ie/hh772103(v=vs.85).aspx\n   * http://msdn.microsoft.com/library/hh673557(v=vs.85).aspx\n   */\n  MSPOINTER_EVENTS:\n      ('MSPointerEvent' in goog.global &&\n       !!(goog.global['navigator'] &&\n          goog.global['navigator']['msPointerEnabled'])),\n\n  /**\n   * Whether addEventListener supports {passive: true}.\n   * https://developers.google.com/web/updates/2016/06/passive-event-listeners\n   */\n  PASSIVE_EVENTS: purify(function() {\n    // If we're in a web worker or other custom environment, we can't tell.\n    if (!goog.global.addEventListener || !Object.defineProperty) {  // IE 8\n      return false;\n    }\n\n    var passive = false;\n    var options = Object.defineProperty({}, 'passive', {\n      get: function() {\n        passive = true;\n      }\n    });\n    try {\n      goog.global.addEventListener('test', goog.nullFunction, options);\n      goog.global.removeEventListener('test', goog.nullFunction, options);\n    } catch (e) {\n    }\n\n    return passive;\n  })\n};\n\n\n/**\n * Tricks Closure Compiler into believing that a function is pure.  The compiler\n * assumes that any `valueOf` function is pure, without analyzing its contents.\n *\n * @param {function(): T} fn\n * @return {T}\n * @template T\n */\nfunction purify(fn) {\n  return ({valueOf: fn}).valueOf();\n}\n});  // goog.scope\n","// Copyright 2005 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview A base class for event objects.\n *\n */\n\n\ngoog.provide('goog.events.Event');\ngoog.provide('goog.events.EventLike');\n\n/**\n * goog.events.Event no longer depends on goog.Disposable. Keep requiring\n * goog.Disposable here to not break projects which assume this dependency.\n * @suppress {extraRequire}\n */\ngoog.require('goog.Disposable');\ngoog.require('goog.events.EventId');\n\n\n/**\n * A typedef for event like objects that are dispatchable via the\n * goog.events.dispatchEvent function. strings are treated as the type for a\n * goog.events.Event. Objects are treated as an extension of a new\n * goog.events.Event with the type property of the object being used as the type\n * of the Event.\n * @typedef {string|Object|goog.events.Event|goog.events.EventId}\n */\ngoog.events.EventLike;\n\n\n\n/**\n * A base class for event objects, so that they can support preventDefault and\n * stopPropagation.\n *\n * @suppress {underscore} Several properties on this class are technically\n *     public, but referencing these properties outside this package is strongly\n *     discouraged.\n *\n * @param {string|!goog.events.EventId} type Event Type.\n * @param {Object=} opt_target Reference to the object that is the target of\n *     this event. It has to implement the `EventTarget` interface\n *     declared at {@link http://developer.mozilla.org/en/DOM/EventTarget}.\n * @constructor\n */\ngoog.events.Event = function(type, opt_target) {\n  /**\n   * Event type.\n   * @type {string}\n   */\n  this.type = type instanceof goog.events.EventId ? String(type) : type;\n\n  /**\n   * TODO(tbreisacher): The type should probably be\n   * EventTarget|goog.events.EventTarget.\n   *\n   * Target of the event.\n   * @type {Object|undefined}\n   */\n  this.target = opt_target;\n\n  /**\n   * Object that had the listener attached.\n   * @type {Object|undefined}\n   */\n  this.currentTarget = this.target;\n\n  /**\n   * Whether to cancel the event in internal capture/bubble processing for IE.\n   * @type {boolean}\n   * @public\n   */\n  this.propagationStopped_ = false;\n\n  /**\n   * Whether the default action has been prevented.\n   * This is a property to match the W3C specification at\n   * {@link http://www.w3.org/TR/DOM-Level-3-Events/\n   * #events-event-type-defaultPrevented}.\n   * Must be treated as read-only outside the class.\n   * @type {boolean}\n   */\n  this.defaultPrevented = false;\n\n  /**\n   * Return value for in internal capture/bubble processing for IE.\n   * @type {boolean}\n   * @public\n   */\n  this.returnValue_ = true;\n};\n\n\n/**\n * Stops event propagation.\n */\ngoog.events.Event.prototype.stopPropagation = function() {\n  this.propagationStopped_ = true;\n};\n\n\n/**\n * Prevents the default action, for example a link redirecting to a url.\n */\ngoog.events.Event.prototype.preventDefault = function() {\n  this.defaultPrevented = true;\n  this.returnValue_ = false;\n};\n\n\n/**\n * Stops the propagation of the event. It is equivalent to\n * `e.stopPropagation()`, but can be used as the callback argument of\n * {@link goog.events.listen} without declaring another function.\n * @param {!goog.events.Event} e An event.\n */\ngoog.events.Event.stopPropagation = function(e) {\n  e.stopPropagation();\n};\n\n\n/**\n * Prevents the default action. It is equivalent to\n * `e.preventDefault()`, but can be used as the callback argument of\n * {@link goog.events.listen} without declaring another function.\n * @param {!goog.events.Event} e An event.\n */\ngoog.events.Event.preventDefault = function(e) {\n  e.preventDefault();\n};\n","// Copyright 2005 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview A patched, standardized event object for browser events.\n *\n * <pre>\n * The patched event object contains the following members:\n * - type           {string}    Event type, e.g. 'click'\n * - target         {Object}    The element that actually triggered the event\n * - currentTarget  {Object}    The element the listener is attached to\n * - relatedTarget  {Object}    For mouseover and mouseout, the previous object\n * - offsetX        {number}    X-coordinate relative to target\n * - offsetY        {number}    Y-coordinate relative to target\n * - clientX        {number}    X-coordinate relative to viewport\n * - clientY        {number}    Y-coordinate relative to viewport\n * - screenX        {number}    X-coordinate relative to the edge of the screen\n * - screenY        {number}    Y-coordinate relative to the edge of the screen\n * - button         {number}    Mouse button. Use isButton() to test.\n * - keyCode        {number}    Key-code\n * - ctrlKey        {boolean}   Was ctrl key depressed\n * - altKey         {boolean}   Was alt key depressed\n * - shiftKey       {boolean}   Was shift key depressed\n * - metaKey        {boolean}   Was meta key depressed\n * - pointerId      {number}    Pointer ID\n * - pointerType    {string}    Pointer type, e.g. 'mouse', 'pen', or 'touch'\n * - defaultPrevented {boolean} Whether the default action has been prevented\n * - state          {Object}    History state object\n *\n * NOTE: The keyCode member contains the raw browser keyCode. For normalized\n * key and character code use {@link goog.events.KeyHandler}.\n * </pre>\n *\n * @author arv@google.com (Erik Arvidsson)\n */\n\ngoog.provide('goog.events.BrowserEvent');\ngoog.provide('goog.events.BrowserEvent.MouseButton');\ngoog.provide('goog.events.BrowserEvent.PointerType');\n\ngoog.require('goog.debug');\ngoog.require('goog.events.BrowserFeature');\ngoog.require('goog.events.Event');\ngoog.require('goog.events.EventType');\ngoog.require('goog.reflect');\ngoog.require('goog.userAgent');\n\n/**\n * @define {boolean} If true, use the layerX and layerY properties of a native\n * browser event over the offsetX and offsetY properties, which cause expensive\n * reflow. If layerX or layerY is not defined, offsetX and offsetY will be used\n * as usual.\n */\ngoog.events.USE_LAYER_XY_AS_OFFSET_XY =\n    goog.define('goog.events.USE_LAYER_XY_AS_OFFSET_XY', false);\n\n/**\n * Accepts a browser event object and creates a patched, cross browser event\n * object.\n * The content of this object will not be initialized if no event object is\n * provided. If this is the case, init() needs to be invoked separately.\n * @param {Event=} opt_e Browser event object.\n * @param {EventTarget=} opt_currentTarget Current target for event.\n * @constructor\n * @extends {goog.events.Event}\n */\ngoog.events.BrowserEvent = function(opt_e, opt_currentTarget) {\n  goog.events.BrowserEvent.base(this, 'constructor', opt_e ? opt_e.type : '');\n\n  /**\n   * Target that fired the event.\n   * @override\n   * @type {?Node}\n   */\n  this.target = null;\n\n  /**\n   * Node that had the listener attached.\n   * @override\n   * @type {?Node|undefined}\n   */\n  this.currentTarget = null;\n\n  /**\n   * For mouseover and mouseout events, the related object for the event.\n   * @type {?Node}\n   */\n  this.relatedTarget = null;\n\n  /**\n   * X-coordinate relative to target.\n   * @type {number}\n   */\n  this.offsetX = 0;\n\n  /**\n   * Y-coordinate relative to target.\n   * @type {number}\n   */\n  this.offsetY = 0;\n\n  /**\n   * X-coordinate relative to the window.\n   * @type {number}\n   */\n  this.clientX = 0;\n\n  /**\n   * Y-coordinate relative to the window.\n   * @type {number}\n   */\n  this.clientY = 0;\n\n  /**\n   * X-coordinate relative to the monitor.\n   * @type {number}\n   */\n  this.screenX = 0;\n\n  /**\n   * Y-coordinate relative to the monitor.\n   * @type {number}\n   */\n  this.screenY = 0;\n\n  /**\n   * Which mouse button was pressed.\n   * @type {number}\n   */\n  this.button = 0;\n\n  /**\n   * Key of key press.\n   * @type {string}\n   */\n  this.key = '';\n\n  /**\n   * Keycode of key press.\n   * @type {number}\n   */\n  this.keyCode = 0;\n\n  /**\n   * Keycode of key press.\n   * @type {number}\n   */\n  this.charCode = 0;\n\n  /**\n   * Whether control was pressed at time of event.\n   * @type {boolean}\n   */\n  this.ctrlKey = false;\n\n  /**\n   * Whether alt was pressed at time of event.\n   * @type {boolean}\n   */\n  this.altKey = false;\n\n  /**\n   * Whether shift was pressed at time of event.\n   * @type {boolean}\n   */\n  this.shiftKey = false;\n\n  /**\n   * Whether the meta key was pressed at time of event.\n   * @type {boolean}\n   */\n  this.metaKey = false;\n\n  /**\n   * History state object, only set for PopState events where it's a copy of the\n   * state object provided to pushState or replaceState.\n   * @type {?Object}\n   */\n  this.state = null;\n\n  /**\n   * Whether the default platform modifier key was pressed at time of event.\n   * (This is control for all platforms except Mac, where it's Meta.)\n   * @type {boolean}\n   */\n  this.platformModifierKey = false;\n\n  /**\n   * @type {number}\n   */\n  this.pointerId = 0;\n\n  /**\n   * @type {string}\n   */\n  this.pointerType = '';\n\n  /**\n   * The browser event object.\n   * @private {?Event}\n   */\n  this.event_ = null;\n\n  if (opt_e) {\n    this.init(opt_e, opt_currentTarget);\n  }\n};\ngoog.inherits(goog.events.BrowserEvent, goog.events.Event);\n\n\n/**\n * Normalized button constants for the mouse.\n * @enum {number}\n */\ngoog.events.BrowserEvent.MouseButton = {\n  LEFT: 0,\n  MIDDLE: 1,\n  RIGHT: 2\n};\n\n\n/**\n * Normalized pointer type constants for pointer events.\n * @enum {string}\n */\ngoog.events.BrowserEvent.PointerType = {\n  MOUSE: 'mouse',\n  PEN: 'pen',\n  TOUCH: 'touch'\n};\n\n\n/**\n * Static data for mapping mouse buttons.\n * @type {!Array<number>}\n * @deprecated Use `goog.events.BrowserEvent.IE_BUTTON_MAP` instead.\n */\ngoog.events.BrowserEvent.IEButtonMap = goog.debug.freeze([\n  1,  // LEFT\n  4,  // MIDDLE\n  2   // RIGHT\n]);\n\n\n/**\n * Static data for mapping mouse buttons.\n * @const {!Array<number>}\n */\ngoog.events.BrowserEvent.IE_BUTTON_MAP = goog.events.BrowserEvent.IEButtonMap;\n\n\n/**\n * Static data for mapping MSPointerEvent types to PointerEvent types.\n * @const {!Object<number, goog.events.BrowserEvent.PointerType>}\n */\ngoog.events.BrowserEvent.IE_POINTER_TYPE_MAP = goog.debug.freeze({\n  2: goog.events.BrowserEvent.PointerType.TOUCH,\n  3: goog.events.BrowserEvent.PointerType.PEN,\n  4: goog.events.BrowserEvent.PointerType.MOUSE\n});\n\n\n/**\n * Accepts a browser event object and creates a patched, cross browser event\n * object.\n * @param {Event} e Browser event object.\n * @param {EventTarget=} opt_currentTarget Current target for event.\n */\ngoog.events.BrowserEvent.prototype.init = function(e, opt_currentTarget) {\n  var type = this.type = e.type;\n\n  /**\n   * On touch devices use the first \"changed touch\" as the relevant touch.\n   * @type {?Touch}\n   */\n  var relevantTouch =\n      e.changedTouches && e.changedTouches.length ? e.changedTouches[0] : null;\n\n  // TODO(nicksantos): Change this.target to type EventTarget.\n  this.target = /** @type {Node} */ (e.target) || e.srcElement;\n\n  // TODO(nicksantos): Change this.currentTarget to type EventTarget.\n  this.currentTarget = /** @type {Node} */ (opt_currentTarget);\n\n  var relatedTarget = /** @type {Node} */ (e.relatedTarget);\n  if (relatedTarget) {\n    // There's a bug in FireFox where sometimes, relatedTarget will be a\n    // chrome element, and accessing any property of it will get a permission\n    // denied exception. See:\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=497780\n    if (goog.userAgent.GECKO) {\n      if (!goog.reflect.canAccessProperty(relatedTarget, 'nodeName')) {\n        relatedTarget = null;\n      }\n    }\n  } else if (type == goog.events.EventType.MOUSEOVER) {\n    relatedTarget = e.fromElement;\n  } else if (type == goog.events.EventType.MOUSEOUT) {\n    relatedTarget = e.toElement;\n  }\n\n  this.relatedTarget = relatedTarget;\n\n  if (relevantTouch) {\n    this.clientX = relevantTouch.clientX !== undefined ? relevantTouch.clientX :\n                                                         relevantTouch.pageX;\n    this.clientY = relevantTouch.clientY !== undefined ? relevantTouch.clientY :\n                                                         relevantTouch.pageY;\n    this.screenX = relevantTouch.screenX || 0;\n    this.screenY = relevantTouch.screenY || 0;\n  } else {\n    if (goog.events.USE_LAYER_XY_AS_OFFSET_XY) {\n      this.offsetX = (e.layerX !== undefined) ? e.layerX : e.offsetX;\n      this.offsetY = (e.layerY !== undefined) ? e.layerY : e.offsetY;\n    } else {\n      // Webkit emits a lame warning whenever layerX/layerY is accessed.\n      // http://code.google.com/p/chromium/issues/detail?id=101733\n      this.offsetX = (goog.userAgent.WEBKIT || e.offsetX !== undefined) ?\n          e.offsetX :\n          e.layerX;\n      this.offsetY = (goog.userAgent.WEBKIT || e.offsetY !== undefined) ?\n          e.offsetY :\n          e.layerY;\n    }\n    this.clientX = e.clientX !== undefined ? e.clientX : e.pageX;\n    this.clientY = e.clientY !== undefined ? e.clientY : e.pageY;\n    this.screenX = e.screenX || 0;\n    this.screenY = e.screenY || 0;\n  }\n\n  this.button = e.button;\n\n  this.keyCode = e.keyCode || 0;\n  this.key = e.key || '';\n  this.charCode = e.charCode || (type == 'keypress' ? e.keyCode : 0);\n  this.ctrlKey = e.ctrlKey;\n  this.altKey = e.altKey;\n  this.shiftKey = e.shiftKey;\n  this.metaKey = e.metaKey;\n  this.platformModifierKey = goog.userAgent.MAC ? e.metaKey : e.ctrlKey;\n  this.pointerId = e.pointerId || 0;\n  this.pointerType = goog.events.BrowserEvent.getPointerType_(e);\n  this.state = e.state;\n  this.event_ = e;\n  if (e.defaultPrevented) {\n    this.preventDefault();\n  }\n};\n\n\n/**\n * Tests to see which button was pressed during the event. This is really only\n * useful in IE and Gecko browsers. And in IE, it's only useful for\n * mousedown/mouseup events, because click only fires for the left mouse button.\n *\n * Safari 2 only reports the left button being clicked, and uses the value '1'\n * instead of 0. Opera only reports a mousedown event for the middle button, and\n * no mouse events for the right button. Opera has default behavior for left and\n * middle click that can only be overridden via a configuration setting.\n *\n * There's a nice table of this mess at http://www.unixpapa.com/js/mouse.html.\n *\n * @param {goog.events.BrowserEvent.MouseButton} button The button\n *     to test for.\n * @return {boolean} True if button was pressed.\n */\ngoog.events.BrowserEvent.prototype.isButton = function(button) {\n  if (!goog.events.BrowserFeature.HAS_W3C_BUTTON) {\n    if (this.type == 'click') {\n      return button == goog.events.BrowserEvent.MouseButton.LEFT;\n    } else {\n      return !!(\n          this.event_.button & goog.events.BrowserEvent.IE_BUTTON_MAP[button]);\n    }\n  } else {\n    return this.event_.button == button;\n  }\n};\n\n\n/**\n * Whether this has an \"action\"-producing mouse button.\n *\n * By definition, this includes left-click on windows/linux, and left-click\n * without the ctrl key on Macs.\n *\n * @return {boolean} The result.\n */\ngoog.events.BrowserEvent.prototype.isMouseActionButton = function() {\n  // Webkit does not ctrl+click to be a right-click, so we\n  // normalize it to behave like Gecko and Opera.\n  return this.isButton(goog.events.BrowserEvent.MouseButton.LEFT) &&\n      !(goog.userAgent.WEBKIT && goog.userAgent.MAC && this.ctrlKey);\n};\n\n\n/**\n * @override\n */\ngoog.events.BrowserEvent.prototype.stopPropagation = function() {\n  goog.events.BrowserEvent.superClass_.stopPropagation.call(this);\n  if (this.event_.stopPropagation) {\n    this.event_.stopPropagation();\n  } else {\n    this.event_.cancelBubble = true;\n  }\n};\n\n\n/**\n * @override\n */\ngoog.events.BrowserEvent.prototype.preventDefault = function() {\n  goog.events.BrowserEvent.superClass_.preventDefault.call(this);\n  var be = this.event_;\n  if (!be.preventDefault) {\n    be.returnValue = false;\n    if (goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT) {\n\n      try {\n        // Most keys can be prevented using returnValue. Some special keys\n        // require setting the keyCode to -1 as well:\n        //\n        // In IE7:\n        // F3, F5, F10, F11, Ctrl+P, Crtl+O, Ctrl+F (these are taken from IE6)\n        //\n        // In IE8:\n        // Ctrl+P, Crtl+O, Ctrl+F (F1-F12 cannot be stopped through the event)\n        //\n        // We therefore do this for all function keys as well as when Ctrl key\n        // is pressed.\n        var VK_F1 = 112;\n        var VK_F12 = 123;\n        if (be.ctrlKey || be.keyCode >= VK_F1 && be.keyCode <= VK_F12) {\n          be.keyCode = -1;\n        }\n      } catch (ex) {\n        // IE throws an 'access denied' exception when trying to change\n        // keyCode in some situations (e.g. srcElement is input[type=file],\n        // or srcElement is an anchor tag rewritten by parent's innerHTML).\n        // Do nothing in this case.\n      }\n    }\n  } else {\n    be.preventDefault();\n  }\n};\n\n\n/**\n * @return {Event} The underlying browser event object.\n */\ngoog.events.BrowserEvent.prototype.getBrowserEvent = function() {\n  return this.event_;\n};\n\n\n/**\n * Extracts the pointer type from the given event.\n * @param {!Event} e\n * @return {string} The pointer type, e.g. 'mouse', 'pen', or 'touch'.\n * @private\n */\ngoog.events.BrowserEvent.getPointerType_ = function(e) {\n  if (goog.isString(e.pointerType)) {\n    return e.pointerType;\n  }\n  // IE10 uses integer codes for pointer type.\n  // https://msdn.microsoft.com/en-us/library/hh772359(v=vs.85).aspx\n  return goog.events.BrowserEvent.IE_POINTER_TYPE_MAP[e.pointerType] || '';\n};\n","// Copyright 2012 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview An interface for a listenable JavaScript object.\n * @author chrishenry@google.com (Chris Henry)\n */\n\ngoog.provide('goog.events.Listenable');\ngoog.provide('goog.events.ListenableKey');\n\n/** @suppress {extraRequire} */\ngoog.require('goog.events.EventId');\n\ngoog.forwardDeclare('goog.events.EventLike');\ngoog.forwardDeclare('goog.events.EventTarget');\n\n\n\n/**\n * A listenable interface. A listenable is an object with the ability\n * to dispatch/broadcast events to \"event listeners\" registered via\n * listen/listenOnce.\n *\n * The interface allows for an event propagation mechanism similar\n * to one offered by native browser event targets, such as\n * capture/bubble mechanism, stopping propagation, and preventing\n * default actions. Capture/bubble mechanism depends on the ancestor\n * tree constructed via `#getParentEventTarget`; this tree\n * must be directed acyclic graph. The meaning of default action(s)\n * in preventDefault is specific to a particular use case.\n *\n * Implementations that do not support capture/bubble or can not have\n * a parent listenable can simply not implement any ability to set the\n * parent listenable (and have `#getParentEventTarget` return\n * null).\n *\n * Implementation of this class can be used with or independently from\n * goog.events.\n *\n * Implementation must call `#addImplementation(implClass)`.\n *\n * @interface\n * @see goog.events\n * @see http://www.w3.org/TR/DOM-Level-2-Events/events.html\n */\ngoog.events.Listenable = function() {};\n\n\n/**\n * An expando property to indicate that an object implements\n * goog.events.Listenable.\n *\n * See addImplementation/isImplementedBy.\n *\n * @type {string}\n * @const\n */\ngoog.events.Listenable.IMPLEMENTED_BY_PROP =\n    'closure_listenable_' + ((Math.random() * 1e6) | 0);\n\n\n/**\n * Marks a given class (constructor) as an implementation of\n * Listenable, so that we can query that fact at runtime. The class\n * must have already implemented the interface.\n * @param {function(new:goog.events.Listenable,...)} cls The class constructor.\n *     The corresponding class must have already implemented the interface.\n */\ngoog.events.Listenable.addImplementation = function(cls) {\n  cls.prototype[goog.events.Listenable.IMPLEMENTED_BY_PROP] = true;\n};\n\n\n/**\n * @param {Object} obj The object to check.\n * @return {boolean} Whether a given instance implements Listenable. The\n *     class/superclass of the instance must call addImplementation.\n */\ngoog.events.Listenable.isImplementedBy = function(obj) {\n  return !!(obj && obj[goog.events.Listenable.IMPLEMENTED_BY_PROP]);\n};\n\n\n/**\n * Adds an event listener. A listener can only be added once to an\n * object and if it is added again the key for the listener is\n * returned. Note that if the existing listener is a one-off listener\n * (registered via listenOnce), it will no longer be a one-off\n * listener after a call to listen().\n *\n * @param {string|!goog.events.EventId<EVENTOBJ>} type The event type id.\n * @param {function(this:SCOPE, EVENTOBJ):(boolean|undefined)} listener Callback\n *     method.\n * @param {boolean=} opt_useCapture Whether to fire in capture phase\n *     (defaults to false).\n * @param {SCOPE=} opt_listenerScope Object in whose scope to call the\n *     listener.\n * @return {!goog.events.ListenableKey} Unique key for the listener.\n * @template SCOPE,EVENTOBJ\n */\ngoog.events.Listenable.prototype.listen;\n\n\n/**\n * Adds an event listener that is removed automatically after the\n * listener fired once.\n *\n * If an existing listener already exists, listenOnce will do\n * nothing. In particular, if the listener was previously registered\n * via listen(), listenOnce() will not turn the listener into a\n * one-off listener. Similarly, if there is already an existing\n * one-off listener, listenOnce does not modify the listeners (it is\n * still a once listener).\n *\n * @param {string|!goog.events.EventId<EVENTOBJ>} type The event type id.\n * @param {function(this:SCOPE, EVENTOBJ):(boolean|undefined)} listener Callback\n *     method.\n * @param {boolean=} opt_useCapture Whether to fire in capture phase\n *     (defaults to false).\n * @param {SCOPE=} opt_listenerScope Object in whose scope to call the\n *     listener.\n * @return {!goog.events.ListenableKey} Unique key for the listener.\n * @template SCOPE,EVENTOBJ\n */\ngoog.events.Listenable.prototype.listenOnce;\n\n\n/**\n * Removes an event listener which was added with listen() or listenOnce().\n *\n * @param {string|!goog.events.EventId<EVENTOBJ>} type The event type id.\n * @param {function(this:SCOPE, EVENTOBJ):(boolean|undefined)} listener Callback\n *     method.\n * @param {boolean=} opt_useCapture Whether to fire in capture phase\n *     (defaults to false).\n * @param {SCOPE=} opt_listenerScope Object in whose scope to call\n *     the listener.\n * @return {boolean} Whether any listener was removed.\n * @template SCOPE,EVENTOBJ\n */\ngoog.events.Listenable.prototype.unlisten;\n\n\n/**\n * Removes an event listener which was added with listen() by the key\n * returned by listen().\n *\n * @param {!goog.events.ListenableKey} key The key returned by\n *     listen() or listenOnce().\n * @return {boolean} Whether any listener was removed.\n */\ngoog.events.Listenable.prototype.unlistenByKey;\n\n\n/**\n * Dispatches an event (or event like object) and calls all listeners\n * listening for events of this type. The type of the event is decided by the\n * type property on the event object.\n *\n * If any of the listeners returns false OR calls preventDefault then this\n * function will return false.  If one of the capture listeners calls\n * stopPropagation, then the bubble listeners won't fire.\n *\n * @param {goog.events.EventLike} e Event object.\n * @return {boolean} If anyone called preventDefault on the event object (or\n *     if any of the listeners returns false) this will also return false.\n */\ngoog.events.Listenable.prototype.dispatchEvent;\n\n\n/**\n * Removes all listeners from this listenable. If type is specified,\n * it will only remove listeners of the particular type. otherwise all\n * registered listeners will be removed.\n *\n * @param {string=} opt_type Type of event to remove, default is to\n *     remove all types.\n * @return {number} Number of listeners removed.\n */\ngoog.events.Listenable.prototype.removeAllListeners;\n\n\n/**\n * Returns the parent of this event target to use for capture/bubble\n * mechanism.\n *\n * NOTE(chrishenry): The name reflects the original implementation of\n * custom event target (`goog.events.EventTarget`). We decided\n * that changing the name is not worth it.\n *\n * @return {goog.events.Listenable} The parent EventTarget or null if\n *     there is no parent.\n */\ngoog.events.Listenable.prototype.getParentEventTarget;\n\n\n/**\n * Fires all registered listeners in this listenable for the given\n * type and capture mode, passing them the given eventObject. This\n * does not perform actual capture/bubble. Only implementors of the\n * interface should be using this.\n *\n * @param {string|!goog.events.EventId<EVENTOBJ>} type The type of the\n *     listeners to fire.\n * @param {boolean} capture The capture mode of the listeners to fire.\n * @param {EVENTOBJ} eventObject The event object to fire.\n * @return {boolean} Whether all listeners succeeded without\n *     attempting to prevent default behavior. If any listener returns\n *     false or called goog.events.Event#preventDefault, this returns\n *     false.\n * @template EVENTOBJ\n */\ngoog.events.Listenable.prototype.fireListeners;\n\n\n/**\n * Gets all listeners in this listenable for the given type and\n * capture mode.\n *\n * @param {string|!goog.events.EventId} type The type of the listeners to fire.\n * @param {boolean} capture The capture mode of the listeners to fire.\n * @return {!Array<!goog.events.ListenableKey>} An array of registered\n *     listeners.\n * @template EVENTOBJ\n */\ngoog.events.Listenable.prototype.getListeners;\n\n\n/**\n * Gets the goog.events.ListenableKey for the event or null if no such\n * listener is in use.\n *\n * @param {string|!goog.events.EventId<EVENTOBJ>} type The name of the event\n *     without the 'on' prefix.\n * @param {function(this:SCOPE, EVENTOBJ):(boolean|undefined)} listener The\n *     listener function to get.\n * @param {boolean} capture Whether the listener is a capturing listener.\n * @param {SCOPE=} opt_listenerScope Object in whose scope to call the\n *     listener.\n * @return {goog.events.ListenableKey} the found listener or null if not found.\n * @template SCOPE,EVENTOBJ\n */\ngoog.events.Listenable.prototype.getListener;\n\n\n/**\n * Whether there is any active listeners matching the specified\n * signature. If either the type or capture parameters are\n * unspecified, the function will match on the remaining criteria.\n *\n * @param {string|!goog.events.EventId<EVENTOBJ>=} opt_type Event type.\n * @param {boolean=} opt_capture Whether to check for capture or bubble\n *     listeners.\n * @return {boolean} Whether there is any active listeners matching\n *     the requested type and/or capture phase.\n * @template EVENTOBJ\n */\ngoog.events.Listenable.prototype.hasListener;\n\n\n\n/**\n * An interface that describes a single registered listener.\n * @interface\n */\ngoog.events.ListenableKey = function() {};\n\n\n/**\n * Counter used to create a unique key\n * @type {number}\n * @private\n */\ngoog.events.ListenableKey.counter_ = 0;\n\n\n/**\n * Reserves a key to be used for ListenableKey#key field.\n * @return {number} A number to be used to fill ListenableKey#key\n *     field.\n */\ngoog.events.ListenableKey.reserveKey = function() {\n  return ++goog.events.ListenableKey.counter_;\n};\n\n\n/**\n * The source event target.\n * @type {Object|goog.events.Listenable|goog.events.EventTarget}\n */\ngoog.events.ListenableKey.prototype.src;\n\n\n/**\n * The event type the listener is listening to.\n * @type {string}\n */\ngoog.events.ListenableKey.prototype.type;\n\n\n/**\n * The listener function.\n * @type {function(?):?|{handleEvent:function(?):?}|null}\n */\ngoog.events.ListenableKey.prototype.listener;\n\n\n/**\n * Whether the listener works on capture phase.\n * @type {boolean}\n */\ngoog.events.ListenableKey.prototype.capture;\n\n\n/**\n * The 'this' object for the listener function's scope.\n * @type {Object|undefined}\n */\ngoog.events.ListenableKey.prototype.handler;\n\n\n/**\n * A globally unique number to identify the key.\n * @type {number}\n */\ngoog.events.ListenableKey.prototype.key;\n","// Copyright 2005 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Listener object.\n * @see ../demos/events.html\n */\n\ngoog.provide('goog.events.Listener');\n\ngoog.require('goog.events.ListenableKey');\n\n\n\n/**\n * Simple class that stores information about a listener\n * @param {function(?):?} listener Callback function.\n * @param {Function} proxy Wrapper for the listener that patches the event.\n * @param {EventTarget|goog.events.Listenable} src Source object for\n *     the event.\n * @param {string} type Event type.\n * @param {boolean} capture Whether in capture or bubble phase.\n * @param {Object=} opt_handler Object in whose context to execute the callback.\n * @implements {goog.events.ListenableKey}\n * @constructor\n */\ngoog.events.Listener = function(\n    listener, proxy, src, type, capture, opt_handler) {\n  if (goog.events.Listener.ENABLE_MONITORING) {\n    this.creationStack = new Error().stack;\n  }\n\n  /** @override */\n  this.listener = listener;\n\n  /**\n   * A wrapper over the original listener. This is used solely to\n   * handle native browser events (it is used to simulate the capture\n   * phase and to patch the event object).\n   * @type {Function}\n   */\n  this.proxy = proxy;\n\n  /**\n   * Object or node that callback is listening to\n   * @type {EventTarget|goog.events.Listenable}\n   */\n  this.src = src;\n\n  /**\n   * The event type.\n   * @const {string}\n   */\n  this.type = type;\n\n  /**\n   * Whether the listener is being called in the capture or bubble phase\n   * @const {boolean}\n   */\n  this.capture = !!capture;\n\n  /**\n   * Optional object whose context to execute the listener in\n   * @type {Object|undefined}\n   */\n  this.handler = opt_handler;\n\n  /**\n   * The key of the listener.\n   * @const {number}\n   * @override\n   */\n  this.key = goog.events.ListenableKey.reserveKey();\n\n  /**\n   * Whether to remove the listener after it has been called.\n   * @type {boolean}\n   */\n  this.callOnce = false;\n\n  /**\n   * Whether the listener has been removed.\n   * @type {boolean}\n   */\n  this.removed = false;\n};\n\n\n/**\n * @define {boolean} Whether to enable the monitoring of the\n *     goog.events.Listener instances. Switching on the monitoring is only\n *     recommended for debugging because it has a significant impact on\n *     performance and memory usage. If switched off, the monitoring code\n *     compiles down to 0 bytes.\n */\ngoog.events.Listener.ENABLE_MONITORING =\n    goog.define('goog.events.Listener.ENABLE_MONITORING', false);\n\n\n/**\n * If monitoring the goog.events.Listener instances is enabled, stores the\n * creation stack trace of the Disposable instance.\n * @type {string}\n */\ngoog.events.Listener.prototype.creationStack;\n\n\n/**\n * Marks this listener as removed. This also remove references held by\n * this listener object (such as listener and event source).\n */\ngoog.events.Listener.prototype.markAsRemoved = function() {\n  this.removed = true;\n  this.listener = null;\n  this.proxy = null;\n  this.src = null;\n  this.handler = null;\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview A map of listeners that provides utility functions to\n * deal with listeners on an event target. Used by\n * `goog.events.EventTarget`.\n *\n * WARNING: Do not use this class from outside goog.events package.\n */\n\ngoog.provide('goog.events.ListenerMap');\n\ngoog.require('goog.array');\ngoog.require('goog.events.Listener');\ngoog.require('goog.object');\n\n\n\n/**\n * Creates a new listener map.\n * @param {EventTarget|goog.events.Listenable} src The src object.\n * @constructor\n * @final\n */\ngoog.events.ListenerMap = function(src) {\n  /** @type {EventTarget|goog.events.Listenable} */\n  this.src = src;\n\n  /**\n   * Maps of event type to an array of listeners.\n   * @type {!Object<string, !Array<!goog.events.Listener>>}\n   */\n  this.listeners = {};\n\n  /**\n   * The count of types in this map that have registered listeners.\n   * @private {number}\n   */\n  this.typeCount_ = 0;\n};\n\n\n/**\n * @return {number} The count of event types in this map that actually\n *     have registered listeners.\n */\ngoog.events.ListenerMap.prototype.getTypeCount = function() {\n  return this.typeCount_;\n};\n\n\n/**\n * @return {number} Total number of registered listeners.\n */\ngoog.events.ListenerMap.prototype.getListenerCount = function() {\n  var count = 0;\n  for (var type in this.listeners) {\n    count += this.listeners[type].length;\n  }\n  return count;\n};\n\n\n/**\n * Adds an event listener. A listener can only be added once to an\n * object and if it is added again the key for the listener is\n * returned.\n *\n * Note that a one-off listener will not change an existing listener,\n * if any. On the other hand a normal listener will change existing\n * one-off listener to become a normal listener.\n *\n * @param {string|!goog.events.EventId} type The listener event type.\n * @param {!Function} listener This listener callback method.\n * @param {boolean} callOnce Whether the listener is a one-off\n *     listener.\n * @param {boolean=} opt_useCapture The capture mode of the listener.\n * @param {Object=} opt_listenerScope Object in whose scope to call the\n *     listener.\n * @return {!goog.events.ListenableKey} Unique key for the listener.\n */\ngoog.events.ListenerMap.prototype.add = function(\n    type, listener, callOnce, opt_useCapture, opt_listenerScope) {\n  var typeStr = type.toString();\n  var listenerArray = this.listeners[typeStr];\n  if (!listenerArray) {\n    listenerArray = this.listeners[typeStr] = [];\n    this.typeCount_++;\n  }\n\n  var listenerObj;\n  var index = goog.events.ListenerMap.findListenerIndex_(\n      listenerArray, listener, opt_useCapture, opt_listenerScope);\n  if (index > -1) {\n    listenerObj = listenerArray[index];\n    if (!callOnce) {\n      // Ensure that, if there is an existing callOnce listener, it is no\n      // longer a callOnce listener.\n      listenerObj.callOnce = false;\n    }\n  } else {\n    listenerObj = new goog.events.Listener(\n        listener, null, this.src, typeStr, !!opt_useCapture, opt_listenerScope);\n    listenerObj.callOnce = callOnce;\n    listenerArray.push(listenerObj);\n  }\n  return listenerObj;\n};\n\n\n/**\n * Removes a matching listener.\n * @param {string|!goog.events.EventId} type The listener event type.\n * @param {!Function} listener This listener callback method.\n * @param {boolean=} opt_useCapture The capture mode of the listener.\n * @param {Object=} opt_listenerScope Object in whose scope to call the\n *     listener.\n * @return {boolean} Whether any listener was removed.\n */\ngoog.events.ListenerMap.prototype.remove = function(\n    type, listener, opt_useCapture, opt_listenerScope) {\n  var typeStr = type.toString();\n  if (!(typeStr in this.listeners)) {\n    return false;\n  }\n\n  var listenerArray = this.listeners[typeStr];\n  var index = goog.events.ListenerMap.findListenerIndex_(\n      listenerArray, listener, opt_useCapture, opt_listenerScope);\n  if (index > -1) {\n    var listenerObj = listenerArray[index];\n    listenerObj.markAsRemoved();\n    goog.array.removeAt(listenerArray, index);\n    if (listenerArray.length == 0) {\n      delete this.listeners[typeStr];\n      this.typeCount_--;\n    }\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * Removes the given listener object.\n * @param {!goog.events.ListenableKey} listener The listener to remove.\n * @return {boolean} Whether the listener is removed.\n */\ngoog.events.ListenerMap.prototype.removeByKey = function(listener) {\n  var type = listener.type;\n  if (!(type in this.listeners)) {\n    return false;\n  }\n\n  var removed = goog.array.remove(this.listeners[type], listener);\n  if (removed) {\n    /** @type {!goog.events.Listener} */ (listener).markAsRemoved();\n    if (this.listeners[type].length == 0) {\n      delete this.listeners[type];\n      this.typeCount_--;\n    }\n  }\n  return removed;\n};\n\n\n/**\n * Removes all listeners from this map. If opt_type is provided, only\n * listeners that match the given type are removed.\n * @param {string|!goog.events.EventId=} opt_type Type of event to remove.\n * @return {number} Number of listeners removed.\n */\ngoog.events.ListenerMap.prototype.removeAll = function(opt_type) {\n  var typeStr = opt_type && opt_type.toString();\n  var count = 0;\n  for (var type in this.listeners) {\n    if (!typeStr || type == typeStr) {\n      var listenerArray = this.listeners[type];\n      for (var i = 0; i < listenerArray.length; i++) {\n        ++count;\n        listenerArray[i].markAsRemoved();\n      }\n      delete this.listeners[type];\n      this.typeCount_--;\n    }\n  }\n  return count;\n};\n\n\n/**\n * Gets all listeners that match the given type and capture mode. The\n * returned array is a copy (but the listener objects are not).\n * @param {string|!goog.events.EventId} type The type of the listeners\n *     to retrieve.\n * @param {boolean} capture The capture mode of the listeners to retrieve.\n * @return {!Array<!goog.events.ListenableKey>} An array of matching\n *     listeners.\n */\ngoog.events.ListenerMap.prototype.getListeners = function(type, capture) {\n  var listenerArray = this.listeners[type.toString()];\n  var rv = [];\n  if (listenerArray) {\n    for (var i = 0; i < listenerArray.length; ++i) {\n      var listenerObj = listenerArray[i];\n      if (listenerObj.capture == capture) {\n        rv.push(listenerObj);\n      }\n    }\n  }\n  return rv;\n};\n\n\n/**\n * Gets the goog.events.ListenableKey for the event or null if no such\n * listener is in use.\n *\n * @param {string|!goog.events.EventId} type The type of the listener\n *     to retrieve.\n * @param {!Function} listener The listener function to get.\n * @param {boolean} capture Whether the listener is a capturing listener.\n * @param {Object=} opt_listenerScope Object in whose scope to call the\n *     listener.\n * @return {goog.events.ListenableKey} the found listener or null if not found.\n */\ngoog.events.ListenerMap.prototype.getListener = function(\n    type, listener, capture, opt_listenerScope) {\n  var listenerArray = this.listeners[type.toString()];\n  var i = -1;\n  if (listenerArray) {\n    i = goog.events.ListenerMap.findListenerIndex_(\n        listenerArray, listener, capture, opt_listenerScope);\n  }\n  return i > -1 ? listenerArray[i] : null;\n};\n\n\n/**\n * Whether there is a matching listener. If either the type or capture\n * parameters are unspecified, the function will match on the\n * remaining criteria.\n *\n * @param {string|!goog.events.EventId=} opt_type The type of the listener.\n * @param {boolean=} opt_capture The capture mode of the listener.\n * @return {boolean} Whether there is an active listener matching\n *     the requested type and/or capture phase.\n */\ngoog.events.ListenerMap.prototype.hasListener = function(\n    opt_type, opt_capture) {\n  var hasType = goog.isDef(opt_type);\n  var typeStr = hasType ? opt_type.toString() : '';\n  var hasCapture = goog.isDef(opt_capture);\n\n  return goog.object.some(this.listeners, function(listenerArray, type) {\n    for (var i = 0; i < listenerArray.length; ++i) {\n      if ((!hasType || listenerArray[i].type == typeStr) &&\n          (!hasCapture || listenerArray[i].capture == opt_capture)) {\n        return true;\n      }\n    }\n\n    return false;\n  });\n};\n\n\n/**\n * Finds the index of a matching goog.events.Listener in the given\n * listenerArray.\n * @param {!Array<!goog.events.Listener>} listenerArray Array of listener.\n * @param {!Function} listener The listener function.\n * @param {boolean=} opt_useCapture The capture flag for the listener.\n * @param {Object=} opt_listenerScope The listener scope.\n * @return {number} The index of the matching listener within the\n *     listenerArray.\n * @private\n */\ngoog.events.ListenerMap.findListenerIndex_ = function(\n    listenerArray, listener, opt_useCapture, opt_listenerScope) {\n  for (var i = 0; i < listenerArray.length; ++i) {\n    var listenerObj = listenerArray[i];\n    if (!listenerObj.removed && listenerObj.listener == listener &&\n        listenerObj.capture == !!opt_useCapture &&\n        listenerObj.handler == opt_listenerScope) {\n      return i;\n    }\n  }\n  return -1;\n};\n","// Copyright 2005 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview An event manager for both native browser event\n * targets and custom JavaScript event targets\n * (`goog.events.Listenable`). This provides an abstraction\n * over browsers' event systems.\n *\n * It also provides a simulation of W3C event model's capture phase in\n * Internet Explorer (IE 8 and below). Caveat: the simulation does not\n * interact well with listeners registered directly on the elements\n * (bypassing goog.events) or even with listeners registered via\n * goog.events in a separate JS binary. In these cases, we provide\n * no ordering guarantees.\n *\n * The listeners will receive a \"patched\" event object. Such event object\n * contains normalized values for certain event properties that differs in\n * different browsers.\n *\n * Example usage:\n * <pre>\n * goog.events.listen(myNode, 'click', function(e) { alert('woo') });\n * goog.events.listen(myNode, 'mouseover', mouseHandler, true);\n * goog.events.unlisten(myNode, 'mouseover', mouseHandler, true);\n * goog.events.removeAll(myNode);\n * </pre>\n *\n *                                            in IE and event object patching]\n * @author arv@google.com (Erik Arvidsson)\n *\n * @see ../demos/events.html\n * @see ../demos/event-propagation.html\n * @see ../demos/stopevent.html\n */\n\n// IMPLEMENTATION NOTES:\n// goog.events stores an auxiliary data structure on each EventTarget\n// source being listened on. This allows us to take advantage of GC,\n// having the data structure GC'd when the EventTarget is GC'd. This\n// GC behavior is equivalent to using W3C DOM Events directly.\n\ngoog.provide('goog.events');\ngoog.provide('goog.events.CaptureSimulationMode');\ngoog.provide('goog.events.Key');\ngoog.provide('goog.events.ListenableType');\n\ngoog.require('goog.asserts');\ngoog.require('goog.debug.entryPointRegistry');\ngoog.require('goog.events.BrowserEvent');\ngoog.require('goog.events.BrowserFeature');\ngoog.require('goog.events.Listenable');\ngoog.require('goog.events.ListenerMap');\n\ngoog.forwardDeclare('goog.debug.ErrorHandler');\ngoog.forwardDeclare('goog.events.EventWrapper');\n\n\n/**\n * @typedef {number|goog.events.ListenableKey}\n */\ngoog.events.Key;\n\n\n/**\n * @typedef {EventTarget|goog.events.Listenable}\n */\ngoog.events.ListenableType;\n\n\n/**\n * Property name on a native event target for the listener map\n * associated with the event target.\n * @private @const {string}\n */\ngoog.events.LISTENER_MAP_PROP_ = 'closure_lm_' + ((Math.random() * 1e6) | 0);\n\n\n/**\n * String used to prepend to IE event types.\n * @const\n * @private\n */\ngoog.events.onString_ = 'on';\n\n\n/**\n * Map of computed \"on<eventname>\" strings for IE event types. Caching\n * this removes an extra object allocation in goog.events.listen which\n * improves IE6 performance.\n * @const\n * @dict\n * @private\n */\ngoog.events.onStringMap_ = {};\n\n\n/**\n * @enum {number} Different capture simulation mode for IE8-.\n */\ngoog.events.CaptureSimulationMode = {\n  /**\n   * Does not perform capture simulation. Will asserts in IE8- when you\n   * add capture listeners.\n   */\n  OFF_AND_FAIL: 0,\n\n  /**\n   * Does not perform capture simulation, silently ignore capture\n   * listeners.\n   */\n  OFF_AND_SILENT: 1,\n\n  /**\n   * Performs capture simulation.\n   */\n  ON: 2\n};\n\n\n/**\n * @define {number} The capture simulation mode for IE8-. By default,\n *     this is ON.\n */\ngoog.events.CAPTURE_SIMULATION_MODE =\n    goog.define('goog.events.CAPTURE_SIMULATION_MODE', 2);\n\n\n/**\n * Estimated count of total native listeners.\n * @private {number}\n */\ngoog.events.listenerCountEstimate_ = 0;\n\n\n/**\n * Adds an event listener for a specific event on a native event\n * target (such as a DOM element) or an object that has implemented\n * {@link goog.events.Listenable}. A listener can only be added once\n * to an object and if it is added again the key for the listener is\n * returned. Note that if the existing listener is a one-off listener\n * (registered via listenOnce), it will no longer be a one-off\n * listener after a call to listen().\n *\n * @param {EventTarget|goog.events.Listenable} src The node to listen\n *     to events on.\n * @param {string|Array<string>|\n *     !goog.events.EventId<EVENTOBJ>|!Array<!goog.events.EventId<EVENTOBJ>>}\n *     type Event type or array of event types.\n * @param {function(this:T, EVENTOBJ):?|{handleEvent:function(?):?}|null}\n *     listener Callback method, or an object with a handleEvent function.\n *     WARNING: passing an Object is now softly deprecated.\n * @param {(boolean|!AddEventListenerOptions)=} opt_options\n * @param {T=} opt_handler Element in whose scope to call the listener.\n * @return {goog.events.Key} Unique key for the listener.\n * @template T,EVENTOBJ\n */\ngoog.events.listen = function(src, type, listener, opt_options, opt_handler) {\n  if (opt_options && opt_options.once) {\n    return goog.events.listenOnce(\n        src, type, listener, opt_options, opt_handler);\n  }\n  if (goog.isArray(type)) {\n    for (var i = 0; i < type.length; i++) {\n      goog.events.listen(src, type[i], listener, opt_options, opt_handler);\n    }\n    return null;\n  }\n\n  listener = goog.events.wrapListener(listener);\n  if (goog.events.Listenable.isImplementedBy(src)) {\n    var capture =\n        goog.isObject(opt_options) ? !!opt_options.capture : !!opt_options;\n    return src.listen(\n        /** @type {string|!goog.events.EventId} */ (type), listener, capture,\n        opt_handler);\n  } else {\n    return goog.events.listen_(\n        /** @type {!EventTarget} */ (src), type, listener,\n        /* callOnce */ false, opt_options, opt_handler);\n  }\n};\n\n\n/**\n * Adds an event listener for a specific event on a native event\n * target. A listener can only be added once to an object and if it\n * is added again the key for the listener is returned.\n *\n * Note that a one-off listener will not change an existing listener,\n * if any. On the other hand a normal listener will change existing\n * one-off listener to become a normal listener.\n *\n * @param {EventTarget} src The node to listen to events on.\n * @param {string|?goog.events.EventId<EVENTOBJ>} type Event type.\n * @param {!Function} listener Callback function.\n * @param {boolean} callOnce Whether the listener is a one-off\n *     listener or otherwise.\n * @param {(boolean|!AddEventListenerOptions)=} opt_options\n * @param {Object=} opt_handler Element in whose scope to call the listener.\n * @return {goog.events.ListenableKey} Unique key for the listener.\n * @template EVENTOBJ\n * @private\n */\ngoog.events.listen_ = function(\n    src, type, listener, callOnce, opt_options, opt_handler) {\n  if (!type) {\n    throw new Error('Invalid event type');\n  }\n\n  var capture =\n      goog.isObject(opt_options) ? !!opt_options.capture : !!opt_options;\n  if (capture && !goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT) {\n    if (goog.events.CAPTURE_SIMULATION_MODE ==\n        goog.events.CaptureSimulationMode.OFF_AND_FAIL) {\n      goog.asserts.fail('Can not register capture listener in IE8-.');\n      return null;\n    } else if (\n        goog.events.CAPTURE_SIMULATION_MODE ==\n        goog.events.CaptureSimulationMode.OFF_AND_SILENT) {\n      return null;\n    }\n  }\n\n  var listenerMap = goog.events.getListenerMap_(src);\n  if (!listenerMap) {\n    src[goog.events.LISTENER_MAP_PROP_] = listenerMap =\n        new goog.events.ListenerMap(src);\n  }\n\n  var listenerObj = /** @type {goog.events.Listener} */ (\n      listenerMap.add(type, listener, callOnce, capture, opt_handler));\n\n  // If the listenerObj already has a proxy, it has been set up\n  // previously. We simply return.\n  if (listenerObj.proxy) {\n    return listenerObj;\n  }\n\n  var proxy = goog.events.getProxy();\n  listenerObj.proxy = proxy;\n\n  proxy.src = src;\n  proxy.listener = listenerObj;\n\n  // Attach the proxy through the browser's API\n  if (src.addEventListener) {\n    // Don't pass an object as `capture` if the browser doesn't support that.\n    if (!goog.events.BrowserFeature.PASSIVE_EVENTS) {\n      opt_options = capture;\n    }\n    // Don't break tests that expect a boolean.\n    if (opt_options === undefined) opt_options = false;\n    src.addEventListener(type.toString(), proxy, opt_options);\n  } else if (src.attachEvent) {\n    // The else if above used to be an unconditional else. It would call\n    // exception on IE11, spoiling the day of some callers. The previous\n    // incarnation of this code, from 2007, indicates that it replaced an\n    // earlier still version that caused excess allocations on IE6.\n    src.attachEvent(goog.events.getOnString_(type.toString()), proxy);\n  } else if (src.addListener && src.removeListener) {\n    // In IE, MediaQueryList uses addListener() insteadd of addEventListener. In\n    // Safari, there is no global for the MediaQueryList constructor, so we just\n    // check whether the object \"looks like\" MediaQueryList.\n    goog.asserts.assert(\n        type === 'change', 'MediaQueryList only has a change event');\n    src.addListener(proxy);\n  } else {\n    throw new Error('addEventListener and attachEvent are unavailable.');\n  }\n\n  goog.events.listenerCountEstimate_++;\n  return listenerObj;\n};\n\n\n/**\n * Helper function for returning a proxy function.\n * @return {!Function} A new or reused function object.\n */\ngoog.events.getProxy = function() {\n  var proxyCallbackFunction = goog.events.handleBrowserEvent_;\n  // Use a local var f to prevent one allocation.\n  var f =\n      goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT ? function(eventObject) {\n        return proxyCallbackFunction.call(f.src, f.listener, eventObject);\n      } : function(eventObject) {\n        var v = proxyCallbackFunction.call(f.src, f.listener, eventObject);\n        // NOTE(chrishenry): In IE, we hack in a capture phase. However, if\n        // there is inline event handler which tries to prevent default (for\n        // example <a href=\"...\" onclick=\"return false\">...</a>) in a\n        // descendant element, the prevent default will be overridden\n        // by this listener if this listener were to return true. Hence, we\n        // return undefined.\n        if (!v) return v;\n      };\n  return f;\n};\n\n\n/**\n * Adds an event listener for a specific event on a native event\n * target (such as a DOM element) or an object that has implemented\n * {@link goog.events.Listenable}. After the event has fired the event\n * listener is removed from the target.\n *\n * If an existing listener already exists, listenOnce will do\n * nothing. In particular, if the listener was previously registered\n * via listen(), listenOnce() will not turn the listener into a\n * one-off listener. Similarly, if there is already an existing\n * one-off listener, listenOnce does not modify the listeners (it is\n * still a once listener).\n *\n * @param {EventTarget|goog.events.Listenable} src The node to listen\n *     to events on.\n * @param {string|Array<string>|\n *     !goog.events.EventId<EVENTOBJ>|!Array<!goog.events.EventId<EVENTOBJ>>}\n *     type Event type or array of event types.\n * @param {function(this:T, EVENTOBJ):?|{handleEvent:function(?):?}|null}\n *     listener Callback method.\n * @param {(boolean|!AddEventListenerOptions)=} opt_options\n * @param {T=} opt_handler Element in whose scope to call the listener.\n * @return {goog.events.Key} Unique key for the listener.\n * @template T,EVENTOBJ\n */\ngoog.events.listenOnce = function(\n    src, type, listener, opt_options, opt_handler) {\n  if (goog.isArray(type)) {\n    for (var i = 0; i < type.length; i++) {\n      goog.events.listenOnce(src, type[i], listener, opt_options, opt_handler);\n    }\n    return null;\n  }\n\n  listener = goog.events.wrapListener(listener);\n  if (goog.events.Listenable.isImplementedBy(src)) {\n    var capture =\n        goog.isObject(opt_options) ? !!opt_options.capture : !!opt_options;\n    return src.listenOnce(\n        /** @type {string|!goog.events.EventId} */ (type), listener, capture,\n        opt_handler);\n  } else {\n    return goog.events.listen_(\n        /** @type {!EventTarget} */ (src), type, listener,\n        /* callOnce */ true, opt_options, opt_handler);\n  }\n};\n\n\n/**\n * Adds an event listener with a specific event wrapper on a DOM Node or an\n * object that has implemented {@link goog.events.Listenable}. A listener can\n * only be added once to an object.\n *\n * @param {EventTarget|goog.events.Listenable} src The target to\n *     listen to events on.\n * @param {goog.events.EventWrapper} wrapper Event wrapper to use.\n * @param {function(this:T, ?):?|{handleEvent:function(?):?}|null} listener\n *     Callback method, or an object with a handleEvent function.\n * @param {boolean=} opt_capt Whether to fire in capture phase (defaults to\n *     false).\n * @param {T=} opt_handler Element in whose scope to call the listener.\n * @template T\n */\ngoog.events.listenWithWrapper = function(\n    src, wrapper, listener, opt_capt, opt_handler) {\n  wrapper.listen(src, listener, opt_capt, opt_handler);\n};\n\n\n/**\n * Removes an event listener which was added with listen().\n *\n * @param {EventTarget|goog.events.Listenable} src The target to stop\n *     listening to events on.\n * @param {string|Array<string>|\n *     !goog.events.EventId<EVENTOBJ>|!Array<!goog.events.EventId<EVENTOBJ>>}\n *     type Event type or array of event types to unlisten to.\n * @param {function(?):?|{handleEvent:function(?):?}|null} listener The\n *     listener function to remove.\n * @param {(boolean|!EventListenerOptions)=} opt_options\n *     whether the listener is fired during the capture or bubble phase of the\n *     event.\n * @param {Object=} opt_handler Element in whose scope to call the listener.\n * @return {?boolean} indicating whether the listener was there to remove.\n * @template EVENTOBJ\n */\ngoog.events.unlisten = function(src, type, listener, opt_options, opt_handler) {\n  if (goog.isArray(type)) {\n    for (var i = 0; i < type.length; i++) {\n      goog.events.unlisten(src, type[i], listener, opt_options, opt_handler);\n    }\n    return null;\n  }\n  var capture =\n      goog.isObject(opt_options) ? !!opt_options.capture : !!opt_options;\n\n  listener = goog.events.wrapListener(listener);\n  if (goog.events.Listenable.isImplementedBy(src)) {\n    return src.unlisten(\n        /** @type {string|!goog.events.EventId} */ (type), listener, capture,\n        opt_handler);\n  }\n\n  if (!src) {\n    // TODO(chrishenry): We should tighten the API to only accept\n    // non-null objects, or add an assertion here.\n    return false;\n  }\n\n  var listenerMap = goog.events.getListenerMap_(\n      /** @type {!EventTarget} */ (src));\n  if (listenerMap) {\n    var listenerObj = listenerMap.getListener(\n        /** @type {string|!goog.events.EventId} */ (type), listener, capture,\n        opt_handler);\n    if (listenerObj) {\n      return goog.events.unlistenByKey(listenerObj);\n    }\n  }\n\n  return false;\n};\n\n\n/**\n * Removes an event listener which was added with listen() by the key\n * returned by listen().\n *\n * @param {goog.events.Key} key The key returned by listen() for this\n *     event listener.\n * @return {boolean} indicating whether the listener was there to remove.\n */\ngoog.events.unlistenByKey = function(key) {\n  // TODO(chrishenry): Remove this check when tests that rely on this\n  // are fixed.\n  if (goog.isNumber(key)) {\n    return false;\n  }\n\n  var listener = key;\n  if (!listener || listener.removed) {\n    return false;\n  }\n\n  var src = listener.src;\n  if (goog.events.Listenable.isImplementedBy(src)) {\n    return /** @type {!goog.events.Listenable} */ (src).unlistenByKey(listener);\n  }\n\n  var type = listener.type;\n  var proxy = listener.proxy;\n  if (src.removeEventListener) {\n    src.removeEventListener(type, proxy, listener.capture);\n  } else if (src.detachEvent) {\n    src.detachEvent(goog.events.getOnString_(type), proxy);\n  } else if (src.addListener && src.removeListener) {\n    src.removeListener(proxy);\n  }\n  goog.events.listenerCountEstimate_--;\n\n  var listenerMap = goog.events.getListenerMap_(\n      /** @type {!EventTarget} */ (src));\n  // TODO(chrishenry): Try to remove this conditional and execute the\n  // first branch always. This should be safe.\n  if (listenerMap) {\n    listenerMap.removeByKey(listener);\n    if (listenerMap.getTypeCount() == 0) {\n      // Null the src, just because this is simple to do (and useful\n      // for IE <= 7).\n      listenerMap.src = null;\n      // We don't use delete here because IE does not allow delete\n      // on a window object.\n      src[goog.events.LISTENER_MAP_PROP_] = null;\n    }\n  } else {\n    /** @type {!goog.events.Listener} */ (listener).markAsRemoved();\n  }\n\n  return true;\n};\n\n\n/**\n * Removes an event listener which was added with listenWithWrapper().\n *\n * @param {EventTarget|goog.events.Listenable} src The target to stop\n *     listening to events on.\n * @param {goog.events.EventWrapper} wrapper Event wrapper to use.\n * @param {function(?):?|{handleEvent:function(?):?}|null} listener The\n *     listener function to remove.\n * @param {boolean=} opt_capt In DOM-compliant browsers, this determines\n *     whether the listener is fired during the capture or bubble phase of the\n *     event.\n * @param {Object=} opt_handler Element in whose scope to call the listener.\n */\ngoog.events.unlistenWithWrapper = function(\n    src, wrapper, listener, opt_capt, opt_handler) {\n  wrapper.unlisten(src, listener, opt_capt, opt_handler);\n};\n\n\n/**\n * Removes all listeners from an object. You can also optionally\n * remove listeners of a particular type.\n *\n * @param {Object|undefined} obj Object to remove listeners from. Must be an\n *     EventTarget or a goog.events.Listenable.\n * @param {string|!goog.events.EventId=} opt_type Type of event to remove.\n *     Default is all types.\n * @return {number} Number of listeners removed.\n */\ngoog.events.removeAll = function(obj, opt_type) {\n  // TODO(chrishenry): Change the type of obj to\n  // (!EventTarget|!goog.events.Listenable).\n\n  if (!obj) {\n    return 0;\n  }\n\n  if (goog.events.Listenable.isImplementedBy(obj)) {\n    return /** @type {?} */ (obj).removeAllListeners(opt_type);\n  }\n\n  var listenerMap = goog.events.getListenerMap_(\n      /** @type {!EventTarget} */ (obj));\n  if (!listenerMap) {\n    return 0;\n  }\n\n  var count = 0;\n  var typeStr = opt_type && opt_type.toString();\n  for (var type in listenerMap.listeners) {\n    if (!typeStr || type == typeStr) {\n      // Clone so that we don't need to worry about unlistenByKey\n      // changing the content of the ListenerMap.\n      var listeners = listenerMap.listeners[type].concat();\n      for (var i = 0; i < listeners.length; ++i) {\n        if (goog.events.unlistenByKey(listeners[i])) {\n          ++count;\n        }\n      }\n    }\n  }\n  return count;\n};\n\n\n/**\n * Gets the listeners for a given object, type and capture phase.\n *\n * @param {Object} obj Object to get listeners for.\n * @param {string|!goog.events.EventId} type Event type.\n * @param {boolean} capture Capture phase?.\n * @return {Array<!goog.events.Listener>} Array of listener objects.\n */\ngoog.events.getListeners = function(obj, type, capture) {\n  if (goog.events.Listenable.isImplementedBy(obj)) {\n    return /** @type {!goog.events.Listenable} */ (obj).getListeners(\n        type, capture);\n  } else {\n    if (!obj) {\n      // TODO(chrishenry): We should tighten the API to accept\n      // !EventTarget|goog.events.Listenable, and add an assertion here.\n      return [];\n    }\n\n    var listenerMap = goog.events.getListenerMap_(\n        /** @type {!EventTarget} */ (obj));\n    return listenerMap ? listenerMap.getListeners(type, capture) : [];\n  }\n};\n\n\n/**\n * Gets the goog.events.Listener for the event or null if no such listener is\n * in use.\n *\n * @param {EventTarget|goog.events.Listenable} src The target from\n *     which to get listeners.\n * @param {?string|!goog.events.EventId<EVENTOBJ>} type The type of the event.\n * @param {function(EVENTOBJ):?|{handleEvent:function(?):?}|null} listener The\n *     listener function to get.\n * @param {boolean=} opt_capt In DOM-compliant browsers, this determines\n *                            whether the listener is fired during the\n *                            capture or bubble phase of the event.\n * @param {Object=} opt_handler Element in whose scope to call the listener.\n * @return {goog.events.ListenableKey} the found listener or null if not found.\n * @template EVENTOBJ\n */\ngoog.events.getListener = function(src, type, listener, opt_capt, opt_handler) {\n  // TODO(chrishenry): Change type from ?string to string, or add assertion.\n  type = /** @type {string} */ (type);\n  listener = goog.events.wrapListener(listener);\n  var capture = !!opt_capt;\n  if (goog.events.Listenable.isImplementedBy(src)) {\n    return src.getListener(type, listener, capture, opt_handler);\n  }\n\n  if (!src) {\n    // TODO(chrishenry): We should tighten the API to only accept\n    // non-null objects, or add an assertion here.\n    return null;\n  }\n\n  var listenerMap = goog.events.getListenerMap_(\n      /** @type {!EventTarget} */ (src));\n  if (listenerMap) {\n    return listenerMap.getListener(type, listener, capture, opt_handler);\n  }\n  return null;\n};\n\n\n/**\n * Returns whether an event target has any active listeners matching the\n * specified signature. If either the type or capture parameters are\n * unspecified, the function will match on the remaining criteria.\n *\n * @param {EventTarget|goog.events.Listenable} obj Target to get\n *     listeners for.\n * @param {string|!goog.events.EventId=} opt_type Event type.\n * @param {boolean=} opt_capture Whether to check for capture or bubble-phase\n *     listeners.\n * @return {boolean} Whether an event target has one or more listeners matching\n *     the requested type and/or capture phase.\n */\ngoog.events.hasListener = function(obj, opt_type, opt_capture) {\n  if (goog.events.Listenable.isImplementedBy(obj)) {\n    return obj.hasListener(opt_type, opt_capture);\n  }\n\n  var listenerMap = goog.events.getListenerMap_(\n      /** @type {!EventTarget} */ (obj));\n  return !!listenerMap && listenerMap.hasListener(opt_type, opt_capture);\n};\n\n\n/**\n * Provides a nice string showing the normalized event objects public members\n * @param {Object} e Event Object.\n * @return {string} String of the public members of the normalized event object.\n */\ngoog.events.expose = function(e) {\n  var str = [];\n  for (var key in e) {\n    if (e[key] && e[key].id) {\n      str.push(key + ' = ' + e[key] + ' (' + e[key].id + ')');\n    } else {\n      str.push(key + ' = ' + e[key]);\n    }\n  }\n  return str.join('\\n');\n};\n\n\n/**\n * Returns a string with on prepended to the specified type. This is used for IE\n * which expects \"on\" to be prepended. This function caches the string in order\n * to avoid extra allocations in steady state.\n * @param {string} type Event type.\n * @return {string} The type string with 'on' prepended.\n * @private\n */\ngoog.events.getOnString_ = function(type) {\n  if (type in goog.events.onStringMap_) {\n    return goog.events.onStringMap_[type];\n  }\n  return goog.events.onStringMap_[type] = goog.events.onString_ + type;\n};\n\n\n/**\n * Fires an object's listeners of a particular type and phase\n *\n * @param {Object} obj Object whose listeners to call.\n * @param {string|!goog.events.EventId} type Event type.\n * @param {boolean} capture Which event phase.\n * @param {Object} eventObject Event object to be passed to listener.\n * @return {boolean} True if all listeners returned true else false.\n */\ngoog.events.fireListeners = function(obj, type, capture, eventObject) {\n  if (goog.events.Listenable.isImplementedBy(obj)) {\n    return /** @type {!goog.events.Listenable} */ (obj).fireListeners(\n        type, capture, eventObject);\n  }\n\n  return goog.events.fireListeners_(obj, type, capture, eventObject);\n};\n\n\n/**\n * Fires an object's listeners of a particular type and phase.\n * @param {Object} obj Object whose listeners to call.\n * @param {string|!goog.events.EventId} type Event type.\n * @param {boolean} capture Which event phase.\n * @param {Object} eventObject Event object to be passed to listener.\n * @return {boolean} True if all listeners returned true else false.\n * @private\n */\ngoog.events.fireListeners_ = function(obj, type, capture, eventObject) {\n  /** @type {boolean} */\n  var retval = true;\n\n  var listenerMap = goog.events.getListenerMap_(\n      /** @type {EventTarget} */ (obj));\n  if (listenerMap) {\n    // TODO(chrishenry): Original code avoids array creation when there\n    // is no listener, so we do the same. If this optimization turns\n    // out to be not required, we can replace this with\n    // listenerMap.getListeners(type, capture) instead, which is simpler.\n    var listenerArray = listenerMap.listeners[type.toString()];\n    if (listenerArray) {\n      listenerArray = listenerArray.concat();\n      for (var i = 0; i < listenerArray.length; i++) {\n        var listener = listenerArray[i];\n        // We might not have a listener if the listener was removed.\n        if (listener && listener.capture == capture && !listener.removed) {\n          var result = goog.events.fireListener(listener, eventObject);\n          retval = retval && (result !== false);\n        }\n      }\n    }\n  }\n  return retval;\n};\n\n\n/**\n * Fires a listener with a set of arguments\n *\n * @param {goog.events.Listener} listener The listener object to call.\n * @param {Object} eventObject The event object to pass to the listener.\n * @return {*} Result of listener.\n */\ngoog.events.fireListener = function(listener, eventObject) {\n  var listenerFn = listener.listener;\n  var listenerHandler = listener.handler || listener.src;\n\n  if (listener.callOnce) {\n    goog.events.unlistenByKey(listener);\n  }\n  return listenerFn.call(listenerHandler, eventObject);\n};\n\n\n/**\n * Gets the total number of listeners currently in the system.\n * @return {number} Number of listeners.\n * @deprecated This returns estimated count, now that Closure no longer\n * stores a central listener registry. We still return an estimation\n * to keep existing listener-related tests passing. In the near future,\n * this function will be removed.\n */\ngoog.events.getTotalListenerCount = function() {\n  return goog.events.listenerCountEstimate_;\n};\n\n\n/**\n * Dispatches an event (or event like object) and calls all listeners\n * listening for events of this type. The type of the event is decided by the\n * type property on the event object.\n *\n * If any of the listeners returns false OR calls preventDefault then this\n * function will return false.  If one of the capture listeners calls\n * stopPropagation, then the bubble listeners won't fire.\n *\n * @param {goog.events.Listenable} src The event target.\n * @param {goog.events.EventLike} e Event object.\n * @return {boolean} If anyone called preventDefault on the event object (or\n *     if any of the handlers returns false) this will also return false.\n *     If there are no handlers, or if all handlers return true, this returns\n *     true.\n */\ngoog.events.dispatchEvent = function(src, e) {\n  goog.asserts.assert(\n      goog.events.Listenable.isImplementedBy(src),\n      'Can not use goog.events.dispatchEvent with ' +\n          'non-goog.events.Listenable instance.');\n  return src.dispatchEvent(e);\n};\n\n\n/**\n * Installs exception protection for the browser event entry point using the\n * given error handler.\n *\n * @param {goog.debug.ErrorHandler} errorHandler Error handler with which to\n *     protect the entry point.\n */\ngoog.events.protectBrowserEventEntryPoint = function(errorHandler) {\n  goog.events.handleBrowserEvent_ =\n      errorHandler.protectEntryPoint(goog.events.handleBrowserEvent_);\n};\n\n\n/**\n * Handles an event and dispatches it to the correct listeners. This\n * function is a proxy for the real listener the user specified.\n *\n * @param {goog.events.Listener} listener The listener object.\n * @param {Event=} opt_evt Optional event object that gets passed in via the\n *     native event handlers.\n * @return {*} Result of the event handler.\n * @this {EventTarget} The object or Element that fired the event.\n * @private\n */\ngoog.events.handleBrowserEvent_ = function(listener, opt_evt) {\n  if (listener.removed) {\n    return true;\n  }\n\n  // Synthesize event propagation if the browser does not support W3C\n  // event model.\n  if (!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT) {\n    var ieEvent = opt_evt ||\n        /** @type {Event} */ (goog.getObjectByName('window.event'));\n    var evt = new goog.events.BrowserEvent(ieEvent, this);\n    /** @type {*} */\n    var retval = true;\n\n    if (goog.events.CAPTURE_SIMULATION_MODE ==\n        goog.events.CaptureSimulationMode.ON) {\n      // If we have not marked this event yet, we should perform capture\n      // simulation.\n      if (!goog.events.isMarkedIeEvent_(ieEvent)) {\n        goog.events.markIeEvent_(ieEvent);\n\n        var ancestors = [];\n        for (var parent = evt.currentTarget; parent;\n             parent = parent.parentNode) {\n          ancestors.push(parent);\n        }\n\n        // Fire capture listeners.\n        var type = listener.type;\n        for (var i = ancestors.length - 1; !evt.propagationStopped_ && i >= 0;\n             i--) {\n          evt.currentTarget = ancestors[i];\n          var result =\n              goog.events.fireListeners_(ancestors[i], type, true, evt);\n          retval = retval && result;\n        }\n\n        // Fire bubble listeners.\n        //\n        // We can technically rely on IE to perform bubble event\n        // propagation. However, it turns out that IE fires events in\n        // opposite order of attachEvent registration, which broke\n        // some code and tests that rely on the order. (While W3C DOM\n        // Level 2 Events TR leaves the event ordering unspecified,\n        // modern browsers and W3C DOM Level 3 Events Working Draft\n        // actually specify the order as the registration order.)\n        for (var i = 0; !evt.propagationStopped_ && i < ancestors.length; i++) {\n          evt.currentTarget = ancestors[i];\n          var result =\n              goog.events.fireListeners_(ancestors[i], type, false, evt);\n          retval = retval && result;\n        }\n      }\n    } else {\n      retval = goog.events.fireListener(listener, evt);\n    }\n    return retval;\n  }\n\n  // Otherwise, simply fire the listener.\n  return goog.events.fireListener(\n      listener, new goog.events.BrowserEvent(opt_evt, this));\n};\n\n\n/**\n * This is used to mark the IE event object so we do not do the Closure pass\n * twice for a bubbling event.\n * @param {Event} e The IE browser event.\n * @private\n */\ngoog.events.markIeEvent_ = function(e) {\n  // Only the keyCode and the returnValue can be changed. We use keyCode for\n  // non keyboard events.\n  // event.returnValue is a bit more tricky. It is undefined by default. A\n  // boolean false prevents the default action. In a window.onbeforeunload and\n  // the returnValue is non undefined it will be alerted. However, we will only\n  // modify the returnValue for keyboard events. We can get a problem if non\n  // closure events sets the keyCode or the returnValue\n\n  var useReturnValue = false;\n\n  if (e.keyCode == 0) {\n    // We cannot change the keyCode in case that srcElement is input[type=file].\n    // We could test that that is the case but that would allocate 3 objects.\n    // If we use try/catch we will only allocate extra objects in the case of a\n    // failure.\n\n    try {\n      e.keyCode = -1;\n      return;\n    } catch (ex) {\n      useReturnValue = true;\n    }\n  }\n\n  if (useReturnValue ||\n      /** @type {boolean|undefined} */ (e.returnValue) == undefined) {\n    e.returnValue = true;\n  }\n};\n\n\n/**\n * This is used to check if an IE event has already been handled by the Closure\n * system so we do not do the Closure pass twice for a bubbling event.\n * @param {Event} e  The IE browser event.\n * @return {boolean} True if the event object has been marked.\n * @private\n */\ngoog.events.isMarkedIeEvent_ = function(e) {\n  return e.keyCode < 0 || e.returnValue != undefined;\n};\n\n\n/**\n * Counter to create unique event ids.\n * @private {number}\n */\ngoog.events.uniqueIdCounter_ = 0;\n\n\n/**\n * Creates a unique event id.\n *\n * @param {string} identifier The identifier.\n * @return {string} A unique identifier.\n * @idGenerator {unique}\n */\ngoog.events.getUniqueId = function(identifier) {\n  return identifier + '_' + goog.events.uniqueIdCounter_++;\n};\n\n\n/**\n * @param {EventTarget} src The source object.\n * @return {goog.events.ListenerMap} A listener map for the given\n *     source object, or null if none exists.\n * @private\n */\ngoog.events.getListenerMap_ = function(src) {\n  var listenerMap = src[goog.events.LISTENER_MAP_PROP_];\n  // IE serializes the property as well (e.g. when serializing outer\n  // HTML). So we must check that the value is of the correct type.\n  return listenerMap instanceof goog.events.ListenerMap ? listenerMap : null;\n};\n\n\n/**\n * Expando property for listener function wrapper for Object with\n * handleEvent.\n * @private @const {string}\n */\ngoog.events.LISTENER_WRAPPER_PROP_ =\n    '__closure_events_fn_' + ((Math.random() * 1e9) >>> 0);\n\n\n/**\n * @param {Object|Function} listener The listener function or an\n *     object that contains handleEvent method.\n * @return {!Function} Either the original function or a function that\n *     calls obj.handleEvent. If the same listener is passed to this\n *     function more than once, the same function is guaranteed to be\n *     returned.\n */\ngoog.events.wrapListener = function(listener) {\n  goog.asserts.assert(listener, 'Listener can not be null.');\n\n  if (goog.isFunction(listener)) {\n    return listener;\n  }\n\n  goog.asserts.assert(\n      listener.handleEvent, 'An object listener must have handleEvent method.');\n  if (!listener[goog.events.LISTENER_WRAPPER_PROP_]) {\n    listener[goog.events.LISTENER_WRAPPER_PROP_] = function(e) {\n      return /** @type {?} */ (listener).handleEvent(e);\n    };\n  }\n  return listener[goog.events.LISTENER_WRAPPER_PROP_];\n};\n\n\n// Register the browser event handler as an entry point, so that\n// it can be monitored for exception handling, etc.\ngoog.debug.entryPointRegistry.register(\n    /**\n     * @param {function(!Function): !Function} transformer The transforming\n     *     function.\n     */\n    function(transformer) {\n      goog.events.handleBrowserEvent_ =\n          transformer(goog.events.handleBrowserEvent_);\n    });\n","// Copyright 2005 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview A disposable implementation of a custom\n * listenable/event target. See also: documentation for\n * `goog.events.Listenable`.\n *\n * @author arv@google.com (Erik Arvidsson) [Original implementation]\n * @see ../demos/eventtarget.html\n * @see goog.events.Listenable\n */\n\ngoog.provide('goog.events.EventTarget');\n\ngoog.require('goog.Disposable');\ngoog.require('goog.asserts');\ngoog.require('goog.events');\ngoog.require('goog.events.Event');\ngoog.require('goog.events.Listenable');\ngoog.require('goog.events.ListenerMap');\ngoog.require('goog.object');\n\n\n\n/**\n * An implementation of `goog.events.Listenable` with full W3C\n * EventTarget-like support (capture/bubble mechanism, stopping event\n * propagation, preventing default actions).\n *\n * You may subclass this class to turn your class into a Listenable.\n *\n * Unless propagation is stopped, an event dispatched by an\n * EventTarget will bubble to the parent returned by\n * `getParentEventTarget`. To set the parent, call\n * `setParentEventTarget`. Subclasses that don't support\n * changing the parent can override the setter to throw an error.\n *\n * Example usage:\n * <pre>\n *   var source = new goog.events.EventTarget();\n *   function handleEvent(e) {\n *     alert('Type: ' + e.type + '; Target: ' + e.target);\n *   }\n *   source.listen('foo', handleEvent);\n *   // Or: goog.events.listen(source, 'foo', handleEvent);\n *   ...\n *   source.dispatchEvent('foo');  // will call handleEvent\n *   ...\n *   source.unlisten('foo', handleEvent);\n *   // Or: goog.events.unlisten(source, 'foo', handleEvent);\n * </pre>\n *\n * @constructor\n * @extends {goog.Disposable}\n * @implements {goog.events.Listenable}\n */\ngoog.events.EventTarget = function() {\n  goog.Disposable.call(this);\n\n  /**\n   * Maps of event type to an array of listeners.\n   * @private {!goog.events.ListenerMap}\n   */\n  this.eventTargetListeners_ = new goog.events.ListenerMap(this);\n\n  /**\n   * The object to use for event.target. Useful when mixing in an\n   * EventTarget to another object.\n   * @private {!Object}\n   */\n  this.actualEventTarget_ = this;\n\n  /**\n   * Parent event target, used during event bubbling.\n   *\n   * TODO(chrishenry): Change this to goog.events.Listenable. This\n   * currently breaks people who expect getParentEventTarget to return\n   * goog.events.EventTarget.\n   *\n   * @private {?goog.events.EventTarget}\n   */\n  this.parentEventTarget_ = null;\n};\ngoog.inherits(goog.events.EventTarget, goog.Disposable);\ngoog.events.Listenable.addImplementation(goog.events.EventTarget);\n\n\n/**\n * An artificial cap on the number of ancestors you can have. This is mainly\n * for loop detection.\n * @const {number}\n * @private\n */\ngoog.events.EventTarget.MAX_ANCESTORS_ = 1000;\n\n\n/**\n * Returns the parent of this event target to use for bubbling.\n *\n * @return {goog.events.EventTarget} The parent EventTarget or null if\n *     there is no parent.\n * @override\n */\ngoog.events.EventTarget.prototype.getParentEventTarget = function() {\n  return this.parentEventTarget_;\n};\n\n\n/**\n * Sets the parent of this event target to use for capture/bubble\n * mechanism.\n * @param {goog.events.EventTarget} parent Parent listenable (null if none).\n */\ngoog.events.EventTarget.prototype.setParentEventTarget = function(parent) {\n  this.parentEventTarget_ = parent;\n};\n\n\n/**\n * Adds an event listener to the event target. The same handler can only be\n * added once per the type. Even if you add the same handler multiple times\n * using the same type then it will only be called once when the event is\n * dispatched.\n *\n * @param {string|!goog.events.EventId} type The type of the event to listen for\n * @param {function(?):?|{handleEvent:function(?):?}|null} handler The function\n *     to handle the event. The handler can also be an object that implements\n *     the handleEvent method which takes the event object as argument.\n * @param {boolean=} opt_capture In DOM-compliant browsers, this determines\n *     whether the listener is fired during the capture or bubble phase\n *     of the event.\n * @param {Object=} opt_handlerScope Object in whose scope to call\n *     the listener.\n * @deprecated Use `#listen` instead, when possible. Otherwise, use\n *     `goog.events.listen` if you are passing Object\n *     (instead of Function) as handler.\n */\ngoog.events.EventTarget.prototype.addEventListener = function(\n    type, handler, opt_capture, opt_handlerScope) {\n  goog.events.listen(this, type, handler, opt_capture, opt_handlerScope);\n};\n\n\n/**\n * Removes an event listener from the event target. The handler must be the\n * same object as the one added. If the handler has not been added then\n * nothing is done.\n *\n * @param {string} type The type of the event to listen for.\n * @param {function(?):?|{handleEvent:function(?):?}|null} handler The function\n *     to handle the event. The handler can also be an object that implements\n *     the handleEvent method which takes the event object as argument.\n * @param {boolean=} opt_capture In DOM-compliant browsers, this determines\n *     whether the listener is fired during the capture or bubble phase\n *     of the event.\n * @param {Object=} opt_handlerScope Object in whose scope to call\n *     the listener.\n * @deprecated Use `#unlisten` instead, when possible. Otherwise, use\n *     `goog.events.unlisten` if you are passing Object\n *     (instead of Function) as handler.\n */\ngoog.events.EventTarget.prototype.removeEventListener = function(\n    type, handler, opt_capture, opt_handlerScope) {\n  goog.events.unlisten(this, type, handler, opt_capture, opt_handlerScope);\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.dispatchEvent = function(e) {\n  this.assertInitialized_();\n\n  var ancestorsTree, ancestor = this.getParentEventTarget();\n  if (ancestor) {\n    ancestorsTree = [];\n    var ancestorCount = 1;\n    for (; ancestor; ancestor = ancestor.getParentEventTarget()) {\n      ancestorsTree.push(ancestor);\n      goog.asserts.assert(\n          (++ancestorCount < goog.events.EventTarget.MAX_ANCESTORS_),\n          'infinite loop');\n    }\n  }\n\n  return goog.events.EventTarget.dispatchEventInternal_(\n      this.actualEventTarget_, e, ancestorsTree);\n};\n\n\n/**\n * Removes listeners from this object.  Classes that extend EventTarget may\n * need to override this method in order to remove references to DOM Elements\n * and additional listeners.\n * @override\n * @protected\n */\ngoog.events.EventTarget.prototype.disposeInternal = function() {\n  goog.events.EventTarget.superClass_.disposeInternal.call(this);\n\n  this.removeAllListeners();\n  this.parentEventTarget_ = null;\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.listen = function(\n    type, listener, opt_useCapture, opt_listenerScope) {\n  this.assertInitialized_();\n  return this.eventTargetListeners_.add(\n      String(type), listener, false /* callOnce */, opt_useCapture,\n      opt_listenerScope);\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.listenOnce = function(\n    type, listener, opt_useCapture, opt_listenerScope) {\n  return this.eventTargetListeners_.add(\n      String(type), listener, true /* callOnce */, opt_useCapture,\n      opt_listenerScope);\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.unlisten = function(\n    type, listener, opt_useCapture, opt_listenerScope) {\n  return this.eventTargetListeners_.remove(\n      String(type), listener, opt_useCapture, opt_listenerScope);\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.unlistenByKey = function(key) {\n  return this.eventTargetListeners_.removeByKey(key);\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.removeAllListeners = function(opt_type) {\n  // TODO(chrishenry): Previously, removeAllListeners can be called on\n  // uninitialized EventTarget, so we preserve that behavior. We\n  // should remove this when usages that rely on that fact are purged.\n  if (!this.eventTargetListeners_) {\n    return 0;\n  }\n  return this.eventTargetListeners_.removeAll(opt_type);\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.fireListeners = function(\n    type, capture, eventObject) {\n  // TODO(chrishenry): Original code avoids array creation when there\n  // is no listener, so we do the same. If this optimization turns\n  // out to be not required, we can replace this with\n  // getListeners(type, capture) instead, which is simpler.\n  var listenerArray = this.eventTargetListeners_.listeners[String(type)];\n  if (!listenerArray) {\n    return true;\n  }\n  listenerArray = listenerArray.concat();\n\n  var rv = true;\n  for (var i = 0; i < listenerArray.length; ++i) {\n    var listener = listenerArray[i];\n    // We might not have a listener if the listener was removed.\n    if (listener && !listener.removed && listener.capture == capture) {\n      var listenerFn = listener.listener;\n      var listenerHandler = listener.handler || listener.src;\n\n      if (listener.callOnce) {\n        this.unlistenByKey(listener);\n      }\n      rv = listenerFn.call(listenerHandler, eventObject) !== false && rv;\n    }\n  }\n\n  return rv && eventObject.returnValue_ != false;\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.getListeners = function(type, capture) {\n  return this.eventTargetListeners_.getListeners(String(type), capture);\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.getListener = function(\n    type, listener, capture, opt_listenerScope) {\n  return this.eventTargetListeners_.getListener(\n      String(type), listener, capture, opt_listenerScope);\n};\n\n\n/** @override */\ngoog.events.EventTarget.prototype.hasListener = function(\n    opt_type, opt_capture) {\n  var id = goog.isDef(opt_type) ? String(opt_type) : undefined;\n  return this.eventTargetListeners_.hasListener(id, opt_capture);\n};\n\n\n/**\n * Sets the target to be used for `event.target` when firing\n * event. Mainly used for testing. For example, see\n * `goog.testing.events.mixinListenable`.\n * @param {!Object} target The target.\n */\ngoog.events.EventTarget.prototype.setTargetForTesting = function(target) {\n  this.actualEventTarget_ = target;\n};\n\n\n/**\n * Asserts that the event target instance is initialized properly.\n * @private\n */\ngoog.events.EventTarget.prototype.assertInitialized_ = function() {\n  goog.asserts.assert(\n      this.eventTargetListeners_,\n      'Event target is not initialized. Did you call the superclass ' +\n          '(goog.events.EventTarget) constructor?');\n};\n\n\n/**\n * Dispatches the given event on the ancestorsTree.\n *\n * @param {!Object} target The target to dispatch on.\n * @param {goog.events.Event|Object|string} e The event object.\n * @param {Array<goog.events.Listenable>=} opt_ancestorsTree The ancestors\n *     tree of the target, in reverse order from the closest ancestor\n *     to the root event target. May be null if the target has no ancestor.\n * @return {boolean} If anyone called preventDefault on the event object (or\n *     if any of the listeners returns false) this will also return false.\n * @private\n */\ngoog.events.EventTarget.dispatchEventInternal_ = function(\n    target, e, opt_ancestorsTree) {\n  /** @suppress {missingProperties} */\n  var type = e.type || /** @type {string} */ (e);\n\n  // If accepting a string or object, create a custom event object so that\n  // preventDefault and stopPropagation work with the event.\n  if (goog.isString(e)) {\n    e = new goog.events.Event(e, target);\n  } else if (!(e instanceof goog.events.Event)) {\n    var oldEvent = e;\n    e = new goog.events.Event(type, target);\n    goog.object.extend(e, oldEvent);\n  } else {\n    e.target = e.target || target;\n  }\n\n  var rv = true, currentTarget;\n\n  // Executes all capture listeners on the ancestors, if any.\n  if (opt_ancestorsTree) {\n    for (var i = opt_ancestorsTree.length - 1; !e.propagationStopped_ && i >= 0;\n         i--) {\n      currentTarget = e.currentTarget = opt_ancestorsTree[i];\n      rv = currentTarget.fireListeners(type, true, e) && rv;\n    }\n  }\n\n  // Executes capture and bubble listeners on the target.\n  if (!e.propagationStopped_) {\n    currentTarget = /** @type {?} */ (e.currentTarget = target);\n    rv = currentTarget.fireListeners(type, true, e) && rv;\n    if (!e.propagationStopped_) {\n      rv = currentTarget.fireListeners(type, false, e) && rv;\n    }\n  }\n\n  // Executes all bubble listeners on the ancestors, if any.\n  if (opt_ancestorsTree) {\n    for (i = 0; !e.propagationStopped_ && i < opt_ancestorsTree.length; i++) {\n      currentTarget = e.currentTarget = opt_ancestorsTree[i];\n      rv = currentTarget.fireListeners(type, false, e) && rv;\n    }\n  }\n\n  return rv;\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview A timer class to which other classes and objects can listen on.\n * This is only an abstraction above `setInterval`.\n *\n * @see ../demos/timers.html\n */\n\ngoog.provide('goog.Timer');\n\ngoog.require('goog.Promise');\ngoog.require('goog.events.EventTarget');\n\n\n\n/**\n * Class for handling timing events.\n *\n * @param {number=} opt_interval Number of ms between ticks (default: 1ms).\n * @param {Object=} opt_timerObject  An object that has `setTimeout`,\n *     `setInterval`, `clearTimeout` and `clearInterval`\n *     (e.g., `window`).\n * @constructor\n * @extends {goog.events.EventTarget}\n */\ngoog.Timer = function(opt_interval, opt_timerObject) {\n  goog.events.EventTarget.call(this);\n\n  /**\n   * Number of ms between ticks\n   * @private {number}\n   */\n  this.interval_ = opt_interval || 1;\n\n  /**\n   * An object that implements `setTimeout`, `setInterval`,\n   * `clearTimeout` and `clearInterval`. We default to the window\n   * object. Changing this on {@link goog.Timer.prototype} changes the object\n   * for all timer instances which can be useful if your environment has some\n   * other implementation of timers than the `window` object.\n   * @private {{setTimeout:!Function, clearTimeout:!Function}}\n   */\n  this.timerObject_ = /** @type {{setTimeout, clearTimeout}} */ (\n      opt_timerObject || goog.Timer.defaultTimerObject);\n\n  /**\n   * Cached `tick_` bound to the object for later use in the timer.\n   * @private {Function}\n   * @const\n   */\n  this.boundTick_ = goog.bind(this.tick_, this);\n\n  /**\n   * Firefox browser often fires the timer event sooner (sometimes MUCH sooner)\n   * than the requested timeout. So we compare the time to when the event was\n   * last fired, and reschedule if appropriate. See also\n   * {@link goog.Timer.intervalScale}.\n   * @private {number}\n   */\n  this.last_ = goog.now();\n};\ngoog.inherits(goog.Timer, goog.events.EventTarget);\n\n\n/**\n * Maximum timeout value.\n *\n * Timeout values too big to fit into a signed 32-bit integer may cause overflow\n * in FF, Safari, and Chrome, resulting in the timeout being scheduled\n * immediately. It makes more sense simply not to schedule these timeouts, since\n * 24.8 days is beyond a reasonable expectation for the browser to stay open.\n *\n * @private {number}\n * @const\n */\ngoog.Timer.MAX_TIMEOUT_ = 2147483647;\n\n\n/**\n * A timer ID that cannot be returned by any known implementation of\n * `window.setTimeout`. Passing this value to `window.clearTimeout`\n * should therefore be a no-op.\n *\n * @private {number}\n * @const\n */\ngoog.Timer.INVALID_TIMEOUT_ID_ = -1;\n\n\n/**\n * Whether this timer is enabled\n * @type {boolean}\n */\ngoog.Timer.prototype.enabled = false;\n\n\n/**\n * An object that implements `setTimeout`, `setInterval`,\n * `clearTimeout` and `clearInterval`. We default to the global\n * object. Changing `goog.Timer.defaultTimerObject` changes the object for\n * all timer instances which can be useful if your environment has some other\n * implementation of timers you'd like to use.\n * @type {{setTimeout, clearTimeout}}\n */\ngoog.Timer.defaultTimerObject = goog.global;\n\n\n/**\n * Variable that controls the timer error correction. If the timer is called\n * before the requested interval times `intervalScale`, which often\n * happens on Mozilla, the timer is rescheduled.\n * @see {@link #last_}\n * @type {number}\n */\ngoog.Timer.intervalScale = 0.8;\n\n\n/**\n * Variable for storing the result of `setInterval`.\n * @private {?number}\n */\ngoog.Timer.prototype.timer_ = null;\n\n\n/**\n * Gets the interval of the timer.\n * @return {number} interval Number of ms between ticks.\n */\ngoog.Timer.prototype.getInterval = function() {\n  return this.interval_;\n};\n\n\n/**\n * Sets the interval of the timer.\n * @param {number} interval Number of ms between ticks.\n */\ngoog.Timer.prototype.setInterval = function(interval) {\n  this.interval_ = interval;\n  if (this.timer_ && this.enabled) {\n    // Stop and then start the timer to reset the interval.\n    this.stop();\n    this.start();\n  } else if (this.timer_) {\n    this.stop();\n  }\n};\n\n\n/**\n * Callback for the `setTimeout` used by the timer.\n * @private\n */\ngoog.Timer.prototype.tick_ = function() {\n  if (this.enabled) {\n    var elapsed = goog.now() - this.last_;\n    if (elapsed > 0 && elapsed < this.interval_ * goog.Timer.intervalScale) {\n      this.timer_ = this.timerObject_.setTimeout(\n          this.boundTick_, this.interval_ - elapsed);\n      return;\n    }\n\n    // Prevents setInterval from registering a duplicate timeout when called\n    // in the timer event handler.\n    if (this.timer_) {\n      this.timerObject_.clearTimeout(this.timer_);\n      this.timer_ = null;\n    }\n\n    this.dispatchTick();\n    // The timer could be stopped in the timer event handler.\n    if (this.enabled) {\n      // Stop and start to ensure there is always only one timeout even if\n      // start is called in the timer event handler.\n      this.stop();\n      this.start();\n    }\n  }\n};\n\n\n/**\n * Dispatches the TICK event. This is its own method so subclasses can override.\n */\ngoog.Timer.prototype.dispatchTick = function() {\n  this.dispatchEvent(goog.Timer.TICK);\n};\n\n\n/**\n * Starts the timer.\n */\ngoog.Timer.prototype.start = function() {\n  this.enabled = true;\n\n  // If there is no interval already registered, start it now\n  if (!this.timer_) {\n    // IMPORTANT!\n    // window.setInterval in FireFox has a bug - it fires based on\n    // absolute time, rather than on relative time. What this means\n    // is that if a computer is sleeping/hibernating for 24 hours\n    // and the timer interval was configured to fire every 1000ms,\n    // then after the PC wakes up the timer will fire, in rapid\n    // succession, 3600*24 times.\n    // This bug is described here and is already fixed, but it will\n    // take time to propagate, so for now I am switching this over\n    // to setTimeout logic.\n    //     https://bugzilla.mozilla.org/show_bug.cgi?id=376643\n    //\n    this.timer_ = this.timerObject_.setTimeout(this.boundTick_, this.interval_);\n    this.last_ = goog.now();\n  }\n};\n\n\n/**\n * Stops the timer.\n */\ngoog.Timer.prototype.stop = function() {\n  this.enabled = false;\n  if (this.timer_) {\n    this.timerObject_.clearTimeout(this.timer_);\n    this.timer_ = null;\n  }\n};\n\n\n/** @override */\ngoog.Timer.prototype.disposeInternal = function() {\n  goog.Timer.superClass_.disposeInternal.call(this);\n  this.stop();\n  delete this.timerObject_;\n};\n\n\n/**\n * Constant for the timer's event type.\n * @const\n */\ngoog.Timer.TICK = 'tick';\n\n\n/**\n * Calls the given function once, after the optional pause.\n * <p>\n * The function is always called asynchronously, even if the delay is 0. This\n * is a common trick to schedule a function to run after a batch of browser\n * event processing.\n *\n * @param {function(this:SCOPE)|{handleEvent:function()}|null} listener Function\n *     or object that has a handleEvent method.\n * @param {number=} opt_delay Milliseconds to wait; default is 0.\n * @param {SCOPE=} opt_handler Object in whose scope to call the listener.\n * @return {number} A handle to the timer ID.\n * @template SCOPE\n */\ngoog.Timer.callOnce = function(listener, opt_delay, opt_handler) {\n  if (goog.isFunction(listener)) {\n    if (opt_handler) {\n      listener = goog.bind(listener, opt_handler);\n    }\n  } else if (listener && typeof listener.handleEvent == 'function') {\n    // using typeof to prevent strict js warning\n    listener = goog.bind(listener.handleEvent, listener);\n  } else {\n    throw new Error('Invalid listener argument');\n  }\n\n  if (Number(opt_delay) > goog.Timer.MAX_TIMEOUT_) {\n    // Timeouts greater than MAX_INT return immediately due to integer\n    // overflow in many browsers.  Since MAX_INT is 24.8 days, just don't\n    // schedule anything at all.\n    return goog.Timer.INVALID_TIMEOUT_ID_;\n  } else {\n    return goog.Timer.defaultTimerObject.setTimeout(listener, opt_delay || 0);\n  }\n};\n\n\n/**\n * Clears a timeout initiated by {@link #callOnce}.\n * @param {?number} timerId A timer ID.\n */\ngoog.Timer.clear = function(timerId) {\n  goog.Timer.defaultTimerObject.clearTimeout(timerId);\n};\n\n\n/**\n * @param {number} delay Milliseconds to wait.\n * @param {(RESULT|goog.Thenable<RESULT>|Thenable)=} opt_result The value\n *     with which the promise will be resolved.\n * @return {!goog.Promise<RESULT>} A promise that will be resolved after\n *     the specified delay, unless it is canceled first.\n * @template RESULT\n */\ngoog.Timer.promise = function(delay, opt_result) {\n  var timerKey = null;\n  return new goog\n      .Promise(function(resolve, reject) {\n        timerKey =\n            goog.Timer.callOnce(function() { resolve(opt_result); }, delay);\n        if (timerKey == goog.Timer.INVALID_TIMEOUT_ID_) {\n          reject(new Error('Failed to schedule timer.'));\n        }\n      })\n      .thenCatch(function(error) {\n        // Clear the timer. The most likely reason is \"cancel\" signal.\n        goog.Timer.clear(timerKey);\n        throw error;\n      });\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Generics method for collection-like classes and objects.\n *\n * @author arv@google.com (Erik Arvidsson)\n *\n * This file contains functions to work with collections. It supports using\n * Map, Set, Array and Object and other classes that implement collection-like\n * methods.\n * @suppress {strictMissingProperties}\n */\n\n\ngoog.provide('goog.structs');\n\ngoog.require('goog.array');\ngoog.require('goog.object');\n\n\n// We treat an object as a dictionary if it has getKeys or it is an object that\n// isn't arrayLike.\n\n\n/**\n * Returns the number of values in the collection-like object.\n * @param {Object} col The collection-like object.\n * @return {number} The number of values in the collection-like object.\n */\ngoog.structs.getCount = function(col) {\n  if (col.getCount && typeof col.getCount == 'function') {\n    return col.getCount();\n  }\n  if (goog.isArrayLike(col) || goog.isString(col)) {\n    return col.length;\n  }\n  return goog.object.getCount(col);\n};\n\n\n/**\n * Returns the values of the collection-like object.\n * @param {Object} col The collection-like object.\n * @return {!Array<?>} The values in the collection-like object.\n */\ngoog.structs.getValues = function(col) {\n  if (col.getValues && typeof col.getValues == 'function') {\n    return col.getValues();\n  }\n  if (goog.isString(col)) {\n    return col.split('');\n  }\n  if (goog.isArrayLike(col)) {\n    var rv = [];\n    var l = col.length;\n    for (var i = 0; i < l; i++) {\n      rv.push(col[i]);\n    }\n    return rv;\n  }\n  return goog.object.getValues(col);\n};\n\n\n/**\n * Returns the keys of the collection. Some collections have no notion of\n * keys/indexes and this function will return undefined in those cases.\n * @param {Object} col The collection-like object.\n * @return {!Array|undefined} The keys in the collection.\n */\ngoog.structs.getKeys = function(col) {\n  if (col.getKeys && typeof col.getKeys == 'function') {\n    return col.getKeys();\n  }\n  // if we have getValues but no getKeys we know this is a key-less collection\n  if (col.getValues && typeof col.getValues == 'function') {\n    return undefined;\n  }\n  if (goog.isArrayLike(col) || goog.isString(col)) {\n    var rv = [];\n    var l = col.length;\n    for (var i = 0; i < l; i++) {\n      rv.push(i);\n    }\n    return rv;\n  }\n\n  return goog.object.getKeys(col);\n};\n\n\n/**\n * Whether the collection contains the given value. This is O(n) and uses\n * equals (==) to test the existence.\n * @param {Object} col The collection-like object.\n * @param {*} val The value to check for.\n * @return {boolean} True if the map contains the value.\n */\ngoog.structs.contains = function(col, val) {\n  if (col.contains && typeof col.contains == 'function') {\n    return col.contains(val);\n  }\n  if (col.containsValue && typeof col.containsValue == 'function') {\n    return col.containsValue(val);\n  }\n  if (goog.isArrayLike(col) || goog.isString(col)) {\n    return goog.array.contains(/** @type {!Array<?>} */ (col), val);\n  }\n  return goog.object.containsValue(col, val);\n};\n\n\n/**\n * Whether the collection is empty.\n * @param {Object} col The collection-like object.\n * @return {boolean} True if empty.\n */\ngoog.structs.isEmpty = function(col) {\n  if (col.isEmpty && typeof col.isEmpty == 'function') {\n    return col.isEmpty();\n  }\n\n  // We do not use goog.string.isEmptyOrWhitespace because here we treat the\n  // string as\n  // collection and as such even whitespace matters\n\n  if (goog.isArrayLike(col) || goog.isString(col)) {\n    return goog.array.isEmpty(/** @type {!Array<?>} */ (col));\n  }\n  return goog.object.isEmpty(col);\n};\n\n\n/**\n * Removes all the elements from the collection.\n * @param {Object} col The collection-like object.\n */\ngoog.structs.clear = function(col) {\n  // NOTE(arv): This should not contain strings because strings are immutable\n  if (col.clear && typeof col.clear == 'function') {\n    col.clear();\n  } else if (goog.isArrayLike(col)) {\n    goog.array.clear(/** @type {IArrayLike<?>} */ (col));\n  } else {\n    goog.object.clear(col);\n  }\n};\n\n\n/**\n * Calls a function for each value in a collection. The function takes\n * three arguments; the value, the key and the collection.\n *\n * @param {S} col The collection-like object.\n * @param {function(this:T,?,?,S):?} f The function to call for every value.\n *     This function takes\n *     3 arguments (the value, the key or undefined if the collection has no\n *     notion of keys, and the collection) and the return value is irrelevant.\n * @param {T=} opt_obj The object to be used as the value of 'this'\n *     within `f`.\n * @template T,S\n * @deprecated Use a more specific method, e.g. goog.array.forEach,\n *     goog.object.forEach, or for-of.\n */\ngoog.structs.forEach = function(col, f, opt_obj) {\n  if (col.forEach && typeof col.forEach == 'function') {\n    col.forEach(f, opt_obj);\n  } else if (goog.isArrayLike(col) || goog.isString(col)) {\n    goog.array.forEach(/** @type {!Array<?>} */ (col), f, opt_obj);\n  } else {\n    var keys = goog.structs.getKeys(col);\n    var values = goog.structs.getValues(col);\n    var l = values.length;\n    for (var i = 0; i < l; i++) {\n      f.call(/** @type {?} */ (opt_obj), values[i], keys && keys[i], col);\n    }\n  }\n};\n\n\n/**\n * Calls a function for every value in the collection. When a call returns true,\n * adds the value to a new collection (Array is returned by default).\n *\n * @param {S} col The collection-like object.\n * @param {function(this:T,?,?,S):boolean} f The function to call for every\n *     value. This function takes\n *     3 arguments (the value, the key or undefined if the collection has no\n *     notion of keys, and the collection) and should return a Boolean. If the\n *     return value is true the value is added to the result collection. If it\n *     is false the value is not included.\n * @param {T=} opt_obj The object to be used as the value of 'this'\n *     within `f`.\n * @return {!Object|!Array<?>} A new collection where the passed values are\n *     present. If col is a key-less collection an array is returned.  If col\n *     has keys and values a plain old JS object is returned.\n * @template T,S\n */\ngoog.structs.filter = function(col, f, opt_obj) {\n  if (typeof col.filter == 'function') {\n    return col.filter(f, opt_obj);\n  }\n  if (goog.isArrayLike(col) || goog.isString(col)) {\n    return goog.array.filter(/** @type {!Array<?>} */ (col), f, opt_obj);\n  }\n\n  var rv;\n  var keys = goog.structs.getKeys(col);\n  var values = goog.structs.getValues(col);\n  var l = values.length;\n  if (keys) {\n    rv = {};\n    for (var i = 0; i < l; i++) {\n      if (f.call(/** @type {?} */ (opt_obj), values[i], keys[i], col)) {\n        rv[keys[i]] = values[i];\n      }\n    }\n  } else {\n    // We should not use goog.array.filter here since we want to make sure that\n    // the index is undefined as well as make sure that col is passed to the\n    // function.\n    rv = [];\n    for (var i = 0; i < l; i++) {\n      if (f.call(opt_obj, values[i], undefined, col)) {\n        rv.push(values[i]);\n      }\n    }\n  }\n  return rv;\n};\n\n\n/**\n * Calls a function for every value in the collection and adds the result into a\n * new collection (defaults to creating a new Array).\n *\n * @param {S} col The collection-like object.\n * @param {function(this:T,?,?,S):V} f The function to call for every value.\n *     This function takes 3 arguments (the value, the key or undefined if the\n *     collection has no notion of keys, and the collection) and should return\n *     something. The result will be used as the value in the new collection.\n * @param {T=} opt_obj  The object to be used as the value of 'this'\n *     within `f`.\n * @return {!Object<V>|!Array<V>} A new collection with the new values.  If\n *     col is a key-less collection an array is returned.  If col has keys and\n *     values a plain old JS object is returned.\n * @template T,S,V\n */\ngoog.structs.map = function(col, f, opt_obj) {\n  if (typeof col.map == 'function') {\n    return col.map(f, opt_obj);\n  }\n  if (goog.isArrayLike(col) || goog.isString(col)) {\n    return goog.array.map(/** @type {!Array<?>} */ (col), f, opt_obj);\n  }\n\n  var rv;\n  var keys = goog.structs.getKeys(col);\n  var values = goog.structs.getValues(col);\n  var l = values.length;\n  if (keys) {\n    rv = {};\n    for (var i = 0; i < l; i++) {\n      rv[keys[i]] = f.call(/** @type {?} */ (opt_obj), values[i], keys[i], col);\n    }\n  } else {\n    // We should not use goog.array.map here since we want to make sure that\n    // the index is undefined as well as make sure that col is passed to the\n    // function.\n    rv = [];\n    for (var i = 0; i < l; i++) {\n      rv[i] = f.call(/** @type {?} */ (opt_obj), values[i], undefined, col);\n    }\n  }\n  return rv;\n};\n\n\n/**\n * Calls f for each value in a collection. If any call returns true this returns\n * true (without checking the rest). If all returns false this returns false.\n *\n * @param {S} col The collection-like object.\n * @param {function(this:T,?,?,S):boolean} f The function to call for every\n *     value. This function takes 3 arguments (the value, the key or undefined\n *     if the collection has no notion of keys, and the collection) and should\n *     return a boolean.\n * @param {T=} opt_obj  The object to be used as the value of 'this'\n *     within `f`.\n * @return {boolean} True if any value passes the test.\n * @template T,S\n */\ngoog.structs.some = function(col, f, opt_obj) {\n  if (typeof col.some == 'function') {\n    return col.some(f, opt_obj);\n  }\n  if (goog.isArrayLike(col) || goog.isString(col)) {\n    return goog.array.some(/** @type {!Array<?>} */ (col), f, opt_obj);\n  }\n  var keys = goog.structs.getKeys(col);\n  var values = goog.structs.getValues(col);\n  var l = values.length;\n  for (var i = 0; i < l; i++) {\n    if (f.call(/** @type {?} */ (opt_obj), values[i], keys && keys[i], col)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * Calls f for each value in a collection. If all calls return true this return\n * true this returns true. If any returns false this returns false at this point\n *  and does not continue to check the remaining values.\n *\n * @param {S} col The collection-like object.\n * @param {function(this:T,?,?,S):boolean} f The function to call for every\n *     value. This function takes 3 arguments (the value, the key or\n *     undefined if the collection has no notion of keys, and the collection)\n *     and should return a boolean.\n * @param {T=} opt_obj  The object to be used as the value of 'this'\n *     within `f`.\n * @return {boolean} True if all key-value pairs pass the test.\n * @template T,S\n */\ngoog.structs.every = function(col, f, opt_obj) {\n  if (typeof col.every == 'function') {\n    return col.every(f, opt_obj);\n  }\n  if (goog.isArrayLike(col) || goog.isString(col)) {\n    return goog.array.every(/** @type {!Array<?>} */ (col), f, opt_obj);\n  }\n  var keys = goog.structs.getKeys(col);\n  var values = goog.structs.getValues(col);\n  var l = values.length;\n  for (var i = 0; i < l; i++) {\n    if (!f.call(/** @type {?} */ (opt_obj), values[i], keys && keys[i], col)) {\n      return false;\n    }\n  }\n  return true;\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Datastructure: Hash Map.\n *\n * @author arv@google.com (Erik Arvidsson)\n *\n * This file contains an implementation of a Map structure. It implements a lot\n * of the methods used in goog.structs so those functions work on hashes. This\n * is best suited for complex key types. For simple keys such as numbers and\n * strings consider using the lighter-weight utilities in goog.object.\n */\n\n\ngoog.provide('goog.structs.Map');\n\ngoog.require('goog.iter.Iterator');\ngoog.require('goog.iter.StopIteration');\n\n\n\n/**\n * Class for Hash Map datastructure.\n * @param {*=} opt_map Map or Object to initialize the map with.\n * @param {...*} var_args If 2 or more arguments are present then they\n *     will be used as key-value pairs.\n * @constructor\n * @template K, V\n * @deprecated This type is misleading: use ES6 Map instead.\n */\ngoog.structs.Map = function(opt_map, var_args) {\n\n  /**\n   * Underlying JS object used to implement the map.\n   * @private {!Object}\n   */\n  this.map_ = {};\n\n  /**\n   * An array of keys. This is necessary for two reasons:\n   *   1. Iterating the keys using for (var key in this.map_) allocates an\n   *      object for every key in IE which is really bad for IE6 GC perf.\n   *   2. Without a side data structure, we would need to escape all the keys\n   *      as that would be the only way we could tell during iteration if the\n   *      key was an internal key or a property of the object.\n   *\n   * This array can contain deleted keys so it's necessary to check the map\n   * as well to see if the key is still in the map (this doesn't require a\n   * memory allocation in IE).\n   * @private {!Array<string>}\n   */\n  this.keys_ = [];\n\n  /**\n   * The number of key value pairs in the map.\n   * @private {number}\n   */\n  this.count_ = 0;\n\n  /**\n   * Version used to detect changes while iterating.\n   * @private {number}\n   */\n  this.version_ = 0;\n\n  var argLength = arguments.length;\n\n  if (argLength > 1) {\n    if (argLength % 2) {\n      throw new Error('Uneven number of arguments');\n    }\n    for (var i = 0; i < argLength; i += 2) {\n      this.set(arguments[i], arguments[i + 1]);\n    }\n  } else if (opt_map) {\n    this.addAll(/** @type {!Object} */ (opt_map));\n  }\n};\n\n\n/**\n * @return {number} The number of key-value pairs in the map.\n */\ngoog.structs.Map.prototype.getCount = function() {\n  return this.count_;\n};\n\n\n/**\n * Returns the values of the map.\n * @return {!Array<V>} The values in the map.\n */\ngoog.structs.Map.prototype.getValues = function() {\n  this.cleanupKeysArray_();\n\n  var rv = [];\n  for (var i = 0; i < this.keys_.length; i++) {\n    var key = this.keys_[i];\n    rv.push(this.map_[key]);\n  }\n  return rv;\n};\n\n\n/**\n * Returns the keys of the map.\n * @return {!Array<string>} Array of string values.\n */\ngoog.structs.Map.prototype.getKeys = function() {\n  this.cleanupKeysArray_();\n  return /** @type {!Array<string>} */ (this.keys_.concat());\n};\n\n\n/**\n * Whether the map contains the given key.\n * @param {*} key The key to check for.\n * @return {boolean} Whether the map contains the key.\n */\ngoog.structs.Map.prototype.containsKey = function(key) {\n  return goog.structs.Map.hasKey_(this.map_, key);\n};\n\n\n/**\n * Whether the map contains the given value. This is O(n).\n * @param {V} val The value to check for.\n * @return {boolean} Whether the map contains the value.\n */\ngoog.structs.Map.prototype.containsValue = function(val) {\n  for (var i = 0; i < this.keys_.length; i++) {\n    var key = this.keys_[i];\n    if (goog.structs.Map.hasKey_(this.map_, key) && this.map_[key] == val) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * Whether this map is equal to the argument map.\n * @param {goog.structs.Map} otherMap The map against which to test equality.\n * @param {function(V, V): boolean=} opt_equalityFn Optional equality function\n *     to test equality of values. If not specified, this will test whether\n *     the values contained in each map are identical objects.\n * @return {boolean} Whether the maps are equal.\n */\ngoog.structs.Map.prototype.equals = function(otherMap, opt_equalityFn) {\n  if (this === otherMap) {\n    return true;\n  }\n\n  if (this.count_ != otherMap.getCount()) {\n    return false;\n  }\n\n  var equalityFn = opt_equalityFn || goog.structs.Map.defaultEquals;\n\n  this.cleanupKeysArray_();\n  for (var key, i = 0; key = this.keys_[i]; i++) {\n    if (!equalityFn(this.get(key), otherMap.get(key))) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\n\n/**\n * Default equality test for values.\n * @param {*} a The first value.\n * @param {*} b The second value.\n * @return {boolean} Whether a and b reference the same object.\n */\ngoog.structs.Map.defaultEquals = function(a, b) {\n  return a === b;\n};\n\n\n/**\n * @return {boolean} Whether the map is empty.\n */\ngoog.structs.Map.prototype.isEmpty = function() {\n  return this.count_ == 0;\n};\n\n\n/**\n * Removes all key-value pairs from the map.\n */\ngoog.structs.Map.prototype.clear = function() {\n  this.map_ = {};\n  this.keys_.length = 0;\n  this.count_ = 0;\n  this.version_ = 0;\n};\n\n\n/**\n * Removes a key-value pair based on the key. This is O(logN) amortized due to\n * updating the keys array whenever the count becomes half the size of the keys\n * in the keys array.\n * @param {*} key  The key to remove.\n * @return {boolean} Whether object was removed.\n */\ngoog.structs.Map.prototype.remove = function(key) {\n  if (goog.structs.Map.hasKey_(this.map_, key)) {\n    delete this.map_[key];\n    this.count_--;\n    this.version_++;\n\n    // clean up the keys array if the threshold is hit\n    if (this.keys_.length > 2 * this.count_) {\n      this.cleanupKeysArray_();\n    }\n\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * Cleans up the temp keys array by removing entries that are no longer in the\n * map.\n * @private\n */\ngoog.structs.Map.prototype.cleanupKeysArray_ = function() {\n  if (this.count_ != this.keys_.length) {\n    // First remove keys that are no longer in the map.\n    var srcIndex = 0;\n    var destIndex = 0;\n    while (srcIndex < this.keys_.length) {\n      var key = this.keys_[srcIndex];\n      if (goog.structs.Map.hasKey_(this.map_, key)) {\n        this.keys_[destIndex++] = key;\n      }\n      srcIndex++;\n    }\n    this.keys_.length = destIndex;\n  }\n\n  if (this.count_ != this.keys_.length) {\n    // If the count still isn't correct, that means we have duplicates. This can\n    // happen when the same key is added and removed multiple times. Now we have\n    // to allocate one extra Object to remove the duplicates. This could have\n    // been done in the first pass, but in the common case, we can avoid\n    // allocating an extra object by only doing this when necessary.\n    var seen = {};\n    var srcIndex = 0;\n    var destIndex = 0;\n    while (srcIndex < this.keys_.length) {\n      var key = this.keys_[srcIndex];\n      if (!(goog.structs.Map.hasKey_(seen, key))) {\n        this.keys_[destIndex++] = key;\n        seen[key] = 1;\n      }\n      srcIndex++;\n    }\n    this.keys_.length = destIndex;\n  }\n};\n\n\n/**\n * Returns the value for the given key.  If the key is not found and the default\n * value is not given this will return `undefined`.\n * @param {*} key The key to get the value for.\n * @param {DEFAULT=} opt_val The value to return if no item is found for the\n *     given key, defaults to undefined.\n * @return {V|DEFAULT} The value for the given key.\n * @template DEFAULT\n */\ngoog.structs.Map.prototype.get = function(key, opt_val) {\n  if (goog.structs.Map.hasKey_(this.map_, key)) {\n    return this.map_[key];\n  }\n  return opt_val;\n};\n\n\n/**\n * Adds a key-value pair to the map.\n * @param {*} key The key.\n * @param {V} value The value to add.\n * @return {*} Some subclasses return a value.\n */\ngoog.structs.Map.prototype.set = function(key, value) {\n  if (!(goog.structs.Map.hasKey_(this.map_, key))) {\n    this.count_++;\n    // TODO(johnlenz): This class lies, it claims to return an array of string\n    // keys, but instead returns the original object used.\n    this.keys_.push(/** @type {?} */ (key));\n    // Only change the version if we add a new key.\n    this.version_++;\n  }\n  this.map_[key] = value;\n};\n\n\n/**\n * Adds multiple key-value pairs from another goog.structs.Map or Object.\n * @param {?Object} map Object containing the data to add.\n */\ngoog.structs.Map.prototype.addAll = function(map) {\n  if (map instanceof goog.structs.Map) {\n    var keys = map.getKeys();\n    for (var i = 0; i < keys.length; i++) {\n      this.set(keys[i], map.get(keys[i]));\n    }\n  } else {\n    for (var key in map) {\n      this.set(key, map[key]);\n    }\n  }\n};\n\n\n/**\n * Calls the given function on each entry in the map.\n * @param {function(this:T, V, K, goog.structs.Map<K,V>)} f\n * @param {T=} opt_obj The value of \"this\" inside f.\n * @template T\n */\ngoog.structs.Map.prototype.forEach = function(f, opt_obj) {\n  var keys = this.getKeys();\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = this.get(key);\n    f.call(opt_obj, value, key, this);\n  }\n};\n\n\n/**\n * Clones a map and returns a new map.\n * @return {!goog.structs.Map} A new map with the same key-value pairs.\n */\ngoog.structs.Map.prototype.clone = function() {\n  return new goog.structs.Map(this);\n};\n\n\n/**\n * Returns a new map in which all the keys and values are interchanged\n * (keys become values and values become keys). If multiple keys map to the\n * same value, the chosen transposed value is implementation-dependent.\n *\n * It acts very similarly to {goog.object.transpose(Object)}.\n *\n * @return {!goog.structs.Map} The transposed map.\n */\ngoog.structs.Map.prototype.transpose = function() {\n  var transposed = new goog.structs.Map();\n  for (var i = 0; i < this.keys_.length; i++) {\n    var key = this.keys_[i];\n    var value = this.map_[key];\n    transposed.set(value, key);\n  }\n\n  return transposed;\n};\n\n\n/**\n * @return {!Object} Object representation of the map.\n */\ngoog.structs.Map.prototype.toObject = function() {\n  this.cleanupKeysArray_();\n  var obj = {};\n  for (var i = 0; i < this.keys_.length; i++) {\n    var key = this.keys_[i];\n    obj[key] = this.map_[key];\n  }\n  return obj;\n};\n\n\n/**\n * Returns an iterator that iterates over the keys in the map.  Removal of keys\n * while iterating might have undesired side effects.\n * @return {!goog.iter.Iterator} An iterator over the keys in the map.\n */\ngoog.structs.Map.prototype.getKeyIterator = function() {\n  return this.__iterator__(true);\n};\n\n\n/**\n * Returns an iterator that iterates over the values in the map.  Removal of\n * keys while iterating might have undesired side effects.\n * @return {!goog.iter.Iterator} An iterator over the values in the map.\n */\ngoog.structs.Map.prototype.getValueIterator = function() {\n  return this.__iterator__(false);\n};\n\n\n/**\n * Returns an iterator that iterates over the values or the keys in the map.\n * This throws an exception if the map was mutated since the iterator was\n * created.\n * @param {boolean=} opt_keys True to iterate over the keys. False to iterate\n *     over the values.  The default value is false.\n * @return {!goog.iter.Iterator} An iterator over the values or keys in the map.\n */\ngoog.structs.Map.prototype.__iterator__ = function(opt_keys) {\n  // Clean up keys to minimize the risk of iterating over dead keys.\n  this.cleanupKeysArray_();\n\n  var i = 0;\n  var version = this.version_;\n  var selfObj = this;\n\n  var newIter = new goog.iter.Iterator;\n  newIter.next = function() {\n    if (version != selfObj.version_) {\n      throw new Error('The map has changed since the iterator was created');\n    }\n    if (i >= selfObj.keys_.length) {\n      throw goog.iter.StopIteration;\n    }\n    var key = selfObj.keys_[i++];\n    return opt_keys ? key : selfObj.map_[key];\n  };\n  return newIter;\n};\n\n\n/**\n * Safe way to test for hasOwnProperty.  It even allows testing for\n * 'hasOwnProperty'.\n * @param {!Object} obj The object to test for presence of the given key.\n * @param {*} key The key to check for.\n * @return {boolean} Whether the object has the key.\n * @private\n */\ngoog.structs.Map.hasKey_ = function(obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n};\n","// Copyright 2008 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Simple utilities for dealing with URI strings.\n *\n * This is intended to be a lightweight alternative to constructing goog.Uri\n * objects.  Whereas goog.Uri adds several kilobytes to the binary regardless\n * of how much of its functionality you use, this is designed to be a set of\n * mostly-independent utilities so that the compiler includes only what is\n * necessary for the task.  Estimated savings of porting is 5k pre-gzip and\n * 1.5k post-gzip.  To ensure the savings remain, future developers should\n * avoid adding new functionality to existing functions, but instead create\n * new ones and factor out shared code.\n *\n * Many of these utilities have limited functionality, tailored to common\n * cases.  The query parameter utilities assume that the parameter keys are\n * already encoded, since most keys are compile-time alphanumeric strings.  The\n * query parameter mutation utilities also do not tolerate fragment identifiers.\n *\n * By design, these functions can be slower than goog.Uri equivalents.\n * Repeated calls to some of functions may be quadratic in behavior for IE,\n * although the effect is somewhat limited given the 2kb limit.\n *\n * One advantage of the limited functionality here is that this approach is\n * less sensitive to differences in URI encodings than goog.Uri, since these\n * functions operate on strings directly, rather than decoding them and\n * then re-encoding.\n *\n * Uses features of RFC 3986 for parsing/formatting URIs:\n *   http://www.ietf.org/rfc/rfc3986.txt\n *\n * @author gboyer@google.com (Garrett Boyer) - The \"lightened\" design.\n * @author msamuel@google.com (Mike Samuel) - Domain knowledge and regexes.\n */\n\ngoog.provide('goog.uri.utils');\ngoog.provide('goog.uri.utils.ComponentIndex');\ngoog.provide('goog.uri.utils.QueryArray');\ngoog.provide('goog.uri.utils.QueryValue');\ngoog.provide('goog.uri.utils.StandardQueryParam');\n\ngoog.require('goog.array');\ngoog.require('goog.asserts');\ngoog.require('goog.string');\n\n\n/**\n * Character codes inlined to avoid object allocations due to charCode.\n * @enum {number}\n * @private\n */\ngoog.uri.utils.CharCode_ = {\n  AMPERSAND: 38,\n  EQUAL: 61,\n  HASH: 35,\n  QUESTION: 63\n};\n\n\n/**\n * Builds a URI string from already-encoded parts.\n *\n * No encoding is performed.  Any component may be omitted as either null or\n * undefined.\n *\n * @param {?string=} opt_scheme The scheme such as 'http'.\n * @param {?string=} opt_userInfo The user name before the '@'.\n * @param {?string=} opt_domain The domain such as 'www.google.com', already\n *     URI-encoded.\n * @param {(string|number|null)=} opt_port The port number.\n * @param {?string=} opt_path The path, already URI-encoded.  If it is not\n *     empty, it must begin with a slash.\n * @param {?string=} opt_queryData The URI-encoded query data.\n * @param {?string=} opt_fragment The URI-encoded fragment identifier.\n * @return {string} The fully combined URI.\n */\ngoog.uri.utils.buildFromEncodedParts = function(\n    opt_scheme, opt_userInfo, opt_domain, opt_port, opt_path, opt_queryData,\n    opt_fragment) {\n  var out = '';\n\n  if (opt_scheme) {\n    out += opt_scheme + ':';\n  }\n\n  if (opt_domain) {\n    out += '//';\n\n    if (opt_userInfo) {\n      out += opt_userInfo + '@';\n    }\n\n    out += opt_domain;\n\n    if (opt_port) {\n      out += ':' + opt_port;\n    }\n  }\n\n  if (opt_path) {\n    out += opt_path;\n  }\n\n  if (opt_queryData) {\n    out += '?' + opt_queryData;\n  }\n\n  if (opt_fragment) {\n    out += '#' + opt_fragment;\n  }\n\n  return out;\n};\n\n\n/**\n * A regular expression for breaking a URI into its component parts.\n *\n * {@link http://www.ietf.org/rfc/rfc3986.txt} says in Appendix B\n * As the \"first-match-wins\" algorithm is identical to the \"greedy\"\n * disambiguation method used by POSIX regular expressions, it is natural and\n * commonplace to use a regular expression for parsing the potential five\n * components of a URI reference.\n *\n * The following line is the regular expression for breaking-down a\n * well-formed URI reference into its components.\n *\n * <pre>\n * ^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?\n *  12            3  4          5       6  7        8 9\n * </pre>\n *\n * The numbers in the second line above are only to assist readability; they\n * indicate the reference points for each subexpression (i.e., each paired\n * parenthesis). We refer to the value matched for subexpression <n> as $<n>.\n * For example, matching the above expression to\n * <pre>\n *     http://www.ics.uci.edu/pub/ietf/uri/#Related\n * </pre>\n * results in the following subexpression matches:\n * <pre>\n *    $1 = http:\n *    $2 = http\n *    $3 = //www.ics.uci.edu\n *    $4 = www.ics.uci.edu\n *    $5 = /pub/ietf/uri/\n *    $6 = <undefined>\n *    $7 = <undefined>\n *    $8 = #Related\n *    $9 = Related\n * </pre>\n * where <undefined> indicates that the component is not present, as is the\n * case for the query component in the above example. Therefore, we can\n * determine the value of the five components as\n * <pre>\n *    scheme    = $2\n *    authority = $4\n *    path      = $5\n *    query     = $7\n *    fragment  = $9\n * </pre>\n *\n * The regular expression has been modified slightly to expose the\n * userInfo, domain, and port separately from the authority.\n * The modified version yields\n * <pre>\n *    $1 = http              scheme\n *    $2 = <undefined>       userInfo -\\\n *    $3 = www.ics.uci.edu   domain     | authority\n *    $4 = <undefined>       port     -/\n *    $5 = /pub/ietf/uri/    path\n *    $6 = <undefined>       query without ?\n *    $7 = Related           fragment without #\n * </pre>\n * @type {!RegExp}\n * @private\n */\ngoog.uri.utils.splitRe_ = new RegExp(\n    '^' +\n    '(?:' +\n    '([^:/?#.]+)' +  // scheme - ignore special characters\n                     // used by other URL parts such as :,\n                     // ?, /, #, and .\n    ':)?' +\n    '(?://' +\n    '(?:([^/?#]*)@)?' +  // userInfo\n    '([^/#?]*?)' +       // domain\n    '(?::([0-9]+))?' +   // port\n    '(?=[/#?]|$)' +      // authority-terminating character\n    ')?' +\n    '([^?#]+)?' +          // path\n    '(?:\\\\?([^#]*))?' +    // query\n    '(?:#([\\\\s\\\\S]*))?' +  // fragment\n    '$');\n\n\n/**\n * The index of each URI component in the return value of goog.uri.utils.split.\n * @enum {number}\n */\ngoog.uri.utils.ComponentIndex = {\n  SCHEME: 1,\n  USER_INFO: 2,\n  DOMAIN: 3,\n  PORT: 4,\n  PATH: 5,\n  QUERY_DATA: 6,\n  FRAGMENT: 7\n};\n\n\n/**\n * Splits a URI into its component parts.\n *\n * Each component can be accessed via the component indices; for example:\n * <pre>\n * goog.uri.utils.split(someStr)[goog.uri.utils.ComponentIndex.QUERY_DATA];\n * </pre>\n *\n * @param {string} uri The URI string to examine.\n * @return {!Array<string|undefined>} Each component still URI-encoded.\n *     Each component that is present will contain the encoded value, whereas\n *     components that are not present will be undefined or empty, depending\n *     on the browser's regular expression implementation.  Never null, since\n *     arbitrary strings may still look like path names.\n */\ngoog.uri.utils.split = function(uri) {\n  // See @return comment -- never null.\n  return /** @type {!Array<string|undefined>} */ (\n      uri.match(goog.uri.utils.splitRe_));\n};\n\n\n/**\n * @param {?string} uri A possibly null string.\n * @param {boolean=} opt_preserveReserved If true, percent-encoding of RFC-3986\n *     reserved characters will not be removed.\n * @return {?string} The string URI-decoded, or null if uri is null.\n * @private\n */\ngoog.uri.utils.decodeIfPossible_ = function(uri, opt_preserveReserved) {\n  if (!uri) {\n    return uri;\n  }\n\n  return opt_preserveReserved ? decodeURI(uri) : decodeURIComponent(uri);\n};\n\n\n/**\n * Gets a URI component by index.\n *\n * It is preferred to use the getPathEncoded() variety of functions ahead,\n * since they are more readable.\n *\n * @param {goog.uri.utils.ComponentIndex} componentIndex The component index.\n * @param {string} uri The URI to examine.\n * @return {?string} The still-encoded component, or null if the component\n *     is not present.\n * @private\n */\ngoog.uri.utils.getComponentByIndex_ = function(componentIndex, uri) {\n  // Convert undefined, null, and empty string into null.\n  return goog.uri.utils.split(uri)[componentIndex] || null;\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The protocol or scheme, or null if none.  Does not\n *     include trailing colons or slashes.\n */\ngoog.uri.utils.getScheme = function(uri) {\n  return goog.uri.utils.getComponentByIndex_(\n      goog.uri.utils.ComponentIndex.SCHEME, uri);\n};\n\n\n/**\n * Gets the effective scheme for the URL.  If the URL is relative then the\n * scheme is derived from the page's location.\n * @param {string} uri The URI to examine.\n * @return {string} The protocol or scheme, always lower case.\n */\ngoog.uri.utils.getEffectiveScheme = function(uri) {\n  var scheme = goog.uri.utils.getScheme(uri);\n  if (!scheme && goog.global.self && goog.global.self.location) {\n    var protocol = goog.global.self.location.protocol;\n    scheme = protocol.substr(0, protocol.length - 1);\n  }\n  // NOTE: When called from a web worker in Firefox 3.5, location may be null.\n  // All other browsers with web workers support self.location from the worker.\n  return scheme ? scheme.toLowerCase() : '';\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The user name still encoded, or null if none.\n */\ngoog.uri.utils.getUserInfoEncoded = function(uri) {\n  return goog.uri.utils.getComponentByIndex_(\n      goog.uri.utils.ComponentIndex.USER_INFO, uri);\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The decoded user info, or null if none.\n */\ngoog.uri.utils.getUserInfo = function(uri) {\n  return goog.uri.utils.decodeIfPossible_(\n      goog.uri.utils.getUserInfoEncoded(uri));\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The domain name still encoded, or null if none.\n */\ngoog.uri.utils.getDomainEncoded = function(uri) {\n  return goog.uri.utils.getComponentByIndex_(\n      goog.uri.utils.ComponentIndex.DOMAIN, uri);\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The decoded domain, or null if none.\n */\ngoog.uri.utils.getDomain = function(uri) {\n  return goog.uri.utils.decodeIfPossible_(\n      goog.uri.utils.getDomainEncoded(uri), true /* opt_preserveReserved */);\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?number} The port number, or null if none.\n */\ngoog.uri.utils.getPort = function(uri) {\n  // Coerce to a number.  If the result of getComponentByIndex_ is null or\n  // non-numeric, the number coersion yields NaN.  This will then return\n  // null for all non-numeric cases (though also zero, which isn't a relevant\n  // port number).\n  return Number(\n             goog.uri.utils.getComponentByIndex_(\n                 goog.uri.utils.ComponentIndex.PORT, uri)) ||\n      null;\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The path still encoded, or null if none. Includes the\n *     leading slash, if any.\n */\ngoog.uri.utils.getPathEncoded = function(uri) {\n  return goog.uri.utils.getComponentByIndex_(\n      goog.uri.utils.ComponentIndex.PATH, uri);\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The decoded path, or null if none.  Includes the leading\n *     slash, if any.\n */\ngoog.uri.utils.getPath = function(uri) {\n  return goog.uri.utils.decodeIfPossible_(\n      goog.uri.utils.getPathEncoded(uri), true /* opt_preserveReserved */);\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The query data still encoded, or null if none.  Does not\n *     include the question mark itself.\n */\ngoog.uri.utils.getQueryData = function(uri) {\n  return goog.uri.utils.getComponentByIndex_(\n      goog.uri.utils.ComponentIndex.QUERY_DATA, uri);\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The fragment identifier, or null if none.  Does not\n *     include the hash mark itself.\n */\ngoog.uri.utils.getFragmentEncoded = function(uri) {\n  // The hash mark may not appear in any other part of the URL.\n  var hashIndex = uri.indexOf('#');\n  return hashIndex < 0 ? null : uri.substr(hashIndex + 1);\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @param {?string} fragment The encoded fragment identifier, or null if none.\n *     Does not include the hash mark itself.\n * @return {string} The URI with the fragment set.\n */\ngoog.uri.utils.setFragmentEncoded = function(uri, fragment) {\n  return goog.uri.utils.removeFragment(uri) + (fragment ? '#' + fragment : '');\n};\n\n\n/**\n * @param {string} uri The URI to examine.\n * @return {?string} The decoded fragment identifier, or null if none.  Does\n *     not include the hash mark.\n */\ngoog.uri.utils.getFragment = function(uri) {\n  return goog.uri.utils.decodeIfPossible_(\n      goog.uri.utils.getFragmentEncoded(uri));\n};\n\n\n/**\n * Extracts everything up to the port of the URI.\n * @param {string} uri The URI string.\n * @return {string} Everything up to and including the port.\n */\ngoog.uri.utils.getHost = function(uri) {\n  var pieces = goog.uri.utils.split(uri);\n  return goog.uri.utils.buildFromEncodedParts(\n      pieces[goog.uri.utils.ComponentIndex.SCHEME],\n      pieces[goog.uri.utils.ComponentIndex.USER_INFO],\n      pieces[goog.uri.utils.ComponentIndex.DOMAIN],\n      pieces[goog.uri.utils.ComponentIndex.PORT]);\n};\n\n\n/**\n * Returns the origin for a given URL.\n * @param {string} uri The URI string.\n * @return {string} Everything up to and including the port.\n */\ngoog.uri.utils.getOrigin = function(uri) {\n  var pieces = goog.uri.utils.split(uri);\n  return goog.uri.utils.buildFromEncodedParts(\n      pieces[goog.uri.utils.ComponentIndex.SCHEME], null /* opt_userInfo */,\n      pieces[goog.uri.utils.ComponentIndex.DOMAIN],\n      pieces[goog.uri.utils.ComponentIndex.PORT]);\n};\n\n\n/**\n * Extracts the path of the URL and everything after.\n * @param {string} uri The URI string.\n * @return {string} The URI, starting at the path and including the query\n *     parameters and fragment identifier.\n */\ngoog.uri.utils.getPathAndAfter = function(uri) {\n  var pieces = goog.uri.utils.split(uri);\n  return goog.uri.utils.buildFromEncodedParts(\n      null, null, null, null, pieces[goog.uri.utils.ComponentIndex.PATH],\n      pieces[goog.uri.utils.ComponentIndex.QUERY_DATA],\n      pieces[goog.uri.utils.ComponentIndex.FRAGMENT]);\n};\n\n\n/**\n * Gets the URI with the fragment identifier removed.\n * @param {string} uri The URI to examine.\n * @return {string} Everything preceding the hash mark.\n */\ngoog.uri.utils.removeFragment = function(uri) {\n  // The hash mark may not appear in any other part of the URL.\n  var hashIndex = uri.indexOf('#');\n  return hashIndex < 0 ? uri : uri.substr(0, hashIndex);\n};\n\n\n/**\n * Ensures that two URI's have the exact same domain, scheme, and port.\n *\n * Unlike the version in goog.Uri, this checks protocol, and therefore is\n * suitable for checking against the browser's same-origin policy.\n *\n * @param {string} uri1 The first URI.\n * @param {string} uri2 The second URI.\n * @return {boolean} Whether they have the same scheme, domain and port.\n */\ngoog.uri.utils.haveSameDomain = function(uri1, uri2) {\n  var pieces1 = goog.uri.utils.split(uri1);\n  var pieces2 = goog.uri.utils.split(uri2);\n  return pieces1[goog.uri.utils.ComponentIndex.DOMAIN] ==\n      pieces2[goog.uri.utils.ComponentIndex.DOMAIN] &&\n      pieces1[goog.uri.utils.ComponentIndex.SCHEME] ==\n      pieces2[goog.uri.utils.ComponentIndex.SCHEME] &&\n      pieces1[goog.uri.utils.ComponentIndex.PORT] ==\n      pieces2[goog.uri.utils.ComponentIndex.PORT];\n};\n\n\n/**\n * Asserts that there are no fragment or query identifiers, only in uncompiled\n * mode.\n * @param {string} uri The URI to examine.\n * @private\n */\ngoog.uri.utils.assertNoFragmentsOrQueries_ = function(uri) {\n  goog.asserts.assert(\n      uri.indexOf('#') < 0 && uri.indexOf('?') < 0,\n      'goog.uri.utils: Fragment or query identifiers are not supported: [%s]',\n      uri);\n};\n\n\n/**\n * Supported query parameter values by the parameter serializing utilities.\n *\n * If a value is null or undefined, the key-value pair is skipped, as an easy\n * way to omit parameters conditionally.  Non-array parameters are converted\n * to a string and URI encoded.  Array values are expanded into multiple\n * &key=value pairs, with each element stringized and URI-encoded.\n *\n * @typedef {*}\n */\ngoog.uri.utils.QueryValue;\n\n\n/**\n * An array representing a set of query parameters with alternating keys\n * and values.\n *\n * Keys are assumed to be URI encoded already and live at even indices.  See\n * goog.uri.utils.QueryValue for details on how parameter values are encoded.\n *\n * Example:\n * <pre>\n * var data = [\n *   // Simple param: ?name=BobBarker\n *   'name', 'BobBarker',\n *   // Conditional param -- may be omitted entirely.\n *   'specialDietaryNeeds', hasDietaryNeeds() ? getDietaryNeeds() : null,\n *   // Multi-valued param: &house=LosAngeles&house=NewYork&house=null\n *   'house', ['LosAngeles', 'NewYork', null]\n * ];\n * </pre>\n *\n * @typedef {!Array<string|goog.uri.utils.QueryValue>}\n */\ngoog.uri.utils.QueryArray;\n\n\n/**\n * Parses encoded query parameters and calls callback function for every\n * parameter found in the string.\n *\n * Missing value of parameter (e.g. &key&) is treated as if the value was an\n * empty string.  Keys may be empty strings (e.g. &=value&) which also means\n * that &=& and && will result in an empty key and value.\n *\n * @param {string} encodedQuery Encoded query string excluding question mark at\n *     the beginning.\n * @param {function(string, string)} callback Function called for every\n *     parameter found in query string.  The first argument (name) will not be\n *     urldecoded (so the function is consistent with buildQueryData), but the\n *     second will.  If the parameter has no value (i.e. = was not present)\n *     the second argument (value) will be an empty string.\n */\ngoog.uri.utils.parseQueryData = function(encodedQuery, callback) {\n  if (!encodedQuery) {\n    return;\n  }\n  var pairs = encodedQuery.split('&');\n  for (var i = 0; i < pairs.length; i++) {\n    var indexOfEquals = pairs[i].indexOf('=');\n    var name = null;\n    var value = null;\n    if (indexOfEquals >= 0) {\n      name = pairs[i].substring(0, indexOfEquals);\n      value = pairs[i].substring(indexOfEquals + 1);\n    } else {\n      name = pairs[i];\n    }\n    callback(name, value ? goog.string.urlDecode(value) : '');\n  }\n};\n\n\n/**\n * Split the URI into 3 parts where the [1] is the queryData without a leading\n * '?'. For example, the URI http://foo.com/bar?a=b#abc returns\n * ['http://foo.com/bar','a=b','#abc'].\n * @param {string} uri The URI to parse.\n * @return {!Array<string>} An array representation of uri of length 3 where the\n *     middle value is the queryData without a leading '?'.\n * @private\n */\ngoog.uri.utils.splitQueryData_ = function(uri) {\n  // Find the query data and hash.\n  var hashIndex = uri.indexOf('#');\n  if (hashIndex < 0) {\n    hashIndex = uri.length;\n  }\n  var questionIndex = uri.indexOf('?');\n  var queryData;\n  if (questionIndex < 0 || questionIndex > hashIndex) {\n    questionIndex = hashIndex;\n    queryData = '';\n  } else {\n    queryData = uri.substring(questionIndex + 1, hashIndex);\n  }\n  return [uri.substr(0, questionIndex), queryData, uri.substr(hashIndex)];\n};\n\n\n/**\n * Join an array created by splitQueryData_ back into a URI.\n * @param {!Array<string>} parts A URI in the form generated by splitQueryData_.\n * @return {string} The joined URI.\n * @private\n */\ngoog.uri.utils.joinQueryData_ = function(parts) {\n  return parts[0] + (parts[1] ? '?' + parts[1] : '') + parts[2];\n};\n\n\n/**\n * @param {string} queryData\n * @param {string} newData\n * @return {string}\n * @private\n */\ngoog.uri.utils.appendQueryData_ = function(queryData, newData) {\n  if (!newData) {\n    return queryData;\n  }\n  return queryData ? queryData + '&' + newData : newData;\n};\n\n\n/**\n * @param {string} uri\n * @param {string} queryData\n * @return {string}\n * @private\n */\ngoog.uri.utils.appendQueryDataToUri_ = function(uri, queryData) {\n  if (!queryData) {\n    return uri;\n  }\n  var parts = goog.uri.utils.splitQueryData_(uri);\n  parts[1] = goog.uri.utils.appendQueryData_(parts[1], queryData);\n  return goog.uri.utils.joinQueryData_(parts);\n};\n\n\n/**\n * Appends key=value pairs to an array, supporting multi-valued objects.\n * @param {*} key The key prefix.\n * @param {goog.uri.utils.QueryValue} value The value to serialize.\n * @param {!Array<string>} pairs The array to which the 'key=value' strings\n *     should be appended.\n * @private\n */\ngoog.uri.utils.appendKeyValuePairs_ = function(key, value, pairs) {\n  goog.asserts.assertString(key);\n  if (goog.isArray(value)) {\n    // Convince the compiler it's an array.\n    goog.asserts.assertArray(value);\n    for (var j = 0; j < value.length; j++) {\n      // Convert to string explicitly, to short circuit the null and array\n      // logic in this function -- this ensures that null and undefined get\n      // written as literal 'null' and 'undefined', and arrays don't get\n      // expanded out but instead encoded in the default way.\n      goog.uri.utils.appendKeyValuePairs_(key, String(value[j]), pairs);\n    }\n  } else if (value != null) {\n    // Skip a top-level null or undefined entirely.\n    pairs.push(\n        key +\n        // Check for empty string. Zero gets encoded into the url as literal\n        // strings.  For empty string, skip the equal sign, to be consistent\n        // with UriBuilder.java.\n        (value === '' ? '' : '=' + goog.string.urlEncode(value)));\n  }\n};\n\n\n/**\n * Builds a query data string from a sequence of alternating keys and values.\n * Currently generates \"&key&\" for empty args.\n *\n * @param {!IArrayLike<string|goog.uri.utils.QueryValue>} keysAndValues\n *     Alternating keys and values. See the QueryArray typedef.\n * @param {number=} opt_startIndex A start offset into the arary, defaults to 0.\n * @return {string} The encoded query string, in the form 'a=1&b=2'.\n */\ngoog.uri.utils.buildQueryData = function(keysAndValues, opt_startIndex) {\n  goog.asserts.assert(\n      Math.max(keysAndValues.length - (opt_startIndex || 0), 0) % 2 == 0,\n      'goog.uri.utils: Key/value lists must be even in length.');\n\n  var params = [];\n  for (var i = opt_startIndex || 0; i < keysAndValues.length; i += 2) {\n    var key = /** @type {string} */ (keysAndValues[i]);\n    goog.uri.utils.appendKeyValuePairs_(key, keysAndValues[i + 1], params);\n  }\n  return params.join('&');\n};\n\n\n/**\n * Builds a query data string from a map.\n * Currently generates \"&key&\" for empty args.\n *\n * @param {!Object<string, goog.uri.utils.QueryValue>} map An object where keys\n *     are URI-encoded parameter keys, and the values are arbitrary types\n *     or arrays. Keys with a null value are dropped.\n * @return {string} The encoded query string, in the form 'a=1&b=2'.\n */\ngoog.uri.utils.buildQueryDataFromMap = function(map) {\n  var params = [];\n  for (var key in map) {\n    goog.uri.utils.appendKeyValuePairs_(key, map[key], params);\n  }\n  return params.join('&');\n};\n\n\n/**\n * Appends URI parameters to an existing URI.\n *\n * The variable arguments may contain alternating keys and values.  Keys are\n * assumed to be already URI encoded.  The values should not be URI-encoded,\n * and will instead be encoded by this function.\n * <pre>\n * appendParams('http://www.foo.com?existing=true',\n *     'key1', 'value1',\n *     'key2', 'value?willBeEncoded',\n *     'key3', ['valueA', 'valueB', 'valueC'],\n *     'key4', null);\n * result: 'http://www.foo.com?existing=true&' +\n *     'key1=value1&' +\n *     'key2=value%3FwillBeEncoded&' +\n *     'key3=valueA&key3=valueB&key3=valueC'\n * </pre>\n *\n * A single call to this function will not exhibit quadratic behavior in IE,\n * whereas multiple repeated calls may, although the effect is limited by\n * fact that URL's generally can't exceed 2kb.\n *\n * @param {string} uri The original URI, which may already have query data.\n * @param {...(goog.uri.utils.QueryArray|goog.uri.utils.QueryValue)}\n * var_args\n *     An array or argument list conforming to goog.uri.utils.QueryArray.\n * @return {string} The URI with all query parameters added.\n */\ngoog.uri.utils.appendParams = function(uri, var_args) {\n  var queryData = arguments.length == 2 ?\n      goog.uri.utils.buildQueryData(arguments[1], 0) :\n      goog.uri.utils.buildQueryData(arguments, 1);\n  return goog.uri.utils.appendQueryDataToUri_(uri, queryData);\n};\n\n\n/**\n * Appends query parameters from a map.\n *\n * @param {string} uri The original URI, which may already have query data.\n * @param {!Object<goog.uri.utils.QueryValue>} map An object where keys are\n *     URI-encoded parameter keys, and the values are arbitrary types or arrays.\n *     Keys with a null value are dropped.\n * @return {string} The new parameters.\n */\ngoog.uri.utils.appendParamsFromMap = function(uri, map) {\n  var queryData = goog.uri.utils.buildQueryDataFromMap(map);\n  return goog.uri.utils.appendQueryDataToUri_(uri, queryData);\n};\n\n\n/**\n * Appends a single URI parameter.\n *\n * Repeated calls to this can exhibit quadratic behavior in IE6 due to the\n * way string append works, though it should be limited given the 2kb limit.\n *\n * @param {string} uri The original URI, which may already have query data.\n * @param {string} key The key, which must already be URI encoded.\n * @param {*=} opt_value The value, which will be stringized and encoded\n *     (assumed not already to be encoded).  If omitted, undefined, or null, the\n *     key will be added as a valueless parameter.\n * @return {string} The URI with the query parameter added.\n */\ngoog.uri.utils.appendParam = function(uri, key, opt_value) {\n  var value = goog.isDefAndNotNull(opt_value) ?\n      '=' + goog.string.urlEncode(opt_value) :\n      '';\n  return goog.uri.utils.appendQueryDataToUri_(uri, key + value);\n};\n\n\n/**\n * Finds the next instance of a query parameter with the specified name.\n *\n * Does not instantiate any objects.\n *\n * @param {string} uri The URI to search.  May contain a fragment identifier\n *     if opt_hashIndex is specified.\n * @param {number} startIndex The index to begin searching for the key at.  A\n *     match may be found even if this is one character after the ampersand.\n * @param {string} keyEncoded The URI-encoded key.\n * @param {number} hashOrEndIndex Index to stop looking at.  If a hash\n *     mark is present, it should be its index, otherwise it should be the\n *     length of the string.\n * @return {number} The position of the first character in the key's name,\n *     immediately after either a question mark or a dot.\n * @private\n */\ngoog.uri.utils.findParam_ = function(\n    uri, startIndex, keyEncoded, hashOrEndIndex) {\n  var index = startIndex;\n  var keyLength = keyEncoded.length;\n\n  // Search for the key itself and post-filter for surronuding punctuation,\n  // rather than expensively building a regexp.\n  while ((index = uri.indexOf(keyEncoded, index)) >= 0 &&\n         index < hashOrEndIndex) {\n    var precedingChar = uri.charCodeAt(index - 1);\n    // Ensure that the preceding character is '&' or '?'.\n    if (precedingChar == goog.uri.utils.CharCode_.AMPERSAND ||\n        precedingChar == goog.uri.utils.CharCode_.QUESTION) {\n      // Ensure the following character is '&', '=', '#', or NaN\n      // (end of string).\n      var followingChar = uri.charCodeAt(index + keyLength);\n      if (!followingChar || followingChar == goog.uri.utils.CharCode_.EQUAL ||\n          followingChar == goog.uri.utils.CharCode_.AMPERSAND ||\n          followingChar == goog.uri.utils.CharCode_.HASH) {\n        return index;\n      }\n    }\n    index += keyLength + 1;\n  }\n\n  return -1;\n};\n\n\n/**\n * Regular expression for finding a hash mark or end of string.\n * @type {RegExp}\n * @private\n */\ngoog.uri.utils.hashOrEndRe_ = /#|$/;\n\n\n/**\n * Determines if the URI contains a specific key.\n *\n * Performs no object instantiations.\n *\n * @param {string} uri The URI to process.  May contain a fragment\n *     identifier.\n * @param {string} keyEncoded The URI-encoded key.  Case-sensitive.\n * @return {boolean} Whether the key is present.\n */\ngoog.uri.utils.hasParam = function(uri, keyEncoded) {\n  return goog.uri.utils.findParam_(\n             uri, 0, keyEncoded, uri.search(goog.uri.utils.hashOrEndRe_)) >= 0;\n};\n\n\n/**\n * Gets the first value of a query parameter.\n * @param {string} uri The URI to process.  May contain a fragment.\n * @param {string} keyEncoded The URI-encoded key.  Case-sensitive.\n * @return {?string} The first value of the parameter (URI-decoded), or null\n *     if the parameter is not found.\n */\ngoog.uri.utils.getParamValue = function(uri, keyEncoded) {\n  var hashOrEndIndex = uri.search(goog.uri.utils.hashOrEndRe_);\n  var foundIndex =\n      goog.uri.utils.findParam_(uri, 0, keyEncoded, hashOrEndIndex);\n\n  if (foundIndex < 0) {\n    return null;\n  } else {\n    var endPosition = uri.indexOf('&', foundIndex);\n    if (endPosition < 0 || endPosition > hashOrEndIndex) {\n      endPosition = hashOrEndIndex;\n    }\n    // Progress forth to the end of the \"key=\" or \"key&\" substring.\n    foundIndex += keyEncoded.length + 1;\n    // Use substr, because it (unlike substring) will return empty string\n    // if foundIndex > endPosition.\n    return goog.string.urlDecode(\n        uri.substr(foundIndex, endPosition - foundIndex));\n  }\n};\n\n\n/**\n * Gets all values of a query parameter.\n * @param {string} uri The URI to process.  May contain a fragment.\n * @param {string} keyEncoded The URI-encoded key.  Case-sensitive.\n * @return {!Array<string>} All URI-decoded values with the given key.\n *     If the key is not found, this will have length 0, but never be null.\n */\ngoog.uri.utils.getParamValues = function(uri, keyEncoded) {\n  var hashOrEndIndex = uri.search(goog.uri.utils.hashOrEndRe_);\n  var position = 0;\n  var foundIndex;\n  var result = [];\n\n  while ((foundIndex = goog.uri.utils.findParam_(\n              uri, position, keyEncoded, hashOrEndIndex)) >= 0) {\n    // Find where this parameter ends, either the '&' or the end of the\n    // query parameters.\n    position = uri.indexOf('&', foundIndex);\n    if (position < 0 || position > hashOrEndIndex) {\n      position = hashOrEndIndex;\n    }\n\n    // Progress forth to the end of the \"key=\" or \"key&\" substring.\n    foundIndex += keyEncoded.length + 1;\n    // Use substr, because it (unlike substring) will return empty string\n    // if foundIndex > position.\n    result.push(\n        goog.string.urlDecode(uri.substr(foundIndex, position - foundIndex)));\n  }\n\n  return result;\n};\n\n\n/**\n * Regexp to find trailing question marks and ampersands.\n * @type {RegExp}\n * @private\n */\ngoog.uri.utils.trailingQueryPunctuationRe_ = /[?&]($|#)/;\n\n\n/**\n * Removes all instances of a query parameter.\n * @param {string} uri The URI to process.  Must not contain a fragment.\n * @param {string} keyEncoded The URI-encoded key.\n * @return {string} The URI with all instances of the parameter removed.\n */\ngoog.uri.utils.removeParam = function(uri, keyEncoded) {\n  var hashOrEndIndex = uri.search(goog.uri.utils.hashOrEndRe_);\n  var position = 0;\n  var foundIndex;\n  var buffer = [];\n\n  // Look for a query parameter.\n  while ((foundIndex = goog.uri.utils.findParam_(\n              uri, position, keyEncoded, hashOrEndIndex)) >= 0) {\n    // Get the portion of the query string up to, but not including, the ?\n    // or & starting the parameter.\n    buffer.push(uri.substring(position, foundIndex));\n    // Progress to immediately after the '&'.  If not found, go to the end.\n    // Avoid including the hash mark.\n    position = Math.min(\n        (uri.indexOf('&', foundIndex) + 1) || hashOrEndIndex, hashOrEndIndex);\n  }\n\n  // Append everything that is remaining.\n  buffer.push(uri.substr(position));\n\n  // Join the buffer, and remove trailing punctuation that remains.\n  return buffer.join('').replace(\n      goog.uri.utils.trailingQueryPunctuationRe_, '$1');\n};\n\n\n/**\n * Replaces all existing definitions of a parameter with a single definition.\n *\n * Repeated calls to this can exhibit quadratic behavior due to the need to\n * find existing instances and reconstruct the string, though it should be\n * limited given the 2kb limit.  Consider using appendParams or setParamsFromMap\n * to update multiple parameters in bulk.\n *\n * @param {string} uri The original URI, which may already have query data.\n * @param {string} keyEncoded The key, which must already be URI encoded.\n * @param {*} value The value, which will be stringized and encoded (assumed\n *     not already to be encoded).\n * @return {string} The URI with the query parameter added.\n */\ngoog.uri.utils.setParam = function(uri, keyEncoded, value) {\n  return goog.uri.utils.appendParam(\n      goog.uri.utils.removeParam(uri, keyEncoded), keyEncoded, value);\n};\n\n\n/**\n * Effeciently set or remove multiple query parameters in a URI. Order of\n * unchanged parameters will not be modified, all updated parameters will be\n * appended to the end of the query. Params with values of null or undefined are\n * removed.\n *\n * @param {string} uri The URI to process.\n * @param {!Object<string, goog.uri.utils.QueryValue>} params A list of\n *     parameters to update. If null or undefined, the param will be removed.\n * @return {string} An updated URI where the query data has been updated with\n *     the params.\n */\ngoog.uri.utils.setParamsFromMap = function(uri, params) {\n  var parts = goog.uri.utils.splitQueryData_(uri);\n  var queryData = parts[1];\n  var buffer = [];\n  if (queryData) {\n    goog.array.forEach(queryData.split('&'), function(pair) {\n      var indexOfEquals = pair.indexOf('=');\n      var name = indexOfEquals >= 0 ? pair.substr(0, indexOfEquals) : pair;\n      if (!params.hasOwnProperty(name)) {\n        buffer.push(pair);\n      }\n    });\n  }\n  parts[1] = goog.uri.utils.appendQueryData_(\n      buffer.join('&'), goog.uri.utils.buildQueryDataFromMap(params));\n  return goog.uri.utils.joinQueryData_(parts);\n};\n\n\n/**\n * Generates a URI path using a given URI and a path with checks to\n * prevent consecutive \"//\". The baseUri passed in must not contain\n * query or fragment identifiers. The path to append may not contain query or\n * fragment identifiers.\n *\n * @param {string} baseUri URI to use as the base.\n * @param {string} path Path to append.\n * @return {string} Updated URI.\n */\ngoog.uri.utils.appendPath = function(baseUri, path) {\n  goog.uri.utils.assertNoFragmentsOrQueries_(baseUri);\n\n  // Remove any trailing '/'\n  if (goog.string.endsWith(baseUri, '/')) {\n    baseUri = baseUri.substr(0, baseUri.length - 1);\n  }\n  // Remove any leading '/'\n  if (goog.string.startsWith(path, '/')) {\n    path = path.substr(1);\n  }\n  return goog.string.buildString(baseUri, '/', path);\n};\n\n\n/**\n * Replaces the path.\n * @param {string} uri URI to use as the base.\n * @param {string} path New path.\n * @return {string} Updated URI.\n */\ngoog.uri.utils.setPath = function(uri, path) {\n  // Add any missing '/'.\n  if (!goog.string.startsWith(path, '/')) {\n    path = '/' + path;\n  }\n  var parts = goog.uri.utils.split(uri);\n  return goog.uri.utils.buildFromEncodedParts(\n      parts[goog.uri.utils.ComponentIndex.SCHEME],\n      parts[goog.uri.utils.ComponentIndex.USER_INFO],\n      parts[goog.uri.utils.ComponentIndex.DOMAIN],\n      parts[goog.uri.utils.ComponentIndex.PORT], path,\n      parts[goog.uri.utils.ComponentIndex.QUERY_DATA],\n      parts[goog.uri.utils.ComponentIndex.FRAGMENT]);\n};\n\n\n/**\n * Standard supported query parameters.\n * @enum {string}\n */\ngoog.uri.utils.StandardQueryParam = {\n\n  /** Unused parameter for unique-ifying. */\n  RANDOM: 'zx'\n};\n\n\n/**\n * Sets the zx parameter of a URI to a random value.\n * @param {string} uri Any URI.\n * @return {string} That URI with the \"zx\" parameter added or replaced to\n *     contain a random string.\n */\ngoog.uri.utils.makeUnique = function(uri) {\n  return goog.uri.utils.setParam(\n      uri, goog.uri.utils.StandardQueryParam.RANDOM,\n      goog.string.getRandomString());\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Class for parsing and formatting URIs.\n *\n * Use goog.Uri(string) to parse a URI string.  Use goog.Uri.create(...) to\n * create a new instance of the goog.Uri object from Uri parts.\n *\n * e.g: <code>var myUri = new goog.Uri(window.location);</code>\n *\n * Implements RFC 3986 for parsing/formatting URIs.\n * http://www.ietf.org/rfc/rfc3986.txt\n *\n * Some changes have been made to the interface (more like .NETs), though the\n * internal representation is now of un-encoded parts, this will change the\n * behavior slightly.\n *\n * @author msamuel@google.com (Mike Samuel)\n */\n\ngoog.provide('goog.Uri');\ngoog.provide('goog.Uri.QueryData');\n\ngoog.require('goog.array');\ngoog.require('goog.asserts');\ngoog.require('goog.string');\ngoog.require('goog.structs');\ngoog.require('goog.structs.Map');\ngoog.require('goog.uri.utils');\ngoog.require('goog.uri.utils.ComponentIndex');\ngoog.require('goog.uri.utils.StandardQueryParam');\n\n\n\n/**\n * This class contains setters and getters for the parts of the URI.\n * The <code>getXyz</code>/<code>setXyz</code> methods return the decoded part\n * -- so<code>goog.Uri.parse('/foo%20bar').getPath()</code> will return the\n * decoded path, <code>/foo bar</code>.\n *\n * Reserved characters (see RFC 3986 section 2.2) can be present in\n * their percent-encoded form in scheme, domain, and path URI components and\n * will not be auto-decoded. For example:\n * <code>goog.Uri.parse('rel%61tive/path%2fto/resource').getPath()</code> will\n * return <code>relative/path%2fto/resource</code>.\n *\n * The constructor accepts an optional unparsed, raw URI string.  The parser\n * is relaxed, so special characters that aren't escaped but don't cause\n * ambiguities will not cause parse failures.\n *\n * All setters return <code>this</code> and so may be chained, a la\n * <code>goog.Uri.parse('/foo').setFragment('part').toString()</code>.\n *\n * @param {*=} opt_uri Optional string URI to parse\n *        (use goog.Uri.create() to create a URI from parts), or if\n *        a goog.Uri is passed, a clone is created.\n * @param {boolean=} opt_ignoreCase If true, #getParameterValue will ignore\n * the case of the parameter name.\n *\n * @throws URIError If opt_uri is provided and URI is malformed (that is,\n *     if decodeURIComponent fails on any of the URI components).\n * @constructor\n * @struct\n */\ngoog.Uri = function(opt_uri, opt_ignoreCase) {\n  /**\n   * Scheme such as \"http\".\n   * @private {string}\n   */\n  this.scheme_ = '';\n\n  /**\n   * User credentials in the form \"username:password\".\n   * @private {string}\n   */\n  this.userInfo_ = '';\n\n  /**\n   * Domain part, e.g. \"www.google.com\".\n   * @private {string}\n   */\n  this.domain_ = '';\n\n  /**\n   * Port, e.g. 8080.\n   * @private {?number}\n   */\n  this.port_ = null;\n\n  /**\n   * Path, e.g. \"/tests/img.png\".\n   * @private {string}\n   */\n  this.path_ = '';\n\n  /**\n   * The fragment without the #.\n   * @private {string}\n   */\n  this.fragment_ = '';\n\n  /**\n   * Whether or not this Uri should be treated as Read Only.\n   * @private {boolean}\n   */\n  this.isReadOnly_ = false;\n\n  /**\n   * Whether or not to ignore case when comparing query params.\n   * @private {boolean}\n   */\n  this.ignoreCase_ = false;\n\n  /**\n   * Object representing query data.\n   * @private {!goog.Uri.QueryData}\n   */\n  this.queryData_;\n\n  // Parse in the uri string\n  var m;\n  if (opt_uri instanceof goog.Uri) {\n    this.ignoreCase_ =\n        goog.isDef(opt_ignoreCase) ? opt_ignoreCase : opt_uri.getIgnoreCase();\n    this.setScheme(opt_uri.getScheme());\n    this.setUserInfo(opt_uri.getUserInfo());\n    this.setDomain(opt_uri.getDomain());\n    this.setPort(opt_uri.getPort());\n    this.setPath(opt_uri.getPath());\n    this.setQueryData(opt_uri.getQueryData().clone());\n    this.setFragment(opt_uri.getFragment());\n  } else if (opt_uri && (m = goog.uri.utils.split(String(opt_uri)))) {\n    this.ignoreCase_ = !!opt_ignoreCase;\n\n    // Set the parts -- decoding as we do so.\n    // COMPATIBILITY NOTE - In IE, unmatched fields may be empty strings,\n    // whereas in other browsers they will be undefined.\n    this.setScheme(m[goog.uri.utils.ComponentIndex.SCHEME] || '', true);\n    this.setUserInfo(m[goog.uri.utils.ComponentIndex.USER_INFO] || '', true);\n    this.setDomain(m[goog.uri.utils.ComponentIndex.DOMAIN] || '', true);\n    this.setPort(m[goog.uri.utils.ComponentIndex.PORT]);\n    this.setPath(m[goog.uri.utils.ComponentIndex.PATH] || '', true);\n    this.setQueryData(m[goog.uri.utils.ComponentIndex.QUERY_DATA] || '', true);\n    this.setFragment(m[goog.uri.utils.ComponentIndex.FRAGMENT] || '', true);\n\n  } else {\n    this.ignoreCase_ = !!opt_ignoreCase;\n    this.queryData_ = new goog.Uri.QueryData(null, null, this.ignoreCase_);\n  }\n};\n\n\n/**\n * Parameter name added to stop caching.\n * @type {string}\n */\ngoog.Uri.RANDOM_PARAM = goog.uri.utils.StandardQueryParam.RANDOM;\n\n\n/**\n * @return {string} The string form of the url.\n * @override\n */\ngoog.Uri.prototype.toString = function() {\n  var out = [];\n\n  var scheme = this.getScheme();\n  if (scheme) {\n    out.push(\n        goog.Uri.encodeSpecialChars_(\n            scheme, goog.Uri.reDisallowedInSchemeOrUserInfo_, true),\n        ':');\n  }\n\n  var domain = this.getDomain();\n  if (domain || scheme == 'file') {\n    out.push('//');\n\n    var userInfo = this.getUserInfo();\n    if (userInfo) {\n      out.push(\n          goog.Uri.encodeSpecialChars_(\n              userInfo, goog.Uri.reDisallowedInSchemeOrUserInfo_, true),\n          '@');\n    }\n\n    out.push(goog.Uri.removeDoubleEncoding_(goog.string.urlEncode(domain)));\n\n    var port = this.getPort();\n    if (port != null) {\n      out.push(':', String(port));\n    }\n  }\n\n  var path = this.getPath();\n  if (path) {\n    if (this.hasDomain() && path.charAt(0) != '/') {\n      out.push('/');\n    }\n    out.push(\n        goog.Uri.encodeSpecialChars_(\n            path, path.charAt(0) == '/' ? goog.Uri.reDisallowedInAbsolutePath_ :\n                                          goog.Uri.reDisallowedInRelativePath_,\n            true));\n  }\n\n  var query = this.getEncodedQuery();\n  if (query) {\n    out.push('?', query);\n  }\n\n  var fragment = this.getFragment();\n  if (fragment) {\n    out.push(\n        '#', goog.Uri.encodeSpecialChars_(\n                 fragment, goog.Uri.reDisallowedInFragment_));\n  }\n  return out.join('');\n};\n\n\n/**\n * Resolves the given relative URI (a goog.Uri object), using the URI\n * represented by this instance as the base URI.\n *\n * There are several kinds of relative URIs:<br>\n * 1. foo - replaces the last part of the path, the whole query and fragment<br>\n * 2. /foo - replaces the path, the query and fragment<br>\n * 3. //foo - replaces everything from the domain on.  foo is a domain name<br>\n * 4. ?foo - replace the query and fragment<br>\n * 5. #foo - replace the fragment only\n *\n * Additionally, if relative URI has a non-empty path, all \"..\" and \".\"\n * segments will be resolved, as described in RFC 3986.\n *\n * @param {!goog.Uri} relativeUri The relative URI to resolve.\n * @return {!goog.Uri} The resolved URI.\n */\ngoog.Uri.prototype.resolve = function(relativeUri) {\n\n  var absoluteUri = this.clone();\n\n  // we satisfy these conditions by looking for the first part of relativeUri\n  // that is not blank and applying defaults to the rest\n\n  var overridden = relativeUri.hasScheme();\n\n  if (overridden) {\n    absoluteUri.setScheme(relativeUri.getScheme());\n  } else {\n    overridden = relativeUri.hasUserInfo();\n  }\n\n  if (overridden) {\n    absoluteUri.setUserInfo(relativeUri.getUserInfo());\n  } else {\n    overridden = relativeUri.hasDomain();\n  }\n\n  if (overridden) {\n    absoluteUri.setDomain(relativeUri.getDomain());\n  } else {\n    overridden = relativeUri.hasPort();\n  }\n\n  var path = relativeUri.getPath();\n  if (overridden) {\n    absoluteUri.setPort(relativeUri.getPort());\n  } else {\n    overridden = relativeUri.hasPath();\n    if (overridden) {\n      // resolve path properly\n      if (path.charAt(0) != '/') {\n        // path is relative\n        if (this.hasDomain() && !this.hasPath()) {\n          // RFC 3986, section 5.2.3, case 1\n          path = '/' + path;\n        } else {\n          // RFC 3986, section 5.2.3, case 2\n          var lastSlashIndex = absoluteUri.getPath().lastIndexOf('/');\n          if (lastSlashIndex != -1) {\n            path = absoluteUri.getPath().substr(0, lastSlashIndex + 1) + path;\n          }\n        }\n      }\n      path = goog.Uri.removeDotSegments(path);\n    }\n  }\n\n  if (overridden) {\n    absoluteUri.setPath(path);\n  } else {\n    overridden = relativeUri.hasQuery();\n  }\n\n  if (overridden) {\n    absoluteUri.setQueryData(relativeUri.getQueryData().clone());\n  } else {\n    overridden = relativeUri.hasFragment();\n  }\n\n  if (overridden) {\n    absoluteUri.setFragment(relativeUri.getFragment());\n  }\n\n  return absoluteUri;\n};\n\n\n/**\n * Clones the URI instance.\n * @return {!goog.Uri} New instance of the URI object.\n */\ngoog.Uri.prototype.clone = function() {\n  return new goog.Uri(this);\n};\n\n\n/**\n * @return {string} The encoded scheme/protocol for the URI.\n */\ngoog.Uri.prototype.getScheme = function() {\n  return this.scheme_;\n};\n\n\n/**\n * Sets the scheme/protocol.\n * @throws URIError If opt_decode is true and newScheme is malformed (that is,\n *     if decodeURIComponent fails).\n * @param {string} newScheme New scheme value.\n * @param {boolean=} opt_decode Optional param for whether to decode new value.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setScheme = function(newScheme, opt_decode) {\n  this.enforceReadOnly();\n  this.scheme_ =\n      opt_decode ? goog.Uri.decodeOrEmpty_(newScheme, true) : newScheme;\n\n  // remove an : at the end of the scheme so somebody can pass in\n  // window.location.protocol\n  if (this.scheme_) {\n    this.scheme_ = this.scheme_.replace(/:$/, '');\n  }\n  return this;\n};\n\n\n/**\n * @return {boolean} Whether the scheme has been set.\n */\ngoog.Uri.prototype.hasScheme = function() {\n  return !!this.scheme_;\n};\n\n\n/**\n * @return {string} The decoded user info.\n */\ngoog.Uri.prototype.getUserInfo = function() {\n  return this.userInfo_;\n};\n\n\n/**\n * Sets the userInfo.\n * @throws URIError If opt_decode is true and newUserInfo is malformed (that is,\n *     if decodeURIComponent fails).\n * @param {string} newUserInfo New userInfo value.\n * @param {boolean=} opt_decode Optional param for whether to decode new value.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setUserInfo = function(newUserInfo, opt_decode) {\n  this.enforceReadOnly();\n  this.userInfo_ =\n      opt_decode ? goog.Uri.decodeOrEmpty_(newUserInfo) : newUserInfo;\n  return this;\n};\n\n\n/**\n * @return {boolean} Whether the user info has been set.\n */\ngoog.Uri.prototype.hasUserInfo = function() {\n  return !!this.userInfo_;\n};\n\n\n/**\n * @return {string} The decoded domain.\n */\ngoog.Uri.prototype.getDomain = function() {\n  return this.domain_;\n};\n\n\n/**\n * Sets the domain.\n * @throws URIError If opt_decode is true and newDomain is malformed (that is,\n *     if decodeURIComponent fails).\n * @param {string} newDomain New domain value.\n * @param {boolean=} opt_decode Optional param for whether to decode new value.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setDomain = function(newDomain, opt_decode) {\n  this.enforceReadOnly();\n  this.domain_ =\n      opt_decode ? goog.Uri.decodeOrEmpty_(newDomain, true) : newDomain;\n  return this;\n};\n\n\n/**\n * @return {boolean} Whether the domain has been set.\n */\ngoog.Uri.prototype.hasDomain = function() {\n  return !!this.domain_;\n};\n\n\n/**\n * @return {?number} The port number.\n */\ngoog.Uri.prototype.getPort = function() {\n  return this.port_;\n};\n\n\n/**\n * Sets the port number.\n * @param {*} newPort Port number. Will be explicitly casted to a number.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setPort = function(newPort) {\n  this.enforceReadOnly();\n\n  if (newPort) {\n    newPort = Number(newPort);\n    if (isNaN(newPort) || newPort < 0) {\n      throw new Error('Bad port number ' + newPort);\n    }\n    this.port_ = newPort;\n  } else {\n    this.port_ = null;\n  }\n\n  return this;\n};\n\n\n/**\n * @return {boolean} Whether the port has been set.\n */\ngoog.Uri.prototype.hasPort = function() {\n  return this.port_ != null;\n};\n\n\n/**\n  * @return {string} The decoded path.\n */\ngoog.Uri.prototype.getPath = function() {\n  return this.path_;\n};\n\n\n/**\n * Sets the path.\n * @throws URIError If opt_decode is true and newPath is malformed (that is,\n *     if decodeURIComponent fails).\n * @param {string} newPath New path value.\n * @param {boolean=} opt_decode Optional param for whether to decode new value.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setPath = function(newPath, opt_decode) {\n  this.enforceReadOnly();\n  this.path_ = opt_decode ? goog.Uri.decodeOrEmpty_(newPath, true) : newPath;\n  return this;\n};\n\n\n/**\n * @return {boolean} Whether the path has been set.\n */\ngoog.Uri.prototype.hasPath = function() {\n  return !!this.path_;\n};\n\n\n/**\n * @return {boolean} Whether the query string has been set.\n */\ngoog.Uri.prototype.hasQuery = function() {\n  return this.queryData_.toString() !== '';\n};\n\n\n/**\n * Sets the query data.\n * @param {goog.Uri.QueryData|string|undefined} queryData QueryData object.\n * @param {boolean=} opt_decode Optional param for whether to decode new value.\n *     Applies only if queryData is a string.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setQueryData = function(queryData, opt_decode) {\n  this.enforceReadOnly();\n\n  if (queryData instanceof goog.Uri.QueryData) {\n    this.queryData_ = queryData;\n    this.queryData_.setIgnoreCase(this.ignoreCase_);\n  } else {\n    if (!opt_decode) {\n      // QueryData accepts encoded query string, so encode it if\n      // opt_decode flag is not true.\n      queryData = goog.Uri.encodeSpecialChars_(\n          queryData, goog.Uri.reDisallowedInQuery_);\n    }\n    this.queryData_ = new goog.Uri.QueryData(queryData, null, this.ignoreCase_);\n  }\n\n  return this;\n};\n\n\n/**\n * Sets the URI query.\n * @param {string} newQuery New query value.\n * @param {boolean=} opt_decode Optional param for whether to decode new value.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setQuery = function(newQuery, opt_decode) {\n  return this.setQueryData(newQuery, opt_decode);\n};\n\n\n/**\n * @return {string} The encoded URI query, not including the ?.\n */\ngoog.Uri.prototype.getEncodedQuery = function() {\n  return this.queryData_.toString();\n};\n\n\n/**\n * @return {string} The decoded URI query, not including the ?.\n */\ngoog.Uri.prototype.getDecodedQuery = function() {\n  return this.queryData_.toDecodedString();\n};\n\n\n/**\n * Returns the query data.\n * @return {!goog.Uri.QueryData} QueryData object.\n */\ngoog.Uri.prototype.getQueryData = function() {\n  return this.queryData_;\n};\n\n\n/**\n * @return {string} The encoded URI query, not including the ?.\n *\n * Warning: This method, unlike other getter methods, returns encoded\n * value, instead of decoded one.\n */\ngoog.Uri.prototype.getQuery = function() {\n  return this.getEncodedQuery();\n};\n\n\n/**\n * Sets the value of the named query parameters, clearing previous values for\n * that key.\n *\n * @param {string} key The parameter to set.\n * @param {*} value The new value. Value does not need to be encoded.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setParameterValue = function(key, value) {\n  this.enforceReadOnly();\n  this.queryData_.set(key, value);\n  return this;\n};\n\n\n/**\n * Sets the values of the named query parameters, clearing previous values for\n * that key.  Not new values will currently be moved to the end of the query\n * string.\n *\n * So, <code>goog.Uri.parse('foo?a=b&c=d&e=f').setParameterValues('c', ['new'])\n * </code> yields <tt>foo?a=b&e=f&c=new</tt>.</p>\n *\n * @param {string} key The parameter to set.\n * @param {*} values The new values. If values is a single\n *     string then it will be treated as the sole value. Values do not need to\n *     be encoded.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setParameterValues = function(key, values) {\n  this.enforceReadOnly();\n\n  if (!goog.isArray(values)) {\n    values = [String(values)];\n  }\n\n  this.queryData_.setValues(key, values);\n\n  return this;\n};\n\n\n/**\n * Returns the value<b>s</b> for a given cgi parameter as a list of decoded\n * query parameter values.\n * @param {string} name The parameter to get values for.\n * @return {!Array<?>} The values for a given cgi parameter as a list of\n *     decoded query parameter values.\n */\ngoog.Uri.prototype.getParameterValues = function(name) {\n  return this.queryData_.getValues(name);\n};\n\n\n/**\n * Returns the first value for a given cgi parameter or undefined if the given\n * parameter name does not appear in the query string.\n * @param {string} paramName Unescaped parameter name.\n * @return {string|undefined} The first value for a given cgi parameter or\n *     undefined if the given parameter name does not appear in the query\n *     string.\n */\ngoog.Uri.prototype.getParameterValue = function(paramName) {\n  return /** @type {string|undefined} */ (this.queryData_.get(paramName));\n};\n\n\n/**\n * @return {string} The URI fragment, not including the #.\n */\ngoog.Uri.prototype.getFragment = function() {\n  return this.fragment_;\n};\n\n\n/**\n * Sets the URI fragment.\n * @throws URIError If opt_decode is true and newFragment is malformed (that is,\n *     if decodeURIComponent fails).\n * @param {string} newFragment New fragment value.\n * @param {boolean=} opt_decode Optional param for whether to decode new value.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.setFragment = function(newFragment, opt_decode) {\n  this.enforceReadOnly();\n  this.fragment_ =\n      opt_decode ? goog.Uri.decodeOrEmpty_(newFragment) : newFragment;\n  return this;\n};\n\n\n/**\n * @return {boolean} Whether the URI has a fragment set.\n */\ngoog.Uri.prototype.hasFragment = function() {\n  return !!this.fragment_;\n};\n\n\n/**\n * Returns true if this has the same domain as that of uri2.\n * @param {!goog.Uri} uri2 The URI object to compare to.\n * @return {boolean} true if same domain; false otherwise.\n */\ngoog.Uri.prototype.hasSameDomainAs = function(uri2) {\n  return ((!this.hasDomain() && !uri2.hasDomain()) ||\n          this.getDomain() == uri2.getDomain()) &&\n      ((!this.hasPort() && !uri2.hasPort()) ||\n       this.getPort() == uri2.getPort());\n};\n\n\n/**\n * Adds a random parameter to the Uri.\n * @return {!goog.Uri} Reference to this Uri object.\n */\ngoog.Uri.prototype.makeUnique = function() {\n  this.enforceReadOnly();\n  this.setParameterValue(goog.Uri.RANDOM_PARAM, goog.string.getRandomString());\n\n  return this;\n};\n\n\n/**\n * Removes the named query parameter.\n *\n * @param {string} key The parameter to remove.\n * @return {!goog.Uri} Reference to this URI object.\n */\ngoog.Uri.prototype.removeParameter = function(key) {\n  this.enforceReadOnly();\n  this.queryData_.remove(key);\n  return this;\n};\n\n\n/**\n * Sets whether Uri is read only. If this goog.Uri is read-only,\n * enforceReadOnly_ will be called at the start of any function that may modify\n * this Uri.\n * @param {boolean} isReadOnly whether this goog.Uri should be read only.\n * @return {!goog.Uri} Reference to this Uri object.\n */\ngoog.Uri.prototype.setReadOnly = function(isReadOnly) {\n  this.isReadOnly_ = isReadOnly;\n  return this;\n};\n\n\n/**\n * @return {boolean} Whether the URI is read only.\n */\ngoog.Uri.prototype.isReadOnly = function() {\n  return this.isReadOnly_;\n};\n\n\n/**\n * Checks if this Uri has been marked as read only, and if so, throws an error.\n * This should be called whenever any modifying function is called.\n */\ngoog.Uri.prototype.enforceReadOnly = function() {\n  if (this.isReadOnly_) {\n    throw new Error('Tried to modify a read-only Uri');\n  }\n};\n\n\n/**\n * Sets whether to ignore case.\n * NOTE: If there are already key/value pairs in the QueryData, and\n * ignoreCase_ is set to false, the keys will all be lower-cased.\n * @param {boolean} ignoreCase whether this goog.Uri should ignore case.\n * @return {!goog.Uri} Reference to this Uri object.\n */\ngoog.Uri.prototype.setIgnoreCase = function(ignoreCase) {\n  this.ignoreCase_ = ignoreCase;\n  if (this.queryData_) {\n    this.queryData_.setIgnoreCase(ignoreCase);\n  }\n  return this;\n};\n\n\n/**\n * @return {boolean} Whether to ignore case.\n */\ngoog.Uri.prototype.getIgnoreCase = function() {\n  return this.ignoreCase_;\n};\n\n\n//==============================================================================\n// Static members\n//==============================================================================\n\n\n/**\n * Creates a uri from the string form.  Basically an alias of new goog.Uri().\n * If a Uri object is passed to parse then it will return a clone of the object.\n *\n * @throws URIError If parsing the URI is malformed. The passed URI components\n *     should all be parseable by decodeURIComponent.\n * @param {*} uri Raw URI string or instance of Uri\n *     object.\n * @param {boolean=} opt_ignoreCase Whether to ignore the case of parameter\n * names in #getParameterValue.\n * @return {!goog.Uri} The new URI object.\n */\ngoog.Uri.parse = function(uri, opt_ignoreCase) {\n  return uri instanceof goog.Uri ? uri.clone() :\n                                   new goog.Uri(uri, opt_ignoreCase);\n};\n\n\n/**\n * Creates a new goog.Uri object from unencoded parts.\n *\n * @param {?string=} opt_scheme Scheme/protocol or full URI to parse.\n * @param {?string=} opt_userInfo username:password.\n * @param {?string=} opt_domain www.google.com.\n * @param {?number=} opt_port 9830.\n * @param {?string=} opt_path /some/path/to/a/file.html.\n * @param {string|goog.Uri.QueryData=} opt_query a=1&b=2.\n * @param {?string=} opt_fragment The fragment without the #.\n * @param {boolean=} opt_ignoreCase Whether to ignore parameter name case in\n *     #getParameterValue.\n *\n * @return {!goog.Uri} The new URI object.\n */\ngoog.Uri.create = function(\n    opt_scheme, opt_userInfo, opt_domain, opt_port, opt_path, opt_query,\n    opt_fragment, opt_ignoreCase) {\n\n  var uri = new goog.Uri(null, opt_ignoreCase);\n\n  // Only set the parts if they are defined and not empty strings.\n  opt_scheme && uri.setScheme(opt_scheme);\n  opt_userInfo && uri.setUserInfo(opt_userInfo);\n  opt_domain && uri.setDomain(opt_domain);\n  opt_port && uri.setPort(opt_port);\n  opt_path && uri.setPath(opt_path);\n  opt_query && uri.setQueryData(opt_query);\n  opt_fragment && uri.setFragment(opt_fragment);\n\n  return uri;\n};\n\n\n/**\n * Resolves a relative Uri against a base Uri, accepting both strings and\n * Uri objects.\n *\n * @param {*} base Base Uri.\n * @param {*} rel Relative Uri.\n * @return {!goog.Uri} Resolved uri.\n */\ngoog.Uri.resolve = function(base, rel) {\n  if (!(base instanceof goog.Uri)) {\n    base = goog.Uri.parse(base);\n  }\n\n  if (!(rel instanceof goog.Uri)) {\n    rel = goog.Uri.parse(rel);\n  }\n\n  return base.resolve(rel);\n};\n\n\n/**\n * Removes dot segments in given path component, as described in\n * RFC 3986, section 5.2.4.\n *\n * @param {string} path A non-empty path component.\n * @return {string} Path component with removed dot segments.\n */\ngoog.Uri.removeDotSegments = function(path) {\n  if (path == '..' || path == '.') {\n    return '';\n\n  } else if (\n      !goog.string.contains(path, './') && !goog.string.contains(path, '/.')) {\n    // This optimization detects uris which do not contain dot-segments,\n    // and as a consequence do not require any processing.\n    return path;\n\n  } else {\n    var leadingSlash = goog.string.startsWith(path, '/');\n    var segments = path.split('/');\n    var out = [];\n\n    for (var pos = 0; pos < segments.length;) {\n      var segment = segments[pos++];\n\n      if (segment == '.') {\n        if (leadingSlash && pos == segments.length) {\n          out.push('');\n        }\n      } else if (segment == '..') {\n        if (out.length > 1 || out.length == 1 && out[0] != '') {\n          out.pop();\n        }\n        if (leadingSlash && pos == segments.length) {\n          out.push('');\n        }\n      } else {\n        out.push(segment);\n        leadingSlash = true;\n      }\n    }\n\n    return out.join('/');\n  }\n};\n\n\n/**\n * Decodes a value or returns the empty string if it isn't defined or empty.\n * @throws URIError If decodeURIComponent fails to decode val.\n * @param {string|undefined} val Value to decode.\n * @param {boolean=} opt_preserveReserved If true, restricted characters will\n *     not be decoded.\n * @return {string} Decoded value.\n * @private\n */\ngoog.Uri.decodeOrEmpty_ = function(val, opt_preserveReserved) {\n  // Don't use UrlDecode() here because val is not a query parameter.\n  if (!val) {\n    return '';\n  }\n\n  // decodeURI has the same output for '%2f' and '%252f'. We double encode %25\n  // so that we can distinguish between the 2 inputs. This is later undone by\n  // removeDoubleEncoding_.\n  return opt_preserveReserved ? decodeURI(val.replace(/%25/g, '%2525')) :\n                                decodeURIComponent(val);\n};\n\n\n/**\n * If unescapedPart is non null, then escapes any characters in it that aren't\n * valid characters in a url and also escapes any special characters that\n * appear in extra.\n *\n * @param {*} unescapedPart The string to encode.\n * @param {RegExp} extra A character set of characters in [\\01-\\177].\n * @param {boolean=} opt_removeDoubleEncoding If true, remove double percent\n *     encoding.\n * @return {?string} null iff unescapedPart == null.\n * @private\n */\ngoog.Uri.encodeSpecialChars_ = function(\n    unescapedPart, extra, opt_removeDoubleEncoding) {\n  if (goog.isString(unescapedPart)) {\n    var encoded = encodeURI(unescapedPart).replace(extra, goog.Uri.encodeChar_);\n    if (opt_removeDoubleEncoding) {\n      // encodeURI double-escapes %XX sequences used to represent restricted\n      // characters in some URI components, remove the double escaping here.\n      encoded = goog.Uri.removeDoubleEncoding_(encoded);\n    }\n    return encoded;\n  }\n  return null;\n};\n\n\n/**\n * Converts a character in [\\01-\\177] to its unicode character equivalent.\n * @param {string} ch One character string.\n * @return {string} Encoded string.\n * @private\n */\ngoog.Uri.encodeChar_ = function(ch) {\n  var n = ch.charCodeAt(0);\n  return '%' + ((n >> 4) & 0xf).toString(16) + (n & 0xf).toString(16);\n};\n\n\n/**\n * Removes double percent-encoding from a string.\n * @param  {string} doubleEncodedString String\n * @return {string} String with double encoding removed.\n * @private\n */\ngoog.Uri.removeDoubleEncoding_ = function(doubleEncodedString) {\n  return doubleEncodedString.replace(/%25([0-9a-fA-F]{2})/g, '%$1');\n};\n\n\n/**\n * Regular expression for characters that are disallowed in the scheme or\n * userInfo part of the URI.\n * @type {RegExp}\n * @private\n */\ngoog.Uri.reDisallowedInSchemeOrUserInfo_ = /[#\\/\\?@]/g;\n\n\n/**\n * Regular expression for characters that are disallowed in a relative path.\n * Colon is included due to RFC 3986 3.3.\n * @type {RegExp}\n * @private\n */\ngoog.Uri.reDisallowedInRelativePath_ = /[\\#\\?:]/g;\n\n\n/**\n * Regular expression for characters that are disallowed in an absolute path.\n * @type {RegExp}\n * @private\n */\ngoog.Uri.reDisallowedInAbsolutePath_ = /[\\#\\?]/g;\n\n\n/**\n * Regular expression for characters that are disallowed in the query.\n * @type {RegExp}\n * @private\n */\ngoog.Uri.reDisallowedInQuery_ = /[\\#\\?@]/g;\n\n\n/**\n * Regular expression for characters that are disallowed in the fragment.\n * @type {RegExp}\n * @private\n */\ngoog.Uri.reDisallowedInFragment_ = /#/g;\n\n\n/**\n * Checks whether two URIs have the same domain.\n * @param {string} uri1String First URI string.\n * @param {string} uri2String Second URI string.\n * @return {boolean} true if the two URIs have the same domain; false otherwise.\n */\ngoog.Uri.haveSameDomain = function(uri1String, uri2String) {\n  // Differs from goog.uri.utils.haveSameDomain, since this ignores scheme.\n  // TODO(gboyer): Have this just call goog.uri.util.haveSameDomain.\n  var pieces1 = goog.uri.utils.split(uri1String);\n  var pieces2 = goog.uri.utils.split(uri2String);\n  return pieces1[goog.uri.utils.ComponentIndex.DOMAIN] ==\n      pieces2[goog.uri.utils.ComponentIndex.DOMAIN] &&\n      pieces1[goog.uri.utils.ComponentIndex.PORT] ==\n      pieces2[goog.uri.utils.ComponentIndex.PORT];\n};\n\n\n\n/**\n * Class used to represent URI query parameters.  It is essentially a hash of\n * name-value pairs, though a name can be present more than once.\n *\n * Has the same interface as the collections in goog.structs.\n *\n * @param {?string=} opt_query Optional encoded query string to parse into\n *     the object.\n * @param {goog.Uri=} opt_uri Optional uri object that should have its\n *     cache invalidated when this object updates. Deprecated -- this\n *     is no longer required.\n * @param {boolean=} opt_ignoreCase If true, ignore the case of the parameter\n *     name in #get.\n * @constructor\n * @struct\n * @final\n */\ngoog.Uri.QueryData = function(opt_query, opt_uri, opt_ignoreCase) {\n  /**\n   * The map containing name/value or name/array-of-values pairs.\n   * May be null if it requires parsing from the query string.\n   *\n   * We need to use a Map because we cannot guarantee that the key names will\n   * not be problematic for IE.\n   *\n   * @private {?goog.structs.Map<string, !Array<*>>}\n   */\n  this.keyMap_ = null;\n\n  /**\n   * The number of params, or null if it requires computing.\n   * @private {?number}\n   */\n  this.count_ = null;\n\n  /**\n   * Encoded query string, or null if it requires computing from the key map.\n   * @private {?string}\n   */\n  this.encodedQuery_ = opt_query || null;\n\n  /**\n   * If true, ignore the case of the parameter name in #get.\n   * @private {boolean}\n   */\n  this.ignoreCase_ = !!opt_ignoreCase;\n};\n\n\n/**\n * If the underlying key map is not yet initialized, it parses the\n * query string and fills the map with parsed data.\n * @private\n */\ngoog.Uri.QueryData.prototype.ensureKeyMapInitialized_ = function() {\n  if (!this.keyMap_) {\n    this.keyMap_ = new goog.structs.Map();\n    this.count_ = 0;\n    if (this.encodedQuery_) {\n      var self = this;\n      goog.uri.utils.parseQueryData(this.encodedQuery_, function(name, value) {\n        self.add(goog.string.urlDecode(name), value);\n      });\n    }\n  }\n};\n\n\n/**\n * Creates a new query data instance from a map of names and values.\n *\n * @param {!goog.structs.Map<string, ?>|!Object} map Map of string parameter\n *     names to parameter value. If parameter value is an array, it is\n *     treated as if the key maps to each individual value in the\n *     array.\n * @param {goog.Uri=} opt_uri URI object that should have its cache\n *     invalidated when this object updates.\n * @param {boolean=} opt_ignoreCase If true, ignore the case of the parameter\n *     name in #get.\n * @return {!goog.Uri.QueryData} The populated query data instance.\n */\ngoog.Uri.QueryData.createFromMap = function(map, opt_uri, opt_ignoreCase) {\n  var keys = goog.structs.getKeys(map);\n  if (typeof keys == 'undefined') {\n    throw new Error('Keys are undefined');\n  }\n\n  var queryData = new goog.Uri.QueryData(null, null, opt_ignoreCase);\n  var values = goog.structs.getValues(map);\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = values[i];\n    if (!goog.isArray(value)) {\n      queryData.add(key, value);\n    } else {\n      queryData.setValues(key, value);\n    }\n  }\n  return queryData;\n};\n\n\n/**\n * Creates a new query data instance from parallel arrays of parameter names\n * and values. Allows for duplicate parameter names. Throws an error if the\n * lengths of the arrays differ.\n *\n * @param {!Array<string>} keys Parameter names.\n * @param {!Array<?>} values Parameter values.\n * @param {goog.Uri=} opt_uri URI object that should have its cache\n *     invalidated when this object updates.\n * @param {boolean=} opt_ignoreCase If true, ignore the case of the parameter\n *     name in #get.\n * @return {!goog.Uri.QueryData} The populated query data instance.\n */\ngoog.Uri.QueryData.createFromKeysValues = function(\n    keys, values, opt_uri, opt_ignoreCase) {\n  if (keys.length != values.length) {\n    throw new Error('Mismatched lengths for keys/values');\n  }\n  var queryData = new goog.Uri.QueryData(null, null, opt_ignoreCase);\n  for (var i = 0; i < keys.length; i++) {\n    queryData.add(keys[i], values[i]);\n  }\n  return queryData;\n};\n\n\n/**\n * @return {?number} The number of parameters.\n */\ngoog.Uri.QueryData.prototype.getCount = function() {\n  this.ensureKeyMapInitialized_();\n  return this.count_;\n};\n\n\n/**\n * Adds a key value pair.\n * @param {string} key Name.\n * @param {*} value Value.\n * @return {!goog.Uri.QueryData} Instance of this object.\n */\ngoog.Uri.QueryData.prototype.add = function(key, value) {\n  this.ensureKeyMapInitialized_();\n  this.invalidateCache_();\n\n  key = this.getKeyName_(key);\n  var values = this.keyMap_.get(key);\n  if (!values) {\n    this.keyMap_.set(key, (values = []));\n  }\n  values.push(value);\n  this.count_ = goog.asserts.assertNumber(this.count_) + 1;\n  return this;\n};\n\n\n/**\n * Removes all the params with the given key.\n * @param {string} key Name.\n * @return {boolean} Whether any parameter was removed.\n */\ngoog.Uri.QueryData.prototype.remove = function(key) {\n  this.ensureKeyMapInitialized_();\n\n  key = this.getKeyName_(key);\n  if (this.keyMap_.containsKey(key)) {\n    this.invalidateCache_();\n\n    // Decrement parameter count.\n    this.count_ =\n        goog.asserts.assertNumber(this.count_) - this.keyMap_.get(key).length;\n    return this.keyMap_.remove(key);\n  }\n  return false;\n};\n\n\n/**\n * Clears the parameters.\n */\ngoog.Uri.QueryData.prototype.clear = function() {\n  this.invalidateCache_();\n  this.keyMap_ = null;\n  this.count_ = 0;\n};\n\n\n/**\n * @return {boolean} Whether we have any parameters.\n */\ngoog.Uri.QueryData.prototype.isEmpty = function() {\n  this.ensureKeyMapInitialized_();\n  return this.count_ == 0;\n};\n\n\n/**\n * Whether there is a parameter with the given name\n * @param {string} key The parameter name to check for.\n * @return {boolean} Whether there is a parameter with the given name.\n */\ngoog.Uri.QueryData.prototype.containsKey = function(key) {\n  this.ensureKeyMapInitialized_();\n  key = this.getKeyName_(key);\n  return this.keyMap_.containsKey(key);\n};\n\n\n/**\n * Whether there is a parameter with the given value.\n * @param {*} value The value to check for.\n * @return {boolean} Whether there is a parameter with the given value.\n */\ngoog.Uri.QueryData.prototype.containsValue = function(value) {\n  // NOTE(arv): This solution goes through all the params even if it was the\n  // first param. We can get around this by not reusing code or by switching to\n  // iterators.\n  var vals = this.getValues();\n  return goog.array.contains(vals, value);\n};\n\n\n/**\n * Runs a callback on every key-value pair in the map, including duplicate keys.\n * This won't maintain original order when duplicate keys are interspersed (like\n * getKeys() / getValues()).\n * @param {function(this:SCOPE, ?, string, !goog.Uri.QueryData)} f\n * @param {SCOPE=} opt_scope The value of \"this\" inside f.\n * @template SCOPE\n */\ngoog.Uri.QueryData.prototype.forEach = function(f, opt_scope) {\n  this.ensureKeyMapInitialized_();\n  this.keyMap_.forEach(function(values, key) {\n    goog.array.forEach(values, function(value) {\n      f.call(opt_scope, value, key, this);\n    }, this);\n  }, this);\n};\n\n\n/**\n * Returns all the keys of the parameters. If a key is used multiple times\n * it will be included multiple times in the returned array\n * @return {!Array<string>} All the keys of the parameters.\n */\ngoog.Uri.QueryData.prototype.getKeys = function() {\n  this.ensureKeyMapInitialized_();\n  // We need to get the values to know how many keys to add.\n  var vals = this.keyMap_.getValues();\n  var keys = this.keyMap_.getKeys();\n  var rv = [];\n  for (var i = 0; i < keys.length; i++) {\n    var val = vals[i];\n    for (var j = 0; j < val.length; j++) {\n      rv.push(keys[i]);\n    }\n  }\n  return rv;\n};\n\n\n/**\n * Returns all the values of the parameters with the given name. If the query\n * data has no such key this will return an empty array. If no key is given\n * all values wil be returned.\n * @param {string=} opt_key The name of the parameter to get the values for.\n * @return {!Array<?>} All the values of the parameters with the given name.\n */\ngoog.Uri.QueryData.prototype.getValues = function(opt_key) {\n  this.ensureKeyMapInitialized_();\n  var rv = [];\n  if (goog.isString(opt_key)) {\n    if (this.containsKey(opt_key)) {\n      rv = goog.array.concat(rv, this.keyMap_.get(this.getKeyName_(opt_key)));\n    }\n  } else {\n    // Return all values.\n    var values = this.keyMap_.getValues();\n    for (var i = 0; i < values.length; i++) {\n      rv = goog.array.concat(rv, values[i]);\n    }\n  }\n  return rv;\n};\n\n\n/**\n * Sets a key value pair and removes all other keys with the same value.\n *\n * @param {string} key Name.\n * @param {*} value Value.\n * @return {!goog.Uri.QueryData} Instance of this object.\n */\ngoog.Uri.QueryData.prototype.set = function(key, value) {\n  this.ensureKeyMapInitialized_();\n  this.invalidateCache_();\n\n  // TODO(chrishenry): This could be better written as\n  // this.remove(key), this.add(key, value), but that would reorder\n  // the key (since the key is first removed and then added at the\n  // end) and we would have to fix unit tests that depend on key\n  // ordering.\n  key = this.getKeyName_(key);\n  if (this.containsKey(key)) {\n    this.count_ =\n        goog.asserts.assertNumber(this.count_) - this.keyMap_.get(key).length;\n  }\n  this.keyMap_.set(key, [value]);\n  this.count_ = goog.asserts.assertNumber(this.count_) + 1;\n  return this;\n};\n\n\n/**\n * Returns the first value associated with the key. If the query data has no\n * such key this will return undefined or the optional default.\n * @param {string} key The name of the parameter to get the value for.\n * @param {*=} opt_default The default value to return if the query data\n *     has no such key.\n * @return {*} The first string value associated with the key, or opt_default\n *     if there's no value.\n */\ngoog.Uri.QueryData.prototype.get = function(key, opt_default) {\n  if (!key) {\n    return opt_default;\n  }\n  var values = this.getValues(key);\n  return values.length > 0 ? String(values[0]) : opt_default;\n};\n\n\n/**\n * Sets the values for a key. If the key already exists, this will\n * override all of the existing values that correspond to the key.\n * @param {string} key The key to set values for.\n * @param {!Array<?>} values The values to set.\n */\ngoog.Uri.QueryData.prototype.setValues = function(key, values) {\n  this.remove(key);\n\n  if (values.length > 0) {\n    this.invalidateCache_();\n    this.keyMap_.set(this.getKeyName_(key), goog.array.clone(values));\n    this.count_ = goog.asserts.assertNumber(this.count_) + values.length;\n  }\n};\n\n\n/**\n * @return {string} Encoded query string.\n * @override\n */\ngoog.Uri.QueryData.prototype.toString = function() {\n  if (this.encodedQuery_) {\n    return this.encodedQuery_;\n  }\n\n  if (!this.keyMap_) {\n    return '';\n  }\n\n  var sb = [];\n\n  // In the past, we use this.getKeys() and this.getVals(), but that\n  // generates a lot of allocations as compared to simply iterating\n  // over the keys.\n  var keys = this.keyMap_.getKeys();\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var encodedKey = goog.string.urlEncode(key);\n    var val = this.getValues(key);\n    for (var j = 0; j < val.length; j++) {\n      var param = encodedKey;\n      // Ensure that null and undefined are encoded into the url as\n      // literal strings.\n      if (val[j] !== '') {\n        param += '=' + goog.string.urlEncode(val[j]);\n      }\n      sb.push(param);\n    }\n  }\n\n  return this.encodedQuery_ = sb.join('&');\n};\n\n\n/**\n * @throws URIError If URI is malformed (that is, if decodeURIComponent fails on\n *     any of the URI components).\n * @return {string} Decoded query string.\n */\ngoog.Uri.QueryData.prototype.toDecodedString = function() {\n  return goog.Uri.decodeOrEmpty_(this.toString());\n};\n\n\n/**\n * Invalidate the cache.\n * @private\n */\ngoog.Uri.QueryData.prototype.invalidateCache_ = function() {\n  this.encodedQuery_ = null;\n};\n\n\n/**\n * Removes all keys that are not in the provided list. (Modifies this object.)\n * @param {Array<string>} keys The desired keys.\n * @return {!goog.Uri.QueryData} a reference to this object.\n */\ngoog.Uri.QueryData.prototype.filterKeys = function(keys) {\n  this.ensureKeyMapInitialized_();\n  this.keyMap_.forEach(function(value, key) {\n    if (!goog.array.contains(keys, key)) {\n      this.remove(key);\n    }\n  }, this);\n  return this;\n};\n\n\n/**\n * Clone the query data instance.\n * @return {!goog.Uri.QueryData} New instance of the QueryData object.\n */\ngoog.Uri.QueryData.prototype.clone = function() {\n  var rv = new goog.Uri.QueryData();\n  rv.encodedQuery_ = this.encodedQuery_;\n  if (this.keyMap_) {\n    rv.keyMap_ = this.keyMap_.clone();\n    rv.count_ = this.count_;\n  }\n  return rv;\n};\n\n\n/**\n * Helper function to get the key name from a JavaScript object. Converts\n * the object to a string, and to lower case if necessary.\n * @private\n * @param {*} arg The object to get a key name from.\n * @return {string} valid key name which can be looked up in #keyMap_.\n */\ngoog.Uri.QueryData.prototype.getKeyName_ = function(arg) {\n  var keyName = String(arg);\n  if (this.ignoreCase_) {\n    keyName = keyName.toLowerCase();\n  }\n  return keyName;\n};\n\n\n/**\n * Ignore case in parameter names.\n * NOTE: If there are already key/value pairs in the QueryData, and\n * ignoreCase_ is set to false, the keys will all be lower-cased.\n * @param {boolean} ignoreCase whether this goog.Uri should ignore case.\n */\ngoog.Uri.QueryData.prototype.setIgnoreCase = function(ignoreCase) {\n  var resetKeys = ignoreCase && !this.ignoreCase_;\n  if (resetKeys) {\n    this.ensureKeyMapInitialized_();\n    this.invalidateCache_();\n    this.keyMap_.forEach(function(value, key) {\n      var lowerCase = key.toLowerCase();\n      if (key != lowerCase) {\n        this.remove(key);\n        this.setValues(lowerCase, value);\n      }\n    }, this);\n  }\n  this.ignoreCase_ = ignoreCase;\n};\n\n\n/**\n * Extends a query data object with another query data or map like object. This\n * operates 'in-place', it does not create a new QueryData object.\n *\n * @param {...(?goog.Uri.QueryData|?goog.structs.Map<?, ?>|?Object)} var_args\n *     The object from which key value pairs will be copied. Note: does not\n *     accept null.\n * @suppress {deprecated} Use deprecated goog.structs.forEach to allow different\n * types of parameters.\n */\ngoog.Uri.QueryData.prototype.extend = function(var_args) {\n  for (var i = 0; i < arguments.length; i++) {\n    var data = arguments[i];\n    goog.structs.forEach(\n        data, function(value, key) { this.add(key, value); }, this);\n  }\n};\n","// Copyright 2010 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Browser capability checks for the dom package.\n *\n */\n\n\ngoog.provide('goog.dom.BrowserFeature');\n\ngoog.require('goog.userAgent');\n\n\n/**\n * Enum of browser capabilities.\n * @enum {boolean}\n */\ngoog.dom.BrowserFeature = {\n  /**\n   * Whether attributes 'name' and 'type' can be added to an element after it's\n   * created. False in Internet Explorer prior to version 9.\n   */\n  CAN_ADD_NAME_OR_TYPE_ATTRIBUTES:\n      !goog.userAgent.IE || goog.userAgent.isDocumentModeOrHigher(9),\n\n  /**\n   * Whether we can use element.children to access an element's Element\n   * children. Available since Gecko 1.9.1, IE 9. (IE<9 also includes comment\n   * nodes in the collection.)\n   */\n  CAN_USE_CHILDREN_ATTRIBUTE: !goog.userAgent.GECKO && !goog.userAgent.IE ||\n      goog.userAgent.IE && goog.userAgent.isDocumentModeOrHigher(9) ||\n      goog.userAgent.GECKO && goog.userAgent.isVersionOrHigher('1.9.1'),\n\n  /**\n   * Opera, Safari 3, and Internet Explorer 9 all support innerText but they\n   * include text nodes in script and style tags. Not document-mode-dependent.\n   */\n  CAN_USE_INNER_TEXT:\n      (goog.userAgent.IE && !goog.userAgent.isVersionOrHigher('9')),\n\n  /**\n   * MSIE, Opera, and Safari>=4 support element.parentElement to access an\n   * element's parent if it is an Element.\n   */\n  CAN_USE_PARENT_ELEMENT_PROPERTY:\n      goog.userAgent.IE || goog.userAgent.OPERA || goog.userAgent.WEBKIT,\n\n  /**\n   * Whether NoScope elements need a scoped element written before them in\n   * innerHTML.\n   * MSDN: http://msdn.microsoft.com/en-us/library/ms533897(VS.85).aspx#1\n   */\n  INNER_HTML_NEEDS_SCOPED_ELEMENT: goog.userAgent.IE,\n\n  /**\n   * Whether we use legacy IE range API.\n   */\n  LEGACY_IE_RANGES:\n      goog.userAgent.IE && !goog.userAgent.isDocumentModeOrHigher(9)\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Utilities for manipulating the browser's Document Object Model\n * Inspiration taken *heavily* from mochikit (http://mochikit.com/).\n *\n * You can use {@link goog.dom.DomHelper} to create new dom helpers that refer\n * to a different document object.  This is useful if you are working with\n * frames or multiple windows.\n *\n * @author arv@google.com (Erik Arvidsson)\n * @suppress {strictMissingProperties}\n */\n\n\n// TODO(arv): Rename/refactor getTextContent and getRawTextContent. The problem\n// is that getTextContent should mimic the DOM3 textContent. We should add a\n// getInnerText (or getText) which tries to return the visible text, innerText.\n\n\ngoog.provide('goog.dom');\ngoog.provide('goog.dom.Appendable');\ngoog.provide('goog.dom.DomHelper');\n\ngoog.require('goog.array');\ngoog.require('goog.asserts');\ngoog.require('goog.dom.BrowserFeature');\ngoog.require('goog.dom.NodeType');\ngoog.require('goog.dom.TagName');\ngoog.require('goog.dom.safe');\ngoog.require('goog.html.SafeHtml');\ngoog.require('goog.html.uncheckedconversions');\ngoog.require('goog.math.Coordinate');\ngoog.require('goog.math.Size');\ngoog.require('goog.object');\ngoog.require('goog.string');\ngoog.require('goog.string.Unicode');\ngoog.require('goog.userAgent');\n\n\n/**\n * @define {boolean} Whether we know at compile time that the browser is in\n * quirks mode.\n */\ngoog.dom.ASSUME_QUIRKS_MODE = goog.define('goog.dom.ASSUME_QUIRKS_MODE', false);\n\n\n/**\n * @define {boolean} Whether we know at compile time that the browser is in\n * standards compliance mode.\n */\ngoog.dom.ASSUME_STANDARDS_MODE =\n    goog.define('goog.dom.ASSUME_STANDARDS_MODE', false);\n\n\n/**\n * Whether we know the compatibility mode at compile time.\n * @type {boolean}\n * @private\n */\ngoog.dom.COMPAT_MODE_KNOWN_ =\n    goog.dom.ASSUME_QUIRKS_MODE || goog.dom.ASSUME_STANDARDS_MODE;\n\n\n/**\n * Gets the DomHelper object for the document where the element resides.\n * @param {(Node|Window)=} opt_element If present, gets the DomHelper for this\n *     element.\n * @return {!goog.dom.DomHelper} The DomHelper.\n */\ngoog.dom.getDomHelper = function(opt_element) {\n  return opt_element ?\n      new goog.dom.DomHelper(goog.dom.getOwnerDocument(opt_element)) :\n      (goog.dom.defaultDomHelper_ ||\n       (goog.dom.defaultDomHelper_ = new goog.dom.DomHelper()));\n};\n\n\n/**\n * Cached default DOM helper.\n * @type {!goog.dom.DomHelper|undefined}\n * @private\n */\ngoog.dom.defaultDomHelper_;\n\n\n/**\n * Gets the document object being used by the dom library.\n * @return {!Document} Document object.\n */\ngoog.dom.getDocument = function() {\n  return document;\n};\n\n\n/**\n * Gets an element from the current document by element id.\n *\n * If an Element is passed in, it is returned.\n *\n * @param {string|Element} element Element ID or a DOM node.\n * @return {Element} The element with the given ID, or the node passed in.\n */\ngoog.dom.getElement = function(element) {\n  return goog.dom.getElementHelper_(document, element);\n};\n\n\n/**\n * Gets an element by id from the given document (if present).\n * If an element is given, it is returned.\n * @param {!Document} doc\n * @param {string|Element} element Element ID or a DOM node.\n * @return {Element} The resulting element.\n * @private\n */\ngoog.dom.getElementHelper_ = function(doc, element) {\n  return goog.isString(element) ? doc.getElementById(element) : element;\n};\n\n\n/**\n * Gets an element by id, asserting that the element is found.\n *\n * This is used when an element is expected to exist, and should fail with\n * an assertion error if it does not (if assertions are enabled).\n *\n * @param {string} id Element ID.\n * @return {!Element} The element with the given ID, if it exists.\n */\ngoog.dom.getRequiredElement = function(id) {\n  return goog.dom.getRequiredElementHelper_(document, id);\n};\n\n\n/**\n * Helper function for getRequiredElementHelper functions, both static and\n * on DomHelper.  Asserts the element with the given id exists.\n * @param {!Document} doc\n * @param {string} id\n * @return {!Element} The element with the given ID, if it exists.\n * @private\n */\ngoog.dom.getRequiredElementHelper_ = function(doc, id) {\n  // To prevent users passing in Elements as is permitted in getElement().\n  goog.asserts.assertString(id);\n  var element = goog.dom.getElementHelper_(doc, id);\n  element =\n      goog.asserts.assertElement(element, 'No element found with id: ' + id);\n  return element;\n};\n\n\n/**\n * Alias for getElement.\n * @param {string|Element} element Element ID or a DOM node.\n * @return {Element} The element with the given ID, or the node passed in.\n * @deprecated Use {@link goog.dom.getElement} instead.\n */\ngoog.dom.$ = goog.dom.getElement;\n\n\n/**\n * Gets elements by tag name.\n * @param {!goog.dom.TagName<T>} tagName\n * @param {(!Document|!Element)=} opt_parent Parent element or document where to\n *     look for elements. Defaults to document.\n * @return {!NodeList<R>} List of elements. The members of the list are\n *     {!Element} if tagName is not a member of goog.dom.TagName or more\n *     specific types if it is (e.g. {!HTMLAnchorElement} for\n *     goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.getElementsByTagName = function(tagName, opt_parent) {\n  var parent = opt_parent || document;\n  return parent.getElementsByTagName(String(tagName));\n};\n\n\n/**\n * Looks up elements by both tag and class name, using browser native functions\n * (`querySelectorAll`, `getElementsByTagName` or\n * `getElementsByClassName`) where possible. This function\n * is a useful, if limited, way of collecting a list of DOM elements\n * with certain characteristics.  `querySelectorAll` offers a\n * more powerful and general solution which allows matching on CSS3\n * selector expressions.\n *\n * Note that tag names are case sensitive in the SVG namespace, and this\n * function converts opt_tag to uppercase for comparisons. For queries in the\n * SVG namespace you should use querySelector or querySelectorAll instead.\n * https://bugzilla.mozilla.org/show_bug.cgi?id=963870\n * https://bugs.webkit.org/show_bug.cgi?id=83438\n *\n * @see {https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelectorAll}\n *\n * @param {(string|?goog.dom.TagName<T>)=} opt_tag Element tag name.\n * @param {?string=} opt_class Optional class name.\n * @param {(Document|Element)=} opt_el Optional element to look in.\n * @return {!IArrayLike<R>} Array-like list of elements (only a length property\n *     and numerical indices are guaranteed to exist). The members of the array\n *     are {!Element} if opt_tag is not a member of goog.dom.TagName or more\n *     specific types if it is (e.g. {!HTMLAnchorElement} for\n *     goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.getElementsByTagNameAndClass = function(opt_tag, opt_class, opt_el) {\n  return goog.dom.getElementsByTagNameAndClass_(\n      document, opt_tag, opt_class, opt_el);\n};\n\n\n/**\n * Gets the first element matching the tag and the class.\n *\n * @param {(string|?goog.dom.TagName<T>)=} opt_tag Element tag name.\n * @param {?string=} opt_class Optional class name.\n * @param {(Document|Element)=} opt_el Optional element to look in.\n * @return {?R} Reference to a DOM node. The return type is {?Element} if\n *     tagName is a string or a more specific type if it is a member of\n *     goog.dom.TagName (e.g. {?HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.getElementByTagNameAndClass = function(opt_tag, opt_class, opt_el) {\n  return goog.dom.getElementByTagNameAndClass_(\n      document, opt_tag, opt_class, opt_el);\n};\n\n\n/**\n * Returns a static, array-like list of the elements with the provided\n * className.\n *\n * @param {string} className the name of the class to look for.\n * @param {(Document|Element)=} opt_el Optional element to look in.\n * @return {!IArrayLike<!Element>} The items found with the class name provided.\n */\ngoog.dom.getElementsByClass = function(className, opt_el) {\n  var parent = opt_el || document;\n  if (goog.dom.canUseQuerySelector_(parent)) {\n    return parent.querySelectorAll('.' + className);\n  }\n  return goog.dom.getElementsByTagNameAndClass_(\n      document, '*', className, opt_el);\n};\n\n\n/**\n * Returns the first element with the provided className.\n *\n * @param {string} className the name of the class to look for.\n * @param {Element|Document=} opt_el Optional element to look in.\n * @return {Element} The first item with the class name provided.\n */\ngoog.dom.getElementByClass = function(className, opt_el) {\n  var parent = opt_el || document;\n  var retVal = null;\n  if (parent.getElementsByClassName) {\n    retVal = parent.getElementsByClassName(className)[0];\n  } else {\n    retVal =\n        goog.dom.getElementByTagNameAndClass_(document, '*', className, opt_el);\n  }\n  return retVal || null;\n};\n\n\n/**\n * Ensures an element with the given className exists, and then returns the\n * first element with the provided className.\n *\n * @param {string} className the name of the class to look for.\n * @param {!Element|!Document=} opt_root Optional element or document to look\n *     in.\n * @return {!Element} The first item with the class name provided.\n * @throws {goog.asserts.AssertionError} Thrown if no element is found.\n */\ngoog.dom.getRequiredElementByClass = function(className, opt_root) {\n  var retValue = goog.dom.getElementByClass(className, opt_root);\n  return goog.asserts.assert(\n      retValue, 'No element found with className: ' + className);\n};\n\n\n/**\n * Prefer the standardized (http://www.w3.org/TR/selectors-api/), native and\n * fast W3C Selectors API.\n * @param {!(Element|Document)} parent The parent document object.\n * @return {boolean} whether or not we can use parent.querySelector* APIs.\n * @private\n */\ngoog.dom.canUseQuerySelector_ = function(parent) {\n  return !!(parent.querySelectorAll && parent.querySelector);\n};\n\n\n/**\n * Helper for `getElementsByTagNameAndClass`.\n * @param {!Document} doc The document to get the elements in.\n * @param {(string|?goog.dom.TagName<T>)=} opt_tag Element tag name.\n * @param {?string=} opt_class Optional class name.\n * @param {(Document|Element)=} opt_el Optional element to look in.\n * @return {!IArrayLike<R>} Array-like list of elements (only a length property\n *     and numerical indices are guaranteed to exist). The members of the array\n *     are {!Element} if opt_tag is not a member of goog.dom.TagName or more\n *     specific types if it is (e.g. {!HTMLAnchorElement} for\n *     goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n * @private\n */\ngoog.dom.getElementsByTagNameAndClass_ = function(\n    doc, opt_tag, opt_class, opt_el) {\n  var parent = opt_el || doc;\n  var tagName =\n      (opt_tag && opt_tag != '*') ? String(opt_tag).toUpperCase() : '';\n\n  if (goog.dom.canUseQuerySelector_(parent) && (tagName || opt_class)) {\n    var query = tagName + (opt_class ? '.' + opt_class : '');\n    return parent.querySelectorAll(query);\n  }\n\n  // Use the native getElementsByClassName if available, under the assumption\n  // that even when the tag name is specified, there will be fewer elements to\n  // filter through when going by class than by tag name\n  if (opt_class && parent.getElementsByClassName) {\n    var els = parent.getElementsByClassName(opt_class);\n\n    if (tagName) {\n      var arrayLike = {};\n      var len = 0;\n\n      // Filter for specific tags if requested.\n      for (var i = 0, el; el = els[i]; i++) {\n        if (tagName == el.nodeName) {\n          arrayLike[len++] = el;\n        }\n      }\n      arrayLike.length = len;\n\n      return /** @type {!IArrayLike<!Element>} */ (arrayLike);\n    } else {\n      return els;\n    }\n  }\n\n  var els = parent.getElementsByTagName(tagName || '*');\n\n  if (opt_class) {\n    var arrayLike = {};\n    var len = 0;\n    for (var i = 0, el; el = els[i]; i++) {\n      var className = el.className;\n      // Check if className has a split function since SVG className does not.\n      if (typeof className.split == 'function' &&\n          goog.array.contains(className.split(/\\s+/), opt_class)) {\n        arrayLike[len++] = el;\n      }\n    }\n    arrayLike.length = len;\n    return /** @type {!IArrayLike<!Element>} */ (arrayLike);\n  } else {\n    return els;\n  }\n};\n\n\n/**\n * Helper for goog.dom.getElementByTagNameAndClass.\n *\n * @param {!Document} doc The document to get the elements in.\n * @param {(string|?goog.dom.TagName<T>)=} opt_tag Element tag name.\n * @param {?string=} opt_class Optional class name.\n * @param {(Document|Element)=} opt_el Optional element to look in.\n * @return {?R} Reference to a DOM node. The return type is {?Element} if\n *     tagName is a string or a more specific type if it is a member of\n *     goog.dom.TagName (e.g. {?HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n * @private\n */\ngoog.dom.getElementByTagNameAndClass_ = function(\n    doc, opt_tag, opt_class, opt_el) {\n  var parent = opt_el || doc;\n  var tag = (opt_tag && opt_tag != '*') ? String(opt_tag).toUpperCase() : '';\n  if (goog.dom.canUseQuerySelector_(parent) && (tag || opt_class)) {\n    return parent.querySelector(tag + (opt_class ? '.' + opt_class : ''));\n  }\n  var elements =\n      goog.dom.getElementsByTagNameAndClass_(doc, opt_tag, opt_class, opt_el);\n  return elements[0] || null;\n};\n\n\n\n/**\n * Alias for `getElementsByTagNameAndClass`.\n * @param {(string|?goog.dom.TagName<T>)=} opt_tag Element tag name.\n * @param {?string=} opt_class Optional class name.\n * @param {Element=} opt_el Optional element to look in.\n * @return {!IArrayLike<R>} Array-like list of elements (only a length property\n *     and numerical indices are guaranteed to exist). The members of the array\n *     are {!Element} if opt_tag is not a member of goog.dom.TagName or more\n *     specific types if it is (e.g. {!HTMLAnchorElement} for\n *     goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n * @deprecated Use {@link goog.dom.getElementsByTagNameAndClass} instead.\n */\ngoog.dom.$$ = goog.dom.getElementsByTagNameAndClass;\n\n\n/**\n * Sets multiple properties, and sometimes attributes, on an element. Note that\n * properties are simply object properties on the element instance, while\n * attributes are visible in the DOM. Many properties map to attributes with the\n * same names, some with different names, and there are also unmappable cases.\n *\n * This method sets properties by default (which means that custom attributes\n * are not supported). These are the exeptions (some of which is legacy):\n * - \"style\": Even though this is an attribute name, it is translated to a\n *   property, \"style.cssText\". Note that this property sanitizes and formats\n *   its value, unlike the attribute.\n * - \"class\": This is an attribute name, it is translated to the \"className\"\n *   property.\n * - \"for\": This is an attribute name, it is translated to the \"htmlFor\"\n *   property.\n * - Entries in {@see goog.dom.DIRECT_ATTRIBUTE_MAP_} are set as attributes,\n *   this is probably due to browser quirks.\n * - \"aria-*\", \"data-*\": Always set as attributes, they have no property\n *   counterparts.\n *\n * @param {Element} element DOM node to set properties on.\n * @param {Object} properties Hash of property:value pairs.\n *     Property values can be strings or goog.string.TypedString values (such as\n *     goog.html.SafeUrl).\n */\ngoog.dom.setProperties = function(element, properties) {\n  goog.object.forEach(properties, function(val, key) {\n    if (val && typeof val == 'object' && val.implementsGoogStringTypedString) {\n      val = val.getTypedStringValue();\n    }\n    if (key == 'style') {\n      element.style.cssText = val;\n    } else if (key == 'class') {\n      element.className = val;\n    } else if (key == 'for') {\n      element.htmlFor = val;\n    } else if (goog.dom.DIRECT_ATTRIBUTE_MAP_.hasOwnProperty(key)) {\n      element.setAttribute(goog.dom.DIRECT_ATTRIBUTE_MAP_[key], val);\n    } else if (\n        goog.string.startsWith(key, 'aria-') ||\n        goog.string.startsWith(key, 'data-')) {\n      element.setAttribute(key, val);\n    } else {\n      element[key] = val;\n    }\n  });\n};\n\n\n/**\n * Map of attributes that should be set using\n * element.setAttribute(key, val) instead of element[key] = val.  Used\n * by goog.dom.setProperties.\n *\n * @private {!Object<string, string>}\n * @const\n */\ngoog.dom.DIRECT_ATTRIBUTE_MAP_ = {\n  'cellpadding': 'cellPadding',\n  'cellspacing': 'cellSpacing',\n  'colspan': 'colSpan',\n  'frameborder': 'frameBorder',\n  'height': 'height',\n  'maxlength': 'maxLength',\n  'nonce': 'nonce',\n  'role': 'role',\n  'rowspan': 'rowSpan',\n  'type': 'type',\n  'usemap': 'useMap',\n  'valign': 'vAlign',\n  'width': 'width'\n};\n\n\n/**\n * Gets the dimensions of the viewport.\n *\n * Gecko Standards mode:\n * docEl.clientWidth  Width of viewport excluding scrollbar.\n * win.innerWidth     Width of viewport including scrollbar.\n * body.clientWidth   Width of body element.\n *\n * docEl.clientHeight Height of viewport excluding scrollbar.\n * win.innerHeight    Height of viewport including scrollbar.\n * body.clientHeight  Height of document.\n *\n * Gecko Backwards compatible mode:\n * docEl.clientWidth  Width of viewport excluding scrollbar.\n * win.innerWidth     Width of viewport including scrollbar.\n * body.clientWidth   Width of viewport excluding scrollbar.\n *\n * docEl.clientHeight Height of document.\n * win.innerHeight    Height of viewport including scrollbar.\n * body.clientHeight  Height of viewport excluding scrollbar.\n *\n * IE6/7 Standards mode:\n * docEl.clientWidth  Width of viewport excluding scrollbar.\n * win.innerWidth     Undefined.\n * body.clientWidth   Width of body element.\n *\n * docEl.clientHeight Height of viewport excluding scrollbar.\n * win.innerHeight    Undefined.\n * body.clientHeight  Height of document element.\n *\n * IE5 + IE6/7 Backwards compatible mode:\n * docEl.clientWidth  0.\n * win.innerWidth     Undefined.\n * body.clientWidth   Width of viewport excluding scrollbar.\n *\n * docEl.clientHeight 0.\n * win.innerHeight    Undefined.\n * body.clientHeight  Height of viewport excluding scrollbar.\n *\n * Opera 9 Standards and backwards compatible mode:\n * docEl.clientWidth  Width of viewport excluding scrollbar.\n * win.innerWidth     Width of viewport including scrollbar.\n * body.clientWidth   Width of viewport excluding scrollbar.\n *\n * docEl.clientHeight Height of document.\n * win.innerHeight    Height of viewport including scrollbar.\n * body.clientHeight  Height of viewport excluding scrollbar.\n *\n * WebKit:\n * Safari 2\n * docEl.clientHeight Same as scrollHeight.\n * docEl.clientWidth  Same as innerWidth.\n * win.innerWidth     Width of viewport excluding scrollbar.\n * win.innerHeight    Height of the viewport including scrollbar.\n * frame.innerHeight  Height of the viewport exluding scrollbar.\n *\n * Safari 3 (tested in 522)\n *\n * docEl.clientWidth  Width of viewport excluding scrollbar.\n * docEl.clientHeight Height of viewport excluding scrollbar in strict mode.\n * body.clientHeight  Height of viewport excluding scrollbar in quirks mode.\n *\n * @param {Window=} opt_window Optional window element to test.\n * @return {!goog.math.Size} Object with values 'width' and 'height'.\n */\ngoog.dom.getViewportSize = function(opt_window) {\n  // TODO(arv): This should not take an argument\n  return goog.dom.getViewportSize_(opt_window || window);\n};\n\n\n/**\n * Helper for `getViewportSize`.\n * @param {Window} win The window to get the view port size for.\n * @return {!goog.math.Size} Object with values 'width' and 'height'.\n * @private\n */\ngoog.dom.getViewportSize_ = function(win) {\n  var doc = win.document;\n  var el = goog.dom.isCss1CompatMode_(doc) ? doc.documentElement : doc.body;\n  return new goog.math.Size(el.clientWidth, el.clientHeight);\n};\n\n\n/**\n * Calculates the height of the document.\n *\n * @return {number} The height of the current document.\n */\ngoog.dom.getDocumentHeight = function() {\n  return goog.dom.getDocumentHeight_(window);\n};\n\n/**\n * Calculates the height of the document of the given window.\n *\n * @param {!Window} win The window whose document height to retrieve.\n * @return {number} The height of the document of the given window.\n */\ngoog.dom.getDocumentHeightForWindow = function(win) {\n  return goog.dom.getDocumentHeight_(win);\n};\n\n/**\n * Calculates the height of the document of the given window.\n *\n * Function code copied from the opensocial gadget api:\n *   gadgets.window.adjustHeight(opt_height)\n *\n * @private\n * @param {!Window} win The window whose document height to retrieve.\n * @return {number} The height of the document of the given window.\n */\ngoog.dom.getDocumentHeight_ = function(win) {\n  // NOTE(eae): This method will return the window size rather than the document\n  // size in webkit quirks mode.\n  var doc = win.document;\n  var height = 0;\n\n  if (doc) {\n    // Calculating inner content height is hard and different between\n    // browsers rendering in Strict vs. Quirks mode.  We use a combination of\n    // three properties within document.body and document.documentElement:\n    // - scrollHeight\n    // - offsetHeight\n    // - clientHeight\n    // These values differ significantly between browsers and rendering modes.\n    // But there are patterns.  It just takes a lot of time and persistence\n    // to figure out.\n\n    var body = doc.body;\n    var docEl = /** @type {!HTMLElement} */ (doc.documentElement);\n    if (!(docEl && body)) {\n      return 0;\n    }\n\n    // Get the height of the viewport\n    var vh = goog.dom.getViewportSize_(win).height;\n    if (goog.dom.isCss1CompatMode_(doc) && docEl.scrollHeight) {\n      // In Strict mode:\n      // The inner content height is contained in either:\n      //    document.documentElement.scrollHeight\n      //    document.documentElement.offsetHeight\n      // Based on studying the values output by different browsers,\n      // use the value that's NOT equal to the viewport height found above.\n      height =\n          docEl.scrollHeight != vh ? docEl.scrollHeight : docEl.offsetHeight;\n    } else {\n      // In Quirks mode:\n      // documentElement.clientHeight is equal to documentElement.offsetHeight\n      // except in IE.  In most browsers, document.documentElement can be used\n      // to calculate the inner content height.\n      // However, in other browsers (e.g. IE), document.body must be used\n      // instead.  How do we know which one to use?\n      // If document.documentElement.clientHeight does NOT equal\n      // document.documentElement.offsetHeight, then use document.body.\n      var sh = docEl.scrollHeight;\n      var oh = docEl.offsetHeight;\n      if (docEl.clientHeight != oh) {\n        sh = body.scrollHeight;\n        oh = body.offsetHeight;\n      }\n\n      // Detect whether the inner content height is bigger or smaller\n      // than the bounding box (viewport).  If bigger, take the larger\n      // value.  If smaller, take the smaller value.\n      if (sh > vh) {\n        // Content is larger\n        height = sh > oh ? sh : oh;\n      } else {\n        // Content is smaller\n        height = sh < oh ? sh : oh;\n      }\n    }\n  }\n\n  return height;\n};\n\n\n/**\n * Gets the page scroll distance as a coordinate object.\n *\n * @param {Window=} opt_window Optional window element to test.\n * @return {!goog.math.Coordinate} Object with values 'x' and 'y'.\n * @deprecated Use {@link goog.dom.getDocumentScroll} instead.\n */\ngoog.dom.getPageScroll = function(opt_window) {\n  var win = opt_window || goog.global || window;\n  return goog.dom.getDomHelper(win.document).getDocumentScroll();\n};\n\n\n/**\n * Gets the document scroll distance as a coordinate object.\n *\n * @return {!goog.math.Coordinate} Object with values 'x' and 'y'.\n */\ngoog.dom.getDocumentScroll = function() {\n  return goog.dom.getDocumentScroll_(document);\n};\n\n\n/**\n * Helper for `getDocumentScroll`.\n *\n * @param {!Document} doc The document to get the scroll for.\n * @return {!goog.math.Coordinate} Object with values 'x' and 'y'.\n * @private\n */\ngoog.dom.getDocumentScroll_ = function(doc) {\n  var el = goog.dom.getDocumentScrollElement_(doc);\n  var win = goog.dom.getWindow_(doc);\n  if (goog.userAgent.IE && goog.userAgent.isVersionOrHigher('10') &&\n      win.pageYOffset != el.scrollTop) {\n    // The keyboard on IE10 touch devices shifts the page using the pageYOffset\n    // without modifying scrollTop. For this case, we want the body scroll\n    // offsets.\n    return new goog.math.Coordinate(el.scrollLeft, el.scrollTop);\n  }\n  return new goog.math.Coordinate(\n      win.pageXOffset || el.scrollLeft, win.pageYOffset || el.scrollTop);\n};\n\n\n/**\n * Gets the document scroll element.\n * @return {!Element} Scrolling element.\n */\ngoog.dom.getDocumentScrollElement = function() {\n  return goog.dom.getDocumentScrollElement_(document);\n};\n\n\n/**\n * Helper for `getDocumentScrollElement`.\n * @param {!Document} doc The document to get the scroll element for.\n * @return {!Element} Scrolling element.\n * @private\n */\ngoog.dom.getDocumentScrollElement_ = function(doc) {\n  // Old WebKit needs body.scrollLeft in both quirks mode and strict mode. We\n  // also default to the documentElement if the document does not have a body\n  // (e.g. a SVG document).\n  // Uses http://dev.w3.org/csswg/cssom-view/#dom-document-scrollingelement to\n  // avoid trying to guess about browser behavior from the UA string.\n  if (doc.scrollingElement) {\n    return doc.scrollingElement;\n  }\n  if (!goog.userAgent.WEBKIT && goog.dom.isCss1CompatMode_(doc)) {\n    return doc.documentElement;\n  }\n  return doc.body || doc.documentElement;\n};\n\n\n/**\n * Gets the window object associated with the given document.\n *\n * @param {Document=} opt_doc  Document object to get window for.\n * @return {!Window} The window associated with the given document.\n */\ngoog.dom.getWindow = function(opt_doc) {\n  // TODO(arv): This should not take an argument.\n  return opt_doc ? goog.dom.getWindow_(opt_doc) : window;\n};\n\n\n/**\n * Helper for `getWindow`.\n *\n * @param {!Document} doc  Document object to get window for.\n * @return {!Window} The window associated with the given document.\n * @private\n */\ngoog.dom.getWindow_ = function(doc) {\n  return /** @type {!Window} */ (doc.parentWindow || doc.defaultView);\n};\n\n\n/**\n * Returns a dom node with a set of attributes.  This function accepts varargs\n * for subsequent nodes to be added.  Subsequent nodes will be added to the\n * first node as childNodes.\n *\n * So:\n * <code>createDom(goog.dom.TagName.DIV, null, createDom(goog.dom.TagName.P),\n * createDom(goog.dom.TagName.P));</code> would return a div with two child\n * paragraphs\n *\n * This function uses {@link goog.dom.setProperties} to set attributes: the\n * `opt_attributes` parameter follows the same rules.\n *\n * @param {string|!goog.dom.TagName<T>} tagName Tag to create.\n * @param {?Object|?Array<string>|string=} opt_attributes If object, then a map\n *     of name-value pairs for attributes. If a string, then this is the\n *     className of the new element. If an array, the elements will be joined\n *     together as the className of the new element.\n * @param {...(Object|string|Array|NodeList|null|undefined)} var_args Further\n *     DOM nodes or strings for text nodes. If one of the var_args is an array\n *     or NodeList, its elements will be added as childNodes instead.\n * @return {R} Reference to a DOM node. The return type is {!Element} if tagName\n *     is a string or a more specific type if it is a member of\n *     goog.dom.TagName (e.g. {!HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.createDom = function(tagName, opt_attributes, var_args) {\n  return goog.dom.createDom_(document, arguments);\n};\n\n\n/**\n * Helper for `createDom`.\n * @param {!Document} doc The document to create the DOM in.\n * @param {!Arguments} args Argument object passed from the callers. See\n *     `goog.dom.createDom` for details.\n * @return {!Element} Reference to a DOM node.\n * @private\n */\ngoog.dom.createDom_ = function(doc, args) {\n  var tagName = String(args[0]);\n  var attributes = args[1];\n\n  // Internet Explorer is dumb:\n  // name: https://msdn.microsoft.com/en-us/library/ms534184(v=vs.85).aspx\n  // type: https://msdn.microsoft.com/en-us/library/ms534700(v=vs.85).aspx\n  // Also does not allow setting of 'type' attribute on 'input' or 'button'.\n  if (!goog.dom.BrowserFeature.CAN_ADD_NAME_OR_TYPE_ATTRIBUTES && attributes &&\n      (attributes.name || attributes.type)) {\n    var tagNameArr = ['<', tagName];\n    if (attributes.name) {\n      tagNameArr.push(' name=\"', goog.string.htmlEscape(attributes.name), '\"');\n    }\n    if (attributes.type) {\n      tagNameArr.push(' type=\"', goog.string.htmlEscape(attributes.type), '\"');\n\n      // Clone attributes map to remove 'type' without mutating the input.\n      var clone = {};\n      goog.object.extend(clone, attributes);\n\n      // JSCompiler can't see how goog.object.extend added this property,\n      // because it was essentially added by reflection.\n      // So it needs to be quoted.\n      delete clone['type'];\n\n      attributes = clone;\n    }\n    tagNameArr.push('>');\n    tagName = tagNameArr.join('');\n  }\n\n  var element = doc.createElement(tagName);\n\n  if (attributes) {\n    if (goog.isString(attributes)) {\n      element.className = attributes;\n    } else if (goog.isArray(attributes)) {\n      element.className = attributes.join(' ');\n    } else {\n      goog.dom.setProperties(element, attributes);\n    }\n  }\n\n  if (args.length > 2) {\n    goog.dom.append_(doc, element, args, 2);\n  }\n\n  return element;\n};\n\n\n/**\n * Appends a node with text or other nodes.\n * @param {!Document} doc The document to create new nodes in.\n * @param {!Node} parent The node to append nodes to.\n * @param {!Arguments} args The values to add. See `goog.dom.append`.\n * @param {number} startIndex The index of the array to start from.\n * @private\n */\ngoog.dom.append_ = function(doc, parent, args, startIndex) {\n  function childHandler(child) {\n    // TODO(user): More coercion, ala MochiKit?\n    if (child) {\n      parent.appendChild(\n          goog.isString(child) ? doc.createTextNode(child) : child);\n    }\n  }\n\n  for (var i = startIndex; i < args.length; i++) {\n    var arg = args[i];\n    // TODO(attila): Fix isArrayLike to return false for a text node.\n    if (goog.isArrayLike(arg) && !goog.dom.isNodeLike(arg)) {\n      // If the argument is a node list, not a real array, use a clone,\n      // because forEach can't be used to mutate a NodeList.\n      goog.array.forEach(\n          goog.dom.isNodeList(arg) ? goog.array.toArray(arg) : arg,\n          childHandler);\n    } else {\n      childHandler(arg);\n    }\n  }\n};\n\n\n/**\n * Alias for `createDom`.\n * @param {string|!goog.dom.TagName<T>} tagName Tag to create.\n * @param {?Object|?Array<string>|string=} opt_attributes If object, then a map\n *     of name-value pairs for attributes. If a string, then this is the\n *     className of the new element. If an array, the elements will be joined\n *     together as the className of the new element.\n * @param {...(Object|string|Array|NodeList|null|undefined)} var_args Further\n *     DOM nodes or strings for text nodes. If one of the var_args is an array,\n *     its children will be added as childNodes instead.\n * @return {R} Reference to a DOM node. The return type is {!Element} if tagName\n *     is a string or a more specific type if it is a member of\n *     goog.dom.TagName (e.g. {!HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n * @deprecated Use {@link goog.dom.createDom} instead.\n */\ngoog.dom.$dom = goog.dom.createDom;\n\n\n/**\n * Creates a new element.\n * @param {string|!goog.dom.TagName<T>} name Tag to create.\n * @return {R} The new element. The return type is {!Element} if name is\n *     a string or a more specific type if it is a member of goog.dom.TagName\n *     (e.g. {!HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.createElement = function(name) {\n  return goog.dom.createElement_(document, name);\n};\n\n\n/**\n * Creates a new element.\n * @param {!Document} doc The document to create the element in.\n * @param {string|!goog.dom.TagName<T>} name Tag to create.\n * @return {R} The new element. The return type is {!Element} if name is\n *     a string or a more specific type if it is a member of goog.dom.TagName\n *     (e.g. {!HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n * @private\n */\ngoog.dom.createElement_ = function(doc, name) {\n  return doc.createElement(String(name));\n};\n\n\n/**\n * Creates a new text node.\n * @param {number|string} content Content.\n * @return {!Text} The new text node.\n */\ngoog.dom.createTextNode = function(content) {\n  return document.createTextNode(String(content));\n};\n\n\n/**\n * Create a table.\n * @param {number} rows The number of rows in the table.  Must be >= 1.\n * @param {number} columns The number of columns in the table.  Must be >= 1.\n * @param {boolean=} opt_fillWithNbsp If true, fills table entries with\n *     `goog.string.Unicode.NBSP` characters.\n * @return {!Element} The created table.\n */\ngoog.dom.createTable = function(rows, columns, opt_fillWithNbsp) {\n  // TODO(mlourenco): Return HTMLTableElement, also in prototype function.\n  // Callers need to be updated to e.g. not assign numbers to table.cellSpacing.\n  return goog.dom.createTable_(document, rows, columns, !!opt_fillWithNbsp);\n};\n\n\n/**\n * Create a table.\n * @param {!Document} doc Document object to use to create the table.\n * @param {number} rows The number of rows in the table.  Must be >= 1.\n * @param {number} columns The number of columns in the table.  Must be >= 1.\n * @param {boolean} fillWithNbsp If true, fills table entries with\n *     `goog.string.Unicode.NBSP` characters.\n * @return {!HTMLTableElement} The created table.\n * @private\n */\ngoog.dom.createTable_ = function(doc, rows, columns, fillWithNbsp) {\n  var table = goog.dom.createElement_(doc, goog.dom.TagName.TABLE);\n  var tbody =\n      table.appendChild(goog.dom.createElement_(doc, goog.dom.TagName.TBODY));\n  for (var i = 0; i < rows; i++) {\n    var tr = goog.dom.createElement_(doc, goog.dom.TagName.TR);\n    for (var j = 0; j < columns; j++) {\n      var td = goog.dom.createElement_(doc, goog.dom.TagName.TD);\n      // IE <= 9 will create a text node if we set text content to the empty\n      // string, so we avoid doing it unless necessary. This ensures that the\n      // same DOM tree is returned on all browsers.\n      if (fillWithNbsp) {\n        goog.dom.setTextContent(td, goog.string.Unicode.NBSP);\n      }\n      tr.appendChild(td);\n    }\n    tbody.appendChild(tr);\n  }\n  return table;\n};\n\n\n\n/**\n * Creates a new Node from constant strings of HTML markup.\n * @param {...!goog.string.Const} var_args The HTML strings to concatenate then\n *     convert into a node.\n * @return {!Node}\n */\ngoog.dom.constHtmlToNode = function(var_args) {\n  var stringArray = goog.array.map(arguments, goog.string.Const.unwrap);\n  var safeHtml =\n      goog.html.uncheckedconversions\n          .safeHtmlFromStringKnownToSatisfyTypeContract(\n              goog.string.Const.from(\n                  'Constant HTML string, that gets turned into a ' +\n                  'Node later, so it will be automatically balanced.'),\n              stringArray.join(''));\n  return goog.dom.safeHtmlToNode(safeHtml);\n};\n\n\n/**\n * Converts HTML markup into a node. This is a safe version of\n * `goog.dom.htmlToDocumentFragment` which is now deleted.\n * @param {!goog.html.SafeHtml} html The HTML markup to convert.\n * @return {!Node} The resulting node.\n */\ngoog.dom.safeHtmlToNode = function(html) {\n  return goog.dom.safeHtmlToNode_(document, html);\n};\n\n\n/**\n * Helper for `safeHtmlToNode`.\n * @param {!Document} doc The document.\n * @param {!goog.html.SafeHtml} html The HTML markup to convert.\n * @return {!Node} The resulting node.\n * @private\n */\ngoog.dom.safeHtmlToNode_ = function(doc, html) {\n  var tempDiv = goog.dom.createElement_(doc, goog.dom.TagName.DIV);\n  if (goog.dom.BrowserFeature.INNER_HTML_NEEDS_SCOPED_ELEMENT) {\n    goog.dom.safe.setInnerHtml(\n        tempDiv, goog.html.SafeHtml.concat(goog.html.SafeHtml.BR, html));\n    tempDiv.removeChild(goog.asserts.assert(tempDiv.firstChild));\n  } else {\n    goog.dom.safe.setInnerHtml(tempDiv, html);\n  }\n  return goog.dom.childrenToNode_(doc, tempDiv);\n};\n\n\n/**\n * Helper for `safeHtmlToNode_`.\n * @param {!Document} doc The document.\n * @param {!Node} tempDiv The input node.\n * @return {!Node} The resulting node.\n * @private\n */\ngoog.dom.childrenToNode_ = function(doc, tempDiv) {\n  if (tempDiv.childNodes.length == 1) {\n    return tempDiv.removeChild(goog.asserts.assert(tempDiv.firstChild));\n  } else {\n    var fragment = doc.createDocumentFragment();\n    while (tempDiv.firstChild) {\n      fragment.appendChild(tempDiv.firstChild);\n    }\n    return fragment;\n  }\n};\n\n\n/**\n * Returns true if the browser is in \"CSS1-compatible\" (standards-compliant)\n * mode, false otherwise.\n * @return {boolean} True if in CSS1-compatible mode.\n */\ngoog.dom.isCss1CompatMode = function() {\n  return goog.dom.isCss1CompatMode_(document);\n};\n\n\n/**\n * Returns true if the browser is in \"CSS1-compatible\" (standards-compliant)\n * mode, false otherwise.\n * @param {!Document} doc The document to check.\n * @return {boolean} True if in CSS1-compatible mode.\n * @private\n */\ngoog.dom.isCss1CompatMode_ = function(doc) {\n  if (goog.dom.COMPAT_MODE_KNOWN_) {\n    return goog.dom.ASSUME_STANDARDS_MODE;\n  }\n\n  return doc.compatMode == 'CSS1Compat';\n};\n\n\n/**\n * Determines if the given node can contain children, intended to be used for\n * HTML generation.\n *\n * IE natively supports node.canHaveChildren but has inconsistent behavior.\n * Prior to IE8 the base tag allows children and in IE9 all nodes return true\n * for canHaveChildren.\n *\n * In practice all non-IE browsers allow you to add children to any node, but\n * the behavior is inconsistent:\n *\n * <pre>\n *   var a = goog.dom.createElement(goog.dom.TagName.BR);\n *   a.appendChild(document.createTextNode('foo'));\n *   a.appendChild(document.createTextNode('bar'));\n *   console.log(a.childNodes.length);  // 2\n *   console.log(a.innerHTML);  // Chrome: \"\", IE9: \"foobar\", FF3.5: \"foobar\"\n * </pre>\n *\n * For more information, see:\n * http://dev.w3.org/html5/markup/syntax.html#syntax-elements\n *\n * TODO(user): Rename shouldAllowChildren() ?\n *\n * @param {Node} node The node to check.\n * @return {boolean} Whether the node can contain children.\n */\ngoog.dom.canHaveChildren = function(node) {\n  if (node.nodeType != goog.dom.NodeType.ELEMENT) {\n    return false;\n  }\n  switch (/** @type {!Element} */ (node).tagName) {\n    case String(goog.dom.TagName.APPLET):\n    case String(goog.dom.TagName.AREA):\n    case String(goog.dom.TagName.BASE):\n    case String(goog.dom.TagName.BR):\n    case String(goog.dom.TagName.COL):\n    case String(goog.dom.TagName.COMMAND):\n    case String(goog.dom.TagName.EMBED):\n    case String(goog.dom.TagName.FRAME):\n    case String(goog.dom.TagName.HR):\n    case String(goog.dom.TagName.IMG):\n    case String(goog.dom.TagName.INPUT):\n    case String(goog.dom.TagName.IFRAME):\n    case String(goog.dom.TagName.ISINDEX):\n    case String(goog.dom.TagName.KEYGEN):\n    case String(goog.dom.TagName.LINK):\n    case String(goog.dom.TagName.NOFRAMES):\n    case String(goog.dom.TagName.NOSCRIPT):\n    case String(goog.dom.TagName.META):\n    case String(goog.dom.TagName.OBJECT):\n    case String(goog.dom.TagName.PARAM):\n    case String(goog.dom.TagName.SCRIPT):\n    case String(goog.dom.TagName.SOURCE):\n    case String(goog.dom.TagName.STYLE):\n    case String(goog.dom.TagName.TRACK):\n    case String(goog.dom.TagName.WBR):\n      return false;\n  }\n  return true;\n};\n\n\n/**\n * Appends a child to a node.\n * @param {Node} parent Parent.\n * @param {Node} child Child.\n */\ngoog.dom.appendChild = function(parent, child) {\n  goog.asserts.assert(\n      parent != null && child != null,\n      'goog.dom.appendChild expects non-null arguments');\n  parent.appendChild(child);\n};\n\n\n/**\n * Appends a node with text or other nodes.\n * @param {!Node} parent The node to append nodes to.\n * @param {...goog.dom.Appendable} var_args The things to append to the node.\n *     If this is a Node it is appended as is.\n *     If this is a string then a text node is appended.\n *     If this is an array like object then fields 0 to length - 1 are appended.\n */\ngoog.dom.append = function(parent, var_args) {\n  goog.dom.append_(goog.dom.getOwnerDocument(parent), parent, arguments, 1);\n};\n\n\n/**\n * Removes all the child nodes on a DOM node.\n * @param {Node} node Node to remove children from.\n */\ngoog.dom.removeChildren = function(node) {\n  // Note: Iterations over live collections can be slow, this is the fastest\n  // we could find. The double parenthesis are used to prevent JsCompiler and\n  // strict warnings.\n  var child;\n  while ((child = node.firstChild)) {\n    node.removeChild(child);\n  }\n};\n\n\n/**\n * Inserts a new node before an existing reference node (i.e. as the previous\n * sibling). If the reference node has no parent, then does nothing.\n * @param {Node} newNode Node to insert.\n * @param {Node} refNode Reference node to insert before.\n */\ngoog.dom.insertSiblingBefore = function(newNode, refNode) {\n  goog.asserts.assert(\n      newNode != null && refNode != null,\n      'goog.dom.insertSiblingBefore expects non-null arguments');\n  if (refNode.parentNode) {\n    refNode.parentNode.insertBefore(newNode, refNode);\n  }\n};\n\n\n/**\n * Inserts a new node after an existing reference node (i.e. as the next\n * sibling). If the reference node has no parent, then does nothing.\n * @param {Node} newNode Node to insert.\n * @param {Node} refNode Reference node to insert after.\n */\ngoog.dom.insertSiblingAfter = function(newNode, refNode) {\n  goog.asserts.assert(\n      newNode != null && refNode != null,\n      'goog.dom.insertSiblingAfter expects non-null arguments');\n  if (refNode.parentNode) {\n    refNode.parentNode.insertBefore(newNode, refNode.nextSibling);\n  }\n};\n\n\n/**\n * Insert a child at a given index. If index is larger than the number of child\n * nodes that the parent currently has, the node is inserted as the last child\n * node.\n * @param {Element} parent The element into which to insert the child.\n * @param {Node} child The element to insert.\n * @param {number} index The index at which to insert the new child node. Must\n *     not be negative.\n */\ngoog.dom.insertChildAt = function(parent, child, index) {\n  // Note that if the second argument is null, insertBefore\n  // will append the child at the end of the list of children.\n  goog.asserts.assert(\n      parent != null, 'goog.dom.insertChildAt expects a non-null parent');\n  parent.insertBefore(child, parent.childNodes[index] || null);\n};\n\n\n/**\n * Removes a node from its parent.\n * @param {Node} node The node to remove.\n * @return {Node} The node removed if removed; else, null.\n */\ngoog.dom.removeNode = function(node) {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n};\n\n\n/**\n * Replaces a node in the DOM tree. Will do nothing if `oldNode` has no\n * parent.\n * @param {Node} newNode Node to insert.\n * @param {Node} oldNode Node to replace.\n */\ngoog.dom.replaceNode = function(newNode, oldNode) {\n  goog.asserts.assert(\n      newNode != null && oldNode != null,\n      'goog.dom.replaceNode expects non-null arguments');\n  var parent = oldNode.parentNode;\n  if (parent) {\n    parent.replaceChild(newNode, oldNode);\n  }\n};\n\n\n/**\n * Flattens an element. That is, removes it and replace it with its children.\n * Does nothing if the element is not in the document.\n * @param {Element} element The element to flatten.\n * @return {Element|undefined} The original element, detached from the document\n *     tree, sans children; or undefined, if the element was not in the document\n *     to begin with.\n */\ngoog.dom.flattenElement = function(element) {\n  var child, parent = element.parentNode;\n  if (parent && parent.nodeType != goog.dom.NodeType.DOCUMENT_FRAGMENT) {\n    // Use IE DOM method (supported by Opera too) if available\n    if (element.removeNode) {\n      return /** @type {Element} */ (element.removeNode(false));\n    } else {\n      // Move all children of the original node up one level.\n      while ((child = element.firstChild)) {\n        parent.insertBefore(child, element);\n      }\n\n      // Detach the original element.\n      return /** @type {Element} */ (goog.dom.removeNode(element));\n    }\n  }\n};\n\n\n/**\n * Returns an array containing just the element children of the given element.\n * @param {Element} element The element whose element children we want.\n * @return {!(Array<!Element>|NodeList<!Element>)} An array or array-like list\n *     of just the element children of the given element.\n */\ngoog.dom.getChildren = function(element) {\n  // We check if the children attribute is supported for child elements\n  // since IE8 misuses the attribute by also including comments.\n  if (goog.dom.BrowserFeature.CAN_USE_CHILDREN_ATTRIBUTE &&\n      element.children != undefined) {\n    return element.children;\n  }\n  // Fall back to manually filtering the element's child nodes.\n  return goog.array.filter(element.childNodes, function(node) {\n    return node.nodeType == goog.dom.NodeType.ELEMENT;\n  });\n};\n\n\n/**\n * Returns the first child node that is an element.\n * @param {Node} node The node to get the first child element of.\n * @return {Element} The first child node of `node` that is an element.\n */\ngoog.dom.getFirstElementChild = function(node) {\n  if (goog.isDef(node.firstElementChild)) {\n    return /** @type {!Element} */ (node).firstElementChild;\n  }\n  return goog.dom.getNextElementNode_(node.firstChild, true);\n};\n\n\n/**\n * Returns the last child node that is an element.\n * @param {Node} node The node to get the last child element of.\n * @return {Element} The last child node of `node` that is an element.\n */\ngoog.dom.getLastElementChild = function(node) {\n  if (goog.isDef(node.lastElementChild)) {\n    return /** @type {!Element} */ (node).lastElementChild;\n  }\n  return goog.dom.getNextElementNode_(node.lastChild, false);\n};\n\n\n/**\n * Returns the first next sibling that is an element.\n * @param {Node} node The node to get the next sibling element of.\n * @return {Element} The next sibling of `node` that is an element.\n */\ngoog.dom.getNextElementSibling = function(node) {\n  if (goog.isDef(node.nextElementSibling)) {\n    return /** @type {!Element} */ (node).nextElementSibling;\n  }\n  return goog.dom.getNextElementNode_(node.nextSibling, true);\n};\n\n\n/**\n * Returns the first previous sibling that is an element.\n * @param {Node} node The node to get the previous sibling element of.\n * @return {Element} The first previous sibling of `node` that is\n *     an element.\n */\ngoog.dom.getPreviousElementSibling = function(node) {\n  if (goog.isDef(node.previousElementSibling)) {\n    return /** @type {!Element} */ (node).previousElementSibling;\n  }\n  return goog.dom.getNextElementNode_(node.previousSibling, false);\n};\n\n\n/**\n * Returns the first node that is an element in the specified direction,\n * starting with `node`.\n * @param {Node} node The node to get the next element from.\n * @param {boolean} forward Whether to look forwards or backwards.\n * @return {Element} The first element.\n * @private\n */\ngoog.dom.getNextElementNode_ = function(node, forward) {\n  while (node && node.nodeType != goog.dom.NodeType.ELEMENT) {\n    node = forward ? node.nextSibling : node.previousSibling;\n  }\n\n  return /** @type {Element} */ (node);\n};\n\n\n/**\n * Returns the next node in source order from the given node.\n * @param {Node} node The node.\n * @return {Node} The next node in the DOM tree, or null if this was the last\n *     node.\n */\ngoog.dom.getNextNode = function(node) {\n  if (!node) {\n    return null;\n  }\n\n  if (node.firstChild) {\n    return node.firstChild;\n  }\n\n  while (node && !node.nextSibling) {\n    node = node.parentNode;\n  }\n\n  return node ? node.nextSibling : null;\n};\n\n\n/**\n * Returns the previous node in source order from the given node.\n * @param {Node} node The node.\n * @return {Node} The previous node in the DOM tree, or null if this was the\n *     first node.\n */\ngoog.dom.getPreviousNode = function(node) {\n  if (!node) {\n    return null;\n  }\n\n  if (!node.previousSibling) {\n    return node.parentNode;\n  }\n\n  node = node.previousSibling;\n  while (node && node.lastChild) {\n    node = node.lastChild;\n  }\n\n  return node;\n};\n\n\n/**\n * Whether the object looks like a DOM node.\n * @param {?} obj The object being tested for node likeness.\n * @return {boolean} Whether the object looks like a DOM node.\n */\ngoog.dom.isNodeLike = function(obj) {\n  return goog.isObject(obj) && obj.nodeType > 0;\n};\n\n\n/**\n * Whether the object looks like an Element.\n * @param {?} obj The object being tested for Element likeness.\n * @return {boolean} Whether the object looks like an Element.\n */\ngoog.dom.isElement = function(obj) {\n  return goog.isObject(obj) && obj.nodeType == goog.dom.NodeType.ELEMENT;\n};\n\n\n/**\n * Returns true if the specified value is a Window object. This includes the\n * global window for HTML pages, and iframe windows.\n * @param {?} obj Variable to test.\n * @return {boolean} Whether the variable is a window.\n */\ngoog.dom.isWindow = function(obj) {\n  return goog.isObject(obj) && obj['window'] == obj;\n};\n\n\n/**\n * Returns an element's parent, if it's an Element.\n * @param {Element} element The DOM element.\n * @return {Element} The parent, or null if not an Element.\n */\ngoog.dom.getParentElement = function(element) {\n  var parent;\n  if (goog.dom.BrowserFeature.CAN_USE_PARENT_ELEMENT_PROPERTY) {\n    var isIe9 = goog.userAgent.IE && goog.userAgent.isVersionOrHigher('9') &&\n        !goog.userAgent.isVersionOrHigher('10');\n    // SVG elements in IE9 can't use the parentElement property.\n    // goog.global['SVGElement'] is not defined in IE9 quirks mode.\n    if (!(isIe9 && goog.global['SVGElement'] &&\n          element instanceof goog.global['SVGElement'])) {\n      parent = element.parentElement;\n      if (parent) {\n        return parent;\n      }\n    }\n  }\n  parent = element.parentNode;\n  return goog.dom.isElement(parent) ? /** @type {!Element} */ (parent) : null;\n};\n\n\n/**\n * Whether a node contains another node.\n * @param {?Node|undefined} parent The node that should contain the other node.\n * @param {?Node|undefined} descendant The node to test presence of.\n * @return {boolean} Whether the parent node contains the descendant node.\n */\ngoog.dom.contains = function(parent, descendant) {\n  if (!parent || !descendant) {\n    return false;\n  }\n  // We use browser specific methods for this if available since it is faster\n  // that way.\n\n  // IE DOM\n  if (parent.contains && descendant.nodeType == goog.dom.NodeType.ELEMENT) {\n    return parent == descendant || parent.contains(descendant);\n  }\n\n  // W3C DOM Level 3\n  if (typeof parent.compareDocumentPosition != 'undefined') {\n    return parent == descendant ||\n        Boolean(parent.compareDocumentPosition(descendant) & 16);\n  }\n\n  // W3C DOM Level 1\n  while (descendant && parent != descendant) {\n    descendant = descendant.parentNode;\n  }\n  return descendant == parent;\n};\n\n\n/**\n * Compares the document order of two nodes, returning 0 if they are the same\n * node, a negative number if node1 is before node2, and a positive number if\n * node2 is before node1.  Note that we compare the order the tags appear in the\n * document so in the tree <b><i>text</i></b> the B node is considered to be\n * before the I node.\n *\n * @param {Node} node1 The first node to compare.\n * @param {Node} node2 The second node to compare.\n * @return {number} 0 if the nodes are the same node, a negative number if node1\n *     is before node2, and a positive number if node2 is before node1.\n */\ngoog.dom.compareNodeOrder = function(node1, node2) {\n  // Fall out quickly for equality.\n  if (node1 == node2) {\n    return 0;\n  }\n\n  // Use compareDocumentPosition where available\n  if (node1.compareDocumentPosition) {\n    // 4 is the bitmask for FOLLOWS.\n    return node1.compareDocumentPosition(node2) & 2 ? 1 : -1;\n  }\n\n  // Special case for document nodes on IE 7 and 8.\n  if (goog.userAgent.IE && !goog.userAgent.isDocumentModeOrHigher(9)) {\n    if (node1.nodeType == goog.dom.NodeType.DOCUMENT) {\n      return -1;\n    }\n    if (node2.nodeType == goog.dom.NodeType.DOCUMENT) {\n      return 1;\n    }\n  }\n\n  // Process in IE using sourceIndex - we check to see if the first node has\n  // a source index or if its parent has one.\n  if ('sourceIndex' in node1 ||\n      (node1.parentNode && 'sourceIndex' in node1.parentNode)) {\n    var isElement1 = node1.nodeType == goog.dom.NodeType.ELEMENT;\n    var isElement2 = node2.nodeType == goog.dom.NodeType.ELEMENT;\n\n    if (isElement1 && isElement2) {\n      return node1.sourceIndex - node2.sourceIndex;\n    } else {\n      var parent1 = node1.parentNode;\n      var parent2 = node2.parentNode;\n\n      if (parent1 == parent2) {\n        return goog.dom.compareSiblingOrder_(node1, node2);\n      }\n\n      if (!isElement1 && goog.dom.contains(parent1, node2)) {\n        return -1 * goog.dom.compareParentsDescendantNodeIe_(node1, node2);\n      }\n\n\n      if (!isElement2 && goog.dom.contains(parent2, node1)) {\n        return goog.dom.compareParentsDescendantNodeIe_(node2, node1);\n      }\n\n      return (isElement1 ? node1.sourceIndex : parent1.sourceIndex) -\n          (isElement2 ? node2.sourceIndex : parent2.sourceIndex);\n    }\n  }\n\n  // For Safari, we compare ranges.\n  var doc = goog.dom.getOwnerDocument(node1);\n\n  var range1, range2;\n  range1 = doc.createRange();\n  range1.selectNode(node1);\n  range1.collapse(true);\n\n  range2 = doc.createRange();\n  range2.selectNode(node2);\n  range2.collapse(true);\n\n  return range1.compareBoundaryPoints(\n      goog.global['Range'].START_TO_END, range2);\n};\n\n\n/**\n * Utility function to compare the position of two nodes, when\n * `textNode`'s parent is an ancestor of `node`.  If this entry\n * condition is not met, this function will attempt to reference a null object.\n * @param {!Node} textNode The textNode to compare.\n * @param {Node} node The node to compare.\n * @return {number} -1 if node is before textNode, +1 otherwise.\n * @private\n */\ngoog.dom.compareParentsDescendantNodeIe_ = function(textNode, node) {\n  var parent = textNode.parentNode;\n  if (parent == node) {\n    // If textNode is a child of node, then node comes first.\n    return -1;\n  }\n  var sibling = node;\n  while (sibling.parentNode != parent) {\n    sibling = sibling.parentNode;\n  }\n  return goog.dom.compareSiblingOrder_(sibling, textNode);\n};\n\n\n/**\n * Utility function to compare the position of two nodes known to be non-equal\n * siblings.\n * @param {Node} node1 The first node to compare.\n * @param {!Node} node2 The second node to compare.\n * @return {number} -1 if node1 is before node2, +1 otherwise.\n * @private\n */\ngoog.dom.compareSiblingOrder_ = function(node1, node2) {\n  var s = node2;\n  while ((s = s.previousSibling)) {\n    if (s == node1) {\n      // We just found node1 before node2.\n      return -1;\n    }\n  }\n\n  // Since we didn't find it, node1 must be after node2.\n  return 1;\n};\n\n\n/**\n * Find the deepest common ancestor of the given nodes.\n * @param {...Node} var_args The nodes to find a common ancestor of.\n * @return {Node} The common ancestor of the nodes, or null if there is none.\n *     null will only be returned if two or more of the nodes are from different\n *     documents.\n */\ngoog.dom.findCommonAncestor = function(var_args) {\n  var i, count = arguments.length;\n  if (!count) {\n    return null;\n  } else if (count == 1) {\n    return arguments[0];\n  }\n\n  var paths = [];\n  var minLength = Infinity;\n  for (i = 0; i < count; i++) {\n    // Compute the list of ancestors.\n    var ancestors = [];\n    var node = arguments[i];\n    while (node) {\n      ancestors.unshift(node);\n      node = node.parentNode;\n    }\n\n    // Save the list for comparison.\n    paths.push(ancestors);\n    minLength = Math.min(minLength, ancestors.length);\n  }\n  var output = null;\n  for (i = 0; i < minLength; i++) {\n    var first = paths[0][i];\n    for (var j = 1; j < count; j++) {\n      if (first != paths[j][i]) {\n        return output;\n      }\n    }\n    output = first;\n  }\n  return output;\n};\n\n\n/**\n * Returns whether node is in a document or detached. Throws an error if node\n * itself is a document. This specifically handles two cases beyond naive use of\n * builtins: (1) it works correctly in IE, and (2) it works for elements from\n * different documents/iframes. If neither of these considerations are relevant\n * then a simple `document.contains(node)` may be used instead.\n * @param {!Node} node\n * @return {boolean}\n */\ngoog.dom.isInDocument = function(node) {\n  return (node.ownerDocument.compareDocumentPosition(node) & 16) == 16;\n};\n\n\n/**\n * Returns the owner document for a node.\n * @param {Node|Window} node The node to get the document for.\n * @return {!Document} The document owning the node.\n */\ngoog.dom.getOwnerDocument = function(node) {\n  // TODO(nnaze): Update param signature to be non-nullable.\n  goog.asserts.assert(node, 'Node cannot be null or undefined.');\n  return /** @type {!Document} */ (\n      node.nodeType == goog.dom.NodeType.DOCUMENT ? node : node.ownerDocument ||\n              node.document);\n};\n\n\n/**\n * Cross-browser function for getting the document element of a frame or iframe.\n * @param {Element} frame Frame element.\n * @return {!Document} The frame content document.\n */\ngoog.dom.getFrameContentDocument = function(frame) {\n  return frame.contentDocument ||\n      /** @type {!HTMLFrameElement} */ (frame).contentWindow.document;\n};\n\n\n/**\n * Cross-browser function for getting the window of a frame or iframe.\n * @param {Element} frame Frame element.\n * @return {Window} The window associated with the given frame, or null if none\n *     exists.\n */\ngoog.dom.getFrameContentWindow = function(frame) {\n  try {\n    return frame.contentWindow ||\n        (frame.contentDocument ? goog.dom.getWindow(frame.contentDocument) :\n                                 null);\n  } catch (e) {\n    // NOTE(user): In IE8, checking the contentWindow or contentDocument\n    // properties will throw a \"Unspecified Error\" exception if the iframe is\n    // not inserted in the DOM. If we get this we can be sure that no window\n    // exists, so return null.\n  }\n  return null;\n};\n\n\n/**\n * Sets the text content of a node, with cross-browser support.\n * @param {Node} node The node to change the text content of.\n * @param {string|number} text The value that should replace the node's content.\n */\ngoog.dom.setTextContent = function(node, text) {\n  goog.asserts.assert(\n      node != null,\n      'goog.dom.setTextContent expects a non-null value for node');\n\n  if ('textContent' in node) {\n    node.textContent = text;\n  } else if (node.nodeType == goog.dom.NodeType.TEXT) {\n    /** @type {!Text} */ (node).data = String(text);\n  } else if (\n      node.firstChild && node.firstChild.nodeType == goog.dom.NodeType.TEXT) {\n    // If the first child is a text node we just change its data and remove the\n    // rest of the children.\n    while (node.lastChild != node.firstChild) {\n      node.removeChild(goog.asserts.assert(node.lastChild));\n    }\n    /** @type {!Text} */ (node.firstChild).data = String(text);\n  } else {\n    goog.dom.removeChildren(node);\n    var doc = goog.dom.getOwnerDocument(node);\n    node.appendChild(doc.createTextNode(String(text)));\n  }\n};\n\n\n/**\n * Gets the outerHTML of a node, which is like innerHTML, except that it\n * actually contains the HTML of the node itself.\n * @param {Element} element The element to get the HTML of.\n * @return {string} The outerHTML of the given element.\n */\ngoog.dom.getOuterHtml = function(element) {\n  goog.asserts.assert(\n      element !== null,\n      'goog.dom.getOuterHtml expects a non-null value for element');\n  // IE, Opera and WebKit all have outerHTML.\n  if ('outerHTML' in element) {\n    return element.outerHTML;\n  } else {\n    var doc = goog.dom.getOwnerDocument(element);\n    var div = goog.dom.createElement_(doc, goog.dom.TagName.DIV);\n    div.appendChild(element.cloneNode(true));\n    return div.innerHTML;\n  }\n};\n\n\n/**\n * Finds the first descendant node that matches the filter function, using depth\n * first search. This function offers the most general purpose way of finding a\n * matching element.\n *\n * Prefer using `querySelector` if the matching criteria can be expressed as a\n * CSS selector, or `goog.dom.findElement` if you would filter for `nodeType ==\n * Node.ELEMENT_NODE`.\n *\n * @param {Node} root The root of the tree to search.\n * @param {function(Node) : boolean} p The filter function.\n * @return {Node|undefined} The found node or undefined if none is found.\n */\ngoog.dom.findNode = function(root, p) {\n  var rv = [];\n  var found = goog.dom.findNodes_(root, p, rv, true);\n  return found ? rv[0] : undefined;\n};\n\n\n/**\n * Finds all the descendant nodes that match the filter function, using depth\n * first search. This function offers the most general-purpose way\n * of finding a set of matching elements.\n *\n * Prefer using `querySelectorAll` if the matching criteria can be expressed as\n * a CSS selector, or `goog.dom.findElements` if you would filter for\n * `nodeType == Node.ELEMENT_NODE`.\n *\n * @param {Node} root The root of the tree to search.\n * @param {function(Node) : boolean} p The filter function.\n * @return {!Array<!Node>} The found nodes or an empty array if none are found.\n */\ngoog.dom.findNodes = function(root, p) {\n  var rv = [];\n  goog.dom.findNodes_(root, p, rv, false);\n  return rv;\n};\n\n\n/**\n * Finds the first or all the descendant nodes that match the filter function,\n * using a depth first search.\n * @param {Node} root The root of the tree to search.\n * @param {function(Node) : boolean} p The filter function.\n * @param {!Array<!Node>} rv The found nodes are added to this array.\n * @param {boolean} findOne If true we exit after the first found node.\n * @return {boolean} Whether the search is complete or not. True in case findOne\n *     is true and the node is found. False otherwise.\n * @private\n */\ngoog.dom.findNodes_ = function(root, p, rv, findOne) {\n  if (root != null) {\n    var child = root.firstChild;\n    while (child) {\n      if (p(child)) {\n        rv.push(child);\n        if (findOne) {\n          return true;\n        }\n      }\n      if (goog.dom.findNodes_(child, p, rv, findOne)) {\n        return true;\n      }\n      child = child.nextSibling;\n    }\n  }\n  return false;\n};\n\n\n/**\n * Finds the first descendant element (excluding `root`) that matches the filter\n * function, using depth first search. Prefer using `querySelector` if the\n * matching criteria can be expressed as a CSS selector.\n *\n * @param {!Element | !Document} root\n * @param {function(!Element): boolean} pred Filter function.\n * @return {?Element} First matching element or null if there is none.\n */\ngoog.dom.findElement = function(root, pred) {\n  var stack = goog.dom.getChildrenReverse_(root);\n  while (stack.length > 0) {\n    var next = stack.pop();\n    if (pred(next)) return next;\n    for (var c = next.lastElementChild; c; c = c.previousElementSibling) {\n      stack.push(c);\n    }\n  }\n  return null;\n};\n\n\n/**\n * Finds all the descendant elements (excluding `root`) that match the filter\n * function, using depth first search. Prefer using `querySelectorAll` if the\n * matching criteria can be expressed as a CSS selector.\n *\n * @param {!Element | !Document} root\n * @param {function(!Element): boolean} pred Filter function.\n * @return {!Array<!Element>}\n */\ngoog.dom.findElements = function(root, pred) {\n  var result = [], stack = goog.dom.getChildrenReverse_(root);\n  while (stack.length > 0) {\n    var next = stack.pop();\n    if (pred(next)) result.push(next);\n    for (var c = next.lastElementChild; c; c = c.previousElementSibling) {\n      stack.push(c);\n    }\n  }\n  return result;\n};\n\n\n/**\n * @param {!Element | !Document} node\n * @return {!Array<!Element>} node's child elements in reverse order.\n * @private\n */\ngoog.dom.getChildrenReverse_ = function(node) {\n  // document.lastElementChild doesn't exist in IE9; fall back to\n  // documentElement.\n  if (node.nodeType == goog.dom.NodeType.DOCUMENT) {\n    return [node.documentElement];\n  } else {\n    var children = [];\n    for (var c = node.lastElementChild; c; c = c.previousElementSibling) {\n      children.push(c);\n    }\n    return children;\n  }\n};\n\n\n/**\n * Map of tags whose content to ignore when calculating text length.\n * @private {!Object<string, number>}\n * @const\n */\ngoog.dom.TAGS_TO_IGNORE_ = {\n  'SCRIPT': 1,\n  'STYLE': 1,\n  'HEAD': 1,\n  'IFRAME': 1,\n  'OBJECT': 1\n};\n\n\n/**\n * Map of tags which have predefined values with regard to whitespace.\n * @private {!Object<string, string>}\n * @const\n */\ngoog.dom.PREDEFINED_TAG_VALUES_ = {\n  'IMG': ' ',\n  'BR': '\\n'\n};\n\n\n/**\n * Returns true if the element has a tab index that allows it to receive\n * keyboard focus (tabIndex >= 0), false otherwise.  Note that some elements\n * natively support keyboard focus, even if they have no tab index.\n * @param {!Element} element Element to check.\n * @return {boolean} Whether the element has a tab index that allows keyboard\n *     focus.\n */\ngoog.dom.isFocusableTabIndex = function(element) {\n  return goog.dom.hasSpecifiedTabIndex_(element) &&\n      goog.dom.isTabIndexFocusable_(element);\n};\n\n\n/**\n * Enables or disables keyboard focus support on the element via its tab index.\n * Only elements for which {@link goog.dom.isFocusableTabIndex} returns true\n * (or elements that natively support keyboard focus, like form elements) can\n * receive keyboard focus.  See http://go/tabindex for more info.\n * @param {Element} element Element whose tab index is to be changed.\n * @param {boolean} enable Whether to set or remove a tab index on the element\n *     that supports keyboard focus.\n */\ngoog.dom.setFocusableTabIndex = function(element, enable) {\n  if (enable) {\n    element.tabIndex = 0;\n  } else {\n    // Set tabIndex to -1 first, then remove it. This is a workaround for\n    // Safari (confirmed in version 4 on Windows). When removing the attribute\n    // without setting it to -1 first, the element remains keyboard focusable\n    // despite not having a tabIndex attribute anymore.\n    element.tabIndex = -1;\n    element.removeAttribute('tabIndex');  // Must be camelCase!\n  }\n};\n\n\n/**\n * Returns true if the element can be focused, i.e. it has a tab index that\n * allows it to receive keyboard focus (tabIndex >= 0), or it is an element\n * that natively supports keyboard focus.\n * @param {!Element} element Element to check.\n * @return {boolean} Whether the element allows keyboard focus.\n */\ngoog.dom.isFocusable = function(element) {\n  var focusable;\n  // Some elements can have unspecified tab index and still receive focus.\n  if (goog.dom.nativelySupportsFocus_(element)) {\n    // Make sure the element is not disabled ...\n    focusable = !element.disabled &&\n        // ... and if a tab index is specified, it allows focus.\n        (!goog.dom.hasSpecifiedTabIndex_(element) ||\n         goog.dom.isTabIndexFocusable_(element));\n  } else {\n    focusable = goog.dom.isFocusableTabIndex(element);\n  }\n\n  // IE requires elements to be visible in order to focus them.\n  return focusable && goog.userAgent.IE ?\n      goog.dom.hasNonZeroBoundingRect_(/** @type {!HTMLElement} */ (element)) :\n      focusable;\n};\n\n\n/**\n * Returns true if the element has a specified tab index.\n * @param {!Element} element Element to check.\n * @return {boolean} Whether the element has a specified tab index.\n * @private\n */\ngoog.dom.hasSpecifiedTabIndex_ = function(element) {\n  // IE8 and below don't support hasAttribute(), instead check whether the\n  // 'tabindex' attributeNode is specified. Otherwise check hasAttribute().\n  if (goog.userAgent.IE && !goog.userAgent.isVersionOrHigher('9')) {\n    var attrNode = element.getAttributeNode('tabindex');  // Must be lowercase!\n    return goog.isDefAndNotNull(attrNode) && attrNode.specified;\n  } else {\n    return element.hasAttribute('tabindex');\n  }\n};\n\n\n/**\n * Returns true if the element's tab index allows the element to be focused.\n * @param {!Element} element Element to check.\n * @return {boolean} Whether the element's tab index allows focus.\n * @private\n */\ngoog.dom.isTabIndexFocusable_ = function(element) {\n  var index = /** @type {!HTMLElement} */ (element).tabIndex;\n  // NOTE: IE9 puts tabIndex in 16-bit int, e.g. -2 is 65534.\n  return goog.isNumber(index) && index >= 0 && index < 32768;\n};\n\n\n/**\n * Returns true if the element is focusable even when tabIndex is not set.\n * @param {!Element} element Element to check.\n * @return {boolean} Whether the element natively supports focus.\n * @private\n */\ngoog.dom.nativelySupportsFocus_ = function(element) {\n  return (\n      element.tagName == goog.dom.TagName.A && element.hasAttribute('href') ||\n      element.tagName == goog.dom.TagName.INPUT ||\n      element.tagName == goog.dom.TagName.TEXTAREA ||\n      element.tagName == goog.dom.TagName.SELECT ||\n      element.tagName == goog.dom.TagName.BUTTON);\n};\n\n\n/**\n * Returns true if the element has a bounding rectangle that would be visible\n * (i.e. its width and height are greater than zero).\n * @param {!HTMLElement} element Element to check.\n * @return {boolean} Whether the element has a non-zero bounding rectangle.\n * @private\n */\ngoog.dom.hasNonZeroBoundingRect_ = function(element) {\n  var rect;\n  if (!goog.isFunction(element['getBoundingClientRect']) ||\n      // In IE, getBoundingClientRect throws on detached nodes.\n      (goog.userAgent.IE && element.parentElement == null)) {\n    rect = {'height': element.offsetHeight, 'width': element.offsetWidth};\n  } else {\n    rect = element.getBoundingClientRect();\n  }\n  return goog.isDefAndNotNull(rect) && rect.height > 0 && rect.width > 0;\n};\n\n\n/**\n * Returns the text content of the current node, without markup and invisible\n * symbols. New lines are stripped and whitespace is collapsed,\n * such that each character would be visible.\n *\n * In browsers that support it, innerText is used.  Other browsers attempt to\n * simulate it via node traversal.  Line breaks are canonicalized in IE.\n *\n * @param {Node} node The node from which we are getting content.\n * @return {string} The text content.\n */\ngoog.dom.getTextContent = function(node) {\n  var textContent;\n  // Note(arv): IE9, Opera, and Safari 3 support innerText but they include\n  // text nodes in script tags. So we revert to use a user agent test here.\n  if (goog.dom.BrowserFeature.CAN_USE_INNER_TEXT && node !== null &&\n      ('innerText' in node)) {\n    textContent = goog.string.canonicalizeNewlines(node.innerText);\n    // Unfortunately .innerText() returns text with &shy; symbols\n    // We need to filter it out and then remove duplicate whitespaces\n  } else {\n    var buf = [];\n    goog.dom.getTextContent_(node, buf, true);\n    textContent = buf.join('');\n  }\n\n  // Strip &shy; entities. goog.format.insertWordBreaks inserts them in Opera.\n  textContent = textContent.replace(/ \\xAD /g, ' ').replace(/\\xAD/g, '');\n  // Strip &#8203; entities. goog.format.insertWordBreaks inserts them in IE8.\n  textContent = textContent.replace(/\\u200B/g, '');\n\n  // Skip this replacement on old browsers with working innerText, which\n  // automatically turns &nbsp; into ' ' and / +/ into ' ' when reading\n  // innerText.\n  if (!goog.dom.BrowserFeature.CAN_USE_INNER_TEXT) {\n    textContent = textContent.replace(/ +/g, ' ');\n  }\n  if (textContent != ' ') {\n    textContent = textContent.replace(/^\\s*/, '');\n  }\n\n  return textContent;\n};\n\n\n/**\n * Returns the text content of the current node, without markup.\n *\n * Unlike `getTextContent` this method does not collapse whitespaces\n * or normalize lines breaks.\n *\n * @param {Node} node The node from which we are getting content.\n * @return {string} The raw text content.\n */\ngoog.dom.getRawTextContent = function(node) {\n  var buf = [];\n  goog.dom.getTextContent_(node, buf, false);\n\n  return buf.join('');\n};\n\n\n/**\n * Recursive support function for text content retrieval.\n *\n * @param {Node} node The node from which we are getting content.\n * @param {Array<string>} buf string buffer.\n * @param {boolean} normalizeWhitespace Whether to normalize whitespace.\n * @private\n */\ngoog.dom.getTextContent_ = function(node, buf, normalizeWhitespace) {\n  if (node.nodeName in goog.dom.TAGS_TO_IGNORE_) {\n    // ignore certain tags\n  } else if (node.nodeType == goog.dom.NodeType.TEXT) {\n    if (normalizeWhitespace) {\n      buf.push(String(node.nodeValue).replace(/(\\r\\n|\\r|\\n)/g, ''));\n    } else {\n      buf.push(node.nodeValue);\n    }\n  } else if (node.nodeName in goog.dom.PREDEFINED_TAG_VALUES_) {\n    buf.push(goog.dom.PREDEFINED_TAG_VALUES_[node.nodeName]);\n  } else {\n    var child = node.firstChild;\n    while (child) {\n      goog.dom.getTextContent_(child, buf, normalizeWhitespace);\n      child = child.nextSibling;\n    }\n  }\n};\n\n\n/**\n * Returns the text length of the text contained in a node, without markup. This\n * is equivalent to the selection length if the node was selected, or the number\n * of cursor movements to traverse the node. Images & BRs take one space.  New\n * lines are ignored.\n *\n * @param {Node} node The node whose text content length is being calculated.\n * @return {number} The length of `node`'s text content.\n */\ngoog.dom.getNodeTextLength = function(node) {\n  return goog.dom.getTextContent(node).length;\n};\n\n\n/**\n * Returns the text offset of a node relative to one of its ancestors. The text\n * length is the same as the length calculated by goog.dom.getNodeTextLength.\n *\n * @param {Node} node The node whose offset is being calculated.\n * @param {Node=} opt_offsetParent The node relative to which the offset will\n *     be calculated. Defaults to the node's owner document's body.\n * @return {number} The text offset.\n */\ngoog.dom.getNodeTextOffset = function(node, opt_offsetParent) {\n  var root = opt_offsetParent || goog.dom.getOwnerDocument(node).body;\n  var buf = [];\n  while (node && node != root) {\n    var cur = node;\n    while ((cur = cur.previousSibling)) {\n      buf.unshift(goog.dom.getTextContent(cur));\n    }\n    node = node.parentNode;\n  }\n  // Trim left to deal with FF cases when there might be line breaks and empty\n  // nodes at the front of the text\n  return goog.string.trimLeft(buf.join('')).replace(/ +/g, ' ').length;\n};\n\n\n/**\n * Returns the node at a given offset in a parent node.  If an object is\n * provided for the optional third parameter, the node and the remainder of the\n * offset will stored as properties of this object.\n * @param {Node} parent The parent node.\n * @param {number} offset The offset into the parent node.\n * @param {Object=} opt_result Object to be used to store the return value. The\n *     return value will be stored in the form {node: Node, remainder: number}\n *     if this object is provided.\n * @return {Node} The node at the given offset.\n */\ngoog.dom.getNodeAtOffset = function(parent, offset, opt_result) {\n  var stack = [parent], pos = 0, cur = null;\n  while (stack.length > 0 && pos < offset) {\n    cur = stack.pop();\n    if (cur.nodeName in goog.dom.TAGS_TO_IGNORE_) {\n      // ignore certain tags\n    } else if (cur.nodeType == goog.dom.NodeType.TEXT) {\n      var text = cur.nodeValue.replace(/(\\r\\n|\\r|\\n)/g, '').replace(/ +/g, ' ');\n      pos += text.length;\n    } else if (cur.nodeName in goog.dom.PREDEFINED_TAG_VALUES_) {\n      pos += goog.dom.PREDEFINED_TAG_VALUES_[cur.nodeName].length;\n    } else {\n      for (var i = cur.childNodes.length - 1; i >= 0; i--) {\n        stack.push(cur.childNodes[i]);\n      }\n    }\n  }\n  if (goog.isObject(opt_result)) {\n    opt_result.remainder = cur ? cur.nodeValue.length + offset - pos - 1 : 0;\n    opt_result.node = cur;\n  }\n\n  return cur;\n};\n\n\n/**\n * Returns true if the object is a `NodeList`.  To qualify as a NodeList,\n * the object must have a numeric length property and an item function (which\n * has type 'string' on IE for some reason).\n * @param {Object} val Object to test.\n * @return {boolean} Whether the object is a NodeList.\n */\ngoog.dom.isNodeList = function(val) {\n  // TODO(attila): Now the isNodeList is part of goog.dom we can use\n  // goog.userAgent to make this simpler.\n  // A NodeList must have a length property of type 'number' on all platforms.\n  if (val && typeof val.length == 'number') {\n    // A NodeList is an object everywhere except Safari, where it's a function.\n    if (goog.isObject(val)) {\n      // A NodeList must have an item function (on non-IE platforms) or an item\n      // property of type 'string' (on IE).\n      return typeof val.item == 'function' || typeof val.item == 'string';\n    } else if (goog.isFunction(val)) {\n      // On Safari, a NodeList is a function with an item property that is also\n      // a function.\n      return typeof /** @type {?} */ (val.item) == 'function';\n    }\n  }\n\n  // Not a NodeList.\n  return false;\n};\n\n\n/**\n * Walks up the DOM hierarchy returning the first ancestor that has the passed\n * tag name and/or class name. If the passed element matches the specified\n * criteria, the element itself is returned.\n * @param {Node} element The DOM node to start with.\n * @param {?(goog.dom.TagName<T>|string)=} opt_tag The tag name to match (or\n *     null/undefined to match only based on class name).\n * @param {?string=} opt_class The class name to match (or null/undefined to\n *     match only based on tag name).\n * @param {number=} opt_maxSearchSteps Maximum number of levels to search up the\n *     dom.\n * @return {?R} The first ancestor that matches the passed criteria, or\n *     null if no match is found. The return type is {?Element} if opt_tag is\n *     not a member of goog.dom.TagName or a more specific type if it is (e.g.\n *     {?HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.getAncestorByTagNameAndClass = function(\n    element, opt_tag, opt_class, opt_maxSearchSteps) {\n  if (!opt_tag && !opt_class) {\n    return null;\n  }\n  var tagName = opt_tag ? String(opt_tag).toUpperCase() : null;\n  return /** @type {Element} */ (goog.dom.getAncestor(element, function(node) {\n    return (!tagName || node.nodeName == tagName) &&\n        (!opt_class ||\n         goog.isString(node.className) &&\n             goog.array.contains(node.className.split(/\\s+/), opt_class));\n  }, true, opt_maxSearchSteps));\n};\n\n\n/**\n * Walks up the DOM hierarchy returning the first ancestor that has the passed\n * class name. If the passed element matches the specified criteria, the\n * element itself is returned.\n * @param {Node} element The DOM node to start with.\n * @param {string} className The class name to match.\n * @param {number=} opt_maxSearchSteps Maximum number of levels to search up the\n *     dom.\n * @return {Element} The first ancestor that matches the passed criteria, or\n *     null if none match.\n */\ngoog.dom.getAncestorByClass = function(element, className, opt_maxSearchSteps) {\n  return goog.dom.getAncestorByTagNameAndClass(\n      element, null, className, opt_maxSearchSteps);\n};\n\n\n/**\n * Walks up the DOM hierarchy returning the first ancestor that passes the\n * matcher function.\n * @param {Node} element The DOM node to start with.\n * @param {function(Node) : boolean} matcher A function that returns true if the\n *     passed node matches the desired criteria.\n * @param {boolean=} opt_includeNode If true, the node itself is included in\n *     the search (the first call to the matcher will pass startElement as\n *     the node to test).\n * @param {number=} opt_maxSearchSteps Maximum number of levels to search up the\n *     dom.\n * @return {Node} DOM node that matched the matcher, or null if there was\n *     no match.\n */\ngoog.dom.getAncestor = function(\n    element, matcher, opt_includeNode, opt_maxSearchSteps) {\n  if (element && !opt_includeNode) {\n    element = element.parentNode;\n  }\n  var steps = 0;\n  while (element &&\n         (opt_maxSearchSteps == null || steps <= opt_maxSearchSteps)) {\n    goog.asserts.assert(element.name != 'parentNode');\n    if (matcher(element)) {\n      return element;\n    }\n    element = element.parentNode;\n    steps++;\n  }\n  // Reached the root of the DOM without a match\n  return null;\n};\n\n\n/**\n * Determines the active element in the given document.\n * @param {Document} doc The document to look in.\n * @return {Element} The active element.\n */\ngoog.dom.getActiveElement = function(doc) {\n  // While in an iframe, IE9 will throw \"Unspecified error\" when accessing\n  // activeElement.\n  try {\n    var activeElement = doc && doc.activeElement;\n    // While not in an iframe, IE9-11 sometimes gives null.\n    // While in an iframe, IE11 sometimes returns an empty object.\n    return activeElement && activeElement.nodeName ? activeElement : null;\n  } catch (e) {\n    return null;\n  }\n};\n\n\n/**\n * Gives the current devicePixelRatio.\n *\n * By default, this is the value of window.devicePixelRatio (which should be\n * preferred if present).\n *\n * If window.devicePixelRatio is not present, the ratio is calculated with\n * window.matchMedia, if present. Otherwise, gives 1.0.\n *\n * Some browsers (including Chrome) consider the browser zoom level in the pixel\n * ratio, so the value may change across multiple calls.\n *\n * @return {number} The number of actual pixels per virtual pixel.\n */\ngoog.dom.getPixelRatio = function() {\n  var win = goog.dom.getWindow();\n  if (goog.isDef(win.devicePixelRatio)) {\n    return win.devicePixelRatio;\n  } else if (win.matchMedia) {\n    // Should be for IE10 and FF6-17 (this basically clamps to lower)\n    // Note that the order of these statements is important\n    return goog.dom.matchesPixelRatio_(3) || goog.dom.matchesPixelRatio_(2) ||\n           goog.dom.matchesPixelRatio_(1.5) || goog.dom.matchesPixelRatio_(1) ||\n           .75;\n  }\n  return 1;\n};\n\n\n/**\n * Calculates a mediaQuery to check if the current device supports the\n * given actual to virtual pixel ratio.\n * @param {number} pixelRatio The ratio of actual pixels to virtual pixels.\n * @return {number} pixelRatio if applicable, otherwise 0.\n * @private\n */\ngoog.dom.matchesPixelRatio_ = function(pixelRatio) {\n  var win = goog.dom.getWindow();\n  /**\n   * Due to the 1:96 fixed ratio of CSS in to CSS px, 1dppx is equivalent to\n   * 96dpi.\n   * @const {number}\n   */\n  var dpiPerDppx = 96;\n  var query =\n      // FF16-17\n      '(min-resolution: ' + pixelRatio + 'dppx),' +\n      // FF6-15\n      '(min--moz-device-pixel-ratio: ' + pixelRatio + '),' +\n      // IE10 (this works for the two browsers above too but I don't want to\n      // trust the 1:96 fixed ratio magic)\n      '(min-resolution: ' + (pixelRatio * dpiPerDppx) + 'dpi)';\n  return win.matchMedia(query).matches ? pixelRatio : 0;\n};\n\n\n/**\n * Gets '2d' context of a canvas. Shortcut for canvas.getContext('2d') with a\n * type information.\n * @param {!HTMLCanvasElement} canvas\n * @return {!CanvasRenderingContext2D}\n */\ngoog.dom.getCanvasContext2D = function(canvas) {\n  return /** @type {!CanvasRenderingContext2D} */ (canvas.getContext('2d'));\n};\n\n\n\n/**\n * Create an instance of a DOM helper with a new document object.\n * @param {Document=} opt_document Document object to associate with this\n *     DOM helper.\n * @constructor\n */\ngoog.dom.DomHelper = function(opt_document) {\n  /**\n   * Reference to the document object to use\n   * @type {!Document}\n   * @private\n   */\n  this.document_ = opt_document || goog.global.document || document;\n};\n\n\n/**\n * Gets the dom helper object for the document where the element resides.\n * @param {Node=} opt_node If present, gets the DomHelper for this node.\n * @return {!goog.dom.DomHelper} The DomHelper.\n */\ngoog.dom.DomHelper.prototype.getDomHelper = goog.dom.getDomHelper;\n\n\n/**\n * Sets the document object.\n * @param {!Document} document Document object.\n */\ngoog.dom.DomHelper.prototype.setDocument = function(document) {\n  this.document_ = document;\n};\n\n\n/**\n * Gets the document object being used by the dom library.\n * @return {!Document} Document object.\n */\ngoog.dom.DomHelper.prototype.getDocument = function() {\n  return this.document_;\n};\n\n\n/**\n * Alias for `getElementById`. If a DOM node is passed in then we just\n * return that.\n * @param {string|Element} element Element ID or a DOM node.\n * @return {Element} The element with the given ID, or the node passed in.\n */\ngoog.dom.DomHelper.prototype.getElement = function(element) {\n  return goog.dom.getElementHelper_(this.document_, element);\n};\n\n\n/**\n * Gets an element by id, asserting that the element is found.\n *\n * This is used when an element is expected to exist, and should fail with\n * an assertion error if it does not (if assertions are enabled).\n *\n * @param {string} id Element ID.\n * @return {!Element} The element with the given ID, if it exists.\n */\ngoog.dom.DomHelper.prototype.getRequiredElement = function(id) {\n  return goog.dom.getRequiredElementHelper_(this.document_, id);\n};\n\n\n/**\n * Alias for `getElement`.\n * @param {string|Element} element Element ID or a DOM node.\n * @return {Element} The element with the given ID, or the node passed in.\n * @deprecated Use {@link goog.dom.DomHelper.prototype.getElement} instead.\n */\ngoog.dom.DomHelper.prototype.$ = goog.dom.DomHelper.prototype.getElement;\n\n\n/**\n * Gets elements by tag name.\n * @param {!goog.dom.TagName<T>} tagName\n * @param {(!Document|!Element)=} opt_parent Parent element or document where to\n *     look for elements. Defaults to document of this DomHelper.\n * @return {!NodeList<R>} List of elements. The members of the list are\n *     {!Element} if tagName is not a member of goog.dom.TagName or more\n *     specific types if it is (e.g. {!HTMLAnchorElement} for\n *     goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.DomHelper.prototype.getElementsByTagName =\n    function(tagName, opt_parent) {\n  var parent = opt_parent || this.document_;\n  return parent.getElementsByTagName(String(tagName));\n};\n\n\n/**\n * Looks up elements by both tag and class name, using browser native functions\n * (`querySelectorAll`, `getElementsByTagName` or\n * `getElementsByClassName`) where possible. The returned array is a live\n * NodeList or a static list depending on the code path taken.\n *\n * @param {(string|?goog.dom.TagName<T>)=} opt_tag Element tag name or * for all\n *     tags.\n * @param {?string=} opt_class Optional class name.\n * @param {(Document|Element)=} opt_el Optional element to look in.\n * @return {!IArrayLike<R>} Array-like list of elements (only a length property\n *     and numerical indices are guaranteed to exist). The members of the array\n *     are {!Element} if opt_tag is not a member of goog.dom.TagName or more\n *     specific types if it is (e.g. {!HTMLAnchorElement} for\n *     goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.DomHelper.prototype.getElementsByTagNameAndClass = function(\n    opt_tag, opt_class, opt_el) {\n  return goog.dom.getElementsByTagNameAndClass_(\n      this.document_, opt_tag, opt_class, opt_el);\n};\n\n\n/**\n * Gets the first element matching the tag and the class.\n *\n * @param {(string|?goog.dom.TagName<T>)=} opt_tag Element tag name.\n * @param {?string=} opt_class Optional class name.\n * @param {(Document|Element)=} opt_el Optional element to look in.\n * @return {?R} Reference to a DOM node. The return type is {?Element} if\n *     tagName is a string or a more specific type if it is a member of\n *     goog.dom.TagName (e.g. {?HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.DomHelper.prototype.getElementByTagNameAndClass = function(\n    opt_tag, opt_class, opt_el) {\n  return goog.dom.getElementByTagNameAndClass_(\n      this.document_, opt_tag, opt_class, opt_el);\n};\n\n\n/**\n * Returns an array of all the elements with the provided className.\n * @param {string} className the name of the class to look for.\n * @param {Element|Document=} opt_el Optional element to look in.\n * @return {!IArrayLike<!Element>} The items found with the class name provided.\n */\ngoog.dom.DomHelper.prototype.getElementsByClass = function(className, opt_el) {\n  var doc = opt_el || this.document_;\n  return goog.dom.getElementsByClass(className, doc);\n};\n\n\n/**\n * Returns the first element we find matching the provided class name.\n * @param {string} className the name of the class to look for.\n * @param {(Element|Document)=} opt_el Optional element to look in.\n * @return {Element} The first item found with the class name provided.\n */\ngoog.dom.DomHelper.prototype.getElementByClass = function(className, opt_el) {\n  var doc = opt_el || this.document_;\n  return goog.dom.getElementByClass(className, doc);\n};\n\n\n/**\n * Ensures an element with the given className exists, and then returns the\n * first element with the provided className.\n * @param {string} className the name of the class to look for.\n * @param {(!Element|!Document)=} opt_root Optional element or document to look\n *     in.\n * @return {!Element} The first item found with the class name provided.\n * @throws {goog.asserts.AssertionError} Thrown if no element is found.\n */\ngoog.dom.DomHelper.prototype.getRequiredElementByClass = function(\n    className, opt_root) {\n  var root = opt_root || this.document_;\n  return goog.dom.getRequiredElementByClass(className, root);\n};\n\n\n/**\n * Alias for `getElementsByTagNameAndClass`.\n * @deprecated Use DomHelper getElementsByTagNameAndClass.\n *\n * @param {(string|?goog.dom.TagName<T>)=} opt_tag Element tag name.\n * @param {?string=} opt_class Optional class name.\n * @param {Element=} opt_el Optional element to look in.\n * @return {!IArrayLike<R>} Array-like list of elements (only a length property\n *     and numerical indices are guaranteed to exist). The members of the array\n *     are {!Element} if opt_tag is a string or more specific types if it is\n *     a member of goog.dom.TagName (e.g. {!HTMLAnchorElement} for\n *     goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.DomHelper.prototype.$$ =\n    goog.dom.DomHelper.prototype.getElementsByTagNameAndClass;\n\n\n/**\n * Sets a number of properties on a node.\n * @param {Element} element DOM node to set properties on.\n * @param {Object} properties Hash of property:value pairs.\n */\ngoog.dom.DomHelper.prototype.setProperties = goog.dom.setProperties;\n\n\n/**\n * Gets the dimensions of the viewport.\n * @param {Window=} opt_window Optional window element to test. Defaults to\n *     the window of the Dom Helper.\n * @return {!goog.math.Size} Object with values 'width' and 'height'.\n */\ngoog.dom.DomHelper.prototype.getViewportSize = function(opt_window) {\n  // TODO(arv): This should not take an argument. That breaks the rule of a\n  // a DomHelper representing a single frame/window/document.\n  return goog.dom.getViewportSize(opt_window || this.getWindow());\n};\n\n\n/**\n * Calculates the height of the document.\n *\n * @return {number} The height of the document.\n */\ngoog.dom.DomHelper.prototype.getDocumentHeight = function() {\n  return goog.dom.getDocumentHeight_(this.getWindow());\n};\n\n\n/**\n * Typedef for use with goog.dom.createDom and goog.dom.append.\n * @typedef {Object|string|Array|NodeList}\n */\ngoog.dom.Appendable;\n\n\n/**\n * Returns a dom node with a set of attributes.  This function accepts varargs\n * for subsequent nodes to be added.  Subsequent nodes will be added to the\n * first node as childNodes.\n *\n * So:\n * <code>createDom(goog.dom.TagName.DIV, null, createDom(goog.dom.TagName.P),\n * createDom(goog.dom.TagName.P));</code> would return a div with two child\n * paragraphs\n *\n * An easy way to move all child nodes of an existing element to a new parent\n * element is:\n * <code>createDom(goog.dom.TagName.DIV, null, oldElement.childNodes);</code>\n * which will remove all child nodes from the old element and add them as\n * child nodes of the new DIV.\n *\n * @param {string|!goog.dom.TagName<T>} tagName Tag to create.\n * @param {?Object|?Array<string>|string=} opt_attributes If object, then a map\n *     of name-value pairs for attributes. If a string, then this is the\n *     className of the new element. If an array, the elements will be joined\n *     together as the className of the new element.\n * @param {...(goog.dom.Appendable|undefined)} var_args Further DOM nodes or\n *     strings for text nodes. If one of the var_args is an array or\n *     NodeList, its elements will be added as childNodes instead.\n * @return {R} Reference to a DOM node. The return type is {!Element} if tagName\n *     is a string or a more specific type if it is a member of\n *     goog.dom.TagName (e.g. {!HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.DomHelper.prototype.createDom = function(\n    tagName, opt_attributes, var_args) {\n  return goog.dom.createDom_(this.document_, arguments);\n};\n\n\n/**\n * Alias for `createDom`.\n * @param {string|!goog.dom.TagName<T>} tagName Tag to create.\n * @param {?Object|?Array<string>|string=} opt_attributes If object, then a map\n *     of name-value pairs for attributes. If a string, then this is the\n *     className of the new element. If an array, the elements will be joined\n *     together as the className of the new element.\n * @param {...(goog.dom.Appendable|undefined)} var_args Further DOM nodes or\n *     strings for text nodes.  If one of the var_args is an array, its children\n *     will be added as childNodes instead.\n * @return {R} Reference to a DOM node. The return type is {!Element} if tagName\n *     is a string or a more specific type if it is a member of\n *     goog.dom.TagName (e.g. {!HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n * @deprecated Use {@link goog.dom.DomHelper.prototype.createDom} instead.\n */\ngoog.dom.DomHelper.prototype.$dom = goog.dom.DomHelper.prototype.createDom;\n\n\n/**\n * Creates a new element.\n * @param {string|!goog.dom.TagName<T>} name Tag to create.\n * @return {R} The new element. The return type is {!Element} if name is\n *     a string or a more specific type if it is a member of goog.dom.TagName\n *     (e.g. {!HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.DomHelper.prototype.createElement = function(name) {\n  return goog.dom.createElement_(this.document_, name);\n};\n\n\n/**\n * Creates a new text node.\n * @param {number|string} content Content.\n * @return {!Text} The new text node.\n */\ngoog.dom.DomHelper.prototype.createTextNode = function(content) {\n  return this.document_.createTextNode(String(content));\n};\n\n\n/**\n * Create a table.\n * @param {number} rows The number of rows in the table.  Must be >= 1.\n * @param {number} columns The number of columns in the table.  Must be >= 1.\n * @param {boolean=} opt_fillWithNbsp If true, fills table entries with\n *     `goog.string.Unicode.NBSP` characters.\n * @return {!HTMLElement} The created table.\n */\ngoog.dom.DomHelper.prototype.createTable = function(\n    rows, columns, opt_fillWithNbsp) {\n  return goog.dom.createTable_(\n      this.document_, rows, columns, !!opt_fillWithNbsp);\n};\n\n\n/**\n * Converts an HTML into a node or a document fragment. A single Node is used if\n * `html` only generates a single node. If `html` generates multiple\n * nodes then these are put inside a `DocumentFragment`. This is a safe\n * version of `goog.dom.DomHelper#htmlToDocumentFragment` which is now\n * deleted.\n * @param {!goog.html.SafeHtml} html The HTML markup to convert.\n * @return {!Node} The resulting node.\n */\ngoog.dom.DomHelper.prototype.safeHtmlToNode = function(html) {\n  return goog.dom.safeHtmlToNode_(this.document_, html);\n};\n\n\n/**\n * Returns true if the browser is in \"CSS1-compatible\" (standards-compliant)\n * mode, false otherwise.\n * @return {boolean} True if in CSS1-compatible mode.\n */\ngoog.dom.DomHelper.prototype.isCss1CompatMode = function() {\n  return goog.dom.isCss1CompatMode_(this.document_);\n};\n\n\n/**\n * Gets the window object associated with the document.\n * @return {!Window} The window associated with the given document.\n */\ngoog.dom.DomHelper.prototype.getWindow = function() {\n  return goog.dom.getWindow_(this.document_);\n};\n\n\n/**\n * Gets the document scroll element.\n * @return {!Element} Scrolling element.\n */\ngoog.dom.DomHelper.prototype.getDocumentScrollElement = function() {\n  return goog.dom.getDocumentScrollElement_(this.document_);\n};\n\n\n/**\n * Gets the document scroll distance as a coordinate object.\n * @return {!goog.math.Coordinate} Object with properties 'x' and 'y'.\n */\ngoog.dom.DomHelper.prototype.getDocumentScroll = function() {\n  return goog.dom.getDocumentScroll_(this.document_);\n};\n\n\n/**\n * Determines the active element in the given document.\n * @param {Document=} opt_doc The document to look in.\n * @return {Element} The active element.\n */\ngoog.dom.DomHelper.prototype.getActiveElement = function(opt_doc) {\n  return goog.dom.getActiveElement(opt_doc || this.document_);\n};\n\n\n/**\n * Appends a child to a node.\n * @param {Node} parent Parent.\n * @param {Node} child Child.\n */\ngoog.dom.DomHelper.prototype.appendChild = goog.dom.appendChild;\n\n\n/**\n * Appends a node with text or other nodes.\n * @param {!Node} parent The node to append nodes to.\n * @param {...goog.dom.Appendable} var_args The things to append to the node.\n *     If this is a Node it is appended as is.\n *     If this is a string then a text node is appended.\n *     If this is an array like object then fields 0 to length - 1 are appended.\n */\ngoog.dom.DomHelper.prototype.append = goog.dom.append;\n\n\n/**\n * Determines if the given node can contain children, intended to be used for\n * HTML generation.\n *\n * @param {Node} node The node to check.\n * @return {boolean} Whether the node can contain children.\n */\ngoog.dom.DomHelper.prototype.canHaveChildren = goog.dom.canHaveChildren;\n\n\n/**\n * Removes all the child nodes on a DOM node.\n * @param {Node} node Node to remove children from.\n */\ngoog.dom.DomHelper.prototype.removeChildren = goog.dom.removeChildren;\n\n\n/**\n * Inserts a new node before an existing reference node (i.e., as the previous\n * sibling). If the reference node has no parent, then does nothing.\n * @param {Node} newNode Node to insert.\n * @param {Node} refNode Reference node to insert before.\n */\ngoog.dom.DomHelper.prototype.insertSiblingBefore = goog.dom.insertSiblingBefore;\n\n\n/**\n * Inserts a new node after an existing reference node (i.e., as the next\n * sibling). If the reference node has no parent, then does nothing.\n * @param {Node} newNode Node to insert.\n * @param {Node} refNode Reference node to insert after.\n */\ngoog.dom.DomHelper.prototype.insertSiblingAfter = goog.dom.insertSiblingAfter;\n\n\n/**\n * Insert a child at a given index. If index is larger than the number of child\n * nodes that the parent currently has, the node is inserted as the last child\n * node.\n * @param {Element} parent The element into which to insert the child.\n * @param {Node} child The element to insert.\n * @param {number} index The index at which to insert the new child node. Must\n *     not be negative.\n */\ngoog.dom.DomHelper.prototype.insertChildAt = goog.dom.insertChildAt;\n\n\n/**\n * Removes a node from its parent.\n * @param {Node} node The node to remove.\n * @return {Node} The node removed if removed; else, null.\n */\ngoog.dom.DomHelper.prototype.removeNode = goog.dom.removeNode;\n\n\n/**\n * Replaces a node in the DOM tree. Will do nothing if `oldNode` has no\n * parent.\n * @param {Node} newNode Node to insert.\n * @param {Node} oldNode Node to replace.\n */\ngoog.dom.DomHelper.prototype.replaceNode = goog.dom.replaceNode;\n\n\n/**\n * Flattens an element. That is, removes it and replace it with its children.\n * @param {Element} element The element to flatten.\n * @return {Element|undefined} The original element, detached from the document\n *     tree, sans children, or undefined if the element was already not in the\n *     document.\n */\ngoog.dom.DomHelper.prototype.flattenElement = goog.dom.flattenElement;\n\n\n/**\n * Returns an array containing just the element children of the given element.\n * @param {Element} element The element whose element children we want.\n * @return {!(Array<!Element>|NodeList<!Element>)} An array or array-like list\n *     of just the element children of the given element.\n */\ngoog.dom.DomHelper.prototype.getChildren = goog.dom.getChildren;\n\n\n/**\n * Returns the first child node that is an element.\n * @param {Node} node The node to get the first child element of.\n * @return {Element} The first child node of `node` that is an element.\n */\ngoog.dom.DomHelper.prototype.getFirstElementChild =\n    goog.dom.getFirstElementChild;\n\n\n/**\n * Returns the last child node that is an element.\n * @param {Node} node The node to get the last child element of.\n * @return {Element} The last child node of `node` that is an element.\n */\ngoog.dom.DomHelper.prototype.getLastElementChild = goog.dom.getLastElementChild;\n\n\n/**\n * Returns the first next sibling that is an element.\n * @param {Node} node The node to get the next sibling element of.\n * @return {Element} The next sibling of `node` that is an element.\n */\ngoog.dom.DomHelper.prototype.getNextElementSibling =\n    goog.dom.getNextElementSibling;\n\n\n/**\n * Returns the first previous sibling that is an element.\n * @param {Node} node The node to get the previous sibling element of.\n * @return {Element} The first previous sibling of `node` that is\n *     an element.\n */\ngoog.dom.DomHelper.prototype.getPreviousElementSibling =\n    goog.dom.getPreviousElementSibling;\n\n\n/**\n * Returns the next node in source order from the given node.\n * @param {Node} node The node.\n * @return {Node} The next node in the DOM tree, or null if this was the last\n *     node.\n */\ngoog.dom.DomHelper.prototype.getNextNode = goog.dom.getNextNode;\n\n\n/**\n * Returns the previous node in source order from the given node.\n * @param {Node} node The node.\n * @return {Node} The previous node in the DOM tree, or null if this was the\n *     first node.\n */\ngoog.dom.DomHelper.prototype.getPreviousNode = goog.dom.getPreviousNode;\n\n\n/**\n * Whether the object looks like a DOM node.\n * @param {?} obj The object being tested for node likeness.\n * @return {boolean} Whether the object looks like a DOM node.\n */\ngoog.dom.DomHelper.prototype.isNodeLike = goog.dom.isNodeLike;\n\n\n/**\n * Whether the object looks like an Element.\n * @param {?} obj The object being tested for Element likeness.\n * @return {boolean} Whether the object looks like an Element.\n */\ngoog.dom.DomHelper.prototype.isElement = goog.dom.isElement;\n\n\n/**\n * Returns true if the specified value is a Window object. This includes the\n * global window for HTML pages, and iframe windows.\n * @param {?} obj Variable to test.\n * @return {boolean} Whether the variable is a window.\n */\ngoog.dom.DomHelper.prototype.isWindow = goog.dom.isWindow;\n\n\n/**\n * Returns an element's parent, if it's an Element.\n * @param {Element} element The DOM element.\n * @return {Element} The parent, or null if not an Element.\n */\ngoog.dom.DomHelper.prototype.getParentElement = goog.dom.getParentElement;\n\n\n/**\n * Whether a node contains another node.\n * @param {Node} parent The node that should contain the other node.\n * @param {Node} descendant The node to test presence of.\n * @return {boolean} Whether the parent node contains the descendant node.\n */\ngoog.dom.DomHelper.prototype.contains = goog.dom.contains;\n\n\n/**\n * Compares the document order of two nodes, returning 0 if they are the same\n * node, a negative number if node1 is before node2, and a positive number if\n * node2 is before node1.  Note that we compare the order the tags appear in the\n * document so in the tree <b><i>text</i></b> the B node is considered to be\n * before the I node.\n *\n * @param {Node} node1 The first node to compare.\n * @param {Node} node2 The second node to compare.\n * @return {number} 0 if the nodes are the same node, a negative number if node1\n *     is before node2, and a positive number if node2 is before node1.\n */\ngoog.dom.DomHelper.prototype.compareNodeOrder = goog.dom.compareNodeOrder;\n\n\n/**\n * Find the deepest common ancestor of the given nodes.\n * @param {...Node} var_args The nodes to find a common ancestor of.\n * @return {Node} The common ancestor of the nodes, or null if there is none.\n *     null will only be returned if two or more of the nodes are from different\n *     documents.\n */\ngoog.dom.DomHelper.prototype.findCommonAncestor = goog.dom.findCommonAncestor;\n\n\n/**\n * Returns the owner document for a node.\n * @param {Node} node The node to get the document for.\n * @return {!Document} The document owning the node.\n */\ngoog.dom.DomHelper.prototype.getOwnerDocument = goog.dom.getOwnerDocument;\n\n\n/**\n * Cross browser function for getting the document element of an iframe.\n * @param {Element} iframe Iframe element.\n * @return {!Document} The frame content document.\n */\ngoog.dom.DomHelper.prototype.getFrameContentDocument =\n    goog.dom.getFrameContentDocument;\n\n\n/**\n * Cross browser function for getting the window of a frame or iframe.\n * @param {Element} frame Frame element.\n * @return {Window} The window associated with the given frame.\n */\ngoog.dom.DomHelper.prototype.getFrameContentWindow =\n    goog.dom.getFrameContentWindow;\n\n\n/**\n * Sets the text content of a node, with cross-browser support.\n * @param {Node} node The node to change the text content of.\n * @param {string|number} text The value that should replace the node's content.\n */\ngoog.dom.DomHelper.prototype.setTextContent = goog.dom.setTextContent;\n\n\n/**\n * Gets the outerHTML of a node, which islike innerHTML, except that it\n * actually contains the HTML of the node itself.\n * @param {Element} element The element to get the HTML of.\n * @return {string} The outerHTML of the given element.\n */\ngoog.dom.DomHelper.prototype.getOuterHtml = goog.dom.getOuterHtml;\n\n\n/**\n * Finds the first descendant node that matches the filter function. This does\n * a depth first search.\n * @param {Node} root The root of the tree to search.\n * @param {function(Node) : boolean} p The filter function.\n * @return {Node|undefined} The found node or undefined if none is found.\n */\ngoog.dom.DomHelper.prototype.findNode = goog.dom.findNode;\n\n\n/**\n * Finds all the descendant nodes that matches the filter function. This does a\n * depth first search.\n * @param {Node} root The root of the tree to search.\n * @param {function(Node) : boolean} p The filter function.\n * @return {Array<Node>} The found nodes or an empty array if none are found.\n */\ngoog.dom.DomHelper.prototype.findNodes = goog.dom.findNodes;\n\n\n/**\n * Returns true if the element has a tab index that allows it to receive\n * keyboard focus (tabIndex >= 0), false otherwise.  Note that some elements\n * natively support keyboard focus, even if they have no tab index.\n * @param {!Element} element Element to check.\n * @return {boolean} Whether the element has a tab index that allows keyboard\n *     focus.\n */\ngoog.dom.DomHelper.prototype.isFocusableTabIndex = goog.dom.isFocusableTabIndex;\n\n\n/**\n * Enables or disables keyboard focus support on the element via its tab index.\n * Only elements for which {@link goog.dom.isFocusableTabIndex} returns true\n * (or elements that natively support keyboard focus, like form elements) can\n * receive keyboard focus.  See http://go/tabindex for more info.\n * @param {Element} element Element whose tab index is to be changed.\n * @param {boolean} enable Whether to set or remove a tab index on the element\n *     that supports keyboard focus.\n */\ngoog.dom.DomHelper.prototype.setFocusableTabIndex =\n    goog.dom.setFocusableTabIndex;\n\n\n/**\n * Returns true if the element can be focused, i.e. it has a tab index that\n * allows it to receive keyboard focus (tabIndex >= 0), or it is an element\n * that natively supports keyboard focus.\n * @param {!Element} element Element to check.\n * @return {boolean} Whether the element allows keyboard focus.\n */\ngoog.dom.DomHelper.prototype.isFocusable = goog.dom.isFocusable;\n\n\n/**\n * Returns the text contents of the current node, without markup. New lines are\n * stripped and whitespace is collapsed, such that each character would be\n * visible.\n *\n * In browsers that support it, innerText is used.  Other browsers attempt to\n * simulate it via node traversal.  Line breaks are canonicalized in IE.\n *\n * @param {Node} node The node from which we are getting content.\n * @return {string} The text content.\n */\ngoog.dom.DomHelper.prototype.getTextContent = goog.dom.getTextContent;\n\n\n/**\n * Returns the text length of the text contained in a node, without markup. This\n * is equivalent to the selection length if the node was selected, or the number\n * of cursor movements to traverse the node. Images & BRs take one space.  New\n * lines are ignored.\n *\n * @param {Node} node The node whose text content length is being calculated.\n * @return {number} The length of `node`'s text content.\n */\ngoog.dom.DomHelper.prototype.getNodeTextLength = goog.dom.getNodeTextLength;\n\n\n/**\n * Returns the text offset of a node relative to one of its ancestors. The text\n * length is the same as the length calculated by\n * `goog.dom.getNodeTextLength`.\n *\n * @param {Node} node The node whose offset is being calculated.\n * @param {Node=} opt_offsetParent Defaults to the node's owner document's body.\n * @return {number} The text offset.\n */\ngoog.dom.DomHelper.prototype.getNodeTextOffset = goog.dom.getNodeTextOffset;\n\n\n/**\n * Returns the node at a given offset in a parent node.  If an object is\n * provided for the optional third parameter, the node and the remainder of the\n * offset will stored as properties of this object.\n * @param {Node} parent The parent node.\n * @param {number} offset The offset into the parent node.\n * @param {Object=} opt_result Object to be used to store the return value. The\n *     return value will be stored in the form {node: Node, remainder: number}\n *     if this object is provided.\n * @return {Node} The node at the given offset.\n */\ngoog.dom.DomHelper.prototype.getNodeAtOffset = goog.dom.getNodeAtOffset;\n\n\n/**\n * Returns true if the object is a `NodeList`.  To qualify as a NodeList,\n * the object must have a numeric length property and an item function (which\n * has type 'string' on IE for some reason).\n * @param {Object} val Object to test.\n * @return {boolean} Whether the object is a NodeList.\n */\ngoog.dom.DomHelper.prototype.isNodeList = goog.dom.isNodeList;\n\n\n/**\n * Walks up the DOM hierarchy returning the first ancestor that has the passed\n * tag name and/or class name. If the passed element matches the specified\n * criteria, the element itself is returned.\n * @param {Node} element The DOM node to start with.\n * @param {?(goog.dom.TagName<T>|string)=} opt_tag The tag name to match (or\n *     null/undefined to match only based on class name).\n * @param {?string=} opt_class The class name to match (or null/undefined to\n *     match only based on tag name).\n * @param {number=} opt_maxSearchSteps Maximum number of levels to search up the\n *     dom.\n * @return {?R} The first ancestor that matches the passed criteria, or\n *     null if no match is found. The return type is {?Element} if opt_tag is\n *     not a member of goog.dom.TagName or a more specific type if it is (e.g.\n *     {?HTMLAnchorElement} for goog.dom.TagName.A).\n * @template T\n * @template R := cond(isUnknown(T), 'Element', T) =:\n */\ngoog.dom.DomHelper.prototype.getAncestorByTagNameAndClass =\n    goog.dom.getAncestorByTagNameAndClass;\n\n\n/**\n * Walks up the DOM hierarchy returning the first ancestor that has the passed\n * class name. If the passed element matches the specified criteria, the\n * element itself is returned.\n * @param {Node} element The DOM node to start with.\n * @param {string} class The class name to match.\n * @param {number=} opt_maxSearchSteps Maximum number of levels to search up the\n *     dom.\n * @return {Element} The first ancestor that matches the passed criteria, or\n *     null if none match.\n */\ngoog.dom.DomHelper.prototype.getAncestorByClass = goog.dom.getAncestorByClass;\n\n\n/**\n * Walks up the DOM hierarchy returning the first ancestor that passes the\n * matcher function.\n * @param {Node} element The DOM node to start with.\n * @param {function(Node) : boolean} matcher A function that returns true if the\n *     passed node matches the desired criteria.\n * @param {boolean=} opt_includeNode If true, the node itself is included in\n *     the search (the first call to the matcher will pass startElement as\n *     the node to test).\n * @param {number=} opt_maxSearchSteps Maximum number of levels to search up the\n *     dom.\n * @return {Node} DOM node that matched the matcher, or null if there was\n *     no match.\n */\ngoog.dom.DomHelper.prototype.getAncestor = goog.dom.getAncestor;\n\n\n/**\n * Gets '2d' context of a canvas. Shortcut for canvas.getContext('2d') with a\n * type information.\n * @param {!HTMLCanvasElement} canvas\n * @return {!CanvasRenderingContext2D}\n */\ngoog.dom.DomHelper.prototype.getCanvasContext2D = goog.dom.getCanvasContext2D;\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview JSON utility functions.\n * @author arv@google.com (Erik Arvidsson)\n */\n\n\ngoog.provide('goog.json');\ngoog.provide('goog.json.Replacer');\ngoog.provide('goog.json.Reviver');\ngoog.provide('goog.json.Serializer');\n\n\n/**\n * @define {boolean} If true, use the native JSON parsing API.\n * NOTE: The default `goog.json.parse` implementation is able to handle\n * invalid JSON. JSPB used to produce invalid JSON which is not the case\n * anymore so this is safe to enable for parsing JSPB. Using native JSON is\n * faster and safer than the default implementation using `eval`.\n */\ngoog.json.USE_NATIVE_JSON = goog.define('goog.json.USE_NATIVE_JSON', false);\n\n/**\n * @define {boolean} If true, try the native JSON parsing API first. If it\n * fails, log an error and use `eval` instead. This is useful when\n * transitioning to `goog.json.USE_NATIVE_JSON`. The error logger needs to\n * be set by `goog.json.setErrorLogger`. If it is not set then the error\n * is ignored.\n */\ngoog.json.TRY_NATIVE_JSON = goog.define('goog.json.TRY_NATIVE_JSON', false);\n\n\n/**\n * Tests if a string is an invalid JSON string. This only ensures that we are\n * not using any invalid characters\n * @param {string} s The string to test.\n * @return {boolean} True if the input is a valid JSON string.\n */\ngoog.json.isValid = function(s) {\n  // All empty whitespace is not valid.\n  if (/^\\s*$/.test(s)) {\n    return false;\n  }\n\n  // This is taken from http://www.json.org/json2.js which is released to the\n  // public domain.\n  // Changes: We dissallow \\u2028 Line separator and \\u2029 Paragraph separator\n  // inside strings.  We also treat \\u2028 and \\u2029 as whitespace which they\n  // are in the RFC but IE and Safari does not match \\s to these so we need to\n  // include them in the reg exps in all places where whitespace is allowed.\n  // We allowed \\x7f inside strings because some tools don't escape it,\n  // e.g. http://www.json.org/java/org/json/JSONObject.java\n\n  // Parsing happens in three stages. In the first stage, we run the text\n  // against regular expressions that look for non-JSON patterns. We are\n  // especially concerned with '()' and 'new' because they can cause invocation,\n  // and '=' because it can cause mutation. But just to be safe, we want to\n  // reject all unexpected forms.\n\n  // We split the first stage into 4 regexp operations in order to work around\n  // crippling inefficiencies in IE's and Safari's regexp engines. First we\n  // replace all backslash pairs with '@' (a non-JSON character). Second, we\n  // replace all simple value tokens with ']' characters, but only when followed\n  // by a colon, comma, closing bracket or end of string. Third, we delete all\n  // open brackets that follow a colon or comma or that begin the text. Finally,\n  // we look to see that the remaining characters are only whitespace or ']' or\n  // ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n  // Don't make these static since they have the global flag.\n  var backslashesRe = /\\\\[\"\\\\\\/bfnrtu]/g;\n  var simpleValuesRe =\n      /(?:\"[^\"\\\\\\n\\r\\u2028\\u2029\\x00-\\x08\\x0a-\\x1f]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)[\\s\\u2028\\u2029]*(?=:|,|]|}|$)/g;\n  var openBracketsRe = /(?:^|:|,)(?:[\\s\\u2028\\u2029]*\\[)+/g;\n  var remainderRe = /^[\\],:{}\\s\\u2028\\u2029]*$/;\n\n  return remainderRe.test(\n      s.replace(backslashesRe, '@')\n          .replace(simpleValuesRe, ']')\n          .replace(openBracketsRe, ''));\n};\n\n/**\n * Logs a parsing error in `JSON.parse` solvable by using `eval`\n * if `goog.json.TRY_NATIVE_JSON` is enabled.\n * @private {function(string, !Error)} The first parameter is the error message,\n *     the second is the exception thrown by `JSON.parse`.\n */\ngoog.json.errorLogger_ = goog.nullFunction;\n\n\n/**\n * Sets an error logger to use if there's a recoverable parsing error and\n * `goog.json.TRY_NATIVE_JSON` is enabled.\n * @param {function(string, !Error)} errorLogger The first parameter is the\n *     error message, the second is the exception thrown by `JSON.parse`.\n */\ngoog.json.setErrorLogger = function(errorLogger) {\n  goog.json.errorLogger_ = errorLogger;\n};\n\n\n/**\n * Parses a JSON string and returns the result. This throws an exception if\n * the string is an invalid JSON string.\n *\n * Note that this is very slow on large strings. Use JSON.parse if possible.\n *\n * @param {*} s The JSON string to parse.\n * @throws Error if s is invalid JSON.\n * @return {Object} The object generated from the JSON string, or null.\n * @deprecated Use JSON.parse.\n */\ngoog.json.parse = goog.json.USE_NATIVE_JSON ?\n    /** @type {function(*):Object} */ (goog.global['JSON']['parse']) :\n    function(s) {\n      var error;\n      if (goog.json.TRY_NATIVE_JSON) {\n        try {\n          return goog.global['JSON']['parse'](s);\n        } catch (ex) {\n          error = ex;\n        }\n      }\n      var o = String(s);\n      if (goog.json.isValid(o)) {\n\n        try {\n          var result = /** @type {?Object} */ (eval('(' + o + ')'));\n          if (error) {\n            goog.json.errorLogger_('Invalid JSON: ' + o, error);\n          }\n          return result;\n        } catch (ex) {\n        }\n      }\n      throw new Error('Invalid JSON string: ' + o);\n    };\n\n\n/**\n * JSON replacer, as defined in Section 15.12.3 of the ES5 spec.\n * @see http://ecma-international.org/ecma-262/5.1/#sec-15.12.3\n *\n * TODO(nicksantos): Array should also be a valid replacer.\n *\n * @typedef {function(this:Object, string, *): *}\n */\ngoog.json.Replacer;\n\n\n/**\n * JSON reviver, as defined in Section 15.12.2 of the ES5 spec.\n * @see http://ecma-international.org/ecma-262/5.1/#sec-15.12.3\n *\n * @typedef {function(this:Object, string, *): *}\n */\ngoog.json.Reviver;\n\n\n/**\n * Serializes an object or a value to a JSON string.\n *\n * @param {*} object The object to serialize.\n * @param {?goog.json.Replacer=} opt_replacer A replacer function\n *     called for each (key, value) pair that determines how the value\n *     should be serialized. By defult, this just returns the value\n *     and allows default serialization to kick in.\n * @throws Error if there are loops in the object graph.\n * @return {string} A JSON string representation of the input.\n */\ngoog.json.serialize = goog.json.USE_NATIVE_JSON ?\n    /** @type {function(*, ?goog.json.Replacer=):string} */\n    (goog.global['JSON']['stringify']) :\n    function(object, opt_replacer) {\n      // NOTE(nicksantos): Currently, we never use JSON.stringify.\n      //\n      // The last time I evaluated this, JSON.stringify had subtle bugs and\n      // behavior differences on all browsers, and the performance win was not\n      // large enough to justify all the issues. This may change in the future\n      // as browser implementations get better.\n      //\n      // assertSerialize in json_test contains if branches for the cases\n      // that fail.\n      return new goog.json.Serializer(opt_replacer).serialize(object);\n    };\n\n\n\n/**\n * Class that is used to serialize JSON objects to a string.\n * @param {?goog.json.Replacer=} opt_replacer Replacer.\n * @constructor\n */\ngoog.json.Serializer = function(opt_replacer) {\n  /**\n   * @type {goog.json.Replacer|null|undefined}\n   * @private\n   */\n  this.replacer_ = opt_replacer;\n};\n\n\n/**\n * Serializes an object or a value to a JSON string.\n *\n * @param {*} object The object to serialize.\n * @throws Error if there are loops in the object graph.\n * @return {string} A JSON string representation of the input.\n */\ngoog.json.Serializer.prototype.serialize = function(object) {\n  var sb = [];\n  this.serializeInternal(object, sb);\n  return sb.join('');\n};\n\n\n/**\n * Serializes a generic value to a JSON string\n * @protected\n * @param {*} object The object to serialize.\n * @param {Array<string>} sb Array used as a string builder.\n * @throws Error if there are loops in the object graph.\n */\ngoog.json.Serializer.prototype.serializeInternal = function(object, sb) {\n  if (object == null) {\n    // undefined == null so this branch covers undefined as well as null\n    sb.push('null');\n    return;\n  }\n\n  if (typeof object == 'object') {\n    if (goog.isArray(object)) {\n      this.serializeArray(object, sb);\n      return;\n    } else if (\n        object instanceof String || object instanceof Number ||\n        object instanceof Boolean) {\n      object = object.valueOf();\n      // Fall through to switch below.\n    } else {\n      this.serializeObject_(/** @type {!Object} */ (object), sb);\n      return;\n    }\n  }\n\n  switch (typeof object) {\n    case 'string':\n      this.serializeString_(object, sb);\n      break;\n    case 'number':\n      this.serializeNumber_(object, sb);\n      break;\n    case 'boolean':\n      sb.push(String(object));\n      break;\n    case 'function':\n      sb.push('null');\n      break;\n    default:\n      throw new Error('Unknown type: ' + typeof object);\n  }\n};\n\n\n/**\n * Character mappings used internally for goog.string.quote\n * @private\n * @type {!Object}\n */\ngoog.json.Serializer.charToJsonCharCache_ = {\n  '\\\"': '\\\\\"',\n  '\\\\': '\\\\\\\\',\n  '/': '\\\\/',\n  '\\b': '\\\\b',\n  '\\f': '\\\\f',\n  '\\n': '\\\\n',\n  '\\r': '\\\\r',\n  '\\t': '\\\\t',\n\n  '\\x0B': '\\\\u000b'  // '\\v' is not supported in JScript\n};\n\n\n/**\n * Regular expression used to match characters that need to be replaced.\n * The S60 browser has a bug where unicode characters are not matched by\n * regular expressions. The condition below detects such behaviour and\n * adjusts the regular expression accordingly.\n * @private\n * @type {!RegExp}\n */\ngoog.json.Serializer.charsToReplace_ = /\\uffff/.test('\\uffff') ?\n    /[\\\\\\\"\\x00-\\x1f\\x7f-\\uffff]/g :\n    /[\\\\\\\"\\x00-\\x1f\\x7f-\\xff]/g;\n\n\n/**\n * Serializes a string to a JSON string\n * @private\n * @param {string} s The string to serialize.\n * @param {Array<string>} sb Array used as a string builder.\n */\ngoog.json.Serializer.prototype.serializeString_ = function(s, sb) {\n  // The official JSON implementation does not work with international\n  // characters.\n  sb.push('\"', s.replace(goog.json.Serializer.charsToReplace_, function(c) {\n    // caching the result improves performance by a factor 2-3\n    var rv = goog.json.Serializer.charToJsonCharCache_[c];\n    if (!rv) {\n      rv = '\\\\u' + (c.charCodeAt(0) | 0x10000).toString(16).substr(1);\n      goog.json.Serializer.charToJsonCharCache_[c] = rv;\n    }\n    return rv;\n  }), '\"');\n};\n\n\n/**\n * Serializes a number to a JSON string\n * @private\n * @param {number} n The number to serialize.\n * @param {Array<string>} sb Array used as a string builder.\n */\ngoog.json.Serializer.prototype.serializeNumber_ = function(n, sb) {\n  sb.push(isFinite(n) && !isNaN(n) ? String(n) : 'null');\n};\n\n\n/**\n * Serializes an array to a JSON string\n * @param {Array<string>} arr The array to serialize.\n * @param {Array<string>} sb Array used as a string builder.\n * @protected\n */\ngoog.json.Serializer.prototype.serializeArray = function(arr, sb) {\n  var l = arr.length;\n  sb.push('[');\n  var sep = '';\n  for (var i = 0; i < l; i++) {\n    sb.push(sep);\n\n    var value = arr[i];\n    this.serializeInternal(\n        this.replacer_ ? this.replacer_.call(arr, String(i), value) : value,\n        sb);\n\n    sep = ',';\n  }\n  sb.push(']');\n};\n\n\n/**\n * Serializes an object to a JSON string\n * @private\n * @param {!Object} obj The object to serialize.\n * @param {Array<string>} sb Array used as a string builder.\n */\ngoog.json.Serializer.prototype.serializeObject_ = function(obj, sb) {\n  sb.push('{');\n  var sep = '';\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var value = obj[key];\n      // Skip functions.\n      if (typeof value != 'function') {\n        sb.push(sep);\n        this.serializeString_(key, sb);\n        sb.push(':');\n\n        this.serializeInternal(\n            this.replacer_ ? this.replacer_.call(obj, key, value) : value, sb);\n\n        sep = ',';\n      }\n    }\n  }\n  sb.push('}');\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines utility and helper functions.\n */\n\ngoog.provide('fireauth.util');\n\ngoog.require('goog.Promise');\ngoog.require('goog.Timer');\ngoog.require('goog.Uri');\ngoog.require('goog.dom');\ngoog.require('goog.events');\ngoog.require('goog.events.EventType');\ngoog.require('goog.html.SafeUrl');\ngoog.require('goog.json');\ngoog.require('goog.object');\ngoog.require('goog.string');\ngoog.require('goog.userAgent');\ngoog.require('goog.window');\n\n\n/** @suppress {duplicate} Suppress variable 'angular' first declared. */\nvar angular;\n\n/**\n * Checks whether the user agent is IE11.\n * @return {boolean} True if it is IE11.\n */\nfireauth.util.isIe11 = function() {\n  return goog.userAgent.IE &&\n      !!goog.userAgent.DOCUMENT_MODE &&\n      goog.userAgent.DOCUMENT_MODE == 11;\n};\n\n\n/**\n * Checks whether the user agent is IE10.\n * @return {boolean} True if it is IE10.\n */\nfireauth.util.isIe10 = function() {\n  return goog.userAgent.IE &&\n      !!goog.userAgent.DOCUMENT_MODE &&\n      goog.userAgent.DOCUMENT_MODE == 10;\n};\n\n\n/**\n * Checks whether the user agent is Edge.\n * @param {string} userAgent The browser user agent string.\n * @return {boolean} True if it is Edge.\n */\nfireauth.util.isEdge = function(userAgent) {\n  return /Edge\\/\\d+/.test(userAgent);\n};\n\n\n/**\n * @param {?string=} opt_userAgent The navigator user agent.\n * @return {boolean} Whether local storage is not synchronized between an iframe\n *     and a popup of the same domain.\n */\nfireauth.util.isLocalStorageNotSynchronized = function(opt_userAgent) {\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  return fireauth.util.isIe11() || fireauth.util.isEdge(ua);\n};\n\n\n/** @return {string} The current URL. */\nfireauth.util.getCurrentUrl = function() {\n  return (goog.global['window'] && goog.global['window']['location']['href']) ||\n      // Check for worker environments.\n      (self && self['location'] && self['location']['href']) || '';\n};\n\n\n/**\n * @param {string} requestUri The request URI to send in verifyAssertion\n *     request.\n * @return {string} The sanitized URI, in this case it undoes the hashbang\n *     angularJs routing changes to request URI.\n */\nfireauth.util.sanitizeRequestUri = function(requestUri) {\n  // If AngularJS is included.\n  if (typeof angular != 'undefined') {\n    // Remove hashbang modifications from URL.\n    requestUri = requestUri.replace('#/', '#').replace('#!/', '#');\n  }\n  return requestUri;\n};\n\n\n/**\n * @param {?string} url The target URL. When !url, redirects to a blank page.\n * @param {!Window=} opt_window The optional window to redirect to target URL.\n * @param {boolean=} opt_bypassCheck Whether to bypass check. Used for custom\n *     scheme redirects.\n */\nfireauth.util.goTo = function(url, opt_window, opt_bypassCheck) {\n  var win = opt_window || goog.global['window'];\n  // No URL, redirect to blank page.\n  var finalUrl = 'about:blank';\n  // Popping up a window and then assigning its URL seems to cause some weird\n  // error. Fixed by setting win.location.href for now in IE browsers.\n  // Bug was detected in Edge and IE9.\n  if (url && !opt_bypassCheck) {\n    // We cannot use goog.dom.safe.setLocationHref since it tries to read\n    // popup.location from a different origin, which is an error in IE.\n    // (In Chrome, popup.location is just an empty Location object)\n    finalUrl = goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(url));\n  }\n  win.location.href = finalUrl;\n};\n\n\n/**\n * @param {string} url The target URL.\n * @param {!Window=} opt_window The optional window to replace with target URL.\n * @param {boolean=} opt_bypassCheck Whether to bypass check. Used for custom\n *     scheme redirects.\n */\nfireauth.util.replaceCurrentUrl = function(url, opt_window, opt_bypassCheck) {\n  var win = opt_window || goog.global['window'];\n  if (!opt_bypassCheck) {\n    win.location.replace(\n        goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(url)));\n  } else {\n    win.location.replace(url);\n  }\n};\n\n\n/**\n * Deep comparison of two objects.\n * @param {!Object} a The first object.\n * @param {!Object} b The second object.\n * @return {!Array<string>} The list of keys that are different between both\n *     objects provided.\n */\nfireauth.util.getKeyDiff = function(a, b) {\n  var diff = [];\n  for (var k in a) {\n    if (!(k in b)) {\n      diff.push(k);\n    } else if (typeof a[k] != typeof b[k]) {\n      diff.push(k);\n    } else if (typeof a[k] == 'object' && a[k] != null && b[k] != null) {\n      if (fireauth.util.getKeyDiff(\n          a[k], b[k]).length > 0) {\n        diff.push(k);\n      }\n    } else if (a[k] !== b[k]) {\n      diff.push(k);\n    }\n  }\n  for (var k in b) {\n    if (!(k in a)) {\n      diff.push(k);\n    }\n  }\n  return diff;\n};\n\n\n/**\n * @param {?string=} opt_userAgent The navigator user agent.\n * @return {?number} The Chrome version, null if the user agent is not Chrome.\n */\nfireauth.util.getChromeVersion = function(opt_userAgent) {\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  var browserName = fireauth.util.getBrowserName(ua);\n  // Confirm current browser is Chrome.\n  if (browserName != fireauth.util.BrowserName.CHROME) {\n    return null;\n  }\n  var matches = ua.match(/\\sChrome\\/(\\d+)/i);\n  if (matches && matches.length == 2) {\n    return parseInt(matches[1], 10);\n  }\n  return null;\n};\n\n\n/**\n * Detects CORS support.\n * @param {?string=} opt_userAgent The navigator user agent.\n * @return {boolean} True if the browser supports CORS.\n */\nfireauth.util.supportsCors = function(opt_userAgent) {\n  // Chrome 7 has CORS issues, pick 30 as upper limit.\n  var chromeVersion = fireauth.util.getChromeVersion(opt_userAgent);\n  if (chromeVersion && chromeVersion < 30) {\n    return false;\n  }\n  // Among all other supported browsers, only IE8 and IE9 don't support CORS.\n  return !goog.userAgent.IE || // Not IE.\n      !goog.userAgent.DOCUMENT_MODE || // No document mode == IE Edge.\n      goog.userAgent.DOCUMENT_MODE > 9;\n};\n\n\n/**\n * Detects whether browser is running on a mobile device.\n * @param {?string=} opt_userAgent The navigator user agent.\n * @return {boolean} True if the browser is running on a mobile device.\n */\nfireauth.util.isMobileBrowser = function(opt_userAgent) {\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  var uaLower = ua.toLowerCase();\n  // TODO: implement getBrowserName equivalent for OS.\n  if (uaLower.match(/android/) ||\n      uaLower.match(/webos/) ||\n      uaLower.match(/iphone|ipad|ipod/) ||\n      uaLower.match(/blackberry/) ||\n      uaLower.match(/windows phone/) ||\n      uaLower.match(/iemobile/)) {\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * Closes the provided window.\n * @param {?Window=} opt_window The optional window to close. The current window\n *     is used if none is provided.\n */\nfireauth.util.closeWindow = function(opt_window) {\n  var win = opt_window || goog.global['window'];\n  // In some browsers, in certain cases after the window closes, as seen in\n  // Samsung Galaxy S3 Android 4.4.2 stock browser, the win object here is an\n  // empty object {}. Try to catch the failure and ignore it.\n  try {\n    win.close();\n  } catch(e) {}\n};\n\n\n/**\n * Opens a popup window.\n * @param {?string=} opt_url initial URL of the popup window\n * @param {string=} opt_name title of the popup\n * @param {?number=} opt_width width of the popup\n * @param {?number=} opt_height height of the popup\n * @return {?Window} Returns the window object that was opened. This returns\n *                   null if a popup blocker prevented the window from being\n *                   opened.\n */\nfireauth.util.popup = function(opt_url, opt_name, opt_width, opt_height) {\n  var width = opt_width || 500;\n  var height = opt_height || 600;\n  var top = (window.screen.availHeight - height) / 2;\n  var left = (window.screen.availWidth - width) / 2;\n  var options = {\n    'width': width,\n    'height': height,\n    'top': top > 0 ? top : 0,\n    'left': left > 0 ? left : 0,\n    'location': true,\n    'resizable': true,\n    'statusbar': true,\n    'toolbar': false\n  };\n  // Chrome iOS 7 and 8 is returning an undefined popup win when target is\n  // specified, even though the popup is not necessarily blocked.\n  var ua = fireauth.util.getUserAgentString().toLowerCase();\n  if (opt_name) {\n    options['target'] = opt_name;\n    // This will force a new window on each call, achieving the same effect as\n    // passing a random name on each call.\n    if (goog.string.contains(ua, 'crios/')) {\n      options['target'] = '_blank';\n    }\n  }\n  var browserName = fireauth.util.getBrowserName(\n      fireauth.util.getUserAgentString());\n  if (browserName == fireauth.util.BrowserName.FIREFOX) {\n    // Firefox complains when invalid URLs are popped out. Hacky way to bypass.\n    opt_url = opt_url || 'http://localhost';\n    // Firefox disables by default scrolling on popup windows, which can create\n    // issues when the user has many Google accounts, for instance.\n    options['scrollbars'] = true;\n  }\n  // about:blank getting sanitized causing browsers like IE/Edge to display\n  // brief error message before redirecting to handler.\n  var newWin = goog.window.open(opt_url || '', options);\n  if (newWin) {\n    // Flaky on IE edge, encapsulate with a try and catch.\n    try {\n      newWin.focus();\n    } catch (e) {}\n  }\n  return newWin;\n};\n\n\n/**\n * The default value for the popup wait cycle in ms.\n * @const {number}\n * @private\n */\nfireauth.util.POPUP_WAIT_CYCLE_MS_ = 2000;\n\n\n/**\n * @param {?string=} opt_userAgent The optional user agent.\n * @return {boolean} Whether the popup requires a delay before closing itself.\n */\nfireauth.util.requiresPopupDelay = function(opt_userAgent) {\n  // TODO: remove this hack when CriOS behavior is fixed in iOS.\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  // Was observed in iOS 10.2 Chrome version 55.0.2883.79.\n  // Apply to Chrome 55+ iOS 10+ to ensure future Chrome versions or iOS 10\n  // minor updates do not suddenly resurface this bug. Revisit this check on\n  // next CriOS update.\n  var matches = ua.match(/OS (\\d+)_.*CriOS\\/(\\d+)\\./i);\n  if (matches && matches.length > 2) {\n    // iOS 10+ && chrome 55+.\n    return parseInt(matches[1], 10) >= 10 && parseInt(matches[2], 10) >= 55;\n  }\n  return false;\n};\n\n\n/**\n * @param {?Window} win The popup window to check.\n * @param {number=} opt_stepDuration The duration of each wait cycle before\n *     checking that window is closed.\n * @return {!goog.Promise<undefined>} The promise to resolve when window is\n *     closed.\n */\nfireauth.util.onPopupClose = function(win, opt_stepDuration) {\n  var stepDuration = opt_stepDuration || fireauth.util.POPUP_WAIT_CYCLE_MS_;\n  return new goog.Promise(function(resolve, reject) {\n    // Function to repeat each stepDuration.\n    var repeat = function() {\n      goog.Timer.promise(stepDuration).then(function() {\n        // After wait, check if window is closed.\n        if (!win || win.closed) {\n          // If so, resolve.\n          resolve();\n        } else {\n          // Call repeat again.\n          return repeat();\n        }\n      });\n    };\n    return repeat();\n  });\n};\n\n\n/**\n * @param {!Array<string>} authorizedDomains List of authorized domains.\n * @param {string} url The URL to check.\n * @return {boolean} Whether the passed domain is an authorized one.\n */\nfireauth.util.isAuthorizedDomain = function(authorizedDomains, url) {\n  var uri = goog.Uri.parse(url);\n  var scheme = uri.getScheme();\n  var domain = uri.getDomain();\n  for (var i = 0; i < authorizedDomains.length; i++) {\n    // Currently this corresponds to: domain.com = *://*.domain.com:* or\n    // exact domain match.\n    // In the case of Chrome extensions, the authorizedDomain will be formatted\n    // as 'chrome-extension://abcdefghijklmnopqrstuvwxyz123456'.\n    // The URL to check must have a chrome extension scheme and the domain\n    // must be an exact match domain == 'abcdefghijklmnopqrstuvwxyz123456'.\n    if (fireauth.util.matchDomain(authorizedDomains[i], domain, scheme)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n\n/**\n * Represents the dimensions of an entity (width and height).\n * @typedef {{\n *   width: number,\n *   height: number\n * }}\n */\nfireauth.util.Dimensions;\n\n\n/**\n * @param {?Window=} opt_window The optional window whose dimensions are to be\n *     returned. The current window is used if not found.\n * @return {?fireauth.util.Dimensions} The requested window dimensions if\n *     available.\n */\nfireauth.util.getWindowDimensions = function(opt_window) {\n  var win = opt_window || goog.global['window'];\n  if (win && win['innerWidth'] && win['innerHeight']) {\n    return {\n      'width': parseFloat(win['innerWidth']),\n      'height': parseFloat(win['innerHeight'])\n    };\n  }\n  return null;\n};\n\n\n/**\n * RegExp to detect if the domain given is an IP address. This is only used\n * for validating http and https schemes.\n *\n * It does not strictly validate if the IP is a real IP address, but as the\n * matchDomain method tests against a set of valid domains (extracted from the\n * window's current URL), it is sufficient.\n *\n * @const {!RegExp}\n * @private\n */\nfireauth.util.IP_ADDRESS_REGEXP_ = /^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/;\n\n\n/**\n * @param {string} domainPattern The domain pattern to match.\n * @param {string} domain The domain to check. It is assumed that it is a valid\n *     domain, not a user provided one.\n * @param {string} scheme The scheme of the domain to check.\n * @return {boolean} Whether the provided domain matches the domain pattern.\n */\nfireauth.util.matchDomain = function(domainPattern, domain, scheme) {\n  // Chrome extension matching.\n  if (domainPattern.indexOf('chrome-extension://') == 0) {\n    var chromeExtUri = goog.Uri.parse(domainPattern);\n    // Domain must match and the current scheme must be a Chrome extension.\n    return chromeExtUri.getDomain() == domain && scheme == 'chrome-extension';\n  } else if (scheme != 'http' && scheme != 'https') {\n    // Any other scheme that is not http or https cannot be whitelisted.\n    return false;\n  } else {\n    // domainPattern must not contain a scheme and the current scheme must be\n    // either http or https.\n    // Check if authorized domain pattern is an IP address.\n    if (fireauth.util.IP_ADDRESS_REGEXP_.test(domainPattern)) {\n      // The domain has to be exactly equal to the pattern, as an IP domain will\n      // only contain the IP, no extra character.\n      return domain == domainPattern;\n    }\n    // Dots in pattern should be escaped.\n    var escapedDomainPattern = domainPattern.split('.').join('\\\\.');\n    // Non ip address domains.\n    // domain.com = *.domain.com OR domain.com\n    var re = new RegExp(\n        '^(.+\\\\.' + escapedDomainPattern + '|' +\n        escapedDomainPattern + ')$', 'i');\n    return re.test(domain);\n  }\n};\n\n\n/**\n * RegExp to detect if the email address given is valid.\n * @const {!RegExp}\n * @private\n */\nfireauth.util.EMAIL_ADDRESS_REGEXP_ = /^[^@]+@[^@]+$/;\n\n\n/**\n * Determines if it is a valid email address.\n * @param {*} email The email address.\n * @return {boolean} Whether the email address is valid.\n */\nfireauth.util.isValidEmailAddress = function(email) {\n  return goog.isString(email) &&\n      fireauth.util.EMAIL_ADDRESS_REGEXP_.test(email);\n};\n\n\n/**\n * @return {!goog.Promise<void>} A promise that resolves when DOM is ready.\n */\nfireauth.util.onDomReady = function() {\n  var resolver = null;\n  return new goog.Promise(function(resolve, reject) {\n    var doc = goog.global.document;\n    // If document already loaded, resolve immediately.\n    if (doc.readyState == 'complete') {\n      resolve();\n    } else {\n      // Document not ready, wait for load before resolving.\n      // Save resolver, so we can remove listener in case it was externally\n      // cancelled.\n      resolver = function() {\n        resolve();\n      };\n      goog.events.listenOnce(window, goog.events.EventType.LOAD, resolver);\n    }\n  }).thenCatch(function(error) {\n    // In case this promise was cancelled, make sure it unlistens to load.\n    goog.events.unlisten(window, goog.events.EventType.LOAD, resolver);\n    throw error;\n  });\n};\n\n\n/** @return {boolean} Whether environment supports DOM. */\nfireauth.util.isDOMSupported = function() {\n  return !!goog.global.document;\n};\n\n\n/**\n * The default ondeviceready Cordova timeout in ms.\n * @const {number}\n * @private\n */\nfireauth.util.CORDOVA_ONDEVICEREADY_TIMEOUT_MS_ = 1000;\n\n\n/**\n * @param {?string=} opt_userAgent The optional user agent.\n * @param {number=} opt_timeout The optional timeout in ms for deviceready\n *     event to resolve.\n * @return {!goog.Promise} A promise that resolves if the current environment is\n *     a Cordova environment.\n */\nfireauth.util.checkIfCordova = function(opt_userAgent, opt_timeout) {\n  // Errors generated are internal and should be converted if needed to\n  // developer facing Firebase errors.\n  // Only supported in Android/iOS environment.\n  if (fireauth.util.isAndroidOrIosCordovaScheme(opt_userAgent)) {\n    return fireauth.util.onDomReady().then(function() {\n      return new goog.Promise(function(resolve, reject) {\n        var doc = goog.global.document;\n        var timeoutId = setTimeout(function() {\n          reject(new Error('Cordova framework is not ready.'));\n        }, opt_timeout || fireauth.util.CORDOVA_ONDEVICEREADY_TIMEOUT_MS_);\n        // This should resolve immediately after DOM ready.\n        doc.addEventListener('deviceready', function() {\n          clearTimeout(timeoutId);\n          resolve();\n        }, false);\n      });\n    });\n  }\n  return goog.Promise.reject(\n      new Error('Cordova must run in an Android or iOS file scheme.'));\n};\n\n\n/**\n * @param {?string=} opt_userAgent The optional user agent.\n * @return {boolean} Whether the app is rendered in a mobile iOS or Android\n *     Cordova environment.\n */\nfireauth.util.isAndroidOrIosCordovaScheme = function(opt_userAgent) {\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  return !!((fireauth.util.getCurrentScheme() === 'file:' ||\n             fireauth.util.getCurrentScheme() === 'ionic:') &&\n            ua.toLowerCase().match(/iphone|ipad|ipod|android/));\n};\n\n\n/**\n * @param {?string=} opt_userAgent The optional user agent.\n * @return {boolean} Whether the app is rendered in a mobile iOS 7 or 8 browser.\n */\nfireauth.util.isIOS7Or8 = function(opt_userAgent) {\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  return !!(ua.match(/(iPad|iPhone|iPod).*OS 7_\\d/i) ||\n            ua.match(/(iPad|iPhone|iPod).*OS 8_\\d/i));\n};\n\n\n/**\n * @return {boolean} Whether browser is Safari or an iOS browser and page is\n *     embedded in an iframe. Local Storage does not synchronize with an iframe\n *     embedded on a page in a different domain but will still trigger storage\n *     event with storage changes.\n */\nfireauth.util.isSafariLocalStorageNotSynced = function() {\n  var ua = fireauth.util.getUserAgentString();\n  // Safari or iOS browser and embedded in an iframe.\n  if (!fireauth.util.iframeCanSyncWebStorage(ua) && fireauth.util.isIframe()) {\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * @param {?Window=} opt_win Optional window to check whether it is an iframe.\n *     If not provided, the current window is checked.\n * @return {boolean} Whether web page is running in an iframe.\n */\nfireauth.util.isIframe = function(opt_win) {\n  var win = opt_win || goog.global['window'];\n  try {\n    // Check that the current window is not the top window.\n    // If so, return true.\n    return !!(win && win != win['top']);\n  } catch (e) {\n    return false;\n  }\n};\n\n\n/**\n * @param {?Window=} opt_win Optional window to check whether it has an opener\n *     that is an iframe.\n * @return {boolean} Whether the web page was opened from an iframe.\n */\nfireauth.util.isOpenerAnIframe = function(opt_win) {\n  var win = opt_win || goog.global['window'];\n  try {\n    // Get the opener if available.\n    var opener = win && win['opener'];\n    // Check if the opener is an iframe. If so, return true.\n    // Confirm opener is available, otherwise the current window is checked\n    // instead.\n    return !!(opener && fireauth.util.isIframe(opener));\n  } catch (e) {\n    return false;\n  }\n};\n\n\n/**\n * @param {?Object=} global The optional global scope.\n * @return {boolean} Whether current environment is a worker.\n */\nfireauth.util.isWorker = function(global) {\n  var scope = global || goog.global;\n  // WorkerGlobalScope only defined in worker environment.\n  return typeof scope['WorkerGlobalScope'] !== 'undefined' &&\n         typeof scope['importScripts'] === 'function';\n};\n\n\n/**\n * @param {?Object=} opt_global The optional global scope.\n * @return {boolean} Whether current environment supports fetch API and other\n *     APIs it depends on.\n */\nfireauth.util.isFetchSupported = function(opt_global) {\n  // Required by fetch API calls.\n  var scope = opt_global || goog.global;\n  return typeof scope['fetch'] !== 'undefined' &&\n         typeof scope['Headers'] !== 'undefined' &&\n         typeof scope['Request'] !== 'undefined';\n};\n\n\n/**\n * Enum for the runtime environment.\n * @enum {string}\n */\nfireauth.util.Env = {\n  BROWSER: 'Browser',\n  NODE: 'Node',\n  REACT_NATIVE: 'ReactNative',\n  WORKER: 'Worker'\n};\n\n\n/**\n * @return {!fireauth.util.Env} The current runtime environment.\n */\nfireauth.util.getEnvironment = function() {\n  if (firebase.INTERNAL.hasOwnProperty('reactNative')) {\n    return fireauth.util.Env.REACT_NATIVE;\n  } else if (firebase.INTERNAL.hasOwnProperty('node')) {\n    // browserify seems to keep the process property in some cases even though\n    // the library is browser only. Use this check instead to reliably detect\n    // a Node.js environment.\n    return fireauth.util.Env.NODE;\n  } else if (fireauth.util.isWorker()) {\n    // Worker environment.\n    return fireauth.util.Env.WORKER;\n  }\n  // The default is a browser environment.\n  return fireauth.util.Env.BROWSER;\n};\n\n\n/**\n * @return {boolean} Whether the environment is a native environment, where\n *     CORS checks do not apply.\n */\nfireauth.util.isNativeEnvironment = function() {\n  var environment = fireauth.util.getEnvironment();\n  return environment === fireauth.util.Env.REACT_NATIVE ||\n      environment === fireauth.util.Env.NODE;\n};\n\n\n/**\n * The separator for storage keys to concatenate App name and API key.\n * @const {string}\n * @private\n */\nfireauth.util.STORAGE_KEY_SEPARATOR_ = ':';\n\n\n/**\n * @param {string} apiKey The API Key of the app.\n * @param {string} appName The App name.\n * @return {string} The key used for identifying the app owner of the user.\n */\nfireauth.util.createStorageKey = function(apiKey, appName) {\n  return apiKey + fireauth.util.STORAGE_KEY_SEPARATOR_ + appName;\n};\n\n\n/** @return {string} a long random character string. */\nfireauth.util.generateRandomString = function() {\n  return Math.floor(Math.random() * 1000000000).toString();\n};\n\n\n/**\n * Generates a random alpha numeric string.\n * @param {number} numOfChars The number of random characters within the string.\n * @return {string} A string with a specific number of random characters.\n */\nfireauth.util.generateRandomAlphaNumericString = function(numOfChars) {\n  var chars = [];\n  var allowedChars =\n      '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n  while (numOfChars > 0) {\n    chars.push(\n        allowedChars.charAt(\n            Math.floor(Math.random() * allowedChars.length)));\n    numOfChars--;\n  }\n  return chars.join('');\n};\n\n\n/**\n * Enums for Browser name.\n * @enum {string}\n */\nfireauth.util.BrowserName = {\n  ANDROID: 'Android',\n  BLACKBERRY: 'Blackberry',\n  EDGE: 'Edge',\n  FIREFOX: 'Firefox',\n  IE: 'IE',\n  IEMOBILE: 'IEMobile',\n  OPERA: 'Opera',\n  OTHER: 'Other',\n  CHROME: 'Chrome',\n  SAFARI: 'Safari',\n  SILK: 'Silk',\n  WEBOS: 'Webos'\n};\n\n\n/**\n * @param {string} userAgent The navigator user agent string.\n * @return {string} The browser name, eg Safari, Firefox, etc.\n */\nfireauth.util.getBrowserName = function(userAgent) {\n  var ua = userAgent.toLowerCase();\n  if (goog.string.contains(ua, 'opera/') ||\n      goog.string.contains(ua, 'opr/') ||\n      goog.string.contains(ua, 'opios/')) {\n    return fireauth.util.BrowserName.OPERA;\n  } else if (goog.string.contains(ua, 'iemobile')) {\n    // Windows phone IEMobile browser.\n    return fireauth.util.BrowserName.IEMOBILE;\n  } else if (goog.string.contains(ua, 'msie') ||\n             goog.string.contains(ua, 'trident/')) {\n    return fireauth.util.BrowserName.IE;\n  } else if (goog.string.contains(ua, 'edge/')) {\n    return fireauth.util.BrowserName.EDGE;\n  } else if (goog.string.contains(ua, 'firefox/')) {\n    return fireauth.util.BrowserName.FIREFOX;\n  } else if (goog.string.contains(ua, 'silk/')) {\n    return fireauth.util.BrowserName.SILK;\n  } else if (goog.string.contains(ua, 'blackberry')) {\n    // Blackberry browser.\n    return fireauth.util.BrowserName.BLACKBERRY;\n  } else if (goog.string.contains(ua, 'webos')) {\n    // WebOS default browser.\n    return fireauth.util.BrowserName.WEBOS;\n  } else if (goog.string.contains(ua, 'safari/') &&\n             !goog.string.contains(ua, 'chrome/') &&\n             !goog.string.contains(ua, 'crios/') &&\n             !goog.string.contains(ua, 'android')) {\n    return fireauth.util.BrowserName.SAFARI;\n  } else if ((goog.string.contains(ua, 'chrome/') ||\n              goog.string.contains(ua, 'crios/')) &&\n             !goog.string.contains(ua, 'edge/')) {\n    return fireauth.util.BrowserName.CHROME;\n  } else if (goog.string.contains(ua, 'android')) {\n    // Android stock browser.\n    return fireauth.util.BrowserName.ANDROID;\n  } else {\n    // Most modern browsers have name/version at end of user agent string.\n    var re = new RegExp('([a-zA-Z\\\\d\\\\.]+)\\/[a-zA-Z\\\\d\\\\.]*$');\n    var matches = userAgent.match(re);\n    if (matches && matches.length == 2) {\n      return matches[1];\n    }\n  }\n  return fireauth.util.BrowserName.OTHER;\n};\n\n\n/**\n * Enums for client implementation name.\n * @enum {string}\n */\nfireauth.util.ClientImplementation = {\n  JSCORE: 'JsCore',\n  OAUTH_HANDLER: 'Handler',\n  OAUTH_IFRAME: 'Iframe'\n};\n\n\n/**\n * Enums for the framework ID to be logged in RPC header.\n * Future frameworks to possibly add: angularfire, polymerfire, reactfire, etc.\n * @enum {string}.\n */\nfireauth.util.Framework = {\n  // No other framework used.\n  DEFAULT: 'FirebaseCore-web',\n  // Firebase Auth used with FirebaseUI-web.\n  FIREBASEUI: 'FirebaseUI-web'\n};\n\n\n/**\n * @param {!Array<string>} providedFrameworks List of framework ID strings.\n * @return {!Array<!fireauth.util.Framework>} List of supported framework IDs\n *     with no duplicates.\n */\nfireauth.util.getFrameworkIds = function(providedFrameworks) {\n  var frameworkVersion = [];\n  var frameworkSet = {};\n  for (var key in fireauth.util.Framework) {\n    frameworkSet[fireauth.util.Framework[key]] = true;\n  }\n  for (var i = 0; i < providedFrameworks.length; i++) {\n    if (typeof frameworkSet[providedFrameworks[i]] !== 'undefined') {\n      // Delete it from set to prevent duplications.\n      delete frameworkSet[providedFrameworks[i]];\n      frameworkVersion.push(providedFrameworks[i]);\n    }\n  }\n  // Sort alphabetically so that \"FirebaseCore-web,FirebaseUI-web\" and\n  // \"FirebaseUI-web,FirebaseCore-web\" aren't viewed as different.\n  frameworkVersion.sort();\n  return frameworkVersion;\n};\n\n\n/**\n * @param {!fireauth.util.ClientImplementation} clientImplementation The client\n *     implementation.\n * @param {string} clientVersion The client version.\n * @param {?Array<string>=} opt_frameworkVersion The framework version.\n * @param {?string=} opt_userAgent The optional user agent.\n * @return {string} The full client SDK version.\n */\nfireauth.util.getClientVersion = function(clientImplementation, clientVersion,\n    opt_frameworkVersion, opt_userAgent) {\n  var frameworkVersion = fireauth.util.getFrameworkIds(\n      opt_frameworkVersion || []);\n  if (!frameworkVersion.length) {\n    frameworkVersion = [fireauth.util.Framework.DEFAULT];\n  }\n  var environment = fireauth.util.getEnvironment();\n  var reportedEnvironment = '';\n  if (environment === fireauth.util.Env.BROWSER) {\n    // In a browser environment, report the browser name.\n    var userAgent = opt_userAgent || fireauth.util.getUserAgentString();\n    reportedEnvironment = fireauth.util.getBrowserName(userAgent);\n  } else if (environment === fireauth.util.Env.WORKER) {\n    // Technically a worker runs from a browser but we need to differentiate a\n    // worker from a browser.\n    // For example: Chrome-Worker/JsCore/4.9.1/FirebaseCore-web.\n    var userAgent = opt_userAgent || fireauth.util.getUserAgentString();\n    reportedEnvironment = fireauth.util.getBrowserName(userAgent) + '-' +\n        environment;\n  } else {\n    // Otherwise, just report the environment name.\n    reportedEnvironment = environment;\n  }\n  // The format to be followed:\n  // ${browserName}/${clientImplementation}/${clientVersion}/${frameworkVersion}\n  // As multiple Firebase frameworks/libraries can be used, join their IDs with\n  // a comma.\n  return reportedEnvironment + '/' + clientImplementation +\n      '/' + clientVersion + '/' + frameworkVersion.join(',');\n};\n\n\n/**\n * @return {string} The user agent string reported by the environment, or the\n *     empty string if not available.\n */\nfireauth.util.getUserAgentString = function() {\n  return (goog.global['navigator'] && goog.global['navigator']['userAgent']) ||\n      '';\n};\n\n\n/**\n * @param {string} varStrName The variable string name.\n * @param {?Object=} opt_scope The optional scope where to look in. The default\n *     is window.\n * @return {*} The reference if found.\n */\nfireauth.util.getObjectRef = function(varStrName, opt_scope) {\n  var pieces = varStrName.split('.');\n  var last = opt_scope || goog.global;\n  for (var i = 0;\n       i < pieces.length && typeof last == 'object' && last != null;\n       i++) {\n    last = last[pieces[i]];\n  }\n  // Last hasn't reached the end yet, return undefined.\n  if (i != pieces.length) {\n    last = undefined;\n  }\n  return last;\n};\n\n\n/** @return {boolean} Whether web storage is supported. */\nfireauth.util.isWebStorageSupported = function() {\n  try {\n    var storage = goog.global['localStorage'];\n    var key = fireauth.util.generateEventId();\n    if (storage) {\n      // setItem will throw an exception if we cannot access WebStorage (e.g.,\n      // Safari in private mode).\n      storage['setItem'](key, '1');\n      storage['removeItem'](key);\n      // For browsers where iframe web storage does not synchronize with a popup\n      // of the same domain, indexedDB is used for persistent storage. These\n      // browsers include IE11 and Edge.\n      // Make sure it is supported (IE11 and Edge private mode does not support\n      // that).\n      if (fireauth.util.isLocalStorageNotSynchronized()) {\n        // In such browsers, if indexedDB is not supported, an iframe cannot be\n        // notified of the popup sign in result.\n        return !!goog.global['indexedDB'];\n      }\n      return true;\n    }\n  } catch (e) {\n    // localStorage is not available from a worker. Test availability of\n    // indexedDB.\n    return fireauth.util.isWorker() && !!goog.global['indexedDB'];\n  }\n  return false;\n};\n\n\n/**\n * This guards against leaking Cordova support before official launch.\n * This field will be removed or updated to return true when the new feature is\n * ready for launch.\n * @return {boolean} Whether Cordova OAuth support is enabled.\n */\nfireauth.util.isCordovaOAuthEnabled = function() {\n  return false;\n};\n\n\n/**\n * @return {boolean} Whether popup and redirect operations are supported in the\n *     current environment.\n */\nfireauth.util.isPopupRedirectSupported = function() {\n  // Popup and redirect are supported in an environment where the container\n  // origin can be securely whitelisted.\n  return (fireauth.util.isHttpOrHttps() ||\n          fireauth.util.isChromeExtension() ||\n          fireauth.util.isAndroidOrIosCordovaScheme()) &&\n         // React Native with remote debugging reports its location.protocol as\n         // http.\n         !fireauth.util.isNativeEnvironment() &&\n         // Local storage has to be supported for browser popup and redirect\n         // operations to work.\n         fireauth.util.isWebStorageSupported() &&\n         // DOM, popups and redirects are not supported within a worker.\n         !fireauth.util.isWorker();\n};\n\n\n/**\n * @return {boolean} Whether the current environment is http or https.\n */\nfireauth.util.isHttpOrHttps = function() {\n  return fireauth.util.getCurrentScheme() === 'http:' ||\n       fireauth.util.getCurrentScheme() === 'https:';\n};\n\n\n/** @return {?string} The current URL scheme. */\nfireauth.util.getCurrentScheme = function() {\n  return (goog.global['location'] && goog.global['location']['protocol']) ||\n      null;\n};\n\n\n/**\n * Checks whether the current page is a Chrome extension.\n * @return {boolean} Whether the current page is a Chrome extension.\n */\nfireauth.util.isChromeExtension = function() {\n  return fireauth.util.getCurrentScheme() === 'chrome-extension:';\n};\n\n\n/**\n * @param {?string=} opt_userAgent The optional user agent.\n * @return {boolean} Whether the current browser is running in an iOS\n *     environment.\n */\nfireauth.util.isIOS = function(opt_userAgent) {\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  return !!ua.toLowerCase().match(/iphone|ipad|ipod/);\n};\n\n\n/**\n * @param {?string=} opt_userAgent The optional user agent.\n * @return {boolean} Whether the current browser is running in an Android\n *     environment.\n */\nfireauth.util.isAndroid = function(opt_userAgent) {\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  return !!ua.toLowerCase().match(/android/);\n};\n\n\n/**\n * @param {?string=} opt_userAgent The optional user agent.\n * @return {boolean} Whether the opener of a popup cannot communicate with the\n *     popup while it is in the foreground.\n */\nfireauth.util.runsInBackground = function(opt_userAgent) {\n  // TODO: split this check into 2, one check that opener can access\n  // popup, another check that storage synchronizes between popup and opener.\n  // Popup events fail in iOS version 7 (lowest version we currently support)\n  // browsers. When the popup is triggered, the opener is unable to redirect\n  // the popup url, close the popup and in some cases will miss the storage\n  // event triggered when localStorage is changed.\n  // Extend this to all mobile devices. This behavior is more likely to work\n  // cross mobile platforms.\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  if (fireauth.util.isMobileBrowser(ua)) {\n    return false;\n  } else if (fireauth.util.getBrowserName(ua) ==\n             fireauth.util.BrowserName.FIREFOX) {\n    // Latest version of Firefox 47.0 does not allow you to access properties on\n    // the popup window from the opener.\n    return false;\n  }\n  return true;\n};\n\n\n/**\n * Stringifies an object, retuning null if the object is not defined.\n * @param {*} obj The raw object.\n * @return {?string} The JSON-serialized object.\n */\nfireauth.util.stringifyJSON = function(obj) {\n  if (typeof obj === 'undefined') {\n    return null;\n  }\n  return goog.json.serialize(obj);\n};\n\n\n/**\n * @param {!Object} obj The original object.\n * @return {!Object} A copy of the original object with all entries that are\n *     null or undefined removed.\n */\nfireauth.util.copyWithoutNullsOrUndefined = function(obj) {\n  // The processed copy to return.\n  var trimmedObj = {};\n  // Remove all empty fields from data, allow zero and false booleans.\n  for (var key in obj) {\n    if (obj.hasOwnProperty(key) &&\n        obj[key] !== null &&\n        obj[key] !== undefined) {\n      trimmedObj[key] = obj[key];\n    }\n  }\n  return trimmedObj;\n};\n\n\n/**\n * Removes all key/pairs with the specified keys from the given object.\n * @param {!Object} obj The object to process.\n * @param {!Array<string>} keys The list of keys to remove.\n * @return {!Object} The object with the keys removed.\n */\nfireauth.util.removeEntriesWithKeys = function(obj, keys) {\n  // Clone object.\n  var copy = goog.object.clone(obj);\n  // Traverse keys.\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    // If key found in object, remove it.\n    if (key in copy) {\n      delete copy[key];\n    }\n  }\n  // Returned filtered copy.\n  return copy;\n};\n\n\n/**\n * Parses a JSON string, returning undefined if null is passed.\n * @param {?string} json The JSON-serialized object.\n * @return {*} The raw object.\n */\nfireauth.util.parseJSON = function(json) {\n  if (goog.isNull(json)) {\n    return undefined;\n  }\n\n  // Do not use goog.json.parse since it uses eval underneath to support old\n  // browsers that do not provide JSON.parse. The recommended Content Security\n  // Policy does not allow unsafe-eval in some environments like Chrome\n  // extensions. Usage of eval is not recommend in Chrome in general.\n  // Use native parsing instead via JSON.parse. This is provided in our list\n  // of supported browsers.\n  return JSON.parse(json);\n};\n\n\n/**\n * @param {?string=} opt_prefix An optional prefix string to prepend to ID.\n * @return {string} The generated event ID used to identify a generic event.\n */\nfireauth.util.generateEventId = function(opt_prefix) {\n  return opt_prefix ? opt_prefix : '' +\n      Math.floor(Math.random() * 1000000000).toString();\n};\n\n\n/**\n * @param {?string=} opt_userAgent The optional user agent.\n * @return {boolean} Whether an embedded iframe can sync to web storage changes.\n *     Web storage sync fails in Safari desktop browsers and iOS mobile\n *     browsers.\n */\nfireauth.util.iframeCanSyncWebStorage = function(opt_userAgent) {\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  if (fireauth.util.getBrowserName(ua) == fireauth.util.BrowserName.SAFARI ||\n      ua.toLowerCase().match(/iphone|ipad|ipod/)) {\n    return false;\n  }\n  return true;\n};\n\n\n/**\n * Reset unlaoded GApi modules. If gapi.load fails due to a network error,\n * it will stop working after a retrial. This is a hack to fix this issue.\n */\nfireauth.util.resetUnloadedGapiModules = function() {\n  // Clear last failed gapi.load state to force next gapi.load to first\n  // load the failed gapi.iframes module.\n  // Get gapix.beacon context.\n  var beacon = goog.global['___jsl'];\n  // Get current hint.\n  if (beacon && beacon['H']) {\n    // Get gapi hint.\n    for (var hint in beacon['H']) {\n      // Requested modules.\n      beacon['H'][hint]['r'] = beacon['H'][hint]['r'] || [];\n      // Loaded modules.\n      beacon['H'][hint]['L'] = beacon['H'][hint]['L'] || [];\n      // Set requested modules to a copy of the loaded modules.\n      beacon['H'][hint]['r'] = beacon['H'][hint]['L'].concat();\n      // Clear pending callbacks.\n      if (beacon['CP']) {\n        for (var i = 0; i < beacon['CP'].length; i++) {\n          // Remove all failed pending callbacks.\n          beacon['CP'][i] = null;\n        }\n      }\n    }\n  }\n};\n\n\n/**\n * Returns whether the current device is a mobile device. Mobile browsers and\n * React-Native environments are considered mobile devices.\n * @param {?string=} opt_userAgent The optional navigator user agent.\n * @param {?fireauth.util.Env=} opt_env The optional environment.\n * @return {boolean} Whether the current device is a mobile device or not.\n */\nfireauth.util.isMobileDevice = function(opt_userAgent, opt_env) {\n  // Get user agent.\n  var ua = opt_userAgent || fireauth.util.getUserAgentString();\n  // Get environment.\n  var environment = opt_env || fireauth.util.getEnvironment();\n  return fireauth.util.isMobileBrowser(ua) ||\n      environment === fireauth.util.Env.REACT_NATIVE;\n};\n\n\n/**\n * @param {?Object=} opt_navigator The optional navigator object typically used\n *     for testing.\n * @return {boolean} Whether the app is currently online. If offline, false is\n *     returned. If this cannot be determined, true is returned.\n */\nfireauth.util.isOnline = function(opt_navigator) {\n  var navigator = opt_navigator || goog.global['navigator'];\n  if (navigator &&\n      typeof navigator['onLine'] === 'boolean' &&\n      // Apply only for traditional web apps and Chrome extensions.\n      // This is especially true for Cordova apps which have unreliable\n      // navigator.onLine behavior unless cordova-plugin-network-information is\n      // installed which overwrites the native navigator.onLine value and\n      // defines navigator.connection.\n      (fireauth.util.isHttpOrHttps() ||\n       fireauth.util.isChromeExtension() ||\n       typeof navigator['connection'] !== 'undefined')) {\n    return navigator['onLine'];\n  }\n  // If we can't determine the state, assume it is online.\n  return true;\n};\n\n\n/**\n * @param {?Object=} opt_navigator The object with navigator data, defaulting\n *     to window.navigator if unspecified.\n * @return {?string} The user's preferred language. Returns null if\n */\nfireauth.util.getUserLanguage = function(opt_navigator) {\n  var navigator = opt_navigator || goog.global['navigator'];\n  if (!navigator) {\n    return null;\n  }\n  return (\n      // Most reliable, but only supported in Chrome/Firefox.\n      navigator['languages'] && navigator['languages'][0] ||\n      // Supported in most browsers, but returns the language of the browser\n      // UI, not the language set in browser settings.\n      navigator['language'] ||\n      // IE <= 10.\n      navigator['userLanguage'] ||\n      // Couldn't determine language.\n      null\n  );\n};\n\n\n/**\n * A structure to help pick between a range of long and short delay durations\n * depending on the current environment. In general, the long delay is used for\n * mobile environments whereas short delays are used for desktop environments.\n * @param {number} shortDelay The short delay duration.\n * @param {number} longDelay The long delay duration.\n * @param {?string=} opt_userAgent The optional navigator user agent.\n * @param {?fireauth.util.Env=} opt_env The optional environment.\n * @constructor\n */\nfireauth.util.Delay = function(shortDelay, longDelay, opt_userAgent, opt_env) {\n  // Internal error when improperly initialized.\n  if (shortDelay > longDelay) {\n    throw new Error('Short delay should be less than long delay!');\n  }\n  /**\n   * @private @const {number} The short duration delay used for desktop\n   *     environments.\n   */\n  this.shortDelay_ = shortDelay;\n  /**\n   * @private @const {number} The long duration delay used for mobile\n   *     environments.\n   */\n  this.longDelay_ = longDelay;\n  /** @private @const {boolean} Whether the environment is a mobile one. */\n  this.isMobile_ = fireauth.util.isMobileDevice(opt_userAgent, opt_env);\n};\n\n\n/**\n * The default value for the offline delay timeout in ms.\n * @const {number}\n * @private\n */\nfireauth.util.Delay.OFFLINE_DELAY_MS_ = 5000;\n\n\n/**\n * @return {number} The delay that matches with the current environment.\n */\nfireauth.util.Delay.prototype.get = function() {\n  // navigator.onLine is unreliable in some cases.\n  // Failing hard in those cases may make it impossible to recover for end user.\n  // Waiting for the regular full duration when there is no network can result\n  // in a bad experience.\n  // Instead return a short timeout duration. If there is no network connection,\n  // the user would wait 5 seconds to detect that. If there is a connection\n  // (false alert case), the user still has the ability to try to send the\n  // request. If it fails (timeout too short), they can still retry.\n  if (!fireauth.util.isOnline()) {\n    // Pick the shorter timeout.\n    return Math.min(fireauth.util.Delay.OFFLINE_DELAY_MS_, this.shortDelay_);\n  }\n  // If running in a mobile environment, return the long delay, otherwise\n  // return the short delay.\n  // This could be improved in the future to dynamically change based on other\n  // variables instead of just reading the current environment.\n  return this.isMobile_ ? this.longDelay_ : this.shortDelay_;\n};\n\n\n/**\n * @return {boolean} Whether the app is visible in the foreground. This uses\n *     document.visibilityState. For browsers that do not support it, this is\n *     always true.\n */\nfireauth.util.isAppVisible = function() {\n  // https://developer.mozilla.org/en-US/docs/Web/API/Document/visibilityState\n  var doc = goog.global.document;\n  // Check if supported.\n  if (doc && typeof doc['visibilityState'] !== 'undefined') {\n    // Check if visible.\n    return doc['visibilityState'] == 'visible';\n  }\n  // API not supported in current browser, default to true.\n  return true;\n};\n\n\n/**\n * @return {!goog.Promise} A promise that resolves when the app is visible in\n *     the foreground.\n */\nfireauth.util.onAppVisible = function() {\n  var doc = goog.global.document;\n  // Visibility change listener reference.\n  var onVisibilityChange = null;\n  if (fireauth.util.isAppVisible() || !doc) {\n    // Visible or non browser environment.\n    return goog.Promise.resolve();\n  } else {\n    // Invisible and in browser environment.\n    return new goog.Promise(function(resolve, reject) {\n      // On visibility change listener.\n      onVisibilityChange = function(event) {\n        // App is visible.\n        if (fireauth.util.isAppVisible()) {\n          // Unregister event listener.\n          doc.removeEventListener(\n              'visibilitychange', onVisibilityChange, false);\n          // Resolve promise.\n          resolve();\n        }\n      };\n      // Listen to visibility change.\n      doc.addEventListener('visibilitychange', onVisibilityChange, false);\n    }).thenCatch(function(error) {\n      // In case this promise was cancelled, make sure it unlistens to\n      // visibilitychange event.\n      doc.removeEventListener('visibilitychange', onVisibilityChange, false);\n      // Rethrow the same error.\n      throw error;\n    });\n  }\n};\n\n\n/**\n * Logs a warning message to the console, if the console is available.\n * @param {string} message\n */\nfireauth.util.consoleWarn = function(message) {\n  if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n    console.warn(message);\n  }\n};\n\n\n/**\n * Parses a UTC time stamp string or number and returns the corresponding UTC\n * date string if valid. Otherwise, returns null.\n * @param {?string|number} utcTimestamp The UTC timestamp number or string.\n * @return {?string} The corresponding UTC date string. Null if invalid.\n */\nfireauth.util.utcTimestampToDateString = function(utcTimestamp) {\n  try {\n    // Convert to date object.\n    var date = new Date(parseInt(utcTimestamp, 10));\n    // Test date is valid.\n    if (!isNaN(date.getTime()) &&\n        // Confirm that utcTimestamp is numeric.\n        goog.string.isNumeric(utcTimestamp)) {\n      // Convert to UTC date string.\n      return date.toUTCString();\n    }\n  } catch (e) {\n    // Do nothing. null will be returned.\n  }\n  return null;\n};\n\n\n/** @return {boolean} Whether indexedDB is available. */\nfireauth.util.isIndexedDBAvailable = function() {\n  return !!goog.global['indexedDB'];\n};\n\n\n/** @return {boolean} Whether current mode is Auth handler or iframe. */\nfireauth.util.isAuthHandlerOrIframe = function() {\n  return !!(fireauth.util.getObjectRef('fireauth.oauthhelper', goog.global) ||\n            fireauth.util.getObjectRef('fireauth.iframe', goog.global));\n};\n\n\n/** @return {boolean} Whether indexedDB is used to persist storage. */\nfireauth.util.persistsStorageWithIndexedDB = function() {\n  // This will cover:\n  // IE11, Edge when indexedDB is available (this is unavailable in InPrivate\n  // mode). (SDK, OAuth handler and iframe)\n  // Any environment where indexedDB is available (SDK only).\n\n  // In a browser environment, when an iframe and a popup web storage are not\n  // synchronized, use the indexedDB fireauth.storage.Storage implementation.\n  return (fireauth.util.isLocalStorageNotSynchronized() ||\n          !fireauth.util.isAuthHandlerOrIframe()) &&\n         fireauth.util.isIndexedDBAvailable();\n};\n\n\n/** Sets the no-referrer meta tag in the document head if applicable. */\nfireauth.util.setNoReferrer = function() {\n  var doc = goog.global.document;\n  if (doc) {\n    try {\n      var meta = goog.dom.createDom(goog.dom.TagName.META, {\n        'name': 'referrer',\n        'content': 'no-referrer'\n      });\n      var headCollection = goog.dom.getElementsByTagName(goog.dom.TagName.HEAD);\n      // Append meta tag to head.\n      if (headCollection.length) {\n        headCollection[0].appendChild(meta);\n      }\n    } catch (e) {\n      // Best effort approach.\n    }\n  }\n};\n\n\n/** @return {?ServiceWorker} The servicerWorker controller if available. */\nfireauth.util.getServiceWorkerController = function() {\n  var navigator = goog.global['navigator'];\n  return (navigator &&\n          navigator.serviceWorker &&\n          navigator.serviceWorker.controller) || null;\n};\n\n\n/** @return {?WorkerGlobalScope} The worker global scope if available. */\nfireauth.util.getWorkerGlobalScope = function() {\n  return fireauth.util.isWorker() ? /** @type {!WorkerGlobalScope} */ (self) :\n      null;\n};\n\n/**\n * @return {!goog.Promise<?ServiceWorker>} A promise that resolves with the\n *     service worker. This will resolve only when a service worker becomes\n *     available. If no service worker is supported, it will resolve with null.\n */\nfireauth.util.getActiveServiceWorker = function() {\n  var navigator = goog.global['navigator'];\n  if (navigator && navigator.serviceWorker) {\n    return goog.Promise.resolve()\n        .then(function() {\n          return navigator.serviceWorker.ready;\n        })\n        .then(function(registration) {\n          return /** @type {?ServiceWorker} */ (registration.active || null);\n        })\n        .thenCatch(function(error) {\n          return null;\n        });\n  }\n  return goog.Promise.resolve(/** @type {?ServiceWorker} */ (null));\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Utilities for window manipulation.\n */\n\n\ngoog.provide('goog.window');\n\ngoog.require('goog.dom.TagName');\ngoog.require('goog.dom.safe');\ngoog.require('goog.html.SafeUrl');\ngoog.require('goog.html.uncheckedconversions');\ngoog.require('goog.labs.userAgent.platform');\ngoog.require('goog.string');\ngoog.require('goog.string.Const');\ngoog.require('goog.userAgent');\n\n\n/**\n * Default height for popup windows\n * @type {number}\n */\ngoog.window.DEFAULT_POPUP_HEIGHT = 500;\n\n\n/**\n * Default width for popup windows\n * @type {number}\n */\ngoog.window.DEFAULT_POPUP_WIDTH = 690;\n\n\n/**\n * Default target for popup windows\n * @type {string}\n */\ngoog.window.DEFAULT_POPUP_TARGET = 'google_popup';\n\n\n/**\n * @return {!Window}\n * @suppress {checkTypes}\n * @private\n */\ngoog.window.createFakeWindow_ = function() {\n  return /** @type {!Window} */ ({});\n};\n\n/**\n * Opens a new window.\n *\n * @param {!goog.html.SafeUrl|string|!Object|null} linkRef If an Object with an\n *     'href' attribute (such as HTMLAnchorElement) is passed then the value of\n *     'href' is used, otherwise its toString method is called. Note that if a\n *     string|Object is used, it will be sanitized with SafeUrl.sanitize().\n *\n * @param {?Object=} opt_options supports the following options:\n *  'target': (string) target (window name). If null, linkRef.target will\n *      be used.\n *  'width': (number) window width.\n *  'height': (number) window height.\n *  'top': (number) distance from top of screen\n *  'left': (number) distance from left of screen\n *  'toolbar': (boolean) show toolbar\n *  'scrollbars': (boolean) show scrollbars\n *  'location': (boolean) show location\n *  'statusbar': (boolean) show statusbar\n *  'menubar': (boolean) show menubar\n *  'resizable': (boolean) resizable\n *  'noreferrer': (boolean) whether to attempt to remove the referrer header\n *      from the request headers. Does this by opening a blank window that\n *      then redirects to the target url, so users may see some flickering.\n *  'noopener': (boolean) whether to remove the `opener` property from the\n *      window object of the newly created window. The property contains a\n *      reference to the original window, and can be used to launch a\n *      reverse tabnabbing attack.\n *\n * @param {?Window=} opt_parentWin Parent window that should be used to open the\n *                 new window.\n *\n * @return {?Window} Returns the window object that was opened. This returns\n *                  null if a popup blocker prevented the window from being\n *                  opened. In case when a new window is opened in a different\n *                  browser sandbox (such as iOS standalone mode), the returned\n *                  object is a emulated Window object that functions as if\n *                  a cross-origin window has been opened.\n */\ngoog.window.open = function(linkRef, opt_options, opt_parentWin) {\n  if (!opt_options) {\n    opt_options = {};\n  }\n  var parentWin = opt_parentWin || window;\n\n  /** @type {!goog.html.SafeUrl} */\n  var safeLinkRef;\n\n  if (linkRef instanceof goog.html.SafeUrl) {\n    safeLinkRef = linkRef;\n  } else {\n    // HTMLAnchorElement has a toString() method with the same behavior as\n    // goog.Uri in all browsers except for Safari, which returns\n    // '[object HTMLAnchorElement]'.  We check for the href first, then\n    // assume that it's a goog.Uri or String otherwise.\n    /**\n     * @type {string|!goog.string.TypedString}\n     * @suppress {missingProperties}\n     */\n    var url =\n        typeof linkRef.href != 'undefined' ? linkRef.href : String(linkRef);\n    safeLinkRef = goog.html.SafeUrl.sanitize(url);\n  }\n\n  /** @suppress {missingProperties} loose references to 'target' */\n  /** @suppress {strictMissingProperties} */\n  var target = opt_options.target || linkRef.target;\n\n  var sb = [];\n  for (var option in opt_options) {\n    switch (option) {\n      case 'width':\n      case 'height':\n      case 'top':\n      case 'left':\n        sb.push(option + '=' + opt_options[option]);\n        break;\n      case 'target':\n      case 'noopener':\n      case 'noreferrer':\n        break;\n      default:\n        sb.push(option + '=' + (opt_options[option] ? 1 : 0));\n    }\n  }\n  var optionString = sb.join(',');\n\n  var newWin;\n  if (goog.labs.userAgent.platform.isIos() && parentWin.navigator &&\n      parentWin.navigator['standalone'] && target && target != '_self') {\n    // iOS in standalone mode disregards \"target\" in window.open and always\n    // opens new URL in the same window. The workaround is to create an \"A\"\n    // element and send a click event to it.\n    // Notice that the \"A\" tag does NOT have to be added to the DOM.\n\n    var a = /** @type {!HTMLAnchorElement} */\n        (parentWin.document.createElement(String(goog.dom.TagName.A)));\n    goog.dom.safe.setAnchorHref(a, safeLinkRef);\n\n    a.setAttribute('target', target);\n    if (opt_options['noreferrer']) {\n      a.setAttribute('rel', 'noreferrer');\n    }\n\n    var click = /** @type {!MouseEvent} */ (document.createEvent('MouseEvent'));\n    click.initMouseEvent(\n        'click',\n        true,  // canBubble\n        true,  // cancelable\n        parentWin,\n        1);  // detail = mousebutton\n    a.dispatchEvent(click);\n    // New window is not available in this case. Instead, a fake Window object\n    // is returned. In particular, it will have window.document undefined. In\n    // general, it will appear to most of clients as a Window for a different\n    // origin. Since iOS standalone web apps are run in their own sandbox, this\n    // is the most appropriate return value.\n    newWin = goog.window.createFakeWindow_();\n  } else if (opt_options['noreferrer']) {\n    // This code used to use meta-refresh to stop the referrer from being\n    // included in the request headers. This was the only cross-browser way\n    // to remove the referrer circa 2009. However, this never worked in Chrome,\n    // and, instead newWin.opener had to be set to null on this browser. This\n    // behavior is slated to be removed in Chrome and should not be relied\n    // upon. Referrer Policy is the only spec'd and supported way of stripping\n    // referrers and works across all current browsers. This is used in\n    // addition to the aforementioned tricks.\n    //\n    // We also set the opener to be set to null in the new window, thus\n    // disallowing the opened window from navigating its opener.\n    //\n    // Detecting user agent and then using a different strategy per browser\n    // would allow the referrer to leak in case of an incorrect/missing user\n    // agent.\n    //\n    // Also note that we can't use goog.dom.safe.openInWindow here, as it\n    // requires a goog.string.Const 'name' parameter, while we're using plain\n    // strings here for target.\n    newWin = parentWin.open('', target, optionString);\n\n    var sanitizedLinkRef = goog.html.SafeUrl.unwrap(safeLinkRef);\n    if (newWin) {\n      if (goog.userAgent.EDGE_OR_IE) {\n        // IE/EDGE can't parse the content attribute if the url contains\n        // a semicolon. We can fix this by adding quotes around the url, but\n        // then we can't parse quotes in the URL correctly. We take a\n        // best-effort approach.\n        //\n        // If the URL has semicolons, wrap it in single quotes to protect\n        // the semicolons.\n        // If the URL has semicolons and single quotes, url-encode the single\n        // quotes as well.\n        //\n        // This is imperfect. Notice that both ' and ; are reserved characters\n        // in URIs, so this could do the wrong thing, but at least it will\n        // do the wrong thing in only rare cases.\n        // ugh.\n        if (goog.string.contains(sanitizedLinkRef, ';')) {\n          sanitizedLinkRef = \"'\" + sanitizedLinkRef.replace(/'/g, '%27') + \"'\";\n        }\n      }\n      newWin.opener = null;\n\n      // TODO(rjamet): Building proper SafeHtml with SafeHtml.createMetaRefresh\n      // pulls in a lot of compiled code, which is composed of various unneeded\n      // goog.html parts such as SafeStyle.create among others. So, for now,\n      // keep the unchecked conversion until we figure out how to make the\n      // dependencies of createSafeHtmlTagSecurityPrivateDoNotAccessOrElse less\n      // heavy.\n      var safeHtml =\n          goog.html.uncheckedconversions\n              .safeHtmlFromStringKnownToSatisfyTypeContract(\n                  goog.string.Const.from(\n                      'b/12014412, meta tag with sanitized URL'),\n                  '<meta name=\"referrer\" content=\"no-referrer\">' +\n                      '<meta http-equiv=\"refresh\" content=\"0; url=' +\n                      goog.string.htmlEscape(sanitizedLinkRef) + '\">');\n      goog.dom.safe.documentWrite(newWin.document, safeHtml);\n      newWin.document.close();\n    }\n  } else {\n    newWin = parentWin.open(\n        goog.html.SafeUrl.unwrap(safeLinkRef), target, optionString);\n    // Passing in 'noopener' into the 'windowFeatures' param of window.open(...)\n    // will yield a feature-deprived browser. This is an known issue, tracked\n    // here: https://github.com/whatwg/html/issues/1902\n    if (newWin && opt_options['noopener']) {\n      newWin.opener = null;\n    }\n  }\n  // newWin is null if a popup blocker prevented the window open.\n  return newWin;\n};\n\n\n/**\n * Opens a new window without any real content in it.\n *\n * This can be used to get around popup blockers if you need to open a window\n * in response to a user event, but need to do asynchronous work to determine\n * the URL to open, and then set the URL later.\n *\n * Example usage:\n *\n * var newWin = goog.window.openBlank('Loading...');\n * setTimeout(\n *     function() {\n *       newWin.location.href = 'http://www.google.com';\n *     }, 100);\n *\n * @param {string=} opt_message String to show in the new window. This string\n *     will be HTML-escaped to avoid XSS issues.\n * @param {?Object=} opt_options Options to open window with.\n *     {@see goog.window.open for exact option semantics}.\n * @param {?Window=} opt_parentWin Parent window that should be used to open the\n *                 new window.\n * @return {?Window} Returns the window object that was opened. This returns\n *                  null if a popup blocker prevented the window from being\n *                  opened.\n */\ngoog.window.openBlank = function(opt_message, opt_options, opt_parentWin) {\n  // Open up a window with the loading message and nothing else.\n  // This will be interpreted as HTML content type with a missing doctype\n  // and html/body tags, but is otherwise acceptable.\n  //\n  // IMPORTANT: The order of escaping is crucial here in order to avoid XSS.\n  // First, HTML-escaping is needed because the result of the JS expression\n  // is evaluated as HTML. Second, JS-string escaping is needed; this avoids\n  // \\u escaping from inserting HTML tags and \\ from escaping the final \".\n  // Finally, URL percent-encoding is done with encodeURI(); this\n  // avoids percent-encoding from bypassing HTML and JS escaping.\n  //\n  // Note: There are other ways the same result could be achieved but the\n  // current behavior was preserved when this code was refactored to use\n  // SafeUrl, in order to avoid breakage.\n  var loadingMessage;\n  if (!opt_message) {\n    loadingMessage = '';\n  } else {\n    loadingMessage =\n        goog.string.escapeString(goog.string.htmlEscape(opt_message));\n  }\n  var url = goog.html.uncheckedconversions\n                .safeUrlFromStringKnownToSatisfyTypeContract(\n                    goog.string.Const.from(\n                        'b/12014412, encoded string in javascript: URL'),\n                    'javascript:\"' + encodeURI(loadingMessage) + '\"');\n  return /** @type {?Window} */ (\n      goog.window.open(url, opt_options, opt_parentWin));\n};\n\n\n/**\n * Raise a help popup window, defaulting to \"Google standard\" size and name.\n *\n * (If your project is using GXPs, consider using {@link PopUpLink.gxp}.)\n *\n* @param {?goog.html.SafeUrl|string|?Object} linkRef If an Object with an 'href'\n *     attribute (such as HTMLAnchorElement) is passed then the value of 'href'\n *     is used, otherwise  otherwise its toString method is called. Note that\n *     if a string|Object is used, it will be sanitized with SafeUrl.sanitize().\n *\n * @param {?Object=} opt_options Options to open window with.\n *     {@see goog.window.open for exact option semantics}\n *     Additional wrinkles to the options:\n *     - if 'target' field is null, linkRef.target will be used. If *that's*\n *     null, the default is \"google_popup\".\n *     - if 'width' field is not specified, the default is 690.\n *     - if 'height' field is not specified, the default is 500.\n *\n * @return {boolean} true if the window was not popped up, false if it was.\n */\ngoog.window.popup = function(linkRef, opt_options) {\n  if (!opt_options) {\n    opt_options = {};\n  }\n\n  // set default properties\n  opt_options['target'] = opt_options['target'] || linkRef['target'] ||\n      goog.window.DEFAULT_POPUP_TARGET;\n  opt_options['width'] =\n      opt_options['width'] || goog.window.DEFAULT_POPUP_WIDTH;\n  opt_options['height'] =\n      opt_options['height'] || goog.window.DEFAULT_POPUP_HEIGHT;\n\n  var newWin = goog.window.open(linkRef, opt_options);\n  if (!newWin) {\n    return true;\n  }\n  newWin.focus();\n\n  return false;\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Closure user agent platform detection.\n * @see <a href=\"http://www.useragentstring.com/\">User agent strings</a>\n * For more information on browser brand, rendering engine, or device see the\n * other sub-namespaces in goog.labs.userAgent (browser, engine, and device\n * respectively).\n *\n */\n\ngoog.provide('goog.labs.userAgent.platform');\n\ngoog.require('goog.labs.userAgent.util');\ngoog.require('goog.string');\n\n\n/**\n * @return {boolean} Whether the platform is Android.\n */\ngoog.labs.userAgent.platform.isAndroid = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Android');\n};\n\n\n/**\n * @return {boolean} Whether the platform is iPod.\n */\ngoog.labs.userAgent.platform.isIpod = function() {\n  return goog.labs.userAgent.util.matchUserAgent('iPod');\n};\n\n\n/**\n * @return {boolean} Whether the platform is iPhone.\n */\ngoog.labs.userAgent.platform.isIphone = function() {\n  return goog.labs.userAgent.util.matchUserAgent('iPhone') &&\n      !goog.labs.userAgent.util.matchUserAgent('iPod') &&\n      !goog.labs.userAgent.util.matchUserAgent('iPad');\n};\n\n\n/**\n * @return {boolean} Whether the platform is iPad.\n */\ngoog.labs.userAgent.platform.isIpad = function() {\n  return goog.labs.userAgent.util.matchUserAgent('iPad');\n};\n\n\n/**\n * @return {boolean} Whether the platform is iOS.\n */\ngoog.labs.userAgent.platform.isIos = function() {\n  return goog.labs.userAgent.platform.isIphone() ||\n      goog.labs.userAgent.platform.isIpad() ||\n      goog.labs.userAgent.platform.isIpod();\n};\n\n\n/**\n * @return {boolean} Whether the platform is Mac.\n */\ngoog.labs.userAgent.platform.isMacintosh = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Macintosh');\n};\n\n\n/**\n * Note: ChromeOS is not considered to be Linux as it does not report itself\n * as Linux in the user agent string.\n * @return {boolean} Whether the platform is Linux.\n */\ngoog.labs.userAgent.platform.isLinux = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Linux');\n};\n\n\n/**\n * @return {boolean} Whether the platform is Windows.\n */\ngoog.labs.userAgent.platform.isWindows = function() {\n  return goog.labs.userAgent.util.matchUserAgent('Windows');\n};\n\n\n/**\n * @return {boolean} Whether the platform is ChromeOS.\n */\ngoog.labs.userAgent.platform.isChromeOS = function() {\n  return goog.labs.userAgent.util.matchUserAgent('CrOS');\n};\n\n/**\n * @return {boolean} Whether the platform is Chromecast.\n */\ngoog.labs.userAgent.platform.isChromecast = function() {\n  return goog.labs.userAgent.util.matchUserAgent('CrKey');\n};\n\n/**\n * @return {boolean} Whether the platform is KaiOS.\n */\ngoog.labs.userAgent.platform.isKaiOS = function() {\n  return goog.labs.userAgent.util.matchUserAgentIgnoreCase('KaiOS');\n};\n\n/**\n * @return {boolean} Whether the platform is Go2Phone.\n */\ngoog.labs.userAgent.platform.isGo2Phone = function() {\n  return goog.labs.userAgent.util.matchUserAgentIgnoreCase('GAFP');\n};\n\n/**\n * The version of the platform. We only determine the version for Windows,\n * Mac, and Chrome OS. It doesn't make much sense on Linux. For Windows, we only\n * look at the NT version. Non-NT-based versions (e.g. 95, 98, etc.) are given\n * version 0.0.\n *\n * @return {string} The platform version or empty string if version cannot be\n *     determined.\n */\ngoog.labs.userAgent.platform.getVersion = function() {\n  var userAgentString = goog.labs.userAgent.util.getUserAgent();\n  var version = '', re;\n  if (goog.labs.userAgent.platform.isWindows()) {\n    re = /Windows (?:NT|Phone) ([0-9.]+)/;\n    var match = re.exec(userAgentString);\n    if (match) {\n      version = match[1];\n    } else {\n      version = '0.0';\n    }\n  } else if (goog.labs.userAgent.platform.isIos()) {\n    re = /(?:iPhone|iPod|iPad|CPU)\\s+OS\\s+(\\S+)/;\n    var match = re.exec(userAgentString);\n    // Report the version as x.y.z and not x_y_z\n    version = match && match[1].replace(/_/g, '.');\n  } else if (goog.labs.userAgent.platform.isMacintosh()) {\n    re = /Mac OS X ([0-9_.]+)/;\n    var match = re.exec(userAgentString);\n    // Note: some old versions of Camino do not report an OSX version.\n    // Default to 10.\n    version = match ? match[1].replace(/_/g, '.') : '10';\n  } else if (goog.labs.userAgent.platform.isKaiOS()) {\n    re = /(?:KaiOS)\\/(\\S+)/i;\n    var match = re.exec(userAgentString);\n    version = match && match[1];\n  } else if (goog.labs.userAgent.platform.isAndroid()) {\n    re = /Android\\s+([^\\);]+)(\\)|;)/;\n    var match = re.exec(userAgentString);\n    version = match && match[1];\n  } else if (goog.labs.userAgent.platform.isChromeOS()) {\n    re = /(?:CrOS\\s+(?:i686|x86_64)\\s+([0-9.]+))/;\n    var match = re.exec(userAgentString);\n    version = match && match[1];\n  }\n  return version || '';\n};\n\n\n/**\n * @param {string|number} version The version to check.\n * @return {boolean} Whether the browser version is higher or the same as the\n *     given version.\n */\ngoog.labs.userAgent.platform.isVersionOrHigher = function(version) {\n  return goog.string.compareVersions(\n             goog.labs.userAgent.platform.getVersion(), version) >= 0;\n};\n","// Copyright 2010 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Event Types.\n *\n * @author arv@google.com (Erik Arvidsson)\n */\n\n\ngoog.provide('goog.events.EventType');\ngoog.provide('goog.events.MouseAsMouseEventType');\ngoog.provide('goog.events.MouseEvents');\ngoog.provide('goog.events.PointerAsMouseEventType');\ngoog.provide('goog.events.PointerAsTouchEventType');\ngoog.provide('goog.events.PointerFallbackEventType');\ngoog.provide('goog.events.PointerTouchFallbackEventType');\n\ngoog.require('goog.events.BrowserFeature');\ngoog.require('goog.userAgent');\n\n\n/**\n * Returns a prefixed event name for the current browser.\n * @param {string} eventName The name of the event.\n * @return {string} The prefixed event name.\n * @suppress {missingRequire|missingProvide}\n * @private\n */\ngoog.events.getVendorPrefixedName_ = function(eventName) {\n  return goog.userAgent.WEBKIT ?\n      'webkit' + eventName :\n      (goog.userAgent.OPERA ? 'o' + eventName.toLowerCase() :\n                              eventName.toLowerCase());\n};\n\n\n/**\n * Constants for event names.\n * @enum {string}\n */\ngoog.events.EventType = {\n  // Mouse events\n  CLICK: 'click',\n  RIGHTCLICK: 'rightclick',\n  DBLCLICK: 'dblclick',\n  AUXCLICK: 'auxclick',\n  MOUSEDOWN: 'mousedown',\n  MOUSEUP: 'mouseup',\n  MOUSEOVER: 'mouseover',\n  MOUSEOUT: 'mouseout',\n  MOUSEMOVE: 'mousemove',\n  MOUSEENTER: 'mouseenter',\n  MOUSELEAVE: 'mouseleave',\n\n  // Non-existent event; will never fire. This exists as a mouse counterpart to\n  // POINTERCANCEL.\n  MOUSECANCEL: 'mousecancel',\n\n  // Selection events.\n  // https://www.w3.org/TR/selection-api/\n  SELECTIONCHANGE: 'selectionchange',\n  SELECTSTART: 'selectstart',  // IE, Safari, Chrome\n\n  // Wheel events\n  // http://www.w3.org/TR/DOM-Level-3-Events/#events-wheelevents\n  WHEEL: 'wheel',\n\n  // Key events\n  KEYPRESS: 'keypress',\n  KEYDOWN: 'keydown',\n  KEYUP: 'keyup',\n\n  // Focus\n  BLUR: 'blur',\n  FOCUS: 'focus',\n  DEACTIVATE: 'deactivate',  // IE only\n  FOCUSIN: 'focusin',\n  FOCUSOUT: 'focusout',\n\n  // Forms\n  CHANGE: 'change',\n  RESET: 'reset',\n  SELECT: 'select',\n  SUBMIT: 'submit',\n  INPUT: 'input',\n  PROPERTYCHANGE: 'propertychange',  // IE only\n\n  // Drag and drop\n  DRAGSTART: 'dragstart',\n  DRAG: 'drag',\n  DRAGENTER: 'dragenter',\n  DRAGOVER: 'dragover',\n  DRAGLEAVE: 'dragleave',\n  DROP: 'drop',\n  DRAGEND: 'dragend',\n\n  // Touch events\n  // Note that other touch events exist, but we should follow the W3C list here.\n  // http://www.w3.org/TR/touch-events/#list-of-touchevent-types\n  TOUCHSTART: 'touchstart',\n  TOUCHMOVE: 'touchmove',\n  TOUCHEND: 'touchend',\n  TOUCHCANCEL: 'touchcancel',\n\n  // Misc\n  BEFOREUNLOAD: 'beforeunload',\n  CONSOLEMESSAGE: 'consolemessage',\n  CONTEXTMENU: 'contextmenu',\n  DEVICECHANGE: 'devicechange',\n  DEVICEMOTION: 'devicemotion',\n  DEVICEORIENTATION: 'deviceorientation',\n  DOMCONTENTLOADED: 'DOMContentLoaded',\n  ERROR: 'error',\n  HELP: 'help',\n  LOAD: 'load',\n  LOSECAPTURE: 'losecapture',\n  ORIENTATIONCHANGE: 'orientationchange',\n  READYSTATECHANGE: 'readystatechange',\n  RESIZE: 'resize',\n  SCROLL: 'scroll',\n  UNLOAD: 'unload',\n\n  // Media events\n  CANPLAY: 'canplay',\n  CANPLAYTHROUGH: 'canplaythrough',\n  DURATIONCHANGE: 'durationchange',\n  EMPTIED: 'emptied',\n  ENDED: 'ended',\n  LOADEDDATA: 'loadeddata',\n  LOADEDMETADATA: 'loadedmetadata',\n  PAUSE: 'pause',\n  PLAY: 'play',\n  PLAYING: 'playing',\n  RATECHANGE: 'ratechange',\n  SEEKED: 'seeked',\n  SEEKING: 'seeking',\n  STALLED: 'stalled',\n  SUSPEND: 'suspend',\n  TIMEUPDATE: 'timeupdate',\n  VOLUMECHANGE: 'volumechange',\n  WAITING: 'waiting',\n\n  // Media Source Extensions events\n  // https://www.w3.org/TR/media-source/#mediasource-events\n  SOURCEOPEN: 'sourceopen',\n  SOURCEENDED: 'sourceended',\n  SOURCECLOSED: 'sourceclosed',\n  // https://www.w3.org/TR/media-source/#sourcebuffer-events\n  ABORT: 'abort',\n  UPDATE: 'update',\n  UPDATESTART: 'updatestart',\n  UPDATEEND: 'updateend',\n\n  // HTML 5 History events\n  // See http://www.w3.org/TR/html5/browsers.html#event-definitions-0\n  HASHCHANGE: 'hashchange',\n  PAGEHIDE: 'pagehide',\n  PAGESHOW: 'pageshow',\n  POPSTATE: 'popstate',\n\n  // Copy and Paste\n  // Support is limited. Make sure it works on your favorite browser\n  // before using.\n  // http://www.quirksmode.org/dom/events/cutcopypaste.html\n  COPY: 'copy',\n  PASTE: 'paste',\n  CUT: 'cut',\n  BEFORECOPY: 'beforecopy',\n  BEFORECUT: 'beforecut',\n  BEFOREPASTE: 'beforepaste',\n\n  // HTML5 online/offline events.\n  // http://www.w3.org/TR/offline-webapps/#related\n  ONLINE: 'online',\n  OFFLINE: 'offline',\n\n  // HTML 5 worker events\n  MESSAGE: 'message',\n  CONNECT: 'connect',\n\n  // Service Worker Events - ServiceWorkerGlobalScope context\n  // See https://w3c.github.io/ServiceWorker/#execution-context-events\n  // Note: message event defined in worker events section\n  INSTALL: 'install',\n  ACTIVATE: 'activate',\n  FETCH: 'fetch',\n  FOREIGNFETCH: 'foreignfetch',\n  MESSAGEERROR: 'messageerror',\n\n  // Service Worker Events - Document context\n  // See https://w3c.github.io/ServiceWorker/#document-context-events\n  STATECHANGE: 'statechange',\n  UPDATEFOUND: 'updatefound',\n  CONTROLLERCHANGE: 'controllerchange',\n\n  // CSS animation events.\n  /** @suppress {missingRequire} */\n  ANIMATIONSTART: goog.events.getVendorPrefixedName_('AnimationStart'),\n  /** @suppress {missingRequire} */\n  ANIMATIONEND: goog.events.getVendorPrefixedName_('AnimationEnd'),\n  /** @suppress {missingRequire} */\n  ANIMATIONITERATION: goog.events.getVendorPrefixedName_('AnimationIteration'),\n\n  // CSS transition events. Based on the browser support described at:\n  // https://developer.mozilla.org/en/css/css_transitions#Browser_compatibility\n  /** @suppress {missingRequire} */\n  TRANSITIONEND: goog.events.getVendorPrefixedName_('TransitionEnd'),\n\n  // W3C Pointer Events\n  // http://www.w3.org/TR/pointerevents/\n  POINTERDOWN: 'pointerdown',\n  POINTERUP: 'pointerup',\n  POINTERCANCEL: 'pointercancel',\n  POINTERMOVE: 'pointermove',\n  POINTEROVER: 'pointerover',\n  POINTEROUT: 'pointerout',\n  POINTERENTER: 'pointerenter',\n  POINTERLEAVE: 'pointerleave',\n  GOTPOINTERCAPTURE: 'gotpointercapture',\n  LOSTPOINTERCAPTURE: 'lostpointercapture',\n\n  // IE specific events.\n  // See http://msdn.microsoft.com/en-us/library/ie/hh772103(v=vs.85).aspx\n  // Note: these events will be supplanted in IE11.\n  MSGESTURECHANGE: 'MSGestureChange',\n  MSGESTUREEND: 'MSGestureEnd',\n  MSGESTUREHOLD: 'MSGestureHold',\n  MSGESTURESTART: 'MSGestureStart',\n  MSGESTURETAP: 'MSGestureTap',\n  MSGOTPOINTERCAPTURE: 'MSGotPointerCapture',\n  MSINERTIASTART: 'MSInertiaStart',\n  MSLOSTPOINTERCAPTURE: 'MSLostPointerCapture',\n  MSPOINTERCANCEL: 'MSPointerCancel',\n  MSPOINTERDOWN: 'MSPointerDown',\n  MSPOINTERENTER: 'MSPointerEnter',\n  MSPOINTERHOVER: 'MSPointerHover',\n  MSPOINTERLEAVE: 'MSPointerLeave',\n  MSPOINTERMOVE: 'MSPointerMove',\n  MSPOINTEROUT: 'MSPointerOut',\n  MSPOINTEROVER: 'MSPointerOver',\n  MSPOINTERUP: 'MSPointerUp',\n\n  // Native IMEs/input tools events.\n  TEXT: 'text',\n  // The textInput event is supported in IE9+, but only in lower case. All other\n  // browsers use the camel-case event name.\n  TEXTINPUT: goog.userAgent.IE ? 'textinput' : 'textInput',\n  COMPOSITIONSTART: 'compositionstart',\n  COMPOSITIONUPDATE: 'compositionupdate',\n  COMPOSITIONEND: 'compositionend',\n\n  // The beforeinput event is initially only supported in Safari. See\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=342670 for Chrome\n  // implementation tracking.\n  BEFOREINPUT: 'beforeinput',\n\n  // Webview tag events\n  // See https://developer.chrome.com/apps/tags/webview\n  EXIT: 'exit',\n  LOADABORT: 'loadabort',\n  LOADCOMMIT: 'loadcommit',\n  LOADREDIRECT: 'loadredirect',\n  LOADSTART: 'loadstart',\n  LOADSTOP: 'loadstop',\n  RESPONSIVE: 'responsive',\n  SIZECHANGED: 'sizechanged',\n  UNRESPONSIVE: 'unresponsive',\n\n  // HTML5 Page Visibility API.  See details at\n  // `goog.labs.dom.PageVisibilityMonitor`.\n  VISIBILITYCHANGE: 'visibilitychange',\n\n  // LocalStorage event.\n  STORAGE: 'storage',\n\n  // DOM Level 2 mutation events (deprecated).\n  DOMSUBTREEMODIFIED: 'DOMSubtreeModified',\n  DOMNODEINSERTED: 'DOMNodeInserted',\n  DOMNODEREMOVED: 'DOMNodeRemoved',\n  DOMNODEREMOVEDFROMDOCUMENT: 'DOMNodeRemovedFromDocument',\n  DOMNODEINSERTEDINTODOCUMENT: 'DOMNodeInsertedIntoDocument',\n  DOMATTRMODIFIED: 'DOMAttrModified',\n  DOMCHARACTERDATAMODIFIED: 'DOMCharacterDataModified',\n\n  // Print events.\n  BEFOREPRINT: 'beforeprint',\n  AFTERPRINT: 'afterprint',\n\n  // Web app manifest events.\n  BEFOREINSTALLPROMPT: 'beforeinstallprompt',\n  APPINSTALLED: 'appinstalled'\n};\n\n\n/**\n * Returns one of the given pointer fallback event names in order of preference:\n *   1. pointerEventName\n *   2. msPointerEventName\n *   3. fallbackEventName\n * @param {string} pointerEventName\n * @param {string} msPointerEventName\n * @param {string} fallbackEventName\n * @return {string} The supported pointer or fallback (mouse or touch) event\n *     name.\n * @private\n */\ngoog.events.getPointerFallbackEventName_ = function(\n    pointerEventName, msPointerEventName, fallbackEventName) {\n  if (goog.events.BrowserFeature.POINTER_EVENTS) {\n    return pointerEventName;\n  }\n  if (goog.events.BrowserFeature.MSPOINTER_EVENTS) {\n    return msPointerEventName;\n  }\n  return fallbackEventName;\n};\n\n\n/**\n * Constants for pointer event names that fall back to corresponding mouse event\n * names on unsupported platforms. These are intended to be drop-in replacements\n * for corresponding values in `goog.events.EventType`.\n * @enum {string}\n */\ngoog.events.PointerFallbackEventType = {\n  POINTERDOWN: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERDOWN, goog.events.EventType.MSPOINTERDOWN,\n      goog.events.EventType.MOUSEDOWN),\n  POINTERUP: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERUP, goog.events.EventType.MSPOINTERUP,\n      goog.events.EventType.MOUSEUP),\n  POINTERCANCEL: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERCANCEL,\n      goog.events.EventType.MSPOINTERCANCEL,\n      // When falling back to mouse events, there is no MOUSECANCEL equivalent\n      // of POINTERCANCEL. In this case POINTERUP already falls back to MOUSEUP\n      // which represents both UP and CANCEL. POINTERCANCEL does not fall back\n      // to MOUSEUP to prevent listening twice on the same event.\n      goog.events.EventType.MOUSECANCEL),\n  POINTERMOVE: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERMOVE, goog.events.EventType.MSPOINTERMOVE,\n      goog.events.EventType.MOUSEMOVE),\n  POINTEROVER: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTEROVER, goog.events.EventType.MSPOINTEROVER,\n      goog.events.EventType.MOUSEOVER),\n  POINTEROUT: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTEROUT, goog.events.EventType.MSPOINTEROUT,\n      goog.events.EventType.MOUSEOUT),\n  POINTERENTER: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERENTER, goog.events.EventType.MSPOINTERENTER,\n      goog.events.EventType.MOUSEENTER),\n  POINTERLEAVE: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERLEAVE, goog.events.EventType.MSPOINTERLEAVE,\n      goog.events.EventType.MOUSELEAVE)\n};\n\n\n/**\n * Constants for pointer event names that fall back to corresponding touch event\n * names on unsupported platforms. These are intended to be drop-in replacements\n * for corresponding values in `goog.events.EventType`.\n * @enum {string}\n */\ngoog.events.PointerTouchFallbackEventType = {\n  POINTERDOWN: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERDOWN, goog.events.EventType.MSPOINTERDOWN,\n      goog.events.EventType.TOUCHSTART),\n  POINTERUP: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERUP, goog.events.EventType.MSPOINTERUP,\n      goog.events.EventType.TOUCHEND),\n  POINTERCANCEL: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERCANCEL,\n      goog.events.EventType.MSPOINTERCANCEL, goog.events.EventType.TOUCHCANCEL),\n  POINTERMOVE: goog.events.getPointerFallbackEventName_(\n      goog.events.EventType.POINTERMOVE, goog.events.EventType.MSPOINTERMOVE,\n      goog.events.EventType.TOUCHMOVE)\n};\n\n\n/**\n * Mapping of mouse event names to underlying browser event names.\n * @typedef {{\n *     MOUSEDOWN: string,\n *     MOUSEUP: string,\n *     MOUSECANCEL:string,\n *     MOUSEMOVE:string,\n *     MOUSEOVER:string,\n *     MOUSEOUT:string,\n *     MOUSEENTER:string,\n *     MOUSELEAVE: string,\n * }}\n */\ngoog.events.MouseEvents;\n\n\n/**\n * An alias for `goog.events.EventType.MOUSE*` event types that is overridden by\n * corresponding `POINTER*` event types.\n * @const {!goog.events.MouseEvents}\n */\ngoog.events.PointerAsMouseEventType = {\n  MOUSEDOWN: goog.events.PointerFallbackEventType.POINTERDOWN,\n  MOUSEUP: goog.events.PointerFallbackEventType.POINTERUP,\n  MOUSECANCEL: goog.events.PointerFallbackEventType.POINTERCANCEL,\n  MOUSEMOVE: goog.events.PointerFallbackEventType.POINTERMOVE,\n  MOUSEOVER: goog.events.PointerFallbackEventType.POINTEROVER,\n  MOUSEOUT: goog.events.PointerFallbackEventType.POINTEROUT,\n  MOUSEENTER: goog.events.PointerFallbackEventType.POINTERENTER,\n  MOUSELEAVE: goog.events.PointerFallbackEventType.POINTERLEAVE\n};\n\n\n/**\n * An alias for `goog.events.EventType.MOUSE*` event types that continue to use\n * mouse events.\n * @const {!goog.events.MouseEvents}\n */\ngoog.events.MouseAsMouseEventType = {\n  MOUSEDOWN: goog.events.EventType.MOUSEDOWN,\n  MOUSEUP: goog.events.EventType.MOUSEUP,\n  MOUSECANCEL: goog.events.EventType.MOUSECANCEL,\n  MOUSEMOVE: goog.events.EventType.MOUSEMOVE,\n  MOUSEOVER: goog.events.EventType.MOUSEOVER,\n  MOUSEOUT: goog.events.EventType.MOUSEOUT,\n  MOUSEENTER: goog.events.EventType.MOUSEENTER,\n  MOUSELEAVE: goog.events.EventType.MOUSELEAVE\n};\n\n\n/**\n * An alias for `goog.events.EventType.TOUCH*` event types that is overridden by\n * corresponding `POINTER*` event types.\n * @enum {string}\n */\ngoog.events.PointerAsTouchEventType = {\n  TOUCHCANCEL: goog.events.PointerTouchFallbackEventType.POINTERCANCEL,\n  TOUCHEND: goog.events.PointerTouchFallbackEventType.POINTERUP,\n  TOUCHMOVE: goog.events.PointerTouchFallbackEventType.POINTERMOVE,\n  TOUCHSTART: goog.events.PointerTouchFallbackEventType.POINTERDOWN\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Provides utilities for displaying deprecation notices.\n */\ngoog.provide('fireauth.deprecation');\ngoog.provide('fireauth.deprecation.Deprecations');\ngoog.require('fireauth.util');\n\n\n/**\n * An enum of valid notices to display. All deprecation notices must be in this\n * enum. Deprecation messages should be unique and provide the full context\n * of what is deprecated (e.g. the fully qualified path to a method).\n * @enum {string}\n */\nfireauth.deprecation.Deprecations = {\n  LINK_WITH_CREDENTIAL: 'firebase.User.prototype.linkAndRetrieveDataWithCrede' +\n      'ntial is deprecated. Please use firebase.User.prototype.linkWithCreden' +\n      'tial instead.',\n  REAUTH_WITH_CREDENTIAL: 'firebase.User.prototype.reauthenticateAndRetrieveD' +\n      'ataWithCredential is deprecated. Please use firebase.User.prototype.re' +\n      'authenticateWithCredential instead.',\n  SIGN_IN_WITH_CREDENTIAL: 'firebase.auth.Auth.prototype.signInAndRetrieveDat' +\n      'aWithCredential is deprecated. Please use firebase.auth.Auth.prototype' +\n      '.signInWithCredential instead.'\n};\n\n\n/**\n * Keeps track of notices that were already displayed.\n * @type {!Object<fireauth.deprecation.Deprecations, boolean>}\n * @private\n */\nfireauth.deprecation.shownMessages_ = {};\n\n\n/**\n * Logs a deprecation notice to the developer.\n * @param {!fireauth.deprecation.Deprecations} message\n */\nfireauth.deprecation.log = function(message) {\n  if (fireauth.deprecation.shownMessages_[message]) {\n    return;\n  }\n  fireauth.deprecation.shownMessages_[message] = true;\n  fireauth.util.consoleWarn(message);\n};\n\n\n/**\n * Resets the displayed deprecation notices.\n */\nfireauth.deprecation.resetForTesting = function() {\n  fireauth.deprecation.shownMessages_ =\n      /** @type {!Object<fireauth.deprecation.Deprecations, boolean>} */ ({});\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Provides methods for manipulating objects.\n */\n\ngoog.provide('fireauth.object');\n\ngoog.require('fireauth.deprecation');\ngoog.require('fireauth.deprecation.Deprecations');\n\n\n/**\n * Checks whether the defineProperty method allows to change the value of\n * the property.\n * @return {boolean} Whether the defineProperty method allows to change the\n *    value of the property.\n * @private\n */\nfireauth.object.isReadonlyConfigurable_ = function() {\n  // Android 2.3 stock browser doesn't allow to change the value of\n  // a read-only property once defined.\n  try {\n    var obj = {};\n    Object.defineProperty(obj, 'abcd', {\n      configurable: true,\n      enumerable: true,\n      value: 1\n    });\n    Object.defineProperty(obj, 'abcd', {\n      configurable: true,\n      enumerable: true,\n      value: 2\n    });\n    return obj['abcd'] == 2;\n  } catch (e) {\n    return false;\n  }\n};\n\n\n/**\n * @private {boolean} Whether the defineProperty method allows to change the\n *     value of the property.\n */\nfireauth.object.readonlyConfigurable_ =\n    fireauth.object.isReadonlyConfigurable_();\n\n\n/**\n * Defines a property on an object that is not writable by clients. However, the\n * property can be overwritten within the Firebase library through subsequent\n * calls to setReadonlyProperty.\n *\n * In browsers that do not support read-only properties (notably IE8 and below),\n * fall back to writable properties.\n *\n * @param {!Object} obj The object to which we add the property.\n * @param {string} key The name of the property.\n * @param {*} value The desired value.\n */\nfireauth.object.setReadonlyProperty = function(obj, key, value) {\n  if (fireauth.object.readonlyConfigurable_) {\n    Object.defineProperty(obj, key, {\n      configurable: true,\n      enumerable: true,\n      value: value\n    });\n  } else {\n    obj[key] = value;\n  }\n};\n\n\n/**\n * Defines a deprecated property, which emits a warning if the developer tries\n * to use it.\n *\n * In browsers that do not support getters, we fall back to a normal property\n * with no message.\n *\n * @param {!Object} obj The object to which we add the property.\n * @param {string} key The name of the deprecated property.\n * @param {*} value The desired value.\n * @param {!fireauth.deprecation.Deprecations} deprecationMessage The\n *     deprecation warning to display.\n */\nfireauth.object.setDeprecatedReadonlyProperty = function(obj, key, value,\n    deprecationMessage) {\n  if (fireauth.object.readonlyConfigurable_) {\n    Object.defineProperty(obj, key, {\n      configurable: true,\n      enumerable: true,\n      get: function() {\n        fireauth.deprecation.log(deprecationMessage);\n        return value;\n      }\n    });\n  } else {\n    obj[key] = value;\n  }\n};\n\n\n/**\n * Defines properties on an object that are not writable by clients, equivalent\n * to many calls to setReadonlyProperty.\n * @param {!Object} obj The object to which we add the properties.\n * @param {?Object<string, *>} props An object that maps the keys and values\n *     that we wish to add.\n */\nfireauth.object.setReadonlyProperties = function(obj, props) {\n  if (!props) {\n    return;\n  }\n\n  for (var key in props) {\n    if (props.hasOwnProperty(key)) {\n      fireauth.object.setReadonlyProperty(obj, key, props[key]);\n    }\n  }\n};\n\n\n/**\n * Makes a shallow read-only copy of an object. The writability of any child\n * objects will not be affected.\n * @param {?Object} obj The object that we wish to copy.\n * @return {!Object}\n */\nfireauth.object.makeReadonlyCopy = function(obj) {\n  var output = {};\n  fireauth.object.setReadonlyProperties(output, obj);\n  return output;\n};\n\n\n/**\n * Makes a shallow writable copy of a read-only object. The writability of any\n * child objects will not be affected.\n * @param {?Object} obj The object that we wish to copy.\n * @return {!Object}\n */\nfireauth.object.makeWritableCopy = function(obj) {\n  var output = {};\n  for (var key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      output[key] = obj[key];\n    }\n  }\n  return output;\n};\n\n\n/**\n * Returns true if the all the specified fields are present in obj and are not\n * null, undefined, or the empty string. If the field list is empty, returns\n * true regardless of the value of obj.\n * @param {?Object=} opt_obj The object.\n * @param {?Array<string>=} opt_fields The desired fields of the object.\n * @return {boolean} True if obj has all the specified fields.\n */\nfireauth.object.hasNonEmptyFields = function(opt_obj, opt_fields) {\n  if (!opt_fields || !opt_fields.length) {\n    return true;\n  }\n  if (!opt_obj) {\n    return false;\n  }\n  for (var i = 0; i < opt_fields.length; i++) {\n    var field = opt_obj[opt_fields[i]];\n    if (field === undefined || field === null || field === '') {\n      return false;\n    }\n  }\n  return true;\n};\n\n\n/**\n * Traverses the specified object and creates a read-only deep copy of it.\n * This will fail when circular references are contained within the object.\n * @param {*} obj The object to make a read-only copy from.\n * @return {*} A Read-only copy of the obj specified.\n */\nfireauth.object.unsafeCreateReadOnlyCopy = function(obj) {\n  var copy = obj;\n  if (typeof obj == 'object' && obj != null) {\n    // Make the right type of copy.\n    copy = 'length' in obj ? [] : {};\n    // Make a deep copy.\n    for (var key in obj) {\n      fireauth.object.setReadonlyProperty(\n          copy, key, fireauth.object.unsafeCreateReadOnlyCopy(obj[key]));\n    }\n  }\n  // Return the copy.\n  return copy;\n};\n\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the firebase.auth.ActionCodeInfo class that is returned\n * when calling checkActionCode API and is populated from the server response\n * directly.\n */\n\ngoog.provide('fireauth.ActionCodeInfo');\n\ngoog.require('fireauth.object');\n\n\n/**\n * Constructs the action code info object which provides metadata corresponding\n * to action codes. This includes the type of operation (RESET_PASSWORD,\n * VERIFY_EMAIL and RECOVER_EMAIL), the email corresponding to the operation\n * and in case of the recover email flow, the old and new email.\n * @param {!Object} response The server response for checkActionCode.\n * @constructor\n */\nfireauth.ActionCodeInfo = function(response) {\n  var data = {};\n  // Original email for email change revocation.\n  var email = response[fireauth.ActionCodeInfo.ServerFieldName.EMAIL];\n  // The new email.\n  var newEmail = response[fireauth.ActionCodeInfo.ServerFieldName.NEW_EMAIL];\n  var operation =\n      response[fireauth.ActionCodeInfo.ServerFieldName.REQUEST_TYPE];\n  // Email could be empty only if the request type is EMAIL_SIGNIN.\n  if (!operation ||\n      (operation != fireauth.ActionCodeInfo.Operation.EMAIL_SIGNIN &&\n      !email)) {\n    // This is internal only.\n    throw new Error('Invalid provider user info!');\n  }\n  data[fireauth.ActionCodeInfo.DataField.FROM_EMAIL] = newEmail || null;\n  data[fireauth.ActionCodeInfo.DataField.EMAIL] = email || null;\n  fireauth.object.setReadonlyProperty(\n      this,\n      fireauth.ActionCodeInfo.PropertyName.OPERATION,\n      operation);\n  fireauth.object.setReadonlyProperty(\n      this,\n      fireauth.ActionCodeInfo.PropertyName.DATA,\n      fireauth.object.unsafeCreateReadOnlyCopy(data));\n};\n\n\n/**\n * Firebase Auth Action Code Info operation possible values.\n * @enum {string}\n */\nfireauth.ActionCodeInfo.Operation = {\n  PASSWORD_RESET: 'PASSWORD_RESET',\n  RECOVER_EMAIL: 'RECOVER_EMAIL',\n  EMAIL_SIGNIN: 'EMAIL_SIGNIN',\n  VERIFY_EMAIL: 'VERIFY_EMAIL'\n};\n\n\n/**\n * The checkActionCode endpoint server response field names.\n * @enum {string}\n */\nfireauth.ActionCodeInfo.ServerFieldName = {\n  // This is the current email of the account and in email recovery, the email\n  // to revert to.\n  EMAIL: 'email',\n  // For email recovery, this is the new email.\n  NEW_EMAIL: 'newEmail',\n  // The action code request type.\n  REQUEST_TYPE: 'requestType'\n};\n\n\n/**\n * The ActionCodeInfo data object field names.\n * @enum {string}\n */\nfireauth.ActionCodeInfo.DataField = {\n  EMAIL: 'email',\n  FROM_EMAIL: 'fromEmail'\n};\n\n\n/**\n * The ActionCodeInfo main property names\n * @enum {string}\n */\nfireauth.ActionCodeInfo.PropertyName = {\n  DATA: 'data',\n  OPERATION: 'operation'\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines developer-visible errors for Firebase Auth APIs.\n */\n\n\ngoog.provide('fireauth.AuthError');\ngoog.provide('fireauth.authenum');\ngoog.provide('fireauth.authenum.Error');\n\n\n\n/**\n * Error that can be returned to the developer.\n * @param {!fireauth.authenum.Error} code The short error code.\n * @param {?string=} opt_message The human-readable message.\n * @constructor\n * @extends {Error}\n */\nfireauth.AuthError = function(code, opt_message) {\n  this['code'] = fireauth.AuthError.ERROR_CODE_PREFIX + code;\n  this.message = opt_message || fireauth.AuthError.MESSAGES_[code] || '';\n};\ngoog.inherits(fireauth.AuthError, Error);\n\n\n/**\n * @return {!Object} The plain object form of the error.\n */\nfireauth.AuthError.prototype.toPlainObject = function() {\n  return {\n    'code': this['code'],\n    'message': this.message\n  };\n};\n\n\n/**\n * @return {!Object} The plain object form of the error. This is used by\n *     JSON.toStringify() to return the stringified representation of the error;\n * @override\n */\nfireauth.AuthError.prototype.toJSON = function() {\n  // Return the plain object representation in case JSON.stringify is called on\n  // an auth error instance.\n  return this.toPlainObject();\n};\n\n\n/**\n * @param {?Object|undefined} response The object response to convert to a\n *     fireauth.AuthError.\n * @return {?fireauth.AuthError} The error representation of the response.\n */\nfireauth.AuthError.fromPlainObject = function(response) {\n  var fullCode = response && response['code'];\n  if (fullCode) {\n    // Remove prefix from name.\n    var code = fullCode.substring(\n        fireauth.AuthError.ERROR_CODE_PREFIX.length);\n    return new fireauth.AuthError(\n        /** @type {fireauth.authenum.Error} */ (code), response['message']);\n  }\n  return null;\n};\n\n\n/**\n * Takes in an error and translates a specific error code to another one if\n * found in the current error.\n * @param {*} error The error thrown.\n * @param {!fireauth.authenum.Error} fromCode The error code to translate from.\n * @param {!fireauth.authenum.Error} toCode The error code to translate to.\n * @return {*} The mapped error message.\n */\nfireauth.AuthError.translateError = function(error, fromCode, toCode) {\n  if (error &&\n      error['code'] &&\n      error['code'] == fireauth.AuthError.ERROR_CODE_PREFIX + fromCode) {\n    // Translate the error to the new one.\n    return new fireauth.AuthError(toCode);\n  }\n  // Return the same error if the fromCode is not found.\n  return error;\n};\n\n\n/**\n * The error prefix for fireauth.Auth errors.\n * @protected {string}\n */\nfireauth.AuthError.ERROR_CODE_PREFIX = 'auth/';\n\n\n/**\n * Developer facing Firebase Auth error codes.\n * @enum {string}\n */\nfireauth.authenum.Error = {\n  ADMIN_ONLY_OPERATION: 'admin-restricted-operation',\n  ARGUMENT_ERROR: 'argument-error',\n  APP_NOT_AUTHORIZED: 'app-not-authorized',\n  APP_NOT_INSTALLED: 'app-not-installed',\n  CAPTCHA_CHECK_FAILED: 'captcha-check-failed',\n  CODE_EXPIRED: 'code-expired',\n  CORDOVA_NOT_READY: 'cordova-not-ready',\n  CORS_UNSUPPORTED: 'cors-unsupported',\n  CREDENTIAL_ALREADY_IN_USE: 'credential-already-in-use',\n  CREDENTIAL_MISMATCH: 'custom-token-mismatch',\n  CREDENTIAL_TOO_OLD_LOGIN_AGAIN: 'requires-recent-login',\n  DYNAMIC_LINK_NOT_ACTIVATED: 'dynamic-link-not-activated',\n  EMAIL_EXISTS: 'email-already-in-use',\n  EXPIRED_OOB_CODE: 'expired-action-code',\n  EXPIRED_POPUP_REQUEST: 'cancelled-popup-request',\n  INTERNAL_ERROR: 'internal-error',\n  INVALID_API_KEY: 'invalid-api-key',\n  INVALID_APP_CREDENTIAL: 'invalid-app-credential',\n  INVALID_APP_ID: 'invalid-app-id',\n  INVALID_AUTH: 'invalid-user-token',\n  INVALID_AUTH_EVENT: 'invalid-auth-event',\n  INVALID_CERT_HASH: 'invalid-cert-hash',\n  INVALID_CODE: 'invalid-verification-code',\n  INVALID_CONTINUE_URI: 'invalid-continue-uri',\n  INVALID_CORDOVA_CONFIGURATION: 'invalid-cordova-configuration',\n  INVALID_CUSTOM_TOKEN: 'invalid-custom-token',\n  INVALID_DYNAMIC_LINK_DOMAIN: 'invalid-dynamic-link-domain',\n  INVALID_EMAIL: 'invalid-email',\n  INVALID_IDP_RESPONSE: 'invalid-credential',\n  INVALID_MESSAGE_PAYLOAD: 'invalid-message-payload',\n  INVALID_OAUTH_CLIENT_ID: 'invalid-oauth-client-id',\n  INVALID_OAUTH_PROVIDER: 'invalid-oauth-provider',\n  INVALID_OOB_CODE: 'invalid-action-code',\n  INVALID_ORIGIN: 'unauthorized-domain',\n  INVALID_PASSWORD: 'wrong-password',\n  INVALID_PERSISTENCE: 'invalid-persistence-type',\n  INVALID_PHONE_NUMBER: 'invalid-phone-number',\n  INVALID_PROVIDER_ID: 'invalid-provider-id',\n  INVALID_RECIPIENT_EMAIL: 'invalid-recipient-email',\n  INVALID_SENDER: 'invalid-sender',\n  INVALID_SESSION_INFO: 'invalid-verification-id',\n  INVALID_TENANT_ID: 'invalid-tenant-id',\n  MISSING_ANDROID_PACKAGE_NAME: 'missing-android-pkg-name',\n  MISSING_APP_CREDENTIAL: 'missing-app-credential',\n  MISSING_AUTH_DOMAIN: 'auth-domain-config-required',\n  MISSING_CODE: 'missing-verification-code',\n  MISSING_CONTINUE_URI: 'missing-continue-uri',\n  MISSING_IFRAME_START: 'missing-iframe-start',\n  MISSING_IOS_BUNDLE_ID: 'missing-ios-bundle-id',\n  MISSING_OR_INVALID_NONCE: 'missing-or-invalid-nonce',\n  MISSING_PHONE_NUMBER: 'missing-phone-number',\n  MISSING_SESSION_INFO: 'missing-verification-id',\n  MODULE_DESTROYED: 'app-deleted',\n  NEED_CONFIRMATION: 'account-exists-with-different-credential',\n  NETWORK_REQUEST_FAILED: 'network-request-failed',\n  NULL_USER: 'null-user',\n  NO_AUTH_EVENT: 'no-auth-event',\n  NO_SUCH_PROVIDER: 'no-such-provider',\n  OPERATION_NOT_ALLOWED: 'operation-not-allowed',\n  OPERATION_NOT_SUPPORTED: 'operation-not-supported-in-this-environment',\n  POPUP_BLOCKED: 'popup-blocked',\n  POPUP_CLOSED_BY_USER: 'popup-closed-by-user',\n  PROVIDER_ALREADY_LINKED: 'provider-already-linked',\n  QUOTA_EXCEEDED: 'quota-exceeded',\n  REDIRECT_CANCELLED_BY_USER: 'redirect-cancelled-by-user',\n  REDIRECT_OPERATION_PENDING: 'redirect-operation-pending',\n  REJECTED_CREDENTIAL: 'rejected-credential',\n  TENANT_ID_MISMATCH: 'tenant-id-mismatch',\n  TIMEOUT: 'timeout',\n  TOKEN_EXPIRED: 'user-token-expired',\n  TOO_MANY_ATTEMPTS_TRY_LATER: 'too-many-requests',\n  UNAUTHORIZED_DOMAIN: 'unauthorized-continue-uri',\n  UNSUPPORTED_PERSISTENCE: 'unsupported-persistence-type',\n  UNSUPPORTED_TENANT_OPERATION: 'unsupported-tenant-operation',\n  USER_CANCELLED: 'user-cancelled',\n  USER_DELETED: 'user-not-found',\n  USER_DISABLED: 'user-disabled',\n  USER_MISMATCH: 'user-mismatch',\n  USER_SIGNED_OUT: 'user-signed-out',\n  WEAK_PASSWORD: 'weak-password',\n  WEB_STORAGE_UNSUPPORTED: 'web-storage-unsupported'\n};\n\n\n/**\n * Map from developer error codes to human-readable error messages.\n * @private {!Object<string, string>}\n */\nfireauth.AuthError.MESSAGES_ = {};\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.ADMIN_ONLY_OPERATION] =\n    'This operation is restricted to administrators only.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.ARGUMENT_ERROR] = '';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.APP_NOT_AUTHORIZED] =\n    'This app, identified by the domain where it\\'s hosted, is not ' +\n    'authorized to use Firebase Authentication with the provided API key. ' +\n    'Review your key configuration in the Google API console.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.APP_NOT_INSTALLED] =\n    'The requested mobile application corresponding to the identifier (' +\n    'Android package name or iOS bundle ID) provided is not installed on ' +\n    'this device.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.CAPTCHA_CHECK_FAILED] =\n    'The reCAPTCHA response token provided is either invalid, expired, ' +\n    'already used or the domain associated with it does not match the list ' +\n    'of whitelisted domains.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.CODE_EXPIRED] =\n    'The SMS code has expired. Please re-send the verification code to try ' +\n    'again.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.CORDOVA_NOT_READY] =\n    'Cordova framework is not ready.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.CORS_UNSUPPORTED] =\n    'This browser is not supported.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.CREDENTIAL_ALREADY_IN_USE] =\n    'This credential is already associated with a different user account.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.CREDENTIAL_MISMATCH] =\n    'The custom token corresponds to a different audience.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.CREDENTIAL_TOO_OLD_LOGIN_AGAIN] =\n    'This operation is sensitive and requires recent authentication. Log in ' +\n    'again before retrying this request.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.DYNAMIC_LINK_NOT_ACTIVATED] = 'Please activate ' +\n    'Dynamic Links in the Firebase Console and agree to the terms and ' +\n    'conditions.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.EMAIL_EXISTS] =\n    'The email address is already in use by another account.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.EXPIRED_OOB_CODE] =\n    'The action code has expired. ';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.EXPIRED_POPUP_REQUEST] =\n    'This operation has been cancelled due to another conflicting popup ' +\n    'being opened.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INTERNAL_ERROR] =\n    'An internal error has occurred.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_APP_CREDENTIAL] =\n    'The phone verification request contains an invalid application verifier.' +\n    ' The reCAPTCHA token response is either invalid or expired.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_APP_ID] =\n    'The mobile app identifier is not registed for the current project.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_AUTH] =\n    'This user\\'s credential isn\\'t valid for this project. This can happen ' +\n    'if the user\\'s token has been tampered with, or if the user isn\\'t for ' +\n    'the project associated with this API key.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_AUTH_EVENT] =\n    'An internal error has occurred.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_CODE] =\n    'The SMS verification code used to create the phone auth credential is ' +\n    'invalid. Please resend the verification code sms and be sure use the ' +\n    'verification code provided by the user.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_CONTINUE_URI] =\n    'The continue URL provided in the request is invalid.';\nfireauth.AuthError.MESSAGES_[\n     fireauth.authenum.Error.INVALID_CORDOVA_CONFIGURATION] = 'The following' +\n    ' Cordova plugins must be installed to enable OAuth sign-in: ' +\n    'cordova-plugin-buildinfo, cordova-universal-links-plugin, ' +\n    'cordova-plugin-browsertab, cordova-plugin-inappbrowser and ' +\n    'cordova-plugin-customurlscheme.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_CUSTOM_TOKEN] =\n    'The custom token format is incorrect. Please check the documentation.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.INVALID_DYNAMIC_LINK_DOMAIN] = 'The provided ' +\n    'dynamic link domain is not configured or authorized for the current ' +\n    'project.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_EMAIL] =\n    'The email address is badly formatted.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_API_KEY] =\n    'Your API key is invalid, please check you have copied it correctly.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_CERT_HASH] =\n    'The SHA-1 certificate hash provided is invalid.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_IDP_RESPONSE] =\n    'The supplied auth credential is malformed or has expired.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_MESSAGE_PAYLOAD] =\n    'The email template corresponding to this action contains invalid charac' +\n    'ters in its message. Please fix by going to the Auth email templates se' +\n    'ction in the Firebase Console.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_OAUTH_PROVIDER] =\n    'EmailAuthProvider is not supported for this operation. This operation ' +\n    'only supports OAuth providers.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_OAUTH_CLIENT_ID] =\n    'The OAuth client ID provided is either invalid or does not match the ' +\n    'specified API key.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_ORIGIN] =\n    'This domain is not authorized for OAuth operations for your Firebase ' +\n    'project. Edit the list of authorized domains from the Firebase console.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_OOB_CODE] =\n    'The action code is invalid. This can happen if the code is malformed, ' +\n    'expired, or has already been used.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_PASSWORD] =\n    'The password is invalid or the user does not have a password.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_PERSISTENCE] =\n    'The specified persistence type is invalid. It can only be local, ' +\n    'session or none.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_PHONE_NUMBER] =\n    'The format of the phone number provided is incorrect. Please enter the ' +\n    'phone number in a format that can be parsed into E.164 format. E.164 ' +\n    'phone numbers are written in the format [+][country code][subscriber ' +\n    'number including area code].';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_PROVIDER_ID] =\n    'The specified provider ID is invalid.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_RECIPIENT_EMAIL] =\n    'The email corresponding to this action failed to send as the provided ' +\n    'recipient email address is invalid.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_SENDER] =\n    'The email template corresponding to this action contains an invalid sen' +\n    'der email or name. Please fix by going to the Auth email templates sect' +\n    'ion in the Firebase Console.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_SESSION_INFO] =\n    'The verification ID used to create the phone auth credential is invalid.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.INVALID_TENANT_ID] =\n    'The Auth instance\\'s tenant ID is invalid.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.MISSING_ANDROID_PACKAGE_NAME] = 'An Android ' +\n    'Package Name must be provided if the Android App is required to be ' +\n    'installed.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MISSING_AUTH_DOMAIN] =\n    'Be sure to include authDomain when calling firebase.initializeApp(), ' +\n    'by following the instructions in the Firebase console.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MISSING_APP_CREDENTIAL] =\n    'The phone verification request is missing an application verifier ' +\n    'assertion. A reCAPTCHA response token needs to be provided.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MISSING_CODE] =\n    'The phone auth credential was created with an empty SMS verification ' +\n    'code.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MISSING_CONTINUE_URI] =\n    'A continue URL must be provided in the request.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MISSING_IFRAME_START] =\n    'An internal error has occurred.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MISSING_IOS_BUNDLE_ID] =\n    'An iOS Bundle ID must be provided if an App Store ID is provided.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MISSING_OR_INVALID_NONCE] =\n    'The request does not contain a valid nonce. This can occur if the ' +\n    'SHA-256 hash of the provided raw nonce does not match the hashed nonce ' +\n    'in the ID token payload.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MISSING_PHONE_NUMBER] =\n    'To send verification codes, provide a phone number for the recipient.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MISSING_SESSION_INFO] =\n    'The phone auth credential was created with an empty verification ID.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.MODULE_DESTROYED] =\n    'This instance of FirebaseApp has been deleted.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.NEED_CONFIRMATION] =\n    'An account already exists with the same email address but different ' +\n    'sign-in credentials. Sign in using a provider associated with this ' +\n    'email address.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.NETWORK_REQUEST_FAILED] =\n    'A network error (such as timeout, interrupted connection or ' +\n    'unreachable host) has occurred.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.NO_AUTH_EVENT] =\n    'An internal error has occurred.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.NO_SUCH_PROVIDER] =\n    'User was not linked to an account with the given provider.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.NULL_USER] =\n    'A null user object was provided as the argument for an operation which ' +\n    'requires a non-null user object.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.OPERATION_NOT_ALLOWED] =\n    'The given sign-in provider is disabled for this Firebase project. ' +\n    'Enable it in the Firebase console, under the sign-in method tab of the ' +\n    'Auth section.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.OPERATION_NOT_SUPPORTED] =\n    'This operation is not supported in the environment this application is ' +\n    'running on. \"location.protocol\" must be http, https or chrome-extension' +\n    ' and web storage must be enabled.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.POPUP_BLOCKED] =\n    'Unable to establish a connection with the popup. It may have been ' +\n    'blocked by the browser.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.POPUP_CLOSED_BY_USER] =\n    'The popup has been closed by the user before finalizing the operation.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.PROVIDER_ALREADY_LINKED] =\n    'User can only be linked to one identity for the given provider.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.QUOTA_EXCEEDED] =\n    'The project\\'s quota for this operation has been exceeded.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.REDIRECT_CANCELLED_BY_USER] =\n    'The redirect operation has been cancelled by the user before finalizing.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.REDIRECT_OPERATION_PENDING] =\n    'A redirect sign-in operation is already pending.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.REJECTED_CREDENTIAL] =\n    'The request contains malformed or mismatching credentials.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.TENANT_ID_MISMATCH] =\n    'The provided tenant ID does not match the Auth instance\\'s tenant ID';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.TIMEOUT] =\n    'The operation has timed out.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.TOKEN_EXPIRED] =\n    'The user\\'s credential is no longer valid. The user must sign in again.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.TOO_MANY_ATTEMPTS_TRY_LATER] =\n    'We have blocked all requests from this device due to unusual activity. ' +\n    'Try again later.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.UNAUTHORIZED_DOMAIN] =\n    'The domain of the continue URL is not whitelisted.  Please whitelist ' +\n    'the domain in the Firebase console.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.UNSUPPORTED_PERSISTENCE] =\n    'The current environment does not support the specified persistence type.';\nfireauth.AuthError.MESSAGES_[\n    fireauth.authenum.Error.UNSUPPORTED_TENANT_OPERATION] =\n    'This operation is not supported in a multi-tenant context.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.USER_CANCELLED] =\n    'The user did not grant your application the permissions it requested.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.USER_DELETED] =\n    'There is no user record corresponding to this identifier. The user may ' +\n    'have been deleted.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.USER_DISABLED] =\n    'The user account has been disabled by an administrator.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.USER_MISMATCH] =\n    'The supplied credentials do not correspond to the previously signed in ' +\n    'user.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.USER_SIGNED_OUT] = '';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.WEAK_PASSWORD] =\n    'The password must be 6 characters long or more.';\nfireauth.AuthError.MESSAGES_[fireauth.authenum.Error.WEB_STORAGE_UNSUPPORTED] =\n    'This browser is not supported or 3rd party cookies and data may be ' +\n    'disabled.';\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines firebase.auth.ActionCodeURL class which is the utility\n * to parse action code URLs.\n */\n\ngoog.provide('fireauth.ActionCodeURL');\n\ngoog.require('fireauth.ActionCodeInfo');\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.object');\ngoog.require('goog.Uri');\n\n\n/**\n * The utility class to help parse action code URLs used for out of band email\n * flows such as password reset, email verification, email link sign in, etc.\n * @param {string} actionLink The action link string.\n * @constructor\n */\nfireauth.ActionCodeURL = function(actionLink) {\n  var uri = goog.Uri.parse(actionLink);\n  var apiKey = uri.getParameterValue(\n      fireauth.ActionCodeURL.QueryField.API_KEY) || null;\n  var code = uri.getParameterValue(\n      fireauth.ActionCodeURL.QueryField.CODE) || null;\n  var mode = uri.getParameterValue(\n      fireauth.ActionCodeURL.QueryField.MODE) || null;\n  var operation = fireauth.ActionCodeURL.getOperation(mode);\n  // Validate API key, code and mode.\n  if (!apiKey || !code || !operation) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR,\n        fireauth.ActionCodeURL.QueryField.API_KEY + ', ' +\n        fireauth.ActionCodeURL.QueryField.CODE + 'and ' +\n        fireauth.ActionCodeURL.QueryField.MODE +\n        ' are required in a valid action code URL.');\n  }\n  fireauth.object.setReadonlyProperties(this, {\n    'apiKey': apiKey,\n    'operation': operation,\n    'code': code,\n    'continueUrl': uri.getParameterValue(\n        fireauth.ActionCodeURL.QueryField.CONTINUE_URL) || null,\n    'languageCode': uri.getParameterValue(\n        fireauth.ActionCodeURL.QueryField.LANGUAGE_CODE) || null,\n    'tenantId': uri.getParameterValue(\n        fireauth.ActionCodeURL.QueryField.TENANT_ID) || null\n  });\n};\n\n\n/**\n * Enums for fields in URL query string.\n * @enum {string}\n */\nfireauth.ActionCodeURL.QueryField = {\n  API_KEY: 'apiKey',\n  CODE: 'oobCode',\n  CONTINUE_URL: 'continueUrl',\n  LANGUAGE_CODE: 'languageCode',\n  MODE: 'mode',\n  TENANT_ID: 'tenantId'\n};\n\n\n/**\n * Map of mode string to Action Code Info operation.\n * @const @private {!Object<string, !fireauth.ActionCodeInfo.Operation>}\n */\nfireauth.ActionCodeURL.ModeToOperationMap_ = {\n  'recoverEmail': fireauth.ActionCodeInfo.Operation.RECOVER_EMAIL,\n  'resetPassword': fireauth.ActionCodeInfo.Operation.PASSWORD_RESET,\n  'signIn': fireauth.ActionCodeInfo.Operation.EMAIL_SIGNIN,\n  'verifyEmail': fireauth.ActionCodeInfo.Operation.VERIFY_EMAIL\n};\n\n\n/**\n * Maps the mode string in action code URL to Action Code Info operation.\n * @param {?string} mode The mode string in the URL.\n * @return {?fireauth.ActionCodeInfo.Operation}\n */\nfireauth.ActionCodeURL.getOperation = function(mode) {\n  if (!mode) {\n    return null;\n  }\n  return fireauth.ActionCodeURL.ModeToOperationMap_[mode] || null;\n\n};\n\n\n/**\n * Returns an ActionCodeURL instance if the link is valid, otherwise null.\n * @param {string} actionLink The action code link string.\n * @return {?fireauth.ActionCodeURL}\n */\nfireauth.ActionCodeURL.parseLink = function(actionLink) {\n  try {\n    return new fireauth.ActionCodeURL(actionLink);\n  } catch(e) {\n    return null;\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Utility for firebase.auth.ActionCodeSettings and its helper\n * functions.\n */\n\ngoog.provide('fireauth.ActionCodeSettings');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\n\n\n/**\n * Defines the action code settings structure used to specify how email action\n * links are handled.\n * @param {!Object} settingsObj The action code settings object used to\n *     construct the action code link.\n * @constructor @struct @final\n */\nfireauth.ActionCodeSettings = function(settingsObj) {\n  // Validate the settings object passed.\n  this.initialize_(settingsObj);\n};\n\n\n/**\n * Validate the action code settings object.\n * @param {!Object} settingsObj The action code settings object to validate.\n * @private\n */\nfireauth.ActionCodeSettings.prototype.initialize_ = function(settingsObj) {\n  // URL should be required.\n  var continueUrl = settingsObj[fireauth.ActionCodeSettings.RawField.URL];\n  if (typeof continueUrl === 'undefined') {\n    throw new fireauth.AuthError(fireauth.authenum.Error.MISSING_CONTINUE_URI);\n  } else if (typeof continueUrl !== 'string' ||\n             (typeof continueUrl === 'string' && !continueUrl.length)) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_CONTINUE_URI);\n  }\n  /** @const @private {string} The continue URL. */\n  this.continueUrl_ = /** @type {string} */ (continueUrl);\n\n  // Validate Android parameters.\n  /** @private {?string} The Android package name. */\n  this.apn_ = null;\n  /** @private {?string} The Android minimum version. */\n  this.amv_ = null;\n  /** @private {boolean} Whether to install the Android app. */\n  this.installApp_ = false;\n  var androidSettings =\n      settingsObj[fireauth.ActionCodeSettings.RawField.ANDROID];\n  if (androidSettings && typeof androidSettings === 'object') {\n    var apn = androidSettings[\n      fireauth.ActionCodeSettings.AndroidRawField.PACKAGE_NAME];\n    var installApp = androidSettings[\n      fireauth.ActionCodeSettings.AndroidRawField.INSTALL_APP];\n    var amv = androidSettings[\n      fireauth.ActionCodeSettings.AndroidRawField.MINIMUM_VERSION];\n    if (typeof apn === 'string' && apn.length) {\n      this.apn_ = /** @type {string} */ (apn);\n      if (typeof installApp !== 'undefined' &&\n          typeof installApp !== 'boolean') {\n        throw new fireauth.AuthError(\n            fireauth.authenum.Error.ARGUMENT_ERROR,\n            fireauth.ActionCodeSettings.AndroidRawField.INSTALL_APP +\n            ' property must be a boolean when specified.');\n      }\n      this.installApp_ = !!installApp;\n      if (typeof amv !== 'undefined' &&\n          (typeof amv !== 'string' ||\n           (typeof amv === 'string' && !amv.length))) {\n        throw new fireauth.AuthError(\n            fireauth.authenum.Error.ARGUMENT_ERROR,\n            fireauth.ActionCodeSettings.AndroidRawField.MINIMUM_VERSION +\n            ' property must be a non empty string when specified.');\n      }\n      this.amv_ = /** @type {?string}*/ (amv || null);\n    } else if (typeof apn !== 'undefined') {\n      throw new fireauth.AuthError(\n          fireauth.authenum.Error.ARGUMENT_ERROR,\n          fireauth.ActionCodeSettings.AndroidRawField.PACKAGE_NAME +\n          ' property must be a non empty string when specified.');\n    } else if (typeof installApp !== 'undefined' ||\n               typeof amv !== 'undefined') {\n      // If installApp or amv specified with no valid APN, fail quickly.\n      throw new fireauth.AuthError(\n          fireauth.authenum.Error.MISSING_ANDROID_PACKAGE_NAME);\n    }\n  } else if (typeof androidSettings !== 'undefined') {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR,\n        fireauth.ActionCodeSettings.RawField.ANDROID +\n        ' property must be a non null object when specified.');\n  }\n\n  // Validate iOS parameters.\n  /** @private {?string} The iOS bundle ID. */\n  this.ibi_ = null;\n  var iosSettings = settingsObj[fireauth.ActionCodeSettings.RawField.IOS];\n  if (iosSettings && typeof iosSettings === 'object') {\n    var ibi = iosSettings[\n      fireauth.ActionCodeSettings.IosRawField.BUNDLE_ID];\n    if (typeof ibi === 'string' && ibi.length) {\n      this.ibi_ = /** @type {string}*/ (ibi);\n    } else if (typeof ibi !== 'undefined') {\n      throw new fireauth.AuthError(\n          fireauth.authenum.Error.ARGUMENT_ERROR,\n          fireauth.ActionCodeSettings.IosRawField.BUNDLE_ID +\n          ' property must be a non empty string when specified.');\n    }\n  } else if (typeof iosSettings !== 'undefined') {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR,\n        fireauth.ActionCodeSettings.RawField.IOS +\n        ' property must be a non null object when specified.');\n  }\n\n  // Validate canHandleCodeInApp.\n  var canHandleCodeInApp =\n      settingsObj[fireauth.ActionCodeSettings.RawField.HANDLE_CODE_IN_APP];\n  if (typeof canHandleCodeInApp !== 'undefined' &&\n      typeof canHandleCodeInApp !== 'boolean') {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR,\n        fireauth.ActionCodeSettings.RawField.HANDLE_CODE_IN_APP +\n        ' property must be a boolean when specified.');\n  }\n  /** @const @private {boolean} Whether the code can be handled in app. */\n  this.canHandleCodeInApp_ = !!canHandleCodeInApp;\n\n  // Validate dynamicLinkDomain.\n  var dynamicLinkDomain = settingsObj[\n      fireauth.ActionCodeSettings.RawField.DYNAMIC_LINK_DOMAIN];\n  if (typeof dynamicLinkDomain !== 'undefined' &&\n      (typeof dynamicLinkDomain !== 'string' ||\n       (typeof dynamicLinkDomain === 'string' &&\n        !dynamicLinkDomain.length))) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR,\n        fireauth.ActionCodeSettings.RawField.DYNAMIC_LINK_DOMAIN +\n        ' property must be a non empty string when specified.');\n  }\n  /** @const @private {?string} The FDL domain. */\n  this.dynamicLinkDomain_ = dynamicLinkDomain || null;\n};\n\n\n/**\n * Action code settings backend request field names.\n * @enum {string}\n */\nfireauth.ActionCodeSettings.RequestField = {\n  ANDROID_INSTALL_APP: 'androidInstallApp',\n  ANDROID_MINIMUM_VERSION: 'androidMinimumVersion',\n  ANDROID_PACKAGE_NAME: 'androidPackageName',\n  CAN_HANDLE_CODE_IN_APP: 'canHandleCodeInApp',\n  CONTINUE_URL: 'continueUrl',\n  DYNAMIC_LINK_DOMAIN: 'dynamicLinkDomain',\n  IOS_BUNDLE_ID: 'iOSBundleId'\n};\n\n\n/**\n * Action code settings raw field names.\n * @enum {string}\n */\nfireauth.ActionCodeSettings.RawField = {\n  ANDROID: 'android',\n  DYNAMIC_LINK_DOMAIN: 'dynamicLinkDomain',\n  HANDLE_CODE_IN_APP: 'handleCodeInApp',\n  IOS: 'iOS',\n  URL: 'url'\n};\n\n\n/**\n * Action code settings raw Android raw field names.\n * @enum {string}\n */\nfireauth.ActionCodeSettings.AndroidRawField = {\n  INSTALL_APP: 'installApp',\n  MINIMUM_VERSION: 'minimumVersion',\n  PACKAGE_NAME: 'packageName'\n};\n\n\n/**\n * Action code settings raw iOS raw field names.\n * @enum {string}\n */\nfireauth.ActionCodeSettings.IosRawField = {\n  BUNDLE_ID: 'bundleId'\n};\n\n\n/**\n * Builds and returns the backend request for the passed action code settings.\n * @return {!Object} The constructed backend request populated with the action\n *     code settings parameters.\n */\nfireauth.ActionCodeSettings.prototype.buildRequest = function() {\n  // Construct backend request.\n  var request = {};\n  request[fireauth.ActionCodeSettings.RequestField.CONTINUE_URL] =\n      this.continueUrl_;\n  request[fireauth.ActionCodeSettings.RequestField.CAN_HANDLE_CODE_IN_APP] =\n      this.canHandleCodeInApp_;\n  request[fireauth.ActionCodeSettings.RequestField.ANDROID_PACKAGE_NAME] =\n      this.apn_;\n  if (this.apn_) {\n    request[fireauth.ActionCodeSettings.RequestField.ANDROID_MINIMUM_VERSION] =\n        this.amv_;\n    request[fireauth.ActionCodeSettings.RequestField.ANDROID_INSTALL_APP] =\n        this.installApp_;\n  }\n  request[fireauth.ActionCodeSettings.RequestField.IOS_BUNDLE_ID] = this.ibi_;\n  request[fireauth.ActionCodeSettings.RequestField.DYNAMIC_LINK_DOMAIN] =\n      this.dynamicLinkDomain_;\n  // Remove null fields.\n  for (var key in request) {\n    if (request[key] === null) {\n      delete request[key];\n    }\n  }\n  return request;\n};\n\n\n/**\n * Returns the canHandleCodeInApp setting of ActionCodeSettings.\n * @return {boolean} Whether the code can be handled in app.\n */\nfireauth.ActionCodeSettings.prototype.canHandleCodeInApp = function() {\n  return this.canHandleCodeInApp_;\n};\n","// Copyright 2007 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Base64 en/decoding. Not much to say here except that we\n * work with decoded values in arrays of bytes. By \"byte\" I mean a number\n * in [0, 255].\n *\n * @author doughtie@google.com (Gavin Doughtie)\n */\n\ngoog.provide('goog.crypt.base64');\n\ngoog.require('goog.asserts');\ngoog.require('goog.crypt');\ngoog.require('goog.string');\ngoog.require('goog.userAgent');\ngoog.require('goog.userAgent.product');\n\n// Static lookup maps, lazily populated by init_()\n\n\n/**\n * Maps bytes to characters.\n * @type {?Object}\n * @private\n */\ngoog.crypt.base64.byteToCharMap_ = null;\n\n\n/**\n * Maps characters to bytes. Used for normal and websafe characters.\n * @type {?Object}\n * @private\n */\ngoog.crypt.base64.charToByteMap_ = null;\n\n\n/**\n * Maps bytes to websafe characters.\n * @type {?Object}\n * @private\n */\ngoog.crypt.base64.byteToCharMapWebSafe_ = null;\n\n\n/**\n * Our default alphabet, shared between\n * ENCODED_VALS and ENCODED_VALS_WEBSAFE\n * @type {string}\n */\ngoog.crypt.base64.ENCODED_VALS_BASE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' +\n    'abcdefghijklmnopqrstuvwxyz' +\n    '0123456789';\n\n\n/**\n * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\n * @type {string}\n */\ngoog.crypt.base64.ENCODED_VALS = goog.crypt.base64.ENCODED_VALS_BASE + '+/=';\n\n\n/**\n * Our websafe alphabet.\n * @type {string}\n */\ngoog.crypt.base64.ENCODED_VALS_WEBSAFE =\n    goog.crypt.base64.ENCODED_VALS_BASE + '-_.';\n\n\n/**\n * White list of implementations with known-good native atob and btoa functions.\n * Listing these explicitly (via the ASSUME_* wrappers) benefits dead-code\n * removal in per-browser compilations.\n * @private {boolean}\n */\ngoog.crypt.base64.ASSUME_NATIVE_SUPPORT_ = goog.userAgent.GECKO ||\n    (goog.userAgent.WEBKIT && !goog.userAgent.product.SAFARI) ||\n    goog.userAgent.OPERA;\n\n\n/**\n * Does this browser have a working btoa function?\n * @private {boolean}\n */\ngoog.crypt.base64.HAS_NATIVE_ENCODE_ =\n    goog.crypt.base64.ASSUME_NATIVE_SUPPORT_ ||\n    typeof(goog.global.btoa) == 'function';\n\n\n/**\n * Does this browser have a working atob function?\n * We blacklist known-bad implementations:\n *  - IE (10+) added atob() but it does not tolerate whitespace on the input.\n * @private {boolean}\n */\ngoog.crypt.base64.HAS_NATIVE_DECODE_ =\n    goog.crypt.base64.ASSUME_NATIVE_SUPPORT_ ||\n    (!goog.userAgent.product.SAFARI && !goog.userAgent.IE &&\n     typeof(goog.global.atob) == 'function');\n\n\n/**\n * Base64-encode an array of bytes.\n *\n * @param {Array<number>|Uint8Array} input An array of bytes (numbers with\n *     value in [0, 255]) to encode.\n * @param {boolean=} opt_webSafe True indicates we should use the alternative\n *     alphabet, which does not require escaping for use in URLs.\n * @return {string} The base64 encoded string.\n */\ngoog.crypt.base64.encodeByteArray = function(input, opt_webSafe) {\n  // Assert avoids runtime dependency on goog.isArrayLike, which helps reduce\n  // size of jscompiler output, and which yields slight performance increase.\n  goog.asserts.assert(\n      goog.isArrayLike(input), 'encodeByteArray takes an array as a parameter');\n\n  goog.crypt.base64.init_();\n\n  var byteToCharMap = opt_webSafe ? goog.crypt.base64.byteToCharMapWebSafe_ :\n                                    goog.crypt.base64.byteToCharMap_;\n\n  var output = [];\n\n  for (var i = 0; i < input.length; i += 3) {\n    var byte1 = input[i];\n    var haveByte2 = i + 1 < input.length;\n    var byte2 = haveByte2 ? input[i + 1] : 0;\n    var haveByte3 = i + 2 < input.length;\n    var byte3 = haveByte3 ? input[i + 2] : 0;\n\n    var outByte1 = byte1 >> 2;\n    var outByte2 = ((byte1 & 0x03) << 4) | (byte2 >> 4);\n    var outByte3 = ((byte2 & 0x0F) << 2) | (byte3 >> 6);\n    var outByte4 = byte3 & 0x3F;\n\n    if (!haveByte3) {\n      outByte4 = 64;\n\n      if (!haveByte2) {\n        outByte3 = 64;\n      }\n    }\n\n    output.push(\n        byteToCharMap[outByte1], byteToCharMap[outByte2],\n        byteToCharMap[outByte3], byteToCharMap[outByte4]);\n  }\n\n  return output.join('');\n};\n\n\n/**\n * Base64-encode a string.\n *\n * @param {string} input A string to encode.\n * @param {boolean=} opt_webSafe True indicates we should use the alternative\n *     alphabet, which does not require escaping for use in URLs.\n * @return {string} The base64 encoded string.\n */\ngoog.crypt.base64.encodeString = function(input, opt_webSafe) {\n  // Shortcut for browsers that implement\n  // a native base64 encoder in the form of \"btoa/atob\"\n  if (goog.crypt.base64.HAS_NATIVE_ENCODE_ && !opt_webSafe) {\n    return goog.global.btoa(input);\n  }\n  return goog.crypt.base64.encodeByteArray(\n      goog.crypt.stringToByteArray(input), opt_webSafe);\n};\n\n\n/**\n * Base64-decode a string.\n *\n * @param {string} input Input to decode. Any whitespace is ignored, and the\n *     input maybe encoded with either supported alphabet (or a mix thereof).\n * @param {boolean=} opt_webSafe True indicates we should use the alternative\n *     alphabet, which does not require escaping for use in URLs. Note that\n *     passing false may also still allow webSafe input decoding, when the\n *     fallback decoder is used on browsers without native support.\n * @return {string} string representing the decoded value.\n */\ngoog.crypt.base64.decodeString = function(input, opt_webSafe) {\n  // Shortcut for browsers that implement\n  // a native base64 encoder in the form of \"btoa/atob\"\n  if (goog.crypt.base64.HAS_NATIVE_DECODE_ && !opt_webSafe) {\n    return goog.global.atob(input);\n  }\n  var output = '';\n  function pushByte(b) { output += String.fromCharCode(b); }\n\n  goog.crypt.base64.decodeStringInternal_(input, pushByte);\n\n  return output;\n};\n\n\n/**\n * Base64-decode a string to an Array of numbers.\n *\n * In base-64 decoding, groups of four characters are converted into three\n * bytes.  If the encoder did not apply padding, the input length may not\n * be a multiple of 4.\n *\n * In this case, the last group will have fewer than 4 characters, and\n * padding will be inferred.  If the group has one or two characters, it decodes\n * to one byte.  If the group has three characters, it decodes to two bytes.\n *\n * @param {string} input Input to decode. Any whitespace is ignored, and the\n *     input maybe encoded with either supported alphabet (or a mix thereof).\n * @param {boolean=} opt_ignored Unused parameter, retained for compatibility.\n * @return {!Array<number>} bytes representing the decoded value.\n */\ngoog.crypt.base64.decodeStringToByteArray = function(input, opt_ignored) {\n  var output = [];\n  function pushByte(b) { output.push(b); }\n\n  goog.crypt.base64.decodeStringInternal_(input, pushByte);\n\n  return output;\n};\n\n\n/**\n * Base64-decode a string to a Uint8Array.\n *\n * Note that Uint8Array is not supported on older browsers, e.g. IE < 10.\n * @see http://caniuse.com/uint8array\n *\n * In base-64 decoding, groups of four characters are converted into three\n * bytes.  If the encoder did not apply padding, the input length may not\n * be a multiple of 4.\n *\n * In this case, the last group will have fewer than 4 characters, and\n * padding will be inferred.  If the group has one or two characters, it decodes\n * to one byte.  If the group has three characters, it decodes to two bytes.\n *\n * @param {string} input Input to decode. Any whitespace is ignored, and the\n *     input maybe encoded with either supported alphabet (or a mix thereof).\n * @return {!Uint8Array} bytes representing the decoded value.\n */\ngoog.crypt.base64.decodeStringToUint8Array = function(input) {\n  goog.asserts.assert(\n      !goog.userAgent.IE || goog.userAgent.isVersionOrHigher('10'),\n      'Browser does not support typed arrays');\n  var len = input.length;\n  // Approximate the length of the array needed for output.\n  // Our method varies according to the format of the input, which we can\n  // consider in three categories:\n  //   A) well-formed with proper padding\n  //   B) well-formed without any padding\n  //   C) not-well-formed, either with extra whitespace in the middle or with\n  //      extra padding characters.\n  //\n  //  In the case of (A), (length * 3 / 4) will result in an integer number of\n  //  bytes evenly divisible by 3, and we need only subtract bytes according to\n  //  the padding observed.\n  //\n  //  In the case of (B), (length * 3 / 4) will result in a non-integer number\n  //  of bytes, or not evenly divisible by 3. (If the result is evenly divisible\n  //  by 3, it's well-formed with the proper amount of padding [0 padding]).\n  //  This approximation can become exact by rounding down.\n  //\n  //  In the case of (C), the only way to get the length is to walk the full\n  //  length of the string to consider each character. This is handled by\n  //  tracking the number of bytes added to the array and using subarray to\n  //  trim the array back down to size.\n  var approxByteLength = len * 3 / 4;\n  if (approxByteLength % 3) {\n    // The string isn't complete, either because it didn't include padding, or\n    // because it has extra white space.\n    // In either case, we won't generate more bytes than are completely encoded,\n    // so rounding down is appropriate to have a buffer at least as large as\n    // output.\n    approxByteLength = Math.floor(approxByteLength);\n  } else if (input[len - 1] === '=') {\n    // The string has a round length, and has some padding.\n    // Reduce the byte length according to the quantity of padding.\n    if (input[len - 2] === '=') {\n      approxByteLength -= 2;\n    } else {\n      approxByteLength -= 1;\n    }\n  }\n  var output = new Uint8Array(approxByteLength);\n  var outLen = 0;\n  function pushByte(b) {\n    output[outLen++] = b;\n  }\n\n  goog.crypt.base64.decodeStringInternal_(input, pushByte);\n\n  // Return a subarray to handle the case that input included extra whitespace\n  // or extra padding and approxByteLength was incorrect.\n  return output.subarray(0, outLen);\n};\n\n\n/**\n * @param {string} input Input to decode.\n * @param {function(number):void} pushByte result accumulator.\n * @private\n */\ngoog.crypt.base64.decodeStringInternal_ = function(input, pushByte) {\n  goog.crypt.base64.init_();\n\n  var nextCharIndex = 0;\n  /**\n   * @param {number} default_val Used for end-of-input.\n   * @return {number} The next 6-bit value, or the default for end-of-input.\n   */\n  function getByte(default_val) {\n    while (nextCharIndex < input.length) {\n      var ch = input.charAt(nextCharIndex++);\n      var b = goog.crypt.base64.charToByteMap_[ch];\n      if (b != null) {\n        return b;  // Common case: decoded the char.\n      }\n      if (!goog.string.isEmptyOrWhitespace(ch)) {\n        throw new Error('Unknown base64 encoding at char: ' + ch);\n      }\n      // We encountered whitespace: loop around to the next input char.\n    }\n    return default_val;  // No more input remaining.\n  }\n\n  while (true) {\n    var byte1 = getByte(-1);\n    var byte2 = getByte(0);\n    var byte3 = getByte(64);\n    var byte4 = getByte(64);\n\n    // The common case is that all four bytes are present, so if we have byte4\n    // we can skip over the truncated input special case handling.\n    if (byte4 === 64) {\n      if (byte1 === -1) {\n        return;  // Terminal case: no input left to decode.\n      }\n      // Here we know an intermediate number of bytes are missing.\n      // The defaults for byte2, byte3 and byte4 apply the inferred padding\n      // rules per the public API documentation. i.e: 1 byte\n      // missing should yield 2 bytes of output, but 2 or 3 missing bytes yield\n      // a single byte of output. (Recall that 64 corresponds the padding char).\n    }\n\n    var outByte1 = (byte1 << 2) | (byte2 >> 4);\n    pushByte(outByte1);\n\n    if (byte3 != 64) {\n      var outByte2 = ((byte2 << 4) & 0xF0) | (byte3 >> 2);\n      pushByte(outByte2);\n\n      if (byte4 != 64) {\n        var outByte3 = ((byte3 << 6) & 0xC0) | byte4;\n        pushByte(outByte3);\n      }\n    }\n  }\n};\n\n\n/**\n * Lazy static initialization function. Called before\n * accessing any of the static map variables.\n * @private\n */\ngoog.crypt.base64.init_ = function() {\n  if (!goog.crypt.base64.byteToCharMap_) {\n    goog.crypt.base64.byteToCharMap_ = {};\n    goog.crypt.base64.charToByteMap_ = {};\n    goog.crypt.base64.byteToCharMapWebSafe_ = {};\n\n    // We want quick mappings back and forth, so we precompute two maps.\n    for (var i = 0; i < goog.crypt.base64.ENCODED_VALS.length; i++) {\n      goog.crypt.base64.byteToCharMap_[i] =\n          goog.crypt.base64.ENCODED_VALS.charAt(i);\n      goog.crypt.base64.charToByteMap_[goog.crypt.base64.byteToCharMap_[i]] = i;\n      goog.crypt.base64.byteToCharMapWebSafe_[i] =\n          goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(i);\n\n      // Be forgiving when decoding and correctly decode both encodings.\n      if (i >= goog.crypt.base64.ENCODED_VALS_BASE.length) {\n        goog.crypt.base64\n            .charToByteMap_[goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(i)] =\n            i;\n      }\n    }\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Utility functions to handle Firebase Auth ID tokens.\n */\n\ngoog.provide('fireauth.IdToken');\n\ngoog.require('goog.crypt.base64');\n\n\n/**\n * Parses the token string into a {@code Token} object.\n * @param {!fireauth.IdToken.JsonToken} token The parsed JSON token.\n * @constructor\n */\nfireauth.IdToken = function(token) {\n  /** @const @private {string} The issuer of the token. */\n  this.iss_ = token['iss'];\n  /** @const @private {string} The audience of the token. */\n  this.aud_ = token['aud'];\n  /** @const @private {number} The expire time in seconds of the token. */\n  this.exp_ = token['exp'];\n  /** @const @private {string} The local user ID of the token. */\n  this.localId_ = token['sub'];\n  var now = goog.now() / 1000;\n  /** @const @private {number} The issue time in seconds of the token. */\n  this.iat_ = token['iat'] || (now > this.exp_ ? this.exp_ : now);\n  /** @const @private {?string} The email address of the token. */\n  this.email_ = token['email'] || null;\n  /** @const @private {boolean} Whether the user is verified. */\n  this.verified_ = !!token['verified'];\n  /** @const @private {?string} The provider ID of the token. */\n  this.providerId_ = token['provider_id'] ||\n      (token['firebase'] && token['firebase']['sign_in_provider']) ||\n      null;\n  /** @const @private {?string} The tenant ID of the token. */\n  this.tenantId_ = (token['firebase'] && token['firebase']['tenant']) || null;\n  /** @const @private {boolean} Whether the user is anonymous. */\n  this.anonymous_ = !!token['is_anonymous'] || this.providerId_ == 'anonymous';\n  /** @const @private {?string} The federated ID of the token. */\n  this.federatedId_ = token['federated_id'] || null;\n  /** @const @private {?string} The display name of the token. */\n  this.displayName_ = token['display_name'] || null;\n  /** @const @private {?string} The photo URL of the token. */\n  this.photoURL_ = token['photo_url'] || null;\n  /**\n   * @const @private {?string} The phone number of the user identified by the\n   *     token.\n   */\n  this.phoneNumber_ = token['phone_number'] || null;\n};\n\n\n/**\n * @typedef {{\n *   identities: (?Object|undefined),\n *   sign_in_provider: (?string|undefined),\n *   tenant: (string|undefined)\n * }}\n */\nfireauth.IdToken.Firebase;\n\n\n/**\n * @typedef {{\n *   iss: string,\n *   aud: string,\n *   exp: number,\n *   sub: string,\n *   iat: (?number|undefined),\n *   email: (?string|undefined),\n *   verified: (?boolean|undefined),\n *   provider_id: (?string|undefined),\n *   is_anonymous: (?boolean|undefined),\n *   federated_id: (?string|undefined),\n *   display_name: (?string|undefined),\n *   photo_url: (?string|undefined),\n *   phone_number: (?string|undefined),\n *   firebase: (?fireauth.IdToken.Firebase|undefined)\n * }}\n */\nfireauth.IdToken.JsonToken;\n\n\n/** @return {?string} The email address of the account. */\nfireauth.IdToken.prototype.getEmail = function() {\n  return this.email_;\n};\n\n\n/** @return {number} The expire time in seconds. */\nfireauth.IdToken.prototype.getExp = function() {\n  return this.exp_;\n};\n\n\n/** @return {?string} The ID of the identity provider. */\nfireauth.IdToken.prototype.getProviderId = function() {\n  return this.providerId_;\n};\n\n\n/** @return {?string} The tenant ID. */\nfireauth.IdToken.prototype.getTenantId = function() {\n  return this.tenantId_;\n};\n\n\n/** @return {?string} The display name of the account. */\nfireauth.IdToken.prototype.getDisplayName = function() {\n  return this.displayName_;\n};\n\n\n/** @return {?string} The photo URL of the account. */\nfireauth.IdToken.prototype.getPhotoUrl = function() {\n  return this.photoURL_;\n};\n\n\n/** @return {string} The user ID of the account. */\nfireauth.IdToken.prototype.getLocalId = function() {\n  return this.localId_;\n};\n\n\n/** @return {?string} The federated ID of the account. */\nfireauth.IdToken.prototype.getFederatedId = function() {\n  return this.federatedId_;\n};\n\n\n/** @return {boolean} Whether the user is anonymous. */\nfireauth.IdToken.prototype.isAnonymous = function() {\n  return this.anonymous_;\n};\n\n\n/** @return {boolean} Whether the user email is verified. */\nfireauth.IdToken.prototype.isVerified = function() {\n  return this.verified_;\n};\n\n\n/** @return {boolean} Whether token is expired. */\nfireauth.IdToken.prototype.isExpired = function() {\n  var now = Math.floor(goog.now() / 1000);\n  // It is expired if token expiration time is less than current time.\n  return this.getExp() <= now;\n};\n\n\n/** @return {string} The issuer of the token. */\nfireauth.IdToken.prototype.getIssuer = function() {\n  return this.iss_;\n};\n\n\n/** @return {?string} The phone number of the account. */\nfireauth.IdToken.prototype.getPhoneNumber = function() {\n  return this.phoneNumber_;\n};\n\n\n/**\n * Parses the JWT token and extracts the information part without verifying the\n * token signature.\n * @param {string} tokenString The JWT token.\n * @return {?fireauth.IdToken} The decoded token.\n */\nfireauth.IdToken.parse = function(tokenString) {\n  var token = fireauth.IdToken.parseIdTokenClaims(tokenString);\n  if (token && token['sub'] && token['iss'] && token['aud'] && token['exp']) {\n    return new fireauth.IdToken(\n        /** @type {!fireauth.IdToken.JsonToken} */ (token));\n  }\n  return null;\n};\n\n/**\n * Converts the information part of JWT token to plain object format.\n * @param {?string} tokenString The JWT token.\n * @return {?Object}\n */\nfireauth.IdToken.parseIdTokenClaims = function(tokenString) {\n  if (!tokenString) {\n    return null;\n  }\n  // Token format is <algorithm>.<info>.<sig>\n  var fields = tokenString.split('.');\n  if (fields.length != 3) {\n    return null;\n  }\n  var jsonInfo = fields[1];\n  // Google base64 library does not handle padding.\n  var padLen = (4 - jsonInfo.length % 4) % 4;\n  for (var i = 0; i < padLen; i++) {\n    jsonInfo += '.';\n  }\n  try {\n    var token = JSON.parse(goog.crypt.base64.decodeString(jsonInfo, true));\n    return /** @type {?Object} */ (token);\n  } catch (e) {}\n  return null;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines all common constants and enums used by firebase-auth.\n */\n\ngoog.provide('fireauth.constants');\ngoog.provide('fireauth.constants.AuthEventType');\n\n\n/**\n * Enums for authentication operation types.\n * @enum {string}\n */\nfireauth.constants.OperationType = {\n  LINK: 'link',\n  REAUTHENTICATE: 'reauthenticate',\n  SIGN_IN: 'signIn'\n};\n\n\n/**\n * Events dispatched firebase.auth.Auth.\n * @enum {string}\n */\nfireauth.constants.AuthEventType = {\n  /** Dispatched when Firebase framework is changed. */\n  FRAMEWORK_CHANGED: 'frameworkChanged',\n  /** Dispatched when language code is changed. */\n  LANGUAGE_CODE_CHANGED: 'languageCodeChanged'\n};\n\n\n/**\n * The settings of an Auth endpoint. The fields are:\n * <ul>\n * <li>firebaseAuthEndpoint: defines the Firebase Auth backend endpoint for\n *     specified endpoint type.</li>\n * <li>secureTokenEndpoint: defines the secure token backend endpoint for\n *     specified endpoint type.</li>\n * <li>id: defines the endpoint identifier.</li>\n * </ul>\n * @typedef {{\n *   firebaseAuthEndpoint: string,\n *   secureTokenEndpoint: string,\n *   id: string\n * }}\n */\nfireauth.constants.EndpointSettings;\n\n\n/**\n * The different endpoints for Firebase Auth backend.\n * @enum {!fireauth.constants.EndpointSettings}\n */\nfireauth.constants.Endpoint = {\n  PRODUCTION: {\n    firebaseAuthEndpoint: 'https://www.googleapis.com/identitytoolkit/v3/' +\n        'relyingparty/',\n    secureTokenEndpoint: 'https://securetoken.googleapis.com/v1/token',\n    id: 'p'\n  },\n  STAGING: {\n    firebaseAuthEndpoint: 'https://staging-www.sandbox.googleapis.com/' +\n        'identitytoolkit/v3/relyingparty/',\n    secureTokenEndpoint: 'https://staging-securetoken.sandbox.googleapis.com' +\n        '/v1/token',\n    id: 's'\n  },\n  TEST: {\n    firebaseAuthEndpoint: 'https://www-googleapis-test.sandbox.google.com/' +\n        'identitytoolkit/v3/relyingparty/',\n    secureTokenEndpoint: 'https://test-securetoken.sandbox.googleapis.com/v1' +\n        '/token',\n    id: 't'\n  }\n};\n\n\n/**\n * Returns the endpoint specific RpcHandler configuration.\n * @param {?string=} opt_id The identifier of the endpoint type if available.\n * @return {?Object|undefined} The RpcHandler endpoint configuration object.\n */\nfireauth.constants.getEndpointConfig = function(opt_id) {\n  for (var endpointKey in fireauth.constants.Endpoint) {\n    if (fireauth.constants.Endpoint[endpointKey].id === opt_id) {\n      var endpoint = fireauth.constants.Endpoint[endpointKey];\n      return {\n        'firebaseEndpoint': endpoint.firebaseAuthEndpoint,\n        'secureTokenEndpoint': endpoint.secureTokenEndpoint\n      };\n    }\n  }\n  return null;\n};\n\n\n/**\n * Returns the validated endpoint identifier. Undefined if the provided one is\n * invalid.\n * @param {?string=} opt_id The identifier of the endpoint type if available.\n * @return {string|undefined} The validated endpoint ID. If not valid,\n *     undefined.\n */\nfireauth.constants.getEndpointId = function(opt_id) {\n  if (opt_id && fireauth.constants.getEndpointConfig(opt_id)) {\n    return opt_id;\n  }\n  return undefined;\n};\n\n\n/** @const {string|undefined} The current client endpoint. */\nfireauth.constants.clientEndpoint = fireauth.constants.getEndpointId('__EID__');\n\n\n/** @const {string} The required SAML provider ID prefix. */\nfireauth.constants.SAML_PREFIX = 'saml.';\n\n\n/** @const {string} The required OIDC provider ID prefix. */\nfireauth.constants.OIDC_PREFIX = 'oidc.';\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the IdP provider IDs and related settings.\n */\n\ngoog.provide('fireauth.idp');\ngoog.provide('fireauth.idp.IdpSettings');\ngoog.provide('fireauth.idp.ProviderId');\ngoog.provide('fireauth.idp.Settings');\ngoog.provide('fireauth.idp.SignInMethod');\n\ngoog.require('fireauth.constants');\n\n\n/**\n * Enums for supported provider IDs. These provider IDs correspond to the\n * sign_in_provider in the Firebase ID token and do not correspond to the\n * supported client exposed firebase.auth.AuthProviders.\n * @enum {string}\n */\nfireauth.idp.ProviderId = {\n  ANONYMOUS: 'anonymous',\n  CUSTOM: 'custom',\n  FACEBOOK: 'facebook.com',\n  FIREBASE: 'firebase',\n  GITHUB: 'github.com',\n  GOOGLE: 'google.com',\n  PASSWORD: 'password',\n  PHONE: 'phone',\n  TWITTER: 'twitter.com'\n};\n\n\n/**\n * Enums for supported sign in methods.\n * @enum {string}\n */\nfireauth.idp.SignInMethod = {\n  EMAIL_LINK: 'emailLink',\n  EMAIL_PASSWORD: 'password',\n  FACEBOOK: 'facebook.com',\n  GITHUB: 'github.com',\n  GOOGLE: 'google.com',\n  PHONE: 'phone',\n  TWITTER: 'twitter.com'\n};\n\n\n/**\n * The settings of an identity provider. The fields are:\n * <ul>\n * <li>languageParam: defines the custom OAuth language parameter.\n * <li>popupWidth: defines the popup recommended width.\n * <li>popupHeight: defines the popup recommended height.\n * <li>providerId: defines the provider ID.\n * <li>reservedOAuthParameters: defines the list of reserved OAuth parameters.\n * </ul>\n * @typedef {{\n *   languageParam: (?string|undefined),\n *   popupWidth: (?number|undefined),\n *   popupHeight: (?number|undefined),\n *   providerId: !fireauth.idp.ProviderId,\n *   reservedOAuthParameters: !Array<string>\n * }}\n */\nfireauth.idp.IdpSettings;\n\n\n/**\n * The list of reserved OAuth 1.0 parameters.\n * @const {!Array<string>}\n */\nfireauth.idp.RESERVED_OAUTH1_PARAMS =\n    ['oauth_consumer_key', 'oauth_nonce', 'oauth_signature',\n     'oauth_signature_method', 'oauth_timestamp', 'oauth_token',\n     'oauth_version'];\n\n\n/**\n * The list of reserved OAuth 2.0 parameters.\n * @const {!Array<string>}\n */\nfireauth.idp.RESERVED_OAUTH2_PARAMS =\n    ['client_id', 'response_type', 'scope', 'redirect_uri', 'state'];\n\n\n/**\n * The recommendations for the different IdP display settings.\n * @enum {!fireauth.idp.IdpSettings}\n */\nfireauth.idp.Settings = {\n  FACEBOOK: {\n    languageParam: 'locale',\n    popupWidth: 700,\n    popupHeight: 600,\n    providerId: fireauth.idp.ProviderId.FACEBOOK,\n    reservedOAuthParameters: fireauth.idp.RESERVED_OAUTH2_PARAMS,\n  },\n  GITHUB: {\n    languageParam: null,\n    popupWidth: 500,\n    popupHeight: 750,\n    providerId: fireauth.idp.ProviderId.GITHUB,\n    reservedOAuthParameters: fireauth.idp.RESERVED_OAUTH2_PARAMS,\n  },\n  GOOGLE: {\n    languageParam: 'hl',\n    popupWidth: 515,\n    popupHeight: 680,\n    providerId: fireauth.idp.ProviderId.GOOGLE,\n    reservedOAuthParameters: fireauth.idp.RESERVED_OAUTH2_PARAMS,\n  },\n  TWITTER: {\n    languageParam: 'lang',\n    popupWidth: 485,\n    popupHeight: 705,\n    providerId: fireauth.idp.ProviderId.TWITTER,\n    reservedOAuthParameters: fireauth.idp.RESERVED_OAUTH1_PARAMS,\n  },\n  APPLE: {\n    languageParam: 'locale',\n    popupWidth: 600,\n    popupHeight: 600,\n    providerId: 'apple.com',\n    reservedOAuthParameters: [],\n  },\n};\n\n\n/**\n * @param {!fireauth.idp.ProviderId} providerId The requested provider ID.\n * @return {?fireauth.idp.Settings} The settings for the requested provider ID.\n */\nfireauth.idp.getIdpSettings = function(providerId) {\n  for (var key in fireauth.idp.Settings) {\n    if (fireauth.idp.Settings[key].providerId == providerId) {\n      return fireauth.idp.Settings[key];\n    }\n  }\n  return null;\n};\n\n\n/**\n * @param {!fireauth.idp.ProviderId} providerId The requested provider ID.\n * @return {!Array<string>} The list of reserved OAuth parameters.\n */\nfireauth.idp.getReservedOAuthParams = function(providerId) {\n  var settings = fireauth.idp.getIdpSettings(providerId);\n  return (settings && settings.reservedOAuthParameters) || [];\n};\n\n\n/**\n * @param {?string|undefined} identifier The provider identifier.\n * @return {boolean} Whether the identifier provided is a SAML provider ID.\n */\nfireauth.idp.isSaml = function(identifier) {\n   return typeof identifier === 'string' &&\n     identifier.indexOf(fireauth.constants.SAML_PREFIX) == 0;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines all the fireauth additional user info interfaces,\n * implementations and subclasses.\n */\n\ngoog.provide('fireauth.AdditionalUserInfo');\ngoog.provide('fireauth.FacebookAdditionalUserInfo');\ngoog.provide('fireauth.FederatedAdditionalUserInfo');\ngoog.provide('fireauth.GenericAdditionalUserInfo');\ngoog.provide('fireauth.GithubAdditionalUserInfo');\ngoog.provide('fireauth.GoogleAdditionalUserInfo');\ngoog.provide('fireauth.TwitterAdditionalUserInfo');\n\ngoog.require('fireauth.IdToken');\ngoog.require('fireauth.idp');\ngoog.require('fireauth.object');\ngoog.require('fireauth.util');\n\n\n/**\n * The interface that represents additional user info.\n * @interface\n */\nfireauth.AdditionalUserInfo = function() {};\n\n\n/**\n * Constructs the corresponding additional user info for the backend\n * verifyAssertion response.\n * @param {?Object|undefined} resp The backend verifyAssertion,\n *     verifyPhoneNumber or verifyPassword/setAccountInfo response.\n * @return {?fireauth.AdditionalUserInfo} The fireauth.AdditionalUserInfo\n *     instance.\n */\nfireauth.AdditionalUserInfo.fromPlainObject = function(resp) {\n  var factory = {};\n  factory[fireauth.idp.ProviderId.FACEBOOK] =\n      fireauth.FacebookAdditionalUserInfo;\n  factory[fireauth.idp.ProviderId.GOOGLE] =\n      fireauth.GoogleAdditionalUserInfo;\n  factory[fireauth.idp.ProviderId.GITHUB] =\n      fireauth.GithubAdditionalUserInfo;\n  factory[fireauth.idp.ProviderId.TWITTER] =\n      fireauth.TwitterAdditionalUserInfo;\n  // Provider ID and UID are required.\n  var providerId =\n      resp &&\n      resp[fireauth.AdditionalUserInfo.VerifyAssertionField.PROVIDER_ID];\n  try {\n    // Provider ID already present.\n    if (providerId) {\n      if (factory[providerId]) {\n        // 1st class supported federated providers.\n        return new factory[providerId](resp);\n      } else {\n        // Generic federated providers.\n        return new fireauth.FederatedAdditionalUserInfo(\n            /** @type {!Object} */ (resp));\n      }\n    } else if (typeof resp[fireauth.AdditionalUserInfo.VerifyAssertionField\n                           .ID_TOKEN] !== 'undefined') {\n      // For all other ID token responses with no providerId, get the required\n      // providerId from the ID token itself.\n      return new fireauth.GenericAdditionalUserInfo(\n          /** @type {!Object} */ (resp));\n    }\n  } catch (e) {\n    // Do nothing, null will be returned.\n  }\n  return null;\n};\n\n\n\n/**\n * verifyAssertion response additional user info fields.\n * @enum {string}\n */\nfireauth.AdditionalUserInfo.VerifyAssertionField = {\n  ID_TOKEN: 'idToken',\n  IS_NEW_USER: 'isNewUser',\n  KIND: 'kind',\n  PROVIDER_ID: 'providerId',\n  RAW_USER_INFO: 'rawUserInfo',\n  SCREEN_NAME: 'screenName'\n};\n\n\n/**\n * Constructs a generic additional user info object from the backend\n * verifyPhoneNumber and verifyPassword provider response.\n * @param {!Object} info The verifyPhoneNumber/verifyPassword/setAccountInfo\n *     response data object.\n * @constructor\n * @implements {fireauth.AdditionalUserInfo}\n */\nfireauth.GenericAdditionalUserInfo = function(info) {\n  // Federated provider profile data.\n  var providerId =\n      info[fireauth.AdditionalUserInfo.VerifyAssertionField.PROVIDER_ID];\n  // Try to get providerId from the ID token if available.\n  if (!providerId &&\n      info[fireauth.AdditionalUserInfo.VerifyAssertionField.ID_TOKEN]) {\n    // verifyPassword/setAccountInfo and verifyPhoneNumber return an ID token\n    // but no providerId. Get providerId from the token itself.\n    // isNewUser will be returned for verifyPhoneNumber.\n    var idToken = fireauth.IdToken.parse(\n        info[fireauth.AdditionalUserInfo.VerifyAssertionField.ID_TOKEN]);\n    if (idToken && idToken.getProviderId()) {\n      providerId = idToken.getProviderId();\n    }\n  }\n  if (!providerId) {\n    // This is internal only.\n    throw new Error('Invalid additional user info!');\n  }\n  // For custom token and anonymous token, set provider ID to null.\n  if (providerId == fireauth.idp.ProviderId.ANONYMOUS ||\n      providerId == fireauth.idp.ProviderId.CUSTOM) {\n      providerId = null;\n  }\n  // Check whether user is new. Temporary Solution since backend does not return\n  // isNewUser field for SignupNewUserResponse.\n  var isNewUser = false;\n  if (typeof info[fireauth.AdditionalUserInfo.VerifyAssertionField.IS_NEW_USER]\n      !== 'undefined') {\n    isNewUser =\n        !!info[fireauth.AdditionalUserInfo.VerifyAssertionField.IS_NEW_USER];\n  } else if (info[fireauth.AdditionalUserInfo.VerifyAssertionField.KIND]\n             === 'identitytoolkit#SignupNewUserResponse') {\n    //For SignupNewUserResponse, always set isNewUser to true.\n    isNewUser = true;\n  }\n  // Set required providerId.\n  fireauth.object.setReadonlyProperty(this, 'providerId', providerId);\n  // Set read-only isNewUser property.\n  fireauth.object.setReadonlyProperty(this, 'isNewUser', isNewUser);\n};\n\n\n/**\n * Constructs a federated additional user info object from the backend\n * verifyAssertion federated provider response.\n * @param {!Object} info The verifyAssertion response data object.\n * @constructor\n * @extends {fireauth.GenericAdditionalUserInfo}\n */\nfireauth.FederatedAdditionalUserInfo = function(info) {\n  fireauth.FederatedAdditionalUserInfo.base(this, 'constructor', info);\n  // Federated provider profile data.\n  // This structure will also be used for generic IdPs.\n  var profile = fireauth.util.parseJSON(\n      info[fireauth.AdditionalUserInfo.VerifyAssertionField.RAW_USER_INFO] ||\n      '{}');\n  // Set read-only profile property.\n  fireauth.object.setReadonlyProperty(\n      this,\n      'profile',\n      fireauth.object.unsafeCreateReadOnlyCopy(profile || {}));\n};\ngoog.inherits(\n    fireauth.FederatedAdditionalUserInfo, fireauth.GenericAdditionalUserInfo);\n\n\n/**\n * Constructs a Facebook additional user info object from the backend\n * verifyAssertion Facebook provider response.\n * @param {!Object} info The verifyAssertion response data object.\n * @constructor\n * @extends {fireauth.FederatedAdditionalUserInfo}\n */\nfireauth.FacebookAdditionalUserInfo = function(info) {\n  fireauth.FacebookAdditionalUserInfo.base(this, 'constructor', info);\n  // This should not happen as this object is initialized via fromPlainObject.\n  if (this['providerId'] != fireauth.idp.ProviderId.FACEBOOK) {\n    throw new Error('Invalid provider ID!');\n  }\n};\ngoog.inherits(\n    fireauth.FacebookAdditionalUserInfo, fireauth.FederatedAdditionalUserInfo);\n\n\n\n/**\n * Constructs a GitHub additional user info object from the backend\n * verifyAssertion GitHub provider response.\n * @param {!Object} info The verifyAssertion response data object.\n * @constructor\n * @extends {fireauth.FederatedAdditionalUserInfo}\n */\nfireauth.GithubAdditionalUserInfo = function(info) {\n  fireauth.GithubAdditionalUserInfo.base(this, 'constructor', info);\n  // This should not happen as this object is initialized via fromPlainObject.\n  if (this['providerId'] != fireauth.idp.ProviderId.GITHUB) {\n    throw new Error('Invalid provider ID!');\n  }\n  // GitHub username.\n  fireauth.object.setReadonlyProperty(\n      this,\n      'username',\n      (this['profile'] && this['profile']['login']) || null);\n};\ngoog.inherits(\n    fireauth.GithubAdditionalUserInfo, fireauth.FederatedAdditionalUserInfo);\n\n\n\n/**\n * Constructs a Google additional user info object from the backend\n * verifyAssertion Google provider response.\n * @param {!Object} info The verifyAssertion response data object.\n * @constructor\n * @extends {fireauth.FederatedAdditionalUserInfo}\n */\nfireauth.GoogleAdditionalUserInfo = function(info) {\n  fireauth.GoogleAdditionalUserInfo.base(this, 'constructor', info);\n  // This should not happen as this object is initialized via fromPlainObject.\n  if (this['providerId'] != fireauth.idp.ProviderId.GOOGLE) {\n    throw new Error('Invalid provider ID!');\n  }\n};\ngoog.inherits(\n    fireauth.GoogleAdditionalUserInfo, fireauth.FederatedAdditionalUserInfo);\n\n\n\n/**\n * Constructs a Twitter additional user info object from the backend\n * verifyAssertion Twitter provider response.\n * @param {!Object} info The verifyAssertion response data object.\n * @constructor\n * @extends {fireauth.FederatedAdditionalUserInfo}\n */\nfireauth.TwitterAdditionalUserInfo = function(info) {\n  fireauth.TwitterAdditionalUserInfo.base(this, 'constructor', info);\n  // This should not happen as this object is initialized via fromPlainObject.\n  if (this['providerId'] != fireauth.idp.ProviderId.TWITTER) {\n    throw new Error('Invalid provider ID!');\n  }\n  // Twitter user name.\n  fireauth.object.setReadonlyProperty(\n      this,\n      'username',\n      info[fireauth.AdditionalUserInfo.VerifyAssertionField.SCREEN_NAME] ||\n      null);\n};\ngoog.inherits(\n    fireauth.TwitterAdditionalUserInfo, fireauth.FederatedAdditionalUserInfo);\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the Firebase dynamic link constructor.\n */\n\ngoog.provide('fireauth.DynamicLink');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.object');\ngoog.require('fireauth.util');\ngoog.require('goog.Uri');\n\n\n/**\n * Dynamic link builder used to help build the FDL link to redirect to an app\n * while passing some payload or error.\n * @param {?string} fdlDomain The FDL domain. If none is available, custom\n *     scheme redirects are used.\n * @param {!fireauth.DynamicLink.Platform} platform The FDL supported\n *     platform (Android or iOS).\n * @param {string} appIdentifier The app identifier (iOS bundle ID or Android\n *     package name).\n * @param {string} authDomain The Firebase application authDomain.\n * @param {string} payload The FDL deep link content.\n * @param {?string=} opt_clientId The optional OAuth client ID.\n * @constructor\n */\nfireauth.DynamicLink = function(fdlDomain, platform, appIdentifier, authDomain,\n    payload, opt_clientId) {\n  // The fallback error when the app is not installed on the device.\n  var defaultError =\n      new fireauth.AuthError(fireauth.authenum.Error.APP_NOT_INSTALLED);\n  /** @private {string} The fallback URL when the app is not installed. */\n  this.fallbackUrl_ = 'https://' + authDomain + '/__/auth/handler?' +\n      'firebaseError=' + encodeURIComponent(/** @type {string} */ (\n          fireauth.util.stringifyJSON(defaultError.toPlainObject())));\n  fireauth.object.setReadonlyProperty(this, 'fallbackUrl', this.fallbackUrl_);\n  /** @private {?string} The FDL domain if available. */\n  this.fdlDomain_ = fdlDomain;\n  fireauth.object.setReadonlyProperty(this, 'fdlDomain', fdlDomain);\n  /** @private {!fireauth.DynamicLink.Platform} The FDL link platform. */\n  this.platform_ = platform;\n  fireauth.object.setReadonlyProperty(this, 'platform', platform);\n  /** @private {string} The app identifier. */\n  this.appIdentifier_ = appIdentifier;\n  fireauth.object.setReadonlyProperty(this, 'appIdentifier', appIdentifier);\n  /** @private {string} The Firebase application authDomain. */\n  this.authDomain_ = authDomain;\n  fireauth.object.setReadonlyProperty(this, 'authDomain', authDomain);\n  /** @private {string} The FDL deep link content. */\n  this.link_ = payload;\n  fireauth.object.setReadonlyProperty(this, 'payload', payload);\n  /** @private {?string} The application display name. */\n  this.appName_ = null;\n  fireauth.object.setReadonlyProperty(this, 'appName', null);\n  /** @private {?string} The client ID if available. */\n  this.clientId_ = opt_clientId || null;\n  fireauth.object.setReadonlyProperty(this, 'clientId', this.clientId_);\n};\n\n\n/**\n * Sets the app name for the current dynamic link.\n * @param {?string|undefined} appName The app name typically displayed in an FDL\n *     button.\n */\nfireauth.DynamicLink.prototype.setAppName = function(appName) {\n  this.appName_ = appName || null;\n  fireauth.object.setReadonlyProperty(this, 'appName', appName);\n};\n\n\n/**\n * Sets the dynamic link fallback URL overriding the default one.\n * @param {string} fallbackUrl The dynamic link fallback URL.\n */\nfireauth.DynamicLink.prototype.setFallbackUrl = function(fallbackUrl) {\n  this.fallbackUrl_ = fallbackUrl;\n  fireauth.object.setReadonlyProperty(this, 'fallbackUrl', fallbackUrl);\n};\n\n\n/**\n * Parses a dynamic link object from an automatic FDL redirect link.\n * @param {string} url The URL string to parse and convert to a dynamic link.\n * @return {?fireauth.DynamicLink} The corresponding dynamic link if applicable.\n */\nfireauth.DynamicLink.fromURL = function(url) {\n  // This constructs the Dynamic link from the URL provided.\n  var uri = goog.Uri.parse(url);\n  var fdlDomain = uri.getParameterValue('fdlDomain');\n  var platform = uri.getParameterValue('platform');\n  var appIdentifier = uri.getParameterValue('appIdentifier');\n  var authDomain = uri.getParameterValue('authDomain');\n  var payload = uri.getParameterValue('link');\n  var appName = uri.getParameterValue('appName');\n  if (fdlDomain && platform && appIdentifier && authDomain && payload &&\n      appName) {\n    var dl = new fireauth.DynamicLink(\n        /** @type {string} */ (fdlDomain),\n        /** @type {!fireauth.DynamicLink.Platform} */ (platform),\n        /** @type {string} */ (appIdentifier),\n        /** @type {string} */ (authDomain),\n        /** @type {string} */ (payload));\n    dl.setAppName(appName);\n    return dl;\n  }\n  return null;\n};\n\n\n/**\n * @param {string} url The dynamic link URL.\n * @return {string} The deep link embedded within the dynamic link.\n */\nfireauth.DynamicLink.parseDeepLink = function(url) {\n  var uri = goog.Uri.parse(url);\n  var link = uri.getParameterValue('link');\n  // Double link case (automatic redirect).\n  var doubleDeepLink = goog.Uri.parse(link).getParameterValue('link');\n  // iOS custom scheme links.\n  var iOSdeepLink = uri.getParameterValue('deep_link_id');\n  var iOSDoubledeepLink = goog.Uri.parse(iOSdeepLink).getParameterValue('link');\n  var callbackUrl =\n      iOSDoubledeepLink || iOSdeepLink || doubleDeepLink || link || url;\n  return callbackUrl;\n};\n\n\n/**\n * The supported FDL platforms.\n * @enum {string}\n */\nfireauth.DynamicLink.Platform = {\n  ANDROID: 'android',\n  IOS: 'ios'\n};\n\n\n/**\n * Constructs the common FDL link base used for building the button link or the\n * automatic redirect link.\n * @param {string} fallbackUrl The fallback URL to use.\n * @return {!goog.Uri} The partial URI of the FDL link used to build the final\n *     button link or the automatic redirect link.\n * @private\n */\nfireauth.DynamicLink.prototype.constructFdlBase_ = function(fallbackUrl) {\n  var uri = goog.Uri.create(\n      'https',\n      null,\n      this.fdlDomain_,\n      null,\n      '/');\n  if (this.platform_ == fireauth.DynamicLink.Platform.ANDROID) {\n    uri.setParameterValue('apn', this.appIdentifier_);\n    uri.setParameterValue('afl', fallbackUrl);\n  } else if (this.platform_ == fireauth.DynamicLink.Platform.IOS) {\n    uri.setParameterValue('ibi', this.appIdentifier_);\n    uri.setParameterValue('ifl', fallbackUrl);\n  }\n  return uri;\n};\n\n\n/**\n * Constructs the custom scheme URL. This is used when no FDL domain is\n * available.\n * @return {!goog.Uri} The uri of the dynamic link used to build the final\n *      button link or the automatic redirect link.\n * @private\n */\nfireauth.DynamicLink.prototype.constructCustomSchemeUrl_ = function() {\n  // This mimics the FDL custom scheme URL format.\n  var uri = goog.Uri.create(\n      this.clientId_ ? this.clientId_.split('.').reverse().join('.') :\n          this.appIdentifier_,\n      null,\n      // 'firebaseauth' is used in the app verification flow.\n      // 'google' is used for the Cordova iOS flow.\n      this.clientId_ ? 'firebaseauth' : 'google',\n      null,\n      '/link');\n  uri.setParameterValue('deep_link_id', this.link_);\n  return uri;\n};\n\n\n/**\n * @param {boolean=} opt_isAutoRedirect Whether the link is an auto redirect\n *     link.\n * @return {string} The generated dynamic link string.\n * @override\n */\nfireauth.DynamicLink.prototype.toString = function(opt_isAutoRedirect) {\n  // When FDL domain is not available, always returns the custom scheme URL.\n  if (!this.fdlDomain_) {\n    return this.constructCustomSchemeUrl_().toString();\n  }\n  if (!!opt_isAutoRedirect) {\n    return this.generateAutomaticRedirectLink_();\n  }\n  return this.generateButtonLink_();\n};\n\n\n/**\n * @return {string} The final FDL button link.\n * @private\n */\nfireauth.DynamicLink.prototype.generateButtonLink_ = function() {\n  var fdlLink = this.constructFdlBase_(this.fallbackUrl_);\n  fdlLink.setParameterValue('link', this.link_);\n  return fdlLink.toString();\n};\n\n\n/**\n * @return {string} The final FDL automatic redirect link.\n * @private\n */\nfireauth.DynamicLink.prototype.generateAutomaticRedirectLink_ =\n    function() {\n  var doubleDeeplink = goog.Uri.create(\n      'https',\n      null,\n      this.authDomain_,\n      null,\n      '/__/auth/callback');\n  doubleDeeplink.setParameterValue('fdlDomain', this.fdlDomain_);\n  doubleDeeplink.setParameterValue('platform', this.platform_);\n  doubleDeeplink.setParameterValue('appIdentifier', this.appIdentifier_);\n  doubleDeeplink.setParameterValue('authDomain', this.authDomain_);\n  doubleDeeplink.setParameterValue('link', this.link_);\n  doubleDeeplink.setParameterValue('appName', this.appName_ || '');\n  // The fallback URL is the deep link itself.\n  // This is in case the link fails to be intercepted by the app, FDL will\n  // redirect to the fallback URL.\n  var fdlLink = this.constructFdlBase_(doubleDeeplink.toString());\n  fdlLink.setParameterValue('link', doubleDeeplink.toString());\n  return fdlLink.toString();\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines Auth credentials used for signInWithCredential.\n */\n\ngoog.provide('fireauth.AuthCredential');\ngoog.provide('fireauth.AuthProvider');\ngoog.provide('fireauth.EmailAuthCredential');\ngoog.provide('fireauth.EmailAuthProvider');\ngoog.provide('fireauth.FacebookAuthProvider');\ngoog.provide('fireauth.FederatedProvider');\ngoog.provide('fireauth.GithubAuthProvider');\ngoog.provide('fireauth.GoogleAuthProvider');\ngoog.provide('fireauth.OAuthCredential');\ngoog.provide('fireauth.OAuthProvider');\ngoog.provide('fireauth.OAuthResponse');\ngoog.provide('fireauth.PhoneAuthCredential');\ngoog.provide('fireauth.PhoneAuthProvider');\ngoog.provide('fireauth.SAMLAuthCredential');\ngoog.provide('fireauth.SAMLAuthProvider');\ngoog.provide('fireauth.TwitterAuthProvider');\n\ngoog.require('fireauth.ActionCodeInfo');\ngoog.require('fireauth.ActionCodeURL');\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.DynamicLink');\ngoog.require('fireauth.IdToken');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.constants');\ngoog.require('fireauth.idp');\ngoog.require('fireauth.object');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.Uri');\ngoog.require('goog.array');\ngoog.require('goog.object');\n\ngoog.forwardDeclare('fireauth.RpcHandler');\n\n\n\n/**\n * The interface that represents Auth credential. It provides the underlying\n * implementation for retrieving the ID token depending on the type of\n * credential.\n * @interface\n */\nfireauth.AuthCredential = function() {};\n\n\n/**\n * Returns a promise to retrieve ID token using the underlying RPC handler API\n * for the current credential.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @return {!goog.Promise<!Object, !fireauth.AuthError>}\n *     idTokenPromise The RPC handler method that returns a promise which\n *     resolves with an ID token.\n */\nfireauth.AuthCredential.prototype.getIdTokenProvider;\n\n\n/**\n * Links the credential to an existing account, identified by an ID token.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @param {string} idToken The ID token of the existing account.\n * @return {!goog.Promise<!Object>} A Promise that resolves when the accounts\n *     are linked.\n */\nfireauth.AuthCredential.prototype.linkToIdToken;\n\n\n/**\n * Tries to match the credential's idToken with the provided UID.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @param {string} uid The UID of the user to reauthenticate.\n * @return {!goog.Promise<!Object>} A Promise that resolves when\n *     idToken UID match succeeds and returns the server response.\n */\nfireauth.AuthCredential.prototype.matchIdTokenWithUid;\n\n\n/**\n * @return {!Object} The plain object representation of an Auth credential. This\n *     will be exposed as toJSON() externally.\n */\nfireauth.AuthCredential.prototype.toPlainObject;\n\n\n/**\n * @param {!goog.Promise<!Object>} idTokenResolver A promise that resolves with\n *     the ID token response.\n * @param {string} uid The UID to match in the token response.\n * @return {!goog.Promise<!Object>} A promise that resolves with the same\n *     response if the UID matches.\n */\nfireauth.AuthCredential.verifyTokenResponseUid =\n    function(idTokenResolver, uid) {\n  return idTokenResolver.then(function(response) {\n    // This should not happen as rpcHandler verifyAssertion and verifyPassword\n    // always guarantee an ID token is available.\n    if (response[fireauth.RpcHandler.AuthServerField.ID_TOKEN]) {\n      // Parse the token object.\n      var parsedIdToken = fireauth.IdToken.parse(\n          response[fireauth.RpcHandler.AuthServerField.ID_TOKEN]);\n      // Confirm token localId matches the provided UID. If not, throw the user\n      // mismatch error.\n      if (!parsedIdToken || uid != parsedIdToken.getLocalId()) {\n        throw new fireauth.AuthError(fireauth.authenum.Error.USER_MISMATCH);\n      }\n      return response;\n    }\n    throw new fireauth.AuthError(fireauth.authenum.Error.USER_MISMATCH);\n  })\n  .thenCatch(function(error) {\n    // Translate auth/user-not-found error directly to auth/user-mismatch.\n    throw fireauth.AuthError.translateError(\n        error,\n        fireauth.authenum.Error.USER_DELETED,\n        fireauth.authenum.Error.USER_MISMATCH);\n  });\n};\n\n\n\n/**\n * The interface that represents the Auth provider.\n * @interface\n */\nfireauth.AuthProvider = function() {};\n\n\n/**\n * @param {...*} var_args The credential data.\n * @return {!fireauth.AuthCredential} The Auth provider credential.\n */\nfireauth.AuthProvider.credential;\n\n\n/**\n * @typedef {{\n *   accessToken: (?string|undefined),\n *   idToken: (?string|undefined),\n *   nonce: (?string|undefined),\n *   oauthToken: (?string|undefined),\n *   oauthTokenSecret: (?string|undefined),\n *   pendingToken: (?string|undefined)\n * }}\n */\nfireauth.OAuthResponse;\n\n\n/**\n * The SAML Auth credential class. The Constructor is not publicly visible.\n * This is constructed by the SDK on successful or failure after SAML sign-in\n * and returned to developer.\n * @param {!fireauth.idp.ProviderId} providerId The provider ID.\n * @param {string} pendingToken The SAML response pending token.\n * @constructor\n * @implements {fireauth.AuthCredential}\n */\nfireauth.SAMLAuthCredential = function(providerId, pendingToken) {\n  if (pendingToken) {\n    /** @private {string} The pending token where SAML response is encrypted. */\n    this.pendingToken_ = pendingToken;\n  } else {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR,\n        'failed to construct a credential');\n  }\n\n  fireauth.object.setReadonlyProperty(this, 'providerId', providerId);\n  fireauth.object.setReadonlyProperty(this, 'signInMethod', providerId);\n};\n\n\n/**\n * Returns a promise to retrieve ID token using the underlying RPC handler API\n * for the current credential.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @return {!goog.Promise<!Object, !fireauth.AuthError>}\n *     idTokenPromise The RPC handler method that returns a promise which\n *     resolves with an ID token.\n * @override\n */\nfireauth.SAMLAuthCredential.prototype.getIdTokenProvider =\n    function(rpcHandler) {\n  return rpcHandler.verifyAssertion(\n      /** @type {!fireauth.RpcHandler.VerifyAssertionData} */ (\n      this.makeVerifyAssertionRequest_()));\n};\n\n\n/**\n * Links the credential to an existing account, identified by an ID token.\n * @param {!fireauth.RpcHandler} rpcHandler The rpc handler.\n * @param {string} idToken The ID token of the existing account.\n * @return {!goog.Promise<!Object>} A Promise that resolves when the accounts\n *     are linked, returning the backend response.\n * @override\n */\nfireauth.SAMLAuthCredential.prototype.linkToIdToken =\n    function(rpcHandler, idToken) {\n  var request = this.makeVerifyAssertionRequest_();\n  request['idToken'] = idToken;\n  return rpcHandler.verifyAssertionForLinking(\n      /** @type {!fireauth.RpcHandler.VerifyAssertionData} */ (request));\n};\n\n\n/**\n * Tries to match the credential's idToken with the provided UID.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @param {string} uid The UID of the user to reauthenticate.\n * @return {!goog.Promise<!Object>} A Promise that resolves when\n *     idToken UID match succeeds and returns the server response.\n * @override\n */\nfireauth.SAMLAuthCredential.prototype.matchIdTokenWithUid =\n    function(rpcHandler, uid) {\n  var request = this.makeVerifyAssertionRequest_();\n  // Do not create a new account if the user doesn't exist.\n  return fireauth.AuthCredential.verifyTokenResponseUid(\n      rpcHandler.verifyAssertionForExisting(\n          /** @type {!fireauth.RpcHandler.VerifyAssertionData} */ (request)),\n      uid);\n};\n\n\n/**\n * @return {!Object} A request to the VerifyAssertion endpoint, populated with\n *     the assertion data from this credential.\n * @private\n */\nfireauth.SAMLAuthCredential.prototype.makeVerifyAssertionRequest_ =\n    function() {\n  return {\n    'pendingToken': this.pendingToken_,\n    // Always use http://localhost.\n    'requestUri': 'http://localhost'\n  };\n};\n\n\n/**\n * @return {!Object} The plain object representation of an Auth credential.\n * @override\n */\nfireauth.SAMLAuthCredential.prototype.toPlainObject = function() {\n  return {\n    'providerId': this['providerId'],\n    'signInMethod': this['signInMethod'],\n    'pendingToken': this.pendingToken_\n  };\n};\n\n\n/**\n * @param {?Object|undefined} json The plain object representation of a\n *     SAMLAuthCredential.\n * @return {?fireauth.SAMLAuthCredential} The SAML credential if the object\n *     is a JSON representation of a SAMLAuthCredential, null otherwise.\n */\nfireauth.SAMLAuthCredential.fromJSON = function(json) {\n  if (json &&\n      json['providerId'] &&\n      json['signInMethod'] &&\n      json['providerId'].indexOf(fireauth.constants.SAML_PREFIX) == 0 &&\n      json['pendingToken']) {\n    try {\n      return new fireauth.SAMLAuthCredential(\n          json['providerId'], json['pendingToken']);\n    } catch (e) {\n      return null;\n    }\n  }\n  return null;\n};\n\n\n/**\n * The OAuth credential class.\n * @param {!fireauth.idp.ProviderId} providerId The provider ID.\n * @param {!fireauth.OAuthResponse} oauthResponse The OAuth\n *     response object containing token information.\n * @param {!fireauth.idp.SignInMethod} signInMethod The sign in method.\n * @constructor\n * @implements {fireauth.AuthCredential}\n */\nfireauth.OAuthCredential = function(providerId, oauthResponse, signInMethod) {\n  /**\n   * @private {?string} The pending token where the IdP response is encrypted.\n   */\n  this.pendingToken_ = null;\n  if (oauthResponse['idToken'] || oauthResponse['accessToken']) {\n    // OAuth 2 and either ID token or access token.\n    if (oauthResponse['idToken']) {\n      fireauth.object.setReadonlyProperty(\n          this, 'idToken', oauthResponse['idToken']);\n    }\n    if (oauthResponse['accessToken']) {\n      fireauth.object.setReadonlyProperty(\n          this, 'accessToken', oauthResponse['accessToken']);\n    }\n    // Add nonce if available and no pendingToken is present.\n    if (oauthResponse['nonce'] && !oauthResponse['pendingToken']) {\n      fireauth.object.setReadonlyProperty(\n          this, 'nonce', oauthResponse['nonce']);\n    }\n    if (oauthResponse['pendingToken']) {\n      this.pendingToken_ = oauthResponse['pendingToken'];\n    }\n  } else if (oauthResponse['oauthToken'] &&\n             oauthResponse['oauthTokenSecret'])  {\n    // OAuth 1 and OAuth token with OAuth token secret.\n    fireauth.object.setReadonlyProperty(\n        this, 'accessToken', oauthResponse['oauthToken']);\n    fireauth.object.setReadonlyProperty(\n        this, 'secret', oauthResponse['oauthTokenSecret']);\n  } else {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR,\n        'failed to construct a credential');\n  }\n\n  fireauth.object.setReadonlyProperty(this, 'providerId', providerId);\n  fireauth.object.setReadonlyProperty(this, 'signInMethod', signInMethod);\n};\n\n\n/**\n * Returns a promise to retrieve ID token using the underlying RPC handler API\n * for the current credential.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @return {!goog.Promise<!Object, !fireauth.AuthError>}\n *     idTokenPromise The RPC handler method that returns a promise which\n *     resolves with an ID token.\n * @override\n */\nfireauth.OAuthCredential.prototype.getIdTokenProvider = function(rpcHandler) {\n  return rpcHandler.verifyAssertion(\n      /** @type {!fireauth.RpcHandler.VerifyAssertionData} */ (\n      this.makeVerifyAssertionRequest_()));\n};\n\n\n/**\n * Links the credential to an existing account, identified by an ID token.\n * @param {!fireauth.RpcHandler} rpcHandler The rpc handler.\n * @param {string} idToken The ID token of the existing account.\n * @return {!goog.Promise<!Object>} A Promise that resolves when the accounts\n *     are linked, returning the backend response.\n * @override\n */\nfireauth.OAuthCredential.prototype.linkToIdToken =\n    function(rpcHandler, idToken) {\n  var request = this.makeVerifyAssertionRequest_();\n  request['idToken'] = idToken;\n  return rpcHandler.verifyAssertionForLinking(\n      /** @type {!fireauth.RpcHandler.VerifyAssertionData} */ (request));\n};\n\n\n/**\n * Tries to match the credential's idToken with the provided UID.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @param {string} uid The UID of the user to reauthenticate.\n * @return {!goog.Promise<!Object>} A Promise that resolves when\n *     idToken UID match succeeds and returns the server response.\n * @override\n */\nfireauth.OAuthCredential.prototype.matchIdTokenWithUid =\n    function(rpcHandler, uid) {\n  var request = this.makeVerifyAssertionRequest_();\n  // Do not create a new account if the user doesn't exist.\n  return fireauth.AuthCredential.verifyTokenResponseUid(\n      rpcHandler.verifyAssertionForExisting(\n          /** @type {!fireauth.RpcHandler.VerifyAssertionData} */ (request)),\n      uid);\n};\n\n\n/**\n * @return {!Object} A request to the VerifyAssertion endpoint, populated with\n *     the OAuth data from this credential.\n * @private\n */\nfireauth.OAuthCredential.prototype.makeVerifyAssertionRequest_ = function() {\n  var postBody = {};\n  if (this['idToken']) {\n    postBody['id_token'] = this['idToken'];\n  }\n  if (this['accessToken']) {\n    postBody['access_token'] = this['accessToken'];\n  }\n  if (this['secret']) {\n    postBody['oauth_token_secret'] = this['secret'];\n  }\n  postBody['providerId'] = this['providerId'];\n  // Pass nonce in postBody if available.\n  if (this['nonce'] && !this.pendingToken_) {\n    postBody['nonce'] = this['nonce'];\n  }\n  var request = {\n    'postBody': goog.Uri.QueryData.createFromMap(postBody).toString(),\n    // Always use http://localhost.\n    'requestUri': 'http://localhost'\n  };\n  if (this.pendingToken_) {\n    // For pendingToken, just pass it through and drop postBody.\n    delete request['postBody'];\n    request['pendingToken'] = this.pendingToken_;\n  }\n  return request;\n};\n\n\n/**\n * @return {!Object} The plain object representation of an Auth credential.\n * @override\n */\nfireauth.OAuthCredential.prototype.toPlainObject = function() {\n  var obj = {\n    'providerId': this['providerId'],\n    'signInMethod': this['signInMethod']\n  };\n  if (this['idToken']) {\n    obj['oauthIdToken'] = this['idToken'];\n  }\n  if (this['accessToken']) {\n    obj['oauthAccessToken'] = this['accessToken'];\n  }\n  if (this['secret']) {\n    obj['oauthTokenSecret'] = this['secret'];\n  }\n  if (this['nonce']) {\n    obj['nonce'] = this['nonce'];\n  }\n  if (this.pendingToken_) {\n    obj['pendingToken'] = this.pendingToken_;\n  }\n  return obj;\n};\n\n\n/**\n * @param {?Object|undefined} json The plain object representation of an\n *     OAuthCredential.\n * @return {?fireauth.OAuthCredential} The OAuth/OIDC credential if the object\n *     is a JSON representation of an OAuthCredential, null otherwise.\n */\nfireauth.OAuthCredential.fromJSON = function(json) {\n  if (json &&\n      json['providerId'] &&\n      json['signInMethod']) {\n    // Convert to OAuthResponse format.\n    var oauthResponse = {\n      // OIDC && google.com.\n      'idToken': json['oauthIdToken'],\n      // OAuth 2.0 providers.\n      'accessToken': json['oauthTokenSecret'] ? null : json['oauthAccessToken'],\n      // OAuth 1.0 provider, eg. Twitter.\n      'oauthTokenSecret': json['oauthTokenSecret'],\n      'oauthToken': json['oauthTokenSecret'] && json['oauthAccessToken'],\n      'nonce': json['nonce'],\n      'pendingToken': json['pendingToken']\n    };\n    try {\n      // Constructor will validate the OAuthResponse.\n      return new fireauth.OAuthCredential(\n          json['providerId'], oauthResponse, json['signInMethod']);\n    } catch (e) {\n      return null;\n    }\n  }\n  return null;\n};\n\n\n/**\n * A generic OAuth provider (OAuth1 or OAuth2).\n * @param {string} providerId The IdP provider ID (e.g. google.com,\n *     facebook.com) registered with the backend.\n * @param {?Array<string>=} opt_reservedParams The backlist of parameters that\n *     cannot be set through setCustomParameters.\n * @constructor\n */\nfireauth.FederatedProvider = function(providerId, opt_reservedParams) {\n  /** @private {!Array<string>} */\n  this.reservedParams_ = opt_reservedParams || [];\n\n  // Set read only instance providerId property.\n  // Set read only instance isOAuthProvider property.\n  fireauth.object.setReadonlyProperties(this, {\n    'providerId': providerId,\n    'isOAuthProvider': true\n  });\n\n  /** @private {!Object} The OAuth custom parameters for current provider. */\n  this.customParameters_ = {};\n  /** @protected {?string} The custom OAuth language parameter. */\n  this.languageParameter =\n      (fireauth.idp.getIdpSettings(/** @type {!fireauth.idp.ProviderId} */ (\n          providerId)) || {}).languageParam || null;\n  /** @protected {?string} The default language. */\n  this.defaultLanguageCode = null;\n};\n\n/**\n * @param {!Object} customParameters The custom OAuth parameters to pass\n *     in OAuth request.\n * @return {!fireauth.FederatedProvider} The FederatedProvider instance, for\n *     chaining method calls.\n */\nfireauth.FederatedProvider.prototype.setCustomParameters =\n    function(customParameters) {\n  this.customParameters_ = goog.object.clone(customParameters);\n  return this;\n};\n\n\n/**\n * Set the default language code on the provider instance.\n * @param {?string} languageCode The default language code to set if not already\n *     provided in the custom parameters.\n */\nfireauth.FederatedProvider.prototype.setDefaultLanguage =\n    function(languageCode) {\n  this.defaultLanguageCode = languageCode;\n};\n\n\n/**\n * @return {!Object} The custom OAuth parameters to pass in OAuth request.\n */\nfireauth.FederatedProvider.prototype.getCustomParameters = function() {\n  // The backend already checks for these values and makes sure no reserved\n  // fields like client ID, redirect URI, state are overwritten by these\n  // fields.\n  var params =\n      fireauth.util.copyWithoutNullsOrUndefined(this.customParameters_);\n  // Convert to strings.\n  for (var key in params) {\n    params[key] = params[key].toString();\n  }\n  // Remove blacklisted OAuth custom parameters.\n  var customParams =\n      fireauth.util.removeEntriesWithKeys(params, this.reservedParams_);\n  // If language param supported and not already provided, use default language.\n  if (this.languageParameter &&\n      this.defaultLanguageCode &&\n      !customParams[this.languageParameter]) {\n    customParams[this.languageParameter] = this.defaultLanguageCode;\n  }\n  return customParams;\n};\n\n\n/**\n * Generic SAML auth provider.\n * @param {string} providerId The SAML IdP provider ID (e.g. saml.saml2rp)\n *     registered with the backend.\n * @constructor\n * @extends {fireauth.FederatedProvider}\n * @implements {fireauth.AuthProvider}\n */\nfireauth.SAMLAuthProvider = function(providerId) {\n  // SAML provider IDs must be prefixed with the SAML_PREFIX.\n  if (!fireauth.idp.isSaml(providerId)) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR,\n        'SAML provider IDs must be prefixed with \"' +\n        fireauth.constants.SAML_PREFIX + '\"');\n  }\n  // isOAuthProvider is true even though this is not an OAuth provider.\n  // This can be confusing as this is a SAML provider. However, this property\n  // is needed to allow signInWithPopup/Redirect. We should rename it to\n  // something more accurate: isFederatedProvider.\n  fireauth.SAMLAuthProvider.base(this, 'constructor', providerId, []);\n};\ngoog.inherits(fireauth.SAMLAuthProvider, fireauth.FederatedProvider);\n\n\n/**\n * Generic OAuth2 Auth provider.\n * @param {string} providerId The IdP provider ID (e.g. google.com,\n *     facebook.com) registered with the backend.\n * @constructor\n * @extends {fireauth.FederatedProvider}\n * @implements {fireauth.AuthProvider}\n */\nfireauth.OAuthProvider = function(providerId) {\n  fireauth.OAuthProvider.base(this, 'constructor', providerId,\n      fireauth.idp.RESERVED_OAUTH2_PARAMS);\n\n  /** @private {!Array<string>} The list of OAuth2 scopes to request. */\n  this.scopes_ = [];\n};\ngoog.inherits(fireauth.OAuthProvider, fireauth.FederatedProvider);\n\n\n/**\n * @param {string} scope The OAuth scope to request.\n * @return {!fireauth.OAuthProvider} The OAuthProvider instance, for chaining\n *     method calls.\n */\nfireauth.OAuthProvider.prototype.addScope = function(scope) {\n  // If not already added, add scope to list.\n  if (!goog.array.contains(this.scopes_, scope)) {\n    this.scopes_.push(scope);\n  }\n  return this;\n};\n\n\n/** @return {!Array<string>} The Auth provider's list of scopes. */\nfireauth.OAuthProvider.prototype.getScopes = function() {\n  return goog.array.clone(this.scopes_);\n};\n\n\n/**\n * Initializes an OAuth AuthCredential. At least one of ID token or access token\n * must be defined. When providing an OIDC ID token with a nonce encoded, the\n * raw nonce must also be provided.\n * @param {?Object|string} optionsOrIdToken Either the options object containing\n *     the ID token, access token and raw nonce or the ID token string.\n * @param {?string=} opt_accessToken The optional OAuth access token.\n * @return {!fireauth.AuthCredential} The Auth credential object.\n */\nfireauth.OAuthProvider.prototype.credential =\n    function(optionsOrIdToken, opt_accessToken) {\n  var oauthResponse;\n  if (goog.isObject(optionsOrIdToken)) {\n    oauthResponse = {\n      'idToken': optionsOrIdToken['idToken'] || null,\n      'accessToken': optionsOrIdToken['accessToken'] || null,\n      'nonce': optionsOrIdToken['rawNonce'] || null\n    };\n  } else {\n    oauthResponse = {\n      'idToken': optionsOrIdToken || null,\n      'accessToken': opt_accessToken || null\n    };\n  }\n  if (!oauthResponse['idToken'] && !oauthResponse['accessToken']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.ARGUMENT_ERROR,\n        'credential failed: must provide the ID token and/or the access ' +\n        'token.');\n  }\n  // For OAuthCredential, sign in method is same as providerId.\n  return new fireauth.OAuthCredential(this['providerId'],\n                                      oauthResponse,\n                                      this['providerId']);\n};\n\n\n/**\n * Facebook Auth provider.\n * @constructor\n * @extends {fireauth.OAuthProvider}\n * @implements {fireauth.AuthProvider}\n */\nfireauth.FacebookAuthProvider = function() {\n  fireauth.FacebookAuthProvider.base(this, 'constructor',\n      fireauth.idp.ProviderId.FACEBOOK);\n};\ngoog.inherits(fireauth.FacebookAuthProvider, fireauth.OAuthProvider);\n\nfireauth.object.setReadonlyProperty(fireauth.FacebookAuthProvider,\n    'PROVIDER_ID', fireauth.idp.ProviderId.FACEBOOK);\n\nfireauth.object.setReadonlyProperty(fireauth.FacebookAuthProvider,\n    'FACEBOOK_SIGN_IN_METHOD', fireauth.idp.SignInMethod.FACEBOOK);\n\n\n/**\n * Initializes a Facebook AuthCredential.\n * @param {string} accessTokenOrObject The Facebook access token, or object\n *     containing the token for FirebaseUI backwards compatibility.\n * @return {!fireauth.AuthCredential} The Auth credential object.\n * @override\n */\nfireauth.FacebookAuthProvider.credential = function(accessTokenOrObject) {\n  if (!accessTokenOrObject) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.ARGUMENT_ERROR,\n        'credential failed: expected 1 argument (the OAuth access token).');\n  }\n  var accessToken = accessTokenOrObject;\n  if (goog.isObject(accessTokenOrObject)) {\n    accessToken = accessTokenOrObject['accessToken'];\n  }\n  return new fireauth.FacebookAuthProvider().credential({\n    'accessToken': /** @type {string} */ (accessToken)\n  });\n};\n\n\n/**\n * GitHub Auth provider.\n * @constructor\n * @extends {fireauth.OAuthProvider}\n * @implements {fireauth.AuthProvider}\n */\nfireauth.GithubAuthProvider = function() {\n  fireauth.GithubAuthProvider.base(this, 'constructor',\n      fireauth.idp.ProviderId.GITHUB);\n};\ngoog.inherits(fireauth.GithubAuthProvider, fireauth.OAuthProvider);\n\nfireauth.object.setReadonlyProperty(fireauth.GithubAuthProvider,\n    'PROVIDER_ID', fireauth.idp.ProviderId.GITHUB);\n\nfireauth.object.setReadonlyProperty(fireauth.GithubAuthProvider,\n    'GITHUB_SIGN_IN_METHOD', fireauth.idp.SignInMethod.GITHUB);\n\n\n/**\n * Initializes a GitHub AuthCredential.\n * @param {string} accessTokenOrObject The GitHub access token, or object\n *     containing the token for FirebaseUI backwards compatibility.\n * @return {!fireauth.AuthCredential} The Auth credential object.\n * @override\n */\nfireauth.GithubAuthProvider.credential = function(accessTokenOrObject) {\n  if (!accessTokenOrObject) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.ARGUMENT_ERROR,\n        'credential failed: expected 1 argument (the OAuth access token).');\n  }\n  var accessToken = accessTokenOrObject;\n  if (goog.isObject(accessTokenOrObject)) {\n    accessToken = accessTokenOrObject['accessToken'];\n  }\n  return new fireauth.GithubAuthProvider().credential({\n    'accessToken': /** @type {string} */ (accessToken)\n  });\n};\n\n\n/**\n * Google Auth provider.\n * @constructor\n * @extends {fireauth.OAuthProvider}\n * @implements {fireauth.AuthProvider}\n */\nfireauth.GoogleAuthProvider = function() {\n  fireauth.GoogleAuthProvider.base(this, 'constructor',\n      fireauth.idp.ProviderId.GOOGLE);\n\n  // Add profile scope to Google Auth provider as default scope.\n  // This is to ensure profile info is populated in current user.\n  this.addScope('profile');\n};\ngoog.inherits(fireauth.GoogleAuthProvider, fireauth.OAuthProvider);\n\nfireauth.object.setReadonlyProperty(fireauth.GoogleAuthProvider,\n    'PROVIDER_ID', fireauth.idp.ProviderId.GOOGLE);\n\nfireauth.object.setReadonlyProperty(fireauth.GoogleAuthProvider,\n    'GOOGLE_SIGN_IN_METHOD', fireauth.idp.SignInMethod.GOOGLE);\n\n\n/**\n * Initializes a Google AuthCredential.\n * @param {?string=} idTokenOrObject The Google ID token. If null or undefined,\n *     we expect the access token to be passed. It can also be an object\n *     containing the tokens for FirebaseUI backwards compatibility.\n * @param {?string=} accessToken The Google access token. If null or\n *     undefined, we expect the ID token to have been passed.\n * @return {!fireauth.AuthCredential} The Auth credential object.\n * @override\n */\nfireauth.GoogleAuthProvider.credential =\n    function(idTokenOrObject, accessToken) {\n  var idToken = idTokenOrObject;\n  if (goog.isObject(idTokenOrObject)) {\n    idToken = idTokenOrObject['idToken'];\n    accessToken = idTokenOrObject['accessToken'];\n  }\n  return new fireauth.GoogleAuthProvider().credential({\n    'idToken':  /** @type {string} */ (idToken),\n    'accessToken': /** @type {string} */ (accessToken)\n  });\n};\n\n\n/**\n * Twitter Auth provider.\n * @constructor\n * @extends {fireauth.FederatedProvider}\n * @implements {fireauth.AuthProvider}\n */\nfireauth.TwitterAuthProvider = function() {\n  fireauth.TwitterAuthProvider.base(this, 'constructor',\n      fireauth.idp.ProviderId.TWITTER,\n      fireauth.idp.RESERVED_OAUTH1_PARAMS);\n};\ngoog.inherits(fireauth.TwitterAuthProvider, fireauth.FederatedProvider);\n\nfireauth.object.setReadonlyProperty(fireauth.TwitterAuthProvider,\n    'PROVIDER_ID', fireauth.idp.ProviderId.TWITTER);\n\nfireauth.object.setReadonlyProperty(fireauth.TwitterAuthProvider,\n    'TWITTER_SIGN_IN_METHOD', fireauth.idp.SignInMethod.TWITTER);\n\n\n/**\n * Initializes a Twitter AuthCredential.\n * @param {string} tokenOrObject The Twitter access token, or object\n *     containing the token for FirebaseUI backwards compatibility.\n * @param {string} secret The Twitter secret.\n * @return {!fireauth.AuthCredential} The Auth credential object.\n * @override\n */\nfireauth.TwitterAuthProvider.credential = function(tokenOrObject, secret) {\n  var tokenObject = tokenOrObject;\n  if (!goog.isObject(tokenObject)) {\n    tokenObject = {\n      'oauthToken': tokenOrObject,\n      'oauthTokenSecret': secret\n    };\n  }\n\n  if (!tokenObject['oauthToken'] || !tokenObject['oauthTokenSecret']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.ARGUMENT_ERROR,\n        'credential failed: expected 2 arguments (the OAuth access token ' +\n        'and secret).');\n  }\n\n  return new fireauth.OAuthCredential(fireauth.idp.ProviderId.TWITTER,\n      /** @type {!fireauth.OAuthResponse} */ (tokenObject),\n      fireauth.idp.SignInMethod.TWITTER);\n};\n\n\n/**\n * The email and password credential class.\n * @param {string} email The credential email.\n * @param {string} password The credential password.\n * @param {string=} opt_signInMethod The credential sign in method can be either\n *     'password' or 'emailLink'\n * @constructor\n * @implements {fireauth.AuthCredential}\n */\nfireauth.EmailAuthCredential = function(email, password, opt_signInMethod) {\n  this.email_ = email;\n  this.password_ = password;\n  fireauth.object.setReadonlyProperty(this, 'providerId',\n      fireauth.idp.ProviderId.PASSWORD);\n  var signInMethod = opt_signInMethod ===\n      fireauth.EmailAuthProvider['EMAIL_LINK_SIGN_IN_METHOD'] ?\n      fireauth.EmailAuthProvider['EMAIL_LINK_SIGN_IN_METHOD'] :\n      fireauth.EmailAuthProvider['EMAIL_PASSWORD_SIGN_IN_METHOD'];\n  fireauth.object.setReadonlyProperty(this, 'signInMethod', signInMethod);\n};\n\n\n/**\n * Returns a promise to retrieve ID token using the underlying RPC handler API\n * for the current credential.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @return {!goog.Promise<!Object, !fireauth.AuthError>}\n *     idTokenPromise The RPC handler method that returns a promise which\n *     resolves with an ID token.\n * @override\n */\nfireauth.EmailAuthCredential.prototype.getIdTokenProvider =\n    function(rpcHandler) {\n  if (this['signInMethod'] ==\n      fireauth.EmailAuthProvider['EMAIL_LINK_SIGN_IN_METHOD']) {\n    return rpcHandler.emailLinkSignIn(this.email_, this.password_);\n  }\n  return rpcHandler.verifyPassword(this.email_, this.password_);\n};\n\n\n/**\n * Adds an email and password account to an existing account, identified by an\n * ID token.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @param {string} idToken The ID token of the existing account.\n * @return {!goog.Promise<!Object>} A Promise that resolves when the accounts\n *     are linked, returning the backend response.\n * @override\n */\nfireauth.EmailAuthCredential.prototype.linkToIdToken =\n    function(rpcHandler, idToken) {\n  if (this['signInMethod'] ==\n      fireauth.EmailAuthProvider['EMAIL_LINK_SIGN_IN_METHOD']) {\n    return rpcHandler.emailLinkSignInForLinking(\n        idToken, this.email_, this.password_);\n  }\n  return rpcHandler.updateEmailAndPassword(\n      idToken, this.email_, this.password_);\n};\n\n\n/**\n * Tries to match the credential's idToken with the provided UID.\n * @param {!fireauth.RpcHandler} rpcHandler The rpc handler.\n * @param {string} uid The UID of the user to reauthenticate.\n * @return {!goog.Promise<!Object>} A Promise that resolves when\n *     reauthentication succeeds.\n * @override\n */\nfireauth.EmailAuthCredential.prototype.matchIdTokenWithUid =\n    function(rpcHandler, uid) {\n  // Do not create a new account if the user doesn't exist.\n  return fireauth.AuthCredential.verifyTokenResponseUid(\n      // This shouldn't create a new email/password account.\n      this.getIdTokenProvider(rpcHandler),\n      uid);\n};\n\n\n/**\n * @return {!Object} The plain object representation of an Auth credential.\n * @override\n */\nfireauth.EmailAuthCredential.prototype.toPlainObject = function() {\n  return {\n    'email': this.email_,\n    'password': this.password_,\n    'signInMethod': this['signInMethod']\n  };\n};\n\n\n/**\n * @param {?Object|undefined} json The plain object representation of a\n *     EmailAuthCredential.\n * @return {?fireauth.EmailAuthCredential} The email credential if the object\n *     is a JSON representation of an EmailAuthCredential, null otherwise.\n */\nfireauth.EmailAuthCredential.fromJSON = function(json) {\n  if (json && json['email'] && json['password']) {\n    return new fireauth.EmailAuthCredential(\n        json['email'],\n        json['password'],\n        json['signInMethod']);\n  }\n  return null;\n};\n\n\n/**\n * Email password Auth provider implementation.\n * @constructor\n * @implements {fireauth.AuthProvider}\n */\nfireauth.EmailAuthProvider = function() {\n  // Set read-only instance providerId and isOAuthProvider property.\n  fireauth.object.setReadonlyProperties(this, {\n    'providerId': fireauth.idp.ProviderId.PASSWORD,\n    'isOAuthProvider': false\n  });\n};\n\n\n/**\n * Initializes an instance of an email/password Auth credential.\n * @param {string} email The credential email.\n * @param {string} password The credential password.\n * @return {!fireauth.EmailAuthCredential} The Auth credential object.\n * @override\n */\nfireauth.EmailAuthProvider.credential = function(email, password) {\n  return new fireauth.EmailAuthCredential(email, password);\n};\n\n\n/**\n * @param {string} email The credential email.\n * @param {string} emailLink The credential email link.\n * @return {!fireauth.EmailAuthCredential} The Auth credential object.\n */\nfireauth.EmailAuthProvider.credentialWithLink = function(email, emailLink) {\n  var actionCodeUrl = fireauth.EmailAuthProvider\n      .getActionCodeUrlFromSignInEmailLink(emailLink);\n  if (!actionCodeUrl) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR, 'Invalid email link!');\n  }\n  return new fireauth.EmailAuthCredential(email, actionCodeUrl['code'],\n      fireauth.EmailAuthProvider['EMAIL_LINK_SIGN_IN_METHOD']);\n};\n\n\n/**\n * @param {string} emailLink The sign in email link to be validated.\n * @return {?fireauth.ActionCodeURL} The sign in email link action code URL.\n *     Returns null if the email link is invalid.\n */\nfireauth.EmailAuthProvider.getActionCodeUrlFromSignInEmailLink =\n    function(emailLink) {\n  emailLink = fireauth.DynamicLink.parseDeepLink(emailLink);\n  var actionCodeUrl = fireauth.ActionCodeURL.parseLink(emailLink);\n  if (actionCodeUrl && actionCodeUrl['operation'] ===\n      fireauth.ActionCodeInfo.Operation.EMAIL_SIGNIN) {\n    return actionCodeUrl;\n  }\n  return null;\n};\n\n\n// Set read only PROVIDER_ID property.\nfireauth.object.setReadonlyProperties(fireauth.EmailAuthProvider, {\n  'PROVIDER_ID': fireauth.idp.ProviderId.PASSWORD\n});\n\n// Set read only EMAIL_LINK_SIGN_IN_METHOD property.\nfireauth.object.setReadonlyProperties(fireauth.EmailAuthProvider, {\n  'EMAIL_LINK_SIGN_IN_METHOD': fireauth.idp.SignInMethod.EMAIL_LINK\n});\n\n// Set read only EMAIL_PASSWORD_SIGN_IN_METHOD property.\nfireauth.object.setReadonlyProperties(fireauth.EmailAuthProvider, {\n  'EMAIL_PASSWORD_SIGN_IN_METHOD': fireauth.idp.SignInMethod.EMAIL_PASSWORD\n});\n\n\n/**\n * A credential for phone number sign-in.\n * @param {!fireauth.PhoneAuthCredential.Parameters_} params The credential\n *     parameters that prove the user owns the claimed phone number.\n * @constructor\n * @implements {fireauth.AuthCredential}\n */\nfireauth.PhoneAuthCredential = function(params) {\n  // Either verification ID and code, or phone number temporary proof must be\n  // provided.\n  if (!(params.verificationId && params.verificationCode) &&\n      !(params.temporaryProof && params.phoneNumber)) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n\n  /**\n   * The phone Auth parameters that prove ownership of a phone number, either\n   * through completion of a phone verification flow, or by referencing a\n   * previously completed verification flow (\"temporaryProof\").\n   * @private {!fireauth.PhoneAuthCredential.Parameters_}\n   */\n  this.params_ = params;\n\n  fireauth.object.setReadonlyProperty(this, 'providerId',\n      fireauth.idp.ProviderId.PHONE);\n\n  fireauth.object.setReadonlyProperty(\n      this, 'signInMethod', fireauth.idp.SignInMethod.PHONE);\n};\n\n\n/**\n * Parameters that prove ownership of a phone number via a ID \"verificationId\"\n * of a request to send a code to the phone number, with the code\n * \"verificationCode\" that the user received on their phone.\n * @private\n * @typedef {{\n *   verificationId: string,\n *   verificationCode: string\n * }}\n */\nfireauth.PhoneAuthCredential.VerificationParameters_;\n\n\n/**\n * Parameters that prove ownership of a phone number by referencing a previously\n * completed phone Auth flow.\n * @private\n * @typedef {{\n *   temporaryProof: string,\n *   phoneNumber: string\n * }}\n */\nfireauth.PhoneAuthCredential.TemporaryProofParameters_;\n\n\n/**\n * @private\n * @typedef {\n *   !fireauth.PhoneAuthCredential.VerificationParameters_|\n *   !fireauth.PhoneAuthCredential.TemporaryProofParameters_\n * }\n */\nfireauth.PhoneAuthCredential.Parameters_;\n\n\n/**\n * Retrieves an ID token from the backend given the current credential.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @return {!goog.Promise<!Object>} A Promise that resolves with the\n *     backend response.\n * @override\n */\nfireauth.PhoneAuthCredential.prototype.getIdTokenProvider =\n    function(rpcHandler) {\n  return rpcHandler.verifyPhoneNumber(this.makeVerifyPhoneNumberRequest_());\n};\n\n\n/**\n * Adds a phone credential to an existing account identified by an ID token.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @param {string} idToken The ID token of the existing account.\n * @return {!goog.Promise<!Object>} A Promise that resolves when the accounts\n *     are linked, returning the backend response.\n * @override\n */\nfireauth.PhoneAuthCredential.prototype.linkToIdToken =\n    function(rpcHandler, idToken) {\n  var request = this.makeVerifyPhoneNumberRequest_();\n  request['idToken'] = idToken;\n  return rpcHandler.verifyPhoneNumberForLinking(request);\n};\n\n\n/**\n * Tries to match the credential's idToken with the provided UID.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler.\n * @param {string} uid The UID of the user to reauthenticate.\n * @return {!goog.Promise<!Object>} A Promise that resolves when\n *     reauthentication succeeds.\n * @override\n */\nfireauth.PhoneAuthCredential.prototype.matchIdTokenWithUid =\n    function(rpcHandler, uid) {\n  var request = this.makeVerifyPhoneNumberRequest_();\n  return fireauth.AuthCredential.verifyTokenResponseUid(\n      rpcHandler.verifyPhoneNumberForExisting(request),\n      uid);\n};\n\n\n/**\n * Converts a PhoneAuthCredential to a plain object.\n * @return {!Object}\n * @override\n */\nfireauth.PhoneAuthCredential.prototype.toPlainObject = function() {\n  var obj =  {\n    'providerId': fireauth.idp.ProviderId.PHONE\n  };\n  if (this.params_.verificationId) {\n    obj['verificationId'] = this.params_.verificationId;\n  }\n  if (this.params_.verificationCode) {\n    obj['verificationCode'] = this.params_.verificationCode;\n  }\n  if (this.params_.temporaryProof) {\n    obj['temporaryProof'] = this.params_.temporaryProof;\n  }\n  if (this.params_.phoneNumber) {\n    obj['phoneNumber'] = this.params_.phoneNumber;\n  }\n  return obj;\n};\n\n\n/**\n * @param {?Object|undefined} json The plain object representation of a\n *     PhoneAuthCredential.\n * @return {?fireauth.PhoneAuthCredential} The phone credential if the object\n *     is a JSON representation of an PhoneAuthCredential, null otherwise.\n */\nfireauth.PhoneAuthCredential.fromJSON = function(json) {\n  if (json &&\n      json['providerId'] === fireauth.idp.ProviderId.PHONE &&\n      ((json['verificationId'] && json['verificationCode']) ||\n       (json['temporaryProof'] && json['phoneNumber']))) {\n    var params = {};\n    var allowedKeys = [\n      'verificationId', 'verificationCode', 'temporaryProof', 'phoneNumber'\n    ];\n    goog.array.forEach(allowedKeys, function(key) {\n      if (json[key]) {\n        params[key] = json[key];\n      }\n    });\n    return new fireauth.PhoneAuthCredential(\n        /** @type {!fireauth.PhoneAuthCredential.Parameters_} */ (params));\n  }\n  return null;\n};\n\n\n/**\n * @return {!Object} A request to the verifyPhoneNumber endpoint based on the\n *     current state of the object.\n * @private\n */\nfireauth.PhoneAuthCredential.prototype.makeVerifyPhoneNumberRequest_ =\n    function() {\n  if (this.params_.temporaryProof && this.params_.phoneNumber) {\n    return {\n      'temporaryProof': this.params_.temporaryProof,\n      'phoneNumber': this.params_.phoneNumber\n    };\n  }\n\n  return {\n    'sessionInfo': this.params_.verificationId,\n    'code': this.params_.verificationCode\n  };\n};\n\n\n/**\n * Phone Auth provider implementation.\n * @param {?fireauth.Auth=} opt_auth The Firebase Auth instance.\n * @constructor\n * @implements {fireauth.AuthProvider}\n */\nfireauth.PhoneAuthProvider = function(opt_auth) {\n  try {\n    /** @private {!fireauth.Auth} */\n    this.auth_ = opt_auth || firebase['auth']();\n  } catch (e) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.ARGUMENT_ERROR,\n        'Either an instance of firebase.auth.Auth must be passed as an ' +\n        'argument to the firebase.auth.PhoneAuthProvider constructor, or the ' +\n        'default firebase App instance must be initialized via ' +\n        'firebase.initializeApp().');\n  }\n  fireauth.object.setReadonlyProperties(this, {\n    'providerId': fireauth.idp.ProviderId.PHONE,\n    'isOAuthProvider': false\n  });\n};\n\n\n/**\n * Initiates a phone number confirmation flow.\n * @param {string} phoneNumber The user's phone number.\n * @param {!firebase.auth.ApplicationVerifier} applicationVerifier The\n *     application verifier for anti-abuse purposes.\n * @return {!goog.Promise<string>} A Promise that resolves with the\n *     verificationId of the phone number confirmation flow.\n */\nfireauth.PhoneAuthProvider.prototype.verifyPhoneNumber =\n    function(phoneNumber, applicationVerifier) {\n  var rpcHandler = this.auth_.getRpcHandler();\n\n  // Convert the promise into a goog.Promise. If the applicationVerifier throws\n  // an error, just propagate it to the client. Reset the reCAPTCHA widget every\n  // time after sending the token to the server.\n  return goog.Promise.resolve(applicationVerifier['verify']())\n      .then(function(assertion) {\n        if (!goog.isString(assertion)) {\n          throw new fireauth.AuthError(fireauth.authenum.Error.ARGUMENT_ERROR,\n              'An implementation of firebase.auth.ApplicationVerifier' +\n              '.prototype.verify() must return a firebase.Promise ' +\n              'that resolves with a string.');\n        }\n\n        switch (applicationVerifier['type']) {\n          case 'recaptcha':\n            return rpcHandler\n                .sendVerificationCode(\n                    {'phoneNumber': phoneNumber, 'recaptchaToken': assertion})\n                .then(\n                    function(verificationId) {\n                      if (typeof applicationVerifier.reset === 'function') {\n                        applicationVerifier.reset();\n                      }\n                      return verificationId;\n                    },\n                    function(error) {\n                      if (typeof applicationVerifier.reset === 'function') {\n                        applicationVerifier.reset();\n                      }\n                      throw error;\n                    });\n          default:\n            throw new fireauth.AuthError(fireauth.authenum.Error.ARGUMENT_ERROR,\n                'Only firebase.auth.ApplicationVerifiers with ' +\n                'type=\"recaptcha\" are currently supported.');\n        }\n      });\n};\n\n\n/**\n * Creates a PhoneAuthCredential.\n * @param {string} verificationId The ID of the phone number flow, to correlate\n *     this request with a previous call to\n *     PhoneAuthProvider.prototype.verifyPhoneNumber.\n * @param {string} verificationCode The verification code that was sent to the\n *     user's phone.\n * @return {!fireauth.PhoneAuthCredential}\n * @override\n */\nfireauth.PhoneAuthProvider.credential =\n    function(verificationId, verificationCode) {\n  if (!verificationId) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.MISSING_SESSION_INFO);\n  }\n  if (!verificationCode) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.MISSING_CODE);\n  }\n  return new fireauth.PhoneAuthCredential({\n    verificationId: verificationId,\n    verificationCode: verificationCode\n  });\n};\n\n\n// Set read only PROVIDER_ID property.\nfireauth.object.setReadonlyProperties(fireauth.PhoneAuthProvider, {\n  'PROVIDER_ID': fireauth.idp.ProviderId.PHONE\n});\n\n\n// Set read only PHONE_SIGN_IN_METHOD property.\nfireauth.object.setReadonlyProperties(fireauth.PhoneAuthProvider, {\n  'PHONE_SIGN_IN_METHOD': fireauth.idp.SignInMethod.PHONE\n});\n\n\n/**\n * Constructs an Auth credential from a backend response.\n * Note, unlike fromJSON which constructs the AuthCredential from a toJSON()\n * response, this helper constructs the credential from the server response.\n * @param {?Object} response The backend response to build a credential from.\n * @return {?fireauth.AuthCredential} The corresponding AuthCredential.\n */\nfireauth.AuthProvider.getCredentialFromResponse = function(response) {\n  // Handle phone Auth credential responses, as they have a different format\n  // from other backend responses (i.e. no providerId).\n  if (response['temporaryProof'] && response['phoneNumber']) {\n    return new fireauth.PhoneAuthCredential({\n      temporaryProof: response['temporaryProof'],\n      phoneNumber: response['phoneNumber']\n    });\n  }\n\n  // Get all OAuth response parameters from response.\n  var providerId = response && response['providerId'];\n\n  // Email and password is not supported as there is no situation where the\n  // server would return the password to the client.\n  if (!providerId || providerId === fireauth.idp.ProviderId.PASSWORD) {\n    return null;\n  }\n\n  var accessToken = response && response['oauthAccessToken'];\n  var accessTokenSecret = response && response['oauthTokenSecret'];\n  // Note this is not actually returned by the backend. It is introduced in\n  // rpcHandler.\n  var rawNonce = response && response['nonce'];\n  // Google Id Token returned when no additional scopes provided.\n  var idToken = response && response['oauthIdToken'];\n  // Pending token for SAML and OAuth/OIDC providers.\n  var pendingToken = response && response['pendingToken'];\n  try {\n    switch (providerId) {\n      case fireauth.idp.ProviderId.GOOGLE:\n        return fireauth.GoogleAuthProvider.credential(\n            idToken, accessToken);\n\n      case fireauth.idp.ProviderId.FACEBOOK:\n        return fireauth.FacebookAuthProvider.credential(\n            accessToken);\n\n      case fireauth.idp.ProviderId.GITHUB:\n        return fireauth.GithubAuthProvider.credential(\n            accessToken);\n\n      case fireauth.idp.ProviderId.TWITTER:\n        return fireauth.TwitterAuthProvider.credential(\n            accessToken, accessTokenSecret);\n\n      default:\n        if (!accessToken && !accessTokenSecret && !idToken && !pendingToken) {\n          return null;\n        }\n        if (pendingToken) {\n          if (providerId.indexOf(fireauth.constants.SAML_PREFIX) == 0) {\n            return new fireauth.SAMLAuthCredential(providerId, pendingToken);\n          } else {\n            // OIDC and non-default providers excluding Twitter.\n            return new fireauth.OAuthCredential(\n                providerId,\n                {\n                  'pendingToken': pendingToken,\n                  'idToken': response['oauthIdToken'],\n                  'accessToken': response['oauthAccessToken']\n                },\n                providerId);\n          }\n        }\n        return new fireauth.OAuthProvider(providerId).credential({\n          'idToken': idToken,\n          'accessToken': accessToken,\n          'rawNonce': rawNonce\n        });\n    }\n  } catch (e) {\n    return null;\n  }\n};\n\n\n/**\n * Constructs an Auth credential from a JSON representation.\n * Note, unlike getCredentialFromResponse which constructs the AuthCredential\n * from a server response, this helper constructs credential from the toJSON()\n * result.\n * @param {!Object|string} json The JSON representation to construct credential\n *     from.\n * @return {?fireauth.AuthCredential} The corresponding AuthCredential.\n */\nfireauth.AuthProvider.getCredentialFromJSON = function(json) {\n  var obj = goog.isString(json) ? JSON.parse(json) : json;\n  var credential;\n  var fromJSON = [\n    fireauth.OAuthCredential.fromJSON,\n    fireauth.EmailAuthCredential.fromJSON,\n    fireauth.PhoneAuthCredential.fromJSON,\n    fireauth.SAMLAuthCredential.fromJSON\n  ];\n  for (var i = 0; i < fromJSON.length; i++) {\n    credential = fromJSON[i](obj);\n    if (credential) {\n      return credential;\n    }\n  }\n  return null;\n};\n\n\n/**\n * Constructs an Auth credential from a JSON representation.\n * @param {!Object|string} json The JSON representation to construct credential from.\n * @return {?fireauth.AuthCredential} The corresponding AuthCredential.\n */\nfireauth.AuthCredential.fromPlainObject =\n    fireauth.AuthProvider.getCredentialFromJSON;\n\n\n/**\n * Checks if OAuth is supported by provider, if not throws an error.\n * @param {!fireauth.AuthProvider} provider The provider to check.\n */\nfireauth.AuthProvider.checkIfOAuthSupported =\n    function(provider) {\n  if (!provider['isOAuthProvider']) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.INVALID_OAUTH_PROVIDER);\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the Auth event object.\n */\n\ngoog.provide('fireauth.AuthEvent');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\n\n\n/**\n * Defines the authentication event.\n * @param {!fireauth.AuthEvent.Type} type The Auth event type.\n * @param {?string=} opt_eventId The event identifier.\n * @param {?string=} opt_urlResponse The URL with IdP response.\n * @param {?string=} opt_sessionId The session ID used to prevent session\n *     fixation attacks.\n * @param {?fireauth.AuthError=} opt_error The optional error encountered.\n * @param {?string=} opt_postBody The optional POST body.\n * @param {?string=} opt_tenantId The optional tenant ID.\n * @constructor\n */\nfireauth.AuthEvent = function(\n    type, opt_eventId, opt_urlResponse, opt_sessionId, opt_error,\n    opt_postBody, opt_tenantId) {\n  /** @const @private {!fireauth.AuthEvent.Type} The Auth event type. */\n  this.type_ = type;\n  /** @const @private {?string} The Auth event ID. */\n  this.eventId_ = opt_eventId || null;\n  /** @const @private {?string} The callback URL with the sign in response. */\n  this.urlResponse_ = opt_urlResponse || null;\n  /** @const @private {?string} The sign in operation session ID. */\n  this.sessionId_ = opt_sessionId || null;\n  /** @const @private {?string} The POST body string if available. */\n  this.postBody_ = opt_postBody || null;\n  /** @const @private {?string} The tenant ID if available. */\n  this.tenantId_ = opt_tenantId || null;\n  /**\n   * @const @private {?fireauth.AuthError} The Auth event error if available.\n   */\n  this.error_ = opt_error || null;\n  if (!this.urlResponse_ && !this.error_) {\n    // Either URL or error is required. They can't be both null.\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_AUTH_EVENT);\n  } else if (this.urlResponse_ && this.error_) {\n    // An error must not be provided when a URL is available.\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_AUTH_EVENT);\n  } else if (this.urlResponse_ && !this.sessionId_) {\n    // A session ID must accompany a URL response.\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_AUTH_EVENT);\n  }\n};\n\n\n\n/**\n * Auth event operation types.\n * All Auth event types that are used for popup operations should be suffixed\n * with `Popup`, whereas those used for redirect operations should be suffixed\n * with `Redirect`.\n * TODO: consider changing the type from a string to an object with ID\n * and some metadata for determining mode: redirect, popup or none.\n * @enum {string}\n */\nfireauth.AuthEvent.Type = {\n  LINK_VIA_POPUP: 'linkViaPopup',\n  LINK_VIA_REDIRECT: 'linkViaRedirect',\n  REAUTH_VIA_POPUP: 'reauthViaPopup',\n  REAUTH_VIA_REDIRECT: 'reauthViaRedirect',\n  SIGN_IN_VIA_POPUP: 'signInViaPopup',\n  SIGN_IN_VIA_REDIRECT: 'signInViaRedirect',\n  UNKNOWN: 'unknown',\n  VERIFY_APP: 'verifyApp'\n};\n\n\n/**\n * @param {!fireauth.AuthEvent} event The Auth event.\n * @return {boolean} Whether the event is a redirect type.\n */\nfireauth.AuthEvent.isRedirect = function(event) {\n  return !!event.getType().match(/Redirect$/);\n};\n\n\n/**\n * @param {!fireauth.AuthEvent} event The Auth event.\n * @return {boolean} Whether the event is a popup type.\n */\nfireauth.AuthEvent.isPopup = function(event) {\n  return !!event.getType().match(/Popup$/);\n};\n\n\n/** @return {!fireauth.AuthEvent.Type} The type of Auth event. */\nfireauth.AuthEvent.prototype.getType = function() {\n  return this.type_;\n};\n\n\n/** @return {?string} The Auth event identifier. */\nfireauth.AuthEvent.prototype.getEventId = function() {\n  return this.eventId_;\n};\n\n\n/** @return {string} The event unique identifier. */\nfireauth.AuthEvent.prototype.getUid = function() {\n  var components = [];\n  components.push(this.type_);\n  if (this.eventId_) {\n    components.push(this.eventId_);\n  }\n  if (this.sessionId_) {\n    components.push(this.sessionId_);\n  }\n  if (this.tenantId_) {\n    components.push(this.tenantId_);\n  }\n  return components.join('-');\n};\n\n\n/** @return {?string} The url response of Auth event. */\nfireauth.AuthEvent.prototype.getUrlResponse = function() {\n  return this.urlResponse_;\n};\n\n\n/** @return {?string} The session ID Auth event. */\nfireauth.AuthEvent.prototype.getSessionId = function() {\n  return this.sessionId_;\n};\n\n\n/** @return {?string} The POST body of the Auth event, if available. */\nfireauth.AuthEvent.prototype.getPostBody = function() {\n  return this.postBody_;\n};\n\n\n/** @return {?string} The tenant ID of the Auth event, if available. */\nfireauth.AuthEvent.prototype.getTenantId = function() {\n  return this.tenantId_;\n};\n\n\n/** @return {?fireauth.AuthError} The error of Auth event. */\nfireauth.AuthEvent.prototype.getError = function() {\n  return this.error_;\n};\n\n\n/** @return {boolean} Whether Auth event has an error. */\nfireauth.AuthEvent.prototype.hasError = function() {\n  return !!this.error_;\n};\n\n\n/** @return {!Object} The plain object representation of event. */\nfireauth.AuthEvent.prototype.toPlainObject = function() {\n  return {\n    'type': this.type_,\n    'eventId': this.eventId_,\n    'urlResponse': this.urlResponse_,\n    'sessionId': this.sessionId_,\n    'postBody': this.postBody_,\n    'tenantId': this.tenantId_,\n    'error': this.error_ && this.error_.toPlainObject()\n  };\n};\n\n\n/**\n * @param {?Object} rawResponse The plain object representation of Auth event.\n * @return {?fireauth.AuthEvent} The Auth event representation of plain object.\n */\nfireauth.AuthEvent.fromPlainObject = function(rawResponse) {\n  var response = rawResponse || {};\n  if (response['type']) {\n    return new fireauth.AuthEvent(\n        response['type'],\n        response['eventId'],\n        response['urlResponse'],\n        response['sessionId'],\n        response['error'] &&\n            fireauth.AuthError.fromPlainObject(response['error']),\n        response['postBody'],\n        response['tenantId']\n        );\n  }\n  return null;\n};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Provides the universal link subscriber utility to allow\n * multiple subscriptions for incoming universal link detection.\n */\ngoog.provide('fireauth.UniversalLinkSubscriber');\n\ngoog.require('fireauth.util');\ngoog.require('goog.array');\n\n/**\n * Defines the universal link subscriber class used to allow multiple universal\n * link subscriptions since the underlying plugin only works with one.\n * This utility is needed since the universal link cordova plugin can only allow\n * one subscriber and multiple app instances can subscribe to this.\n * @constructor @final @struct\n */\nfireauth.UniversalLinkSubscriber = function() {\n  /**\n   * @private {?function(?Object)} The master callback that subscribes directly\n   *     to universalLinks.\n   */\n  this.masterCb_ = null;\n  /**\n   * @private {!Array<function(?Object)>} The list of external subscribers that\n   *     are triggered every time the master callback is triggered.\n   */\n  this.cb_ = [];\n};\n\n\n/**\n * @return {!fireauth.UniversalLinkSubscriber} The default universal link\n *     subscriber instance.\n */\nfireauth.UniversalLinkSubscriber.getInstance = function() {\n  if (!fireauth.UniversalLinkSubscriber.instance_) {\n    fireauth.UniversalLinkSubscriber.instance_ =\n        new fireauth.UniversalLinkSubscriber();\n  }\n  return fireauth.UniversalLinkSubscriber.instance_;\n};\n\n\n/** Clears singleton instance. Useful for testing. */\nfireauth.UniversalLinkSubscriber.clear = function() {\n  fireauth.UniversalLinkSubscriber.instance_ = null;\n};\n\n\n/**\n * @private {?fireauth.UniversalLinkSubscriber} The singleton universal\n *     link subscriber instance.\n */\nfireauth.UniversalLinkSubscriber.instance_ = null;\n\n\n/**\n * Subscribes a callback to the universal link plugin listener.\n * @param {function(?Object)} cb The callback to subscribe to the universal\n *     link plugin.\n */\nfireauth.UniversalLinkSubscriber.prototype.subscribe  = function(cb) {\n  var self = this;\n  this.cb_.push(cb);\n  if (!this.masterCb_) {\n    this.masterCb_ = function(event) {\n      for (var i = 0; i < self.cb_.length; i++) {\n        self.cb_[i](event);\n      }\n    };\n    var subscribe = fireauth.util.getObjectRef(\n        'universalLinks.subscribe', goog.global);\n    // For iOS environments, this plugin is not used, therefore this is a no-op\n    // and no error needs to be thrown.\n    if (typeof subscribe === 'function') {\n      subscribe(null, this.masterCb_);\n    }\n  }\n};\n\n\n/**\n * Unsubscribes a callback from the universal link plugin listener.\n * @param {function(?Object)} cb The callback to unsubscribe from the universal\n *     link plugin.\n */\nfireauth.UniversalLinkSubscriber.prototype.unsubscribe = function(cb) {\n  goog.array.removeAllIf(this.cb_, function(ele) {\n    return ele == cb;\n  });\n};\n\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Utility for handling RPC requests to server.\n */\ngoog.provide('fireauth.RpcHandler');\ngoog.provide('fireauth.RpcHandler.ApiMethodHandler');\ngoog.provide('fireauth.RpcHandler.VerifyAssertionData');\ngoog.provide('fireauth.XmlHttpFactory');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.AuthErrorWithCredential');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.idp');\ngoog.require('fireauth.idp.ProviderId');\ngoog.require('fireauth.object');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.Uri');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.json');\ngoog.require('goog.net.CorsXmlHttpFactory');\ngoog.require('goog.net.EventType');\ngoog.require('goog.net.FetchXmlHttpFactory');\ngoog.require('goog.net.XhrIo');\ngoog.require('goog.net.XmlHttpFactory');\ngoog.require('goog.net.jsloader');\ngoog.require('goog.object');\ngoog.require('goog.string.Const');\n\n\n\n/**\n * Firebase Auth XmlHttpRequest factory. This is useful for environments like\n * Node.js where XMLHttpRequest does not exist. XmlHttpFactory would be\n * initialized using the polyfill XMLHttpRequest module.\n * @param {function(new:XMLHttpRequest)} xmlHttpRequest The xmlHttpRequest\n *     constructor.\n * @constructor\n * @extends {goog.net.XmlHttpFactory}\n * @final\n */\nfireauth.XmlHttpFactory = function(xmlHttpRequest) {\n  /**\n   * @private {function(new:XMLHttpRequest)} The underlying XHR reference.\n   */\n  this.xmlHttpRequest_ = xmlHttpRequest;\n  fireauth.XmlHttpFactory.base(this, 'constructor');\n};\ngoog.inherits(fireauth.XmlHttpFactory, goog.net.XmlHttpFactory);\n\n\n/**\n * @return {!goog.net.XhrLike|!XMLHttpRequest} A new XhrLike instance.\n * @override\n */\nfireauth.XmlHttpFactory.prototype.createInstance = function() {\n  return new this.xmlHttpRequest_();\n};\n\n\n/**\n * @return {!Object} Options describing how XHR objects obtained from this\n *     factory should be used.\n * @override\n */\nfireauth.XmlHttpFactory.prototype.internalGetOptions = function() {\n  return {};\n};\n\n\n\n/**\n * Creates an RPC request handler for the project specified by the API key.\n *\n * @param {string} apiKey The API key.\n * @param {?Object=} opt_config The RPC request processor configuration.\n * @param {?string=} opt_firebaseClientVersion The optional Firebase client\n *     version to log with requests to Firebase Auth server.\n * @constructor\n */\nfireauth.RpcHandler = function(apiKey, opt_config, opt_firebaseClientVersion) {\n  /** @private {string} The project API key. */\n  this.apiKey_ = apiKey;\n  var config = opt_config || {};\n  this.secureTokenEndpoint_ = config['secureTokenEndpoint'] ||\n      fireauth.RpcHandler.SECURE_TOKEN_ENDPOINT_;\n  /**\n   * @private @const {!fireauth.util.Delay} The delay for secure token endpoint\n   *     network timeout.\n   */\n  this.secureTokenTimeout_ = config['secureTokenTimeout'] ||\n      fireauth.RpcHandler.DEFAULT_SECURE_TOKEN_TIMEOUT_;\n  this.secureTokenHeaders_ = goog.object.clone(\n      config['secureTokenHeaders'] ||\n      fireauth.RpcHandler.DEFAULT_SECURE_TOKEN_HEADERS_);\n  this.firebaseEndpoint_ = config['firebaseEndpoint'] ||\n      fireauth.RpcHandler.FIREBASE_ENDPOINT_;\n  /**\n   * @private @const {!fireauth.util.Delay} The delay for Firebase Auth endpoint\n   *     network timeout.\n   */\n  this.firebaseTimeout_ = config['firebaseTimeout'] ||\n      fireauth.RpcHandler.DEFAULT_FIREBASE_TIMEOUT_;\n  this.firebaseHeaders_ = goog.object.clone(\n      config['firebaseHeaders'] ||\n      fireauth.RpcHandler.DEFAULT_FIREBASE_HEADERS_);\n  // If Firebase client version needs to be logged too.\n  if (opt_firebaseClientVersion) {\n    // Log client version for Firebase Auth server.\n    this.firebaseHeaders_['X-Client-Version'] = opt_firebaseClientVersion;\n    // Log client version for securetoken server.\n    this.secureTokenHeaders_['X-Client-Version'] = opt_firebaseClientVersion;\n  }\n  \n  // Get XMLHttpRequest reference.\n  var XMLHttpRequest = fireauth.RpcHandler.getXMLHttpRequest();\n  if (!XMLHttpRequest && !fireauth.util.isWorker()) {\n    // In a Node.js environment, xmlhttprequest module needs to be required.\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR,\n        'The XMLHttpRequest compatibility library was not found.');\n  }\n  /** @private {!goog.net.XmlHttpFactory|undefined} The XHR factory. */\n  this.rpcHandlerXhrFactory_ = undefined;\n  // Initialize XHR factory. CORS does not apply in native environments or\n  // workers so don't use CorsXmlHttpFactory in those cases.\n  if (fireauth.util.isWorker()) {\n    // For worker environment use FetchXmlHttpFactory.\n    this.rpcHandlerXhrFactory_ = new goog.net.FetchXmlHttpFactory(\n        /** @type {!WorkerGlobalScope} */ (self));\n  } else if (fireauth.util.isNativeEnvironment()) {\n    // For Node.js, this is the polyfill library. For other environments,\n    // this is the native global XMLHttpRequest.\n    this.rpcHandlerXhrFactory_ = new fireauth.XmlHttpFactory(\n        /** @type {function(new:XMLHttpRequest)} */ (XMLHttpRequest));\n  } else {\n    // CORS Browser environment.\n    this.rpcHandlerXhrFactory_ = new goog.net.CorsXmlHttpFactory();\n  }\n  /** @private {?string} The tenant ID. */\n  this.tenantId_ = null;\n};\n\n\n/**\n * @return {?function(new:XMLHttpRequest)|undefined} The current environment\n *     XMLHttpRequest. This is undefined for worker environment.\n */\nfireauth.RpcHandler.getXMLHttpRequest = function() {\n  // In Node.js XMLHttpRequest is polyfilled.\n  var isNode = fireauth.util.getEnvironment() == fireauth.util.Env.NODE;\n  var XMLHttpRequest = goog.global['XMLHttpRequest'] ||\n      (isNode &&\n       firebase.INTERNAL['node'] &&\n       firebase.INTERNAL['node']['XMLHttpRequest']);\n  return XMLHttpRequest;\n};\n\n\n/**\n * Enums for HTTP request methods.\n * @enum {string}\n */\nfireauth.RpcHandler.HttpMethod = {\n  POST: 'POST',\n  GET: 'GET'\n};\n\n\n/**\n * Firebase Auth server error codes.\n * @enum {string}\n */\nfireauth.RpcHandler.ServerError = {\n  ADMIN_ONLY_OPERATION: 'ADMIN_ONLY_OPERATION',\n  CAPTCHA_CHECK_FAILED: 'CAPTCHA_CHECK_FAILED',\n  CORS_UNSUPPORTED: 'CORS_UNSUPPORTED',\n  CREDENTIAL_MISMATCH: 'CREDENTIAL_MISMATCH',\n  CREDENTIAL_TOO_OLD_LOGIN_AGAIN: 'CREDENTIAL_TOO_OLD_LOGIN_AGAIN',\n  DYNAMIC_LINK_NOT_ACTIVATED: 'DYNAMIC_LINK_NOT_ACTIVATED',\n  EMAIL_EXISTS: 'EMAIL_EXISTS',\n  EMAIL_NOT_FOUND: 'EMAIL_NOT_FOUND',\n  EXPIRED_OOB_CODE: 'EXPIRED_OOB_CODE',\n  FEDERATED_USER_ID_ALREADY_LINKED: 'FEDERATED_USER_ID_ALREADY_LINKED',\n  INVALID_APP_CREDENTIAL: 'INVALID_APP_CREDENTIAL',\n  INVALID_APP_ID: 'INVALID_APP_ID',\n  INVALID_CERT_HASH: 'INVALID_CERT_HASH',\n  INVALID_CODE: 'INVALID_CODE',\n  INVALID_CONTINUE_URI: 'INVALID_CONTINUE_URI',\n  INVALID_CUSTOM_TOKEN: 'INVALID_CUSTOM_TOKEN',\n  INVALID_DYNAMIC_LINK_DOMAIN: 'INVALID_DYNAMIC_LINK_DOMAIN',\n  INVALID_EMAIL: 'INVALID_EMAIL',\n  INVALID_ID_TOKEN: 'INVALID_ID_TOKEN',\n  INVALID_IDP_RESPONSE: 'INVALID_IDP_RESPONSE',\n  INVALID_IDENTIFIER: 'INVALID_IDENTIFIER',\n  INVALID_MESSAGE_PAYLOAD: 'INVALID_MESSAGE_PAYLOAD',\n  INVALID_OAUTH_CLIENT_ID: 'INVALID_OAUTH_CLIENT_ID',\n  INVALID_OOB_CODE: 'INVALID_OOB_CODE',\n  INVALID_PASSWORD: 'INVALID_PASSWORD',\n  INVALID_PENDING_TOKEN: 'INVALID_PENDING_TOKEN',\n  INVALID_PHONE_NUMBER: 'INVALID_PHONE_NUMBER',\n  INVALID_PROVIDER_ID: 'INVALID_PROVIDER_ID',\n  INVALID_RECIPIENT_EMAIL: 'INVALID_RECIPIENT_EMAIL',\n  INVALID_SENDER: 'INVALID_SENDER',\n  INVALID_SESSION_INFO: 'INVALID_SESSION_INFO',\n  INVALID_TEMPORARY_PROOF: 'INVALID_TEMPORARY_PROOF',\n  INVALID_TENANT_ID: 'INVALID_TENANT_ID',\n  MISSING_ANDROID_PACKAGE_NAME: 'MISSING_ANDROID_PACKAGE_NAME',\n  MISSING_APP_CREDENTIAL: 'MISSING_APP_CREDENTIAL',\n  MISSING_CODE: 'MISSING_CODE',\n  MISSING_CONTINUE_URI: 'MISSING_CONTINUE_URI',\n  MISSING_CUSTOM_TOKEN: 'MISSING_CUSTOM_TOKEN',\n  MISSING_IOS_BUNDLE_ID: 'MISSING_IOS_BUNDLE_ID',\n  MISSING_OOB_CODE: 'MISSING_OOB_CODE',\n  MISSING_OR_INVALID_NONCE: 'MISSING_OR_INVALID_NONCE',\n  MISSING_PASSWORD: 'MISSING_PASSWORD',\n  MISSING_PHONE_NUMBER: 'MISSING_PHONE_NUMBER',\n  MISSING_SESSION_INFO: 'MISSING_SESSION_INFO',\n  OPERATION_NOT_ALLOWED: 'OPERATION_NOT_ALLOWED',\n  PASSWORD_LOGIN_DISABLED: 'PASSWORD_LOGIN_DISABLED',\n  QUOTA_EXCEEDED: 'QUOTA_EXCEEDED',\n  RESET_PASSWORD_EXCEED_LIMIT: 'RESET_PASSWORD_EXCEED_LIMIT',\n  REJECTED_CREDENTIAL: 'REJECTED_CREDENTIAL',\n  SESSION_EXPIRED: 'SESSION_EXPIRED',\n  TENANT_ID_MISMATCH: 'TENANT_ID_MISMATCH',\n  TOKEN_EXPIRED: 'TOKEN_EXPIRED',\n  TOO_MANY_ATTEMPTS_TRY_LATER: 'TOO_MANY_ATTEMPTS_TRY_LATER',\n  UNSUPPORTED_TENANT_OPERATION: 'UNSUPPORTED_TENANT_OPERATION',\n  UNAUTHORIZED_DOMAIN: 'UNAUTHORIZED_DOMAIN',\n  USER_CANCELLED: 'USER_CANCELLED',\n  USER_DISABLED: 'USER_DISABLED',\n  USER_NOT_FOUND: 'USER_NOT_FOUND',\n  WEAK_PASSWORD: 'WEAK_PASSWORD'\n};\n\n\n/**\n * A map of server error codes to client errors.\n * @typedef {!Object<\n *     !fireauth.RpcHandler.ServerError, !fireauth.authenum.Error>}\n */\nfireauth.RpcHandler.ServerErrorMap;\n\n\n/**\n * Firebase Auth response field names.\n * @enum {string}\n */\nfireauth.RpcHandler.AuthServerField = {\n  ALL_PROVIDERS: 'allProviders',\n  AUTH_URI: 'authUri',\n  AUTHORIZED_DOMAINS: 'authorizedDomains',\n  DYNAMIC_LINKS_DOMAIN: 'dynamicLinksDomain',\n  EMAIL: 'email',\n  ERROR_MESSAGE: 'errorMessage',\n  EXPIRES_IN: 'expiresIn',\n  ID_TOKEN: 'idToken',\n  NEED_CONFIRMATION: 'needConfirmation',\n  OAUTH_ID_TOKEN: 'oauthIdToken',\n  PENDING_TOKEN: 'pendingToken',\n  POST_BODY: 'postBody',\n  PROVIDER_ID: 'providerId',\n  RECAPTCHA_SITE_KEY: 'recaptchaSiteKey',\n  REQUEST_URI: 'requestUri',\n  REFRESH_TOKEN: 'refreshToken',\n  SESSION_ID: 'sessionId',\n  SESSION_INFO: 'sessionInfo',\n  SIGNIN_METHODS: 'signinMethods',\n  TEMPORARY_PROOF: 'temporaryProof'\n};\n\n\n/**\n * Firebase Auth response injected fields.\n * @enum {string}\n */\nfireauth.RpcHandler.InjectedResponseField = {\n  NONCE: 'nonce'\n};\n\n\n/**\n * Firebase Auth getOobConfirmationCode requestType possible values.\n * @enum {string}\n */\nfireauth.RpcHandler.GetOobCodeRequestType = {\n  EMAIL_SIGNIN: 'EMAIL_SIGNIN',\n  NEW_EMAIL_ACCEPT: 'NEW_EMAIL_ACCEPT',\n  PASSWORD_RESET: 'PASSWORD_RESET',\n  VERIFY_EMAIL: 'VERIFY_EMAIL'\n};\n\n\n/**\n * Firebase Auth response field names.\n * @enum {string}\n */\nfireauth.RpcHandler.StsServerField = {\n  ACCESS_TOKEN: 'access_token',\n  EXPIRES_IN: 'expires_in',\n  REFRESH_TOKEN: 'refresh_token'\n};\n\n\n/**\n * @return {string} The API key.\n */\nfireauth.RpcHandler.prototype.getApiKey = function() {\n  return this.apiKey_;\n};\n\n\n/**\n * The Firebase custom locale header.\n * @const {string}\n * @private\n */\nfireauth.RpcHandler.FIREBASE_LOCALE_KEY_ = 'X-Firebase-Locale';\n\n\n/**\n * The secure token endpoint.\n * @const {string}\n * @private\n */\nfireauth.RpcHandler.SECURE_TOKEN_ENDPOINT_ =\n    'https://securetoken.googleapis.com/v1/token';\n\n\n/**\n * The default timeout delay (units in milliseconds) for requests sending to\n *     STS token endpoint.\n * @const {!fireauth.util.Delay}\n * @private\n */\nfireauth.RpcHandler.DEFAULT_SECURE_TOKEN_TIMEOUT_ =\n    new fireauth.util.Delay(30000, 60000);\n\n\n/**\n * The STS token RPC content headers.\n * @const {!Object}\n * @private\n */\nfireauth.RpcHandler.DEFAULT_SECURE_TOKEN_HEADERS_ = {\n  'Content-Type': 'application/x-www-form-urlencoded'\n};\n\n\n/**\n * The Firebase endpoint.\n * @const {string}\n * @private\n */\nfireauth.RpcHandler.FIREBASE_ENDPOINT_ =\n    'https://www.googleapis.com/identitytoolkit/v3/relyingparty/';\n\n\n/**\n * The default timeout delay (units in milliseconds) for requests sending to\n *     Firebase endpoint.\n * @const {!fireauth.util.Delay}\n * @private\n */\nfireauth.RpcHandler.DEFAULT_FIREBASE_TIMEOUT_ =\n    new fireauth.util.Delay(30000, 60000);\n\n\n/**\n * The Firebase RPC content headers.\n * @const {!Object}\n * @private\n */\nfireauth.RpcHandler.DEFAULT_FIREBASE_HEADERS_ = {\n  'Content-Type': 'application/json'\n};\n\n\n/**\n * Updates the custom locale header.\n * @param {?string} languageCode The new languageCode.\n */\nfireauth.RpcHandler.prototype.updateCustomLocaleHeader =\n    function(languageCode) {\n  if (languageCode) {\n    // If a language code is provided, add it to the header.\n    this.firebaseHeaders_[fireauth.RpcHandler.FIREBASE_LOCALE_KEY_] =\n        languageCode;\n  } else {\n    // Otherwise remove the custom locale header.\n    delete this.firebaseHeaders_[fireauth.RpcHandler.FIREBASE_LOCALE_KEY_];\n  }\n};\n\n\n/**\n * Updates the X-Client-Version in the header.\n * @param {?string} clientVersion The new client version.\n */\nfireauth.RpcHandler.prototype.updateClientVersion = function(clientVersion) {\n  if (clientVersion) {\n    // Update client version for Firebase Auth server.\n    this.firebaseHeaders_['X-Client-Version'] = clientVersion;\n    // Update client version for securetoken server.\n    this.secureTokenHeaders_['X-Client-Version'] = clientVersion;\n  } else {\n    // Remove client version from header.\n    delete this.firebaseHeaders_['X-Client-Version'];\n    delete this.secureTokenHeaders_['X-Client-Version'];\n  }\n};\n\n\n/**\n * Updates the tenant ID in the request.\n * @param {?string} tenantId The new tenant ID.\n */\nfireauth.RpcHandler.prototype.updateTenantId = function(tenantId) {\n  this.tenantId_ = tenantId;\n};\n\n\n/**\n * Returns the tenant ID.\n * @return {?string} The tenant ID.\n */\nfireauth.RpcHandler.prototype.getTenantId = function() {\n  return this.tenantId_;\n};\n\n\n/**\n * Sends XhrIo request using goog.net.XhrIo.\n * @param {string} url The URL to make a request to.\n * @param {function(?Object)=} opt_callback The callback to run on completion.\n * @param {fireauth.RpcHandler.HttpMethod=} opt_httpMethod The HTTP send method.\n * @param {?ArrayBuffer|?ArrayBufferView|?Blob|?Document|?FormData|string=}\n *     opt_data The request content.\n * @param {?Object=} opt_headers The request content headers.\n * @param {number=} opt_timeout The request timeout.\n * @private\n */\nfireauth.RpcHandler.prototype.sendXhr_ = function(\n    url,\n    opt_callback,\n    opt_httpMethod,\n    opt_data,\n    opt_headers,\n    opt_timeout) {\n  var sendXhr;\n  if (fireauth.util.supportsCors() || fireauth.util.isWorker()) {\n    // If supports CORS use goog.net.XhrIo.\n    sendXhr = goog.bind(this.sendXhrUsingXhrIo_, this);\n  } else {\n    // Load gapi.client.request and gapi.auth dependency dynamically.\n    if (!fireauth.RpcHandler.loadGApi_) {\n      fireauth.RpcHandler.loadGApi_ =\n          new goog.Promise(function(resolve, reject) {\n            // On load, resolve.\n            fireauth.RpcHandler.loadGApiJs_(resolve, reject);\n          });\n    }\n    // If does not support CORS, use gapi.client.request.\n    sendXhr = goog.bind(this.sendXhrUsingGApiClient_, this);\n  }\n  sendXhr(\n      url, opt_callback, opt_httpMethod, opt_data, opt_headers, opt_timeout);\n};\n\n\n/**\n * Sends XhrIo request using goog.net.XhrIo.\n * @param {string} url The URL to make a request to.\n * @param {function(?Object)=} opt_callback The callback to run on completion.\n * @param {fireauth.RpcHandler.HttpMethod=} opt_httpMethod The HTTP send method.\n * @param {?ArrayBuffer|?ArrayBufferView|?Blob|?Document|?FormData|string=}\n *     opt_data The request content.\n * @param {?Object=} opt_headers The request content headers.\n * @param {number=} opt_timeout The request timeout.\n * @private\n */\nfireauth.RpcHandler.prototype.sendXhrUsingXhrIo_ = function(\n    url,\n    opt_callback,\n    opt_httpMethod,\n    opt_data,\n    opt_headers,\n    opt_timeout) {\n  if (fireauth.util.isWorker() && !fireauth.util.isFetchSupported()) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.OPERATION_NOT_SUPPORTED,\n        'fetch, Headers and Request native APIs or equivalent Polyfills ' +\n        'must be available to support HTTP requests from a Worker ' +\n        'environment.');\n  }\n  var xhrIo = new goog.net.XhrIo(this.rpcHandlerXhrFactory_);\n\n  // xhrIo.setTimeoutInterval not working in IE10 and IE11, handle manually.\n  var requestTimeout;\n  if (opt_timeout) {\n    xhrIo.setTimeoutInterval(opt_timeout);\n    requestTimeout = setTimeout(function() {\n      xhrIo.dispatchEvent(goog.net.EventType.TIMEOUT);\n    }, opt_timeout);\n  }\n  // Run callback function on completion.\n  xhrIo.listen(\n      goog.net.EventType.COMPLETE,\n      /** @this {goog.net.XhrIo} */\n      function() {\n        // Clear timeout timer.\n        if (requestTimeout) {\n          clearTimeout(requestTimeout);\n        }\n        // Response assumed to be in json format. If not, catch, log error and\n        // pass null to callback.\n        var response = null;\n        try {\n          // Do not use this.responseJson() as it uses goog.json.parse\n          // underneath. Internal goog.json.parse parsing uses eval and since\n          // recommended Content Security Policy does not allow unsafe-eval,\n          // this is failing and throwing an error in chrome extensions and\n          // warnings else where. Use native parsing instead via JSON.parse.\n          response = JSON.parse(this.getResponseText()) || null;\n        } catch (e) {\n          response = null;\n        }\n        if (opt_callback) {\n          opt_callback(/** @type {?Object} */ (response));\n        }\n      });\n  // Dispose xhrIo on ready.\n  xhrIo.listenOnce(\n      goog.net.EventType.READY,\n      /** @this {goog.net.XhrIo} */\n      function() {\n        // Clear timeout timer.\n        if (requestTimeout) {\n          clearTimeout(requestTimeout);\n        }\n        // Dispose xhrIo.\n        this.dispose();\n      });\n  // Listen to timeout error.\n  // This should work when request is aborted too.\n  xhrIo.listenOnce(\n      goog.net.EventType.TIMEOUT,\n      /** @this {goog.net.XhrIo} */\n      function() {\n        // Clear timeout timer.\n        if (requestTimeout) {\n          clearTimeout(requestTimeout);\n        }\n        // Dispose xhrIo.\n        this.dispose();\n        // The request timed out.\n        if (opt_callback) {\n          opt_callback(null);\n        }\n      });\n  xhrIo.send(url, opt_httpMethod, opt_data, opt_headers);\n};\n\n\n/**\n * @const {!goog.string.Const} The GApi client library URL.\n * @private\n */\nfireauth.RpcHandler.GAPI_SRC_ = goog.string.Const.from(\n    'https://apis.google.com/js/client.js?onload=%{onload}');\n\n\n/**\n * @const {string}\n * @private\n */\nfireauth.RpcHandler.GAPI_CALLBACK_NAME_ =\n    '__fcb' + Math.floor(Math.random() * 1000000).toString();\n\n\n/**\n * Loads the GApi client library if it is not loaded.\n * @param {function()} callback The callback to invoke once it's loaded.\n * @param {function(?Object)} errback The error callback.\n * @private\n */\nfireauth.RpcHandler.loadGApiJs_ = function(callback, errback) {\n  // If gapi.client.request not available, load it dynamically.\n  if (!((window['gapi'] || {})['client'] || {})['request']) {\n    goog.global[fireauth.RpcHandler.GAPI_CALLBACK_NAME_] = function() {\n      // Callback will be called by GApi, test properly loaded here instead of\n      // after jsloader resolves.\n      if (!((window['gapi'] || {})['client'] || {})['request']) {\n        errback(new Error(fireauth.RpcHandler.ServerError.CORS_UNSUPPORTED));\n      } else {\n        callback();\n      }\n    };\n    var url = goog.html.TrustedResourceUrl.format(\n        fireauth.RpcHandler.GAPI_SRC_,\n        {'onload': fireauth.RpcHandler.GAPI_CALLBACK_NAME_});\n    // TODO: replace goog.net.jsloader with our own script includer.\n    var result = goog.net.jsloader.safeLoad(url);\n    result.addErrback(function() {\n      // In case file fails to load.\n      errback(new Error(fireauth.RpcHandler.ServerError.CORS_UNSUPPORTED));\n    });\n  } else {\n    callback();\n  }\n};\n\n\n/**\n * Sends XhrIo request using gapi.client.\n * @param {string} url The URL to make a request to.\n * @param {function(?Object)=} opt_callback The callback to run on completion.\n * @param {fireauth.RpcHandler.HttpMethod=} opt_httpMethod The HTTP send method.\n * @param {?ArrayBuffer|?ArrayBufferView|?Blob|?Document|?FormData|string=}\n *     opt_data The request content.\n * @param {?Object=} opt_headers The request content headers.\n * @param {number=} opt_timeout The request timeout.\n * @private\n */\nfireauth.RpcHandler.prototype.sendXhrUsingGApiClient_ = function(\n    url,\n    opt_callback,\n    opt_httpMethod,\n    opt_data,\n    opt_headers,\n    opt_timeout) {\n  var self = this;\n  // Wait for GApi dependency to load.\n  fireauth.RpcHandler.loadGApi_.then(function() {\n    window['gapi']['client']['setApiKey'](self.getApiKey());\n    // GApi maintains the Auth result and automatically append the Auth token to\n    // all outgoing requests. Firebase Auth requests will be rejected if there\n    // are others scopes (e.g. google plus) for the Auth token. Need to empty\n    // the token before call gitkit api. Restored in callback.\n    var oauth2Token = window['gapi']['auth']['getToken']();\n    window['gapi']['auth']['setToken'](null);\n    window['gapi']['client']['request']({\n      'path': url,\n      'method': opt_httpMethod,\n      'body': opt_data,\n      'headers': opt_headers,\n      // This needs to be set to none, otherwise the access token will be passed\n      // in the header field causing apiary to complain.\n      'authType': 'none',\n      'callback': function(response) {\n        window['gapi']['auth']['setToken'](oauth2Token);\n        if (opt_callback) {\n          opt_callback(response);\n        }\n      }\n    });\n  }).thenCatch(function(error) {\n    // Catches failure to support CORS and propagates it.\n    if (opt_callback) {\n      // Simulate backend server error to be caught by upper layer.\n      opt_callback({\n        'error': {\n          'message': (error && error['message']) ||\n              fireauth.RpcHandler.ServerError.CORS_UNSUPPORTED\n        }\n      });\n    }\n  });\n};\n\n\n/**\n * Validates the request for the STS access token.\n *\n * @param {?Object} data The STS token request body.\n * @return {boolean} Whether the request is valid.\n * @private\n */\nfireauth.RpcHandler.prototype.validateStsTokenRequest_ = function(data) {\n  if (data['grant_type'] == 'refresh_token' && data['refresh_token']) {\n    // Exchange refresh token.\n    return true;\n  } else if (data['grant_type'] == 'authorization_code' && data['code']) {\n    // Exchange ID token.\n    return true;\n  } else {\n    // Invalid.\n    return false;\n  }\n};\n\n\n/**\n * Handles the request for the STS access token.\n *\n * @param {!Object} data The STS token request body.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.requestStsToken = function(data) {\n  var self = this;\n  return new goog.Promise(function(resolve, reject) {\n    if (self.validateStsTokenRequest_(data)) {\n      self.sendXhr_(\n          self.secureTokenEndpoint_ + '?key=' +\n          encodeURIComponent(self.getApiKey()),\n          function(response) {\n            if (!response) {\n              // An unparseable response from the XHR most likely indicates some\n              // problem with the network.\n              reject(new fireauth.AuthError(\n                  fireauth.authenum.Error.NETWORK_REQUEST_FAILED));\n            } else if (fireauth.RpcHandler.hasError_(response)) {\n              reject(fireauth.RpcHandler.getDeveloperError_(response));\n            } else if (\n                !response[fireauth.RpcHandler.StsServerField.ACCESS_TOKEN] ||\n                !response[fireauth.RpcHandler.StsServerField.REFRESH_TOKEN]) {\n              reject(new fireauth.AuthError(\n                  fireauth.authenum.Error.INTERNAL_ERROR));\n            } else {\n              resolve(response);\n            }\n          },\n          fireauth.RpcHandler.HttpMethod.POST,\n          goog.Uri.QueryData.createFromMap(data).toString(),\n          self.secureTokenHeaders_,\n          self.secureTokenTimeout_.get());\n    } else {\n      reject(new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR));\n    }\n  });\n};\n\n\n/**\n * @param {!Object} data The object to serialize.\n * @return {string} The serialized object with null, undefined and empty string\n *     values removed.\n * @private\n */\nfireauth.RpcHandler.serialize_ = function(data) {\n  // goog.json.serialize converts undefined values to null.\n  // This helper removes all empty strings, nulls and undefined from serialized\n  // object.\n  // Serialize trimmed data.\n  return goog.json.serialize(fireauth.util.copyWithoutNullsOrUndefined(data));\n};\n\n\n/**\n * Creates and executes a request for the given API method.\n * @param {string} method The API method.\n * @param {!fireauth.RpcHandler.HttpMethod} httpMethod The http request method.\n * @param {!Object} data The data for the API request. In the case of a GET\n *     request, the contents of this object will be form encoded and appended\n *     to the query string of the URL. No post body is sent in that case. If an\n *     object value is specified, it will be converted to a string:\n *     encodeURIComponent(String(value)).\n * @param {?fireauth.RpcHandler.ServerErrorMap=} opt_customErrorMap A map\n *     of server error codes to client errors to override default error\n *     handling.\n * @param {boolean=} opt_cachebuster Whether to append a unique string to\n *     request to force backend to return an uncached response to request.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.requestFirebaseEndpoint = function(\n    method, httpMethod, data, opt_customErrorMap, opt_cachebuster) {\n  var self = this;\n  // Construct endpoint URL.\n  var uri = goog.Uri.parse(this.firebaseEndpoint_ + method);\n  uri.setParameterValue('key', this.getApiKey());\n  // Check whether to append cachebuster to request.\n  if (opt_cachebuster) {\n    uri.setParameterValue('cb', goog.now().toString());\n  }\n  // Firebase allows GET endpoints.\n  var isGet = httpMethod == fireauth.RpcHandler.HttpMethod.GET;\n  if (isGet) {\n    // For GET HTTP method, append data to query string.\n    for (var key in data) {\n      if (data.hasOwnProperty(key)) {\n        uri.setParameterValue(key, data[key]);\n      }\n    }\n  }\n  return new goog.Promise(function(resolve, reject) {\n    self.sendXhr_(\n        uri.toString(),\n        function(response) {\n          if (!response) {\n            // An unparseable response from the XHR most likely indicates some\n            // problem with the network.\n            reject(new fireauth.AuthError(\n                fireauth.authenum.Error.NETWORK_REQUEST_FAILED));\n          } else if (fireauth.RpcHandler.hasError_(response)) {\n            reject(fireauth.RpcHandler.getDeveloperError_(response,\n                opt_customErrorMap || {}));\n          } else {\n            resolve(response);\n          }\n        },\n        httpMethod,\n        // No post body data in GET requests.\n        isGet ? undefined : fireauth.RpcHandler.serialize_(data),\n        self.firebaseHeaders_,\n        self.firebaseTimeout_.get());\n  });\n};\n\n\n/**\n * Verifies that the request has a valid email set.\n * @param {!Object} request\n * @private\n */\nfireauth.RpcHandler.validateRequestHasEmail_ = function(request) {\n  if (!fireauth.util.isValidEmailAddress(request['email'])) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_EMAIL);\n  }\n};\n\n\n/**\n * Verifies that the response has a valid email set.\n * @param {!Object} response\n * @private\n */\nfireauth.RpcHandler.validateResponseHasEmail_ = function(response) {\n  if (!fireauth.util.isValidEmailAddress(response['email'])) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Verifies that the an email is valid, if it is there.\n * @param {!Object} request\n * @private\n */\nfireauth.RpcHandler.validateEmailIfPresent_ = function(request) {\n  if ('email' in request) {\n    fireauth.RpcHandler.validateRequestHasEmail_(request);\n  }\n};\n\n\n/**\n * @param {string} providerId The provider ID.\n * @param {?Array<string>=} opt_additionalScopes The list of scope strings.\n * @return {?string} The IDP and its comma separated scope strings serialized.\n * @private\n */\nfireauth.RpcHandler.getAdditionalScopes_ =\n    function(providerId, opt_additionalScopes) {\n  var scopes = {};\n  if (opt_additionalScopes && opt_additionalScopes.length) {\n    scopes[providerId] = opt_additionalScopes.join(',');\n    // Return stringified scopes.\n    return goog.json.serialize(scopes);\n  }\n  return null;\n};\n\n\n/**\n * Validates a response from getAuthUri.\n * @param {?Object} response The getAuthUri response data.\n * @private\n */\nfireauth.RpcHandler.validateGetAuthResponse_ = function(response) {\n  if (!response[fireauth.RpcHandler.AuthServerField.AUTH_URI]) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR,\n        'Unable to determine the authorization endpoint for the specified '+\n        'provider. This may be an issue in the provider configuration.');\n  } else if ( !response[fireauth.RpcHandler.AuthServerField.SESSION_ID]) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Requests createAuthUri endpoint to retrieve the authUri and session ID for\n * the start of an OAuth handshake.\n * @param {string} providerId The provider ID.\n * @param {string} continueUri The IdP callback URL.\n * @param {?Object=} opt_customParameters The optional OAuth custom parameters\n *     plain object.\n * @param {?Array<string>=} opt_additionalScopes The list of scope strings.\n * @param {?string=} opt_email The optional email.\n * @param {?string=} opt_sessionId The optional session ID.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.getAuthUri = function(\n    providerId,\n    continueUri,\n    opt_customParameters,\n    opt_additionalScopes,\n    opt_email,\n    opt_sessionId) {\n  // SAML provider request is constructed differently than OAuth requests.\n  var isSaml = fireauth.idp.isSaml(providerId);\n  var request = {\n    'identifier': opt_email,\n    'providerId': providerId,\n    'continueUri': continueUri,\n    'customParameter': opt_customParameters || {},\n    'oauthScope': fireauth.RpcHandler.getAdditionalScopes_(\n        providerId, opt_additionalScopes),\n    'sessionId': opt_sessionId\n  };\n  // Custom parameters and OAuth scopes should be ignored.\n  if (isSaml) {\n    delete request['customParameter'];\n    delete request['oauthScope'];\n  }\n  // When sessionId is provided, mobile flow (Cordova) is being used, force\n  // code flow and not implicit flow. All other providers use code flow by\n  // default.\n  if (opt_sessionId && providerId == fireauth.idp.ProviderId.GOOGLE) {\n    request['authFlowType'] = 'CODE_FLOW';\n  }\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.GET_AUTH_URI,\n      request);\n};\n\n\n/**\n * Gets the list of IDPs that can be used to log in for the given identifier.\n * @param {string} identifier The identifier, such as an email address.\n * @return {!goog.Promise<!Array<string>>}\n */\nfireauth.RpcHandler.prototype.fetchProvidersForIdentifier =\n    function(identifier) {\n  // createAuthUri returns an error if continue URI is not http or https.\n  // For environments like Cordova, Chrome extensions, native frameworks, file\n  // systems, etc, use http://localhost as continue URL.\n  var continueUri = fireauth.util.isHttpOrHttps() ?\n      fireauth.util.getCurrentUrl() : 'http://localhost';\n  var request = {\n    'identifier': identifier,\n    'continueUri': continueUri\n  };\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.CREATE_AUTH_URI, request)\n      .then(function(response) {\n        return response[fireauth.RpcHandler.AuthServerField.ALL_PROVIDERS] ||\n            [];\n      });\n};\n\n\n/**\n * Returns the list of sign in methods for the given identifier.\n * @param {string} identifier The identifier, such as an email address.\n * @return {!goog.Promise<!Array<string>>}\n */\nfireauth.RpcHandler.prototype.fetchSignInMethodsForIdentifier = function(\n    identifier) {\n  // createAuthUri returns an error if continue URI is not http or https.\n  // For environments like Cordova, Chrome extensions, native frameworks, file\n  // systems, etc, use http://localhost as continue URL.\n  var continueUri = fireauth.util.isHttpOrHttps() ?\n      fireauth.util.getCurrentUrl() :\n      'http://localhost';\n  var request = {\n    'identifier': identifier,\n    'continueUri': continueUri\n  };\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.CREATE_AUTH_URI, request)\n      .then(function(response) {\n        return response[fireauth.RpcHandler.AuthServerField.SIGNIN_METHODS] ||\n            [];\n      });\n};\n\n\n/**\n * Gets the list of authorized domains for the specified project.\n * @return {!goog.Promise<!Array<string>>}\n */\nfireauth.RpcHandler.prototype.getAuthorizedDomains = function() {\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.GET_PROJECT_CONFIG, {})\n      .then(function(response) {\n        return response[\n           fireauth.RpcHandler.AuthServerField.AUTHORIZED_DOMAINS] || [];\n      });\n};\n\n\n/**\n * Gets the reCAPTCHA parameters needed to render the project's provisioned\n * reCAPTCHA.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.getRecaptchaParam = function() {\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.GET_RECAPTCHA_PARAM, {});\n};\n\n\n/**\n * Gets the list of authorized domains for the specified project.\n * @return {!goog.Promise<string>}\n */\nfireauth.RpcHandler.prototype.getDynamicLinkDomain = function() {\n  var request = {\n    'returnDynamicLink': true\n  };\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.RETURN_DYNAMIC_LINK, request);\n};\n\n\n/**\n * Checks if the provided iOS bundle ID belongs to the project as specified by\n * the API key.\n * @param {string} iosBundleId  The iOS bundle ID to check.\n * @return {!goog.Promise<void>}\n */\nfireauth.RpcHandler.prototype.isIosBundleIdValid = function(iosBundleId) {\n  var request = {\n    'iosBundleId': iosBundleId\n  };\n  // This will either resolve if the identifier is valid or throw INVALID_APP_ID\n  // if not.\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.GET_PROJECT_CONFIG, request)\n      .then(function(result) {\n        // Do not return anything.\n      });\n};\n\n\n/**\n * Checks if the provided Android package name belongs to the project as\n * specified by the API key.\n * @param {string} androidPackageName  The iOS bundle ID to check.\n * @param {?string=} opt_sha1Cert The optional SHA-1 Android cert to check.\n * @return {!goog.Promise<void>}\n */\nfireauth.RpcHandler.prototype.isAndroidPackageNameValid =\n    function(androidPackageName, opt_sha1Cert) {\n  var request = {\n    'androidPackageName': androidPackageName\n  };\n  // This is relevant for the native Android SDK flow.\n  // This will redirect to an FDL domain owned by GMScore instead of\n  // the developer's FDL domain as is done for Cordova apps.\n  if (!!opt_sha1Cert) {\n    request['sha1Cert'] = opt_sha1Cert;\n  }\n  // When no sha1Cert is passed, this will either resolve if the identifier is\n  // valid or throw INVALID_APP_ID if not.\n  // When sha1Cert is also passed, this will either resolve or fail with an\n  // INVALID_CERT_HASH error.\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.GET_PROJECT_CONFIG, request)\n      .then(function(result) {\n        // Do not return anything.\n      });\n};\n\n\n/**\n * Checks if the provided OAuth client ID belongs to the project as specified by\n * the API key.\n * @param {string} clientId The OAuth client ID to check.\n * @return {!goog.Promise<void>}\n */\nfireauth.RpcHandler.prototype.isOAuthClientIdValid = function(clientId) {\n  var request = {\n    'clientId': clientId\n  };\n  // This will either resolve if the client ID is valid or throw\n  // INVALID_OAUTH_CLIENT_ID if not.\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.GET_PROJECT_CONFIG, request)\n      .then(function(result) {\n        // Do not return anything.\n      });\n};\n\n\n/**\n * Requests getAccountInfo endpoint using an ID token.\n * @param {string} idToken The ID token.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.getAccountInfoByIdToken = function(idToken) {\n  var request = {'idToken': idToken};\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.GET_ACCOUNT_INFO,\n      request);\n};\n\n\n/**\n * Validates a request to sign in with email and password.\n * @param {!Object} request\n * @private\n */\nfireauth.RpcHandler.validateVerifyCustomTokenRequest_ = function(request) {\n  if (!request['token']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_CUSTOM_TOKEN);\n  }\n};\n\n\n/**\n * Verifies a custom token and returns a Promise that resolves with the ID\n * token.\n * @param {string} token The custom token.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.verifyCustomToken = function(token) {\n  var request = {'token': token};\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.VERIFY_CUSTOM_TOKEN,\n      request);\n};\n\n\n/**\n * Validates a request to sign in with email and password.\n * @param {!Object} request\n * @private\n */\nfireauth.RpcHandler.validateVerifyPasswordRequest_ = function(request) {\n  fireauth.RpcHandler.validateRequestHasEmail_(request);\n  if (!request['password']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_PASSWORD);\n  }\n};\n\n\n/**\n * Verifies a password and returns a Promise that resolves with the ID\n * token.\n * @param {string} email The email address.\n * @param {string} password The entered password.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.verifyPassword = function(email, password) {\n  var request = {\n    'email': email,\n    'password': password\n  };\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.VERIFY_PASSWORD,\n      request);\n};\n\n\n/**\n * Verifies an email link OTP for sign-in and returns a Promise that resolves\n * with the ID token.\n * @param {string} email The email address.\n * @param {string} oobCode The email action OTP.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.emailLinkSignIn = function(email, oobCode) {\n  var request = {\n    'email': email,\n    'oobCode': oobCode\n  };\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.EMAIL_LINK_SIGNIN, request);\n};\n\n\n/**\n * Verifies an email link OTP for linking and returns a Promise that resolves\n * with the ID token.\n * @param {string} idToken The ID token.\n * @param {string} email The email address.\n * @param {string} oobCode The email action OTP.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.emailLinkSignInForLinking =\n    function(idToken, email, oobCode) {\n  var request = {\n    'idToken': idToken,\n    'email': email,\n    'oobCode': oobCode\n  };\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.EMAIL_LINK_SIGNIN_FOR_LINKING,\n      request);\n};\n\n\n/**\n * Validates a response that should contain an ID token.\n * @param {?Object} response The server response data.\n * @private\n */\nfireauth.RpcHandler.validateIdTokenResponse_ = function(response) {\n  if (!response[fireauth.RpcHandler.AuthServerField.ID_TOKEN]) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Validates a getRecaptchaParam response.\n * @param {?Object} response The server response data.\n * @private\n */\nfireauth.RpcHandler.validateGetRecaptchaParamResponse_ = function(response) {\n  // Both are required. This could change though.\n  if (!response[fireauth.RpcHandler.AuthServerField.RECAPTCHA_SITE_KEY]) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Validates a request that sends the verification ID and code for a sign in/up\n * phone Auth flow.\n * @param {!Object} request The server request object.\n * @private\n */\nfireauth.RpcHandler.validateVerifyPhoneNumberRequest_ = function(request) {\n  // There are 2 cases here:\n  // case 1: sessionInfo and code\n  // case 2: phoneNumber and temporaryProof\n  if (request['phoneNumber'] || request['temporaryProof']) {\n    // Case 2. Both phoneNumber and temporaryProof should be set.\n    if (!request['phoneNumber'] || !request['temporaryProof']) {\n      throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n    }\n  } else {\n    // Otherwise it's case 1, so we expect sessionInfo and code.\n    if (!request['sessionInfo']) {\n      throw new fireauth.AuthError(\n          fireauth.authenum.Error.MISSING_SESSION_INFO);\n    }\n    if (!request['code']) {\n      throw new fireauth.AuthError(fireauth.authenum.Error.MISSING_CODE);\n    }\n  }\n};\n\n\n/**\n * Validates a request that sends the verification ID and code for a link/update\n * phone Auth flow.\n * @param {!Object} request The server request object.\n * @private\n */\nfireauth.RpcHandler.validateVerifyPhoneNumberLinkRequest_ = function(request) {\n  // idToken should be required here.\n  if (!request['idToken']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n  // The other request parameters match the sign in flow.\n  fireauth.RpcHandler.validateVerifyPhoneNumberRequest_(request);\n};\n\n\n/**\n * Validates a request to create an email and password account.\n * @param {!Object} request\n * @private\n */\nfireauth.RpcHandler.validateCreateAccountRequest_ = function(request) {\n  fireauth.RpcHandler.validateRequestHasEmail_(request);\n  if (!request['password']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.WEAK_PASSWORD);\n  }\n};\n\n\n/**\n * Validates a request to createAuthUri.\n * @param {!Object} request\n * @private\n */\nfireauth.RpcHandler.validateGetAuthUriRequest_ = function(request) {\n  if (!request['continueUri']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.MISSING_CONTINUE_URI);\n  }\n  // Either a SAML or non SAML providerId must be provided.\n  if (!request['providerId']) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.INTERNAL_ERROR,\n        'A provider ID must be provided in the request.');\n  }\n};\n\n\n/**\n * Creates an email/password account. Returns a Promise that resolves with the\n * ID token.\n * @param {string} email The email address of the account.\n * @param {string} password The password.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.createAccount = function(email, password) {\n  var request = {\n    'email': email,\n    'password': password\n  };\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.CREATE_ACCOUNT,\n      request);\n};\n\n\n/**\n * Signs in a user as anonymous. Returns a Promise that resolves with the\n * ID token.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.signInAnonymously = function() {\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.SIGN_IN_ANONYMOUSLY, {});\n};\n\n\n/**\n * Deletes the user's account corresponding to the idToken given.\n * @param {string} idToken The idToken of the user.\n * @return {!goog.Promise<undefined>}\n */\nfireauth.RpcHandler.prototype.deleteAccount = function(idToken) {\n  var request = {\n    'idToken': idToken\n  };\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.DELETE_ACCOUNT,\n      request);\n};\n\n\n/**\n * Requests setAccountInfo endpoint for updateEmail operation.\n * @param {string} idToken The ID token.\n * @param {string} newEmail The new email.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.updateEmail = function(idToken, newEmail) {\n  var request = {\n    'idToken': idToken,\n    'email': newEmail\n  };\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.SET_ACCOUNT_INFO,\n      request);\n};\n\n\n/**\n * Validates a setAccountInfo request that updates the password.\n * @param {!Object} request\n * @private\n */\nfireauth.RpcHandler.validateSetAccountInfoSensitive_ = function(request) {\n  fireauth.RpcHandler.validateEmailIfPresent_(request);\n  if (!request['password']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.WEAK_PASSWORD);\n  }\n};\n\n\n/**\n * Requests setAccountInfo endpoint for updatePassword operation.\n * @param {string} idToken The ID token.\n * @param {string} newPassword The new password.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.updatePassword = function(idToken, newPassword) {\n  var request = {\n    'idToken': idToken,\n    'password': newPassword\n  };\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.SET_ACCOUNT_INFO_SENSITIVE, request);\n};\n\n\n/**\n * Requests setAccountInfo endpoint to set the email and password. This can be\n * used to link an existing account to a new email and password account.\n * @param {string} idToken The ID token.\n * @param {string} newEmail The new email.\n * @param {string} newPassword The new password.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.updateEmailAndPassword = function(idToken,\n    newEmail, newPassword) {\n  var request = {\n    'idToken': idToken,\n    'email': newEmail,\n    'password': newPassword\n  };\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.SET_ACCOUNT_INFO_SENSITIVE, request);\n};\n\n\n/**\n * Maps the name of a field in the account info object to the backend enum\n * value, for deletion of profile fields.\n * @private {!Object<string, string>}\n */\nfireauth.RpcHandler.PROFILE_FIELD_TO_ENUM_NAME_ = {\n  'displayName': 'DISPLAY_NAME',\n  'photoUrl': 'PHOTO_URL'\n};\n\n\n/**\n * Updates the profile of the user. When resolved, promise returns a response\n * similar to that of getAccountInfo.\n * @param {string} idToken The ID token of the user whose profile is changing.\n * @param {!Object} profileData The new profile data.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.updateProfile = function(idToken, profileData) {\n  var data = {\n    'idToken': idToken\n  };\n  var fieldsToDelete = [];\n\n  // Copy over the relevant fields from profileData, or explicitly flag a field\n  // for deletion if null is passed as the value. Note that this currently only\n  // checks profileData to the first level.\n  goog.object.forEach(fireauth.RpcHandler.PROFILE_FIELD_TO_ENUM_NAME_,\n      function(enumName, fieldName) {\n        var fieldValue = profileData[fieldName];\n        if (fieldValue === null) {\n          // If null is explicitly provided, delete the field.\n          fieldsToDelete.push(enumName);\n        } else if (fieldName in profileData) {\n          // If the field is explicitly set, send it to the backend.\n          data[fieldName] = fieldValue;\n        }\n      });\n  if (fieldsToDelete.length) {\n    data['deleteAttribute'] = fieldsToDelete;\n  }\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.SET_ACCOUNT_INFO, data);\n};\n\n\n/**\n * Validates a request for an email action code for password reset.\n * @param {!Object} request The getOobCode request data for password reset.\n * @private\n */\nfireauth.RpcHandler.validateOobCodeRequest_ = function(request) {\n  if (request['requestType'] !=\n          fireauth.RpcHandler.GetOobCodeRequestType.PASSWORD_RESET) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n  fireauth.RpcHandler.validateRequestHasEmail_(request);\n};\n\n\n/**\n * Validates a request for an email action for passwordless email sign-in.\n * @param {!Object} request The getOobCode request data for email sign-in.\n * @private\n */\nfireauth.RpcHandler.validateEmailSignInCodeRequest_ = function(request) {\n  if (request['requestType'] !=\n      fireauth.RpcHandler.GetOobCodeRequestType.EMAIL_SIGNIN) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n  fireauth.RpcHandler.validateRequestHasEmail_(request);\n};\n\n\n/**\n * Validates a request for an email action for email verification.\n * @param {!Object} request The getOobCode request data for email verification.\n * @private\n */\nfireauth.RpcHandler.validateEmailVerificationCodeRequest_ = function(request) {\n  if (request['requestType'] !=\n          fireauth.RpcHandler.GetOobCodeRequestType.VERIFY_EMAIL) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Requests getOobCode endpoint for password reset, returns promise that\n * resolves with user's email.\n * @param {string} email The email account with the password to be reset.\n * @param {!Object} additionalRequestData Additional data to add to the request.\n * @return {!goog.Promise<string>}\n */\nfireauth.RpcHandler.prototype.sendPasswordResetEmail =\n    function(email, additionalRequestData) {\n  var request = {\n    'requestType': fireauth.RpcHandler.GetOobCodeRequestType.PASSWORD_RESET,\n    'email': email\n  };\n  // Extend the original request with the additional data.\n  goog.object.extend(request, additionalRequestData);\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.GET_OOB_CODE, request);\n};\n\n\n/**\n * Requests getOobCode endpoint for passwordless email sign-in, returns promise\n * that resolves with user's email.\n * @param {string} email The email account to sign in with.\n * @param {!Object} additionalRequestData Additional data to add to the request.\n * @return {!goog.Promise<string>}\n */\nfireauth.RpcHandler.prototype.sendSignInLinkToEmail = function(\n    email, additionalRequestData) {\n  var request = {\n    'requestType': fireauth.RpcHandler.GetOobCodeRequestType.EMAIL_SIGNIN,\n    'email': email\n  };\n  // Extend the original request with the additional data.\n  goog.object.extend(request, additionalRequestData);\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.GET_EMAIL_SIGNIN_CODE, request);\n};\n\n\n/**\n * Requests getOobCode endpoint for email verification, returns promise that\n * resolves with user's email.\n * @param {string} idToken The idToken of the user confirming his email.\n * @param {!Object} additionalRequestData Additional data to add to the request.\n * @return {!goog.Promise<string>}\n */\nfireauth.RpcHandler.prototype.sendEmailVerification =\n    function(idToken, additionalRequestData) {\n  var request = {\n    'requestType': fireauth.RpcHandler.GetOobCodeRequestType.VERIFY_EMAIL,\n    'idToken': idToken\n  };\n  // Extend the original request with the additional data.\n  goog.object.extend(request, additionalRequestData);\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.GET_EMAIL_VERIFICATION_CODE, request);\n};\n\n\n/**\n * Requests sendVerificationCode endpoint for verifying the user's ownership of\n * a phone number. It resolves with a sessionInfo (verificationId).\n * @param {!Object} request The verification request which contains a phone\n *     number and an assertion.\n * @return {!goog.Promise<string>}\n */\nfireauth.RpcHandler.prototype.sendVerificationCode = function(request) {\n  // In the future, we could support other types of assertions so for now,\n  // we are keeping the request an object.\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.SEND_VERIFICATION_CODE, request);\n};\n\n\n/**\n * Requests verifyPhoneNumber endpoint for sign in/sign up phone number\n * authentication flow and resolves with the STS token response.\n * @param {!Object} request The phone number ID and code to exchange for a\n *     Firebase Auth session.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.verifyPhoneNumber = function(request) {\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.VERIFY_PHONE_NUMBER, request);\n};\n\n\n/**\n * Requests verifyPhoneNumber endpoint for link/update phone number\n * authentication flow and resolves with the STS token response.\n * @param {!Object} request The phone number ID and code to exchange for a\n *     Firebase Auth session.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.verifyPhoneNumberForLinking = function(request) {\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.VERIFY_PHONE_NUMBER_FOR_LINKING, request);\n};\n\n\n/**\n * Validates a response to a phone number linking request.\n * @param {?Object} response The server response data.\n * @private\n */\nfireauth.RpcHandler.validateVerifyPhoneNumberForLinkingResponse_ =\n    function(response) {\n  if (response[fireauth.RpcHandler.AuthServerField.TEMPORARY_PROOF]) {\n    response['code'] = fireauth.authenum.Error.CREDENTIAL_ALREADY_IN_USE;\n    throw fireauth.AuthErrorWithCredential.fromPlainObject(response);\n  }\n\n  // If there's no temporary proof, then we expect the request to have\n  // succeeded and returned an ID token.\n  fireauth.RpcHandler.validateIdTokenResponse_(response);\n};\n\n\n/**\n * Requests verifyPhoneNumber endpoint for reauthenticating with a phone number\n * and resolves with the STS token response.\n * @param {!Object} request The phone number ID, code, and current ID token to\n *     exchange for a refreshed Firebase Auth session.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.verifyPhoneNumberForExisting = function(request) {\n  request['operation'] = 'REAUTH';\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.VERIFY_PHONE_NUMBER_FOR_EXISTING,\n      request);\n};\n\n\n/**\n * The custom error map for reauth with verifyPhoneNumber.\n * @private {!fireauth.RpcHandler.ServerErrorMap}\n */\nfireauth.RpcHandler.verifyPhoneNumberForExistingErrorMap_ = {};\n\n// For most RPCs, the backend error USER_NOT_FOUND means that the sent STS\n// token is invalid. However, for this specific case, USER_NOT_FOUND actually\n// means that the sent credential is invalid.\nfireauth.RpcHandler.verifyPhoneNumberForExistingErrorMap_[\n  fireauth.RpcHandler.ServerError.USER_NOT_FOUND] =\n    fireauth.authenum.Error.USER_DELETED;\n\n\n/**\n * Validates a request to deleteLinkedAccounts.\n * @param {?Object} request\n * @private\n */\nfireauth.RpcHandler.validateDeleteLinkedAccountsRequest_ = function(request) {\n  if (!goog.isArray(request['deleteProvider'])) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Updates the providers for the account associated with the idToken.\n * @param {string} idToken The ID token.\n * @param {!Array<string>} providersToDelete The array of providers to delete.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.deleteLinkedAccounts =\n    function(idToken, providersToDelete) {\n  var request = {\n    'idToken': idToken,\n    'deleteProvider': providersToDelete\n  };\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.DELETE_LINKED_ACCOUNTS,\n      request);\n};\n\n\n/**\n * Validates a verifyAssertion request.\n * @param {?Object} request The verifyAssertion request data.\n * @private\n */\nfireauth.RpcHandler.validateVerifyAssertionRequest_ = function(request) {\n  // Either (requestUri and sessionId), (requestUri and postBody) or\n  // (requestUri and pendingToken) are required.\n  if (!request[fireauth.RpcHandler.AuthServerField.REQUEST_URI] ||\n      (!request[fireauth.RpcHandler.AuthServerField.SESSION_ID] &&\n       !request[fireauth.RpcHandler.AuthServerField.POST_BODY] &&\n       !request[fireauth.RpcHandler.AuthServerField.PENDING_TOKEN])) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Processes the verifyAssertion response and injects the same raw nonce\n * if available in request.\n * @param {!Object} request The verifyAssertion request data.\n * @param {!Object} response The original verifyAssertion response data.\n * @return {!Object} The modified verifyAssertion response.\n * @private\n */\nfireauth.RpcHandler.processVerifyAssertionResponse_ =\n    function(request, response) {\n  // This makes it possible for OIDC providers to:\n  // 1. Initialize an OIDC Auth credential on successful response.\n  // 2. Initialize an OIDC Auth credential within the recovery error.\n\n  // When request has sessionId and response has OIDC ID token and no pending\n  // token, a credential with raw nonce and OIDC ID token needs to be returned.\n  if (response[fireauth.RpcHandler.AuthServerField.OAUTH_ID_TOKEN] &&\n      response[fireauth.RpcHandler.AuthServerField.PROVIDER_ID] &&\n      response[fireauth.RpcHandler.AuthServerField.PROVIDER_ID]\n          .indexOf(fireauth.constants.OIDC_PREFIX) == 0 &&\n      // Use pendingToken instead of idToken and rawNonce when available.\n      !response[fireauth.RpcHandler.AuthServerField.PENDING_TOKEN]) {\n    if (request[fireauth.RpcHandler.AuthServerField.SESSION_ID]) {\n      // For full OAuth flow, the nonce is in the session ID.\n      response[fireauth.RpcHandler.InjectedResponseField.NONCE] =\n          request[fireauth.RpcHandler.AuthServerField.SESSION_ID];\n    } else if (request[fireauth.RpcHandler.AuthServerField.POST_BODY]) {\n      // For credential flow, the nonce is in the postBody nonce field.\n      var queryData = new goog.Uri.QueryData(\n          request[fireauth.RpcHandler.AuthServerField.POST_BODY]);\n      if (queryData.containsKey(\n              fireauth.RpcHandler.InjectedResponseField.NONCE)) {\n        response[fireauth.RpcHandler.InjectedResponseField.NONCE] =\n            queryData.get(fireauth.RpcHandler.InjectedResponseField.NONCE);\n      }\n    }\n  }\n  return response;\n};\n\n\n/**\n * Validates a response from verifyAssertionForExisting.\n * @param {?Object} response The verifyAssertionForExisting response data.\n * @private\n */\nfireauth.RpcHandler.validateVerifyAssertionForExistingResponse_ =\n    function(response) {\n  // When returnIdpCredential is set to true and the account is new, no error\n  // is thrown but an errorMessage is added to the response. No idToken is\n  // passed.\n  if (response[fireauth.RpcHandler.AuthServerField.ERROR_MESSAGE] &&\n      response[fireauth.RpcHandler.AuthServerField.ERROR_MESSAGE] ==\n          fireauth.RpcHandler.ServerError.USER_NOT_FOUND) {\n    // This corresponds to user-not-found.\n    throw new fireauth.AuthError(fireauth.authenum.Error.USER_DELETED);\n  } else if (response[fireauth.RpcHandler.AuthServerField.ERROR_MESSAGE]) {\n    // Construct developer facing error message from server code in errorMessage\n    // field.\n    throw fireauth.RpcHandler.getDeveloperErrorFromCode_(\n        response[fireauth.RpcHandler.AuthServerField.ERROR_MESSAGE]);\n  }\n  // Need confirmation should not be returned when do not create new user flag\n  // is set.\n  // If no error found and ID token is missing, throw an internal error.\n  if (!response[fireauth.RpcHandler.AuthServerField.ID_TOKEN]) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Validates a response from verifyAssertion.\n * @param {?Object} response The verifyAssertion response data.\n * @private\n */\nfireauth.RpcHandler.validateVerifyAssertionResponse_ = function(response) {\n  var error = null;\n  if (response[fireauth.RpcHandler.AuthServerField.NEED_CONFIRMATION]) {\n    // Account linking required, previously logged in to another account\n    // with same email. User must authenticate they are owners of the\n    // first account.\n    // If enough info for Auth linking error, throw an instance of Auth linking\n    // error. This will be used by developer after reauthenticating with email\n    // provided by error to link using the credentials in Auth linking error.\n    // If missing information, return regular Auth error.\n    response['code'] = fireauth.authenum.Error.NEED_CONFIRMATION;\n    error = fireauth.AuthErrorWithCredential.fromPlainObject(response);\n  } else if (response[fireauth.RpcHandler.AuthServerField.ERROR_MESSAGE] ==\n             fireauth.RpcHandler.ServerError.FEDERATED_USER_ID_ALREADY_LINKED) {\n    // When FEDERATED_USER_ID_ALREADY_LINKED returned in error message, auth\n    // credential and email will also be returned, throw relevant error in that\n    // case.\n    // In this case the developer needs to signInWithCredential to the returned\n    // credentials.\n    response['code'] = fireauth.authenum.Error.CREDENTIAL_ALREADY_IN_USE;\n    error = fireauth.AuthErrorWithCredential.fromPlainObject(response);\n  } else if (response[fireauth.RpcHandler.AuthServerField.ERROR_MESSAGE] ==\n             fireauth.RpcHandler.ServerError.EMAIL_EXISTS) {\n    // When EMAIL_EXISTS returned in error message, Auth credential and email\n    // will also be returned, throw relevant error in that case.\n    // In this case, the developers needs to sign in the user to the original\n    // owner of the account and then link to the returned credential here.\n    response['code'] = fireauth.authenum.Error.EMAIL_EXISTS;\n    error = fireauth.AuthErrorWithCredential.fromPlainObject(response);\n  } else if (response[fireauth.RpcHandler.AuthServerField.ERROR_MESSAGE]) {\n    // Construct developer facing error message from server code in errorMessage\n    // field.\n    error = fireauth.RpcHandler.getDeveloperErrorFromCode_(\n        response[fireauth.RpcHandler.AuthServerField.ERROR_MESSAGE]);\n  }\n  // If error found, throw it.\n  if (error) {\n    throw error;\n  }\n  // If no error found and ID token is missing, throw an internal error.\n  if (!response[fireauth.RpcHandler.AuthServerField.ID_TOKEN]) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Validates a verifyAssertion with linking request.\n * @param {?Object} request The verifyAssertion request data.\n * @private\n */\nfireauth.RpcHandler.validateVerifyAssertionLinkRequest_ = function(request) {\n  // idToken with either (requestUri and sessionId) or (requestUri and postBody)\n  // are required.\n  fireauth.RpcHandler.validateVerifyAssertionRequest_(request);\n  if (!request['idToken']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * @typedef {{\n *   autoCreate: (boolean|undefined),\n *   requestUri: string,\n *   postBody: (?string|undefined),\n *   pendingIdToken: (?string|undefined),\n *   sessionId: (?string|undefined),\n *   idToken: (?string|undefined),\n *   returnIdpCredential: (boolean|undefined),\n *   tenantId: (?string|undefined)\n * }}\n */\nfireauth.RpcHandler.VerifyAssertionData;\n\n\n/**\n * Requests verifyAssertion endpoint. When resolved, promise returns the whole\n * response.\n * @param {!fireauth.RpcHandler.VerifyAssertionData} request\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.verifyAssertion = function(request) {\n  // Force Auth credential to be returned on the following errors:\n  // FEDERATED_USER_ID_ALREADY_LINKED\n  // EMAIL_EXISTS\n  request['returnIdpCredential'] = true;\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.VERIFY_ASSERTION,\n      request);\n};\n\n\n/**\n * Requests verifyAssertion endpoint for federated account linking. When\n * resolved, promise returns the whole response.\n * @param {!fireauth.RpcHandler.VerifyAssertionData} request\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.verifyAssertionForLinking = function(request) {\n  // Force Auth credential to be returned on the following errors:\n  // FEDERATED_USER_ID_ALREADY_LINKED\n  // EMAIL_EXISTS\n  request['returnIdpCredential'] = true;\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.VERIFY_ASSERTION_FOR_LINKING,\n      request);\n};\n\n\n/**\n * Requests verifyAssertion endpoint for an existing federated account. When\n * resolved, promise returns the whole response. If not existing, a\n * user-not-found error is thrown.\n * @param {!fireauth.RpcHandler.VerifyAssertionData} request\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.verifyAssertionForExisting = function(request) {\n  // Since we are setting returnIdpCredential to true, a response will be\n  // returned even though the account doesn't exist but an error message is\n  // appended with value set to USER_NOT_FOUND. If this flag is not passed, only\n  // the USER_NOT_FOUND error is thrown without any response.\n  request['returnIdpCredential'] = true;\n  // Do not create a new account if the user doesn't exist.\n  request['autoCreate'] = false;\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.VERIFY_ASSERTION_FOR_EXISTING,\n      request);\n};\n\n\n/**\n * Validates a request that should contain an action code.\n * @param {!Object} request\n * @private\n */\nfireauth.RpcHandler.validateApplyActionCodeRequest_ = function(request) {\n  if (!request['oobCode']) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_OOB_CODE);\n  }\n};\n\n\n/**\n * Validates that a checkActionCode response contains the email and requestType\n * fields.\n * @param {!Object} response The raw response returned by the server.\n * @private\n */\nfireauth.RpcHandler.validateCheckActionCodeResponse_ = function(response) {\n  // If the code is invalid, usually a clear error would be returned.\n  // In this case, something unexpected happened.\n  // Email could be empty only if the request type is EMAIL_SIGNIN.\n  var operation = response['requestType'];\n  if (!operation || (!response['email'] && operation != 'EMAIL_SIGNIN')) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n};\n\n\n/**\n * Requests resetPassword endpoint for password reset, returns promise that\n * resolves with user's email.\n * @param {string} code The email action code to confirm for password reset.\n * @param {string} newPassword The new password.\n * @return {!goog.Promise<string>}\n */\nfireauth.RpcHandler.prototype.confirmPasswordReset =\n    function(code, newPassword) {\n  var request = {\n    'oobCode': code,\n    'newPassword': newPassword\n  };\n  return this.invokeRpc_(fireauth.RpcHandler.ApiMethod.RESET_PASSWORD, request);\n};\n\n\n/**\n * Checks the validity of an email action code and returns the response\n * received.\n * @param {string} code The email action code to check.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.RpcHandler.prototype.checkActionCode = function(code) {\n  var request = {\n    'oobCode': code\n  };\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.CHECK_ACTION_CODE, request);\n};\n\n\n/**\n * Applies an out-of-band email action code, such as an email verification code.\n * @param {string} code The email action code.\n * @return {!goog.Promise<string>} A promise that resolves with the user's\n *     email.\n */\nfireauth.RpcHandler.prototype.applyActionCode = function(code) {\n  var request = {\n    'oobCode': code\n  };\n  return this.invokeRpc_(\n      fireauth.RpcHandler.ApiMethod.APPLY_OOB_CODE, request);\n};\n\n\n/**\n * The specification of an RPC call. The fields are:\n * <ul>\n * <li>cachebuster: defines whether to send a unique string with request to\n *     force the backend to return an uncached response to request.\n * <li>customErrorMap: A map of backend error codes to client-side errors.\n *     Any entries set here override the default handling of the backend error\n *     code.\n * <li>endpoint: defines the backend endpoint to call.\n * <li>httpMethod: defines the HTTP method to use, defaulting to POST if not\n *     specified.\n * <li>requestRequiredFields: an array of the fields that are required in the\n *     request. The RPC call will fail with an INTERNAL_ERROR error if a\n *     required field is not present or if it is null, undefined, or the empty\n *     string.\n * <li>requestValidator: a function that takes in the request object and throws\n *     an error if the request is invalid.\n * <li>responsePreprocessor: a function to modify the response before running\n *     validation. The function takes in the request and response object.\n * <li>responseValidator: a function that takes in the response object and\n *     throws an error if the response is invalid.\n * <li>responseField: the field of the response object that will be returned\n *     from the RPC call. If no field is specified, the entire response object\n *     will be returned.\n * <li>returnSecureToken: Set to true to explicitly request STS tokens instead\n *     of legacy Google Identity Toolkit tokens from the backend.\n * <li>requireTenantId: Set to true to send tenant ID to backend in the request.\n * </ul>\n * @typedef {{\n *   cachebuster: (boolean|undefined),\n *   customErrorMap: (!fireauth.RpcHandler.ServerErrorMap|undefined),\n *   endpoint: string,\n *   httpMethod: (!fireauth.RpcHandler.HttpMethod|undefined),\n *   requestRequiredFields: (!Array<string>|undefined),\n *   requestValidator: (function(!Object):void|undefined),\n *   responsePreprocessor: ((function(!Object, !Object):!Object)|undefined),\n *   responseValidator: (function(!Object):void|undefined),\n *   responseField: (string|undefined),\n *   returnSecureToken: (boolean|undefined),\n *   requireTenantId: (boolean|undefined)\n * }}\n */\nfireauth.RpcHandler.ApiMethodHandler;\n\n\n/**\n * The specifications for the backend API methods.\n * @enum {!fireauth.RpcHandler.ApiMethodHandler}\n */\nfireauth.RpcHandler.ApiMethod = {\n  APPLY_OOB_CODE: {\n    endpoint: 'setAccountInfo',\n    requestValidator: fireauth.RpcHandler.validateApplyActionCodeRequest_,\n    responseField: fireauth.RpcHandler.AuthServerField.EMAIL,\n    requireTenantId: true\n  },\n  CHECK_ACTION_CODE: {\n    endpoint: 'resetPassword',\n    requestValidator: fireauth.RpcHandler.validateApplyActionCodeRequest_,\n    responseValidator: fireauth.RpcHandler.validateCheckActionCodeResponse_,\n    requireTenantId: true\n  },\n  CREATE_ACCOUNT: {\n    endpoint: 'signupNewUser',\n    requestValidator: fireauth.RpcHandler.validateCreateAccountRequest_,\n    responseValidator: fireauth.RpcHandler.validateIdTokenResponse_,\n    returnSecureToken: true,\n    requireTenantId: true\n  },\n  CREATE_AUTH_URI: {\n    endpoint: 'createAuthUri',\n    requireTenantId: true\n  },\n  DELETE_ACCOUNT: {\n    endpoint: 'deleteAccount',\n    requestRequiredFields: ['idToken']\n  },\n  DELETE_LINKED_ACCOUNTS: {\n    endpoint: 'setAccountInfo',\n    requestRequiredFields: ['idToken', 'deleteProvider'],\n    requestValidator: fireauth.RpcHandler.validateDeleteLinkedAccountsRequest_\n  },\n  EMAIL_LINK_SIGNIN: {\n    endpoint: 'emailLinkSignin',\n    requestRequiredFields: ['email', 'oobCode'],\n    requestValidator: fireauth.RpcHandler.validateRequestHasEmail_,\n    responseValidator: fireauth.RpcHandler.validateIdTokenResponse_,\n    returnSecureToken: true,\n    requireTenantId: true\n  },\n  EMAIL_LINK_SIGNIN_FOR_LINKING: {\n    endpoint: 'emailLinkSignin',\n    requestRequiredFields: ['idToken', 'email', 'oobCode'],\n    requestValidator: fireauth.RpcHandler.validateRequestHasEmail_,\n    responseValidator: fireauth.RpcHandler.validateIdTokenResponse_,\n    returnSecureToken: true\n  },\n  GET_ACCOUNT_INFO: {\n    endpoint: 'getAccountInfo'\n  },\n  GET_AUTH_URI: {\n    endpoint: 'createAuthUri',\n    requestValidator: fireauth.RpcHandler.validateGetAuthUriRequest_,\n    responseValidator: fireauth.RpcHandler.validateGetAuthResponse_,\n    requireTenantId: true\n  },\n  GET_EMAIL_SIGNIN_CODE: {\n    endpoint: 'getOobConfirmationCode',\n    requestRequiredFields: ['requestType'],\n    requestValidator: fireauth.RpcHandler.validateEmailSignInCodeRequest_,\n    responseField: fireauth.RpcHandler.AuthServerField.EMAIL,\n    requireTenantId: true\n  },\n  GET_EMAIL_VERIFICATION_CODE: {\n    endpoint: 'getOobConfirmationCode',\n    requestRequiredFields: ['idToken', 'requestType'],\n    requestValidator: fireauth.RpcHandler.validateEmailVerificationCodeRequest_,\n    responseField: fireauth.RpcHandler.AuthServerField.EMAIL,\n    requireTenantId: true\n  },\n  GET_OOB_CODE: {\n    endpoint: 'getOobConfirmationCode',\n    requestRequiredFields: ['requestType'],\n    requestValidator: fireauth.RpcHandler.validateOobCodeRequest_,\n    responseField: fireauth.RpcHandler.AuthServerField.EMAIL,\n    requireTenantId: true\n  },\n  GET_PROJECT_CONFIG: {\n    // Microsoft edge caching bug. There are two getProjectConfig API calls,\n    // first from top level window and then from iframe. The second call has a\n    // response of 304 which means it's a cached response. We suspect the call\n    // from iframe is reusing the response from the first call and checks the\n    // allowed origin in the cached response, which only contains the domain for\n    // the top level window.\n    cachebuster: true,\n    endpoint: 'getProjectConfig',\n    httpMethod: fireauth.RpcHandler.HttpMethod.GET\n  },\n  GET_RECAPTCHA_PARAM: {\n    cachebuster: true,\n    endpoint: 'getRecaptchaParam',\n    httpMethod: fireauth.RpcHandler.HttpMethod.GET,\n    responseValidator: fireauth.RpcHandler.validateGetRecaptchaParamResponse_\n  },\n  RESET_PASSWORD: {\n    endpoint: 'resetPassword',\n    requestValidator: fireauth.RpcHandler.validateApplyActionCodeRequest_,\n    responseField: fireauth.RpcHandler.AuthServerField.EMAIL,\n    requireTenantId: true\n  },\n  RETURN_DYNAMIC_LINK: {\n    cachebuster: true,\n    endpoint: 'getProjectConfig',\n    httpMethod: fireauth.RpcHandler.HttpMethod.GET,\n    responseField: fireauth.RpcHandler.AuthServerField.DYNAMIC_LINKS_DOMAIN\n  },\n  SEND_VERIFICATION_CODE: {\n    endpoint: 'sendVerificationCode',\n    // Currently only reCAPTCHA tokens supported.\n    requestRequiredFields: ['phoneNumber', 'recaptchaToken'],\n    responseField: fireauth.RpcHandler.AuthServerField.SESSION_INFO,\n    requireTenantId: true\n  },\n  SET_ACCOUNT_INFO: {\n    endpoint: 'setAccountInfo',\n    requestRequiredFields: ['idToken'],\n    requestValidator: fireauth.RpcHandler.validateEmailIfPresent_,\n    returnSecureToken: true // Maybe updating email will invalidate token in the\n                            // future, this will prevent breaking the client.\n  },\n  SET_ACCOUNT_INFO_SENSITIVE: {\n    endpoint: 'setAccountInfo',\n    requestRequiredFields: ['idToken'],\n    requestValidator: fireauth.RpcHandler.validateSetAccountInfoSensitive_,\n    responseValidator: fireauth.RpcHandler.validateIdTokenResponse_,\n    returnSecureToken: true // Updating password will send back new sts tokens.\n  },\n  SIGN_IN_ANONYMOUSLY: {\n    endpoint: 'signupNewUser',\n    responseValidator: fireauth.RpcHandler.validateIdTokenResponse_,\n    returnSecureToken: true,\n    requireTenantId: true\n  },\n  VERIFY_ASSERTION: {\n    endpoint: 'verifyAssertion',\n    requestValidator: fireauth.RpcHandler.validateVerifyAssertionRequest_,\n    responsePreprocessor: fireauth.RpcHandler.processVerifyAssertionResponse_,\n    responseValidator: fireauth.RpcHandler.validateVerifyAssertionResponse_,\n    returnSecureToken: true,\n    // Tenant ID is required for this endpoint. But for\n    // signInWithRedirect/Popup APIs, to make createAuthUri call and\n    // verifyAssertion call atomic, the tenant ID on RPC handler will be\n    // overridden by the tenant ID passed directly from the\n    // request, which is retrieved from Auth event. For signInWithCredential\n    // API, the tenant ID will still be retrieved from the RPC handler.\n    requireTenantId: true\n  },\n  VERIFY_ASSERTION_FOR_EXISTING: {\n    endpoint: 'verifyAssertion',\n    requestValidator: fireauth.RpcHandler.validateVerifyAssertionRequest_,\n    responsePreprocessor: fireauth.RpcHandler.processVerifyAssertionResponse_,\n    responseValidator:\n        fireauth.RpcHandler.validateVerifyAssertionForExistingResponse_,\n    returnSecureToken: true,\n    // Tenant ID is required for this endpoint. But for\n    // reauthenticateWithRedirect/Popup APIs, to make createAuthUri call and\n    // verifyAssertion call atomic, the tenant ID on RPC handler will be\n    // overridden by the tenant ID passed directly from the\n    // request, which is retrieved from Auth event. For\n    // reauthenticateWithCredential API, the tenant ID will still be retrieved\n    // from the RPC handler.\n    requireTenantId: true\n  },\n  VERIFY_ASSERTION_FOR_LINKING: {\n    endpoint: 'verifyAssertion',\n    requestValidator: fireauth.RpcHandler.validateVerifyAssertionLinkRequest_,\n    responsePreprocessor: fireauth.RpcHandler.processVerifyAssertionResponse_,\n    responseValidator: fireauth.RpcHandler.validateVerifyAssertionResponse_,\n    returnSecureToken: true\n  },\n  VERIFY_CUSTOM_TOKEN: {\n    endpoint: 'verifyCustomToken',\n    requestValidator: fireauth.RpcHandler.validateVerifyCustomTokenRequest_,\n    responseValidator: fireauth.RpcHandler.validateIdTokenResponse_,\n    returnSecureToken: true,\n    requireTenantId: true\n  },\n  VERIFY_PASSWORD: {\n    endpoint: 'verifyPassword',\n    requestValidator: fireauth.RpcHandler.validateVerifyPasswordRequest_,\n    responseValidator: fireauth.RpcHandler.validateIdTokenResponse_,\n    returnSecureToken: true,\n    requireTenantId: true\n  },\n  VERIFY_PHONE_NUMBER: {\n    endpoint: 'verifyPhoneNumber',\n    requestValidator: fireauth.RpcHandler.validateVerifyPhoneNumberRequest_,\n    responseValidator: fireauth.RpcHandler.validateIdTokenResponse_,\n    requireTenantId: true\n  },\n  VERIFY_PHONE_NUMBER_FOR_LINKING: {\n    endpoint: 'verifyPhoneNumber',\n    requestValidator: fireauth.RpcHandler.validateVerifyPhoneNumberLinkRequest_,\n    responseValidator:\n        fireauth.RpcHandler.validateVerifyPhoneNumberForLinkingResponse_\n  },\n  VERIFY_PHONE_NUMBER_FOR_EXISTING: {\n    customErrorMap: fireauth.RpcHandler.verifyPhoneNumberForExistingErrorMap_,\n    endpoint: 'verifyPhoneNumber',\n    requestValidator: fireauth.RpcHandler.validateVerifyPhoneNumberRequest_,\n    responseValidator: fireauth.RpcHandler.validateIdTokenResponse_,\n    requireTenantId: true\n  }\n};\n\n\n/**\n * @const {string} The parameter to send to the backend to specify that the\n *     client accepts STS tokens directly from Firebear backends.\n * @private\n */\nfireauth.RpcHandler.USE_STS_TOKEN_PARAM_ = 'returnSecureToken';\n\n\n/**\n * @const {string} The parameter to send to the backend to specify the tenant\n *     ID.\n * @private\n */\nfireauth.RpcHandler.TENANT_ID_PARAM_ = 'tenantId';\n\n\n/**\n * Invokes an RPC method according to the specification defined by\n * {@code fireauth.RpcHandler.ApiMethod}.\n * @param {!fireauth.RpcHandler.ApiMethod} method The method to invoke.\n * @param {!Object} request The input data to the method.\n * @return {!goog.Promise} A promise that resolves with the results of the RPC.\n *     The format of the results can be modified in\n *     {@code fireauth.RpcHandler.ApiMethod}.\n * @private\n */\nfireauth.RpcHandler.prototype.invokeRpc_ = function(method, request) {\n  if (!fireauth.object.hasNonEmptyFields(\n      request, method.requestRequiredFields)) {\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.INTERNAL_ERROR));\n  }\n\n  var httpMethod = method.httpMethod || fireauth.RpcHandler.HttpMethod.POST;\n  var self = this;\n  var response;\n  return goog.Promise.resolve(request)\n      .then(method.requestValidator)\n      .then(function() {\n        if (method.returnSecureToken) {\n          // Signal that the client accepts STS tokens, for the legacy Google\n          // Identity Toolkit token to STS token migration.\n          request[fireauth.RpcHandler.USE_STS_TOKEN_PARAM_] = true;\n        }\n        // If tenant ID is explicitly passed in the request, it will override\n        // the tenant ID on RPC handler.\n        if (method.requireTenantId && self.tenantId_ &&\n            (typeof request[fireauth.RpcHandler.TENANT_ID_PARAM_] ===\n             'undefined')) {\n          request[fireauth.RpcHandler.TENANT_ID_PARAM_] = self.tenantId_;\n        }\n        return self.requestFirebaseEndpoint(method.endpoint, httpMethod,\n            request, method.customErrorMap, method.cachebuster || false);\n      })\n      .then(function(tempResponse) {\n        response = tempResponse;\n        // If response processor is available, pass request and response through\n        // it. Modifications would be made using response reference.\n        if (method.responsePreprocessor) {\n          return method.responsePreprocessor(request, response);\n        }\n        return response;\n      })\n      .then(method.responseValidator)\n      .then(function() {\n        if (!method.responseField) {\n          return response;\n        }\n        if (!(method.responseField in response)) {\n          throw new fireauth.AuthError(\n              fireauth.authenum.Error.INTERNAL_ERROR);\n        }\n        return response[method.responseField];\n      });\n};\n\n\n/**\n * Checks if the server response contains errors.\n * @param {!Object} resp The API response.\n * @return {boolean} {@code true} if the response contains errors.\n * @private\n */\nfireauth.RpcHandler.hasError_ = function(resp) {\n  return !!resp['error'];\n};\n\n\n/**\n * Returns the developer facing error corresponding to the server code provided.\n * @param {string} serverErrorCode The server error message.\n * @return {!fireauth.AuthError} The corresponding error object.\n * @private\n */\nfireauth.RpcHandler.getDeveloperErrorFromCode_ = function(serverErrorCode) {\n  // Encapsulate the server error code in a typical server error response with\n  // the code populated within. This will convert the response to a developer\n  // facing one.\n  return fireauth.RpcHandler.getDeveloperError_({\n    'error': {\n      'errors': [\n        {\n          'message': serverErrorCode\n        }\n      ],\n      'code': 400,\n      'message': serverErrorCode\n    }\n  });\n};\n\n\n/**\n * Converts a server response with errors to a developer-facing AuthError.\n * @param {!Object} response The server response.\n * @param {?fireauth.RpcHandler.ServerErrorMap=} opt_customErrorMap A map of\n *     backend error codes to client-side errors. Any entries set here\n *     override the default handling of the backend error code.\n * @return {!fireauth.AuthError} The corresponding error object.\n * @private\n */\nfireauth.RpcHandler.getDeveloperError_ =\n    function(response, opt_customErrorMap) {\n  var errorMessage;\n  var apiaryError = fireauth.RpcHandler.getApiaryError_(response);\n  if (apiaryError) {\n    return apiaryError;\n  }\n\n  var serverErrorCode = fireauth.RpcHandler.getErrorCode_(response);\n\n  var errorMap = {};\n\n  // Custom token errors.\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_CUSTOM_TOKEN] =\n      fireauth.authenum.Error.INVALID_CUSTOM_TOKEN;\n  errorMap[fireauth.RpcHandler.ServerError.CREDENTIAL_MISMATCH] =\n      fireauth.authenum.Error.CREDENTIAL_MISMATCH;\n  // This can only happen if the SDK sends a bad request.\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_CUSTOM_TOKEN] =\n      fireauth.authenum.Error.INTERNAL_ERROR;\n\n  // Create Auth URI errors.\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_IDENTIFIER] =\n      fireauth.authenum.Error.INVALID_EMAIL;\n  // This can only happen if the SDK sends a bad request.\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_CONTINUE_URI] =\n      fireauth.authenum.Error.INTERNAL_ERROR;\n\n  // Sign in with email and password errors (some apply to sign up too).\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_EMAIL] =\n      fireauth.authenum.Error.INVALID_EMAIL;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_PASSWORD] =\n      fireauth.authenum.Error.INVALID_PASSWORD;\n  errorMap[fireauth.RpcHandler.ServerError.USER_DISABLED] =\n      fireauth.authenum.Error.USER_DISABLED;\n  // This can only happen if the SDK sends a bad request.\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_PASSWORD] =\n      fireauth.authenum.Error.INTERNAL_ERROR;\n\n  // Sign up with email and password errors.\n  errorMap[fireauth.RpcHandler.ServerError.EMAIL_EXISTS] =\n      fireauth.authenum.Error.EMAIL_EXISTS;\n  errorMap[fireauth.RpcHandler.ServerError.PASSWORD_LOGIN_DISABLED] =\n      fireauth.authenum.Error.OPERATION_NOT_ALLOWED;\n\n  // Verify assertion for sign in with credential errors:\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_IDP_RESPONSE] =\n      fireauth.authenum.Error.INVALID_IDP_RESPONSE;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_PENDING_TOKEN] =\n      fireauth.authenum.Error.INVALID_IDP_RESPONSE;\n  errorMap[fireauth.RpcHandler.ServerError.FEDERATED_USER_ID_ALREADY_LINKED] =\n      fireauth.authenum.Error.CREDENTIAL_ALREADY_IN_USE;\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_OR_INVALID_NONCE] =\n      fireauth.authenum.Error.MISSING_OR_INVALID_NONCE;\n\n  // Email template errors while sending emails:\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_MESSAGE_PAYLOAD] =\n      fireauth.authenum.Error.INVALID_MESSAGE_PAYLOAD;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_RECIPIENT_EMAIL] =\n      fireauth.authenum.Error.INVALID_RECIPIENT_EMAIL;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_SENDER] =\n      fireauth.authenum.Error.INVALID_SENDER;\n\n  // Send Password reset email errors:\n  errorMap[fireauth.RpcHandler.ServerError.EMAIL_NOT_FOUND] =\n      fireauth.authenum.Error.USER_DELETED;\n  errorMap[fireauth.RpcHandler.ServerError.RESET_PASSWORD_EXCEED_LIMIT] =\n      fireauth.authenum.Error.TOO_MANY_ATTEMPTS_TRY_LATER;    \n\n  // Reset password errors:\n  errorMap[fireauth.RpcHandler.ServerError.EXPIRED_OOB_CODE] =\n      fireauth.authenum.Error.EXPIRED_OOB_CODE;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_OOB_CODE] =\n      fireauth.authenum.Error.INVALID_OOB_CODE;\n  // This can only happen if the SDK sends a bad request.\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_OOB_CODE] =\n      fireauth.authenum.Error.INTERNAL_ERROR;\n\n  // Get Auth URI errors:\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_PROVIDER_ID] =\n      fireauth.authenum.Error.INVALID_PROVIDER_ID;\n\n  // Operations that require ID token in request:\n  errorMap[fireauth.RpcHandler.ServerError.CREDENTIAL_TOO_OLD_LOGIN_AGAIN] =\n      fireauth.authenum.Error.CREDENTIAL_TOO_OLD_LOGIN_AGAIN;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_ID_TOKEN] =\n      fireauth.authenum.Error.INVALID_AUTH;\n  errorMap[fireauth.RpcHandler.ServerError.TOKEN_EXPIRED] =\n      fireauth.authenum.Error.TOKEN_EXPIRED;\n  errorMap[fireauth.RpcHandler.ServerError.USER_NOT_FOUND] =\n      fireauth.authenum.Error.TOKEN_EXPIRED;\n\n  // CORS issues.\n  errorMap[fireauth.RpcHandler.ServerError.CORS_UNSUPPORTED] =\n      fireauth.authenum.Error.CORS_UNSUPPORTED;\n\n  // Dynamic link not activated.\n  errorMap[fireauth.RpcHandler.ServerError.DYNAMIC_LINK_NOT_ACTIVATED] =\n      fireauth.authenum.Error.DYNAMIC_LINK_NOT_ACTIVATED;\n\n  // iosBundleId or androidPackageName not valid error.\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_APP_ID] =\n      fireauth.authenum.Error.INVALID_APP_ID;\n\n  // Other errors.\n  errorMap[fireauth.RpcHandler.ServerError.TOO_MANY_ATTEMPTS_TRY_LATER] =\n      fireauth.authenum.Error.TOO_MANY_ATTEMPTS_TRY_LATER;\n  errorMap[fireauth.RpcHandler.ServerError.WEAK_PASSWORD] =\n      fireauth.authenum.Error.WEAK_PASSWORD;\n  errorMap[fireauth.RpcHandler.ServerError.OPERATION_NOT_ALLOWED] =\n      fireauth.authenum.Error.OPERATION_NOT_ALLOWED;\n  errorMap[fireauth.RpcHandler.ServerError.USER_CANCELLED] =\n      fireauth.authenum.Error.USER_CANCELLED;\n\n  // Phone Auth related errors.\n  errorMap[fireauth.RpcHandler.ServerError.CAPTCHA_CHECK_FAILED] =\n      fireauth.authenum.Error.CAPTCHA_CHECK_FAILED;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_APP_CREDENTIAL] =\n      fireauth.authenum.Error.INVALID_APP_CREDENTIAL;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_CODE] =\n      fireauth.authenum.Error.INVALID_CODE;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_PHONE_NUMBER] =\n      fireauth.authenum.Error.INVALID_PHONE_NUMBER;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_SESSION_INFO] =\n      fireauth.authenum.Error.INVALID_SESSION_INFO;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_TEMPORARY_PROOF] =\n      fireauth.authenum.Error.INVALID_IDP_RESPONSE;\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_APP_CREDENTIAL] =\n      fireauth.authenum.Error.MISSING_APP_CREDENTIAL;\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_CODE] =\n      fireauth.authenum.Error.MISSING_CODE;\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_PHONE_NUMBER] =\n      fireauth.authenum.Error.MISSING_PHONE_NUMBER;\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_SESSION_INFO] =\n      fireauth.authenum.Error.MISSING_SESSION_INFO;\n  errorMap[fireauth.RpcHandler.ServerError.QUOTA_EXCEEDED] =\n      fireauth.authenum.Error.QUOTA_EXCEEDED;\n  errorMap[fireauth.RpcHandler.ServerError.SESSION_EXPIRED] =\n      fireauth.authenum.Error.CODE_EXPIRED;\n  errorMap[fireauth.RpcHandler.ServerError.REJECTED_CREDENTIAL] =\n      fireauth.authenum.Error.REJECTED_CREDENTIAL;\n\n  // Other action code errors when additional settings passed.\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_CONTINUE_URI] =\n      fireauth.authenum.Error.INVALID_CONTINUE_URI;\n  // MISSING_CONTINUE_URI is getting mapped to INTERNAL_ERROR above.\n  // This is OK as this error will be caught by client side validation.\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_ANDROID_PACKAGE_NAME] =\n      fireauth.authenum.Error.MISSING_ANDROID_PACKAGE_NAME;\n  errorMap[fireauth.RpcHandler.ServerError.MISSING_IOS_BUNDLE_ID] =\n      fireauth.authenum.Error.MISSING_IOS_BUNDLE_ID;\n  errorMap[fireauth.RpcHandler.ServerError.UNAUTHORIZED_DOMAIN] =\n      fireauth.authenum.Error.UNAUTHORIZED_DOMAIN;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_DYNAMIC_LINK_DOMAIN] =\n      fireauth.authenum.Error.INVALID_DYNAMIC_LINK_DOMAIN;\n\n  // getProjectConfig errors when clientId is passed.\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_OAUTH_CLIENT_ID] =\n      fireauth.authenum.Error.INVALID_OAUTH_CLIENT_ID;\n  // getProjectConfig errors when sha1Cert is passed.\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_CERT_HASH] =\n      fireauth.authenum.Error.INVALID_CERT_HASH;\n\n  // Multi-tenant related errors.\n  errorMap[fireauth.RpcHandler.ServerError.UNSUPPORTED_TENANT_OPERATION] =\n      fireauth.authenum.Error.UNSUPPORTED_TENANT_OPERATION;\n  errorMap[fireauth.RpcHandler.ServerError.INVALID_TENANT_ID] =\n      fireauth.authenum.Error.INVALID_TENANT_ID;\n  errorMap[fireauth.RpcHandler.ServerError.TENANT_ID_MISMATCH] =\n      fireauth.authenum.Error.TENANT_ID_MISMATCH;\n\n  // User actions (sign-up or deletion) disabled errors.\n  errorMap[fireauth.RpcHandler.ServerError.ADMIN_ONLY_OPERATION] =\n      fireauth.authenum.Error.ADMIN_ONLY_OPERATION;\n\n  // Override errors set in the custom map.\n  var customErrorMap = opt_customErrorMap || {};\n  goog.object.extend(errorMap, customErrorMap);\n\n  // Get detailed message if available.\n  errorMessage = fireauth.RpcHandler.getErrorCodeDetails(serverErrorCode);\n\n  // Handle backend errors where the error code can be a prefix of the message\n  // (e.g. \"WEAK_PASSWORD : Password should be at least 6 characters\").\n  // Use the details after the colon as the error message. If none available,\n  // pass undefined, which will default to the client hard coded error messages.\n  for (var prefixCode in errorMap) {\n    if (serverErrorCode.indexOf(prefixCode) === 0) {\n      return new fireauth.AuthError(errorMap[prefixCode], errorMessage);\n    }\n  }\n\n  // No error message found, return the serialized response as the message.\n  // This is likely to be an Apiary error for unexpected cases like keyExpired,\n  // etc.\n  if (!errorMessage && response) {\n     errorMessage = fireauth.util.stringifyJSON(response);\n  }\n  // The backend returned some error we don't recognize; this is an error on\n  // our side.\n  return new fireauth.AuthError(\n      fireauth.authenum.Error.INTERNAL_ERROR, errorMessage);\n};\n\n\n/**\n * @param {string} serverMessage The server error code.\n * @return {string|undefined} The detailed error code message.\n */\nfireauth.RpcHandler.getErrorCodeDetails = function(serverMessage) {\n  // Use the error details part as the autherror message.\n  // For a message INVALID_CUSTOM_TOKEN : [error detail here],\n  // The Auth error message should be [error detail here].\n  // No space should be contained in the error code, otherwise no detailed error\n  // message returned.\n  var matches = serverMessage.match(/^[^\\s]+\\s*:\\s*([\\s\\S]*)$/);\n  if (matches && matches.length > 1) {\n    return matches[1];\n  }\n  return undefined;\n};\n\n\n/**\n * Gets the Apiary error from a backend response, if applicable.\n * @param {!Object} response The API response.\n * @return {?fireauth.AuthError} The error, if applicable.\n * @private\n */\nfireauth.RpcHandler.getApiaryError_ = function(response) {\n  var error = response['error'] && response['error']['errors'] &&\n      response['error']['errors'][0] || {};\n  var reason = error['reason'] || '';\n\n  var errorReasonMap = {\n    'keyInvalid': fireauth.authenum.Error.INVALID_API_KEY,\n    'ipRefererBlocked': fireauth.authenum.Error.APP_NOT_AUTHORIZED\n  };\n\n  if (errorReasonMap[reason]) {\n    return new fireauth.AuthError(errorReasonMap[reason]);\n  }\n\n  return null;\n};\n\n\n/**\n * Gets the server error code from the response.\n * @param {!Object} resp The API response.\n * @return {string} The error code if present.\n * @private\n */\nfireauth.RpcHandler.getErrorCode_ = function(resp) {\n  return (resp['error'] && resp['error']['message']) || '';\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Low level handling of XMLHttpRequest.\n * @author arv@google.com (Erik Arvidsson)\n * @author dbk@google.com (David Barrett-Kahn)\n */\n\ngoog.provide('goog.net.DefaultXmlHttpFactory');\ngoog.provide('goog.net.XmlHttp');\ngoog.provide('goog.net.XmlHttp.OptionType');\ngoog.provide('goog.net.XmlHttp.ReadyState');\ngoog.provide('goog.net.XmlHttpDefines');\n\ngoog.require('goog.asserts');\ngoog.require('goog.net.WrapperXmlHttpFactory');\ngoog.require('goog.net.XmlHttpFactory');\n\n\n/**\n * Static class for creating XMLHttpRequest objects.\n * @return {!goog.net.XhrLike.OrNative} A new XMLHttpRequest object.\n */\ngoog.net.XmlHttp = function() {\n  return goog.net.XmlHttp.factory_.createInstance();\n};\n\n\n/**\n * @define {boolean} Whether to assume XMLHttpRequest exists. Setting this to\n *     true bypasses the ActiveX probing code.\n * NOTE(ruilopes): Due to the way JSCompiler works, this define *will not* strip\n * out the ActiveX probing code from binaries.  To achieve this, use\n * `goog.net.XmlHttpDefines.ASSUME_NATIVE_XHR` instead.\n * TODO(ruilopes): Collapse both defines.\n */\ngoog.net.XmlHttp.ASSUME_NATIVE_XHR =\n    goog.define('goog.net.XmlHttp.ASSUME_NATIVE_XHR', false);\n\n\n/** @const */\ngoog.net.XmlHttpDefines = {};\n\n\n/**\n * @define {boolean} Whether to assume XMLHttpRequest exists. Setting this to\n *     true eliminates the ActiveX probing code.\n */\ngoog.net.XmlHttpDefines.ASSUME_NATIVE_XHR =\n    goog.define('goog.net.XmlHttpDefines.ASSUME_NATIVE_XHR', false);\n\n\n/**\n * Gets the options to use with the XMLHttpRequest objects obtained using\n * the static methods.\n * @return {Object} The options.\n */\ngoog.net.XmlHttp.getOptions = function() {\n  return goog.net.XmlHttp.factory_.getOptions();\n};\n\n\n/**\n * Type of options that an XmlHttp object can have.\n * @enum {number}\n */\ngoog.net.XmlHttp.OptionType = {\n  /**\n   * Whether a goog.nullFunction should be used to clear the onreadystatechange\n   * handler instead of null.\n   */\n  USE_NULL_FUNCTION: 0,\n\n  /**\n   * NOTE(user): In IE if send() errors on a *local* request the readystate\n   * is still changed to COMPLETE.  We need to ignore it and allow the\n   * try/catch around send() to pick up the error.\n   */\n  LOCAL_REQUEST_ERROR: 1\n};\n\n\n/**\n * Status constants for XMLHTTP, matches:\n * https://msdn.microsoft.com/en-us/library/ms534361(v=vs.85).aspx\n * @enum {number}\n */\ngoog.net.XmlHttp.ReadyState = {\n  /**\n   * Constant for when xmlhttprequest.readyState is uninitialized\n   */\n  UNINITIALIZED: 0,\n\n  /**\n   * Constant for when xmlhttprequest.readyState is loading.\n   */\n  LOADING: 1,\n\n  /**\n   * Constant for when xmlhttprequest.readyState is loaded.\n   */\n  LOADED: 2,\n\n  /**\n   * Constant for when xmlhttprequest.readyState is in an interactive state.\n   */\n  INTERACTIVE: 3,\n\n  /**\n   * Constant for when xmlhttprequest.readyState is completed\n   */\n  COMPLETE: 4\n};\n\n\n/**\n * The global factory instance for creating XMLHttpRequest objects.\n * @type {goog.net.XmlHttpFactory}\n * @private\n */\ngoog.net.XmlHttp.factory_;\n\n\n/**\n * Sets the factories for creating XMLHttpRequest objects and their options.\n * @param {Function} factory The factory for XMLHttpRequest objects.\n * @param {Function} optionsFactory The factory for options.\n * @deprecated Use setGlobalFactory instead.\n */\ngoog.net.XmlHttp.setFactory = function(factory, optionsFactory) {\n  goog.net.XmlHttp.setGlobalFactory(\n      new goog.net.WrapperXmlHttpFactory(\n          goog.asserts.assert(factory), goog.asserts.assert(optionsFactory)));\n};\n\n\n/**\n * Sets the global factory object.\n * @param {!goog.net.XmlHttpFactory} factory New global factory object.\n */\ngoog.net.XmlHttp.setGlobalFactory = function(factory) {\n  goog.net.XmlHttp.factory_ = factory;\n};\n\n\n\n/**\n * Default factory to use when creating xhr objects.  You probably shouldn't be\n * instantiating this directly, but rather using it via goog.net.XmlHttp.\n * @extends {goog.net.XmlHttpFactory}\n * @constructor\n */\ngoog.net.DefaultXmlHttpFactory = function() {\n  goog.net.XmlHttpFactory.call(this);\n};\ngoog.inherits(goog.net.DefaultXmlHttpFactory, goog.net.XmlHttpFactory);\n\n\n/** @override */\ngoog.net.DefaultXmlHttpFactory.prototype.createInstance = function() {\n  var progId = this.getProgId_();\n  if (progId) {\n    return new ActiveXObject(progId);\n  } else {\n    return new XMLHttpRequest();\n  }\n};\n\n\n/** @override */\ngoog.net.DefaultXmlHttpFactory.prototype.internalGetOptions = function() {\n  var progId = this.getProgId_();\n  var options = {};\n  if (progId) {\n    options[goog.net.XmlHttp.OptionType.USE_NULL_FUNCTION] = true;\n    options[goog.net.XmlHttp.OptionType.LOCAL_REQUEST_ERROR] = true;\n  }\n  return options;\n};\n\n\n/**\n * The ActiveX PROG ID string to use to create xhr's in IE. Lazily initialized.\n * @type {string|undefined}\n * @private\n */\ngoog.net.DefaultXmlHttpFactory.prototype.ieProgId_;\n\n\n/**\n * Initialize the private state used by other functions.\n * @return {string} The ActiveX PROG ID string to use to create xhr's in IE.\n * @private\n */\ngoog.net.DefaultXmlHttpFactory.prototype.getProgId_ = function() {\n  if (goog.net.XmlHttp.ASSUME_NATIVE_XHR ||\n      goog.net.XmlHttpDefines.ASSUME_NATIVE_XHR) {\n    return '';\n  }\n\n  // The following blog post describes what PROG IDs to use to create the\n  // XMLHTTP object in Internet Explorer:\n  // http://blogs.msdn.com/xmlteam/archive/2006/10/23/using-the-right-version-of-msxml-in-internet-explorer.aspx\n  // However we do not (yet) fully trust that this will be OK for old versions\n  // of IE on Win9x so we therefore keep the last 2.\n  if (!this.ieProgId_ && typeof XMLHttpRequest == 'undefined' &&\n      typeof ActiveXObject != 'undefined') {\n    // Candidate Active X types.\n    var ACTIVE_X_IDENTS = [\n      'MSXML2.XMLHTTP.6.0', 'MSXML2.XMLHTTP.3.0', 'MSXML2.XMLHTTP',\n      'Microsoft.XMLHTTP'\n    ];\n    for (var i = 0; i < ACTIVE_X_IDENTS.length; i++) {\n      var candidate = ACTIVE_X_IDENTS[i];\n\n      try {\n        new ActiveXObject(candidate);\n        // NOTE(user): cannot assign progid and return candidate in one line\n        // because JSCompiler complaings: BUG 658126\n        this.ieProgId_ = candidate;\n        return candidate;\n      } catch (e) {\n        // do nothing; try next choice\n      }\n    }\n\n    // couldn't find any matches\n    throw new Error(\n        'Could not create ActiveXObject. ActiveX might be disabled,' +\n        ' or MSXML might not be installed');\n  }\n\n  return /** @type {string} */ (this.ieProgId_);\n};\n\n\n// Set the global factory to an instance of the default factory.\ngoog.net.XmlHttp.setGlobalFactory(new goog.net.DefaultXmlHttpFactory());\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the invalid origin error, a subclass of\n * fireauth.AuthError.\n */\n\n\ngoog.provide('fireauth.InvalidOriginError');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\ngoog.require('goog.Uri');\ngoog.require('goog.string');\n\n\n\n/**\n * Invalid origin error that can be returned to the developer.\n * @param {string} origin The invalid domain name.\n * @constructor\n * @extends {fireauth.AuthError}\n */\nfireauth.InvalidOriginError = function(origin) {\n  var code = fireauth.authenum.Error.INVALID_ORIGIN;\n  var message = undefined;\n  var uri = goog.Uri.parse(origin);\n  // Get domain.\n  var domain = uri.getDomain();\n  // Get scheme.\n  var scheme = uri.getScheme();\n  // Only http, https and chrome-extension currently supported.\n  if (scheme == 'chrome-extension') {\n    // Chrome extension whitelisting.\n    // Replace chrome-extension://CHROME_EXT_ID in error message template.\n    message = goog.string.subs(\n        fireauth.InvalidOriginError.CHROME_EXTENSION_MESSAGE_TEMPLATE_,\n        domain);\n  } else if (scheme == 'http' || scheme == 'https') {\n    // Replace domain in error message template.\n    message = goog.string.subs(\n        fireauth.InvalidOriginError.HTTP_MESSAGE_TEMPLATE_,\n        domain);\n  } else {\n    // Throw operation not supported when non http, https or Chrome extension\n    // protocol.\n    code = fireauth.authenum.Error.OPERATION_NOT_SUPPORTED;\n  }\n  fireauth.InvalidOriginError.base(this, 'constructor', code, message);\n};\ngoog.inherits(fireauth.InvalidOriginError, fireauth.AuthError);\n\n\n/** @private @const {string} The http invalid origin message template. */\nfireauth.InvalidOriginError.HTTP_MESSAGE_TEMPLATE_ = 'This domain (%s) is no' +\n    't authorized to run this operation. Add it to the OAuth redirect domain' +\n    's list in the Firebase console -> Auth section -> Sign in method tab.';\n\n\n/**\n * @private @const {string} The Chrome extension invalid origin message\n *     template.\n */\nfireauth.InvalidOriginError.CHROME_EXTENSION_MESSAGE_TEMPLATE_ = 'This chrom' +\n    'e extension ID (chrome-extension://%s) is not authorized to run this op' +\n    'eration. Add it to the OAuth redirect domains list in the Firebase cons' +\n    'ole -> Auth section -> Sign in method tab.';\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the Auth errors that include emails and an Auth\n * credential, a subclass of fireauth.AuthError.\n */\n\n\ngoog.provide('fireauth.AuthErrorWithCredential');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.AuthProvider');\ngoog.require('fireauth.object');\ngoog.require('goog.object');\n\n\n/**\n * Error with email and credential that can be returned to the developer.\n * @param {fireauth.authenum.Error} code The error code.\n * @param {?fireauth.AuthErrorWithCredential.CredentialInfo=} opt_credentialInfo\n *     Additional credential information to associate with the error.\n * @param {string=} opt_message The human-readable message.\n * @constructor\n * @extends {fireauth.AuthError}\n */\nfireauth.AuthErrorWithCredential =\n    function(code, opt_credentialInfo, opt_message) {\n  fireauth.AuthErrorWithCredential.base(\n      this, 'constructor', code, opt_message);\n  var credentialInfo = opt_credentialInfo || {};\n\n  // These properties are public.\n  if (credentialInfo.email) {\n    fireauth.object.setReadonlyProperty(this, 'email', credentialInfo.email);\n  }\n  if (credentialInfo.phoneNumber) {\n    fireauth.object.setReadonlyProperty(this, 'phoneNumber',\n        credentialInfo.phoneNumber);\n  }\n  if (credentialInfo.credential) {\n    fireauth.object.setReadonlyProperty(this, 'credential',\n        credentialInfo.credential);\n  }\n  if (credentialInfo.tenantId) {\n    fireauth.object.setReadonlyProperty(this, 'tenantId',\n        credentialInfo.tenantId);\n  }\n};\ngoog.inherits(fireauth.AuthErrorWithCredential, fireauth.AuthError);\n\n\n/**\n * Additional credential information to associate with an error, so that the\n * user does not have to execute the Auth flow again on linking errors.\n * @typedef {{\n *   email: (?string|undefined),\n *   phoneNumber: (?string|undefined),\n *   credential: (?fireauth.AuthCredential|undefined),\n *   tenantId: (?string|undefined),\n * }}\n */\nfireauth.AuthErrorWithCredential.CredentialInfo;\n\n\n/**\n * @return {!Object} The plain object form of the error.\n * @override\n */\nfireauth.AuthErrorWithCredential.prototype.toPlainObject = function() {\n  var obj = {\n    'code': this['code'],\n    'message': this.message\n  };\n  if (this['email']) {\n    obj['email'] = this['email'];\n  }\n  if (this['phoneNumber']) {\n    obj['phoneNumber'] = this['phoneNumber'];\n  }\n  if (this['tenantId']) {\n    obj['tenantId'] = this['tenantId'];\n  }\n\n  var credential = this['credential'] && this['credential'].toPlainObject();\n  if (credential){\n    goog.object.extend(obj, credential);\n  }\n  return obj;\n};\n\n\n/**\n * @return {!Object} The plain object form of the error. This is used by\n *     JSON.toStringify() to return the stringified representation of the error;\n * @override\n */\nfireauth.AuthErrorWithCredential.prototype.toJSON = function() {\n  // Return the plain object representation in case JSON.stringify is called on\n  // an Auth error instance.\n  return this.toPlainObject();\n};\n\n\n/**\n * @param {?Object|undefined} response The object response to convert to a\n *     fireauth.AuthErrorWithCredential.\n * @return {?fireauth.AuthError} The error representation of the response.\n * @override\n */\nfireauth.AuthErrorWithCredential.fromPlainObject = function(response) {\n  // Code included.\n  if (response['code']) {\n    var code = response['code'] || '';\n    // Remove prefix from name if available.\n    if (code.indexOf(fireauth.AuthError.ERROR_CODE_PREFIX) == 0) {\n      code = code.substring(fireauth.AuthError.ERROR_CODE_PREFIX.length);\n    }\n\n    // Credentials and tenant ID in response.\n    var credentialInfo = {\n      credential: fireauth.AuthProvider.getCredentialFromResponse(response),\n      tenantId: response['tenantId']\n    };\n    if (response['email']) {\n      credentialInfo.email = response['email'];\n    } else if (response['phoneNumber']) {\n      credentialInfo.phoneNumber = response['phoneNumber'];\n    } else if (!credentialInfo.credential) {\n      // Neither email, phone number or credentials are set; return a generic\n      // error.\n      return new fireauth.AuthError(code, response['message'] || undefined);\n    }\n\n    return new fireauth.AuthErrorWithCredential(code, credentialInfo,\n        response['message']);\n  }\n  // No error or invalid response.\n  return null;\n};\n","// Copyright 2010 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Interface for a factory for creating XMLHttpRequest objects\n * and metadata about them.\n * @author dbk@google.com (David Barrett-Kahn)\n */\n\ngoog.provide('goog.net.XmlHttpFactory');\n\n/** @suppress {extraRequire} Typedef. */\ngoog.require('goog.net.XhrLike');\n\n\n\n/**\n * Abstract base class for an XmlHttpRequest factory.\n * @constructor\n */\ngoog.net.XmlHttpFactory = function() {};\n\n\n/**\n * Cache of options - we only actually call internalGetOptions once.\n * @type {?Object}\n * @private\n */\ngoog.net.XmlHttpFactory.prototype.cachedOptions_ = null;\n\n\n/**\n * @return {!goog.net.XhrLike.OrNative} A new XhrLike instance.\n */\ngoog.net.XmlHttpFactory.prototype.createInstance = goog.abstractMethod;\n\n\n/**\n * @return {Object} Options describing how xhr objects obtained from this\n *     factory should be used.\n */\ngoog.net.XmlHttpFactory.prototype.getOptions = function() {\n  return this.cachedOptions_ ||\n      (this.cachedOptions_ = this.internalGetOptions());\n};\n\n\n/**\n * Override this method in subclasses to preserve the caching offered by\n * getOptions().\n * @return {Object} Options describing how xhr objects obtained from this\n *     factory should be used.\n * @protected\n */\ngoog.net.XmlHttpFactory.prototype.internalGetOptions = goog.abstractMethod;\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview This file contain classes that add support for cross-domain XHR\n * requests (see http://www.w3.org/TR/cors/). Most modern browsers are able to\n * use a regular XMLHttpRequest for that, but IE 8 use XDomainRequest object\n * instead. This file provides an adapter from this object to a goog.net.XhrLike\n * and a factory to allow using this with a goog.net.XhrIo instance.\n *\n * IE 7 and older versions are not supported (given that they do not support\n * CORS requests).\n */\ngoog.provide('goog.net.CorsXmlHttpFactory');\ngoog.provide('goog.net.IeCorsXhrAdapter');\n\ngoog.require('goog.net.HttpStatus');\ngoog.require('goog.net.XhrLike');\ngoog.require('goog.net.XmlHttp');\ngoog.require('goog.net.XmlHttpFactory');\n\n\n\n/**\n * A factory of XML http request objects that supports cross domain requests.\n * This class should be instantiated and passed as the parameter of a\n * goog.net.XhrIo constructor to allow cross-domain requests in every browser.\n *\n * @extends {goog.net.XmlHttpFactory}\n * @constructor\n * @final\n */\ngoog.net.CorsXmlHttpFactory = function() {\n  goog.net.XmlHttpFactory.call(this);\n};\ngoog.inherits(goog.net.CorsXmlHttpFactory, goog.net.XmlHttpFactory);\n\n\n/** @override */\ngoog.net.CorsXmlHttpFactory.prototype.createInstance = function() {\n  var xhr = new XMLHttpRequest();\n  if (('withCredentials' in xhr)) {\n    return xhr;\n  } else if (typeof XDomainRequest != 'undefined') {\n    return new goog.net.IeCorsXhrAdapter();\n  } else {\n    throw new Error('Unsupported browser');\n  }\n};\n\n\n/** @override */\ngoog.net.CorsXmlHttpFactory.prototype.internalGetOptions = function() {\n  return {};\n};\n\n\n\n/**\n * An adapter around Internet Explorer's XDomainRequest object that makes it\n * look like a standard XMLHttpRequest. This can be used instead of\n * XMLHttpRequest to support CORS.\n *\n * @implements {goog.net.XhrLike}\n * @constructor\n * @struct\n * @final\n */\ngoog.net.IeCorsXhrAdapter = function() {\n  /**\n   * The underlying XDomainRequest used to make the HTTP request.\n   * @type {!XDomainRequest}\n   * @private\n   */\n  this.xdr_ = new XDomainRequest();\n\n  /**\n   * The simulated ready state.\n   * @type {number}\n   */\n  this.readyState = goog.net.XmlHttp.ReadyState.UNINITIALIZED;\n\n  /**\n   * The simulated ready state change callback function.\n   * @type {?function()|undefined}\n   */\n  this.onreadystatechange = null;\n\n  /** @override */\n  this.response = '';\n\n  /**\n   * The simulated response text parameter.\n   * @type {string}\n   */\n  this.responseText = '';\n\n  /**\n   * This implementation only supports text response.\n   * @type {string}\n   * @override\n   */\n  this.responseType = '';\n\n  /**\n   * The simulated status code\n   * @type {number}\n   */\n  this.status = -1;\n\n  /** @override */\n  this.responseXML = null;\n\n  /** @override */\n  this.statusText = '';\n\n  this.xdr_.onload = goog.bind(this.handleLoad_, this);\n  this.xdr_.onerror = goog.bind(this.handleError_, this);\n  this.xdr_.onprogress = goog.bind(this.handleProgress_, this);\n  this.xdr_.ontimeout = goog.bind(this.handleTimeout_, this);\n};\n\n\n/**\n * Opens a connection to the provided URL.\n * @param {string} method The HTTP method to use. Valid methods include GET and\n *     POST.\n * @param {string} url The URL to contact. The authority of this URL must match\n *     the authority of the current page's URL (e.g. http or https).\n * @param {?boolean=} opt_async Whether the request is asynchronous, defaulting\n *     to true. XDomainRequest does not support syncronous requests, so setting\n *     it to false will actually raise an exception.\n * @override\n */\ngoog.net.IeCorsXhrAdapter.prototype.open = function(method, url, opt_async) {\n  if (goog.isDefAndNotNull(opt_async) && (!opt_async)) {\n    throw new Error('Only async requests are supported.');\n  }\n  this.xdr_.open(method, url);\n};\n\n\n/**\n * Sends the request to the remote server. Before calling this function, always\n * call {@link open}.\n * @param {(ArrayBuffer|ArrayBufferView|Blob|Document|FormData|null|string)=}\n *     opt_content The content to send as POSTDATA, if any. Only string data is\n *     supported by this implementation.\n * @override\n */\ngoog.net.IeCorsXhrAdapter.prototype.send = function(opt_content) {\n  if (opt_content) {\n    if (typeof opt_content == 'string') {\n      this.xdr_.send(opt_content);\n    } else {\n      throw new Error('Only string data is supported');\n    }\n  } else {\n    this.xdr_.send();\n  }\n};\n\n\n/**\n * @override\n */\ngoog.net.IeCorsXhrAdapter.prototype.abort = function() {\n  this.xdr_.abort();\n};\n\n\n/**\n * Sets a request header to send to the remote server. Because this\n * implementation does not support request headers, this function does nothing.\n * @param {string} key The name of the HTTP header to set. Ignored.\n * @param {string} value The value to set for the HTTP header. Ignored.\n * @override\n */\ngoog.net.IeCorsXhrAdapter.prototype.setRequestHeader = function(key, value) {\n  // Unsupported; ignore the header.\n};\n\n\n/**\n * Returns the value of the response header identified by key. This\n * implementation only supports the 'content-type' header.\n * @param {string} key The request header to fetch. If this parameter is set to\n *     'content-type' (case-insensitive), this function returns the value of\n *     the 'content-type' request header. If this parameter is set to any other\n *     value, this function always returns an empty string.\n * @return {string} The value of the response header, or an empty string if key\n *     is not 'content-type' (case-insensitive).\n * @override\n */\ngoog.net.IeCorsXhrAdapter.prototype.getResponseHeader = function(key) {\n  if (key.toLowerCase() == 'content-type') {\n    return this.xdr_.contentType;\n  }\n  return '';\n};\n\n\n/**\n * Handles a request that has fully loaded successfully.\n * @private\n */\ngoog.net.IeCorsXhrAdapter.prototype.handleLoad_ = function() {\n  // IE only calls onload if the status is 200, so the status code must be OK.\n  this.status = goog.net.HttpStatus.OK;\n  this.response = this.responseText = this.xdr_.responseText;\n  this.setReadyState_(goog.net.XmlHttp.ReadyState.COMPLETE);\n};\n\n\n/**\n * Handles a request that has failed to load.\n * @private\n */\ngoog.net.IeCorsXhrAdapter.prototype.handleError_ = function() {\n  // IE doesn't tell us what the status code actually is (other than the fact\n  // that it is not 200), so simulate an INTERNAL_SERVER_ERROR.\n  this.status = goog.net.HttpStatus.INTERNAL_SERVER_ERROR;\n  this.response = this.responseText = '';\n  this.setReadyState_(goog.net.XmlHttp.ReadyState.COMPLETE);\n};\n\n\n/**\n * Handles a request that timed out.\n * @private\n */\ngoog.net.IeCorsXhrAdapter.prototype.handleTimeout_ = function() {\n  this.handleError_();\n};\n\n\n/**\n * Handles a request that is in the process of loading.\n * @private\n */\ngoog.net.IeCorsXhrAdapter.prototype.handleProgress_ = function() {\n  // IE only calls onprogress if the status is 200, so the status code must be\n  // OK.\n  this.status = goog.net.HttpStatus.OK;\n  this.setReadyState_(goog.net.XmlHttp.ReadyState.LOADING);\n};\n\n\n/**\n * Sets this XHR's ready state and fires the onreadystatechange listener (if one\n * is set).\n * @param {number} readyState The new ready state.\n * @private\n */\ngoog.net.IeCorsXhrAdapter.prototype.setReadyState_ = function(readyState) {\n  this.readyState = readyState;\n  if (this.onreadystatechange) {\n    this.onreadystatechange();\n  }\n};\n\n\n/**\n * Returns the response headers from the server. This implemntation only returns\n * the 'content-type' header.\n * @return {string} The headers returned from the server.\n * @override\n */\ngoog.net.IeCorsXhrAdapter.prototype.getAllResponseHeaders = function() {\n  return 'content-type: ' + this.xdr_.contentType;\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Definition of the LogRecord class. Please minimize\n * dependencies this file has on other closure classes as any dependency it\n * takes won't be able to use the logging infrastructure.\n *\n */\n\ngoog.provide('goog.debug.LogRecord');\n\n\n\n/**\n * LogRecord objects are used to pass logging requests between\n * the logging framework and individual log Handlers.\n * @constructor\n * @param {goog.debug.Logger.Level} level One of the level identifiers.\n * @param {string} msg The string message.\n * @param {string} loggerName The name of the source logger.\n * @param {number=} opt_time Time this log record was created if other than now.\n *     If 0, we use #goog.now.\n * @param {number=} opt_sequenceNumber Sequence number of this log record. This\n *     should only be passed in when restoring a log record from persistence.\n */\ngoog.debug.LogRecord = function(\n    level, msg, loggerName, opt_time, opt_sequenceNumber) {\n  this.reset(level, msg, loggerName, opt_time, opt_sequenceNumber);\n};\n\n\n/**\n * Time the LogRecord was created.\n * @type {number}\n * @private\n */\ngoog.debug.LogRecord.prototype.time_;\n\n\n/**\n * Level of the LogRecord\n * @type {goog.debug.Logger.Level}\n * @private\n */\ngoog.debug.LogRecord.prototype.level_;\n\n\n/**\n * Message associated with the record\n * @type {string}\n * @private\n */\ngoog.debug.LogRecord.prototype.msg_;\n\n\n/**\n * Name of the logger that created the record.\n * @type {string}\n * @private\n */\ngoog.debug.LogRecord.prototype.loggerName_;\n\n\n/**\n * Sequence number for the LogRecord. Each record has a unique sequence number\n * that is greater than all log records created before it.\n * @type {number}\n * @private\n */\ngoog.debug.LogRecord.prototype.sequenceNumber_ = 0;\n\n\n/**\n * Exception associated with the record\n * @type {?Object}\n * @private\n */\ngoog.debug.LogRecord.prototype.exception_ = null;\n\n\n/**\n * @define {boolean} Whether to enable log sequence numbers.\n */\ngoog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS =\n    goog.define('goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS', true);\n\n\n/**\n * A sequence counter for assigning increasing sequence numbers to LogRecord\n * objects.\n * @type {number}\n * @private\n */\ngoog.debug.LogRecord.nextSequenceNumber_ = 0;\n\n\n/**\n * Sets all fields of the log record.\n * @param {goog.debug.Logger.Level} level One of the level identifiers.\n * @param {string} msg The string message.\n * @param {string} loggerName The name of the source logger.\n * @param {number=} opt_time Time this log record was created if other than now.\n *     If 0, we use #goog.now.\n * @param {number=} opt_sequenceNumber Sequence number of this log record. This\n *     should only be passed in when restoring a log record from persistence.\n */\ngoog.debug.LogRecord.prototype.reset = function(\n    level, msg, loggerName, opt_time, opt_sequenceNumber) {\n  if (goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS) {\n    this.sequenceNumber_ = typeof opt_sequenceNumber == 'number' ?\n        opt_sequenceNumber :\n        goog.debug.LogRecord.nextSequenceNumber_++;\n  }\n\n  this.time_ = opt_time || goog.now();\n  this.level_ = level;\n  this.msg_ = msg;\n  this.loggerName_ = loggerName;\n  delete this.exception_;\n};\n\n\n/**\n * Get the source Logger's name.\n *\n * @return {string} source logger name (may be null).\n */\ngoog.debug.LogRecord.prototype.getLoggerName = function() {\n  return this.loggerName_;\n};\n\n\n/**\n * Get the exception that is part of the log record.\n *\n * @return {Object} the exception.\n */\ngoog.debug.LogRecord.prototype.getException = function() {\n  return this.exception_;\n};\n\n\n/**\n * Set the exception that is part of the log record.\n *\n * @param {Object} exception the exception.\n */\ngoog.debug.LogRecord.prototype.setException = function(exception) {\n  this.exception_ = exception;\n};\n\n\n/**\n * Get the source Logger's name.\n *\n * @param {string} loggerName source logger name (may be null).\n */\ngoog.debug.LogRecord.prototype.setLoggerName = function(loggerName) {\n  this.loggerName_ = loggerName;\n};\n\n\n/**\n * Get the logging message level, for example Level.SEVERE.\n * @return {goog.debug.Logger.Level} the logging message level.\n */\ngoog.debug.LogRecord.prototype.getLevel = function() {\n  return this.level_;\n};\n\n\n/**\n * Set the logging message level, for example Level.SEVERE.\n * @param {goog.debug.Logger.Level} level the logging message level.\n */\ngoog.debug.LogRecord.prototype.setLevel = function(level) {\n  this.level_ = level;\n};\n\n\n/**\n * Get the \"raw\" log message, before localization or formatting.\n *\n * @return {string} the raw message string.\n */\ngoog.debug.LogRecord.prototype.getMessage = function() {\n  return this.msg_;\n};\n\n\n/**\n * Set the \"raw\" log message, before localization or formatting.\n *\n * @param {string} msg the raw message string.\n */\ngoog.debug.LogRecord.prototype.setMessage = function(msg) {\n  this.msg_ = msg;\n};\n\n\n/**\n * Get event time in milliseconds since 1970.\n *\n * @return {number} event time in millis since 1970.\n */\ngoog.debug.LogRecord.prototype.getMillis = function() {\n  return this.time_;\n};\n\n\n/**\n * Set event time in milliseconds since 1970.\n *\n * @param {number} time event time in millis since 1970.\n */\ngoog.debug.LogRecord.prototype.setMillis = function(time) {\n  this.time_ = time;\n};\n\n\n/**\n * Get the sequence number.\n * <p>\n * Sequence numbers are normally assigned in the LogRecord\n * constructor, which assigns unique sequence numbers to\n * each new LogRecord in increasing order.\n * @return {number} the sequence number.\n */\ngoog.debug.LogRecord.prototype.getSequenceNumber = function() {\n  return this.sequenceNumber_;\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Definition of the Logger class. Please minimize dependencies\n * this file has on other closure classes as any dependency it takes won't be\n * able to use the logging infrastructure.\n *\n * @see ../demos/debug.html\n */\n\ngoog.provide('goog.debug.LogManager');\ngoog.provide('goog.debug.Loggable');\ngoog.provide('goog.debug.Logger');\ngoog.provide('goog.debug.Logger.Level');\n\ngoog.require('goog.array');\ngoog.require('goog.asserts');\ngoog.require('goog.debug');\ngoog.require('goog.debug.LogBuffer');\ngoog.require('goog.debug.LogRecord');\n\n\n/**\n * A message value that can be handled by a Logger.\n *\n * Functions are treated like callbacks, but are only called when the event's\n * log level is enabled. This is useful for logging messages that are expensive\n * to construct.\n *\n * @typedef {string|function(): string}\n */\ngoog.debug.Loggable;\n\n\n\n/**\n * The Logger is an object used for logging debug messages. Loggers are\n * normally named, using a hierarchical dot-separated namespace. Logger names\n * can be arbitrary strings, but they should normally be based on the package\n * name or class name of the logged component, such as goog.net.BrowserChannel.\n *\n * The Logger object is loosely based on the java class\n * java.util.logging.Logger. It supports different levels of filtering for\n * different loggers.\n *\n * The logger object should never be instantiated by application code. It\n * should always use the goog.debug.Logger.getLogger function.\n *\n * @constructor\n * @param {string} name The name of the Logger.\n * @final\n */\ngoog.debug.Logger = function(name) {\n  /**\n   * Name of the Logger. Generally a dot-separated namespace\n   * @private {string}\n   */\n  this.name_ = name;\n\n  /**\n   * Parent Logger.\n   * @private {?goog.debug.Logger}\n   */\n  this.parent_ = null;\n\n  /**\n   * Level that this logger only filters above. Null indicates it should\n   * inherit from the parent.\n   * @private {?goog.debug.Logger.Level}\n   */\n  this.level_ = null;\n\n  /**\n   * Map of children loggers. The keys are the leaf names of the children and\n   * the values are the child loggers.\n   * @private {?Object}\n   */\n  this.children_ = null;\n\n  /**\n   * Handlers that are listening to this logger.\n   * @private {?Array<?Function>}\n   */\n  this.handlers_ = null;\n};\n\n\n/** @const */\ngoog.debug.Logger.ROOT_LOGGER_NAME = '';\n\n\n/**\n * @define {boolean} Toggles whether loggers other than the root logger can have\n *     log handlers attached to them and whether they can have their log level\n *     set. Logging is a bit faster when this is set to false.\n */\ngoog.debug.Logger.ENABLE_HIERARCHY =\n    goog.define('goog.debug.Logger.ENABLE_HIERARCHY', true);\n\n\n/**\n * @define {boolean} Toggles whether active log statements are also recorded\n *     to the profiler.\n */\ngoog.debug.Logger.ENABLE_PROFILER_LOGGING =\n    goog.define('goog.debug.Logger.ENABLE_PROFILER_LOGGING', false);\n\n\nif (!goog.debug.Logger.ENABLE_HIERARCHY) {\n  /**\n   * @type {!Array<Function>}\n   * @private\n   */\n  goog.debug.Logger.rootHandlers_ = [];\n\n\n  /**\n   * @type {goog.debug.Logger.Level}\n   * @private\n   */\n  goog.debug.Logger.rootLevel_;\n}\n\n\n\n/**\n * The Level class defines a set of standard logging levels that\n * can be used to control logging output.  The logging Level objects\n * are ordered and are specified by ordered integers.  Enabling logging\n * at a given level also enables logging at all higher levels.\n * <p>\n * Clients should normally use the predefined Level constants such\n * as Level.SEVERE.\n * <p>\n * The levels in descending order are:\n * <ul>\n * <li>SEVERE (highest value)\n * <li>WARNING\n * <li>INFO\n * <li>CONFIG\n * <li>FINE\n * <li>FINER\n * <li>FINEST  (lowest value)\n * </ul>\n * In addition there is a level OFF that can be used to turn\n * off logging, and a level ALL that can be used to enable\n * logging of all messages.\n *\n * @param {string} name The name of the level.\n * @param {number} value The numeric value of the level.\n * @constructor\n * @final\n */\ngoog.debug.Logger.Level = function(name, value) {\n  /**\n   * The name of the level\n   * @type {string}\n   */\n  this.name = name;\n\n  /**\n   * The numeric value of the level\n   * @type {number}\n   */\n  this.value = value;\n};\n\n\n/**\n * @return {string} String representation of the logger level.\n * @override\n */\ngoog.debug.Logger.Level.prototype.toString = function() {\n  return this.name;\n};\n\n\n/**\n * OFF is a special level that can be used to turn off logging.\n * This level is initialized to <CODE>Infinity</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\ngoog.debug.Logger.Level.OFF = new goog.debug.Logger.Level('OFF', Infinity);\n\n\n/**\n * SHOUT is a message level for extra debugging loudness.\n * This level is initialized to <CODE>1200</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\ngoog.debug.Logger.Level.SHOUT = new goog.debug.Logger.Level('SHOUT', 1200);\n\n\n/**\n * SEVERE is a message level indicating a serious failure.\n * This level is initialized to <CODE>1000</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\ngoog.debug.Logger.Level.SEVERE = new goog.debug.Logger.Level('SEVERE', 1000);\n\n\n/**\n * WARNING is a message level indicating a potential problem.\n * This level is initialized to <CODE>900</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\ngoog.debug.Logger.Level.WARNING = new goog.debug.Logger.Level('WARNING', 900);\n\n\n/**\n * INFO is a message level for informational messages.\n * This level is initialized to <CODE>800</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\ngoog.debug.Logger.Level.INFO = new goog.debug.Logger.Level('INFO', 800);\n\n\n/**\n * CONFIG is a message level for static configuration messages.\n * This level is initialized to <CODE>700</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\ngoog.debug.Logger.Level.CONFIG = new goog.debug.Logger.Level('CONFIG', 700);\n\n\n/**\n * FINE is a message level providing tracing information.\n * This level is initialized to <CODE>500</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\ngoog.debug.Logger.Level.FINE = new goog.debug.Logger.Level('FINE', 500);\n\n\n/**\n * FINER indicates a fairly detailed tracing message.\n * This level is initialized to <CODE>400</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\ngoog.debug.Logger.Level.FINER = new goog.debug.Logger.Level('FINER', 400);\n\n/**\n * FINEST indicates a highly detailed tracing message.\n * This level is initialized to <CODE>300</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\n\ngoog.debug.Logger.Level.FINEST = new goog.debug.Logger.Level('FINEST', 300);\n\n\n/**\n * ALL indicates that all messages should be logged.\n * This level is initialized to <CODE>0</CODE>.\n * @type {!goog.debug.Logger.Level}\n */\ngoog.debug.Logger.Level.ALL = new goog.debug.Logger.Level('ALL', 0);\n\n\n/**\n * The predefined levels.\n * @type {!Array<!goog.debug.Logger.Level>}\n * @final\n */\ngoog.debug.Logger.Level.PREDEFINED_LEVELS = [\n  goog.debug.Logger.Level.OFF, goog.debug.Logger.Level.SHOUT,\n  goog.debug.Logger.Level.SEVERE, goog.debug.Logger.Level.WARNING,\n  goog.debug.Logger.Level.INFO, goog.debug.Logger.Level.CONFIG,\n  goog.debug.Logger.Level.FINE, goog.debug.Logger.Level.FINER,\n  goog.debug.Logger.Level.FINEST, goog.debug.Logger.Level.ALL\n];\n\n\n/**\n * A lookup map used to find the level object based on the name or value of\n * the level object.\n * @type {?Object}\n * @private\n */\ngoog.debug.Logger.Level.predefinedLevelsCache_ = null;\n\n\n/**\n * Creates the predefined levels cache and populates it.\n * @private\n */\ngoog.debug.Logger.Level.createPredefinedLevelsCache_ = function() {\n  goog.debug.Logger.Level.predefinedLevelsCache_ = {};\n  for (var i = 0, level; level = goog.debug.Logger.Level.PREDEFINED_LEVELS[i];\n       i++) {\n    goog.debug.Logger.Level.predefinedLevelsCache_[level.value] = level;\n    goog.debug.Logger.Level.predefinedLevelsCache_[level.name] = level;\n  }\n};\n\n\n/**\n * Gets the predefined level with the given name.\n * @param {string} name The name of the level.\n * @return {goog.debug.Logger.Level} The level, or null if none found.\n */\ngoog.debug.Logger.Level.getPredefinedLevel = function(name) {\n  if (!goog.debug.Logger.Level.predefinedLevelsCache_) {\n    goog.debug.Logger.Level.createPredefinedLevelsCache_();\n  }\n\n  return goog.debug.Logger.Level.predefinedLevelsCache_[name] || null;\n};\n\n\n/**\n * Gets the highest predefined level <= #value.\n * @param {number} value Level value.\n * @return {goog.debug.Logger.Level} The level, or null if none found.\n */\ngoog.debug.Logger.Level.getPredefinedLevelByValue = function(value) {\n  if (!goog.debug.Logger.Level.predefinedLevelsCache_) {\n    goog.debug.Logger.Level.createPredefinedLevelsCache_();\n  }\n\n  if (value in /** @type {!Object} */ (\n          goog.debug.Logger.Level.predefinedLevelsCache_)) {\n    return goog.debug.Logger.Level.predefinedLevelsCache_[value];\n  }\n\n  for (var i = 0; i < goog.debug.Logger.Level.PREDEFINED_LEVELS.length; ++i) {\n    var level = goog.debug.Logger.Level.PREDEFINED_LEVELS[i];\n    if (level.value <= value) {\n      return level;\n    }\n  }\n  return null;\n};\n\n\n/**\n * Finds or creates a logger for a named subsystem. If a logger has already been\n * created with the given name it is returned. Otherwise a new logger is\n * created. If a new logger is created its log level will be configured based\n * on the LogManager configuration and it will configured to also send logging\n * output to its parent's handlers. It will be registered in the LogManager\n * global namespace.\n *\n * @param {string} name A name for the logger. This should be a dot-separated\n * name and should normally be based on the package name or class name of the\n * subsystem, such as goog.net.BrowserChannel.\n * @return {!goog.debug.Logger} The named logger.\n * @deprecated use {@link goog.log} instead.\n */\ngoog.debug.Logger.getLogger = function(name) {\n  return goog.debug.LogManager.getLogger(name);\n};\n\n\n/**\n * Logs a message to profiling tools, if available.\n * {@see https://developers.google.com/web-toolkit/speedtracer/logging-api}\n * {@see http://msdn.microsoft.com/en-us/library/dd433074(VS.85).aspx}\n * @param {string} msg The message to log.\n */\ngoog.debug.Logger.logToProfilers = function(msg) {\n  // Some browsers also log timeStamp calls to the console, only log\n  // if actually asked.\n  if (goog.debug.Logger.ENABLE_PROFILER_LOGGING) {\n    var msWriteProfilerMark = goog.global['msWriteProfilerMark'];\n    if (msWriteProfilerMark) {\n      // Logs a message to the Microsoft profiler\n      // On IE, console['timeStamp'] may output to console\n      msWriteProfilerMark(msg);\n      return;\n    }\n\n    // Using goog.global, as loggers might be used in window-less contexts.\n    var console = goog.global['console'];\n    if (console && console['timeStamp']) {\n      // Logs a message to Firebug, Web Inspector, SpeedTracer, etc.\n      console['timeStamp'](msg);\n    }\n  }\n};\n\n\n/**\n * Gets the name of this logger.\n * @return {string} The name of this logger.\n */\ngoog.debug.Logger.prototype.getName = function() {\n  return this.name_;\n};\n\n\n/**\n * Adds a handler to the logger. This doesn't use the event system because\n * we want to be able to add logging to the event system.\n * @param {Function} handler Handler function to add.\n */\ngoog.debug.Logger.prototype.addHandler = function(handler) {\n  if (goog.debug.LOGGING_ENABLED) {\n    if (goog.debug.Logger.ENABLE_HIERARCHY) {\n      if (!this.handlers_) {\n        this.handlers_ = [];\n      }\n      this.handlers_.push(handler);\n    } else {\n      goog.asserts.assert(\n          !this.name_, 'Cannot call addHandler on a non-root logger when ' +\n              'goog.debug.Logger.ENABLE_HIERARCHY is false.');\n      goog.debug.Logger.rootHandlers_.push(handler);\n    }\n  }\n};\n\n\n/**\n * Removes a handler from the logger. This doesn't use the event system because\n * we want to be able to add logging to the event system.\n * @param {Function} handler Handler function to remove.\n * @return {boolean} Whether the handler was removed.\n */\ngoog.debug.Logger.prototype.removeHandler = function(handler) {\n  if (goog.debug.LOGGING_ENABLED) {\n    var handlers = goog.debug.Logger.ENABLE_HIERARCHY ?\n        this.handlers_ :\n        goog.debug.Logger.rootHandlers_;\n    return !!handlers && goog.array.remove(handlers, handler);\n  } else {\n    return false;\n  }\n};\n\n\n/**\n * Returns the parent of this logger.\n * @return {goog.debug.Logger} The parent logger or null if this is the root.\n */\ngoog.debug.Logger.prototype.getParent = function() {\n  return this.parent_;\n};\n\n\n/**\n * Returns the children of this logger as a map of the child name to the logger.\n * @return {!Object} The map where the keys are the child leaf names and the\n *     values are the Logger objects.\n */\ngoog.debug.Logger.prototype.getChildren = function() {\n  if (!this.children_) {\n    this.children_ = {};\n  }\n  return this.children_;\n};\n\n\n/**\n * Set the log level specifying which message levels will be logged by this\n * logger. Message levels lower than this value will be discarded.\n * The level value Level.OFF can be used to turn off logging. If the new level\n * is null, it means that this node should inherit its level from its nearest\n * ancestor with a specific (non-null) level value.\n *\n * @param {goog.debug.Logger.Level} level The new level.\n */\ngoog.debug.Logger.prototype.setLevel = function(level) {\n  if (goog.debug.LOGGING_ENABLED) {\n    if (goog.debug.Logger.ENABLE_HIERARCHY) {\n      this.level_ = level;\n    } else {\n      goog.asserts.assert(\n          !this.name_, 'Cannot call setLevel() on a non-root logger when ' +\n              'goog.debug.Logger.ENABLE_HIERARCHY is false.');\n      goog.debug.Logger.rootLevel_ = level;\n    }\n  }\n};\n\n\n/**\n * Gets the log level specifying which message levels will be logged by this\n * logger. Message levels lower than this value will be discarded.\n * The level value Level.OFF can be used to turn off logging. If the level\n * is null, it means that this node should inherit its level from its nearest\n * ancestor with a specific (non-null) level value.\n *\n * @return {goog.debug.Logger.Level} The level.\n */\ngoog.debug.Logger.prototype.getLevel = function() {\n  return goog.debug.LOGGING_ENABLED ? this.level_ : goog.debug.Logger.Level.OFF;\n};\n\n\n/**\n * Returns the effective level of the logger based on its ancestors' levels.\n * @return {goog.debug.Logger.Level} The level.\n */\ngoog.debug.Logger.prototype.getEffectiveLevel = function() {\n  if (!goog.debug.LOGGING_ENABLED) {\n    return goog.debug.Logger.Level.OFF;\n  }\n\n  if (!goog.debug.Logger.ENABLE_HIERARCHY) {\n    return goog.debug.Logger.rootLevel_;\n  }\n  if (this.level_) {\n    return this.level_;\n  }\n  if (this.parent_) {\n    return this.parent_.getEffectiveLevel();\n  }\n  goog.asserts.fail('Root logger has no level set.');\n  return null;\n};\n\n\n/**\n * Checks if a message of the given level would actually be logged by this\n * logger. This check is based on the Loggers effective level, which may be\n * inherited from its parent.\n * @param {goog.debug.Logger.Level} level The level to check.\n * @return {boolean} Whether the message would be logged.\n */\ngoog.debug.Logger.prototype.isLoggable = function(level) {\n  return goog.debug.LOGGING_ENABLED &&\n      level.value >= this.getEffectiveLevel().value;\n};\n\n\n/**\n * Logs a message. If the logger is currently enabled for the\n * given message level then the given message is forwarded to all the\n * registered output Handler objects.\n * @param {goog.debug.Logger.Level} level One of the level identifiers.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error|Object=} opt_exception An exception associated with the\n *     message.\n */\ngoog.debug.Logger.prototype.log = function(level, msg, opt_exception) {\n  // java caches the effective level, not sure it's necessary here\n  if (goog.debug.LOGGING_ENABLED && this.isLoggable(level)) {\n    // Message callbacks can be useful when a log message is expensive to build.\n    if (goog.isFunction(msg)) {\n      msg = msg();\n    }\n\n    this.doLogRecord_(this.getLogRecord(level, msg, opt_exception));\n  }\n};\n\n\n/**\n * Creates a new log record and adds the exception (if present) to it.\n * @param {goog.debug.Logger.Level} level One of the level identifiers.\n * @param {string} msg The string message.\n * @param {Error|Object=} opt_exception An exception associated with the\n *     message.\n * @return {!goog.debug.LogRecord} A log record.\n * @suppress {es5Strict}\n */\ngoog.debug.Logger.prototype.getLogRecord = function(level, msg, opt_exception) {\n  if (goog.debug.LogBuffer.isBufferingEnabled()) {\n    var logRecord =\n        goog.debug.LogBuffer.getInstance().addRecord(level, msg, this.name_);\n  } else {\n    logRecord = new goog.debug.LogRecord(level, String(msg), this.name_);\n  }\n  if (opt_exception) {\n    logRecord.setException(opt_exception);\n  }\n  return logRecord;\n};\n\n\n/**\n * Logs a message at the Logger.Level.SHOUT level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.debug.Logger.prototype.shout = function(msg, opt_exception) {\n  if (goog.debug.LOGGING_ENABLED) {\n    this.log(goog.debug.Logger.Level.SHOUT, msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Logger.Level.SEVERE level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.debug.Logger.prototype.severe = function(msg, opt_exception) {\n  if (goog.debug.LOGGING_ENABLED) {\n    this.log(goog.debug.Logger.Level.SEVERE, msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Logger.Level.WARNING level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.debug.Logger.prototype.warning = function(msg, opt_exception) {\n  if (goog.debug.LOGGING_ENABLED) {\n    this.log(goog.debug.Logger.Level.WARNING, msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Logger.Level.INFO level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.debug.Logger.prototype.info = function(msg, opt_exception) {\n  if (goog.debug.LOGGING_ENABLED) {\n    this.log(goog.debug.Logger.Level.INFO, msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Logger.Level.CONFIG level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.debug.Logger.prototype.config = function(msg, opt_exception) {\n  if (goog.debug.LOGGING_ENABLED) {\n    this.log(goog.debug.Logger.Level.CONFIG, msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Logger.Level.FINE level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.debug.Logger.prototype.fine = function(msg, opt_exception) {\n  if (goog.debug.LOGGING_ENABLED) {\n    this.log(goog.debug.Logger.Level.FINE, msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Logger.Level.FINER level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.debug.Logger.prototype.finer = function(msg, opt_exception) {\n  if (goog.debug.LOGGING_ENABLED) {\n    this.log(goog.debug.Logger.Level.FINER, msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Logger.Level.FINEST level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.debug.Logger.prototype.finest = function(msg, opt_exception) {\n  if (goog.debug.LOGGING_ENABLED) {\n    this.log(goog.debug.Logger.Level.FINEST, msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a LogRecord. If the logger is currently enabled for the\n * given message level then the given message is forwarded to all the\n * registered output Handler objects.\n * @param {goog.debug.LogRecord} logRecord A log record to log.\n */\ngoog.debug.Logger.prototype.logRecord = function(logRecord) {\n  if (goog.debug.LOGGING_ENABLED && this.isLoggable(logRecord.getLevel())) {\n    this.doLogRecord_(logRecord);\n  }\n};\n\n\n/**\n * Logs a LogRecord.\n * @param {goog.debug.LogRecord} logRecord A log record to log.\n * @private\n */\ngoog.debug.Logger.prototype.doLogRecord_ = function(logRecord) {\n  if (goog.debug.Logger.ENABLE_PROFILER_LOGGING) {\n    goog.debug.Logger.logToProfilers('log:' + logRecord.getMessage());\n  }\n  if (goog.debug.Logger.ENABLE_HIERARCHY) {\n    var target = this;\n    while (target) {\n      target.callPublish_(logRecord);\n      target = target.getParent();\n    }\n  } else {\n    for (var i = 0, handler; handler = goog.debug.Logger.rootHandlers_[i++];) {\n      handler(logRecord);\n    }\n  }\n};\n\n\n/**\n * Calls the handlers for publish.\n * @param {goog.debug.LogRecord} logRecord The log record to publish.\n * @private\n */\ngoog.debug.Logger.prototype.callPublish_ = function(logRecord) {\n  if (this.handlers_) {\n    for (var i = 0, handler; handler = this.handlers_[i]; i++) {\n      handler(logRecord);\n    }\n  }\n};\n\n\n/**\n * Sets the parent of this logger. This is used for setting up the logger tree.\n * @param {goog.debug.Logger} parent The parent logger.\n * @private\n */\ngoog.debug.Logger.prototype.setParent_ = function(parent) {\n  this.parent_ = parent;\n};\n\n\n/**\n * Adds a child to this logger. This is used for setting up the logger tree.\n * @param {string} name The leaf name of the child.\n * @param {goog.debug.Logger} logger The child logger.\n * @private\n */\ngoog.debug.Logger.prototype.addChild_ = function(name, logger) {\n  this.getChildren()[name] = logger;\n};\n\n\n/**\n * There is a single global LogManager object that is used to maintain a set of\n * shared state about Loggers and log services. This is loosely based on the\n * java class java.util.logging.LogManager.\n * @const\n */\ngoog.debug.LogManager = {};\n\n\n/**\n * Map of logger names to logger objects.\n *\n * @type {!Object<string, !goog.debug.Logger>}\n * @private\n */\ngoog.debug.LogManager.loggers_ = {};\n\n\n/**\n * The root logger which is the root of the logger tree.\n * @type {?goog.debug.Logger}\n * @private\n */\ngoog.debug.LogManager.rootLogger_ = null;\n\n\n/**\n * Initializes the LogManager if not already initialized.\n */\ngoog.debug.LogManager.initialize = function() {\n  if (!goog.debug.LogManager.rootLogger_) {\n    goog.debug.LogManager.rootLogger_ =\n        new goog.debug.Logger(goog.debug.Logger.ROOT_LOGGER_NAME);\n    goog.debug.LogManager.loggers_[goog.debug.Logger.ROOT_LOGGER_NAME] =\n        goog.debug.LogManager.rootLogger_;\n    goog.debug.LogManager.rootLogger_.setLevel(goog.debug.Logger.Level.CONFIG);\n  }\n};\n\n\n/**\n * Returns all the loggers.\n * @return {!Object<string, !goog.debug.Logger>} Map of logger names to logger\n *     objects.\n */\ngoog.debug.LogManager.getLoggers = function() {\n  return goog.debug.LogManager.loggers_;\n};\n\n\n/**\n * Returns the root of the logger tree namespace, the logger with the empty\n * string as its name.\n *\n * @return {!goog.debug.Logger} The root logger.\n */\ngoog.debug.LogManager.getRoot = function() {\n  goog.debug.LogManager.initialize();\n  return /** @type {!goog.debug.Logger} */ (goog.debug.LogManager.rootLogger_);\n};\n\n\n/**\n * Finds a named logger.\n *\n * @param {string} name A name for the logger. This should be a dot-separated\n * name and should normally be based on the package name or class name of the\n * subsystem, such as goog.net.BrowserChannel.\n * @return {!goog.debug.Logger} The named logger.\n */\ngoog.debug.LogManager.getLogger = function(name) {\n  goog.debug.LogManager.initialize();\n  var ret = goog.debug.LogManager.loggers_[name];\n  return ret || goog.debug.LogManager.createLogger_(name);\n};\n\n\n/**\n * Creates a function that can be passed to goog.debug.catchErrors. The function\n * will log all reported errors using the given logger.\n * @param {goog.debug.Logger=} opt_logger The logger to log the errors to.\n *     Defaults to the root logger.\n * @return {function(Object)} The created function.\n */\ngoog.debug.LogManager.createFunctionForCatchErrors = function(opt_logger) {\n  return function(info) {\n    var logger = opt_logger || goog.debug.LogManager.getRoot();\n    logger.severe(\n        'Error: ' + info.message + ' (' + info.fileName + ' @ Line: ' +\n        info.line + ')');\n  };\n};\n\n\n/**\n * Creates the named logger. Will also create the parents of the named logger\n * if they don't yet exist.\n * @param {string} name The name of the logger.\n * @return {!goog.debug.Logger} The named logger.\n * @private\n */\ngoog.debug.LogManager.createLogger_ = function(name) {\n  // find parent logger\n  var logger = new goog.debug.Logger(name);\n  if (goog.debug.Logger.ENABLE_HIERARCHY) {\n    var lastDotIndex = name.lastIndexOf('.');\n    var parentName = name.substr(0, lastDotIndex);\n    var leafName = name.substr(lastDotIndex + 1);\n    var parentLogger = goog.debug.LogManager.getLogger(parentName);\n\n    // tell the parent about the child and the child about the parent\n    parentLogger.addChild_(leafName, logger);\n    logger.setParent_(parentLogger);\n  }\n\n  goog.debug.LogManager.loggers_[name] = logger;\n  return logger;\n};\n","// Copyright 2008 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Utilities for creating functions. Loosely inspired by these\n * java classes from the Guava library:\n * com.google.common.base.Functions\n * https://google.github.io/guava/releases/snapshot-jre/api/docs/index.html?com/google/common/base/Functions.html\n *\n * com.google.common.base.Predicates\n * https://google.github.io/guava/releases/snapshot-jre/api/docs/index.html?com/google/common/base/Predicates.html\n *\n * More about these can be found at\n * https://github.com/google/guava/wiki/FunctionalExplained\n *\n * @author nicksantos@google.com (Nick Santos)\n */\n\n\ngoog.provide('goog.functions');\n\n\n/**\n * Creates a function that always returns the same value.\n * @param {T} retValue The value to return.\n * @return {function():T} The new function.\n * @template T\n */\ngoog.functions.constant = function(retValue) {\n  return function() { return retValue; };\n};\n\n\n/**\n * Always returns false.\n * @type {function(...): boolean}\n */\ngoog.functions.FALSE = function() {\n  return false;\n};\n\n\n/**\n * Always returns true.\n * @type {function(...): boolean}\n */\ngoog.functions.TRUE = function() {\n  return true;\n};\n\n\n/**\n * Always returns NULL.\n * @type {function(...): null}\n */\ngoog.functions.NULL = function() {\n  return null;\n};\n\n\n/**\n * A simple function that returns the first argument of whatever is passed\n * into it.\n * @param {T=} opt_returnValue The single value that will be returned.\n * @param {...*} var_args Optional trailing arguments. These are ignored.\n * @return {T} The first argument passed in, or undefined if nothing was passed.\n * @template T\n */\ngoog.functions.identity = function(opt_returnValue, var_args) {\n  return opt_returnValue;\n};\n\n\n/**\n * Creates a function that always throws an error with the given message.\n * @param {string} message The error message.\n * @return {!Function} The error-throwing function.\n */\ngoog.functions.error = function(message) {\n  return function() {\n    throw new Error(message);\n  };\n};\n\n\n/**\n * Creates a function that throws the given object.\n * @param {*} err An object to be thrown.\n * @return {!Function} The error-throwing function.\n */\ngoog.functions.fail = function(err) {\n  return function() { throw err; };\n};\n\n\n/**\n * Given a function, create a function that keeps opt_numArgs arguments and\n * silently discards all additional arguments.\n * @param {Function} f The original function.\n * @param {number=} opt_numArgs The number of arguments to keep. Defaults to 0.\n * @return {!Function} A version of f that only keeps the first opt_numArgs\n *     arguments.\n */\ngoog.functions.lock = function(f, opt_numArgs) {\n  opt_numArgs = opt_numArgs || 0;\n  return function() {\n    var self = /** @type {*} */ (this);\n    return f.apply(self, Array.prototype.slice.call(arguments, 0, opt_numArgs));\n  };\n};\n\n\n/**\n * Creates a function that returns its nth argument.\n * @param {number} n The position of the return argument.\n * @return {!Function} A new function.\n */\ngoog.functions.nth = function(n) {\n  return function() { return arguments[n]; };\n};\n\n\n/**\n * Like goog.partial(), except that arguments are added after arguments to the\n * returned function.\n *\n * Usage:\n * function f(arg1, arg2, arg3, arg4) { ... }\n * var g = goog.functions.partialRight(f, arg3, arg4);\n * g(arg1, arg2);\n *\n * @param {!Function} fn A function to partially apply.\n * @param {...*} var_args Additional arguments that are partially applied to fn\n *     at the end.\n * @return {!Function} A partially-applied form of the function goog.partial()\n *     was invoked as a method of.\n */\ngoog.functions.partialRight = function(fn, var_args) {\n  var rightArgs = Array.prototype.slice.call(arguments, 1);\n  return function() {\n    var self = /** @type {*} */ (this);\n    var newArgs = Array.prototype.slice.call(arguments);\n    newArgs.push.apply(newArgs, rightArgs);\n    return fn.apply(self, newArgs);\n  };\n};\n\n\n/**\n * Given a function, create a new function that swallows its return value\n * and replaces it with a new one.\n * @param {Function} f A function.\n * @param {T} retValue A new return value.\n * @return {function(...?):T} A new function.\n * @template T\n */\ngoog.functions.withReturnValue = function(f, retValue) {\n  return goog.functions.sequence(f, goog.functions.constant(retValue));\n};\n\n\n/**\n * Creates a function that returns whether its argument equals the given value.\n *\n * Example:\n * var key = goog.object.findKey(obj, goog.functions.equalTo('needle'));\n *\n * @param {*} value The value to compare to.\n * @param {boolean=} opt_useLooseComparison Whether to use a loose (==)\n *     comparison rather than a strict (===) one. Defaults to false.\n * @return {function(*):boolean} The new function.\n */\ngoog.functions.equalTo = function(value, opt_useLooseComparison) {\n  return function(other) {\n    return opt_useLooseComparison ? (value == other) : (value === other);\n  };\n};\n\n\n/**\n * Creates the composition of the functions passed in.\n * For example, (goog.functions.compose(f, g))(a) is equivalent to f(g(a)).\n * @param {function(...?):T} fn The final function.\n * @param {...Function} var_args A list of functions.\n * @return {function(...?):T} The composition of all inputs.\n * @template T\n */\ngoog.functions.compose = function(fn, var_args) {\n  var functions = arguments;\n  var length = functions.length;\n  return function() {\n    var self = /** @type {*} */ (this);\n    var result;\n    if (length) {\n      result = functions[length - 1].apply(self, arguments);\n    }\n\n    for (var i = length - 2; i >= 0; i--) {\n      result = functions[i].call(self, result);\n    }\n    return result;\n  };\n};\n\n\n/**\n * Creates a function that calls the functions passed in in sequence, and\n * returns the value of the last function. For example,\n * (goog.functions.sequence(f, g))(x) is equivalent to f(x),g(x).\n * @param {...Function} var_args A list of functions.\n * @return {!Function} A function that calls all inputs in sequence.\n */\ngoog.functions.sequence = function(var_args) {\n  var functions = arguments;\n  var length = functions.length;\n  return function() {\n    var self = /** @type {*} */ (this);\n    var result;\n    for (var i = 0; i < length; i++) {\n      result = functions[i].apply(self, arguments);\n    }\n    return result;\n  };\n};\n\n\n/**\n * Creates a function that returns true if each of its components evaluates\n * to true. The components are evaluated in order, and the evaluation will be\n * short-circuited as soon as a function returns false.\n * For example, (goog.functions.and(f, g))(x) is equivalent to f(x) && g(x).\n * @param {...Function} var_args A list of functions.\n * @return {function(...?):boolean} A function that ANDs its component\n *      functions.\n */\ngoog.functions.and = function(var_args) {\n  var functions = arguments;\n  var length = functions.length;\n  return function() {\n    var self = /** @type {*} */ (this);\n    for (var i = 0; i < length; i++) {\n      if (!functions[i].apply(self, arguments)) {\n        return false;\n      }\n    }\n    return true;\n  };\n};\n\n\n/**\n * Creates a function that returns true if any of its components evaluates\n * to true. The components are evaluated in order, and the evaluation will be\n * short-circuited as soon as a function returns true.\n * For example, (goog.functions.or(f, g))(x) is equivalent to f(x) || g(x).\n * @param {...Function} var_args A list of functions.\n * @return {function(...?):boolean} A function that ORs its component\n *    functions.\n */\ngoog.functions.or = function(var_args) {\n  var functions = arguments;\n  var length = functions.length;\n  return function() {\n    var self = /** @type {*} */ (this);\n    for (var i = 0; i < length; i++) {\n      if (functions[i].apply(self, arguments)) {\n        return true;\n      }\n    }\n    return false;\n  };\n};\n\n\n/**\n * Creates a function that returns the Boolean opposite of a provided function.\n * For example, (goog.functions.not(f))(x) is equivalent to !f(x).\n * @param {!Function} f The original function.\n * @return {function(...?):boolean} A function that delegates to f and returns\n * opposite.\n */\ngoog.functions.not = function(f) {\n  return function() {\n    var self = /** @type {*} */ (this);\n    return !f.apply(self, arguments);\n  };\n};\n\n\n/**\n * Generic factory function to construct an object given the constructor\n * and the arguments. Intended to be bound to create object factories.\n *\n * Example:\n *\n * var factory = goog.partial(goog.functions.create, Class);\n *\n * @param {function(new:T, ...)} constructor The constructor for the Object.\n * @param {...*} var_args The arguments to be passed to the constructor.\n * @return {T} A new instance of the class given in `constructor`.\n * @template T\n */\ngoog.functions.create = function(constructor, var_args) {\n  /**\n   * @constructor\n   * @final\n   */\n  var temp = function() {};\n  temp.prototype = constructor.prototype;\n\n  // obj will have constructor's prototype in its chain and\n  // 'obj instanceof constructor' will be true.\n  var obj = new temp();\n\n  // obj is initialized by constructor.\n  // arguments is only array-like so lacks shift(), but can be used with\n  // the Array prototype function.\n  constructor.apply(obj, Array.prototype.slice.call(arguments, 1));\n  return obj;\n};\n\n\n/**\n * @define {boolean} Whether the return value cache should be used.\n *    This should only be used to disable caches when testing.\n */\ngoog.functions.CACHE_RETURN_VALUE =\n    goog.define('goog.functions.CACHE_RETURN_VALUE', true);\n\n\n/**\n * Gives a wrapper function that caches the return value of a parameterless\n * function when first called.\n *\n * When called for the first time, the given function is called and its\n * return value is cached (thus this is only appropriate for idempotent\n * functions).  Subsequent calls will return the cached return value. This\n * allows the evaluation of expensive functions to be delayed until first used.\n *\n * To cache the return values of functions with parameters, see goog.memoize.\n *\n * @param {function():T} fn A function to lazily evaluate.\n * @return {function():T} A wrapped version the function.\n * @template T\n */\ngoog.functions.cacheReturnValue = function(fn) {\n  var called = false;\n  var value;\n\n  return function() {\n    if (!goog.functions.CACHE_RETURN_VALUE) {\n      return fn();\n    }\n\n    if (!called) {\n      value = fn();\n      called = true;\n    }\n\n    return value;\n  };\n};\n\n\n/**\n * Wraps a function to allow it to be called, at most, once. All\n * additional calls are no-ops.\n *\n * This is particularly useful for initialization functions\n * that should be called, at most, once.\n *\n * @param {function():*} f Function to call.\n * @return {function():undefined} Wrapped function.\n */\ngoog.functions.once = function(f) {\n  // Keep a reference to the function that we null out when we're done with\n  // it -- that way, the function can be GC'd when we're done with it.\n  var inner = f;\n  return function() {\n    if (inner) {\n      var tmp = inner;\n      inner = null;\n      tmp();\n    }\n  };\n};\n\n\n/**\n * Wraps a function to allow it to be called, at most, once per interval\n * (specified in milliseconds). If the wrapper function is called N times within\n * that interval, only the Nth call will go through.\n *\n * This is particularly useful for batching up repeated actions where the\n * last action should win. This can be used, for example, for refreshing an\n * autocomplete pop-up every so often rather than updating with every keystroke,\n * since the final text typed by the user is the one that should produce the\n * final autocomplete results. For more stateful debouncing with support for\n * pausing, resuming, and canceling debounced actions, use\n * `goog.async.Debouncer`.\n *\n * @param {function(this:SCOPE, ...?)} f Function to call.\n * @param {number} interval Interval over which to debounce. The function will\n *     only be called after the full interval has elapsed since the last call.\n * @param {SCOPE=} opt_scope Object in whose scope to call the function.\n * @return {function(...?): undefined} Wrapped function.\n * @template SCOPE\n */\ngoog.functions.debounce = function(f, interval, opt_scope) {\n  var timeout = 0;\n  return /** @type {function(...?)} */ (function(var_args) {\n    goog.global.clearTimeout(timeout);\n    var args = arguments;\n    timeout = goog.global.setTimeout(function() {\n      f.apply(opt_scope, args);\n    }, interval);\n  });\n};\n\n\n/**\n * Wraps a function to allow it to be called, at most, once per interval\n * (specified in milliseconds). If the wrapper function is called N times in\n * that interval, both the 1st and the Nth calls will go through.\n *\n * This is particularly useful for limiting repeated user requests where the\n * the last action should win, but you also don't want to wait until the end of\n * the interval before sending a request out, as it leads to a perception of\n * slowness for the user.\n *\n * @param {function(this:SCOPE, ...?)} f Function to call.\n * @param {number} interval Interval over which to throttle. The function can\n *     only be called once per interval.\n * @param {SCOPE=} opt_scope Object in whose scope to call the function.\n * @return {function(...?): undefined} Wrapped function.\n * @template SCOPE\n */\ngoog.functions.throttle = function(f, interval, opt_scope) {\n  var timeout = 0;\n  var shouldFire = false;\n  var args = [];\n\n  var handleTimeout = function() {\n    timeout = 0;\n    if (shouldFire) {\n      shouldFire = false;\n      fire();\n    }\n  };\n\n  var fire = function() {\n    timeout = goog.global.setTimeout(handleTimeout, interval);\n    f.apply(opt_scope, args);\n  };\n\n  return /** @type {function(...?)} */ (function(var_args) {\n    args = arguments;\n    if (!timeout) {\n      fire();\n    } else {\n      shouldFire = true;\n    }\n  });\n};\n\n\n/**\n * Wraps a function to allow it to be called, at most, once per interval\n * (specified in milliseconds). If the wrapper function is called N times within\n * that interval, only the 1st call will go through.\n *\n * This is particularly useful for limiting repeated user requests where the\n * first request is guaranteed to have all the data required to perform the\n * final action, so there's no need to wait until the end of the interval before\n * sending the request out.\n *\n * @param {function(this:SCOPE, ...?)} f Function to call.\n * @param {number} interval Interval over which to rate-limit. The function will\n *     only be called once per interval, and ignored for the remainer of the\n *     interval.\n * @param {SCOPE=} opt_scope Object in whose scope to call the function.\n * @return {function(...?): undefined} Wrapped function.\n * @template SCOPE\n */\ngoog.functions.rateLimit = function(f, interval, opt_scope) {\n  var timeout = 0;\n\n  var handleTimeout = function() {\n    timeout = 0;\n  };\n\n  return /** @type {function(...?)} */ (function(var_args) {\n    if (!timeout) {\n      timeout = goog.global.setTimeout(handleTimeout, interval);\n      f.apply(opt_scope, arguments);\n    }\n  });\n};\n","// Copyright 2013 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Basic strippable logging definitions.\n * @see http://go/closurelogging\n *\n * @author johnlenz@google.com (John Lenz)\n */\n\ngoog.provide('goog.log');\ngoog.provide('goog.log.Level');\ngoog.provide('goog.log.LogRecord');\ngoog.provide('goog.log.Logger');\n\ngoog.require('goog.debug');\ngoog.require('goog.debug.LogManager');\ngoog.require('goog.debug.LogRecord');\ngoog.require('goog.debug.Logger');\n\n\n/** @define {boolean} Whether logging is enabled. */\ngoog.log.ENABLED = goog.define('goog.log.ENABLED', goog.debug.LOGGING_ENABLED);\n\n\n/** @const {string} */\ngoog.log.ROOT_LOGGER_NAME = goog.debug.Logger.ROOT_LOGGER_NAME;\n\n\n\n/**\n * @constructor\n * @final\n */\ngoog.log.Logger = goog.debug.Logger;\n\n\n\n/**\n * @constructor\n * @final\n */\ngoog.log.Level = goog.debug.Logger.Level;\n\n\n\n/**\n * @constructor\n * @final\n */\ngoog.log.LogRecord = goog.debug.LogRecord;\n\n\n/**\n * Finds or creates a logger for a named subsystem. If a logger has already been\n * created with the given name it is returned. Otherwise a new logger is\n * created. If a new logger is created its log level will be configured based\n * on the goog.debug.LogManager configuration and it will configured to also\n * send logging output to its parent's handlers.\n * @see goog.debug.LogManager\n *\n * @param {string} name A name for the logger. This should be a dot-separated\n *     name and should normally be based on the package name or class name of\n *     the subsystem, such as goog.net.BrowserChannel.\n * @param {goog.log.Level=} opt_level If provided, override the\n *     default logging level with the provided level.\n * @return {goog.log.Logger} The named logger or null if logging is disabled.\n */\ngoog.log.getLogger = function(name, opt_level) {\n  if (goog.log.ENABLED) {\n    var logger = goog.debug.LogManager.getLogger(name);\n    if (opt_level && logger) {\n      logger.setLevel(opt_level);\n    }\n    return logger;\n  } else {\n    return null;\n  }\n};\n\n\n// TODO(johnlenz): try to tighten the types to these functions.\n/**\n * Adds a handler to the logger. This doesn't use the event system because\n * we want to be able to add logging to the event system.\n * @param {goog.log.Logger} logger\n * @param {Function} handler Handler function to add.\n */\ngoog.log.addHandler = function(logger, handler) {\n  if (goog.log.ENABLED && logger) {\n    logger.addHandler(handler);\n  }\n};\n\n\n/**\n * Removes a handler from the logger. This doesn't use the event system because\n * we want to be able to add logging to the event system.\n * @param {goog.log.Logger} logger\n * @param {Function} handler Handler function to remove.\n * @return {boolean} Whether the handler was removed.\n */\ngoog.log.removeHandler = function(logger, handler) {\n  if (goog.log.ENABLED && logger) {\n    return logger.removeHandler(handler);\n  } else {\n    return false;\n  }\n};\n\n\n/**\n * Logs a message. If the logger is currently enabled for the\n * given message level then the given message is forwarded to all the\n * registered output Handler objects.\n * @param {goog.log.Logger} logger\n * @param {goog.log.Level} level One of the level identifiers.\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error|Object=} opt_exception An exception associated with the\n *     message.\n */\ngoog.log.log = function(logger, level, msg, opt_exception) {\n  if (goog.log.ENABLED && logger) {\n    logger.log(level, msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Level.SEVERE level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.log.Logger} logger\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.log.error = function(logger, msg, opt_exception) {\n  if (goog.log.ENABLED && logger) {\n    logger.severe(msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Level.WARNING level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.log.Logger} logger\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.log.warning = function(logger, msg, opt_exception) {\n  if (goog.log.ENABLED && logger) {\n    logger.warning(msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Level.INFO level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.log.Logger} logger\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.log.info = function(logger, msg, opt_exception) {\n  if (goog.log.ENABLED && logger) {\n    logger.info(msg, opt_exception);\n  }\n};\n\n\n/**\n * Logs a message at the Level.Fine level.\n * If the logger is currently enabled for the given message level then the\n * given message is forwarded to all the registered output Handler objects.\n * @param {goog.log.Logger} logger\n * @param {goog.debug.Loggable} msg The message to log.\n * @param {Error=} opt_exception An exception associated with the message.\n */\ngoog.log.fine = function(logger, msg, opt_exception) {\n  if (goog.log.ENABLED && logger) {\n    logger.fine(msg, opt_exception);\n  }\n};\n","// Copyright 2015 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\ngoog.provide('goog.net.FetchXmlHttp');\ngoog.provide('goog.net.FetchXmlHttpFactory');\n\ngoog.require('goog.asserts');\ngoog.require('goog.events.EventTarget');\ngoog.require('goog.functions');\ngoog.require('goog.log');\ngoog.require('goog.net.XhrLike');\ngoog.require('goog.net.XmlHttpFactory');\n\n\n\n/**\n * Factory for creating Xhr objects that uses the native fetch() method.\n * https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\n * Note that this factory is intended for use in Service Worker only.\n * @param {!WorkerGlobalScope} worker The Service Worker global scope.\n * @extends {goog.net.XmlHttpFactory}\n * @struct\n * @constructor\n */\ngoog.net.FetchXmlHttpFactory = function(worker) {\n  goog.net.FetchXmlHttpFactory.base(this, 'constructor');\n\n  /** @private @final {!WorkerGlobalScope} */\n  this.worker_ = worker;\n\n  /** @private {!RequestCredentials|undefined} */\n  this.credentialsMode_ = undefined;\n\n  /** @private {!RequestCache|undefined} */\n  this.cacheMode_ = undefined;\n};\ngoog.inherits(goog.net.FetchXmlHttpFactory, goog.net.XmlHttpFactory);\n\n\n/** @override */\ngoog.net.FetchXmlHttpFactory.prototype.createInstance = function() {\n  var instance = new goog.net.FetchXmlHttp(this.worker_);\n  if (this.credentialsMode_) {\n    instance.setCredentialsMode(this.credentialsMode_);\n  }\n  if (this.cacheMode_) {\n    instance.setCacheMode(this.cacheMode_);\n  }\n  return instance;\n};\n\n\n/** @override */\ngoog.net.FetchXmlHttpFactory.prototype.internalGetOptions =\n    goog.functions.constant({});\n\n\n/**\n * @param {!RequestCredentials} credentialsMode The credentials mode of the\n *     Service Worker fetch.\n */\ngoog.net.FetchXmlHttpFactory.prototype.setCredentialsMode = function(\n    credentialsMode) {\n  this.credentialsMode_ = credentialsMode;\n};\n\n\n/**\n * @param {!RequestCache} cacheMode The cache mode of the Service Worker fetch.\n */\ngoog.net.FetchXmlHttpFactory.prototype.setCacheMode = function(cacheMode) {\n  this.cacheMode_ = cacheMode;\n};\n\n\n\n/**\n * FetchXmlHttp object constructor.\n * @param {!WorkerGlobalScope} worker\n * @extends {goog.events.EventTarget}\n * @implements {goog.net.XhrLike}\n * @constructor\n * @struct\n */\ngoog.net.FetchXmlHttp = function(worker) {\n  goog.net.FetchXmlHttp.base(this, 'constructor');\n\n  /** @private @final {!WorkerGlobalScope} */\n  this.worker_ = worker;\n\n  /** @private {RequestCredentials|undefined} */\n  this.credentialsMode_ = undefined;\n\n  /** @private {RequestCache|undefined} */\n  this.cacheMode_ = undefined;\n\n  /**\n   * Request state.\n   * @type {goog.net.FetchXmlHttp.RequestState}\n   */\n  this.readyState = goog.net.FetchXmlHttp.RequestState.UNSENT;\n\n  /**\n   * HTTP status.\n   * @type {number}\n   */\n  this.status = 0;\n\n  /**\n   * HTTP status string.\n   * @type {string}\n   */\n  this.statusText = '';\n\n  /**\n   * Content of the response.\n   * @type {string|!ArrayBuffer}\n   */\n  this.response = '';\n\n  /**\n   * Content of the response.\n   * @type {string}\n   */\n  this.responseText = '';\n\n  /**\n   * The type of the response.  If this is set to 'arraybuffer' the request will\n   * be discrete, streaming is only supported for text encoded requests.\n   * @type {string}\n   */\n  this.responseType = '';\n\n  /**\n   * Document response entity body.\n   * NOTE: This is always null and not supported by this class.\n   * @final {null}\n   */\n  this.responseXML = null;\n\n  /**\n   * Method to call when the state changes.\n   * @type {?function()}\n   */\n  this.onreadystatechange = null;\n\n  /** @private {!Headers} */\n  this.requestHeaders_ = new Headers();\n\n  /** @private {?Headers} */\n  this.responseHeaders_ = null;\n\n  /**\n   * Request method (GET or POST).\n   * @private {string}\n   */\n  this.method_ = 'GET';\n\n  /**\n   * Request URL.\n   * @private {string}\n   */\n  this.url_ = '';\n\n  /**\n   * Whether the request is in progress.\n   * @private {boolean}\n   */\n  this.inProgress_ = false;\n\n  /** @private @final {?goog.log.Logger} */\n  this.logger_ = goog.log.getLogger('goog.net.FetchXmlHttp');\n\n  /** @private {?Response} */\n  this.fetchResponse_ = null;\n\n  /** @private {!ReadableStreamDefaultReader|null} */\n  this.currentReader_ = null;\n\n  /** @private {?TextDecoder} */\n  this.textDecoder_ = null;\n};\ngoog.inherits(goog.net.FetchXmlHttp, goog.events.EventTarget);\n\n\n/**\n * State of the requests.\n * @enum {number}\n */\ngoog.net.FetchXmlHttp.RequestState = {\n  UNSENT: 0,\n  OPENED: 1,\n  HEADER_RECEIVED: 2,\n  LOADING: 3,\n  DONE: 4\n};\n\n\n/** @override */\ngoog.net.FetchXmlHttp.prototype.open = function(method, url, opt_async) {\n  goog.asserts.assert(!!opt_async, 'Only async requests are supported.');\n  if (this.readyState != goog.net.FetchXmlHttp.RequestState.UNSENT) {\n    this.abort();\n    throw new Error('Error reopening a connection');\n  }\n\n  this.method_ = method;\n  this.url_ = url;\n\n  this.readyState = goog.net.FetchXmlHttp.RequestState.OPENED;\n  this.dispatchCallback_();\n};\n\n\n/** @override */\ngoog.net.FetchXmlHttp.prototype.send = function(opt_data) {\n  if (this.readyState != goog.net.FetchXmlHttp.RequestState.OPENED) {\n    this.abort();\n    throw new Error('need to call open() first. ');\n  }\n\n  this.inProgress_ = true;\n  var requestInit = {\n    headers: this.requestHeaders_,\n    method: this.method_,\n    credentials: this.credentialsMode_,\n    cache: this.cacheMode_\n  };\n  if (opt_data) {\n    requestInit['body'] = opt_data;\n  }\n  this.worker_\n      .fetch(new Request(this.url_, /** @type {!RequestInit} */ (requestInit)))\n      .then(\n          this.handleResponse_.bind(this), this.handleSendFailure_.bind(this));\n};\n\n\n/** @override */\ngoog.net.FetchXmlHttp.prototype.abort = function() {\n  this.response = this.responseText = '';\n  this.requestHeaders_ = new Headers();\n  this.status = 0;\n\n  if (!!this.currentReader_) {\n    this.currentReader_.cancel('Request was aborted.');\n  }\n\n  if (((this.readyState >= goog.net.FetchXmlHttp.RequestState.OPENED) &&\n       this.inProgress_) &&\n      (this.readyState != goog.net.FetchXmlHttp.RequestState.DONE)) {\n    this.inProgress_ = false;\n    this.requestDone_(false);\n  }\n\n  this.readyState = goog.net.FetchXmlHttp.RequestState.UNSENT;\n};\n\n\n/**\n * Handles the fetch response.\n * @param {!Response} response\n * @private\n */\ngoog.net.FetchXmlHttp.prototype.handleResponse_ = function(response) {\n  if (!this.inProgress_) {\n    // The request was aborted, ignore.\n    return;\n  }\n\n  this.fetchResponse_ = response;\n\n  if (!this.responseHeaders_) {\n    this.responseHeaders_ = response.headers;\n    this.readyState = goog.net.FetchXmlHttp.RequestState.HEADER_RECEIVED;\n    this.dispatchCallback_();\n  }\n  // A callback may abort the request.\n  if (!this.inProgress_) {\n    // The request was aborted, ignore.\n    return;\n  }\n\n  this.readyState = goog.net.FetchXmlHttp.RequestState.LOADING;\n  this.dispatchCallback_();\n  // A callback may abort the request.\n  if (!this.inProgress_) {\n    // The request was aborted, ignore.\n    return;\n  }\n\n  if (this.responseType === 'arraybuffer') {\n    response.arrayBuffer().then(\n        this.handleResponseArrayBuffer_.bind(this),\n        this.handleSendFailure_.bind(this));\n  } else if (\n      typeof (goog.global.ReadableStream) !== 'undefined' &&\n      'body' in response) {\n    this.response = this.responseText = '';\n    this.currentReader_ =\n        /** @type {!ReadableStreamDefaultReader} */ (response.body.getReader());\n    this.textDecoder_ = new TextDecoder();\n    this.readInputFromFetch_();\n  } else {\n    response.text().then(\n        this.handleResponseText_.bind(this),\n        this.handleSendFailure_.bind(this));\n  }\n};\n\n\n/**\n * Reads the next chunk of data from the fetch response.\n * @private\n */\ngoog.net.FetchXmlHttp.prototype.readInputFromFetch_ = function() {\n  this.currentReader_.read()\n      .then(this.handleDataFromStream_.bind(this))\n      .catch(this.handleSendFailure_.bind(this));\n};\n\n\n/**\n * Handles a chunk of data from the fetch response stream reader.\n * @param {!IteratorResult} result\n * @private\n */\ngoog.net.FetchXmlHttp.prototype.handleDataFromStream_ = function(result) {\n  if (!this.inProgress_) {\n    // The request was aborted, ignore.\n    return;\n  }\n\n  var dataPacket = result.value ? /** @type {!Uint8Array} */ (result.value) :\n                                  new Uint8Array(0);\n  var newText = this.textDecoder_.decode(dataPacket, {stream: !result.done});\n  if (newText) {\n    this.responseText += newText;\n    this.response = this.responseText;\n  }\n\n  if (result.done) {\n    this.requestDone_(true);\n  } else {\n    this.dispatchCallback_();\n  }\n\n  if (this.readyState == goog.net.FetchXmlHttp.RequestState.LOADING) {\n    this.readInputFromFetch_();\n  }\n};\n\n\n/**\n * Handles the response text.\n * @param {string} responseText\n * @private\n */\ngoog.net.FetchXmlHttp.prototype.handleResponseText_ = function(responseText) {\n  if (!this.inProgress_) {\n    // The request was aborted, ignore.\n    return;\n  }\n  this.response = this.responseText = responseText;\n  this.requestDone_(true);\n};\n\n\n/**\n * Handles the response text.\n * @param {!ArrayBuffer} responseArrayBuffer\n * @private\n */\ngoog.net.FetchXmlHttp.prototype.handleResponseArrayBuffer_ = function(\n    responseArrayBuffer) {\n  if (!this.inProgress_) {\n    // The request was aborted, ignore.\n    return;\n  }\n  this.response = responseArrayBuffer;\n  this.requestDone_(true);\n};\n\n\n/**\n * Handles the send failure.\n * @param {*} error\n * @private\n */\ngoog.net.FetchXmlHttp.prototype.handleSendFailure_ = function(error) {\n  var e = error instanceof Error ? error : Error(error);\n  goog.log.warning(this.logger_, 'Failed to fetch url ' + this.url_, e);\n  if (!this.inProgress_) {\n    // The request was aborted, ignore.\n    return;\n  }\n  this.requestDone_(true);\n};\n\n\n/**\n * Sets the request state to DONE and performs cleanup.\n * @param {boolean} setStatus whether to set the status and statusText fields,\n * this is not necessary when the request is aborted.\n * @private\n */\ngoog.net.FetchXmlHttp.prototype.requestDone_ = function(setStatus) {\n  if (setStatus && this.fetchResponse_) {\n    this.status = this.fetchResponse_.status;\n    this.statusText = this.fetchResponse_.statusText;\n  }\n\n  this.readyState = goog.net.FetchXmlHttp.RequestState.DONE;\n\n  this.fetchResponse_ = null;\n  this.currentReader_ = null;\n  this.textDecoder_ = null;\n\n  this.dispatchCallback_();\n};\n\n\n/** @override */\ngoog.net.FetchXmlHttp.prototype.setRequestHeader = function(header, value) {\n  this.requestHeaders_.append(header, value);\n};\n\n\n/** @override */\ngoog.net.FetchXmlHttp.prototype.getResponseHeader = function(header) {\n  // TODO(b/70808323): This method should return null when the headers are not\n  // present or the specified header is missing. The externs need to be fixed.\n  if (!this.responseHeaders_) {\n    goog.log.warning(\n        this.logger_,\n        'Attempting to get response header but no headers have been received ' +\n            'for url: ' + this.url_);\n    return '';\n  }\n  return this.responseHeaders_.get(header.toLowerCase()) || '';\n};\n\n\n/** @override */\ngoog.net.FetchXmlHttp.prototype.getAllResponseHeaders = function() {\n  if (!this.responseHeaders_) {\n    goog.log.warning(\n        this.logger_,\n        'Attempting to get all response headers but no headers have been ' +\n            'received for url: ' + this.url_);\n    return '';\n  }\n  var lines = [];\n  var iter = this.responseHeaders_.entries();\n  var entry = iter.next();\n  while (!entry.done) {\n    var pair = entry.value;\n    lines.push(pair[0] + ': ' + pair[1]);\n    entry = iter.next();\n  }\n  return lines.join('\\r\\n');\n};\n\n\n/**\n * @param {!RequestCredentials} credentialsMode The credentials mode of the\n *     Service Worker fetch.\n */\ngoog.net.FetchXmlHttp.prototype.setCredentialsMode = function(credentialsMode) {\n  this.credentialsMode_ = credentialsMode;\n};\n\n\n/**\n * @param {!RequestCache} cacheMode The cache mode of the Service Worker fetch.\n */\ngoog.net.FetchXmlHttp.prototype.setCacheMode = function(cacheMode) {\n  this.cacheMode_ = cacheMode;\n};\n\n\n/**\n * Dispatches the callback, if the callback attribute is defined.\n * @private\n */\ngoog.net.FetchXmlHttp.prototype.dispatchCallback_ = function() {\n  if (this.onreadystatechange) {\n    this.onreadystatechange.call(this);\n  }\n};\n","// Copyright 2006 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Wrapper class for handling XmlHttpRequests.\n *\n * One off requests can be sent through goog.net.XhrIo.send() or an\n * instance can be created to send multiple requests.  Each request uses its\n * own XmlHttpRequest object and handles clearing of the event callback to\n * ensure no leaks.\n *\n * XhrIo is event based, it dispatches events on success, failure, finishing,\n * ready-state change, or progress (download and upload).\n *\n * The ready-state or timeout event fires first, followed by\n * a generic completed event. Then the abort, error, or success event\n * is fired as appropriate. Progress events are fired as they are\n * received. Lastly, the ready event will fire to indicate that the\n * object may be used to make another request.\n *\n * The error event may also be called before completed and\n * ready-state-change if the XmlHttpRequest.open() or .send() methods throw.\n *\n * This class does not support multiple requests, queuing, or prioritization.\n *\n * When progress events are supported by the browser, and progress is\n * enabled via .setProgressEventsEnabled(true), the\n * goog.net.EventType.PROGRESS event will be the re-dispatched browser\n * progress event. Additionally, a DOWNLOAD_PROGRESS or UPLOAD_PROGRESS event\n * will be fired for download and upload progress respectively.\n *\n */\n\n\ngoog.provide('goog.net.XhrIo');\ngoog.provide('goog.net.XhrIo.ResponseType');\n\ngoog.require('goog.Timer');\ngoog.require('goog.array');\ngoog.require('goog.asserts');\ngoog.require('goog.debug.entryPointRegistry');\ngoog.require('goog.events.EventTarget');\ngoog.require('goog.json.hybrid');\ngoog.require('goog.log');\ngoog.require('goog.net.ErrorCode');\ngoog.require('goog.net.EventType');\ngoog.require('goog.net.HttpStatus');\ngoog.require('goog.net.XmlHttp');\ngoog.require('goog.object');\ngoog.require('goog.string');\ngoog.require('goog.structs');\ngoog.require('goog.structs.Map');\ngoog.require('goog.uri.utils');\ngoog.require('goog.userAgent');\n\ngoog.forwardDeclare('goog.Uri');\n\ngoog.scope(function() {\n\n/**\n * Basic class for handling XMLHttpRequests.\n * @param {goog.net.XmlHttpFactory=} opt_xmlHttpFactory Factory to use when\n *     creating XMLHttpRequest objects.\n * @constructor\n * @extends {goog.events.EventTarget}\n */\ngoog.net.XhrIo = function(opt_xmlHttpFactory) {\n  XhrIo.base(this, 'constructor');\n\n  /**\n   * Map of default headers to add to every request, use:\n   * XhrIo.headers.set(name, value)\n   * @type {!goog.structs.Map}\n   */\n  this.headers = new goog.structs.Map();\n\n  /**\n   * Optional XmlHttpFactory\n   * @private {goog.net.XmlHttpFactory}\n   */\n  this.xmlHttpFactory_ = opt_xmlHttpFactory || null;\n\n  /**\n   * Whether XMLHttpRequest is active.  A request is active from the time send()\n   * is called until onReadyStateChange() is complete, or error() or abort()\n   * is called.\n   * @private {boolean}\n   */\n  this.active_ = false;\n\n  /**\n   * The XMLHttpRequest object that is being used for the transfer.\n   * @private {?goog.net.XhrLike.OrNative}\n   */\n  this.xhr_ = null;\n\n  /**\n   * The options to use with the current XMLHttpRequest object.\n   * @private {?Object}\n   */\n  this.xhrOptions_ = null;\n\n  /**\n   * Last URL that was requested.\n   * @private {string|goog.Uri}\n   */\n  this.lastUri_ = '';\n\n  /**\n   * Method for the last request.\n   * @private {string}\n   */\n  this.lastMethod_ = '';\n\n  /**\n   * Last error code.\n   * @private {!goog.net.ErrorCode}\n   */\n  this.lastErrorCode_ = goog.net.ErrorCode.NO_ERROR;\n\n  /**\n   * Last error message.\n   * @private {Error|string}\n   */\n  this.lastError_ = '';\n\n  /**\n   * Used to ensure that we don't dispatch an multiple ERROR events. This can\n   * happen in IE when it does a synchronous load and one error is handled in\n   * the ready statte change and one is handled due to send() throwing an\n   * exception.\n   * @private {boolean}\n   */\n  this.errorDispatched_ = false;\n\n  /**\n   * Used to make sure we don't fire the complete event from inside a send call.\n   * @private {boolean}\n   */\n  this.inSend_ = false;\n\n  /**\n   * Used in determining if a call to {@link #onReadyStateChange_} is from\n   * within a call to this.xhr_.open.\n   * @private {boolean}\n   */\n  this.inOpen_ = false;\n\n  /**\n   * Used in determining if a call to {@link #onReadyStateChange_} is from\n   * within a call to this.xhr_.abort.\n   * @private {boolean}\n   */\n  this.inAbort_ = false;\n\n  /**\n   * Number of milliseconds after which an incomplete request will be aborted\n   * and a {@link goog.net.EventType.TIMEOUT} event raised; 0 means no timeout\n   * is set.\n   * @private {number}\n   */\n  this.timeoutInterval_ = 0;\n\n  /**\n   * Timer to track request timeout.\n   * @private {?number}\n   */\n  this.timeoutId_ = null;\n\n  /**\n   * The requested type for the response. The empty string means use the default\n   * XHR behavior.\n   * @private {goog.net.XhrIo.ResponseType}\n   */\n  this.responseType_ = ResponseType.DEFAULT;\n\n  /**\n   * Whether a \"credentialed\" request is to be sent (one that is aware of\n   * cookies and authentication). This is applicable only for cross-domain\n   * requests and more recent browsers that support this part of the HTTP Access\n   * Control standard.\n   *\n   * @see http://www.w3.org/TR/XMLHttpRequest/#the-withcredentials-attribute\n   *\n   * @private {boolean}\n   */\n  this.withCredentials_ = false;\n\n  /**\n   * Whether progress events are enabled for this request. This is\n   * disabled by default because setting a progress event handler\n   * causes pre-flight OPTIONS requests to be sent for CORS requests,\n   * even in cases where a pre-flight request would not otherwise be\n   * sent.\n   *\n   * @see http://xhr.spec.whatwg.org/#security-considerations\n   *\n   * Note that this can cause problems for Firefox 22 and below, as an\n   * older \"LSProgressEvent\" will be dispatched by the browser. That\n   * progress event is no longer supported, and can lead to failures,\n   * including throwing exceptions.\n   *\n   * @see http://bugzilla.mozilla.org/show_bug.cgi?id=845631\n   * @see b/23469793\n   *\n   * @private {boolean}\n   */\n  this.progressEventsEnabled_ = false;\n\n  /**\n   * True if we can use XMLHttpRequest's timeout directly.\n   * @private {boolean}\n   */\n  this.useXhr2Timeout_ = false;\n};\ngoog.inherits(goog.net.XhrIo, goog.events.EventTarget);\n\nvar XhrIo = goog.net.XhrIo;\n\n/**\n * Response types that may be requested for XMLHttpRequests.\n * @enum {string}\n * @see http://www.w3.org/TR/XMLHttpRequest/#the-responsetype-attribute\n */\ngoog.net.XhrIo.ResponseType = {\n  DEFAULT: '',\n  TEXT: 'text',\n  DOCUMENT: 'document',\n  // Not supported as of Chrome 10.0.612.1 dev\n  BLOB: 'blob',\n  ARRAY_BUFFER: 'arraybuffer'\n};\n\nvar ResponseType = goog.net.XhrIo.ResponseType;\n\n\n/**\n * A reference to the XhrIo logger\n * @private {?goog.log.Logger}\n * @const\n */\ngoog.net.XhrIo.prototype.logger_ = goog.log.getLogger('goog.net.XhrIo');\n\n\n/**\n * The Content-Type HTTP header name\n * @type {string}\n */\ngoog.net.XhrIo.CONTENT_TYPE_HEADER = 'Content-Type';\n\n\n/**\n * The Content-Transfer-Encoding HTTP header name\n * @type {string}\n */\ngoog.net.XhrIo.CONTENT_TRANSFER_ENCODING = 'Content-Transfer-Encoding';\n\n\n/**\n * The pattern matching the 'http' and 'https' URI schemes\n * @type {!RegExp}\n */\ngoog.net.XhrIo.HTTP_SCHEME_PATTERN = /^https?$/i;\n\n\n/**\n * The methods that typically come along with form data.  We set different\n * headers depending on whether the HTTP action is one of these.\n * @type {!Array<string>}\n */\ngoog.net.XhrIo.METHODS_WITH_FORM_DATA = ['POST', 'PUT'];\n\n\n/**\n * The Content-Type HTTP header value for a url-encoded form\n * @type {string}\n */\ngoog.net.XhrIo.FORM_CONTENT_TYPE =\n    'application/x-www-form-urlencoded;charset=utf-8';\n\n\n/**\n * The XMLHttpRequest Level two timeout delay ms property name.\n *\n * @see http://www.w3.org/TR/XMLHttpRequest/#the-timeout-attribute\n *\n * @private {string}\n * @const\n */\ngoog.net.XhrIo.XHR2_TIMEOUT_ = 'timeout';\n\n\n/**\n * The XMLHttpRequest Level two ontimeout handler property name.\n *\n * @see http://www.w3.org/TR/XMLHttpRequest/#the-timeout-attribute\n *\n * @private {string}\n * @const\n */\ngoog.net.XhrIo.XHR2_ON_TIMEOUT_ = 'ontimeout';\n\n\n/**\n * All non-disposed instances of goog.net.XhrIo created\n * by {@link goog.net.XhrIo.send} are in this Array.\n * @see goog.net.XhrIo.cleanup\n * @private {!Array<!goog.net.XhrIo>}\n */\ngoog.net.XhrIo.sendInstances_ = [];\n\n\n/**\n * Static send that creates a short lived instance of XhrIo to send the\n * request.\n * @see goog.net.XhrIo.cleanup\n * @param {string|goog.Uri} url Uri to make request to.\n * @param {?function(this:goog.net.XhrIo, ?)=} opt_callback Callback function\n *     for when request is complete.\n * @param {string=} opt_method Send method, default: GET.\n * @param {ArrayBuffer|ArrayBufferView|Blob|Document|FormData|string=}\n *     opt_content Body data.\n * @param {Object|goog.structs.Map=} opt_headers Map of headers to add to the\n *     request.\n * @param {number=} opt_timeoutInterval Number of milliseconds after which an\n *     incomplete request will be aborted; 0 means no timeout is set.\n * @param {boolean=} opt_withCredentials Whether to send credentials with the\n *     request. Default to false. See {@link goog.net.XhrIo#setWithCredentials}.\n * @return {!goog.net.XhrIo} The sent XhrIo.\n */\ngoog.net.XhrIo.send = function(\n    url, opt_callback, opt_method, opt_content, opt_headers,\n    opt_timeoutInterval, opt_withCredentials) {\n  var x = new goog.net.XhrIo();\n  goog.net.XhrIo.sendInstances_.push(x);\n  if (opt_callback) {\n    x.listen(goog.net.EventType.COMPLETE, opt_callback);\n  }\n  x.listenOnce(goog.net.EventType.READY, x.cleanupSend_);\n  if (opt_timeoutInterval) {\n    x.setTimeoutInterval(opt_timeoutInterval);\n  }\n  if (opt_withCredentials) {\n    x.setWithCredentials(opt_withCredentials);\n  }\n  x.send(url, opt_method, opt_content, opt_headers);\n  return x;\n};\n\n\n/**\n * Disposes all non-disposed instances of goog.net.XhrIo created by\n * {@link goog.net.XhrIo.send}.\n * {@link goog.net.XhrIo.send} cleans up the goog.net.XhrIo instance\n * it creates when the request completes or fails.  However, if\n * the request never completes, then the goog.net.XhrIo is not disposed.\n * This can occur if the window is unloaded before the request completes.\n * We could have {@link goog.net.XhrIo.send} return the goog.net.XhrIo\n * it creates and make the client of {@link goog.net.XhrIo.send} be\n * responsible for disposing it in this case.  However, this makes things\n * significantly more complicated for the client, and the whole point\n * of {@link goog.net.XhrIo.send} is that it's simple and easy to use.\n * Clients of {@link goog.net.XhrIo.send} should call\n * {@link goog.net.XhrIo.cleanup} when doing final\n * cleanup on window unload.\n */\ngoog.net.XhrIo.cleanup = function() {\n  var instances = goog.net.XhrIo.sendInstances_;\n  while (instances.length) {\n    instances.pop().dispose();\n  }\n};\n\n\n/**\n * Installs exception protection for all entry point introduced by\n * goog.net.XhrIo instances which are not protected by\n * {@link goog.debug.ErrorHandler#protectWindowSetTimeout},\n * {@link goog.debug.ErrorHandler#protectWindowSetInterval}, or\n * {@link goog.events.protectBrowserEventEntryPoint}.\n *\n * @param {goog.debug.ErrorHandler} errorHandler Error handler with which to\n *     protect the entry point(s).\n */\ngoog.net.XhrIo.protectEntryPoints = function(errorHandler) {\n  goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_ =\n      errorHandler.protectEntryPoint(\n          goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_);\n};\n\n\n/**\n * Disposes of the specified goog.net.XhrIo created by\n * {@link goog.net.XhrIo.send} and removes it from\n * {@link goog.net.XhrIo.pendingStaticSendInstances_}.\n * @private\n */\ngoog.net.XhrIo.prototype.cleanupSend_ = function() {\n  this.dispose();\n  goog.array.remove(goog.net.XhrIo.sendInstances_, this);\n};\n\n\n/**\n * Returns the number of milliseconds after which an incomplete request will be\n * aborted, or 0 if no timeout is set.\n * @return {number} Timeout interval in milliseconds.\n */\ngoog.net.XhrIo.prototype.getTimeoutInterval = function() {\n  return this.timeoutInterval_;\n};\n\n\n/**\n * Sets the number of milliseconds after which an incomplete request will be\n * aborted and a {@link goog.net.EventType.TIMEOUT} event raised; 0 means no\n * timeout is set.\n * @param {number} ms Timeout interval in milliseconds; 0 means none.\n */\ngoog.net.XhrIo.prototype.setTimeoutInterval = function(ms) {\n  this.timeoutInterval_ = Math.max(0, ms);\n};\n\n\n/**\n * Sets the desired type for the response. At time of writing, this is only\n * supported in very recent versions of WebKit (10.0.612.1 dev and later).\n *\n * If this is used, the response may only be accessed via {@link #getResponse}.\n *\n * @param {goog.net.XhrIo.ResponseType} type The desired type for the response.\n */\ngoog.net.XhrIo.prototype.setResponseType = function(type) {\n  this.responseType_ = type;\n};\n\n\n/**\n * Gets the desired type for the response.\n * @return {goog.net.XhrIo.ResponseType} The desired type for the response.\n */\ngoog.net.XhrIo.prototype.getResponseType = function() {\n  return this.responseType_;\n};\n\n\n/**\n * Sets whether a \"credentialed\" request that is aware of cookie and\n * authentication information should be made. This option is only supported by\n * browsers that support HTTP Access Control. As of this writing, this option\n * is not supported in IE.\n *\n * @param {boolean} withCredentials Whether this should be a \"credentialed\"\n *     request.\n */\ngoog.net.XhrIo.prototype.setWithCredentials = function(withCredentials) {\n  this.withCredentials_ = withCredentials;\n};\n\n\n/**\n * Gets whether a \"credentialed\" request is to be sent.\n * @return {boolean} The desired type for the response.\n */\ngoog.net.XhrIo.prototype.getWithCredentials = function() {\n  return this.withCredentials_;\n};\n\n\n/**\n * Sets whether progress events are enabled for this request. Note\n * that progress events require pre-flight OPTIONS request handling\n * for CORS requests, and may cause trouble with older browsers. See\n * progressEventsEnabled_ for details.\n * @param {boolean} enabled Whether progress events should be enabled.\n */\ngoog.net.XhrIo.prototype.setProgressEventsEnabled = function(enabled) {\n  this.progressEventsEnabled_ = enabled;\n};\n\n\n/**\n * Gets whether progress events are enabled.\n * @return {boolean} Whether progress events are enabled for this request.\n */\ngoog.net.XhrIo.prototype.getProgressEventsEnabled = function() {\n  return this.progressEventsEnabled_;\n};\n\n\n/**\n * Instance send that actually uses XMLHttpRequest to make a server call.\n * @param {string|goog.Uri} url Uri to make request to.\n * @param {string=} opt_method Send method, default: GET.\n * @param {ArrayBuffer|ArrayBufferView|Blob|Document|FormData|string=}\n *     opt_content Body data.\n * @param {Object|goog.structs.Map=} opt_headers Map of headers to add to the\n *     request.\n * @suppress {deprecated} Use deprecated goog.structs.forEach to allow different\n * types of parameters for opt_headers.\n */\ngoog.net.XhrIo.prototype.send = function(\n    url, opt_method, opt_content, opt_headers) {\n  if (this.xhr_) {\n    throw new Error(\n        '[goog.net.XhrIo] Object is active with another request=' +\n        this.lastUri_ + '; newUri=' + url);\n  }\n\n  var method = opt_method ? opt_method.toUpperCase() : 'GET';\n\n  this.lastUri_ = url;\n  this.lastError_ = '';\n  this.lastErrorCode_ = goog.net.ErrorCode.NO_ERROR;\n  this.lastMethod_ = method;\n  this.errorDispatched_ = false;\n  this.active_ = true;\n\n  // Use the factory to create the XHR object and options\n  this.xhr_ = this.createXhr();\n  this.xhrOptions_ = this.xmlHttpFactory_ ? this.xmlHttpFactory_.getOptions() :\n                                            goog.net.XmlHttp.getOptions();\n\n  // Set up the onreadystatechange callback\n  this.xhr_.onreadystatechange = goog.bind(this.onReadyStateChange_, this);\n\n  // Set up upload/download progress events, if progress events are supported.\n  if (this.getProgressEventsEnabled() && 'onprogress' in this.xhr_) {\n    this.xhr_.onprogress =\n        goog.bind(function(e) { this.onProgressHandler_(e, true); }, this);\n    if (this.xhr_.upload) {\n      this.xhr_.upload.onprogress = goog.bind(this.onProgressHandler_, this);\n    }\n  }\n\n  /**\n   * Try to open the XMLHttpRequest (always async), if an error occurs here it\n   * is generally permission denied\n   */\n  try {\n    goog.log.fine(this.logger_, this.formatMsg_('Opening Xhr'));\n    this.inOpen_ = true;\n    this.xhr_.open(method, String(url), true);  // Always async!\n    this.inOpen_ = false;\n  } catch (err) {\n    goog.log.fine(\n        this.logger_, this.formatMsg_('Error opening Xhr: ' + err.message));\n    this.error_(goog.net.ErrorCode.EXCEPTION, err);\n    return;\n  }\n\n  // We can't use null since this won't allow requests with form data to have a\n  // content length specified which will cause some proxies to return a 411\n  // error.\n  var content = opt_content || '';\n\n  var headers = this.headers.clone();\n\n  // Add headers specific to this request\n  if (opt_headers) {\n    goog.structs.forEach(\n        opt_headers, function(value, key) { headers.set(key, value); });\n  }\n\n  // Find whether a content type header is set, ignoring case.\n  // HTTP header names are case-insensitive.  See:\n  // http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2\n  var contentTypeKey =\n      goog.array.find(headers.getKeys(), goog.net.XhrIo.isContentTypeHeader_);\n\n  var contentIsFormData =\n      (goog.global['FormData'] && (content instanceof goog.global['FormData']));\n  if (goog.array.contains(goog.net.XhrIo.METHODS_WITH_FORM_DATA, method) &&\n      !contentTypeKey && !contentIsFormData) {\n    // For requests typically with form data, default to the url-encoded form\n    // content type unless this is a FormData request.  For FormData,\n    // the browser will automatically add a multipart/form-data content type\n    // with an appropriate multipart boundary.\n    headers.set(\n        goog.net.XhrIo.CONTENT_TYPE_HEADER, goog.net.XhrIo.FORM_CONTENT_TYPE);\n  }\n\n  // Add the headers to the Xhr object\n  headers.forEach(function(value, key) {\n    this.xhr_.setRequestHeader(key, value);\n  }, this);\n\n  if (this.responseType_) {\n    this.xhr_.responseType = this.responseType_;\n  }\n  // Set xhr_.withCredentials only when the value is different, or else in\n  // synchronous XMLHtppRequest.open Firefox will throw an exception.\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=736340\n  if ('withCredentials' in this.xhr_ &&\n      this.xhr_.withCredentials !== this.withCredentials_) {\n    this.xhr_.withCredentials = this.withCredentials_;\n  }\n\n  /**\n   * Try to send the request, or other wise report an error (404 not found).\n   */\n  try {\n    this.cleanUpTimeoutTimer_();  // Paranoid, should never be running.\n    if (this.timeoutInterval_ > 0) {\n      this.useXhr2Timeout_ = goog.net.XhrIo.shouldUseXhr2Timeout_(this.xhr_);\n      goog.log.fine(\n          this.logger_, this.formatMsg_(\n                            'Will abort after ' + this.timeoutInterval_ +\n                            'ms if incomplete, xhr2 ' + this.useXhr2Timeout_));\n      if (this.useXhr2Timeout_) {\n        this.xhr_[goog.net.XhrIo.XHR2_TIMEOUT_] = this.timeoutInterval_;\n        this.xhr_[goog.net.XhrIo.XHR2_ON_TIMEOUT_] =\n            goog.bind(this.timeout_, this);\n      } else {\n        this.timeoutId_ =\n            goog.Timer.callOnce(this.timeout_, this.timeoutInterval_, this);\n      }\n    }\n    goog.log.fine(this.logger_, this.formatMsg_('Sending request'));\n    this.inSend_ = true;\n    this.xhr_.send(content);\n    this.inSend_ = false;\n\n  } catch (err) {\n    goog.log.fine(this.logger_, this.formatMsg_('Send error: ' + err.message));\n    this.error_(goog.net.ErrorCode.EXCEPTION, err);\n  }\n};\n\n\n/**\n * Determines if the argument is an XMLHttpRequest that supports the level 2\n * timeout value and event.\n *\n * Currently, FF 21.0 OS X has the fields but won't actually call the timeout\n * handler.  Perhaps the confusion in the bug referenced below hasn't\n * entirely been resolved.\n *\n * @see http://www.w3.org/TR/XMLHttpRequest/#the-timeout-attribute\n * @see https://bugzilla.mozilla.org/show_bug.cgi?id=525816\n *\n * @param {!goog.net.XhrLike.OrNative} xhr The request.\n * @return {boolean} True if the request supports level 2 timeout.\n * @private\n */\ngoog.net.XhrIo.shouldUseXhr2Timeout_ = function(xhr) {\n  return goog.userAgent.IE && goog.userAgent.isVersionOrHigher(9) &&\n      goog.isNumber(xhr[goog.net.XhrIo.XHR2_TIMEOUT_]) &&\n      goog.isDef(xhr[goog.net.XhrIo.XHR2_ON_TIMEOUT_]);\n};\n\n\n/**\n * @param {string} header An HTTP header key.\n * @return {boolean} Whether the key is a content type header (ignoring\n *     case.\n * @private\n */\ngoog.net.XhrIo.isContentTypeHeader_ = function(header) {\n  return goog.string.caseInsensitiveEquals(\n      goog.net.XhrIo.CONTENT_TYPE_HEADER, header);\n};\n\n\n/**\n * Creates a new XHR object.\n * @return {!goog.net.XhrLike.OrNative} The newly created XHR object.\n * @protected\n */\ngoog.net.XhrIo.prototype.createXhr = function() {\n  return this.xmlHttpFactory_ ? this.xmlHttpFactory_.createInstance() :\n                                goog.net.XmlHttp();\n};\n\n\n/**\n * The request didn't complete after {@link goog.net.XhrIo#timeoutInterval_}\n * milliseconds; raises a {@link goog.net.EventType.TIMEOUT} event and aborts\n * the request.\n * @private\n */\ngoog.net.XhrIo.prototype.timeout_ = function() {\n  if (typeof goog == 'undefined') {\n    // If goog is undefined then the callback has occurred as the application\n    // is unloading and will error.  Thus we let it silently fail.\n  } else if (this.xhr_) {\n    this.lastError_ =\n        'Timed out after ' + this.timeoutInterval_ + 'ms, aborting';\n    this.lastErrorCode_ = goog.net.ErrorCode.TIMEOUT;\n    goog.log.fine(this.logger_, this.formatMsg_(this.lastError_));\n    this.dispatchEvent(goog.net.EventType.TIMEOUT);\n    this.abort(goog.net.ErrorCode.TIMEOUT);\n  }\n};\n\n\n/**\n * Something errorred, so inactivate, fire error callback and clean up\n * @param {goog.net.ErrorCode} errorCode The error code.\n * @param {Error} err The error object.\n * @private\n */\ngoog.net.XhrIo.prototype.error_ = function(errorCode, err) {\n  this.active_ = false;\n  if (this.xhr_) {\n    this.inAbort_ = true;\n    this.xhr_.abort();  // Ensures XHR isn't hung (FF)\n    this.inAbort_ = false;\n  }\n  this.lastError_ = err;\n  this.lastErrorCode_ = errorCode;\n  this.dispatchErrors_();\n  this.cleanUpXhr_();\n};\n\n\n/**\n * Dispatches COMPLETE and ERROR in case of an error. This ensures that we do\n * not dispatch multiple error events.\n * @private\n */\ngoog.net.XhrIo.prototype.dispatchErrors_ = function() {\n  if (!this.errorDispatched_) {\n    this.errorDispatched_ = true;\n    this.dispatchEvent(goog.net.EventType.COMPLETE);\n    this.dispatchEvent(goog.net.EventType.ERROR);\n  }\n};\n\n\n/**\n * Abort the current XMLHttpRequest\n * @param {goog.net.ErrorCode=} opt_failureCode Optional error code to use -\n *     defaults to ABORT.\n */\ngoog.net.XhrIo.prototype.abort = function(opt_failureCode) {\n  if (this.xhr_ && this.active_) {\n    goog.log.fine(this.logger_, this.formatMsg_('Aborting'));\n    this.active_ = false;\n    this.inAbort_ = true;\n    this.xhr_.abort();\n    this.inAbort_ = false;\n    this.lastErrorCode_ = opt_failureCode || goog.net.ErrorCode.ABORT;\n    this.dispatchEvent(goog.net.EventType.COMPLETE);\n    this.dispatchEvent(goog.net.EventType.ABORT);\n    this.cleanUpXhr_();\n  }\n};\n\n\n/**\n * Nullifies all callbacks to reduce risks of leaks.\n * @override\n * @protected\n */\ngoog.net.XhrIo.prototype.disposeInternal = function() {\n  if (this.xhr_) {\n    // We explicitly do not call xhr_.abort() unless active_ is still true.\n    // This is to avoid unnecessarily aborting a successful request when\n    // dispose() is called in a callback triggered by a complete response, but\n    // in which browser cleanup has not yet finished.\n    // (See http://b/issue?id=1684217.)\n    if (this.active_) {\n      this.active_ = false;\n      this.inAbort_ = true;\n      this.xhr_.abort();\n      this.inAbort_ = false;\n    }\n    this.cleanUpXhr_(true);\n  }\n\n  XhrIo.base(this, 'disposeInternal');\n};\n\n\n/**\n * Internal handler for the XHR object's readystatechange event.  This method\n * checks the status and the readystate and fires the correct callbacks.\n * If the request has ended, the handlers are cleaned up and the XHR object is\n * nullified.\n * @private\n */\ngoog.net.XhrIo.prototype.onReadyStateChange_ = function() {\n  if (this.isDisposed()) {\n    // This method is the target of an untracked goog.Timer.callOnce().\n    return;\n  }\n  if (!this.inOpen_ && !this.inSend_ && !this.inAbort_) {\n    // Were not being called from within a call to this.xhr_.send\n    // this.xhr_.abort, or this.xhr_.open, so this is an entry point\n    this.onReadyStateChangeEntryPoint_();\n  } else {\n    this.onReadyStateChangeHelper_();\n  }\n};\n\n\n/**\n * Used to protect the onreadystatechange handler entry point.  Necessary\n * as {#onReadyStateChange_} maybe called from within send or abort, this\n * method is only called when {#onReadyStateChange_} is called as an\n * entry point.\n * {@see #protectEntryPoints}\n * @private\n */\ngoog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_ = function() {\n  this.onReadyStateChangeHelper_();\n};\n\n\n/**\n * Helper for {@link #onReadyStateChange_}.  This is used so that\n * entry point calls to {@link #onReadyStateChange_} can be routed through\n * {@link #onReadyStateChangeEntryPoint_}.\n * @private\n */\ngoog.net.XhrIo.prototype.onReadyStateChangeHelper_ = function() {\n  if (!this.active_) {\n    // can get called inside abort call\n    return;\n  }\n\n  if (typeof goog == 'undefined') {\n    // NOTE(user): If goog is undefined then the callback has occurred as the\n    // application is unloading and will error.  Thus we let it silently fail.\n\n  } else if (\n      this.xhrOptions_[goog.net.XmlHttp.OptionType.LOCAL_REQUEST_ERROR] &&\n      this.getReadyState() == goog.net.XmlHttp.ReadyState.COMPLETE &&\n      this.getStatus() == 2) {\n    // NOTE(user): In IE if send() errors on a *local* request the readystate\n    // is still changed to COMPLETE.  We need to ignore it and allow the\n    // try/catch around send() to pick up the error.\n    goog.log.fine(\n        this.logger_,\n        this.formatMsg_('Local request error detected and ignored'));\n\n  } else {\n    // In IE when the response has been cached we sometimes get the callback\n    // from inside the send call and this usually breaks code that assumes that\n    // XhrIo is asynchronous.  If that is the case we delay the callback\n    // using a timer.\n    if (this.inSend_ &&\n        this.getReadyState() == goog.net.XmlHttp.ReadyState.COMPLETE) {\n      goog.Timer.callOnce(this.onReadyStateChange_, 0, this);\n      return;\n    }\n\n    this.dispatchEvent(goog.net.EventType.READY_STATE_CHANGE);\n\n    // readyState indicates the transfer has finished\n    if (this.isComplete()) {\n      goog.log.fine(this.logger_, this.formatMsg_('Request complete'));\n\n      this.active_ = false;\n\n      try {\n        // Call the specific callbacks for success or failure. Only call the\n        // success if the status is 200 (HTTP_OK) or 304 (HTTP_CACHED)\n        if (this.isSuccess()) {\n          this.dispatchEvent(goog.net.EventType.COMPLETE);\n          this.dispatchEvent(goog.net.EventType.SUCCESS);\n        } else {\n          this.lastErrorCode_ = goog.net.ErrorCode.HTTP_ERROR;\n          this.lastError_ =\n              this.getStatusText() + ' [' + this.getStatus() + ']';\n          this.dispatchErrors_();\n        }\n      } finally {\n        this.cleanUpXhr_();\n      }\n    }\n  }\n};\n\n\n/**\n * Internal handler for the XHR object's onprogress event. Fires both a generic\n * PROGRESS event and either a DOWNLOAD_PROGRESS or UPLOAD_PROGRESS event to\n * allow specific binding for each XHR progress event.\n * @param {!ProgressEvent} e XHR progress event.\n * @param {boolean=} opt_isDownload Whether the current progress event is from a\n *     download. Used to determine whether DOWNLOAD_PROGRESS or UPLOAD_PROGRESS\n *     event should be dispatched.\n * @private\n */\ngoog.net.XhrIo.prototype.onProgressHandler_ = function(e, opt_isDownload) {\n  goog.asserts.assert(\n      e.type === goog.net.EventType.PROGRESS,\n      'goog.net.EventType.PROGRESS is of the same type as raw XHR progress.');\n  this.dispatchEvent(\n      goog.net.XhrIo.buildProgressEvent_(e, goog.net.EventType.PROGRESS));\n  this.dispatchEvent(\n      goog.net.XhrIo.buildProgressEvent_(\n          e, opt_isDownload ? goog.net.EventType.DOWNLOAD_PROGRESS :\n                              goog.net.EventType.UPLOAD_PROGRESS));\n};\n\n\n/**\n * Creates a representation of the native ProgressEvent. IE doesn't support\n * constructing ProgressEvent via \"new\", and the alternatives (e.g.,\n * ProgressEvent.initProgressEvent) are non-standard or deprecated.\n * @param {!ProgressEvent} e XHR progress event.\n * @param {!goog.net.EventType} eventType The type of the event.\n * @return {!ProgressEvent} The progress event.\n * @private\n */\ngoog.net.XhrIo.buildProgressEvent_ = function(e, eventType) {\n  return /** @type {!ProgressEvent} */ ({\n    type: eventType,\n    lengthComputable: e.lengthComputable,\n    loaded: e.loaded,\n    total: e.total\n  });\n};\n\n\n/**\n * Remove the listener to protect against leaks, and nullify the XMLHttpRequest\n * object.\n * @param {boolean=} opt_fromDispose If this is from the dispose (don't want to\n *     fire any events).\n * @private\n */\ngoog.net.XhrIo.prototype.cleanUpXhr_ = function(opt_fromDispose) {\n  if (this.xhr_) {\n    // Cancel any pending timeout event handler.\n    this.cleanUpTimeoutTimer_();\n\n    // Save reference so we can mark it as closed after the READY event.  The\n    // READY event may trigger another request, thus we must nullify this.xhr_\n    var xhr = this.xhr_;\n    var clearedOnReadyStateChange =\n        this.xhrOptions_[goog.net.XmlHttp.OptionType.USE_NULL_FUNCTION] ?\n        goog.nullFunction :\n        null;\n    this.xhr_ = null;\n    this.xhrOptions_ = null;\n\n    if (!opt_fromDispose) {\n      this.dispatchEvent(goog.net.EventType.READY);\n    }\n\n    try {\n      // NOTE(user): Not nullifying in FireFox can still leak if the callbacks\n      // are defined in the same scope as the instance of XhrIo. But, IE doesn't\n      // allow you to set the onreadystatechange to NULL so nullFunction is\n      // used.\n      xhr.onreadystatechange = clearedOnReadyStateChange;\n    } catch (e) {\n      // This seems to occur with a Gears HTTP request. Delayed the setting of\n      // this onreadystatechange until after READY is sent out and catching the\n      // error to see if we can track down the problem.\n      goog.log.error(\n          this.logger_,\n          'Problem encountered resetting onreadystatechange: ' + e.message);\n    }\n  }\n};\n\n\n/**\n * Make sure the timeout timer isn't running.\n * @private\n */\ngoog.net.XhrIo.prototype.cleanUpTimeoutTimer_ = function() {\n  if (this.xhr_ && this.useXhr2Timeout_) {\n    this.xhr_[goog.net.XhrIo.XHR2_ON_TIMEOUT_] = null;\n  }\n  if (this.timeoutId_) {\n    goog.Timer.clear(this.timeoutId_);\n    this.timeoutId_ = null;\n  }\n};\n\n\n/**\n * @return {boolean} Whether there is an active request.\n */\ngoog.net.XhrIo.prototype.isActive = function() {\n  return !!this.xhr_;\n};\n\n\n/**\n * @return {boolean} Whether the request has completed.\n */\ngoog.net.XhrIo.prototype.isComplete = function() {\n  return this.getReadyState() == goog.net.XmlHttp.ReadyState.COMPLETE;\n};\n\n\n/**\n * @return {boolean} Whether the request completed with a success.\n */\ngoog.net.XhrIo.prototype.isSuccess = function() {\n  var status = this.getStatus();\n  // A zero status code is considered successful for local files.\n  return goog.net.HttpStatus.isSuccess(status) ||\n      status === 0 && !this.isLastUriEffectiveSchemeHttp_();\n};\n\n\n/**\n * @return {boolean} whether the effective scheme of the last URI that was\n *     fetched was 'http' or 'https'.\n * @private\n */\ngoog.net.XhrIo.prototype.isLastUriEffectiveSchemeHttp_ = function() {\n  var scheme = goog.uri.utils.getEffectiveScheme(String(this.lastUri_));\n  return goog.net.XhrIo.HTTP_SCHEME_PATTERN.test(scheme);\n};\n\n\n/**\n * Get the readystate from the Xhr object\n * Will only return correct result when called from the context of a callback\n * @return {goog.net.XmlHttp.ReadyState} goog.net.XmlHttp.ReadyState.*.\n */\ngoog.net.XhrIo.prototype.getReadyState = function() {\n  return this.xhr_ ?\n      /** @type {goog.net.XmlHttp.ReadyState} */ (this.xhr_.readyState) :\n                                                 goog.net.XmlHttp.ReadyState\n                                                     .UNINITIALIZED;\n};\n\n\n/**\n * Get the status from the Xhr object\n * Will only return correct result when called from the context of a callback\n * @return {number} Http status.\n */\ngoog.net.XhrIo.prototype.getStatus = function() {\n  /**\n   * IE doesn't like you checking status until the readystate is greater than 2\n   * (i.e. it is receiving or complete).  The try/catch is used for when the\n   * page is unloading and an ERROR_NOT_AVAILABLE may occur when accessing xhr_.\n   */\n  try {\n    return this.getReadyState() > goog.net.XmlHttp.ReadyState.LOADED ?\n        this.xhr_.status :\n        -1;\n  } catch (e) {\n    return -1;\n  }\n};\n\n\n/**\n * Get the status text from the Xhr object\n * Will only return correct result when called from the context of a callback\n * @return {string} Status text.\n */\ngoog.net.XhrIo.prototype.getStatusText = function() {\n  /**\n   * IE doesn't like you checking status until the readystate is greater than 2\n   * (i.e. it is receiving or complete).  The try/catch is used for when the\n   * page is unloading and an ERROR_NOT_AVAILABLE may occur when accessing xhr_.\n   */\n  try {\n    return this.getReadyState() > goog.net.XmlHttp.ReadyState.LOADED ?\n        this.xhr_.statusText :\n        '';\n  } catch (e) {\n    goog.log.fine(this.logger_, 'Can not get status: ' + e.message);\n    return '';\n  }\n};\n\n\n/**\n * Get the last Uri that was requested\n * @return {string} Last Uri.\n */\ngoog.net.XhrIo.prototype.getLastUri = function() {\n  return String(this.lastUri_);\n};\n\n\n/**\n * Get the response text from the Xhr object\n * Will only return correct result when called from the context of a callback.\n * @return {string} Result from the server, or '' if no result available.\n */\ngoog.net.XhrIo.prototype.getResponseText = function() {\n  try {\n    return this.xhr_ ? this.xhr_.responseText : '';\n  } catch (e) {\n    // http://www.w3.org/TR/XMLHttpRequest/#the-responsetext-attribute\n    // states that responseText should return '' (and responseXML null)\n    // when the state is not LOADING or DONE. Instead, IE can\n    // throw unexpected exceptions, for example when a request is aborted\n    // or no data is available yet.\n    goog.log.fine(this.logger_, 'Can not get responseText: ' + e.message);\n    return '';\n  }\n};\n\n\n/**\n * Get the response body from the Xhr object. This property is only available\n * in IE since version 7 according to MSDN:\n * http://msdn.microsoft.com/en-us/library/ie/ms534368(v=vs.85).aspx\n * Will only return correct result when called from the context of a callback.\n *\n * One option is to construct a VBArray from the returned object and convert\n * it to a JavaScript array using the toArray method:\n * `(new window['VBArray'](xhrIo.getResponseBody())).toArray()`\n * This will result in an array of numbers in the range of [0..255]\n *\n * Another option is to use the VBScript CStr method to convert it into a\n * string as outlined in http://stackoverflow.com/questions/1919972\n *\n * @return {Object} Binary result from the server or null if not available.\n */\ngoog.net.XhrIo.prototype.getResponseBody = function() {\n  try {\n    if (this.xhr_ && 'responseBody' in this.xhr_) {\n      return this.xhr_['responseBody'];\n    }\n  } catch (e) {\n    // IE can throw unexpected exceptions, for example when a request is aborted\n    // or no data is yet available.\n    goog.log.fine(this.logger_, 'Can not get responseBody: ' + e.message);\n  }\n  return null;\n};\n\n\n/**\n * Get the response XML from the Xhr object\n * Will only return correct result when called from the context of a callback.\n * @return {Document} The DOM Document representing the XML file, or null\n * if no result available.\n */\ngoog.net.XhrIo.prototype.getResponseXml = function() {\n  try {\n    return this.xhr_ ? this.xhr_.responseXML : null;\n  } catch (e) {\n    goog.log.fine(this.logger_, 'Can not get responseXML: ' + e.message);\n    return null;\n  }\n};\n\n\n/**\n * Get the response and evaluates it as JSON from the Xhr object\n * Will only return correct result when called from the context of a callback\n * @param {string=} opt_xssiPrefix Optional XSSI prefix string to use for\n *     stripping of the response before parsing. This needs to be set only if\n *     your backend server prepends the same prefix string to the JSON response.\n * @throws Error if the response text is invalid JSON.\n * @return {Object|undefined} JavaScript object.\n */\ngoog.net.XhrIo.prototype.getResponseJson = function(opt_xssiPrefix) {\n  if (!this.xhr_) {\n    return undefined;\n  }\n\n  var responseText = this.xhr_.responseText;\n  if (opt_xssiPrefix && responseText.indexOf(opt_xssiPrefix) == 0) {\n    responseText = responseText.substring(opt_xssiPrefix.length);\n  }\n\n  return goog.json.hybrid.parse(responseText);\n};\n\n\n/**\n * Get the response as the type specificed by {@link #setResponseType}. At time\n * of writing, this is only directly supported in very recent versions of WebKit\n * (10.0.612.1 dev and later). If the field is not supported directly, we will\n * try to emulate it.\n *\n * Emulating the response means following the rules laid out at\n * http://www.w3.org/TR/XMLHttpRequest/#the-response-attribute\n *\n * On browsers with no support for this (Chrome < 10, Firefox < 4, etc), only\n * response types of DEFAULT or TEXT may be used, and the response returned will\n * be the text response.\n *\n * On browsers with Mozilla's draft support for array buffers (Firefox 4, 5),\n * only response types of DEFAULT, TEXT, and ARRAY_BUFFER may be used, and the\n * response returned will be either the text response or the Mozilla\n * implementation of the array buffer response.\n *\n * On browsers will full support, any valid response type supported by the\n * browser may be used, and the response provided by the browser will be\n * returned.\n *\n * @return {*} The response.\n */\ngoog.net.XhrIo.prototype.getResponse = function() {\n  try {\n    if (!this.xhr_) {\n      return null;\n    }\n    if ('response' in this.xhr_) {\n      return this.xhr_.response;\n    }\n    switch (this.responseType_) {\n      case ResponseType.DEFAULT:\n      case ResponseType.TEXT:\n        return this.xhr_.responseText;\n      // DOCUMENT and BLOB don't need to be handled here because they are\n      // introduced in the same spec that adds the .response field, and would\n      // have been caught above.\n      // ARRAY_BUFFER needs an implementation for Firefox 4, where it was\n      // implemented using a draft spec rather than the final spec.\n      case ResponseType.ARRAY_BUFFER:\n        if ('mozResponseArrayBuffer' in this.xhr_) {\n          return this.xhr_.mozResponseArrayBuffer;\n        }\n    }\n    // Fell through to a response type that is not supported on this browser.\n    goog.log.error(\n        this.logger_, 'Response type ' + this.responseType_ + ' is not ' +\n            'supported on this browser');\n    return null;\n  } catch (e) {\n    goog.log.fine(this.logger_, 'Can not get response: ' + e.message);\n    return null;\n  }\n};\n\n\n/**\n * Get the value of the response-header with the given name from the Xhr object\n * Will only return correct result when called from the context of a callback\n * and the request has completed\n * @param {string} key The name of the response-header to retrieve.\n * @return {string|undefined} The value of the response-header named key.\n */\ngoog.net.XhrIo.prototype.getResponseHeader = function(key) {\n  if (!this.xhr_ || !this.isComplete()) {\n    return undefined;\n  }\n\n  var value = this.xhr_.getResponseHeader(key);\n  return goog.isNull(value) ? undefined : value;\n};\n\n\n/**\n * Gets the text of all the headers in the response.\n * Will only return correct result when called from the context of a callback\n * and the request has completed.\n * @return {string} The value of the response headers or empty string.\n */\ngoog.net.XhrIo.prototype.getAllResponseHeaders = function() {\n  // getAllResponseHeaders can return null if no response has been received,\n  // ensure we always return an empty string.\n  return this.xhr_ && this.isComplete() ?\n      (this.xhr_.getAllResponseHeaders() || '') :\n      '';\n};\n\n\n/**\n * Returns all response headers as a key-value map.\n * Multiple values for the same header key can be combined into one,\n * separated by a comma and a space.\n * Note that the native getResponseHeader method for retrieving a single header\n * does a case insensitive match on the header name. This method does not\n * include any case normalization logic, it will just return a key-value\n * representation of the headers.\n * See: http://www.w3.org/TR/XMLHttpRequest/#the-getresponseheader()-method\n * @return {!Object<string, string>} An object with the header keys as keys\n *     and header values as values.\n */\ngoog.net.XhrIo.prototype.getResponseHeaders = function() {\n  // TODO(b/120371595): Make this function parse headers as per the spec\n  // (https://tools.ietf.org/html/rfc2616#section-4.2).\n\n  var headersObject = {};\n  var headersArray = this.getAllResponseHeaders().split('\\r\\n');\n  for (var i = 0; i < headersArray.length; i++) {\n    if (goog.string.isEmptyOrWhitespace(headersArray[i])) {\n      continue;\n    }\n    var keyValue =\n        goog.string.splitLimit(headersArray[i], ':', /* maxSplitCount= */ 1);\n    var key = keyValue[0];\n    var value = keyValue[1];\n\n    if (!goog.isString(value)) {\n      // There must be a value but it can be the empty string.\n      continue;\n    }\n\n    // Whitespace at the start and end of the value is meaningless.\n    value = value.trim();\n    // The key should not contain whitespace but we currently ignore that.\n\n    var values = headersObject[key] || [];\n    headersObject[key] = values;\n    values.push(value);\n  }\n\n  return goog.object.map(headersObject, function(values) {\n    return values.join(', ');\n  });\n};\n\n\n/**\n * Get the value of the response-header with the given name from the Xhr object.\n * As opposed to {@link #getResponseHeader}, this method does not require that\n * the request has completed.\n * @param {string} key The name of the response-header to retrieve.\n * @return {?string} The value of the response-header, or null if it is\n *     unavailable.\n */\ngoog.net.XhrIo.prototype.getStreamingResponseHeader = function(key) {\n  return this.xhr_ ? this.xhr_.getResponseHeader(key) : null;\n};\n\n\n/**\n * Gets the text of all the headers in the response. As opposed to\n * {@link #getAllResponseHeaders}, this method does not require that the request\n * has completed.\n * @return {string} The value of the response headers or empty string.\n */\ngoog.net.XhrIo.prototype.getAllStreamingResponseHeaders = function() {\n  return this.xhr_ ? this.xhr_.getAllResponseHeaders() : '';\n};\n\n\n/**\n * Get the last error message\n * @return {!goog.net.ErrorCode} Last error code.\n */\ngoog.net.XhrIo.prototype.getLastErrorCode = function() {\n  return this.lastErrorCode_;\n};\n\n\n/**\n * Get the last error message\n * @return {string} Last error message.\n */\ngoog.net.XhrIo.prototype.getLastError = function() {\n  return goog.isString(this.lastError_) ? this.lastError_ :\n                                          String(this.lastError_);\n};\n\n\n/**\n * Adds the last method, status and URI to the message.  This is used to add\n * this information to the logging calls.\n * @param {string} msg The message text that we want to add the extra text to.\n * @return {string} The message with the extra text appended.\n * @private\n */\ngoog.net.XhrIo.prototype.formatMsg_ = function(msg) {\n  return msg + ' [' + this.lastMethod_ + ' ' + this.lastUri_ + ' ' +\n      this.getStatus() + ']';\n};\n\n\n// Register the xhr handler as an entry point, so that\n// it can be monitored for exception handling, etc.\ngoog.debug.entryPointRegistry.register(\n    /**\n     * @param {function(!Function): !Function} transformer The transforming\n     *     function.\n     */\n    function(transformer) {\n      goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_ =\n          transformer(goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_);\n    });\n});  // goog.scope\n","// Copyright 2011 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Constants for HTTP status codes.\n */\n\ngoog.provide('goog.net.HttpStatus');\n\n\n/**\n * HTTP Status Codes defined in RFC 2616, RFC 6585, RFC 4918 and RFC 7538.\n * @see http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html\n * @see http://tools.ietf.org/html/rfc6585\n * @see https://tools.ietf.org/html/rfc4918\n * @see https://tools.ietf.org/html/rfc7538\n * @enum {number}\n */\ngoog.net.HttpStatus = {\n  // Informational 1xx\n  CONTINUE: 100,\n  SWITCHING_PROTOCOLS: 101,\n\n  // Successful 2xx\n  OK: 200,\n  CREATED: 201,\n  ACCEPTED: 202,\n  NON_AUTHORITATIVE_INFORMATION: 203,\n  NO_CONTENT: 204,\n  RESET_CONTENT: 205,\n  PARTIAL_CONTENT: 206,\n  MULTI_STATUS: 207,\n\n  // Redirection 3xx\n  MULTIPLE_CHOICES: 300,\n  MOVED_PERMANENTLY: 301,\n  FOUND: 302,\n  SEE_OTHER: 303,\n  NOT_MODIFIED: 304,\n  USE_PROXY: 305,\n  TEMPORARY_REDIRECT: 307,\n  PERMANENT_REDIRECT: 308,\n\n  // Client Error 4xx\n  BAD_REQUEST: 400,\n  UNAUTHORIZED: 401,\n  PAYMENT_REQUIRED: 402,\n  FORBIDDEN: 403,\n  NOT_FOUND: 404,\n  METHOD_NOT_ALLOWED: 405,\n  NOT_ACCEPTABLE: 406,\n  PROXY_AUTHENTICATION_REQUIRED: 407,\n  REQUEST_TIMEOUT: 408,\n  CONFLICT: 409,\n  GONE: 410,\n  LENGTH_REQUIRED: 411,\n  PRECONDITION_FAILED: 412,\n  REQUEST_ENTITY_TOO_LARGE: 413,\n  REQUEST_URI_TOO_LONG: 414,\n  UNSUPPORTED_MEDIA_TYPE: 415,\n  REQUEST_RANGE_NOT_SATISFIABLE: 416,\n  EXPECTATION_FAILED: 417,\n  UNPROCESSABLE_ENTITY: 422,\n  LOCKED: 423,\n  FAILED_DEPENDENCY: 424,\n  PRECONDITION_REQUIRED: 428,\n  TOO_MANY_REQUESTS: 429,\n  REQUEST_HEADER_FIELDS_TOO_LARGE: 431,\n\n  // Server Error 5xx\n  INTERNAL_SERVER_ERROR: 500,\n  NOT_IMPLEMENTED: 501,\n  BAD_GATEWAY: 502,\n  SERVICE_UNAVAILABLE: 503,\n  GATEWAY_TIMEOUT: 504,\n  HTTP_VERSION_NOT_SUPPORTED: 505,\n  INSUFFICIENT_STORAGE: 507,\n  NETWORK_AUTHENTICATION_REQUIRED: 511,\n\n  /*\n   * IE returns this code for 204 due to its use of URLMon, which returns this\n   * code for 'Operation Aborted'. The status text is 'Unknown', the response\n   * headers are ''. Known to occur on IE 6 on XP through IE9 on Win7.\n   */\n  QUIRK_IE_NO_CONTENT: 1223\n};\n\n\n/**\n * Returns whether the given status should be considered successful.\n *\n * Successful codes are OK (200), CREATED (201), ACCEPTED (202),\n * NO CONTENT (204), PARTIAL CONTENT (206), NOT MODIFIED (304),\n * and IE's no content code (1223).\n *\n * @param {number} status The status code to test.\n * @return {boolean} Whether the status code should be considered successful.\n */\ngoog.net.HttpStatus.isSuccess = function(status) {\n  switch (status) {\n    case goog.net.HttpStatus.OK:\n    case goog.net.HttpStatus.CREATED:\n    case goog.net.HttpStatus.ACCEPTED:\n    case goog.net.HttpStatus.NO_CONTENT:\n    case goog.net.HttpStatus.PARTIAL_CONTENT:\n    case goog.net.HttpStatus.NOT_MODIFIED:\n    case goog.net.HttpStatus.QUIRK_IE_NO_CONTENT:\n      return true;\n\n    default:\n      return false;\n  }\n};\n","// Copyright 2007 Bob Ippolito. All Rights Reserved.\n// Modifications Copyright 2009 The Closure Library Authors. All Rights\n// Reserved.\n\n/**\n * @license Portions of this code are from MochiKit, received by\n * The Closure Authors under the MIT license. All other code is Copyright\n * 2005-2009 The Closure Authors. All Rights Reserved.\n */\n\n/**\n * @fileoverview Classes for tracking asynchronous operations and handling the\n * results. The Deferred object here is patterned after the Deferred object in\n * the Twisted python networking framework.\n *\n * See: http://twistedmatrix.com/projects/core/documentation/howto/defer.html\n *\n * Based on the Dojo code which in turn is based on the MochiKit code.\n *\n * @author arv@google.com (Erik Arvidsson)\n * @author brenneman@google.com (Shawn Brenneman)\n */\n\ngoog.provide('goog.async.Deferred');\ngoog.provide('goog.async.Deferred.AlreadyCalledError');\ngoog.provide('goog.async.Deferred.CanceledError');\n\ngoog.require('goog.Promise');\ngoog.require('goog.Thenable');\ngoog.require('goog.array');\ngoog.require('goog.asserts');\ngoog.require('goog.debug.Error');\n\n\n\n/**\n * A Deferred represents the result of an asynchronous operation. A Deferred\n * instance has no result when it is created, and is \"fired\" (given an initial\n * result) by calling `callback` or `errback`.\n *\n * Once fired, the result is passed through a sequence of callback functions\n * registered with `addCallback` or `addErrback`. The functions may\n * mutate the result before it is passed to the next function in the sequence.\n *\n * Callbacks and errbacks may be added at any time, including after the Deferred\n * has been \"fired\". If there are no pending actions in the execution sequence\n * of a fired Deferred, any new callback functions will be called with the last\n * computed result. Adding a callback function is the only way to access the\n * result of the Deferred.\n *\n * If a Deferred operation is canceled, an optional user-provided cancellation\n * function is invoked which may perform any special cleanup, followed by firing\n * the Deferred's errback sequence with a `CanceledError`. If the\n * Deferred has already fired, cancellation is ignored.\n *\n * Deferreds may be templated to a specific type they produce using generics\n * with syntax such as:\n *\n *    /** @type {goog.async.Deferred<string>} *\\\n *    var d = new goog.async.Deferred();\n *    // Compiler can infer that foo is a string.\n *    d.addCallback(function(foo) {...});\n *    d.callback('string');  // Checked to be passed a string\n *\n * Since deferreds are often used to produce different values across a chain,\n * the type information is not propagated across chains, but rather only\n * associated with specifically cast objects.\n *\n * @param {Function=} opt_onCancelFunction A function that will be called if the\n *     Deferred is canceled. If provided, this function runs before the\n *     Deferred is fired with a `CanceledError`.\n * @param {Object=} opt_defaultScope The default object context to call\n *     callbacks and errbacks in.\n * @constructor\n * @implements {goog.Thenable<VALUE>}\n * @template VALUE\n */\ngoog.async.Deferred = function(opt_onCancelFunction, opt_defaultScope) {\n  /**\n   * Entries in the sequence are arrays containing a callback, an errback, and\n   * an optional scope. The callback or errback in an entry may be null.\n   * @type {!Array<!Array>}\n   * @private\n   */\n  this.sequence_ = [];\n\n  /**\n   * Optional function that will be called if the Deferred is canceled.\n   * @type {Function|undefined}\n   * @private\n   */\n  this.onCancelFunction_ = opt_onCancelFunction;\n\n  /**\n   * The default scope to execute callbacks and errbacks in.\n   * @type {Object}\n   * @private\n   */\n  this.defaultScope_ = opt_defaultScope || null;\n\n  /**\n   * Whether the Deferred has been fired.\n   * @type {boolean}\n   * @private\n   */\n  this.fired_ = false;\n\n  /**\n   * Whether the last result in the execution sequence was an error.\n   * @type {boolean}\n   * @private\n   */\n  this.hadError_ = false;\n\n  /**\n   * The current Deferred result, updated as callbacks and errbacks are\n   * executed.\n   * @type {*}\n   * @private\n   */\n  this.result_ = undefined;\n\n  /**\n   * Whether the Deferred is blocked waiting on another Deferred to fire. If a\n   * callback or errback returns a Deferred as a result, the execution sequence\n   * is blocked until that Deferred result becomes available.\n   * @type {boolean}\n   * @private\n   */\n  this.blocked_ = false;\n\n  /**\n   * Whether this Deferred is blocking execution of another Deferred. If this\n   * instance was returned as a result in another Deferred's execution\n   * sequence,that other Deferred becomes blocked until this instance's\n   * execution sequence completes. No additional callbacks may be added to a\n   * Deferred once it is blocking another instance.\n   * @type {boolean}\n   * @private\n   */\n  this.blocking_ = false;\n\n  /**\n   * Whether the Deferred has been canceled without having a custom cancel\n   * function.\n   * @type {boolean}\n   * @private\n   */\n  this.silentlyCanceled_ = false;\n\n  /**\n   * If an error is thrown during Deferred execution with no errback to catch\n   * it, the error is rethrown after a timeout. Reporting the error after a\n   * timeout allows execution to continue in the calling context (empty when\n   * no error is scheduled).\n   * @type {number}\n   * @private\n   */\n  this.unhandledErrorId_ = 0;\n\n  /**\n   * If this Deferred was created by branch(), this will be the \"parent\"\n   * Deferred.\n   * @type {?goog.async.Deferred}\n   * @private\n   */\n  this.parent_ = null;\n\n  /**\n   * The number of Deferred objects that have been branched off this one. This\n   * will be decremented whenever a branch is fired or canceled.\n   * @type {number}\n   * @private\n   */\n  this.branches_ = 0;\n\n  if (goog.async.Deferred.LONG_STACK_TRACES) {\n    /**\n     * Holds the stack trace at time of deferred creation if the JS engine\n     * provides the Error.captureStackTrace API.\n     * @private {?string}\n     */\n    this.constructorStack_ = null;\n    if (Error.captureStackTrace) {\n      var target = { stack: '' };\n      Error.captureStackTrace(target, goog.async.Deferred);\n      // Check if Error.captureStackTrace worked. It fails in gjstest.\n      if (typeof target.stack == 'string') {\n        // Remove first line and force stringify to prevent memory leak due to\n        // holding on to actual stack frames.\n        this.constructorStack_ = target.stack.replace(/^[^\\n]*\\n/, '');\n      }\n    }\n  }\n};\n\n\n/**\n * @define {boolean} Whether unhandled errors should always get rethrown to the\n * global scope. Defaults to false.\n */\ngoog.async.Deferred.STRICT_ERRORS =\n    goog.define('goog.async.Deferred.STRICT_ERRORS', false);\n\n\n/**\n * @define {boolean} Whether to attempt to make stack traces long.  Defaults to\n * false.\n */\ngoog.async.Deferred.LONG_STACK_TRACES =\n    goog.define('goog.async.Deferred.LONG_STACK_TRACES', false);\n\n\n/**\n * Cancels a Deferred that has not yet been fired, or is blocked on another\n * deferred operation. If this Deferred is waiting for a blocking Deferred to\n * fire, the blocking Deferred will also be canceled.\n *\n * If this Deferred was created by calling branch() on a parent Deferred with\n * opt_propagateCancel set to true, the parent may also be canceled. If\n * opt_deepCancel is set, cancel() will be called on the parent (as well as any\n * other ancestors if the parent is also a branch). If one or more branches were\n * created with opt_propagateCancel set to true, the parent will be canceled if\n * cancel() is called on all of those branches.\n *\n * @param {boolean=} opt_deepCancel If true, cancels this Deferred's parent even\n *     if cancel() hasn't been called on some of the parent's branches. Has no\n *     effect on a branch without opt_propagateCancel set to true.\n */\ngoog.async.Deferred.prototype.cancel = function(opt_deepCancel) {\n  if (!this.hasFired()) {\n    if (this.parent_) {\n      // Get rid of the parent reference before potentially running the parent's\n      // canceler function to ensure that this cancellation isn't\n      // double-counted.\n      var parent = this.parent_;\n      delete this.parent_;\n      if (opt_deepCancel) {\n        parent.cancel(opt_deepCancel);\n      } else {\n        parent.branchCancel_();\n      }\n    }\n\n    if (this.onCancelFunction_) {\n      // Call in user-specified scope.\n      this.onCancelFunction_.call(this.defaultScope_, this);\n    } else {\n      this.silentlyCanceled_ = true;\n    }\n    if (!this.hasFired()) {\n      this.errback(new goog.async.Deferred.CanceledError(this));\n    }\n  } else if (this.result_ instanceof goog.async.Deferred) {\n    this.result_.cancel();\n  }\n};\n\n\n/**\n * Handle a single branch being canceled. Once all branches are canceled, this\n * Deferred will be canceled as well.\n *\n * @private\n */\ngoog.async.Deferred.prototype.branchCancel_ = function() {\n  this.branches_--;\n  if (this.branches_ <= 0) {\n    this.cancel();\n  }\n};\n\n\n/**\n * Called after a blocking Deferred fires. Unblocks this Deferred and resumes\n * its execution sequence.\n *\n * @param {boolean} isSuccess Whether the result is a success or an error.\n * @param {*} res The result of the blocking Deferred.\n * @private\n */\ngoog.async.Deferred.prototype.continue_ = function(isSuccess, res) {\n  this.blocked_ = false;\n  this.updateResult_(isSuccess, res);\n};\n\n\n/**\n * Updates the current result based on the success or failure of the last action\n * in the execution sequence.\n *\n * @param {boolean} isSuccess Whether the new result is a success or an error.\n * @param {*} res The result.\n * @private\n */\ngoog.async.Deferred.prototype.updateResult_ = function(isSuccess, res) {\n  this.fired_ = true;\n  this.result_ = res;\n  this.hadError_ = !isSuccess;\n  this.fire_();\n};\n\n\n/**\n * Verifies that the Deferred has not yet been fired.\n *\n * @private\n * @throws {Error} If this has already been fired.\n */\ngoog.async.Deferred.prototype.check_ = function() {\n  if (this.hasFired()) {\n    if (!this.silentlyCanceled_) {\n      throw new goog.async.Deferred.AlreadyCalledError(this);\n    }\n    this.silentlyCanceled_ = false;\n  }\n};\n\n\n/**\n * Fire the execution sequence for this Deferred by passing the starting result\n * to the first registered callback.\n * @param {VALUE=} opt_result The starting result.\n */\ngoog.async.Deferred.prototype.callback = function(opt_result) {\n  this.check_();\n  this.assertNotDeferred_(opt_result);\n  this.updateResult_(true /* isSuccess */, opt_result);\n};\n\n\n/**\n * Fire the execution sequence for this Deferred by passing the starting error\n * result to the first registered errback.\n * @param {*=} opt_result The starting error.\n */\ngoog.async.Deferred.prototype.errback = function(opt_result) {\n  this.check_();\n  this.assertNotDeferred_(opt_result);\n  this.makeStackTraceLong_(opt_result);\n  this.updateResult_(false /* isSuccess */, opt_result);\n};\n\n\n/**\n * Attempt to make the error's stack trace be long in that it contains the\n * stack trace from the point where the deferred was created on top of the\n * current stack trace to give additional context.\n * @param {*} error\n * @private\n */\ngoog.async.Deferred.prototype.makeStackTraceLong_ = function(error) {\n  if (!goog.async.Deferred.LONG_STACK_TRACES) {\n    return;\n  }\n  if (this.constructorStack_ && goog.isObject(error) && error.stack &&\n      // Stack looks like it was system generated. See\n      // https://code.google.com/p/v8/wiki/JavaScriptStackTraceApi\n      (/^[^\\n]+(\\n   [^\\n]+)+/).test(error.stack)) {\n    error.stack = error.stack + '\\nDEFERRED OPERATION:\\n' +\n        this.constructorStack_;\n  }\n};\n\n\n/**\n * Asserts that an object is not a Deferred.\n * @param {*} obj The object to test.\n * @throws {Error} Throws an exception if the object is a Deferred.\n * @private\n */\ngoog.async.Deferred.prototype.assertNotDeferred_ = function(obj) {\n  goog.asserts.assert(\n      !(obj instanceof goog.async.Deferred),\n      'An execution sequence may not be initiated with a blocking Deferred.');\n};\n\n\n/**\n * Register a callback function to be called with a successful result. If no\n * value is returned by the callback function, the result value is unchanged. If\n * a new value is returned, it becomes the Deferred result and will be passed to\n * the next callback in the execution sequence.\n *\n * If the function throws an error, the error becomes the new result and will be\n * passed to the next errback in the execution chain.\n *\n * If the function returns a Deferred, the execution sequence will be blocked\n * until that Deferred fires. Its result will be passed to the next callback (or\n * errback if it is an error result) in this Deferred's execution sequence.\n *\n * @param {function(this:T,VALUE):?} cb The function to be called with a\n *     successful result.\n * @param {T=} opt_scope An optional scope to call the callback in.\n * @return {!goog.async.Deferred} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addCallback = function(cb, opt_scope) {\n  return this.addCallbacks(cb, null, opt_scope);\n};\n\n\n/**\n * Register a callback function to be called with an error result. If no value\n * is returned by the function, the error result is unchanged. If a new error\n * value is returned or thrown, that error becomes the Deferred result and will\n * be passed to the next errback in the execution sequence.\n *\n * If the errback function handles the error by returning a non-error value,\n * that result will be passed to the next normal callback in the sequence.\n *\n * If the function returns a Deferred, the execution sequence will be blocked\n * until that Deferred fires. Its result will be passed to the next callback (or\n * errback if it is an error result) in this Deferred's execution sequence.\n *\n * @param {function(this:T,?):?} eb The function to be called on an\n *     unsuccessful result.\n * @param {T=} opt_scope An optional scope to call the errback in.\n * @return {!goog.async.Deferred<VALUE>} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addErrback = function(eb, opt_scope) {\n  return this.addCallbacks(null, eb, opt_scope);\n};\n\n\n/**\n * Registers one function as both a callback and errback.\n *\n * @param {function(this:T,?):?} f The function to be called on any result.\n * @param {T=} opt_scope An optional scope to call the function in.\n * @return {!goog.async.Deferred} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addBoth = function(f, opt_scope) {\n  return this.addCallbacks(f, f, opt_scope);\n};\n\n\n/**\n * Like addBoth, but propagates uncaught exceptions in the errback.\n *\n * @param {function(this:T,?):?} f The function to be called on any result.\n * @param {T=} opt_scope An optional scope to call the function in.\n * @return {!goog.async.Deferred<VALUE>} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addFinally = function(f, opt_scope) {\n  return this.addCallbacks(f, function(err) {\n    var result = f.call(/** @type {?} */ (this), err);\n    if (!goog.isDef(result)) {\n      throw err;\n    }\n    return result;\n  }, opt_scope);\n};\n\n\n/**\n * Registers a callback function and an errback function at the same position\n * in the execution sequence. Only one of these functions will execute,\n * depending on the error state during the execution sequence.\n *\n * NOTE: This is not equivalent to {@code def.addCallback().addErrback()}! If\n * the callback is invoked, the errback will be skipped, and vice versa.\n *\n * @param {?(function(this:T,VALUE):?)} cb The function to be called on a\n *     successful result.\n * @param {?(function(this:T,?):?)} eb The function to be called on an\n *     unsuccessful result.\n * @param {T=} opt_scope An optional scope to call the functions in.\n * @return {!goog.async.Deferred} This Deferred.\n * @template T\n */\ngoog.async.Deferred.prototype.addCallbacks = function(cb, eb, opt_scope) {\n  goog.asserts.assert(!this.blocking_, 'Blocking Deferreds can not be re-used');\n  this.sequence_.push([cb, eb, opt_scope]);\n  if (this.hasFired()) {\n    this.fire_();\n  }\n  return this;\n};\n\n\n/**\n * Implements {@see goog.Thenable} for seamless integration with\n * {@see goog.Promise}.\n * Deferred results are mutable and may represent multiple values over\n * their lifetime. Calling `then` on a Deferred returns a Promise\n * with the result of the Deferred at that point in its callback chain.\n * Note that if the Deferred result is never mutated, and only\n * `then` calls are made, the Deferred will behave like a Promise.\n *\n * @override\n */\ngoog.async.Deferred.prototype.then = function(opt_onFulfilled, opt_onRejected,\n    opt_context) {\n  var resolve, reject;\n  var promise = new goog.Promise(function(res, rej) {\n    // Copying resolvers to outer scope, so that they are available when the\n    // deferred callback fires (which may be synchronous).\n    resolve = res;\n    reject = rej;\n  });\n  this.addCallbacks(resolve, function(reason) {\n    if (reason instanceof goog.async.Deferred.CanceledError) {\n      promise.cancel();\n    } else {\n      reject(reason);\n    }\n  });\n  return promise.then(opt_onFulfilled, opt_onRejected, opt_context);\n};\ngoog.Thenable.addImplementation(goog.async.Deferred);\n\n\n/**\n * Links another Deferred to the end of this Deferred's execution sequence. The\n * result of this execution sequence will be passed as the starting result for\n * the chained Deferred, invoking either its first callback or errback.\n *\n * @param {!goog.async.Deferred} otherDeferred The Deferred to chain.\n * @return {!goog.async.Deferred} This Deferred.\n */\ngoog.async.Deferred.prototype.chainDeferred = function(otherDeferred) {\n  this.addCallbacks(\n      otherDeferred.callback, otherDeferred.errback, otherDeferred);\n  return this;\n};\n\n\n/**\n * Makes this Deferred wait for another Deferred's execution sequence to\n * complete before continuing.\n *\n * This is equivalent to adding a callback that returns `otherDeferred`,\n * but doesn't prevent additional callbacks from being added to\n * `otherDeferred`.\n *\n * @param {!goog.async.Deferred|!goog.Thenable} otherDeferred The Deferred\n *     to wait for.\n * @return {!goog.async.Deferred} This Deferred.\n */\ngoog.async.Deferred.prototype.awaitDeferred = function(otherDeferred) {\n  if (!(otherDeferred instanceof goog.async.Deferred)) {\n    // The Thenable case.\n    return this.addCallback(function() {\n      return otherDeferred;\n    });\n  }\n  return this.addCallback(goog.bind(otherDeferred.branch, otherDeferred));\n};\n\n\n/**\n * Creates a branch off this Deferred's execution sequence, and returns it as a\n * new Deferred. The branched Deferred's starting result will be shared with the\n * parent at the point of the branch, even if further callbacks are added to the\n * parent.\n *\n * All branches at the same stage in the execution sequence will receive the\n * same starting value.\n *\n * @param {boolean=} opt_propagateCancel If cancel() is called on every child\n *     branch created with opt_propagateCancel, the parent will be canceled as\n *     well.\n * @return {!goog.async.Deferred<VALUE>} A Deferred that will be started with\n *     the computed result from this stage in the execution sequence.\n */\ngoog.async.Deferred.prototype.branch = function(opt_propagateCancel) {\n  var d = new goog.async.Deferred();\n  this.chainDeferred(d);\n  if (opt_propagateCancel) {\n    d.parent_ = this;\n    this.branches_++;\n  }\n  return d;\n};\n\n\n/**\n * @return {boolean} Whether the execution sequence has been started on this\n *     Deferred by invoking `callback` or `errback`.\n */\ngoog.async.Deferred.prototype.hasFired = function() {\n  return this.fired_;\n};\n\n\n/**\n * @param {*} res The latest result in the execution sequence.\n * @return {boolean} Whether the current result is an error that should cause\n *     the next errback to fire. May be overridden by subclasses to handle\n *     special error types.\n * @protected\n */\ngoog.async.Deferred.prototype.isError = function(res) {\n  return res instanceof Error;\n};\n\n\n/**\n * @return {boolean} Whether an errback exists in the remaining sequence.\n * @private\n */\ngoog.async.Deferred.prototype.hasErrback_ = function() {\n  return goog.array.some(this.sequence_, function(sequenceRow) {\n    // The errback is the second element in the array.\n    return goog.isFunction(sequenceRow[1]);\n  });\n};\n\n\n/**\n * Exhausts the execution sequence while a result is available. The result may\n * be modified by callbacks or errbacks, and execution will block if the\n * returned result is an incomplete Deferred.\n *\n * @private\n */\ngoog.async.Deferred.prototype.fire_ = function() {\n  if (this.unhandledErrorId_ && this.hasFired() && this.hasErrback_()) {\n    // It is possible to add errbacks after the Deferred has fired. If a new\n    // errback is added immediately after the Deferred encountered an unhandled\n    // error, but before that error is rethrown, the error is unscheduled.\n    goog.async.Deferred.unscheduleError_(this.unhandledErrorId_);\n    this.unhandledErrorId_ = 0;\n  }\n\n  if (this.parent_) {\n    this.parent_.branches_--;\n    delete this.parent_;\n  }\n\n  var res = this.result_;\n  var unhandledException = false;\n  var isNewlyBlocked = false;\n\n  while (this.sequence_.length && !this.blocked_) {\n    var sequenceEntry = this.sequence_.shift();\n\n    var callback = sequenceEntry[0];\n    var errback = sequenceEntry[1];\n    var scope = sequenceEntry[2];\n\n    var f = this.hadError_ ? errback : callback;\n    if (f) {\n\n      try {\n        var ret = f.call(scope || this.defaultScope_, res);\n\n        // If no result, then use previous result.\n        if (goog.isDef(ret)) {\n          // Bubble up the error as long as the return value hasn't changed.\n          this.hadError_ = this.hadError_ && (ret == res || this.isError(ret));\n          this.result_ = res = ret;\n        }\n\n        if (goog.Thenable.isImplementedBy(res) ||\n            (typeof goog.global['Promise'] === 'function' &&\n            res instanceof goog.global['Promise'])) {\n          isNewlyBlocked = true;\n          this.blocked_ = true;\n        }\n\n      } catch (ex) {\n        res = ex;\n        this.hadError_ = true;\n        this.makeStackTraceLong_(res);\n\n        if (!this.hasErrback_()) {\n          // If an error is thrown with no additional errbacks in the queue,\n          // prepare to rethrow the error.\n          unhandledException = true;\n        }\n      }\n    }\n  }\n\n  this.result_ = res;\n\n  if (isNewlyBlocked) {\n    var onCallback = goog.bind(this.continue_, this, true /* isSuccess */);\n    var onErrback = goog.bind(this.continue_, this, false /* isSuccess */);\n\n    if (res instanceof goog.async.Deferred) {\n      res.addCallbacks(onCallback, onErrback);\n      res.blocking_ = true;\n    } else {\n      /** @type {!IThenable} */ (res).then(onCallback, onErrback);\n    }\n  } else if (goog.async.Deferred.STRICT_ERRORS && this.isError(res) &&\n      !(res instanceof goog.async.Deferred.CanceledError)) {\n    this.hadError_ = true;\n    unhandledException = true;\n  }\n\n  if (unhandledException) {\n    // Rethrow the unhandled error after a timeout. Execution will continue, but\n    // the error will be seen by global handlers and the user. The throw will\n    // be canceled if another errback is appended before the timeout executes.\n    // The error's original stack trace is preserved where available.\n    this.unhandledErrorId_ = goog.async.Deferred.scheduleError_(res);\n  }\n};\n\n\n/**\n * Creates a Deferred that has an initial result.\n *\n * @param {*=} opt_result The result.\n * @return {!goog.async.Deferred} The new Deferred.\n */\ngoog.async.Deferred.succeed = function(opt_result) {\n  var d = new goog.async.Deferred();\n  d.callback(opt_result);\n  return d;\n};\n\n\n/**\n * Creates a Deferred that fires when the given promise resolves.\n * Use only during migration to Promises.\n *\n * Note: If the promise resolves to a thenable value (which is not allowed by\n * conforming promise implementations), then the deferred may behave\n * unexpectedly as it tries to wait on it. This should not be a risk when using\n * goog.Promise, goog.async.Deferred, or native Promise objects.\n *\n * @param {!IThenable<T>} promise\n * @return {!goog.async.Deferred<T>} The new Deferred.\n * @template T\n */\ngoog.async.Deferred.fromPromise = function(promise) {\n  var d = new goog.async.Deferred();\n  promise.then(\n      function(value) {\n        d.callback(value);\n      },\n      function(error) {\n        d.errback(error);\n      });\n  return d;\n};\n\n\n/**\n * Creates a Deferred that has an initial error result.\n *\n * @param {*} res The error result.\n * @return {!goog.async.Deferred} The new Deferred.\n */\ngoog.async.Deferred.fail = function(res) {\n  var d = new goog.async.Deferred();\n  d.errback(res);\n  return d;\n};\n\n\n/**\n * Creates a Deferred that has already been canceled.\n *\n * @return {!goog.async.Deferred} The new Deferred.\n */\ngoog.async.Deferred.canceled = function() {\n  var d = new goog.async.Deferred();\n  d.cancel();\n  return d;\n};\n\n\n/**\n * Normalizes values that may or may not be Deferreds.\n *\n * If the input value is a Deferred, the Deferred is branched (so the original\n * execution sequence is not modified) and the input callback added to the new\n * branch. The branch is returned to the caller.\n *\n * If the input value is not a Deferred, the callback will be executed\n * immediately and an already firing Deferred will be returned to the caller.\n *\n * In the following (contrived) example, if <code>isImmediate</code> is true\n * then 3 is alerted immediately, otherwise 6 is alerted after a 2-second delay.\n *\n * <pre>\n * var value;\n * if (isImmediate) {\n *   value = 3;\n * } else {\n *   value = new goog.async.Deferred();\n *   setTimeout(function() { value.callback(6); }, 2000);\n * }\n *\n * var d = goog.async.Deferred.when(value, alert);\n * </pre>\n *\n * @param {*} value Deferred or normal value to pass to the callback.\n * @param {function(this:T, ?):?} callback The callback to execute.\n * @param {T=} opt_scope An optional scope to call the callback in.\n * @return {!goog.async.Deferred} A new Deferred that will call the input\n *     callback with the input value.\n * @template T\n */\ngoog.async.Deferred.when = function(value, callback, opt_scope) {\n  if (value instanceof goog.async.Deferred) {\n    return value.branch(true).addCallback(callback, opt_scope);\n  } else {\n    return goog.async.Deferred.succeed(value).addCallback(callback, opt_scope);\n  }\n};\n\n\n\n/**\n * An error sub class that is used when a Deferred has already been called.\n * @param {!goog.async.Deferred} deferred The Deferred.\n *\n * @constructor\n * @extends {goog.debug.Error}\n */\ngoog.async.Deferred.AlreadyCalledError = function(deferred) {\n  goog.debug.Error.call(this);\n\n  /**\n   * The Deferred that raised this error.\n   * @type {goog.async.Deferred}\n   */\n  this.deferred = deferred;\n};\ngoog.inherits(goog.async.Deferred.AlreadyCalledError, goog.debug.Error);\n\n\n/** @override */\ngoog.async.Deferred.AlreadyCalledError.prototype.message =\n    'Deferred has already fired';\n\n\n/** @override */\ngoog.async.Deferred.AlreadyCalledError.prototype.name = 'AlreadyCalledError';\n\n\n\n/**\n * An error sub class that is used when a Deferred is canceled.\n *\n * @param {!goog.async.Deferred} deferred The Deferred object.\n * @constructor\n * @extends {goog.debug.Error}\n */\ngoog.async.Deferred.CanceledError = function(deferred) {\n  goog.debug.Error.call(this);\n\n  /**\n   * The Deferred that raised this error.\n   * @type {goog.async.Deferred}\n   */\n  this.deferred = deferred;\n};\ngoog.inherits(goog.async.Deferred.CanceledError, goog.debug.Error);\n\n\n/** @override */\ngoog.async.Deferred.CanceledError.prototype.message = 'Deferred was canceled';\n\n\n/** @override */\ngoog.async.Deferred.CanceledError.prototype.name = 'CanceledError';\n\n\n\n/**\n * Wrapper around errors that are scheduled to be thrown by failing deferreds\n * after a timeout.\n *\n * @param {*} error Error from a failing deferred.\n * @constructor\n * @final\n * @private\n * @struct\n */\ngoog.async.Deferred.Error_ = function(error) {\n  /** @const @private {number} */\n  this.id_ = goog.global.setTimeout(goog.bind(this.throwError, this), 0);\n\n  /** @const @private {*} */\n  this.error_ = error;\n};\n\n\n/**\n * Actually throws the error and removes it from the list of pending\n * deferred errors.\n */\ngoog.async.Deferred.Error_.prototype.throwError = function() {\n  goog.asserts.assert(goog.async.Deferred.errorMap_[this.id_],\n      'Cannot throw an error that is not scheduled.');\n  delete goog.async.Deferred.errorMap_[this.id_];\n  throw this.error_;\n};\n\n\n/**\n * Resets the error throw timer.\n */\ngoog.async.Deferred.Error_.prototype.resetTimer = function() {\n  goog.global.clearTimeout(this.id_);\n};\n\n\n/**\n * Map of unhandled errors scheduled to be rethrown in a future timestep.\n * @private {!Object<(number|string), goog.async.Deferred.Error_>}\n */\ngoog.async.Deferred.errorMap_ = {};\n\n\n/**\n * Schedules an error to be thrown after a delay.\n * @param {*} error Error from a failing deferred.\n * @return {number} Id of the error.\n * @private\n */\ngoog.async.Deferred.scheduleError_ = function(error) {\n  var deferredError = new goog.async.Deferred.Error_(error);\n  goog.async.Deferred.errorMap_[deferredError.id_] = deferredError;\n  return deferredError.id_;\n};\n\n\n/**\n * Unschedules an error from being thrown.\n * @param {number} id Id of the deferred error to unschedule.\n * @private\n */\ngoog.async.Deferred.unscheduleError_ = function(id) {\n  var error = goog.async.Deferred.errorMap_[id];\n  if (error) {\n    error.resetTimer();\n    delete goog.async.Deferred.errorMap_[id];\n  }\n};\n\n\n/**\n * Asserts that there are no pending deferred errors. If there are any\n * scheduled errors, one will be thrown immediately to make this function fail.\n */\ngoog.async.Deferred.assertNoErrors = function() {\n  var map = goog.async.Deferred.errorMap_;\n  for (var key in map) {\n    var error = map[key];\n    error.resetTimer();\n    error.throwError();\n  }\n};\n","// Copyright 2011 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview A utility to load JavaScript files via DOM script tags.\n * Refactored from goog.net.Jsonp. Works cross-domain.\n *\n */\n\ngoog.provide('goog.net.jsloader');\ngoog.provide('goog.net.jsloader.Error');\ngoog.provide('goog.net.jsloader.ErrorCode');\ngoog.provide('goog.net.jsloader.Options');\n\ngoog.require('goog.array');\ngoog.require('goog.async.Deferred');\ngoog.require('goog.debug.Error');\ngoog.require('goog.dom');\ngoog.require('goog.dom.TagName');\ngoog.require('goog.dom.safe');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.object');\n\n\n/**\n * The name of the property of goog.global under which the JavaScript\n * verification object is stored by the loaded script.\n * @private {string}\n */\ngoog.net.jsloader.GLOBAL_VERIFY_OBJS_ = 'closure_verification';\n\n\n/**\n * The default length of time, in milliseconds, we are prepared to wait for a\n * load request to complete.\n * @type {number}\n */\ngoog.net.jsloader.DEFAULT_TIMEOUT = 5000;\n\n\n/**\n * Optional parameters for goog.net.jsloader.send.\n * timeout: The length of time, in milliseconds, we are prepared to wait\n *     for a load request to complete, or 0 or negative for no timeout. Default\n *     is 5 seconds.\n * document: The HTML document under which to load the JavaScript. Default is\n *     the current document.\n * cleanupWhenDone: If true clean up the script tag after script completes to\n *     load. This is important if you just want to read data from the JavaScript\n *     and then throw it away. Default is false.\n * attributes: Additional attributes to set on the script tag.\n *\n * @typedef {{\n *   timeout: (number|undefined),\n *   document: (HTMLDocument|undefined),\n *   cleanupWhenDone: (boolean|undefined),\n *   attributes: (!Object<string, string>|undefined)\n * }}\n */\ngoog.net.jsloader.Options;\n\n\n/**\n * Scripts (URIs) waiting to be loaded.\n * @private {!Array<!goog.html.TrustedResourceUrl>}\n */\ngoog.net.jsloader.scriptsToLoad_ = [];\n\n\n/**\n * The deferred result of loading the URIs in scriptsToLoad_.\n * We need to return this to a caller that wants to load URIs while\n * a deferred is already working on them.\n * @private {!goog.async.Deferred<null>}\n */\ngoog.net.jsloader.scriptLoadingDeferred_;\n\n\n\n/**\n * Loads and evaluates the JavaScript files at the specified URIs, guaranteeing\n * the order of script loads.\n *\n * Because we have to load the scripts in serial (load script 1, exec script 1,\n * load script 2, exec script 2, and so on), this will be slower than doing\n * the network fetches in parallel.\n *\n * If you need to load a large number of scripts but dependency order doesn't\n * matter, you should just call goog.net.jsloader.safeLoad N times.\n *\n * If you need to load a large number of scripts on the same domain,\n * you may want to use goog.module.ModuleLoader.\n *\n * @param {Array<!goog.html.TrustedResourceUrl>} trustedUris The URIs to load.\n * @param {goog.net.jsloader.Options=} opt_options Optional parameters. See\n *     goog.net.jsloader.options documentation for details.\n * @return {!goog.async.Deferred} The deferred result, that may be used to add\n *     callbacks\n */\ngoog.net.jsloader.safeLoadMany = function(trustedUris, opt_options) {\n  // Loading the scripts in serial introduces asynchronosity into the flow.\n  // Therefore, there are race conditions where client A can kick off the load\n  // sequence for client B, even though client A's scripts haven't all been\n  // loaded yet.\n  //\n  // To work around this issue, all module loads share a queue.\n  if (!trustedUris.length) {\n    return goog.async.Deferred.succeed(null);\n  }\n\n  var isAnotherModuleLoading = goog.net.jsloader.scriptsToLoad_.length;\n  goog.array.extend(goog.net.jsloader.scriptsToLoad_, trustedUris);\n  if (isAnotherModuleLoading) {\n    // jsloader is still loading some other scripts.\n    // In order to prevent the race condition noted above, we just add\n    // these URIs to the end of the scripts' queue and return the deferred\n    // result of the ongoing script load, so the caller knows when they\n    // finish loading.\n    return goog.net.jsloader.scriptLoadingDeferred_;\n  }\n\n  trustedUris = goog.net.jsloader.scriptsToLoad_;\n  var popAndLoadNextScript = function() {\n    var trustedUri = trustedUris.shift();\n    var deferred = goog.net.jsloader.safeLoad(trustedUri, opt_options);\n    if (trustedUris.length) {\n      deferred.addBoth(popAndLoadNextScript);\n    }\n    return deferred;\n  };\n  goog.net.jsloader.scriptLoadingDeferred_ = popAndLoadNextScript();\n  return goog.net.jsloader.scriptLoadingDeferred_;\n};\n\n\n/**\n * Loads and evaluates a JavaScript file.\n * When the script loads, a user callback is called.\n * It is the client's responsibility to verify that the script ran successfully.\n *\n * @param {!goog.html.TrustedResourceUrl} trustedUri The URI of the JavaScript.\n * @param {goog.net.jsloader.Options=} opt_options Optional parameters. See\n *     goog.net.jsloader.Options documentation for details.\n * @return {!goog.async.Deferred} The deferred result, that may be used to add\n *     callbacks and/or cancel the transmission.\n *     The error callback will be called with a single goog.net.jsloader.Error\n *     parameter.\n */\ngoog.net.jsloader.safeLoad = function(trustedUri, opt_options) {\n  var options = opt_options || {};\n  var doc = options.document || document;\n  var uri = goog.html.TrustedResourceUrl.unwrap(trustedUri);\n\n  var script = goog.dom.createElement(goog.dom.TagName.SCRIPT);\n  var request = {script_: script, timeout_: undefined};\n  var deferred = new goog.async.Deferred(goog.net.jsloader.cancel_, request);\n\n  // Set a timeout.\n  var timeout = null;\n  var timeoutDuration = goog.isDefAndNotNull(options.timeout) ?\n      options.timeout :\n      goog.net.jsloader.DEFAULT_TIMEOUT;\n  if (timeoutDuration > 0) {\n    timeout = window.setTimeout(function() {\n      goog.net.jsloader.cleanup_(script, true);\n      deferred.errback(\n          new goog.net.jsloader.Error(\n              goog.net.jsloader.ErrorCode.TIMEOUT,\n              'Timeout reached for loading script ' + uri));\n    }, timeoutDuration);\n    request.timeout_ = timeout;\n  }\n\n  // Hang the user callback to be called when the script completes to load.\n  // NOTE(user): This callback will be called in IE even upon error. In any\n  // case it is the client's responsibility to verify that the script ran\n  // successfully.\n  script.onload = script.onreadystatechange = function() {\n    if (!script.readyState || script.readyState == 'loaded' ||\n        script.readyState == 'complete') {\n      var removeScriptNode = options.cleanupWhenDone || false;\n      goog.net.jsloader.cleanup_(script, removeScriptNode, timeout);\n      deferred.callback(null);\n    }\n  };\n\n  // Add an error callback.\n  // NOTE(user): Not supported in IE.\n  script.onerror = function() {\n    goog.net.jsloader.cleanup_(script, true, timeout);\n    deferred.errback(\n        new goog.net.jsloader.Error(\n            goog.net.jsloader.ErrorCode.LOAD_ERROR,\n            'Error while loading script ' + uri));\n  };\n\n  var properties = options.attributes || {};\n  goog.object.extend(\n      properties, {'type': 'text/javascript', 'charset': 'UTF-8'});\n  goog.dom.setProperties(script, properties);\n  // NOTE(user): Safari never loads the script if we don't set the src\n  // attribute before appending.\n  goog.dom.safe.setScriptSrc(script, trustedUri);\n  var scriptParent = goog.net.jsloader.getScriptParentElement_(doc);\n  scriptParent.appendChild(script);\n\n  return deferred;\n};\n\n\n/**\n * Loads a JavaScript file and verifies it was evaluated successfully, using a\n * verification object.\n * The verification object is set by the loaded JavaScript at the end of the\n * script.\n * We verify this object was set and return its value in the success callback.\n * If the object is not defined we trigger an error callback.\n *\n * @param {!goog.html.TrustedResourceUrl} trustedUri The URI of the JavaScript.\n * @param {string} verificationObjName The name of the verification object that\n *     the loaded script should set.\n * @param {goog.net.jsloader.Options} options Optional parameters. See\n *     goog.net.jsloader.Options documentation for details.\n * @return {!goog.async.Deferred} The deferred result, that may be used to add\n *     callbacks and/or cancel the transmission.\n *     The success callback will be called with a single parameter containing\n *     the value of the verification object.\n *     The error callback will be called with a single goog.net.jsloader.Error\n *     parameter.\n */\ngoog.net.jsloader.safeLoadAndVerify = function(\n    trustedUri, verificationObjName, options) {\n  // Define the global objects variable.\n  if (!goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_]) {\n    goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_] = {};\n  }\n  var verifyObjs = goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_];\n  var uri = goog.html.TrustedResourceUrl.unwrap(trustedUri);\n\n  // Verify that the expected object does not exist yet.\n  if (goog.isDef(verifyObjs[verificationObjName])) {\n    // TODO(user): Error or reset variable?\n    return goog.async.Deferred.fail(\n        new goog.net.jsloader.Error(\n            goog.net.jsloader.ErrorCode.VERIFY_OBJECT_ALREADY_EXISTS,\n            'Verification object ' + verificationObjName +\n                ' already defined.'));\n  }\n\n  // Send request to load the JavaScript.\n  var sendDeferred = goog.net.jsloader.safeLoad(trustedUri, options);\n\n  // Create a deferred object wrapping the send result.\n  var deferred =\n      new goog.async.Deferred(goog.bind(sendDeferred.cancel, sendDeferred));\n\n  // Call user back with object that was set by the script.\n  sendDeferred.addCallback(function() {\n    var result = verifyObjs[verificationObjName];\n    if (goog.isDef(result)) {\n      deferred.callback(result);\n      delete verifyObjs[verificationObjName];\n    } else {\n      // Error: script was not loaded properly.\n      deferred.errback(\n          new goog.net.jsloader.Error(\n              goog.net.jsloader.ErrorCode.VERIFY_ERROR, 'Script ' + uri +\n                  ' loaded, but verification object ' + verificationObjName +\n                  ' was not defined.'));\n    }\n  });\n\n  // Pass error to new deferred object.\n  sendDeferred.addErrback(function(error) {\n    if (goog.isDef(verifyObjs[verificationObjName])) {\n      delete verifyObjs[verificationObjName];\n    }\n    deferred.errback(error);\n  });\n\n  return deferred;\n};\n\n\n/**\n * Gets the DOM element under which we should add new script elements.\n * How? Take the first head element, and if not found take doc.documentElement,\n * which always exists.\n *\n * @param {!HTMLDocument} doc The relevant document.\n * @return {!Element} The script parent element.\n * @private\n */\ngoog.net.jsloader.getScriptParentElement_ = function(doc) {\n  var headElements = goog.dom.getElementsByTagName(goog.dom.TagName.HEAD, doc);\n  if (!headElements || goog.array.isEmpty(headElements)) {\n    return doc.documentElement;\n  } else {\n    return headElements[0];\n  }\n};\n\n\n/**\n * Cancels a given request.\n * @this {{script_: Element, timeout_: number}} The request context.\n * @private\n */\ngoog.net.jsloader.cancel_ = function() {\n  var request = this;\n  if (request && request.script_) {\n    var scriptNode = request.script_;\n    if (scriptNode && scriptNode.tagName == goog.dom.TagName.SCRIPT) {\n      goog.net.jsloader.cleanup_(scriptNode, true, request.timeout_);\n    }\n  }\n};\n\n\n/**\n * Removes the script node and the timeout.\n * @param {Node} scriptNode The node to be cleaned up.\n * @param {boolean} removeScriptNode If true completely remove the script node.\n * @param {?number=} opt_timeout The timeout handler to cleanup.\n * @private\n * @suppress {strictMissingProperties} Part of the go/strict_warnings_migration\n */\ngoog.net.jsloader.cleanup_ = function(\n    scriptNode, removeScriptNode, opt_timeout) {\n  if (goog.isDefAndNotNull(opt_timeout)) {\n    goog.global.clearTimeout(opt_timeout);\n  }\n\n  scriptNode.onload = goog.nullFunction;\n  scriptNode.onerror = goog.nullFunction;\n  scriptNode.onreadystatechange = goog.nullFunction;\n\n  // Do this after a delay (removing the script node of a running script can\n  // confuse older IEs).\n  if (removeScriptNode) {\n    window.setTimeout(function() { goog.dom.removeNode(scriptNode); }, 0);\n  }\n};\n\n\n/**\n * Possible error codes for jsloader.\n * @enum {number}\n */\ngoog.net.jsloader.ErrorCode = {\n  LOAD_ERROR: 0,\n  TIMEOUT: 1,\n  VERIFY_ERROR: 2,\n  VERIFY_OBJECT_ALREADY_EXISTS: 3\n};\n\n\n\n/**\n * A jsloader error.\n *\n * @param {goog.net.jsloader.ErrorCode} code The error code.\n * @param {string=} opt_message Additional message.\n * @constructor\n * @extends {goog.debug.Error}\n * @final\n */\ngoog.net.jsloader.Error = function(code, opt_message) {\n  var msg = 'Jsloader error (code #' + code + ')';\n  if (opt_message) {\n    msg += ': ' + opt_message;\n  }\n  goog.net.jsloader.Error.base(this, 'constructor', msg);\n\n  /**\n   * The code for this error.\n   *\n   * @type {goog.net.jsloader.ErrorCode}\n   */\n  this.code = code;\n};\ngoog.inherits(goog.net.jsloader.Error, goog.debug.Error);\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines fireauth.iframeclient.IframeWrapper used to communicate\n * with the hidden iframe to detect Auth events.\n */\n\ngoog.provide('fireauth.iframeclient.IframeWrapper');\n\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.net.jsloader');\ngoog.require('goog.string.Const');\n\n\n/**\n * Defines the hidden iframe wrapper for cross origin communications.\n * @param {string} url The hidden iframe src URL.\n * @constructor\n */\nfireauth.iframeclient.IframeWrapper = function(url) {\n  /** @private {string} The hidden iframe URL. */\n  this.url_ = url;\n\n  /**\n   * @type {?gapi.iframes.Iframe}\n   * @private\n   */\n  this.iframe_ = null;\n\n  /** @private {!goog.Promise} A promise that resolves on iframe open. */\n  this.onIframeOpen_ = this.open_();\n};\n\n\n/**\n * @typedef {{\n *   type: string\n * }}\n */\nfireauth.iframeclient.IframeWrapper.Message;\n\n/**\n * Returns URL, src of the hidden iframe.\n * @return {string}\n * @private\n */\nfireauth.iframeclient.IframeWrapper.prototype.getPath_ = function() {\n  return this.url_;\n};\n\n\n/**\n * @return {!goog.Promise} The promise that resolves when the iframe is ready.\n */\nfireauth.iframeclient.IframeWrapper.prototype.onReady = function() {\n  return this.onIframeOpen_;\n};\n\n\n/**\n * Returns options used to open the iframe.\n * @return {!gapi.iframes.OptionsBag}\n * @private\n */\nfireauth.iframeclient.IframeWrapper.prototype.getOptions_ = function() {\n  var options = /** @type {!gapi.iframes.OptionsBag} */ ({\n    'where': document.body,\n    'url': this.getPath_(),\n    'messageHandlersFilter': /** @type {!gapi.iframes.IframesFilter} */ (\n        fireauth.util.getObjectRef(\n            'gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER')),\n    'attributes': {\n      'style': {\n        'position': 'absolute',\n        'top': '-100px',\n        'width': '1px',\n        'height': '1px'\n      }\n    },\n    'dontclear': true\n  });\n  return options;\n};\n\n\n/**\n * Opens an iframe.\n * @return {!goog.Promise} A promise that resolves on successful iframe open.\n * @private\n */\nfireauth.iframeclient.IframeWrapper.prototype.open_ = function() {\n  var self = this;\n  return fireauth.iframeclient.IframeWrapper.loadGApiJs_().then(function() {\n    return new goog.Promise(function(resolve, reject) {\n      /**\n       * @param {?gapi.iframes.Iframe} iframe The new opened iframe.\n       */\n      var onOpen = function(iframe) {\n        self.iframe_ = iframe;\n        self.iframe_.restyle({\n          // Prevent iframe from closing on mouse out.\n          'setHideOnLeave': false\n        });\n        // Confirm iframe is correctly loaded.\n        // To fallback on failure, set a timeout.\n        var networkErrorTimer = setTimeout(function() {\n          reject(new Error('Network Error'));\n        }, fireauth.iframeclient.IframeWrapper.PING_TIMEOUT_.get());\n        // Clear timer and resolve pending iframe ready promise.\n        var clearTimerAndResolve = function() {\n          clearTimeout(networkErrorTimer);\n          resolve();\n        };\n        // This returns an IThenable. However the reject part does not call\n        // when the iframe is not loaded.\n        iframe.ping(clearTimerAndResolve).then(\n            clearTimerAndResolve,\n            function(error) { reject(new Error('Network Error')); });\n      };\n      /** @type {function():!gapi.iframes.Context} */ (\n          fireauth.util.getObjectRef('gapi.iframes.getContext'))().open(\n              self.getOptions_(), onOpen);\n    });\n  });\n};\n\n\n/**\n * @param {!fireauth.iframeclient.IframeWrapper.Message} message to send.\n * @return {!goog.Promise<?Object>} The promise that resolve when message is\n *     sent.\n */\nfireauth.iframeclient.IframeWrapper.prototype.sendMessage = function(message) {\n  var self = this;\n  return this.onIframeOpen_.then(function() {\n    return new goog.Promise(function(resolve, reject) {\n      self.iframe_.send(\n          message['type'],\n          message,\n          resolve,\n          /** @type {!gapi.iframes.IframesFilter} */ (\n              fireauth.util.getObjectRef(\n                  'gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER')));\n\n    });\n  });\n};\n\n\n/**\n * Registers a listener to a post message.\n * @param {string} eventName The message to register for.\n * @param {gapi.iframes.MessageHandler} handler Message handler.\n */\nfireauth.iframeclient.IframeWrapper.prototype.registerEvent =\n    function(eventName, handler) {\n  var self = this;\n  this.onIframeOpen_.then(function() {\n    self.iframe_.register(\n        eventName,\n        /** @type {function(this:gapi.iframes.Iframe,\n         *                  *, gapi.iframes.Iframe): *}\n         */ (handler),\n        /** @type {!gapi.iframes.IframesFilter} */ (\n            fireauth.util.getObjectRef(\n                'gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER')));\n  });\n};\n\n\n/**\n * Unregisters a listener to a post message.\n * @param {string} eventName The message to unregister.\n * @param {gapi.iframes.MessageHandler} handler Message handler.\n */\nfireauth.iframeclient.IframeWrapper.prototype.unregisterEvent =\n    function(eventName, handler) {\n  var self = this;\n  this.onIframeOpen_.then(function() {\n    self.iframe_.unregister(\n        eventName,\n        /** @type {(function(this:gapi.iframes.Iframe,\n         *                   *, gapi.iframes.Iframe): *|undefined)}\n         */ (handler));\n  });\n};\n\n\n/** @private @const {!goog.string.Const} The GApi loader URL. */\nfireauth.iframeclient.IframeWrapper.GAPI_LOADER_SRC_ = goog.string.Const.from(\n    'https://apis.google.com/js/api.js?onload=%{onload}');\n\n\n/**\n * @private @const {!fireauth.util.Delay} The gapi.load network error timeout\n *     delay with units in ms.\n */\nfireauth.iframeclient.IframeWrapper.NETWORK_TIMEOUT_ =\n    new fireauth.util.Delay(30000, 60000);\n\n\n/**\n * @private @const {!fireauth.util.Delay} The iframe ping error timeout delay\n *     with units in ms.\n */\nfireauth.iframeclient.IframeWrapper.PING_TIMEOUT_ =\n    new fireauth.util.Delay(5000, 15000);\n\n\n/** @private {?goog.Promise} The cached GApi loader promise. */\nfireauth.iframeclient.IframeWrapper.cachedGApiLoader_ = null;\n\n\n/** Resets the cached GApi loader. */\nfireauth.iframeclient.IframeWrapper.resetCachedGApiLoader = function() {\n  fireauth.iframeclient.IframeWrapper.cachedGApiLoader_ = null;\n};\n\n\n\n/**\n * Loads the GApi client library if it is not loaded for gapi.iframes usage.\n * @return {!goog.Promise} A promise that resolves when gapi.iframes is loaded.\n * @private\n */\nfireauth.iframeclient.IframeWrapper.loadGApiJs_ = function() {\n  // If already pending or resolved, return the cached promise.\n  if (fireauth.iframeclient.IframeWrapper.cachedGApiLoader_) {\n    return fireauth.iframeclient.IframeWrapper.cachedGApiLoader_;\n  }\n  // If there is no cached promise, initialize a new one.\n  fireauth.iframeclient.IframeWrapper.cachedGApiLoader_ =\n      new goog.Promise(function(resolve, reject) {\n    // Function to run when gapi.load is ready.\n    var onGapiLoad = function() {\n      // The developer may have tried to previously run gapi.load and failed.\n      // Run this to fix that.\n      fireauth.util.resetUnloadedGapiModules();\n      var loader = /** @type {function(string, !Object)} */ (\n          fireauth.util.getObjectRef('gapi.load'));\n      loader('gapi.iframes', {\n        'callback': resolve,\n        'ontimeout': function() {\n          // The above reset may be sufficient, but having this reset after\n          // failure ensures that if the developer calls gapi.load after the\n          // connection is re-established and before another attempt to embed\n          // the iframe, it would work and would not be broken because of our\n          // failed attempt.\n          // Timeout when gapi.iframes.Iframe not loaded.\n          fireauth.util.resetUnloadedGapiModules();\n          reject(new Error('Network Error'));\n        },\n        'timeout': fireauth.iframeclient.IframeWrapper.NETWORK_TIMEOUT_.get()\n      });\n    };\n    if (fireauth.util.getObjectRef('gapi.iframes.Iframe')) {\n      // If gapi.iframes.Iframe available, resolve.\n      resolve();\n    } else if (fireauth.util.getObjectRef('gapi.load')) {\n      // Gapi loader ready, load gapi.iframes.\n      onGapiLoad();\n    } else {\n      // Create a new iframe callback when this is called so as not to overwrite\n      // any previous defined callback. This happens if this method is called\n      // multiple times in parallel and could result in the later callback\n      // overwriting the previous one. This would end up with a iframe\n      // timeout.\n      var cbName = '__iframefcb' +\n          Math.floor(Math.random() * 1000000).toString();\n      // GApi loader not available, dynamically load platform.js.\n      goog.global[cbName] = function() {\n        // GApi loader should be ready.\n        if (fireauth.util.getObjectRef('gapi.load')) {\n          onGapiLoad();\n        } else {\n          // Gapi loader failed, throw error.\n          reject(new Error('Network Error'));\n        }\n      };\n      // Build GApi loader.\n      var url = goog.html.TrustedResourceUrl.format(\n          fireauth.iframeclient.IframeWrapper.GAPI_LOADER_SRC_,\n          {'onload': cbName});\n      // Load GApi loader.\n      var result = goog.Promise.resolve(goog.net.jsloader.safeLoad(url));\n      result.thenCatch(function(error) {\n        // In case library fails to load, typically due to a network error,\n        // reset cached loader to null to force a refresh on a retrial.\n        reject(new Error('Network Error'));\n      });\n    }\n  }).thenCatch(function(error) {\n    // Reset cached promise to allow for retrial.\n    fireauth.iframeclient.IframeWrapper.cachedGApiLoader_ = null;\n    throw error;\n  });\n  return fireauth.iframeclient.IframeWrapper.cachedGApiLoader_;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines fireauth.iframeclient.IfcHandler used to communicate\n * with the serverless widget.\n */\n\ngoog.provide('fireauth.iframeclient.IfcHandler');\ngoog.provide('fireauth.iframeclient.IframeUrlBuilder');\ngoog.provide('fireauth.iframeclient.OAuthUrlBuilder');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.AuthEvent');\ngoog.require('fireauth.AuthProvider');\ngoog.require('fireauth.InvalidOriginError');\ngoog.require('fireauth.OAuthSignInHandler');\ngoog.require('fireauth.RpcHandler');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.constants');\ngoog.require('fireauth.iframeclient.IframeWrapper');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.Timer');\ngoog.require('goog.Uri');\ngoog.require('goog.array');\ngoog.require('goog.object');\n\n\n/**\n * The OAuth handler and iframe prototcol.\n * @const {string}\n * @suppress {const|duplicate}\n */\nfireauth.iframeclient.SCHEME = 'https';\n\n\n\n/**\n * The OAuth handler and iframe port number.\n * @const {?number}\n * @suppress {const|duplicate}\n */\nfireauth.iframeclient.PORT_NUMBER = null;\n\n\n\n/**\n * The iframe URL builder used to build the iframe widget URL.\n * @param {string} authDomain The application authDomain.\n * @param {string} apiKey The API key.\n * @param {string} appName The App name.\n * @constructor\n */\nfireauth.iframeclient.IframeUrlBuilder = function(authDomain, apiKey, appName) {\n  /** @private {string} The application authDomain. */\n  this.authDomain_ = authDomain;\n  /** @private {string} The API key. */\n  this.apiKey_ = apiKey;\n  /** @private {string} The App name. */\n  this.appName_ = appName;\n  /** @private {?string|undefined} The client version. */\n  this.v_ = null;\n  /**\n   * @private {!goog.Uri} The URI object used to build the iframe URL.\n   */\n  this.uri_ = goog.Uri.create(\n      fireauth.iframeclient.SCHEME,\n      null,\n      this.authDomain_,\n      fireauth.iframeclient.PORT_NUMBER,\n      '/__/auth/iframe',\n      null,\n      null);\n  this.uri_.setParameterValue('apiKey', this.apiKey_);\n  this.uri_.setParameterValue('appName', this.appName_);\n  /** @private {?string|undefined} The endpoint ID. */\n  this.endpointId_ = null;\n  /** @private {!Array<string>} The list of framework IDs. */\n  this.frameworks_ = [];\n};\n\n\n/**\n * Sets the client version.\n * @param {?string|undefined} v The client version.\n * @return {!fireauth.iframeclient.IframeUrlBuilder} The current iframe URL\n *     builder instance.\n */\nfireauth.iframeclient.IframeUrlBuilder.prototype.setVersion = function(v) {\n  this.v_ = v;\n  return this;\n};\n\n\n/**\n * Sets the endpoint ID.\n * @param {?string|undefined} eid The endpoint ID (staging, test Gaia, etc).\n * @return {!fireauth.iframeclient.IframeUrlBuilder} The current iframe URL\n *     builder instance.\n */\nfireauth.iframeclient.IframeUrlBuilder.prototype.setEndpointId = function(eid) {\n  this.endpointId_ = eid;\n  return this;\n};\n\n\n/**\n * Sets the list of frameworks to pass to the iframe.\n * @param {?Array<string>|undefined} frameworks The list of frameworks to log.\n * @return {!fireauth.iframeclient.IframeUrlBuilder} The current iframe URL\n *     builder instance.\n */\nfireauth.iframeclient.IframeUrlBuilder.prototype.setFrameworks =\n    function(frameworks) {\n  this.frameworks_ = goog.array.clone(frameworks || []);\n  return this;\n};\n\n\n/**\n * Modifes the URI with the relevant Auth provider parameters.\n * @return {string} The constructed OAuth URL string.\n * @override\n */\nfireauth.iframeclient.IframeUrlBuilder.prototype.toString = function() {\n  // Pass the client version if available.\n  if (this.v_) {\n    this.uri_.setParameterValue('v', this.v_);\n  } else {\n    this.uri_.removeParameter('v');\n  }\n  // Pass the endpoint ID if available.\n  if (this.endpointId_) {\n    this.uri_.setParameterValue('eid', this.endpointId_);\n  } else {\n    this.uri_.removeParameter('eid');\n  }\n  // Pass the list of frameworks if available.\n  if (this.frameworks_.length) {\n    this.uri_.setParameterValue('fw', this.frameworks_.join(','));\n  } else {\n    this.uri_.removeParameter('fw');\n  }\n  return this.uri_.toString();\n};\n\n\n\n/**\n * The OAuth URL builder used to build the OAuth handler widget URL.\n * @param {string} authDomain The application authDomain.\n * @param {string} apiKey The API key.\n * @param {string} appName The App name.\n * @param {string} authType The Auth operation type.\n * @param {!fireauth.AuthProvider} provider The Auth provider that the OAuth\n *     handler request is built to sign in to.\n * @constructor\n */\nfireauth.iframeclient.OAuthUrlBuilder =\n    function(authDomain, apiKey, appName, authType, provider) {\n  /** @private {string} The application authDomain. */\n  this.authDomain_ = authDomain;\n  /** @private {string} The API key. */\n  this.apiKey_ = apiKey;\n  /** @private {string} The App name. */\n  this.appName_ = appName;\n  /** @private {string} The Auth operation type. */\n  this.authType_ = authType;\n  /**\n   * @private {?string|undefined} The redirect URL used in redirect operations.\n   */\n  this.redirectUrl_ = null;\n  /** @private {?string|undefined} The event ID. */\n  this.eventId_ = null;\n  /** @private {?string|undefined} The client version. */\n  this.v_ = null;\n  /**\n   * @private {!fireauth.AuthProvider} The Firebase Auth provider that the OAuth\n   *     handler request is built to sign in to.\n   */\n  this.provider_ = provider;\n  /** @private {?string|undefined} The endpoint ID. */\n  this.endpointId_ = null;\n  /** @private {?string|undefined} The tenant ID. */\n  this.tenantId_ = null;\n};\n\n\n/**\n * Sets the redirect URL.\n * @param {?string|undefined} redirectUrl The redirect URL used in redirect\n *     operations.\n * @return {!fireauth.iframeclient.OAuthUrlBuilder} The current OAuth URL\n *     builder instance.\n */\nfireauth.iframeclient.OAuthUrlBuilder.prototype.setRedirectUrl =\n    function(redirectUrl) {\n  this.redirectUrl_ = redirectUrl;\n  return this;\n};\n\n\n/**\n * Sets the event ID.\n * @param {?string|undefined} eventId The event ID.\n * @return {!fireauth.iframeclient.OAuthUrlBuilder} The current OAuth URL\n *     builder instance.\n */\nfireauth.iframeclient.OAuthUrlBuilder.prototype.setEventId = function(eventId) {\n  this.eventId_ = eventId;\n  return this;\n};\n\n\n/**\n * Sets the tenant ID.\n * @param {?string|undefined} tenantId The event ID.\n * @return {!fireauth.iframeclient.OAuthUrlBuilder} The current OAuth URL\n *     builder instance.\n */\nfireauth.iframeclient.OAuthUrlBuilder.prototype.setTenantId =\n    function(tenantId) {\n  this.tenantId_ = tenantId;\n  return this;\n};\n\n\n/**\n * Sets the client version.\n * @param {?string|undefined} v The client version.\n * @return {!fireauth.iframeclient.OAuthUrlBuilder} The current OAuth URL\n *     builder instance.\n */\nfireauth.iframeclient.OAuthUrlBuilder.prototype.setVersion = function(v) {\n  this.v_ = v;\n  return this;\n};\n\n\n/**\n * Sets the endpoint ID.\n * @param {?string|undefined} eid The endpoint ID (staging, test Gaia, etc).\n * @return {!fireauth.iframeclient.OAuthUrlBuilder} The current OAuth URL\n *     builder instance.\n */\nfireauth.iframeclient.OAuthUrlBuilder.prototype.setEndpointId = function(eid) {\n  this.endpointId_ = eid;\n  return this;\n};\n\n\n/**\n * Sets any additional optional parameters. This will overwrite any previously\n * set additional parameters.\n * @param {?Object<string, string>|undefined} additionalParams The optional\n *     additional parameters.\n * @return {!fireauth.iframeclient.OAuthUrlBuilder} The current OAuth URL\n *     builder instance.\n */\nfireauth.iframeclient.OAuthUrlBuilder.prototype.setAdditionalParameters =\n    function(additionalParams) {\n  this.additionalParams_ = goog.object.clone(additionalParams || null);\n  return this;\n};\n\n\n/**\n * Modifies the URI with the relevant Auth provider parameters.\n * @return {string} The constructed OAuth URL string.\n * @override\n */\nfireauth.iframeclient.OAuthUrlBuilder.prototype.toString = function() {\n  var uri = goog.Uri.create(\n      fireauth.iframeclient.SCHEME,\n      null,\n      this.authDomain_,\n      fireauth.iframeclient.PORT_NUMBER,\n      '/__/auth/handler',\n      null,\n      null);\n  uri.setParameterValue('apiKey', this.apiKey_);\n  uri.setParameterValue('appName', this.appName_);\n  uri.setParameterValue('authType', this.authType_);\n\n  // Add custom parameters for OAuth1/OAuth2 providers.\n  if (this.provider_['isOAuthProvider']) {\n    // Set default language if available and no language already set.\n    /** @type {!fireauth.FederatedProvider} */ (this.provider_)\n        .setDefaultLanguage(this.getAuthLanguage_());\n    uri.setParameterValue('providerId', this.provider_['providerId']);\n    var customParameters = /** @type {!fireauth.FederatedProvider} */ (\n        this.provider_).getCustomParameters();\n    if (!goog.object.isEmpty(customParameters)) {\n      uri.setParameterValue(\n          'customParameters',\n          /** @type {string} */ (fireauth.util.stringifyJSON(customParameters))\n          );\n    }\n  }\n\n  // Add scopes for OAuth2 providers.\n  if (typeof this.provider_.getScopes === 'function') {\n    var scopes = this.provider_.getScopes();\n    if (scopes.length) {\n      uri.setParameterValue('scopes', scopes.join(','));\n    }\n  }\n\n  if (this.redirectUrl_) {\n    uri.setParameterValue('redirectUrl', this.redirectUrl_);\n  } else {\n    uri.removeParameter('redirectUrl');\n  }\n  if (this.eventId_) {\n    uri.setParameterValue('eventId', this.eventId_);\n  } else {\n    uri.removeParameter('eventId');\n  }\n  // Pass the client version if available.\n  if (this.v_) {\n    uri.setParameterValue('v', this.v_);\n  } else {\n    uri.removeParameter('v');\n  }\n  if (this.additionalParams_) {\n    for (var key in this.additionalParams_) {\n      if (this.additionalParams_.hasOwnProperty(key) &&\n          // Don't overwrite other existing parameters.\n          !uri.getParameterValue(key)) {\n        uri.setParameterValue(key, this.additionalParams_[key]);\n      }\n    }\n  }\n  // Pass the tenant ID if available.\n  if (this.tenantId_) {\n    uri.setParameterValue('tid', this.tenantId_);\n  } else {\n    uri.removeParameter('tid');\n  }\n  // Pass the endpoint ID if available.\n  if (this.endpointId_) {\n    uri.setParameterValue('eid', this.endpointId_);\n  } else {\n    uri.removeParameter('eid');\n  }\n  // Append any framework IDs to the handler URL to log in handler RPC requests.\n  var frameworks = this.getAuthFrameworks_();\n  if (frameworks.length) {\n    uri.setParameterValue('fw', frameworks.join(','));\n  }\n  return uri.toString();\n};\n\n\n/**\n * Returns the current Auth instance's language code.\n * @return {?string} The corresponding language code.\n * @private\n */\nfireauth.iframeclient.OAuthUrlBuilder.prototype.getAuthLanguage_ = function() {\n  try {\n    // Get the Auth instance for the current App identified by the App name.\n    // This could fail if, for example, the App instance was deleted.\n    return firebase['app'](this.appName_)['auth']().getLanguageCode();\n  } catch (e) {\n    return null;\n  }\n};\n\n\n/**\n * Returns the list of Firebase frameworks used for logging purposes.\n * @return {!Array<string>} The list of corresponding Firebase frameworks.\n * @private\n */\nfireauth.iframeclient.OAuthUrlBuilder.prototype.getAuthFrameworks_ =\n    function() {\n  return fireauth.iframeclient.OAuthUrlBuilder.getAuthFrameworksForApp_(\n      this.appName_);\n};\n\n\n/**\n * Returns the list of Firebase frameworks used for logging purposes\n * corresponding to the Firebase App name provided.\n * @param {string} appName The Firebase App name.\n * @return {!Array<string>} The list of corresponding Firebase frameworks.\n * @private\n */\nfireauth.iframeclient.OAuthUrlBuilder.getAuthFrameworksForApp_ =\n    function(appName) {\n  try {\n    // Get the Auth instance's list of Firebase framework IDs for the current\n    // App identified by the App name.\n    // This could fail if, for example, the App instance was deleted.\n    return firebase['app'](appName)['auth']().getFramework();\n  } catch (e) {\n    return [];\n  }\n};\n\n\n\n/**\n * Initializes the ifcHandler which provides the mechanism to listen to Auth\n * events on the hidden iframe.\n * @param {string} authDomain The firebase authDomain used to determine the\n *     OAuth helper page domain.\n * @param {string} apiKey The API key for sending backend Auth requests.\n * @param {string} appName The App ID for the Auth instance that triggered this\n *     request.\n * @param {?string=} opt_clientVersion The optional client version string.\n * @param {?string=} opt_endpointId The endpoint ID (staging, test Gaia, etc).\n * @constructor\n * @implements {fireauth.OAuthSignInHandler}\n */\nfireauth.iframeclient.IfcHandler = function(authDomain, apiKey, appName,\n    opt_clientVersion, opt_endpointId) {\n  /** @private {string} The Auth domain. */\n  this.authDomain_ = authDomain;\n  /** @private {string} The API key. */\n  this.apiKey_ = apiKey;\n  /** @private {string} The App name. */\n  this.appName_ = appName;\n  /** @private {?string} The client version. */\n  this.clientVersion_ = opt_clientVersion || null;\n  /** @private {?string} The Auth endpoint ID. */\n  this.endpointId_ = opt_endpointId || null;\n  // Delay RPC handler and iframe URL initialization until needed to ensure\n  // logged frameworks are propagated to the iframe.\n  /** @private {?string} The full client version string. */\n  this.fullClientVersion_ = null;\n  /** @private {?string} The iframe URL. */\n  this.iframeUrl_ = null;\n  /** @private {?fireauth.RpcHandler} The RPC handler for provided API key. */\n  this.rpcHandler_ = null;\n  /**\n   * @private {!Array<!function(?fireauth.AuthEvent)>} The Auth event\n   *     listeners.\n   */\n  this.authEventListeners_ = [];\n  // Delay origin validator determination until needed, so the error is not\n  // thrown in the background. This will also prevent the getProjectConfig RPC\n  // until it is required.\n  /** @private {?goog.Promise} The origin validator. */\n  this.originValidator_ = null;\n  /** @private {?goog.Promise} The initialization promise. */\n  this.isInitialized_ = null;\n};\n\n\n/**\n * Validates the provided URL.\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler used to validate the\n *     requested origin.\n * @param {string=} opt_origin The optional page origin. If not provided, the\n *     window.location.href value is used.\n * @return {!goog.Promise} The promise that resolves if the provided origin is\n *     valid.\n * @private\n */\nfireauth.iframeclient.IfcHandler.getOriginValidator_ =\n    function(rpcHandler, opt_origin) {\n  var origin = opt_origin || fireauth.util.getCurrentUrl();\n  return rpcHandler.getAuthorizedDomains().then(function(authorizedDomains) {\n    if (!fireauth.util.isAuthorizedDomain(authorizedDomains, origin)) {\n      throw new fireauth.InvalidOriginError(fireauth.util.getCurrentUrl());\n    }\n  });\n};\n\n\n/**\n * Initializes the iframe client wrapper.\n * @return {!goog.Promise} The promise that resolves on initialization.\n */\nfireauth.iframeclient.IfcHandler.prototype.initialize = function() {\n  // Already initialized.\n  if (this.isInitialized_) {\n    return this.isInitialized_;\n  }\n  var self = this;\n  this.isInitialized_ = fireauth.util.onDomReady().then(function() {\n    /**\n     * @private {!fireauth.iframeclient.IframeWrapper} The iframe wrapper\n     *     instance.\n     */\n    self.iframeWrapper_ = new fireauth.iframeclient.IframeWrapper(\n        self.getIframeUrl());\n    // Register all event listeners to Auth event messages sent from Auth\n    // iframe.\n    self.registerEvents_();\n  });\n  return this.isInitialized_;\n};\n\n\n/**\n * Waits for popup window to close. When closed start timeout listener for popup\n * pending promise. If in the process, it was detected that the iframe does not\n * support web storage, the popup is closed and the web storage unsupported\n * error is thrown.\n * @param {!Window} popupWin The popup window.\n * @param {!function(!fireauth.AuthError)} onError The on error callback.\n * @param {number} timeoutDuration The time to wait in ms after the popup is\n *     closed before triggering the popup closed by user error.\n * @return {!goog.Promise}\n * @override\n */\nfireauth.iframeclient.IfcHandler.prototype.startPopupTimeout =\n    function(popupWin, onError, timeoutDuration) {\n  // Expire pending timeout promise for popup operation.\n  var popupClosedByUserError = new fireauth.AuthError(\n      fireauth.authenum.Error.POPUP_CLOSED_BY_USER);\n  // If web storage is disabled in the iframe, expire popup timeout quickly with\n  // this error.\n  var webStorageNotSupportedError = new fireauth.AuthError(\n      fireauth.authenum.Error.WEB_STORAGE_UNSUPPORTED);\n  var self = this;\n  var isResolved = false;\n  // Wait for the iframe to be ready first.\n  return this.initializeAndWait().then(function() {\n    // We do not return isWebStorageSupported() to ensure that this is backward\n    // compatible.\n    // Pushing the following client changes before updating the iframe to\n    // respond to these events would continue to work.\n    // The downside is that the popup could be closed before this resolves.\n    // In that case, they would get an error that the popup was closed and not\n    // the error that web storage is not supported, though that is unlikely\n    // as isWebStorageSupported should execute faster than the popup timeout.\n    // If web storage is not supported in the iframe, fail quickly.\n    self.isWebStorageSupported().then(function(isSupported) {\n      if (!isSupported) {\n        // If not supported, close window.\n        if (popupWin) {\n          fireauth.util.closeWindow(popupWin);\n        }\n        onError(webStorageNotSupportedError);\n        isResolved = true;\n      }\n    });\n  }).thenCatch(function(error) {\n    // Ignore any possible error in iframe embedding.\n    // These types of errors will be handled in processPopup which will close\n    // the popup too if that happens.\n    return;\n  }).then(function() {\n    // Skip if already resolved.\n    if (isResolved) {\n      return;\n    }\n    // After the iframe is ready, wait for popup to close and then start timeout\n    // check.\n    return fireauth.util.onPopupClose(popupWin);\n  }).then(function() {\n    // Skip if already resolved.\n    if (isResolved) {\n      return;\n    }\n    return goog.Timer.promise(timeoutDuration).then(function() {\n      // If this is already resolved or rejected, this will do nothing.\n      onError(popupClosedByUserError);\n    });\n  });\n};\n\n\n/**\n * @return {boolean} Whether the handler should be initialized early.\n * @override\n */\nfireauth.iframeclient.IfcHandler.prototype.shouldBeInitializedEarly =\n    function() {\n  var ua = fireauth.util.getUserAgentString();\n  // Cannot run in the background (can't wait for iframe to be embedded\n  // before triggering popup redirect) and is Safari (can only detect\n  // localStorage in iframe via change event) => embed iframe ASAP.\n  // Do the same for mobile browsers on iOS devices as they use the same\n  // Safari implementation underneath.\n  return !fireauth.util.runsInBackground(ua) &&\n         !fireauth.util.iframeCanSyncWebStorage(ua);\n};\n\n\n/**\n * @return {boolean} Whether the sign-in handler in the current environment\n *     has volatile session storage.\n * @override\n */\nfireauth.iframeclient.IfcHandler.prototype.hasVolatileStorage = function() {\n  // Web environment with web storage enabled has stable sessionStorage.\n  return false;\n};\n\n\n/**\n * Processes the popup request. The popup instance must be provided externally\n * and on error, the requestor must close the window.\n * @param {?Window} popupWin The popup window reference.\n * @param {!fireauth.AuthEvent.Type} mode The Auth event type.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @param {function()} onInitialize The function to call on initialization.\n * @param {function(*)} onError The function to call on error.\n * @param {string=} opt_eventId The optional event ID.\n * @param {boolean=} opt_alreadyRedirected Whether popup is already redirected\n *     to final destination.\n * @param {?string=} opt_tenantId The optional tenant ID.\n * @return {!goog.Promise} The popup window promise.\n * @override\n */\nfireauth.iframeclient.IfcHandler.prototype.processPopup = function(\n    popupWin,\n    mode,\n    provider,\n    onInitialize,\n    onError,\n    opt_eventId,\n    opt_alreadyRedirected,\n    opt_tenantId) {\n  // processPopup is failing since it tries to access popup win when tab can\n  // not run in background. For now bypass processPopup which runs\n  // additional origin check not accounted above. Besides, iframe will never\n  // hand result to parent if origin not whitelisted.\n  // Error thrown by browser: Unable to establish a connection with the\n  // popup. It may have been blocked by the browser.\n  // If popup is null, startPopupTimeout will catch it without having the\n  // above error getting triggered due to popup access from opener.\n\n  // Reject immediately if the popup is blocked.\n  if (!popupWin) {\n    return goog.Promise.reject(\n        new fireauth.AuthError(fireauth.authenum.Error.POPUP_BLOCKED));\n  }\n  // Already redirected and cannot run in the background, resolve quickly while\n  // initializing.\n  if (opt_alreadyRedirected && !fireauth.util.runsInBackground()) {\n    // Initialize first before resolving.\n    this.initializeAndWait().thenCatch(function(error) {\n      fireauth.util.closeWindow(popupWin);\n      onError(error);\n    });\n    onInitialize();\n    // Already redirected.\n    return goog.Promise.resolve();\n  }\n  // If origin validator not determined yet.\n  if (!this.originValidator_) {\n    this.originValidator_ =\n        fireauth.iframeclient.IfcHandler.getOriginValidator_(\n            this.getRpcHandler_());\n  }\n  var self = this;\n  return this.originValidator_.then(function() {\n    // After origin validation, wait for iframe to be ready before redirecting.\n    var onReady = self.initializeAndWait().thenCatch(function(error) {\n      fireauth.util.closeWindow(popupWin);\n      onError(error);\n      throw error;\n    });\n    onInitialize();\n    return onReady;\n  }).then(function() {\n    // Popup and redirect operations work for OAuth providers only.\n    fireauth.AuthProvider.checkIfOAuthSupported(provider);\n    // Already redirected to intended destination, no need to redirect again.\n    if (opt_alreadyRedirected) {\n      return;\n    }\n    var oauthHelperWidgetUrl =\n        fireauth.iframeclient.IfcHandler.getOAuthHelperWidgetUrl(\n            self.authDomain_,\n            self.apiKey_,\n            self.appName_,\n            mode,\n            provider,\n            null,\n            opt_eventId,\n            self.clientVersion_,\n            undefined,\n            self.endpointId_,\n            opt_tenantId);\n    // Redirect popup to OAuth helper widget URL.\n    fireauth.util.goTo(oauthHelperWidgetUrl, /** @type {!Window} */ (popupWin));\n  }).thenCatch(function(e) {\n    // Force another origin validation.\n    if (e.code == 'auth/network-request-failed') {\n      self.originValidator_ = null;\n    }\n    throw e;\n  });\n};\n\n\n/**\n * @return {!fireauth.RpcHandler} The RPC handler instance with the relevant\n *     endpoints, version and frameworks.\n * @private\n */\nfireauth.iframeclient.IfcHandler.prototype.getRpcHandler_ = function() {\n  if (!this.rpcHandler_) {\n    this.fullClientVersion_ = this.clientVersion_ ?\n        fireauth.util.getClientVersion(\n            fireauth.util.ClientImplementation.JSCORE,\n            this.clientVersion_,\n            fireauth.iframeclient.OAuthUrlBuilder.getAuthFrameworksForApp_(\n                this.appName_)) :\n        null;\n    this.rpcHandler_ = new fireauth.RpcHandler(\n        this.apiKey_,\n        // Get the client Auth endpoint used.\n        fireauth.constants.getEndpointConfig(this.endpointId_),\n        this.fullClientVersion_);\n  }\n  return this.rpcHandler_;\n};\n\n\n/**\n * Processes the redirect request.\n * @param {!fireauth.AuthEvent.Type} mode The Auth event type.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @param {?string=} opt_eventId The optional event ID.\n * @param {?string=} opt_tenantId The optional tenant ID.\n * @return {!goog.Promise}\n * @override\n */\nfireauth.iframeclient.IfcHandler.prototype.processRedirect =\n    function(mode, provider, opt_eventId, opt_tenantId) {\n  // If origin validator not determined yet.\n  if (!this.originValidator_) {\n    this.originValidator_ =\n        fireauth.iframeclient.IfcHandler.getOriginValidator_(\n            this.getRpcHandler_());\n  }\n  var self = this;\n  // Make sure origin is validated.\n  return this.originValidator_.then(function() {\n    fireauth.AuthProvider.checkIfOAuthSupported(provider);\n    var oauthHelperWidgetUrl =\n        fireauth.iframeclient.IfcHandler.getOAuthHelperWidgetUrl(\n            self.authDomain_,\n            self.apiKey_,\n            self.appName_,\n            mode,\n            provider,\n            fireauth.util.getCurrentUrl(),\n            opt_eventId,\n            self.clientVersion_,\n            undefined,\n            self.endpointId_,\n            opt_tenantId);\n    // Redirect to OAuth helper widget URL.\n    fireauth.util.goTo(oauthHelperWidgetUrl);\n  }).thenCatch(function(e) {\n    // Force another origin validation on network errors.\n    if (e.code == 'auth/network-request-failed') {\n      self.originValidator_ = null;\n    }\n    throw e;\n  });\n};\n\n\n/** @return {string} The iframe URL. */\nfireauth.iframeclient.IfcHandler.prototype.getIframeUrl = function() {\n  if (!this.iframeUrl_) {\n    this.iframeUrl_ = fireauth.iframeclient.IfcHandler.getAuthIframeUrl(\n        this.authDomain_, this.apiKey_, this.appName_, this.clientVersion_,\n        this.endpointId_,\n        fireauth.iframeclient.OAuthUrlBuilder.getAuthFrameworksForApp_(\n            this.appName_));\n  }\n  return this.iframeUrl_;\n};\n\n\n/**\n * @return {!goog.Promise} The promise that resolves when the iframe is ready.\n * @override\n */\nfireauth.iframeclient.IfcHandler.prototype.initializeAndWait = function() {\n  // Initialize if not initialized yet.\n  var self = this;\n  return this.initialize().then(function() {\n    return self.iframeWrapper_.onReady();\n  }).thenCatch(function(error) {\n    // Reset origin validator.\n    self.originValidator_ = null;\n    // Reject iframe ready promise with network error.\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.NETWORK_REQUEST_FAILED);\n  });\n};\n\n\n/**\n * @return {boolean} Whether the handler will unload the current page on\n *     redirect operations.\n * @override\n */\nfireauth.iframeclient.IfcHandler.prototype.unloadsOnRedirect = function() {\n  return true;\n};\n\n\n/**\n * @param {string} authDomain The Firebase authDomain used to determine the\n *     OAuth helper page domain.\n * @param {string} apiKey The API key for sending backend Auth requests.\n * @param {string} appName The App ID for the Auth instance that triggered this\n *     request.\n * @param {?string=} opt_clientVersion The optional client version string.\n * @param {?string=} opt_endpointId The endpoint ID (staging, test Gaia, etc).\n * @param {?Array<string>=} opt_frameworks The optional list of framework IDs.\n * @return {string} The data iframe src URL.\n */\nfireauth.iframeclient.IfcHandler.getAuthIframeUrl = function(authDomain, apiKey,\n    appName, opt_clientVersion, opt_endpointId, opt_frameworks) {\n  // OAuth helper iframe URL.\n  var builder = new fireauth.iframeclient.IframeUrlBuilder(\n      authDomain, apiKey, appName);\n  return builder\n      .setVersion(opt_clientVersion)\n      .setEndpointId(opt_endpointId)\n      .setFrameworks(opt_frameworks)\n      .toString();\n};\n\n\n/**\n * @param {string} authDomain The Firebase authDomain used to determine the\n *     OAuth helper page domain.\n * @param {string} apiKey The API key for sending backend Auth requests.\n * @param {string} appName The App ID for the Auth instance that triggered this\n *     request.\n * @param {string} authType The type of operation that depends on OAuth sign in.\n * @param {!fireauth.AuthProvider} provider The provider to sign in to.\n * @param {?string=} opt_redirectUrl The optional URL to redirect to on OAuth\n *     sign in completion.\n * @param {?string=} opt_eventId The optional event ID to identify on receipt.\n * @param {?string=} opt_clientVersion The optional client version string.\n * @param {?Object<string, string>=} opt_additionalParams The optional\n *     additional parameters.\n * @param {?string=} opt_endpointId The endpoint ID (staging, test Gaia, etc).\n * @param {?string=} opt_tenantId The optional tenant ID.\n * @return {string} The OAuth helper widget URL.\n */\nfireauth.iframeclient.IfcHandler.getOAuthHelperWidgetUrl = function(\n    authDomain,\n    apiKey,\n    appName,\n    authType,\n    provider,\n    opt_redirectUrl,\n    opt_eventId,\n    opt_clientVersion,\n    opt_additionalParams,\n    opt_endpointId,\n    opt_tenantId) {\n  // OAuth helper widget URL.\n  var builder = new fireauth.iframeclient.OAuthUrlBuilder(\n      authDomain, apiKey, appName, authType, provider);\n  return builder\n      .setRedirectUrl(opt_redirectUrl)\n      .setEventId(opt_eventId)\n      .setVersion(opt_clientVersion)\n      .setAdditionalParameters(opt_additionalParams)\n      .setEndpointId(opt_endpointId)\n      .setTenantId(opt_tenantId)\n      .toString();\n};\n\n\n/**\n * Post message receiver event names.\n * @enum {string}\n */\nfireauth.iframeclient.IfcHandler.ReceiverEvent = {\n  AUTH_EVENT: 'authEvent'\n};\n\n\n/**\n * Post message sender event names.\n * @enum {string}\n */\nfireauth.iframeclient.IfcHandler.SenderEvent = {\n  WEB_STORAGE_SUPPORT_EVENT: 'webStorageSupport'\n};\n\n\n/**\n * Post message response field names.\n * @enum {string}\n */\nfireauth.iframeclient.IfcHandler.Response = {\n  STATUS: 'status',\n  AUTH_EVENT: 'authEvent',\n  WEB_STORAGE_SUPPORT: 'webStorageSupport'\n};\n\n\n/**\n * Post message status values.\n * @enum {string}\n */\nfireauth.iframeclient.IfcHandler.Status = {\n  ACK: 'ACK',\n  ERROR: 'ERROR'\n};\n\n\n/**\n * Registers all event listeners.\n * @private\n */\nfireauth.iframeclient.IfcHandler.prototype.registerEvents_ = function() {\n  // Should be run in initialization.\n  if (!this.iframeWrapper_) {\n    throw new Error('IfcHandler must be initialized!');\n  }\n  var self = this;\n  // Listen to Auth change events emitted from iframe.\n  this.iframeWrapper_.registerEvent(\n      fireauth.iframeclient.IfcHandler.ReceiverEvent.AUTH_EVENT,\n      function(response) {\n        var resolveResponse = {};\n        if (response &&\n            response[fireauth.iframeclient.IfcHandler.Response.AUTH_EVENT]) {\n          var isHandled = false;\n          // Get Auth event (plain object).\n          var authEvent = fireauth.AuthEvent.fromPlainObject(\n              response[fireauth.iframeclient.IfcHandler.Response.AUTH_EVENT]);\n          // Trigger Auth change on all listeners.\n          for (var i = 0; i < self.authEventListeners_.length; i++) {\n            isHandled = self.authEventListeners_[i](authEvent) || isHandled;\n          }\n          // Return ack response to notify sender of success.\n          resolveResponse = {};\n          resolveResponse[fireauth.iframeclient.IfcHandler.Response.STATUS] =\n              isHandled ? fireauth.iframeclient.IfcHandler.Status.ACK :\n                  fireauth.iframeclient.IfcHandler.Status.ERROR;\n          return goog.Promise.resolve(resolveResponse);\n        }\n        // Return error status if the response is invalid.\n        resolveResponse[fireauth.iframeclient.IfcHandler.Response.STATUS] =\n            fireauth.iframeclient.IfcHandler.Status.ERROR;\n        return goog.Promise.resolve(resolveResponse);\n      });\n};\n\n\n/**\n * @return {!goog.Promise<boolean>} Whether web storage is supported in the\n *     iframe.\n */\nfireauth.iframeclient.IfcHandler.prototype.isWebStorageSupported = function() {\n  var webStorageSupportEvent =\n      fireauth.iframeclient.IfcHandler.SenderEvent.WEB_STORAGE_SUPPORT_EVENT;\n  var message = {\n    'type': webStorageSupportEvent\n  };\n  var self = this;\n  // Initialize if not initialized yet.\n  return this.initialize().then(function() {\n    return self.iframeWrapper_.sendMessage(message);\n  }).then(function(response) {\n    // Parse the response and return the passed web storage support status.\n    var key = fireauth.iframeclient.IfcHandler.Response.WEB_STORAGE_SUPPORT;\n    if (response &&\n        response.length &&\n        typeof response[0][key] !== 'undefined') {\n      return response[0][key];\n    }\n    // Internal error.\n    throw new Error;\n  });\n};\n\n\n/**\n * @param {!function(?fireauth.AuthEvent):boolean} listener The Auth event\n *     listener to add.\n * @override\n */\nfireauth.iframeclient.IfcHandler.prototype.addAuthEventListener =\n    function(listener) {\n  this.authEventListeners_.push(listener);\n};\n\n\n/**\n * @param {!function(?fireauth.AuthEvent):boolean} listener The Auth event\n *     listener to remove.\n * @override\n */\nfireauth.iframeclient.IfcHandler.prototype.removeAuthEventListener =\n    function(listener) {\n  goog.array.removeAllIf(this.authEventListeners_, function(ele) {\n    return ele == listener;\n  });\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ngoog.provide('fireauth.storage.AsyncStorage');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.storage.Storage');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\n\n\n/**\n * AsyncStorage provides an interface to the React Native AsyncStorage API.\n * @param {!Object=} opt_asyncStorage The AsyncStorage API. If not provided\n *     this method will attempt to fetch an implementation from\n *     firebase.INTERNAL.reactNative.\n * @constructor\n * @implements {fireauth.storage.Storage}\n * @see https://facebook.github.io/react-native/docs/asyncstorage.html\n */\nfireauth.storage.AsyncStorage = function(opt_asyncStorage) {\n  /**\n   * The underlying storage instance for persistent data.\n   * @private\n   */\n  this.storage_ =\n      opt_asyncStorage || (firebase.INTERNAL['reactNative'] &&\n                           firebase.INTERNAL['reactNative']['AsyncStorage']);\n\n  if (!this.storage_) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR,\n        'The React Native compatibility library was not found.');\n  }\n  /** @public {string} The storage type identifier. */\n  this.type = fireauth.storage.Storage.Type.ASYNC_STORAGE;\n};\n\n\n/**\n * Retrieves the value stored at the key.\n * @param {string} key\n * @return {!goog.Promise<*>}\n * @override\n */\nfireauth.storage.AsyncStorage.prototype.get = function(key) {\n  return goog.Promise.resolve(this.storage_['getItem'](key))\n      .then(function(val) {\n        return val && fireauth.util.parseJSON(val);\n      });\n};\n\n\n/**\n * Stores the value at the specified key.\n * @param {string} key\n * @param {*} value\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.AsyncStorage.prototype.set = function(key, value) {\n  return goog.Promise.resolve(\n      this.storage_['setItem'](key, fireauth.util.stringifyJSON(value)));\n};\n\n\n/**\n * Removes the value at the specified key.\n * @param {string} key\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.AsyncStorage.prototype.remove = function(key) {\n  return goog.Promise.resolve(this.storage_['removeItem'](key));\n};\n\n\n/**\n * Does nothing. AsyncStorage does not support storage events,\n * @param {function(!goog.events.BrowserEvent)} listener The storage event\n *     listener.\n * @override\n */\nfireauth.storage.AsyncStorage.prototype.addStorageListener = function(\n    listener) {};\n\n\n/**\n * Does nothing. AsyncStorage does not support storage events,\n * @param {function(!goog.events.BrowserEvent)} listener The storage event\n *     listener.\n * @override\n */\nfireauth.storage.AsyncStorage.prototype.removeStorageListener = function(\n    listener) {};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the MessageChannel based wrapper for receiving\n * messages from other windows or workers.\n */\n\ngoog.provide('fireauth.messagechannel.Receiver');\n\ngoog.require('fireauth.messagechannel.Status');\ngoog.require('goog.Promise');\ngoog.require('goog.array');\ngoog.require('goog.object');\n\n\n/**\n * Initializes a channel to receive specific messages from a specified event\n * target.\n * Note receivers should not be manually instantiated. Instead `getInstance()`\n * should be used instead to get a receiver instance for a specified event\n * target.\n * @param {!EventTarget} eventTarget The event target to listen to.\n * @constructor\n */\nfireauth.messagechannel.Receiver = function(eventTarget) {\n  /**\n   * @const @private {!EventTarget} The messageChannel event target.\n   */\n  this.eventTarget_ = eventTarget;\n  /**\n   * @const @private {!Object.<string,\n   *                    !Array<function(string, *):!goog.Promise<?>|void>>}\n   *     This is the event type to handlers hash map. It is used to hold the\n   *     corresponding handlers for specified events.\n   */\n  this.eventHandlers_ = {};\n  /**\n   * @const @private {function(!Event)} The internal 'message' event handler\n   *     used to reroute the request to corresponding subscribed handlers.\n   */\n  this.messageEventHandler_ = goog.bind(this.handleEvent_, this);\n};\n\n\n/**\n * @param {!EventTarget} eventTarget The event target to check for.\n * @return {boolean} Whether the receiver is listening to the specified event\n *     target.\n */\nfireauth.messagechannel.Receiver.prototype.isListeningTo =\n    function(eventTarget) {\n  return this.eventTarget_ == eventTarget;\n};\n\n\n/**\n * @const @private {!Array<!fireauth.messagechannel.Receiver>} The list of all\n *     created `fireauth.messagechannel.Receiver` instances.\n */\nfireauth.messagechannel.Receiver.receivers_ = [];\n\n\n/**\n * Return a receiver instance for the specified event target. This is needed\n * since one instance can be available per event target. Otherwise receivers\n * could clobber each other.\n * @param {!EventTarget} eventTarget The event target to listen to.\n * @return {!fireauth.messagechannel.Receiver} The receiver instance for the\n *     specified event target.\n */\nfireauth.messagechannel.Receiver.getInstance = function(eventTarget) {\n  // The results are stored in an array since objects can't be keys for other\n  // objects. In addition, setting a unique property on an event target as a\n  // hash map key may not be allowed due to CORS restrictions.\n  var instance;\n  goog.array.forEach(\n      fireauth.messagechannel.Receiver.receivers_,\n      function(receiver) {\n        if (receiver.isListeningTo(eventTarget)) {\n          instance = receiver;\n        }\n      });\n  if (!instance) {\n    instance = new fireauth.messagechannel.Receiver(eventTarget);\n    fireauth.messagechannel.Receiver.receivers_.push(instance);\n  }\n  return instance;\n};\n\n\n/**\n * Handles a PostMessage event based on the following protocol:\n * <ul>\n * <li>When an event is first detected, check there is a subscribed handler.\n *     If not, do nothing as there could be other listeners.</li>\n * <li>If there is a subscribed event, reply with an ACK event to notify the\n *     sender that the event can be handled.</li>\n * <li>Trigger the subscribed handlers.</li>\n * <li>Reply again with the combined results of all subscribed handlers and\n *     return the response back.</li>\n * </ul>\n *\n * @param {!Event} event The PostMessage event to handle.\n * @private\n */\nfireauth.messagechannel.Receiver.prototype.handleEvent_ = function(event) {\n  // Respond to sender first with ack reply. This will let the client\n  // know that the service worker can handle this event.\n  var eventType = event.data['eventType'];\n  var eventId = event.data['eventId'];\n  var handlers = this.eventHandlers_[eventType];\n  if (handlers && handlers.length > 0) {\n    // Event can be handled.\n    event.ports[0].postMessage({\n      'status': fireauth.messagechannel.Status.ACK,\n      'eventId': eventId,\n      'eventType': eventType,\n      'response': null\n    });\n    var promises = [];\n    goog.array.forEach(handlers, function(handler) {\n      // Wrap in promise in case the handler doesn't return a promise.\n      promises.push(goog.Promise.resolve().then(function() {\n        return handler(event.origin, event.data['data']);\n      }));\n    });\n    // allSettled is more flexible as it executes all the promises passed and\n    // returns whether they succeeded or failed.\n    goog.Promise.allSettled(promises)\n        .then(function(result) {\n          // allResponse has the format:\n          // !Array<!{fulfilled: boolean, value: (*|undefined),\n          //          reason: (*|undefined)}>\n          // Respond to sender with ack reply.\n          // De-obfuscate the allSettled result.\n          var allResponses = [];\n          goog.array.forEach(result, function(item) {\n            allResponses.push({\n              'fulfilled': item.fulfilled,\n              'value': item.value,\n              // Error cannot be clone in postMessage.\n              'reason': item.reason ? item.reason.message : undefined\n            });\n          });\n          // Remove undefined fields.\n          goog.array.forEach(allResponses, function(item) {\n            for (var key in item) {\n              if (typeof item[key] === 'undefined') {\n                delete item[key];\n              }\n            }\n          });\n          event.ports[0].postMessage({\n            'status': fireauth.messagechannel.Status.DONE,\n            'eventId': eventId,\n            'eventType': eventType,\n            'response': allResponses\n          });\n        });\n  }\n  // Let unsupported events time out, as there could be external receivers\n  // that can handle them.\n};\n\n\n/**\n * Subscribes to events of the specified type.\n * @param {string} eventType The event type to listen to.\n * @param {function(string, *):!goog.Promise<?>|void} handler The async callback\n *     function to run when the event is triggered.\n */\nfireauth.messagechannel.Receiver.prototype.subscribe =\n    function(eventType, handler) {\n  if (goog.object.isEmpty(this.eventHandlers_)) {\n    this.eventTarget_.addEventListener('message', this.messageEventHandler_);\n  }\n  if (typeof this.eventHandlers_[eventType] === 'undefined') {\n    this.eventHandlers_[eventType] = [];\n  }\n  this.eventHandlers_[eventType].push(handler);\n};\n\n\n/**\n * Unsubscribes the specified handler from the specified event. If no handler\n * is specified, all handlers are unsubscribed.\n * @param {string} eventType The event type to unsubscribe from.\n * @param {?function(string, *):!goog.Promise<?>|void=} opt_handler The\n *     callback function to unsubscribe from the specified event type. If none\n *     is specified, all handlers are unsubscribed.\n */\nfireauth.messagechannel.Receiver.prototype.unsubscribe =\n    function(eventType, opt_handler) {\n  if (typeof this.eventHandlers_[eventType] !== 'undefined' && opt_handler) {\n    goog.array.removeAllIf(this.eventHandlers_[eventType], function(ele) {\n      return ele == opt_handler;\n    });\n    if (this.eventHandlers_[eventType].length == 0) {\n      delete this.eventHandlers_[eventType];\n    }\n  } else if (!opt_handler) {\n    // Unsubscribe all handlers for speficied event.\n    delete this.eventHandlers_[eventType];\n  }\n  if (goog.object.isEmpty(this.eventHandlers_)) {\n    this.eventTarget_.removeEventListener('message', this.messageEventHandler_);\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines a local storage interface with an indexedDB\n * implementation to be used as a fallback with browsers that do not synchronize\n * local storage changes between different windows of the same origin.\n */\n\ngoog.provide('fireauth.storage.IndexedDB');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.messagechannel.Receiver');\ngoog.require('fireauth.messagechannel.Sender');\ngoog.require('fireauth.messagechannel.WorkerClientPostMessager');\ngoog.require('fireauth.storage.Storage');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.Timer');\ngoog.require('goog.array');\n\n\n\n/**\n * Initialize an indexedDB local storage manager used to mimic local storage\n * using an indexedDB underlying implementation including the ability to listen\n * to storage changes by key similar to localstorage storage event.\n * @param {string} dbName The indexedDB database name where all local storage\n *     data is to be stored.\n * @param {string} objectStoreName The indexedDB object store name where all\n *     local storage data is to be stored.\n * @param {string} dataKeyPath The indexedDB object store index name used to key\n *     all local storage data.\n * @param {string} valueKeyPath The indexedDB object store value field for each\n *     entry.\n * @param {number} version The indexedDB database version number.\n * @param {?IDBFactory=} opt_indexedDB The optional IndexedDB factory object.\n * @implements {fireauth.storage.Storage}\n * @constructor\n */\nfireauth.storage.IndexedDB = function(\n    dbName,\n    objectStoreName,\n    dataKeyPath,\n    valueKeyPath,\n    version,\n    opt_indexedDB) {\n  // indexedDB not available, fail hard.\n  if (!fireauth.storage.IndexedDB.isAvailable()) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.WEB_STORAGE_UNSUPPORTED);\n  }\n  /**\n   * @const @private {string} The indexedDB database name where all local\n   *     storage data is to be stored.\n   */\n  this.dbName_ = dbName;\n  /**\n   * @const @private {string} The indexedDB object store name where all local\n   *     storage data is to be stored.\n   */\n  this.objectStoreName_ = objectStoreName;\n  /**\n   * @const @private {string} The indexedDB object store index name used to key\n   *     all local storage data.\n   */\n  this.dataKeyPath_ = dataKeyPath;\n  /**\n   * @const @private {string} The indexedDB object store value field for each\n   *     entry.\n   */\n  this.valueKeyPath_ = valueKeyPath;\n  /** @const @private {number} The indexedDB database version number. */\n  this.version_ = version;\n  /** @private {!Object.<string, *>} The local indexedDB map copy. */\n  this.localMap_ = {};\n  /**\n   * @private {!Array<function(!Array<string>)>} Listeners to storage events.\n   */\n  this.storageListeners_ = [];\n  /** @private {number} The indexedDB pending write operations tracker. */\n  this.pendingOpsTracker_ = 0;\n  /** @private {!IDBFactory} The indexedDB factory object. */\n  this.indexedDB_ = /** @type {!IDBFactory} */ (\n      opt_indexedDB || goog.global.indexedDB);\n  /** @public {string} The storage type identifier. */\n  this.type = fireauth.storage.Storage.Type.INDEXEDDB;\n  /**\n   * @private {?goog.Promise<void>} The pending polling promise for syncing\n   *     unprocessed indexedDB external changes.\n   */\n  this.poll_ = null;\n  /**\n   * @private {?number} The poll timer ID for syncing external indexedDB\n   *     changes.\n   */\n  this.pollTimerId_ = null;\n  /**\n   * @private {?fireauth.messagechannel.Receiver} The messageChannel receiver if\n   *     running from a serviceworker.\n   */\n  this.receiver_ = null;\n  /**\n   * @private {?fireauth.messagechannel.Sender} The messageChannel sender to\n   *     send keyChanged messages to the service worker from the client.\n   */\n  this.sender_ = null;\n  /**\n   * @private {boolean} Whether the service worker has a receiver for the\n   *     keyChanged events.\n   */\n  this.serviceWorkerReceiverAvailable_ = false;\n  /** @private {?ServiceWorker} The current active service worker. */\n  this.activeServiceWorker_ = null;\n  var scope = this;\n  if (fireauth.util.getWorkerGlobalScope()) {\n    this.receiver_ = fireauth.messagechannel.Receiver.getInstance(\n        /** @type {!WorkerGlobalScope} */ (\n            fireauth.util.getWorkerGlobalScope()));\n    // Listen to indexedDB changes.\n    this.receiver_.subscribe('keyChanged', function(origin, request) {\n      // Sync data.\n      return scope.sync_().then(function(keys) {\n        // Trigger listeners if unhandled changes are detected.\n        if (keys.length > 0) {\n          goog.array.forEach(\n              scope.storageListeners_,\n              function(listener) {\n                listener(keys);\n              });\n        }\n        // When this is false, it means the change was already\n        // detected and processed before the notification.\n        return {\n          'keyProcessed': goog.array.contains(keys, request['key'])\n        };\n      });\n    });\n    // Used to inform sender that service worker what events it supports.\n    this.receiver_.subscribe('ping', function(origin, request) {\n      return goog.Promise.resolve(['keyChanged']);\n    });\n  } else {\n    // Get active service worker when its available.\n    fireauth.util.getActiveServiceWorker()\n        .then(function(sw) {\n          scope.activeServiceWorker_ = sw;\n          if (sw) {\n            // Initialize the sender.\n            scope.sender_ = new fireauth.messagechannel.Sender(\n                new fireauth.messagechannel.WorkerClientPostMessager(sw));\n            // Ping the service worker to check what events they can handle.\n            // Use long timeout.\n            scope.sender_.send('ping', null, true)\n                .then(function(results) {\n                  // Check if keyChanged is supported.\n                  if (results[0]['fulfilled'] &&\n                      goog.array.contains(results[0]['value'], 'keyChanged')) {\n                    scope.serviceWorkerReceiverAvailable_ = true;\n                  }\n                })\n                .thenCatch(function(error) {\n                  // Ignore error.\n                });\n          }\n        });\n  }\n};\n\n\n\n/**\n * The indexedDB database name where all local storage data is to be stored.\n * @private @const {string}\n */\nfireauth.storage.IndexedDB.DB_NAME_ = 'firebaseLocalStorageDb';\n\n\n/**\n * The indexedDB object store name where all local storage data is to be stored.\n * @private @const {string}\n */\nfireauth.storage.IndexedDB.DATA_OBJECT_STORE_NAME_ = 'firebaseLocalStorage';\n\n\n/**\n * The indexedDB object store index name used to key all local storage data.\n * @private @const {string}\n */\nfireauth.storage.IndexedDB.DATA_KEY_PATH_ = 'fbase_key';\n\n\n/**\n * The indexedDB object store value field for each entry.\n * @private @const {string}\n */\nfireauth.storage.IndexedDB.VALUE_KEY_PATH_ = 'value';\n\n\n/**\n * The indexedDB database version number.\n * @private @const {number}\n */\nfireauth.storage.IndexedDB.VERSION_ = 1;\n\n\n/**\n * The indexedDB polling delay time in milliseconds.\n * @private @const {number}\n */\nfireauth.storage.IndexedDB.POLLING_DELAY_ = 800;\n\n\n/**\n * The indexedDB polling stop error.\n * @private @const {string}\n */\nfireauth.storage.IndexedDB.STOP_ERROR_ = 'STOP_EVENT';\n\n\n\n/**\n * @return {!fireauth.storage.IndexedDB} The Firebase Auth indexedDB\n *     local storage manager.\n */\nfireauth.storage.IndexedDB.getFireauthManager = function() {\n  if (!fireauth.storage.IndexedDB.managerInstance_) {\n    fireauth.storage.IndexedDB.managerInstance_ =\n        new fireauth.storage.IndexedDB(\n            fireauth.storage.IndexedDB.DB_NAME_,\n            fireauth.storage.IndexedDB.DATA_OBJECT_STORE_NAME_,\n            fireauth.storage.IndexedDB.DATA_KEY_PATH_,\n            fireauth.storage.IndexedDB.VALUE_KEY_PATH_,\n            fireauth.storage.IndexedDB.VERSION_);\n  }\n  return fireauth.storage.IndexedDB.managerInstance_;\n};\n\n\n/**\n * Delete the indexedDB database.\n * @return {!goog.Promise<!IDBDatabase>} A promise that resolves on successful\n *     database deletion.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.deleteDb_ = function() {\n  var self = this;\n  return new goog.Promise(function(resolve, reject) {\n    var request = self.indexedDB_.deleteDatabase(self.dbName_);\n    request.onsuccess = function(event) {\n      resolve();\n    };\n    request.onerror = function(event) {\n      reject(new Error(event.target.error));\n    };\n  });\n};\n\n\n/**\n * Initializes The indexedDB database, creates it if not already created and\n * opens it.\n * @return {!goog.Promise<!IDBDatabase>} A promise for the database object.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.initializeDb_ = function() {\n  var self = this;\n  return new goog.Promise(function(resolve, reject) {\n    var request = self.indexedDB_.open(self.dbName_, self.version_);\n    request.onerror = function(event) {\n      // Suppress this from surfacing to browser console.\n      try {\n        event.preventDefault();\n      } catch (e) {}\n      reject(new Error(event.target.error));\n    };\n    request.onupgradeneeded = function(event) {\n      var db = event.target.result;\n      try {\n        db.createObjectStore(\n            self.objectStoreName_,\n            {\n              'keyPath': self.dataKeyPath_\n            });\n      } catch (e) {\n        reject(e);\n      }\n    };\n    request.onsuccess = function(event) {\n      var db = event.target.result;\n      // Strange bug that occurs in Firefox when multiple tabs are opened at the\n      // same time. The only way to recover seems to be deleting the database\n      // and re-initializing it.\n      // https://github.com/firebase/firebase-js-sdk/issues/634\n      if (!db.objectStoreNames.contains(self.objectStoreName_)) {\n        self.deleteDb_()\n            .then(function() {\n              return self.initializeDb_();\n            })\n            .then(function(newDb) {\n              resolve(newDb);\n            })\n            .thenCatch(function(e) {\n              reject(e);\n            });\n      } else {\n        resolve(db);\n      }\n    };\n  });\n};\n\n\n/**\n * Checks if indexedDB is initialized, if so, the callback is run, otherwise,\n * it waits for the db to initialize and then runs the callback function.\n * @return {!goog.Promise<!IDBDatabase>} A promise for the initialized indexedDB\n *     database.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.initializeDbAndRun_ =\n    function() {\n  if (!this.initPromise_) {\n    this.initPromise_ = this.initializeDb_();\n  }\n  return this.initPromise_;\n};\n\n\n/**\n * @return {boolean} Whether indexedDB is available or not.\n */\nfireauth.storage.IndexedDB.isAvailable = function() {\n  try {\n    return !!goog.global['indexedDB'];\n  } catch (e) {\n    return false;\n  }\n};\n\n\n/**\n * Creates a reference for the local storage indexedDB object store and returns\n * it.\n * @param {!IDBTransaction} tx The IDB transaction instance.\n * @return {!IDBObjectStore} The indexedDB object store.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.getDataObjectStore_ =\n    function(tx) {\n  return tx.objectStore(this.objectStoreName_);\n};\n\n\n/**\n * Creates an IDB transaction and returns it.\n * @param {!IDBDatabase} db The indexedDB instance.\n * @param {boolean} isReadWrite Whether the current indexedDB operation is a\n *     read/write operation or not.\n * @return {!IDBTransaction} The requested IDB transaction instance.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.getTransaction_ =\n    function(db, isReadWrite) {\n  var tx = db.transaction(\n      [this.objectStoreName_],\n      isReadWrite ? 'readwrite' : 'readonly');\n  return tx;\n};\n\n\n/**\n * @param {!IDBRequest} request The IDB request instance.\n * @return {!goog.Promise} The promise to resolve on transaction completion.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.onIDBRequest_ =\n    function(request) {\n  return new goog.Promise(function(resolve, reject) {\n    request.onsuccess = function(event) {\n      if (event && event.target) {\n        resolve(event.target.result);\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function(event) {\n      reject(event.target.error);\n    };\n  });\n};\n\n\n/**\n * Sets the item's identified by the key provided to the value passed. If the\n * item does not exist, it is created. An optional callback is run on success.\n * @param {string} key The storage key for the item to set. If the item exists,\n *     it is updated, otherwise created.\n * @param {*} value The value to store for the item to set.\n * @return {!goog.Promise<void>} A promise that resolves on operation success.\n * @override\n */\nfireauth.storage.IndexedDB.prototype.set = function(key, value) {\n  var isLocked = false;\n  var dbTemp;\n  var self = this;\n  return this.initializeDbAndRun_()\n      .then(function(db) {\n        dbTemp = db;\n        var objectStore = self.getDataObjectStore_(\n            self.getTransaction_(dbTemp, true));\n        return self.onIDBRequest_(objectStore.get(key));\n      })\n      .then(function(data) {\n        var objectStore = self.getDataObjectStore_(\n            self.getTransaction_(dbTemp, true));\n        if (data) {\n          // Update the value(s) in the object that you want to change\n          data.value = value;\n          // Put this updated object back into the database.\n          return self.onIDBRequest_(objectStore.put(data));\n        }\n        self.pendingOpsTracker_++;\n        isLocked = true;\n        var obj = {};\n        obj[self.dataKeyPath_] = key;\n        obj[self.valueKeyPath_] = value;\n        return self.onIDBRequest_(objectStore.add(obj));\n      })\n      .then(function() {\n        // Save in local copy to avoid triggering false external event.\n        self.localMap_[key] = value;\n        // Announce change in key to service worker.\n        return self.notifySW_(key);\n      })\n      .thenAlways(function() {\n        if (isLocked) {\n          self.pendingOpsTracker_--;\n        }\n      });\n};\n\n\n/**\n * Notify the service worker of the indexeDB write operation.\n * Waits until the operation is processed.\n * @param {string} key The key which is changing.\n * @return {!goog.Promise<void>} A promise that resolves on delivery.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.notifySW_ = function(key) {\n  // If sender is available.\n  // Run some sanity check to confirm no sw change occurred.\n  // For now, we support one service worker per page.\n  if (this.sender_ &&\n      this.activeServiceWorker_ &&\n      fireauth.util.getServiceWorkerController() ===\n      this.activeServiceWorker_) {\n    return this.sender_.send(\n        'keyChanged',\n        {'key': key},\n        // Use long timeout if receiver is known to be available.\n        this.serviceWorkerReceiverAvailable_)\n        .then(function(responses) {\n          // Return nothing.\n        })\n        .thenCatch(function(error) {\n          // This is a best effort approach. Ignore errors.\n        });\n  }\n  return goog.Promise.resolve();\n};\n\n\n/**\n * Retrieves a stored item identified by the key provided asynchronously.\n * The value is passed to the callback function provided.\n * @param {string} key The storage key for the item to fetch.\n * @return {!goog.Promise} A promise that resolves with the item's value, or\n *     null if the item is not found.\n * @override\n */\nfireauth.storage.IndexedDB.prototype.get = function(key) {\n  var self = this;\n  return this.initializeDbAndRun_()\n      .then(function(db) {\n        return self.onIDBRequest_(\n            self.getDataObjectStore_(self.getTransaction_(db, false)).get(key));\n      })\n      .then(function(response) {\n        return response && response.value;\n      });\n};\n\n\n/**\n * Deletes the item identified by the key provided and on success, runs the\n * optional callback.\n * @param {string} key The storage key for the item to remove.\n * @return {!goog.Promise<void>} A promise that resolves on operation success.\n * @override\n */\nfireauth.storage.IndexedDB.prototype.remove = function(key) {\n  var isLocked = false;\n  var self = this;\n  return this.initializeDbAndRun_()\n      .then(function(db) {\n        isLocked = true;\n        self.pendingOpsTracker_++;\n        return self.onIDBRequest_(\n            self.getDataObjectStore_(\n                self.getTransaction_(db, true))['delete'](key));\n      }).then(function() {\n        // Delete from local copy to avoid triggering false external event.\n        delete self.localMap_[key];\n        // Announce change in key to service worker.\n        return self.notifySW_(key);\n      }).thenAlways(function() {\n        if (isLocked) {\n          self.pendingOpsTracker_--;\n        }\n      });\n};\n\n\n/**\n * @return {!goog.Promise<!Array<string>>} A promise that resolved with all the\n *     storage keys that have changed.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.sync_ = function() {\n  var self = this;\n  return this.initializeDbAndRun_()\n      .then(function(db) {\n        var objectStore =\n            self.getDataObjectStore_(self.getTransaction_(db, false));\n        if (objectStore['getAll']) {\n          // Get all keys and value pairs using getAll if supported.\n          return self.onIDBRequest_(objectStore['getAll']());\n        } else {\n          // If getAll isn't supported, fallback to cursor.\n          return new goog.Promise(function(resolve, reject) {\n            var res = [];\n            var request = objectStore.openCursor();\n            request.onsuccess = function(event) {\n              var cursor = event.target.result;\n              if (cursor) {\n                res.push(cursor.value);\n                cursor['continue']();\n              } else {\n                resolve(res);\n              }\n            };\n            request.onerror = function(event) {\n              reject(event.target.error);\n            };\n          });\n        }\n      }).then(function(res) {\n        var centralCopy = {};\n        // List of keys differing from central copy.\n        var diffKeys = [];\n        // Build central copy (external copy).\n        if (self.pendingOpsTracker_ == 0) {\n          for (var i = 0; i < res.length; i++) {\n            centralCopy[res[i][self.dataKeyPath_]] =\n                res[i][self.valueKeyPath_];\n          }\n          // Get diff of central copy and local copy.\n          diffKeys = fireauth.util.getKeyDiff(self.localMap_, centralCopy);\n          // Update local copy.\n          self.localMap_ = centralCopy;\n        }\n        // Return modified keys.\n        return diffKeys;\n      });\n};\n\n\n/**\n * Adds a listener to storage event change.\n * @param {function(!Array<string>)} listener The storage event listener.\n * @override\n */\nfireauth.storage.IndexedDB.prototype.addStorageListener =\n    function(listener) {\n  // First listener, start listeners.\n  if (this.storageListeners_.length == 0) {\n    this.startListeners_();\n  }\n  this.storageListeners_.push(listener);\n};\n\n\n/**\n * Removes a listener to storage event change.\n * @param {function(!Array<string>)} listener The storage event listener.\n * @override\n */\nfireauth.storage.IndexedDB.prototype.removeStorageListener =\n    function(listener) {\n  goog.array.removeAllIf(\n      this.storageListeners_,\n      function(ele) {\n        return ele == listener;\n      });\n  // No more listeners, stop.\n  if (this.storageListeners_.length == 0) {\n    this.stopListeners_();\n  }\n};\n\n\n/**\n * Removes all listeners to storage event change.\n */\nfireauth.storage.IndexedDB.prototype.removeAllStorageListeners =\n    function() {\n  this.storageListeners_ = [];\n  // No more listeners, stop.\n  this.stopListeners_();\n};\n\n\n/**\n * Starts the listener to storage events.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.startListeners_ = function() {\n  var self = this;\n  // Stop any previous listeners.\n  this.stopListeners_();\n  var repeat = function() {\n    self.pollTimerId_ = setTimeout(\n        function() {\n          self.poll_ = self.sync_()\n              .then(function(keys) {\n                // If keys modified, call listeners.\n                if (keys.length > 0) {\n                  goog.array.forEach(\n                      self.storageListeners_,\n                      function(listener) {\n                        listener(keys);\n                      });\n                }\n              })\n              .then(function() {\n                repeat();\n              })\n              .thenCatch(function(error) {\n                if (error.message != fireauth.storage.IndexedDB.STOP_ERROR_) {\n                  repeat();\n                }\n              });\n        },\n        fireauth.storage.IndexedDB.POLLING_DELAY_);\n  };\n  repeat();\n};\n\n\n/**\n * Stops the listener to storage events.\n * @private\n */\nfireauth.storage.IndexedDB.prototype.stopListeners_ = function() {\n  if (this.poll_) {\n    // Cancel polling function.\n    this.poll_.cancel(fireauth.storage.IndexedDB.STOP_ERROR_);\n  }\n  // Clear any pending polling timer.\n  if (this.pollTimerId_) {\n    clearTimeout(this.pollTimerId_);\n    this.pollTimerId_ = null;\n  }\n};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the PostMessager interface needed for the\n * `fireauth.messagechannel.Sender`, in addition to 2 types of implementations.\n */\n\ngoog.provide('fireauth.messagechannel.PostMessager');\ngoog.provide('fireauth.messagechannel.WindowPostMessager');\ngoog.provide('fireauth.messagechannel.WorkerClientPostMessager');\n\n\n/**\n * This is the interface defining the postMessage format of a window which\n * takes an additional second parameter for target origin.\n *\n * @typedef {{\n *   postMessage: function(*, string, !Array<!Transferable>)\n * }}\n */\nfireauth.messagechannel.Window;\n\n\n/**\n * This is the interface defining the postMessage format of a worker or\n * ServiceWorkerClient, etc. which just takes a message and a list of\n * Transferables.\n *\n * @typedef {{\n *   postMessage: function(*, !Array<!Transferable>)\n * }}\n */\nfireauth.messagechannel.WorkerClient;\n\n\n/**\n * Defines a common interface to postMessage data to a specified PostMessager.\n * @interface\n */\nfireauth.messagechannel.PostMessager = function() {};\n\n\n/**\n * Sends a message to the specified context.\n * @param {*} message The message to send.\n * @param {!Array<!Transferable>} transfer The list of `Transferable` objects\n *     that are transferred with the message. The ownsership fo these objects is\n *     given to the destination side and they are no longer usable on the\n *     sending side.\n */\nfireauth.messagechannel.PostMessager.prototype.postMessage =\n    function(message, transfer) {};\n\n\n\n/**\n * Defines the implementation for postMessaging to a window context.\n * @param {!fireauth.messagechannel.Window} win The window PostMessager.\n * @param {?string=} opt_targetOrigin The target origin.\n * @constructor\n * @implements {fireauth.messagechannel.PostMessager}\n */\nfireauth.messagechannel.WindowPostMessager = function(win, opt_targetOrigin) {\n  /**\n   * @const @private {!fireauth.messagechannel.Window} The window PostMessager.\n   */\n  this.win_ = win;\n  /** @const @private {string} The postMessage target origin. */\n  this.targetOrigin_ = opt_targetOrigin || '*';\n};\n\n\n/**\n * Sends a message to the specified window context.\n * @param {*} message The message to send.\n * @param {!Array<!Transferable>} transfer The list of `Transferable` objects\n *     that are transferred with the message. The ownsership fo these objects is\n *     given to the destination side and they are no longer usable on the\n *     sending side.\n * @override\n */\nfireauth.messagechannel.WindowPostMessager.prototype.postMessage =\n    function(message, transfer) {\n  this.win_.postMessage(message, this.targetOrigin_, transfer);\n};\n\n\n/**\n * Defines the implementation for postMessaging to a worker/client context.\n * @param {!fireauth.messagechannel.WorkerClient} worker The worker/client\n *     PostMessager.\n * @constructor\n * @implements {fireauth.messagechannel.PostMessager}\n */\nfireauth.messagechannel.WorkerClientPostMessager = function(worker) {\n  /**\n   * @const @private {!fireauth.messagechannel.WorkerClient} The worker/client\n   *     PostMessager.\n   */\n  this.worker_ = worker;\n};\n\n\n/**\n * Sends a message to the specified worker/client context.\n * @param {*} message The message to send.\n * @param {!Array<!Transferable>} transfer The list of `Transferable` objects\n *     that are transferred with the message. The ownsership fo these objects is\n *     given to the destination side and they are no longer usable on the\n *     sending side.\n * @override\n */\nfireauth.messagechannel.WorkerClientPostMessager.prototype.postMessage =\n    function(message, transfer) {\n  this.worker_.postMessage(message, transfer);\n};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the MessageChannel based wrapper for sending messages\n * to other windows or workers.\n */\n\ngoog.provide('fireauth.messagechannel.Sender');\n\ngoog.require('fireauth.messagechannel.Error');\ngoog.require('fireauth.messagechannel.PostMessager');\ngoog.require('fireauth.messagechannel.Status');\ngoog.require('fireauth.messagechannel.TimeoutDuration');\ngoog.require('fireauth.messagechannel.utils');\ngoog.require('goog.Promise');\ngoog.require('goog.array');\n\n\n/**\n * This is the interface defining a MessageChannel/handler pair.\n *\n * @typedef {{\n *   onMessage: function(!Event),\n *   messageChannel: !MessageChannel\n * }}\n */\nfireauth.messagechannel.MessageHandler;\n\n\n/**\n * Helper static function to create messageChannel errors.\n * @param {!fireauth.messagechannel.Error} errorId The error identifier.\n * @param {?string=} opt_message The optional error message used for generic\n *     error types.\n * @return {!Error} The constructed error to return.\n * @private\n */\nfireauth.messagechannel.createError_ = function(errorId, opt_message) {\n  if (errorId != fireauth.messagechannel.Error.UNKNOWN || !opt_message) {\n    return new Error(errorId);\n  } else {\n    return new Error(opt_message);\n  }\n};\n\n\n/**\n * Initializes a channel to send specific messages to a specified PostMessage.\n * @param {!fireauth.messagechannel.PostMessager} postMessager The post messager\n *     to send messages to.\n * @constructor\n */\nfireauth.messagechannel.Sender = function(postMessager) {\n  /**\n   * @const @private {!fireauth.messagechannel.PostMessager} The messageChannel\n   *     PostMessager.\n   */\n  this.postMessager_ = postMessager;\n  /** @private {boolean} Whether the connection was closed. */\n  this.closed_ = false;\n  /**\n   * @const @private {!Array<!fireauth.messagechannel.MessageHandler>} The list\n   *     of subscribed message handlers and their corresponding MessageChannels.\n   */\n  this.messageHandlers_ = [];\n};\n\n\n/**\n * Sends a message to the receiver. The message is identified by an event\n * type and can carry additional payload data.\n * The sender protocol works as follows:\n * <ul>\n * <li>The request is constructed and postMessaged to the receiver with the port\n *     used to reply back to sender.</li>\n * <li>The operation will block until an ACK response is received. If not, it\n *     will timeout and reject with an error.</li>\n * <li>If an ACK response is received, it will wait longer for the full\n *     processed response.</li>\n * <li>Once the response is received, the operation will resolve with that\n *     result.</li>\n * </ul>\n *\n * @param {string} eventType The event type identifying the message. This is\n *     used to help the receiver handle this message.\n * @param {?Object=} opt_data The optional data to send along the message.\n * @param {?boolean=} opt_useLongTimeout Whether long timeout should be used\n *     for ACK responses.\n * @return {!goog.Promise<!Array<{fulfilled: boolean,\n *                                value: (*|undefined),\n *                                reason: (*|undefined)}>>} A promise that\n *     resolves with the receiver responses.\n */\nfireauth.messagechannel.Sender.prototype.send = function(\n    eventType, opt_data, opt_useLongTimeout) {\n  var self = this;\n  var eventId;\n  var data = opt_data || {};\n  var onMessage;\n  var ackTimer;\n  var completionTimer;\n  var entry = null;\n  if (this.closed_) {\n    return goog.Promise.reject(fireauth.messagechannel.createError_(\n        fireauth.messagechannel.Error.CONNECTION_UNAVAILABLE));\n  }\n  var ackTimeout =\n      !!opt_useLongTimeout ?\n      fireauth.messagechannel.TimeoutDuration.LONG_ACK :\n      fireauth.messagechannel.TimeoutDuration.ACK;\n  var messageChannel =\n      fireauth.messagechannel.utils.initializeMessageChannel();\n  return new goog.Promise(function(resolve, reject) {\n    // Send message along with port for reply\n    if (messageChannel) {\n      eventId = fireauth.messagechannel.utils.generateEventId();\n      // Start the connection if not already started.\n      messageChannel.port1.start();\n      // Handler for receiving message reply from receiver.\n      // Blocks promise resolution until service worker detects the change.\n      ackTimer = setTimeout(function() {\n        // The receiver may not be able to handle the response for various\n        // reasons: library not included, or an incompatible version of\n        // the library is included.\n        // Timeout after some time.\n        reject(fireauth.messagechannel.createError_(\n            fireauth.messagechannel.Error.UNSUPPORTED_EVENT));\n      }, ackTimeout);\n      onMessage = function(event) {\n        // Process only the expected events that match current event ID.\n        if (event.data['eventId'] !== eventId) {\n          return;\n        }\n        // This avoids adding a long wait when the receiver is unable to handle\n        // the event.\n        if (event.data['status'] === fireauth.messagechannel.Status.ACK) {\n          clearTimeout(ackTimer);\n          // Set longer timeout to allow receiver to process.\n          completionTimer = setTimeout(function() {\n            reject(fireauth.messagechannel.createError_(\n                fireauth.messagechannel.Error.TIMEOUT));\n          }, fireauth.messagechannel.TimeoutDuration.COMPLETION);\n          return;\n        } else if (event.data['status'] ===\n                   fireauth.messagechannel.Status.DONE) {\n          clearTimeout(completionTimer);\n          if (typeof event.data['response'] !== 'undefined') {\n            resolve(event.data['response']);\n          } else {\n            reject(fireauth.messagechannel.createError_(\n                fireauth.messagechannel.Error.UNKNOWN));\n          }\n        } else {\n          clearTimeout(ackTimer);\n          clearTimeout(completionTimer);\n          reject(fireauth.messagechannel.createError_(\n              fireauth.messagechannel.Error.INVALID_RESPONSE));\n        }\n      };\n      entry = {\n        'messageChannel': messageChannel,\n        'onMessage': onMessage\n      };\n      self.messageHandlers_.push(entry);\n      messageChannel.port1.addEventListener('message', onMessage);\n      var request = {\n        'eventType': eventType,\n        'eventId': eventId,\n        'data': data\n      };\n      // It is possible the receiver cannot handle this result.\n      // For example, the developer may not be including the library in the\n      // receiver or using an outdated version.\n      self.postMessager_.postMessage(\n          request,\n          [messageChannel.port2]);\n    } else {\n      // No connection available.\n      reject(fireauth.messagechannel.createError_(\n          fireauth.messagechannel.Error.CONNECTION_UNAVAILABLE));\n    }\n  }).then(function(result) {\n    // On completion, remove the message handler. A new one is needed for a\n    // new message.\n    self.removeMessageHandler_(entry);\n    return result;\n  }).thenCatch(function(error) {\n    // On failure, remove the message handler. A new one is needed for a new\n    // message.\n    self.removeMessageHandler_(entry);\n    throw error;\n  });\n};\n\n\n/**\n * Removes the onMessage handler for the specified messageChannel.\n * @param {?fireauth.messagechannel.MessageHandler} messageHandler\n * @private\n */\nfireauth.messagechannel.Sender.prototype.removeMessageHandler_ =\n    function(messageHandler) {\n  if (!messageHandler) {\n    return;\n  }\n  var messageChannel = messageHandler['messageChannel'];\n  var onMessage = messageHandler['onMessage'];\n  if (messageChannel) {\n    messageChannel.port1.removeEventListener('message', onMessage);\n    messageChannel.port1.close();\n  }\n  goog.array.removeAllIf(this.messageHandlers_, function(ele) {\n    return ele == messageHandler;\n  });\n};\n\n\n/** Closes the underlying MessageChannel connection. */\nfireauth.messagechannel.Sender.prototype.close = function() {\n  // Any pending event will timeout.\n  while (this.messageHandlers_.length > 0) {\n    this.removeMessageHandler_(this.messageHandlers_[0]);\n  }\n  this.closed_ = true;\n};\n\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the MessageChannel common utilities and enums.\n */\n\ngoog.provide('fireauth.messagechannel.Error');\ngoog.provide('fireauth.messagechannel.Status');\ngoog.provide('fireauth.messagechannel.TimeoutDuration');\ngoog.provide('fireauth.messagechannel.utils');\n\n\n/**\n * Enum for the messagechannel error messages. These errors are not meant to be\n * user facing.\n * @enum {string}\n */\nfireauth.messagechannel.Error = {\n  CONNECTION_CLOSED: 'connection_closed',\n  CONNECTION_UNAVAILABLE: 'connection_unavailable',\n  INVALID_RESPONSE: 'invalid_response',\n  TIMEOUT: 'timeout',\n  UNKNOWN: 'unknown_error',\n  UNSUPPORTED_EVENT: 'unsupported_event'\n};\n\n\n/**\n * Enum for the message channel request status labels.\n * @enum {string}\n */\nfireauth.messagechannel.Status = {\n  ACK: 'ack',\n  DONE: 'done'\n};\n\n\n/**\n * Enum for the timeout durations in milliseconds for different contexts.\n * @enum {number}\n */\nfireauth.messagechannel.TimeoutDuration = {\n  ACK: 50,\n  COMPLETION: 3000,\n  // Used when a handler is confirmed to be available on the other side.\n  LONG_ACK: 800\n};\n\n\n/**\n * @param {?string=} opt_prefix An optional prefix string to prepend to ID.\n * @param {?number=} opt_digits An optional number of digits used for event ID.\n * @return {string} The generated event ID used to identify a generic event.\n */\nfireauth.messagechannel.utils.generateEventId =\n    function(opt_prefix, opt_digits) {\n  // 0, null and undefined will default to 20.\n  var digits = opt_digits || 20;\n  return opt_prefix ? opt_prefix : '' +\n      Math.floor(Math.random() * Math.pow(10, digits)).toString();\n};\n\n\n/**\n * @return {?MessageChannel} The initialized MessageChannel instance if\n *     supported.\n */\nfireauth.messagechannel.utils.initializeMessageChannel = function() {\n  return typeof MessageChannel !== 'undefined' ? new MessageChannel() : null;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ngoog.provide('fireauth.storage.Storage');\n\n\n\n/**\n * Defines a generic interface to storage APIs across platforms.\n * @interface\n */\nfireauth.storage.Storage = function() {};\n\n\n/**\n * Retrieves the value stored at the key.\n * @param {string} key\n * @return {!goog.Promise<*>}\n */\nfireauth.storage.Storage.prototype.get = function(key) {};\n\n\n/**\n * Stores the value at the specified key.\n * @param {string} key\n * @param {*} value\n * @return {!goog.Promise<void>}\n */\nfireauth.storage.Storage.prototype.set = function(key, value) {};\n\n\n/**\n * Removes the value at the specified key.\n * @param {string} key\n * @return {!goog.Promise<void>}\n */\nfireauth.storage.Storage.prototype.remove = function(key) {};\n\n\n/**\n * Adds a listener to storage event change.\n * @param {function(!goog.events.BrowserEvent)|function(!Array<string>)}\n *     listener The storage event listener.\n */\nfireauth.storage.Storage.prototype.addStorageListener = function(listener) {};\n\n\n/**\n * Removes a listener to storage event change.\n * @param {function(!goog.events.BrowserEvent)|function(!Array<string>)}\n *     listener The storage event listener.\n */\nfireauth.storage.Storage.prototype.removeStorageListener = function(listener) {\n};\n\n\n/** @type {string} The storage type identifier. */\nfireauth.storage.Storage.prototype.type;\n\n\n/**\n * Enum for the identifier of the type of underlying storage.\n * @enum {string}\n */\nfireauth.storage.Storage.Type = {\n  ASYNC_STORAGE: 'asyncStorage',\n  IN_MEMORY: 'inMemory',\n  INDEXEDDB: 'indexedDB',\n  LOCAL_STORAGE: 'localStorage',\n  MOCK_STORAGE: 'mockStorage',\n  NULL_STORAGE: 'nullStorage',\n  SESSION_STORAGE: 'sessionStorage'\n};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ngoog.provide('fireauth.storage.HybridIndexedDB');\n\ngoog.require('fireauth.storage.IndexedDB');\ngoog.require('fireauth.storage.Storage');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.array');\n\n/**\n * HybridStorage provides an interface to indexedDB, the persistent Web\n * Storage API for browsers that support it. This will fallback to the provided\n * fallback storage when indexedDB is not supported which is determined\n * asynchronously.\n * @param {!fireauth.storage.Storage} fallbackStorage The storage to fallback to\n *     when indexedDB is not available.\n * @constructor\n * @implements {fireauth.storage.Storage}\n */\nfireauth.storage.HybridIndexedDB = function(fallbackStorage) {\n  var self = this;\n  var storage = null;\n  /**\n   * @const @private {!Array<function((!goog.events.BrowserEvent|\n   *                                   !Array<string>))>} The storage listeners.\n   */\n  this.storageListeners_ = [];\n  // This type may change if the fallback is used.\n  /** @public {string} The storage type identifier. */\n  this.type = fireauth.storage.Storage.Type.INDEXEDDB;\n  /**\n   * @const @private {!fireauth.storage.Storage} The fallback storage when\n   *     indexedDB is unavailable.\n   */\n  this.fallbackStorage_ = fallbackStorage;\n  /**\n   * @const @private {!goog.Promise<!fireauth.storage.Storage>} A promise that\n   *     resolves with the underlying indexedDB storage or a fallback when not\n   *     supported.\n   */\n  this.underlyingStoragePromise_ = goog.Promise.resolve().then(function() {\n    // Initial check shows indexedDB is available. This is not enough.\n    // Try to write/read from indexedDB. If it fails, switch to fallback.\n    if (fireauth.storage.IndexedDB.isAvailable()) {\n      // Test write/read using a random key. This is important for the following\n      // reasons:\n      // 1. Double inclusion of the firebase-auth.js library.\n      // 2. Multiple windows opened at the same time.\n      // The above may cause collision if multiple instances try to\n      // write/read/delete from the same entry.\n      var randomId = fireauth.util.generateEventId();\n      var randomKey = fireauth.storage.HybridIndexedDB.KEY_ + randomId;\n      storage = fireauth.storage.IndexedDB.getFireauthManager();\n      return storage.set(randomKey, randomId)\n          .then(function() {\n            return storage.get(randomKey);\n          })\n          .then(function(value) {\n            if (value !== randomId) {\n              throw new Error('indexedDB not supported!');\n            }\n            return storage.remove(randomKey);\n          })\n          .then(function() {\n            return storage;\n          })\n          .thenCatch(function(error) {\n            return self.fallbackStorage_;\n          });\n    } else {\n      // indexedDB not available, use fallback.\n      return self.fallbackStorage_;\n    }\n  }).then(function(storage) {\n    // Update type.\n    self.type = storage.type;\n    // Listen to all storage changes.\n    storage.addStorageListener(function(key) {\n      // Trigger all attached storage listeners.\n      goog.array.forEach(self.storageListeners_, function(listener) {\n        listener(key);\n      });\n    });\n    return storage;\n  });\n};\n\n\n/**\n * The key used to check if the storage instance is available.\n * @private {string}\n * @const\n */\nfireauth.storage.HybridIndexedDB.KEY_ = '__sak';\n\n\n/**\n * Retrieves the value stored at the key.\n * @param {string} key\n * @return {!goog.Promise<*>}\n * @override\n */\nfireauth.storage.HybridIndexedDB.prototype.get = function(key) {\n  return this.underlyingStoragePromise_.then(function(storage) {\n    return storage.get(key);\n  });\n};\n\n\n/**\n * Stores the value at the specified key.\n * @param {string} key\n * @param {*} value\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.HybridIndexedDB.prototype.set = function(key, value) {\n  return this.underlyingStoragePromise_.then(function(storage) {\n    return storage.set(key, value);\n  });\n};\n\n\n/**\n * Removes the value at the specified key.\n * @param {string} key\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.HybridIndexedDB.prototype.remove = function(key) {\n  return this.underlyingStoragePromise_.then(function(storage) {\n    return storage.remove(key);\n  });\n};\n\n\n/**\n * Adds a listener to storage event change.\n * @param {function((!goog.events.BrowserEvent|!Array<string>))} listener The\n *     storage event listener.\n * @override\n */\nfireauth.storage.HybridIndexedDB.prototype.addStorageListener =\n    function(listener) {\n  this.storageListeners_.push(listener);\n};\n\n\n/**\n * Removes a listener to storage event change.\n * @param {function(!goog.events.BrowserEvent)} listener The storage event\n *     listener.\n * @override\n */\nfireauth.storage.HybridIndexedDB.prototype.removeStorageListener =\n    function(listener) {\n  goog.array.removeAllIf(this.storageListeners_, function(ele) {\n    return ele == listener;\n  });\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ngoog.provide('fireauth.storage.InMemoryStorage');\n\ngoog.require('goog.Promise');\n\n\n\n/**\n * InMemoryStorage provides an implementation of Storage that will only persist\n * data in memory. This data is volatile and in a browser environment, will\n * be lost on page unload and will only be available in the current window.\n * This is a useful fallback for browsers where web storage is disabled or\n * environments where the preferred storage mechanism is not available or not\n * supported.\n * @constructor\n * @implements {fireauth.storage.Storage}\n */\nfireauth.storage.InMemoryStorage = function() {\n  /** @protected {!Object} The object where we store values. */\n  this.storage = {};\n  /** @public {string} The storage type identifier. */\n  this.type = fireauth.storage.Storage.Type.IN_MEMORY;\n};\n\n\n/**\n * @param {string} key\n * @return {!goog.Promise<*>}\n * @override\n */\nfireauth.storage.InMemoryStorage.prototype.get = function(key) {\n  return goog.Promise.resolve(/** @type {*} */ (this.storage[key]));\n};\n\n\n/**\n * @param {string} key\n * @param {*} value\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.InMemoryStorage.prototype.set = function(key, value) {\n  this.storage[key] = value;\n  return goog.Promise.resolve();\n};\n\n\n/**\n * @param {string} key\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.InMemoryStorage.prototype.remove = function(key) {\n  delete this.storage[key];\n  return goog.Promise.resolve();\n};\n\n\n/**\n * @param {function((!goog.events.BrowserEvent|!Array<string>))} listener The\n *     storage event listener.\n * @override\n */\nfireauth.storage.InMemoryStorage.prototype.addStorageListener =\n    function(listener) {\n};\n\n\n/**\n * @param {function((!goog.events.BrowserEvent|!Array<string>))} listener The\n *     storage event listener.\n * @override\n */\nfireauth.storage.InMemoryStorage.prototype.removeStorageListener = function(\n    listener) {};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ngoog.provide('fireauth.storage.LocalStorage');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.storage.Storage');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.events');\n\n\n\n/**\n * LocalStorage provides an interface to localStorage, the persistent Web\n * Storage API.\n * @constructor\n * @implements {fireauth.storage.Storage}\n */\nfireauth.storage.LocalStorage = function() {\n  // Check is localStorage available in the current environment.\n  if (!fireauth.storage.LocalStorage.isAvailable()) {\n    // In a Node.js environment, dom-storage module needs to be required.\n    if (fireauth.util.getEnvironment() == fireauth.util.Env.NODE) {\n      throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR,\n          'The LocalStorage compatibility library was not found.');\n    }\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.WEB_STORAGE_UNSUPPORTED);\n  }\n\n  /**\n   * The underlying storage instance for persistent data.\n   * @private {!Storage}\n   */\n  this.storage_ = /** @type {!Storage} */ (\n      fireauth.storage.LocalStorage.getGlobalStorage() ||\n      firebase.INTERNAL['node']['localStorage']);\n  /** @public {string} The storage type identifier. */\n  this.type = fireauth.storage.Storage.Type.LOCAL_STORAGE;\n};\n\n\n/** @return {?Storage|undefined} The global localStorage instance. */\nfireauth.storage.LocalStorage.getGlobalStorage = function() {\n  try {\n    var storage = goog.global['localStorage'];\n    // Try editing web storage. If an error is thrown, it may be disabled.\n    var key = fireauth.util.generateEventId();\n    if (storage) {\n      storage['setItem'](key, '1');\n      storage['removeItem'](key);\n    }\n    return storage;\n  } catch (e) {\n    // In some cases, browsers with web storage disabled throw an error simply\n    // on access.\n    return null;\n  }\n};\n\n\n/**\n * The key used to check if the storage instance is available.\n * @private {string}\n * @const\n */\nfireauth.storage.LocalStorage.STORAGE_AVAILABLE_KEY_ = '__sak';\n\n\n/** @return {boolean} Whether localStorage is available. */\nfireauth.storage.LocalStorage.isAvailable = function() {\n  // In Node.js localStorage is polyfilled.\n  var isNode = fireauth.util.getEnvironment() == fireauth.util.Env.NODE;\n  // Either window should provide this storage mechanism or in case of Node.js,\n  // firebase.INTERNAL should provide it.\n  var storage = fireauth.storage.LocalStorage.getGlobalStorage() ||\n      (isNode &&\n       firebase.INTERNAL['node'] &&\n       firebase.INTERNAL['node']['localStorage']);\n  if (!storage) {\n    return false;\n  }\n  try {\n    // setItem will throw an exception if we cannot access web storage (e.g.,\n    // Safari in private mode).\n    storage.setItem(fireauth.storage.LocalStorage.STORAGE_AVAILABLE_KEY_, '1');\n    storage.removeItem(fireauth.storage.LocalStorage.STORAGE_AVAILABLE_KEY_);\n    return true;\n  } catch (e) {\n    return false;\n  }\n};\n\n\n/**\n * Retrieves the value stored at the key.\n * @param {string} key\n * @return {!goog.Promise<*>}\n * @override\n */\nfireauth.storage.LocalStorage.prototype.get = function(key) {\n  var self = this;\n  return goog.Promise.resolve()\n      .then(function() {\n        var json = self.storage_.getItem(key);\n        return fireauth.util.parseJSON(json);\n      });\n};\n\n\n/**\n * Stores the value at the specified key.\n * @param {string} key\n * @param {*} value\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.LocalStorage.prototype.set = function(key, value) {\n  var self = this;\n  return goog.Promise.resolve()\n      .then(function() {\n        var obj = fireauth.util.stringifyJSON(value);\n        if (goog.isNull(obj)) {\n          self.remove(key);\n        } else {\n          self.storage_.setItem(key, obj);\n        }\n      });\n};\n\n\n/**\n * Removes the value at the specified key.\n * @param {string} key\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.LocalStorage.prototype.remove = function(key) {\n  var self = this;\n  return goog.Promise.resolve()\n      .then(function() {\n        self.storage_.removeItem(key);\n      });\n};\n\n\n/**\n * Adds a listener to storage event change.\n * @param {function(!goog.events.BrowserEvent)} listener The storage event\n *     listener.\n * @override\n */\nfireauth.storage.LocalStorage.prototype.addStorageListener = function(\n    listener) {\n  if (goog.global['window']) {\n    goog.events.listen(goog.global['window'], 'storage', listener);\n  }\n};\n\n\n/**\n * Removes a listener to storage event change.\n * @param {function(!goog.events.BrowserEvent)} listener The storage event\n *     listener.\n * @override\n */\nfireauth.storage.LocalStorage.prototype.removeStorageListener = function(\n    listener) {\n  if (goog.global['window']) {\n    goog.events.unlisten(goog.global['window'], 'storage', listener);\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ngoog.provide('fireauth.storage.NullStorage');\n\ngoog.require('fireauth.storage.Storage');\ngoog.require('goog.Promise');\n\n\n\n/**\n * NullStorage provides an implementation of Storage that does always returns\n * null. This can be used if a type of storage is unsupported on a platform.\n * @constructor\n * @implements {fireauth.storage.Storage}\n */\nfireauth.storage.NullStorage = function() {\n  /** @private {!Object} The object where we store values. */\n  this.storage_ = {};\n  /** @public {string} The storage type identifier. */\n  this.type = fireauth.storage.Storage.Type.NULL_STORAGE;\n};\n\n\n/**\n * @param {string} key\n * @return {!goog.Promise<*>}\n * @override\n */\nfireauth.storage.NullStorage.prototype.get = function(key) {\n  return goog.Promise.resolve(/** @type {*} */ (null));\n};\n\n\n/**\n * @param {string} key\n * @param {*} value\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.NullStorage.prototype.set = function(key, value) {\n  return goog.Promise.resolve();\n};\n\n\n/**\n * @param {string} key\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.NullStorage.prototype.remove = function(key) {\n  return goog.Promise.resolve();\n};\n\n\n/**\n * @param {function(!goog.events.BrowserEvent)} listener The storage event\n *     listener.\n * @override\n */\nfireauth.storage.NullStorage.prototype.addStorageListener = function(listener) {\n};\n\n\n/**\n * @param {function(!goog.events.BrowserEvent)} listener The storage event\n *     listener.\n * @override\n */\nfireauth.storage.NullStorage.prototype.removeStorageListener = function(\n    listener) {};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ngoog.provide('fireauth.storage.SessionStorage');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.storage.Storage');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\n\n\n\n/**\n * SessionStorage provides an interface to sessionStorage, the temporary web\n * storage API.\n * @constructor\n * @implements {fireauth.storage.Storage}\n */\nfireauth.storage.SessionStorage = function() {\n  // Check is sessionStorage available in the current environment.\n  if (!fireauth.storage.SessionStorage.isAvailable()) {\n    // In a Node.js environment, dom-storage module needs to be required.\n    if (fireauth.util.getEnvironment() == fireauth.util.Env.NODE) {\n      throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR,\n          'The SessionStorage compatibility library was not found.');\n    }\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.WEB_STORAGE_UNSUPPORTED);\n  }\n\n  /**\n   * The underlying storage instance for temporary data.\n   * @private {!Storage}\n   */\n  this.storage_ = /** @type {!Storage} */ (\n      fireauth.storage.SessionStorage.getGlobalStorage() ||\n      firebase.INTERNAL['node']['sessionStorage']);\n  /** @public {string} The storage type identifier. */\n  this.type = fireauth.storage.Storage.Type.SESSION_STORAGE;\n};\n\n\n/** @return {?Storage|undefined} The global sessionStorage instance. */\nfireauth.storage.SessionStorage.getGlobalStorage = function() {\n  try {\n    var storage = goog.global['sessionStorage'];\n    // Try editing web storage. If an error is thrown, it may be disabled.\n    var key = fireauth.util.generateEventId();\n    if (storage) {\n      storage['setItem'](key, '1');\n      storage['removeItem'](key);\n    }\n    return storage;\n  } catch (e) {\n    // In some cases, browsers with web storage disabled throw an error simply\n    // on access.\n    return null;\n  }\n};\n\n\n/**\n * The key used to check if the storage instance is available.\n * @private {string}\n * @const\n */\nfireauth.storage.SessionStorage.STORAGE_AVAILABLE_KEY_ = '__sak';\n\n\n/** @return {boolean} Whether sessionStorage is available. */\nfireauth.storage.SessionStorage.isAvailable = function() {\n  // In Node.js sessionStorage is polyfilled.\n  var isNode = fireauth.util.getEnvironment() == fireauth.util.Env.NODE;\n  // Either window should provide this storage mechanism or in case of Node.js,\n  // firebase.INTERNAL should provide it.\n  var storage = fireauth.storage.SessionStorage.getGlobalStorage() ||\n      (isNode &&\n       firebase.INTERNAL['node'] &&\n       firebase.INTERNAL['node']['sessionStorage']);\n  if (!storage) {\n    return false;\n  }\n  try {\n    // setItem will throw an exception if we cannot access web storage (e.g.,\n    // Safari in private mode).\n    storage.setItem(\n        fireauth.storage.SessionStorage.STORAGE_AVAILABLE_KEY_, '1');\n    storage.removeItem(fireauth.storage.SessionStorage.STORAGE_AVAILABLE_KEY_);\n    return true;\n  } catch (e) {\n    return false;\n  }\n};\n\n\n/**\n * Retrieves the value stored at the key.\n * @param {string} key\n * @return {!goog.Promise<*>}\n * @override\n */\nfireauth.storage.SessionStorage.prototype.get = function(key) {\n  var self = this;\n  return goog.Promise.resolve()\n      .then(function() {\n        var json = self.storage_.getItem(key);\n        return fireauth.util.parseJSON(json);\n      });\n};\n\n\n/**\n * Stores the value at the specified key.\n * @param {string} key\n * @param {*} value\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.SessionStorage.prototype.set = function(key, value) {\n  var self = this;\n  return goog.Promise.resolve()\n      .then(function() {\n        var obj = fireauth.util.stringifyJSON(value);\n        if (goog.isNull(obj)) {\n          self.remove(key);\n        } else {\n          self.storage_.setItem(key, obj);\n        }\n      });\n};\n\n\n/**\n * Removes the value at the specified key.\n * @param {string} key\n * @return {!goog.Promise<void>}\n * @override\n */\nfireauth.storage.SessionStorage.prototype.remove = function(key) {\n  var self = this;\n  return goog.Promise.resolve()\n      .then(function() {\n        self.storage_.removeItem(key);\n      });\n};\n\n\n/**\n * Adds a listener to storage event change.\n * @param {function(!goog.events.BrowserEvent)} listener The storage event\n *     listener.\n * @override\n */\nfireauth.storage.SessionStorage.prototype.addStorageListener = function(\n    listener) {};\n\n\n/**\n * Removes a listener to storage event change.\n * @param {function(!goog.events.BrowserEvent)} listener The storage event\n *     listener.\n * @override\n */\nfireauth.storage.SessionStorage.prototype.removeStorageListener = function(\n    listener) {};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ngoog.provide('fireauth.storage.Factory');\ngoog.provide('fireauth.storage.Factory.EnvConfig');\n\ngoog.require('fireauth.storage.AsyncStorage');\ngoog.require('fireauth.storage.HybridIndexedDB');\ngoog.require('fireauth.storage.InMemoryStorage');\ngoog.require('fireauth.storage.LocalStorage');\ngoog.require('fireauth.storage.NullStorage');\ngoog.require('fireauth.storage.SessionStorage');\ngoog.require('fireauth.util');\n\n\n/**\n * Factory manages the storage implementations and determines the correct one\n * for the current environment.\n * @param {!fireauth.storage.Factory.EnvConfigType} env The storage\n *     configuration for the current environment.\n * @constructor\n */\nfireauth.storage.Factory = function(env) {\n  /** @const @private {!fireauth.storage.Factory.EnvConfigType} */\n  this.env_ = env;\n};\n\n\n/**\n * Construct the singleton instance of the Factory, automatically detecting\n * the current environment.\n * @return {!fireauth.storage.Factory}\n */\nfireauth.storage.Factory.getInstance = function() {\n  if (!fireauth.storage.Factory.instance_) {\n    fireauth.storage.Factory.instance_ =\n        new fireauth.storage.Factory(fireauth.storage.Factory.getEnvConfig());\n  }\n  return fireauth.storage.Factory.instance_;\n};\n\n\n/**\n * @typedef {{\n *   persistent: function(new:fireauth.storage.Storage),\n *   temporary: function(new:fireauth.storage.Storage)\n * }}\n */\nfireauth.storage.Factory.EnvConfigType;\n\n\n/**\n * Configurations of storage for different environments.\n * @enum {!fireauth.storage.Factory.EnvConfigType}\n */\nfireauth.storage.Factory.EnvConfig = {\n  BROWSER: {\n    persistent: fireauth.storage.LocalStorage,\n    temporary: fireauth.storage.SessionStorage\n  },\n  NODE: {\n    persistent: fireauth.storage.LocalStorage,\n    temporary: fireauth.storage.SessionStorage\n  },\n  REACT_NATIVE: {\n    persistent: fireauth.storage.AsyncStorage,\n    temporary: fireauth.storage.NullStorage\n  },\n  WORKER: {\n    persistent: fireauth.storage.LocalStorage,\n    temporary: fireauth.storage.NullStorage\n  }\n};\n\n\n/**\n * Detects the current environment and returns the appropriate environment\n * configuration.\n * @return {!fireauth.storage.Factory.EnvConfigType}\n */\nfireauth.storage.Factory.getEnvConfig = function() {\n  var envMap = {};\n  envMap[fireauth.util.Env.BROWSER] =\n      fireauth.storage.Factory.EnvConfig.BROWSER;\n  envMap[fireauth.util.Env.NODE] =\n      fireauth.storage.Factory.EnvConfig.NODE;\n  envMap[fireauth.util.Env.REACT_NATIVE] =\n      fireauth.storage.Factory.EnvConfig.REACT_NATIVE;\n  envMap[fireauth.util.Env.WORKER] =\n      fireauth.storage.Factory.EnvConfig.WORKER;    \n  return envMap[fireauth.util.getEnvironment()];\n};\n\n\n/**\n * @return {!fireauth.storage.Storage} The persistent storage instance.\n */\nfireauth.storage.Factory.prototype.makePersistentStorage = function() {\n  if (fireauth.util.persistsStorageWithIndexedDB()) {\n    // If persistent storage is implemented using indexedDB, use indexedDB.\n    // Use HybridIndexedDB instead of indexedDB directly since this will\n    // fallback to a fallback storage when indexedDB is not supported (private\n    // browsing mode, etc).\n    return new fireauth.storage.HybridIndexedDB(\n        fireauth.util.isWorker() ?\n        new fireauth.storage.InMemoryStorage() : new this.env_.persistent());\n  }\n  return new this.env_.persistent();\n};\n\n\n/**\n * @return {!fireauth.storage.Storage} The temporary storage instance.\n */\nfireauth.storage.Factory.prototype.makeTemporaryStorage = function() {\n  return new this.env_.temporary();\n};\n\n\n/**\n * @return {!fireauth.storage.Storage} An in memory storage instance.\n */\nfireauth.storage.Factory.prototype.makeInMemoryStorage = function() {\n  return new fireauth.storage.InMemoryStorage();\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines utilities for session management.\n */\n\ngoog.provide('fireauth.authStorage');\ngoog.provide('fireauth.authStorage.Key');\ngoog.provide('fireauth.authStorage.Manager');\ngoog.provide('fireauth.authStorage.Persistence');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.storage.Factory');\ngoog.require('fireauth.storage.Storage');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.array');\ngoog.require('goog.events');\ngoog.require('goog.object');\n\n\n\n/**\n * The namespace for Firebase Auth storage.\n * @private @const {string}\n */\nfireauth.authStorage.NAMESPACE_ = 'firebase';\n\n\n/**\n * The separator for Firebase Auth storage with App ID key.\n * @private @const {string}\n */\nfireauth.authStorage.SEPARATOR_ = ':';\n\n\n/**\n * @const {number} The IE 10 localStorage cross tab synchronization delay in\n *     milliseconds.\n */\nfireauth.authStorage.IE10_LOCAL_STORAGE_SYNC_DELAY = 10;\n\n\n/**\n * Enums for Auth state persistence.\n * @enum {string}\n */\nfireauth.authStorage.Persistence = {\n  // State will persist even when the browser window is closed or the activity\n  // is destroyed in react-native.\n  LOCAL: 'local',\n  // State is only stored in memory and will be cleared when the window or\n  // activity is refreshed.\n  NONE: 'none',\n  // State will only persist in current session/tab, relevant to web only, and\n  // will be cleared when the tab is closed.\n  SESSION: 'session'\n};\n\n\n/**\n * Validates that an argument is a valid persistence value. If an invalid type\n * is specified, an error is thrown synchronously.\n * @param {*} arg The argument to validate.\n */\nfireauth.authStorage.validatePersistenceArgument =\n    function(arg) {\n  // Invalid type error.\n  var invalidTypeError = new fireauth.AuthError(\n      fireauth.authenum.Error.INVALID_PERSISTENCE);\n  // Unsupported type error.\n  var unsupportedTypeError = new fireauth.AuthError(\n      fireauth.authenum.Error.UNSUPPORTED_PERSISTENCE);\n  // Check if the persistence type is a valid one.\n  // Throw invalid type error if not valid.\n  if (!goog.object.containsValue(fireauth.authStorage.Persistence, arg) ||\n      // goog.object.containsValue(fireauth.authStorage.Persistence, ['none'])\n      // returns true.\n      typeof arg !== 'string') {\n    throw invalidTypeError;\n  }\n  // Validate if the specified type is supported in the current environment.\n  switch (fireauth.util.getEnvironment()) {\n    case fireauth.util.Env.REACT_NATIVE:\n      // This is only supported in a browser.\n      if (arg === fireauth.authStorage.Persistence.SESSION) {\n        throw unsupportedTypeError;\n      }\n      break;\n    case fireauth.util.Env.NODE:\n      // Only none is supported in Node.js.\n      if (arg !== fireauth.authStorage.Persistence.NONE) {\n        throw unsupportedTypeError;\n      }\n      break;\n    case fireauth.util.Env.BROWSER:\n    default:\n      // This is restricted by what the browser supports.\n      if (!fireauth.util.isWebStorageSupported() &&\n          arg !== fireauth.authStorage.Persistence.NONE) {\n        throw unsupportedTypeError;\n      }\n      break;\n  }\n};\n\n\n/**\n * Storage key metadata.\n * @typedef {{name: string, persistent: !fireauth.authStorage.Persistence}}\n */\nfireauth.authStorage.Key;\n\n\n/**\n * Storage manager.\n * @param {string} namespace The optional namespace.\n * @param {string} separator The optional separator.\n * @param {boolean} safariLocalStorageNotSynced Whether browser has Safari\n *     iframe restriction with storage event triggering but storage not updated.\n * @param {boolean} runsInBackground Whether browser can detect storage event\n *     when it had already been pushed to the background. This may happen in\n *     some mobile browsers. A localStorage change in the foreground window\n *     will not be detected in the background window via the storage event.\n *     This was detected in iOS 7.x mobile browsers.\n * @param {boolean} webStorageSupported Whether browser web storage is\n *     supported.\n * @constructor @struct @final\n */\nfireauth.authStorage.Manager = function(\n    namespace,\n    separator,\n    safariLocalStorageNotSynced,\n    runsInBackground,\n    webStorageSupported) {\n  /** @const @private {string} Storage namespace. */\n  this.namespace_ = namespace;\n  /** @const @private {string} Storage namespace key separator. */\n  this.separator_ = separator;\n  /**\n   * @const @private {boolean} Whether browser has Safari iframe restriction\n   *     with storage event triggering but storage not updated.\n   */\n  this.safariLocalStorageNotSynced_ = safariLocalStorageNotSynced;\n  /**\n   *  @private {boolean} Whether browser can detect storage event when it\n   *     had already been pushed to the background. This may happen in some\n   *     mobile browsers.\n   */\n  this.runsInBackground_ = runsInBackground;\n  /**  @const @private {boolean} Whether browser web storage is supported. */\n  this.webStorageSupported_ = webStorageSupported;\n\n  /**\n   * @const @private {!Object.<string, !Array<function()>>} The storage event\n   *     key to listeners map.\n   */\n  this.listeners_ = {};\n\n  var storageFactory = fireauth.storage.Factory.getInstance();\n  try {\n    /**\n     * @private {!fireauth.storage.Storage} Persistence storage.\n     */\n    this.persistentStorage_ = storageFactory.makePersistentStorage();\n  } catch (e) {\n    // Default to in memory storage if the preferred persistent storage is not\n    // supported.\n    this.persistentStorage_ = storageFactory.makeInMemoryStorage();\n    // Do not use indexedDB fallback.\n    this.localStorageNotSynchronized_ = false;\n    // Do not set polling functions on window.localStorage.\n    this.runsInBackground_ = true;\n  }\n  try {\n    /**\n     * @private {!fireauth.storage.Storage} Temporary session storage.\n     */\n    this.temporaryStorage_ = storageFactory.makeTemporaryStorage();\n  } catch (e) {\n    // Default to in memory storage if the preferred temporary storage is not\n    // supported. This should be a different in memory instance as the\n    // persistent storage, since the same key could be available for both types\n    // of storage.\n    this.temporaryStorage_ = storageFactory.makeInMemoryStorage();\n  }\n  /**\n   * @private {!fireauth.storage.Storage} In memory storage.\n   */\n  this.inMemoryStorage_ = storageFactory.makeInMemoryStorage();\n\n  /**\n   * @const @private {function(!goog.events.BrowserEvent)|\n   *                  function(!Array<string>)} Storage change handler.\n   */\n  this.storageChangeEventHandler_ = goog.bind(this.storageChangeEvent_, this);\n  /** @private {!Object.<string, *>} Local map for localStorage. */\n  this.localMap_ = {};\n};\n\n\n/**\n * @return {!fireauth.authStorage.Manager} The default Auth storage manager\n *     instance.\n */\nfireauth.authStorage.Manager.getInstance = function() {\n  // Creates the default instance for Auth storage maanger.\n  if (!fireauth.authStorage.Manager.instance_) {\n    /**\n     * @private {?fireauth.authStorage.Manager} The default storage manager\n     *     instance.\n     */\n    fireauth.authStorage.Manager.instance_ = new fireauth.authStorage.Manager(\n        fireauth.authStorage.NAMESPACE_,\n        fireauth.authStorage.SEPARATOR_,\n        fireauth.util.isSafariLocalStorageNotSynced(),\n        fireauth.util.runsInBackground(),\n        fireauth.util.isWebStorageSupported());\n  }\n  return fireauth.authStorage.Manager.instance_;\n};\n\n\n/** Clears storage manager instances. This is used for testing. */\nfireauth.authStorage.Manager.clear = function() {\n  fireauth.authStorage.Manager.instance_ = null;\n};\n\n\n/**\n * Returns the storage corresponding to the specified persistence.\n * @param {!fireauth.authStorage.Persistence} persistent The type of storage\n *     persistence.\n * @return {!fireauth.storage.Storage} The corresponding storage instance.\n * @private\n */\nfireauth.authStorage.Manager.prototype.getStorage_ = function(persistent) {\n  switch (persistent) {\n    case fireauth.authStorage.Persistence.SESSION:\n      return this.temporaryStorage_;\n    case fireauth.authStorage.Persistence.NONE:\n      return this.inMemoryStorage_;\n    case fireauth.authStorage.Persistence.LOCAL:\n    default:\n      return this.persistentStorage_;\n  }\n};\n\n\n/**\n * Constructs the corresponding storage key name.\n * @param {fireauth.authStorage.Key} dataKey The key under which the value is\n *     stored.\n * @param {?string=} opt_id This ID associates storage values with specific\n *     apps.\n * @return {string} The corresponding key name with namespace prefixed.\n * @private\n */\nfireauth.authStorage.Manager.prototype.getKeyName_ = function(dataKey, opt_id) {\n  return this.namespace_ + this.separator_ + dataKey.name +\n      (opt_id ? this.separator_ + opt_id : '');\n};\n\n\n/**\n * Migrates window.localStorage to the provided persistent storage.\n * @param {fireauth.authStorage.Key} dataKey The key under which the persistent\n *     value is supposed to be stored.\n * @param {?string=} opt_id When operating in multiple app mode, this ID\n *     associates storage values with specific apps.\n * @return {!goog.Promise<void>} A promise that resolves when the data stored\n *     in window.localStorage is migrated to the provided persistent storage\n *     identified by the provided data key.\n */\nfireauth.authStorage.Manager.prototype.migrateFromLocalStorage =\n    function(dataKey, opt_id) {\n  var self = this;\n  var key = this.getKeyName_(dataKey, opt_id);\n  var storage = this.getStorage_(dataKey.persistent);\n  // Get data stored in the default persistent storage identified by dataKey.\n  return this.get(dataKey, opt_id).then(function(response) {\n    // Get the stored value in window.localStorage if available.\n    var oldStorageValue = null;\n    try {\n      oldStorageValue = fireauth.util.parseJSON(\n          goog.global['localStorage']['getItem'](key));\n    } catch (e) {\n      // Set value as null. This will resolve the promise immediately.\n    }\n    // If data is stored in window.localStorage but no data is available in\n    // default persistent storage, migrate data from window.localStorage to\n    // default persistent storage.\n    if (oldStorageValue && !response) {\n      // This condition may fail in situations where a user opens a tab with\n      // an old version while using a tab with a new version, or when a\n      // developer switches back and forth between and old and new version of\n      // the library.\n      goog.global['localStorage']['removeItem'](key);\n      // Migrate the value to new default persistent storage.\n      return self.set(dataKey, oldStorageValue, opt_id);\n    } else if (oldStorageValue &&\n               response &&\n               storage.type != fireauth.storage.Storage.Type.LOCAL_STORAGE) {\n      // Data stored in both localStorage and new persistent storage (eg.\n      // indexedDB) for some reason.\n      // This could happen if the developer is migrating back and forth.\n      // The new default persistent storage (eg. indexedDB) takes precedence.\n      goog.global['localStorage']['removeItem'](key);\n    }\n  });\n};\n\n\n/**\n * Gets the stored value from the corresponding storage.\n * @param {fireauth.authStorage.Key} dataKey The key under which the value is\n *     stored.\n * @param {?string=} opt_id When operating in multiple app mode, this ID\n *     associates storage values with specific apps.\n * @return {!goog.Promise} A Promise that resolves with the stored value.\n */\nfireauth.authStorage.Manager.prototype.get = function(dataKey, opt_id) {\n  var keyName = this.getKeyName_(dataKey, opt_id);\n  return this.getStorage_(dataKey.persistent).get(keyName);\n};\n\n\n/**\n * Removes the stored value from the corresponding storage.\n * @param {fireauth.authStorage.Key} dataKey The key under which the value is\n *     stored.\n * @param {?string=} opt_id When operating in multiple app mode, this ID\n *     associates storage values with specific apps.\n * @return {!goog.Promise<void>} A Promise that resolves when the operation is\n *     completed.\n */\nfireauth.authStorage.Manager.prototype.remove = function(dataKey, opt_id) {\n  var keyName = this.getKeyName_(dataKey, opt_id);\n  // Keep local map up to date for requested key if persistent storage is used.\n  if (dataKey.persistent == fireauth.authStorage.Persistence.LOCAL) {\n    this.localMap_[keyName] = null;\n  }\n  return this.getStorage_(dataKey.persistent).remove(keyName);\n};\n\n\n/**\n * Stores the value in the corresponding storage.\n * @param {fireauth.authStorage.Key} dataKey The key under which the value is\n *     stored.\n * @param {*} value The value to be stored.\n * @param {?string=} opt_id When operating in multiple app mode, this ID\n *     associates storage values with specific apps.\n * @return {!goog.Promise<void>} A Promise that resolves when the operation is\n *     completed.\n */\nfireauth.authStorage.Manager.prototype.set = function(dataKey, value, opt_id) {\n  var keyName = this.getKeyName_(dataKey, opt_id);\n  var self = this;\n  var storage = this.getStorage_(dataKey.persistent);\n  return storage.set(keyName, value)\n      .then(function() {\n        return storage.get(keyName);\n      })\n      .then(function(serializedValue) {\n        // Keep local map up to date for requested key if persistent storage is\n        // used.\n        if (dataKey.persistent == fireauth.authStorage.Persistence.LOCAL) {\n          self.localMap_[keyName] = serializedValue;\n        }\n      });\n};\n\n\n/**\n * @param {fireauth.authStorage.Key} dataKey The key under which the value is\n *     stored.\n * @param {?string} id When operating in multiple app mode, this ID associates\n *     storage values with specific apps.\n * @param {function()} listener The callback listener to run on storage event\n *     related to key.\n */\nfireauth.authStorage.Manager.prototype.addListener =\n    function(dataKey, id, listener) {\n  var key = this.getKeyName_(dataKey, id);\n  // Initialize local map for current key if web storage is supported.\n  if (this.webStorageSupported_) {\n    this.localMap_[key] = goog.global['localStorage']['getItem'](key);\n  }\n  if (goog.object.isEmpty(this.listeners_)) {\n    // Start listeners.\n    this.startListeners_();\n  }\n  if (!this.listeners_[key]) {\n    this.listeners_[key] = [];\n  }\n  this.listeners_[key].push(listener);\n};\n\n\n/**\n * @param {fireauth.authStorage.Key} dataKey The key under which the value is\n *     stored.\n * @param {?string} id When operating in multiple app mode, this ID associates\n *     storage values with specific apps.\n * @param {function()} listener The listener to remove.\n */\nfireauth.authStorage.Manager.prototype.removeListener =\n    function(dataKey, id, listener) {\n  var key = this.getKeyName_(dataKey, id);\n  if (this.listeners_[key]) {\n    goog.array.removeAllIf(\n        this.listeners_[key],\n        function(ele) {\n          return ele == listener;\n        });\n    if (this.listeners_[key].length == 0) {\n      delete this.listeners_[key];\n    }\n  }\n  if (goog.object.isEmpty(this.listeners_)) {\n    // Stop listeners.\n    this.stopListeners_();\n  }\n};\n\n\n/**\n * The delay to wait between continuous checks of localStorage on browsers where\n * tabs do not run in the background. After each interval wait, we check for\n * external changes in localStorage that were not detected in the current tab.\n * @const {number}\n * @private\n */\nfireauth.authStorage.Manager.LOCAL_STORAGE_POLLING_TIMER_ = 1000;\n\n\n/**\n * Starts all storage event listeners.\n * @private\n */\nfireauth.authStorage.Manager.prototype.startListeners_ = function() {\n  this.getStorage_(fireauth.authStorage.Persistence.LOCAL)\n      .addStorageListener(this.storageChangeEventHandler_);\n  // TODO: refactor this implementation to be handled by the underlying\n  // storage mechanism.\n  if (!this.runsInBackground_ &&\n      // Add an exception for browsers that persist storage with indexedDB, we\n      // should stick with indexedDB listener implementation in that case.\n      !fireauth.util.persistsStorageWithIndexedDB() &&\n      // Confirm browser web storage is supported as polling relies on it.\n      this.webStorageSupported_) {\n    this.startManualListeners_();\n  }\n};\n\n/**\n * Starts manual polling function to detect storage event changes.\n * @private\n */\nfireauth.authStorage.Manager.prototype.startManualListeners_ = function() {\n  var self = this;\n  this.stopManualListeners_();\n  /** @private {?number} The interval timer for manual storage checking. */\n  this.manualListenerTimer_ = setInterval(function() {\n    // Check all keys with listeners on them.\n    for (var key in self.listeners_) {\n      // Get value from localStorage.\n      var currentValue = goog.global['localStorage']['getItem'](key);\n      var oldValue = self.localMap_[key];\n      // If local map value does not match, trigger listener with storage event.\n      if (currentValue != oldValue) {\n        self.localMap_[key] = currentValue;\n        var event = new goog.events.BrowserEvent(/** @type {!Event} */ ({\n          type: 'storage',\n          key: key,\n          target: window,\n          oldValue: oldValue,\n          newValue: currentValue,\n          // Differentiate this simulated event from the real storage event.\n          poll: true\n        }));\n        self.storageChangeEvent_(event);\n      }\n    }\n  }, fireauth.authStorage.Manager.LOCAL_STORAGE_POLLING_TIMER_);\n};\n\n\n/**\n * Stops manual polling function to detect storage event changes.\n * @private\n */\nfireauth.authStorage.Manager.prototype.stopManualListeners_ = function() {\n  if (this.manualListenerTimer_) {\n    clearInterval(this.manualListenerTimer_);\n    this.manualListenerTimer_ = null;\n  }\n};\n\n\n/**\n * Stops all storage event listeners.\n * @private\n */\nfireauth.authStorage.Manager.prototype.stopListeners_ = function() {\n  this.getStorage_(fireauth.authStorage.Persistence.LOCAL)\n      .removeStorageListener(this.storageChangeEventHandler_);\n  this.stopManualListeners_();\n};\n\n\n/**\n * @param {!goog.events.BrowserEvent|!Array<string>} data The storage event\n *     triggered or the array of keys modified.\n * @private\n */\nfireauth.authStorage.Manager.prototype.storageChangeEvent_ = function(data) {\n  if (data && data.getBrowserEvent) {\n    var event = /** @type {!goog.events.BrowserEvent} */ (data);\n    var key = event.getBrowserEvent().key;\n    // Key would be null in some situations, like when localStorage is cleared\n    // from the browser developer tools.\n    if (key == null) {\n      // For all keys of interest.\n      for (var keyName in this.listeners_) {\n        // Check if something changed in this key's real value.\n        var storedValue = this.localMap_[keyName];\n        // localStorage returns null when a field is not found.\n        if (typeof storedValue === 'undefined') {\n          storedValue = null;\n        }\n        var realValue = goog.global['localStorage']['getItem'](keyName);\n        if (realValue !== storedValue) {\n          // Update local map with real value.\n          this.localMap_[keyName] = realValue;\n          // Trigger that key's listener.\n          this.callListeners_(keyName);\n        }\n      }\n      return;\n    }\n    // Check if the key is Firebase Auth related, otherwise ignore.\n    if (key.indexOf(this.namespace_ + this.separator_) != 0 ||\n        // Ignore keys that have no listeners.\n        !this.listeners_[key]) {\n      return;\n    }\n    // Check the mechanism how this event was detected.\n    // The first event will dictate the mechanism to be used.\n    // Do not use hasOwnProperty('poll') as poll gets obfuscated.\n    if (typeof event.getBrowserEvent().poll !== 'undefined') {\n      // Environment detects storage changes via polling.\n      // Remove storage event listener to prevent possible event duplication.\n      this.getStorage_(fireauth.authStorage.Persistence.LOCAL)\n          .removeStorageListener(this.storageChangeEventHandler_);\n    } else {\n      // Environment detects storage changes via storage event listener.\n      // Remove polling listener to prevent possible event duplication.\n      this.stopManualListeners_();\n    }\n    // Safari embedded iframe. Storage event will trigger with the delta changes\n    // but no changes will be applied to the iframe localStorage.\n    if (this.safariLocalStorageNotSynced_) {\n      // Get current iframe page value, old value and new value.\n      var currentValue = goog.global['localStorage']['getItem'](key);\n      var newValue = event.getBrowserEvent().newValue;\n      // Value not synchronized, synchronize manually.\n      if (newValue !== currentValue) {\n        if (newValue !== null) {\n          // Value changed from current value.\n          goog.global['localStorage']['setItem'](key, newValue);\n        } else {\n          // Current value deleted.\n          goog.global['localStorage']['removeItem'](key);\n        }\n      } else {\n        // Already detected and processed, do not trigger listeners again.\n        if (this.localMap_[key] === newValue &&\n            // Real storage event.\n            typeof event.getBrowserEvent().poll === 'undefined') {\n          return;\n        }\n      }\n    }\n    var self = this;\n    var triggerListeners = function() {\n      // Keep local map up to date in case storage event is triggered before\n      // poll.\n      if (typeof event.getBrowserEvent().poll === 'undefined' &&\n          self.localMap_[key] === goog.global['localStorage']['getItem'](key)) {\n        // Real storage event which has already been detected, do nothing.\n        // This seems to trigger in some IE browsers for some reason.\n        return;\n      }\n      self.localMap_[key] = goog.global['localStorage']['getItem'](key);\n      self.callListeners_(key);\n    };\n    if (fireauth.util.isIe10() &&\n        goog.global['localStorage']['getItem'](key) !==\n        event.getBrowserEvent().newValue &&\n        event.getBrowserEvent().newValue !== event.getBrowserEvent().oldValue) {\n      // IE 10 has this weird bug where a storage event would trigger with the\n      // correct key, oldValue and newValue but localStorage.getItem(key) does\n      // not yield the updated value until a few milliseconds. This ensures this\n      // recovers from that situation.\n      setTimeout(\n          triggerListeners, fireauth.authStorage.IE10_LOCAL_STORAGE_SYNC_DELAY);\n    } else {\n      triggerListeners();\n    }\n  } else {\n    var keys = /** @type {!Array<string>} */ (data);\n    goog.array.forEach(keys, goog.bind(this.callListeners_, this));\n  }\n};\n\n\n/**\n * Calls all listeners for specified storage event key.\n * @param {string} key The storage event key whose listeners are to be run.\n * @private\n */\nfireauth.authStorage.Manager.prototype.callListeners_ = function(key) {\n  if (this.listeners_[key]) {\n    goog.array.forEach(\n        this.listeners_[key],\n        function(listener) {\n          listener();\n        });\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the fireauth.storage.AuthEventManager class used by\n * the iframe to retrieve and delete Auth events triggered through an OAuth\n * flow.\n */\n\ngoog.provide('fireauth.storage.AuthEventManager');\ngoog.provide('fireauth.storage.AuthEventManager.Keys');\n\ngoog.require('fireauth.AuthEvent');\ngoog.require('fireauth.authStorage');\n\n\n/**\n * Defines the Auth event storage manager. It provides methods to\n * load and delete Auth events as well as listen to external OAuth changes on\n * them.\n * @param {string} appId The Auth event's application ID.\n * @param {?fireauth.authStorage.Manager=} opt_manager The underlying storage\n *     manager to use. If none is provided, the default global instance is used.\n * @constructor @struct @final\n */\nfireauth.storage.AuthEventManager = function(appId, opt_manager) {\n  /** @const @private{string} appId The Auth event's application ID. */\n  this.appId_ = appId;\n  /**\n   * @const @private{!fireauth.authStorage.Manager} The underlying storage\n   *     manager.\n   */\n  this.manager_ = opt_manager || fireauth.authStorage.Manager.getInstance();\n};\n\n\n/**\n * Valid keys for Auth event manager data.\n * @enum {!fireauth.authStorage.Key}\n */\nfireauth.storage.AuthEventManager.Keys = {\n  AUTH_EVENT: {\n    name: 'authEvent',\n    persistent: fireauth.authStorage.Persistence.LOCAL\n  },\n  REDIRECT_EVENT: {\n    name: 'redirectEvent',\n    persistent: fireauth.authStorage.Persistence.SESSION\n  }\n};\n\n\n/**\n * @return {!goog.Promise<?fireauth.AuthEvent>} A promise that resolves on\n *     success with the stored Auth event.\n */\nfireauth.storage.AuthEventManager.prototype.getAuthEvent = function() {\n  return this.manager_.get(\n      fireauth.storage.AuthEventManager.Keys.AUTH_EVENT, this.appId_)\n      .then(function(response) {\n        return fireauth.AuthEvent.fromPlainObject(response);\n      });\n};\n\n\n/**\n * Removes the identifier's Auth event if it exists.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.AuthEventManager.prototype.removeAuthEvent = function() {\n  return this.manager_.remove(\n      fireauth.storage.AuthEventManager.Keys.AUTH_EVENT, this.appId_);\n};\n\n\n/**\n * Adds a listener to Auth event for App ID provided.\n * @param {!function()} listener The listener to run on Auth event.\n */\nfireauth.storage.AuthEventManager.prototype.addAuthEventListener =\n    function(listener) {\n  this.manager_.addListener(\n      fireauth.storage.AuthEventManager.Keys.AUTH_EVENT, this.appId_, listener);\n};\n\n\n/**\n * Removes a listener to Auth event for App ID provided.\n * @param {!function()} listener The listener to run on Auth event.\n */\nfireauth.storage.AuthEventManager.prototype.removeAuthEventListener =\n    function(listener) {\n  this.manager_.removeListener(\n      fireauth.storage.AuthEventManager.Keys.AUTH_EVENT, this.appId_, listener);\n};\n\n\n/**\n * @return {!goog.Promise<?fireauth.AuthEvent>} A promise that resolves on\n *     success with the stored redirect Auth event.\n */\nfireauth.storage.AuthEventManager.prototype.getRedirectEvent =\n    function() {\n  return this.manager_.get(\n      fireauth.storage.AuthEventManager.Keys.REDIRECT_EVENT,\n      this.appId_).then(function(response) {\n        return fireauth.AuthEvent.fromPlainObject(response);\n      });\n};\n\n\n/**\n * Removes the identifier's redirect Auth event if it exists.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.AuthEventManager.prototype.removeRedirectEvent = function() {\n  return this.manager_.remove(\n      fireauth.storage.AuthEventManager.Keys.REDIRECT_EVENT, this.appId_);\n};\n","// Copyright 2012 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Base class for SHA-2 cryptographic hash.\n *\n * Variable names follow the notation in FIPS PUB 180-3:\n * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\n *\n * Some code similar to SHA1 are borrowed from sha1.js written by mschilder@.\n *\n */\n\ngoog.provide('goog.crypt.Sha2');\n\ngoog.require('goog.array');\ngoog.require('goog.asserts');\ngoog.require('goog.crypt.Hash');\n\n\n\n/**\n * SHA-2 cryptographic hash constructor.\n * This constructor should not be used directly to create the object. Rather,\n * one should use the constructor of the sub-classes.\n * @param {number} numHashBlocks The size of output in 16-byte blocks.\n * @param {!Array<number>} initHashBlocks The hash-specific initialization\n * @constructor\n * @extends {goog.crypt.Hash}\n * @struct\n */\ngoog.crypt.Sha2 = function(numHashBlocks, initHashBlocks) {\n  goog.crypt.Sha2.base(this, 'constructor');\n\n  this.blockSize = goog.crypt.Sha2.BLOCKSIZE_;\n\n  /**\n   * A chunk holding the currently processed message bytes. Once the chunk has\n   * 64 bytes, we feed it into computeChunk_ function and reset this.chunk_.\n   * @private {!Array<number>|!Uint8Array}\n   */\n  this.chunk_ = goog.global['Uint8Array'] ? new Uint8Array(this.blockSize) :\n                                            new Array(this.blockSize);\n\n  /**\n   * Current number of bytes in this.chunk_.\n   * @private {number}\n   */\n  this.inChunk_ = 0;\n\n  /**\n   * Total number of bytes in currently processed message.\n   * @private {number}\n   */\n  this.total_ = 0;\n\n\n  /**\n   * Holds the previous values of accumulated hash a-h in the computeChunk_\n   * function.\n   * @private {!Array<number>|!Int32Array}\n   */\n  this.hash_ = [];\n\n  /**\n   * The number of output hash blocks (each block is 4 bytes long).\n   * @private {number}\n   */\n  this.numHashBlocks_ = numHashBlocks;\n\n  /**\n   * @private {!Array<number>} initHashBlocks\n   */\n  this.initHashBlocks_ = initHashBlocks;\n\n  /**\n   * Temporary array used in chunk computation.  Allocate here as a\n   * member rather than as a local within computeChunk_() as a\n   * performance optimization to reduce the number of allocations and\n   * reduce garbage collection.\n   * @private {!Int32Array|!Array<number>}\n   */\n  this.w_ = goog.global['Int32Array'] ? new Int32Array(64) : new Array(64);\n\n  if (!goog.isDef(goog.crypt.Sha2.Kx_)) {\n    // This is the first time this constructor has been called.\n    if (goog.global['Int32Array']) {\n      // Typed arrays exist\n      goog.crypt.Sha2.Kx_ = new Int32Array(goog.crypt.Sha2.K_);\n    } else {\n      // Typed arrays do not exist\n      goog.crypt.Sha2.Kx_ = goog.crypt.Sha2.K_;\n    }\n  }\n\n  this.reset();\n};\ngoog.inherits(goog.crypt.Sha2, goog.crypt.Hash);\n\n\n/**\n * The block size\n * @private {number}\n */\ngoog.crypt.Sha2.BLOCKSIZE_ = 512 / 8;\n\n\n/**\n * Contains data needed to pad messages less than BLOCK_SIZE_ bytes.\n * @private {!Array<number>}\n */\ngoog.crypt.Sha2.PADDING_ = goog.array.concat(\n    128, goog.array.repeat(0, goog.crypt.Sha2.BLOCKSIZE_ - 1));\n\n\n/** @override */\ngoog.crypt.Sha2.prototype.reset = function() {\n  this.inChunk_ = 0;\n  this.total_ = 0;\n  this.hash_ = goog.global['Int32Array'] ?\n      new Int32Array(this.initHashBlocks_) :\n      goog.array.clone(this.initHashBlocks_);\n};\n\n\n/**\n * Helper function to compute the hashes for a given 512-bit message chunk.\n * @private\n */\ngoog.crypt.Sha2.prototype.computeChunk_ = function() {\n  var chunk = this.chunk_;\n  goog.asserts.assert(chunk.length == this.blockSize);\n  var rounds = 64;\n\n  // Divide the chunk into 16 32-bit-words.\n  var w = this.w_;\n  var index = 0;\n  var offset = 0;\n  while (offset < chunk.length) {\n    w[index++] = (chunk[offset] << 24) | (chunk[offset + 1] << 16) |\n        (chunk[offset + 2] << 8) | (chunk[offset + 3]);\n    offset = index * 4;\n  }\n\n  // Extend the w[] array to be the number of rounds.\n  for (var i = 16; i < rounds; i++) {\n    var w_15 = w[i - 15] | 0;\n    var s0 = ((w_15 >>> 7) | (w_15 << 25)) ^ ((w_15 >>> 18) | (w_15 << 14)) ^\n        (w_15 >>> 3);\n    var w_2 = w[i - 2] | 0;\n    var s1 = ((w_2 >>> 17) | (w_2 << 15)) ^ ((w_2 >>> 19) | (w_2 << 13)) ^\n        (w_2 >>> 10);\n\n    // As a performance optimization, construct the sum a pair at a time\n    // with casting to integer (bitwise OR) to eliminate unnecessary\n    // double<->integer conversions.\n    var partialSum1 = ((w[i - 16] | 0) + s0) | 0;\n    var partialSum2 = ((w[i - 7] | 0) + s1) | 0;\n    w[i] = (partialSum1 + partialSum2) | 0;\n  }\n\n  var a = this.hash_[0] | 0;\n  var b = this.hash_[1] | 0;\n  var c = this.hash_[2] | 0;\n  var d = this.hash_[3] | 0;\n  var e = this.hash_[4] | 0;\n  var f = this.hash_[5] | 0;\n  var g = this.hash_[6] | 0;\n  var h = this.hash_[7] | 0;\n  for (var i = 0; i < rounds; i++) {\n    var S0 = ((a >>> 2) | (a << 30)) ^ ((a >>> 13) | (a << 19)) ^\n        ((a >>> 22) | (a << 10));\n    var maj = ((a & b) ^ (a & c) ^ (b & c));\n    var t2 = (S0 + maj) | 0;\n    var S1 = ((e >>> 6) | (e << 26)) ^ ((e >>> 11) | (e << 21)) ^\n        ((e >>> 25) | (e << 7));\n    var ch = ((e & f) ^ ((~e) & g));\n\n    // As a performance optimization, construct the sum a pair at a time\n    // with casting to integer (bitwise OR) to eliminate unnecessary\n    // double<->integer conversions.\n    var partialSum1 = (h + S1) | 0;\n    var partialSum2 = (ch + (goog.crypt.Sha2.Kx_[i] | 0)) | 0;\n    var partialSum3 = (partialSum2 + (w[i] | 0)) | 0;\n    var t1 = (partialSum1 + partialSum3) | 0;\n\n    h = g;\n    g = f;\n    f = e;\n    e = (d + t1) | 0;\n    d = c;\n    c = b;\n    b = a;\n    a = (t1 + t2) | 0;\n  }\n\n  this.hash_[0] = (this.hash_[0] + a) | 0;\n  this.hash_[1] = (this.hash_[1] + b) | 0;\n  this.hash_[2] = (this.hash_[2] + c) | 0;\n  this.hash_[3] = (this.hash_[3] + d) | 0;\n  this.hash_[4] = (this.hash_[4] + e) | 0;\n  this.hash_[5] = (this.hash_[5] + f) | 0;\n  this.hash_[6] = (this.hash_[6] + g) | 0;\n  this.hash_[7] = (this.hash_[7] + h) | 0;\n};\n\n\n/** @override */\ngoog.crypt.Sha2.prototype.update = function(message, opt_length) {\n  if (!goog.isDef(opt_length)) {\n    opt_length = message.length;\n  }\n  // Process the message from left to right up to |opt_length| bytes.\n  // When we get a 512-bit chunk, compute the hash of it and reset\n  // this.chunk_. The message might not be multiple of 512 bits so we\n  // might end up with a chunk that is less than 512 bits. We store\n  // such partial chunk in this.chunk_ and it will be filled up later\n  // in digest().\n  var n = 0;\n  var inChunk = this.inChunk_;\n\n  // The input message could be either byte array of string.\n  if (goog.isString(message)) {\n    while (n < opt_length) {\n      this.chunk_[inChunk++] = message.charCodeAt(n++);\n      if (inChunk == this.blockSize) {\n        this.computeChunk_();\n        inChunk = 0;\n      }\n    }\n  } else if (goog.isArrayLike(message)) {\n    while (n < opt_length) {\n      var b = message[n++];\n      if (!('number' == typeof b && 0 <= b && 255 >= b && b == (b | 0))) {\n        throw new Error('message must be a byte array');\n      }\n      this.chunk_[inChunk++] = b;\n      if (inChunk == this.blockSize) {\n        this.computeChunk_();\n        inChunk = 0;\n      }\n    }\n  } else {\n    throw new Error('message must be string or array');\n  }\n\n  // Record the current bytes in chunk to support partial update.\n  this.inChunk_ = inChunk;\n\n  // Record total message bytes we have processed so far.\n  this.total_ += opt_length;\n};\n\n\n/** @override */\ngoog.crypt.Sha2.prototype.digest = function() {\n  var digest = [];\n  var totalBits = this.total_ * 8;\n\n  // Append pad 0x80 0x00*.\n  if (this.inChunk_ < 56) {\n    this.update(goog.crypt.Sha2.PADDING_, 56 - this.inChunk_);\n  } else {\n    this.update(\n        goog.crypt.Sha2.PADDING_, this.blockSize - (this.inChunk_ - 56));\n  }\n\n  // Append # bits in the 64-bit big-endian format.\n  for (var i = 63; i >= 56; i--) {\n    this.chunk_[i] = totalBits & 255;\n    totalBits /= 256;  // Don't use bit-shifting here!\n  }\n  this.computeChunk_();\n\n  // Finally, output the result digest.\n  var n = 0;\n  for (var i = 0; i < this.numHashBlocks_; i++) {\n    for (var j = 24; j >= 0; j -= 8) {\n      digest[n++] = ((this.hash_[i] >> j) & 255);\n    }\n  }\n  return digest;\n};\n\n\n/**\n * Constants used in SHA-2.\n * @const\n * @private {!Array<number>}\n */\ngoog.crypt.Sha2.K_ = [\n  0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1,\n  0x923f82a4, 0xab1c5ed5, 0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3,\n  0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174, 0xe49b69c1, 0xefbe4786,\n  0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,\n  0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147,\n  0x06ca6351, 0x14292967, 0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13,\n  0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85, 0xa2bfe8a1, 0xa81a664b,\n  0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,\n  0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a,\n  0x5b9cca4f, 0x682e6ff3, 0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208,\n  0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2\n];\n\n\n/**\n * Sha2.K as an Int32Array if this JS supports typed arrays; otherwise,\n * the same array as Sha2.K.\n *\n * The compiler cannot remove an Int32Array, even if it is not needed\n * (There are certain cases where creating an Int32Array is not\n * side-effect free).  Instead, the first time we construct a Sha2\n * instance, we convert or assign Sha2.K as appropriate.\n * @private {undefined|!Array<number>|!Int32Array}\n */\ngoog.crypt.Sha2.Kx_;\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the fireauth.storage.OAuthHandlerManager class which\n * provides utilities to the OAuth handler widget to set Auth events after an\n * IDP sign in attempt and to store state during the OAuth handshake with IDP.\n */\n\ngoog.provide('fireauth.storage.OAuthHandlerManager');\n\ngoog.require('fireauth.AuthEvent');\ngoog.require('fireauth.OAuthHelperState');\ngoog.require('fireauth.authStorage');\ngoog.require('fireauth.storage.AuthEventManager.Keys');\n\n\n/**\n * Defines the OAuth handler storage manager. It provides methods to\n * store, load and delete OAuth handler widget state, properties and setting\n * Auth events.\n * @param {?fireauth.authStorage.Manager=} opt_manager The underlying storage\n *     manager to use. If none is provided, the default global instance is used.\n * @constructor @struct @final\n */\nfireauth.storage.OAuthHandlerManager = function(opt_manager) {\n  /**\n   * @const @private{!fireauth.authStorage.Manager} The underlying storage\n   *     manager.\n   */\n  this.manager_ = opt_manager || fireauth.authStorage.Manager.getInstance();\n};\n\n\n/**\n * Valid keys for OAuth handler manager data.\n * @private @enum {!fireauth.authStorage.Key}\n */\nfireauth.storage.OAuthHandlerManager.Keys_ = {\n  OAUTH_HELPER_STATE: {\n    name: 'oauthHelperState',\n    persistent: fireauth.authStorage.Persistence.SESSION\n  },\n  SESSION_ID: {\n    name: 'sessionId',\n    persistent: fireauth.authStorage.Persistence.SESSION\n  }\n};\n\n\n/**\n * @param {string} appId The Auth state's application ID.\n * @return {!goog.Promise<?string|undefined>} A promise that resolves on success\n *     with the stored session ID.\n */\nfireauth.storage.OAuthHandlerManager.prototype.getSessionId = function(appId) {\n  return this.manager_.get(\n      fireauth.storage.OAuthHandlerManager.Keys_.SESSION_ID, appId);\n};\n\n\n/**\n * Removes the session ID string if it exists.\n * @param {string} appId The Auth state's application ID.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.OAuthHandlerManager.prototype.removeSessionId =\n    function(appId) {\n  return this.manager_.remove(\n      fireauth.storage.OAuthHandlerManager.Keys_.SESSION_ID, appId);\n};\n\n\n/**\n * Stores the session ID string.\n * @param {string} appId The Auth state's application ID.\n * @param {string} sessionId The session ID string to store.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.OAuthHandlerManager.prototype.setSessionId =\n    function(appId, sessionId) {\n  return this.manager_.set(\n      fireauth.storage.OAuthHandlerManager.Keys_.SESSION_ID, sessionId, appId);\n};\n\n\n/**\n * @return {!goog.Promise<?fireauth.OAuthHelperState>} A promise that resolves\n *     on success with the stored OAuth helper state.\n */\nfireauth.storage.OAuthHandlerManager.prototype.getOAuthHelperState =\n    function() {\n  return this.manager_.get(\n      fireauth.storage.OAuthHandlerManager.Keys_.OAUTH_HELPER_STATE)\n      .then(function(response) {\n        return fireauth.OAuthHelperState.fromPlainObject(response);\n      });\n};\n\n\n/**\n * Removes the current OAuth helper state if it exists.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.OAuthHandlerManager.prototype.removeOAuthHelperState =\n    function() {\n  return this.manager_.remove(\n      fireauth.storage.OAuthHandlerManager.Keys_.OAUTH_HELPER_STATE);\n};\n\n\n/**\n * Stores the current OAuth helper state.\n * @param {!fireauth.OAuthHelperState} state The OAuth helper state.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.OAuthHandlerManager.prototype.setOAuthHelperState =\n    function(state) {\n  return this.manager_.set(\n      fireauth.storage.OAuthHandlerManager.Keys_.OAUTH_HELPER_STATE,\n      state.toPlainObject());\n};\n\n\n/**\n * Stores the Auth event for specified identifier.\n * @param {string} appId The Auth state's application ID.\n * @param {!fireauth.AuthEvent} authEvent The Auth event.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.OAuthHandlerManager.prototype.setAuthEvent =\n    function(appId, authEvent) {\n  return this.manager_.set(\n      fireauth.storage.AuthEventManager.Keys.AUTH_EVENT,\n      authEvent.toPlainObject(),\n      appId);\n};\n\n\n/**\n * Stores the redirect Auth event for specified identifier.\n * @param {string} appId The Auth state's application ID.\n * @param {!fireauth.AuthEvent} authEvent The redirect Auth event.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.OAuthHandlerManager.prototype.setRedirectEvent =\n    function(appId, authEvent) {\n  return this.manager_.set(\n      fireauth.storage.AuthEventManager.Keys.REDIRECT_EVENT,\n      authEvent.toPlainObject(),\n      appId);\n};\n","// Copyright 2011 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Abstract cryptographic hash interface.\n *\n * See goog.crypt.Sha1 and goog.crypt.Md5 for sample implementations.\n *\n */\n\ngoog.provide('goog.crypt.Hash');\n\n\n\n/**\n * Create a cryptographic hash instance.\n *\n * @constructor\n * @struct\n */\ngoog.crypt.Hash = function() {\n  /**\n   * The block size for the hasher.\n   * @type {number}\n   */\n  this.blockSize = -1;\n};\n\n\n/**\n * Resets the internal accumulator.\n */\ngoog.crypt.Hash.prototype.reset = goog.abstractMethod;\n\n\n/**\n * Adds a byte array (array with values in [0-255] range) or a string (must\n * only contain 8-bit, i.e., Latin1 characters) to the internal accumulator.\n *\n * Many hash functions operate on blocks of data and implement optimizations\n * when a full chunk of data is readily available. Hence it is often preferable\n * to provide large chunks of data (a kilobyte or more) than to repeatedly\n * call the update method with few tens of bytes. If this is not possible, or\n * not feasible, it might be good to provide data in multiplies of hash block\n * size (often 64 bytes). Please see the implementation and performance tests\n * of your favourite hash.\n *\n * @param {Array<number>|Uint8Array|string} bytes Data used for the update.\n * @param {number=} opt_length Number of bytes to use.\n */\ngoog.crypt.Hash.prototype.update = goog.abstractMethod;\n\n\n/**\n * @return {!Array<number>} The finalized hash computed\n *     from the internal accumulator.\n */\ngoog.crypt.Hash.prototype.digest = goog.abstractMethod;\n","// Copyright 2012 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview SHA-256 cryptographic hash.\n *\n * Usage:\n *   var sha256 = new goog.crypt.Sha256();\n *   sha256.update(bytes);\n *   var hash = sha256.digest();\n *\n */\n\ngoog.provide('goog.crypt.Sha256');\n\ngoog.require('goog.crypt.Sha2');\n\n\n\n/**\n * SHA-256 cryptographic hash constructor.\n *\n * @constructor\n * @extends {goog.crypt.Sha2}\n * @final\n * @struct\n */\ngoog.crypt.Sha256 = function() {\n  goog.crypt.Sha256.base(\n      this, 'constructor', 8, goog.crypt.Sha256.INIT_HASH_BLOCK_);\n};\ngoog.inherits(goog.crypt.Sha256, goog.crypt.Sha2);\n\n\n/** @private {!Array<number>} */\ngoog.crypt.Sha256.INIT_HASH_BLOCK_ = [\n  0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a, 0x510e527f, 0x9b05688c,\n  0x1f83d9ab, 0x5be0cd19\n];\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines Cordova utility and helper functions.\n * The following plugins must be installed:\n * cordova plugin add cordova-plugin-buildinfo\n * cordova plugin add cordova-universal-links-plugin-fix\n * cordova plugin add cordova-plugin-browsertab\n * cordova plugin add cordova-plugin-inappbrowser\n * iOS custom scheme support:\n * cordova plugin add cordova-plugin-customurlscheme --variable \\\n * URL_SCHEME=com.firebase.example\n * Console logging in iOS:\n * cordova plugin add cordova-plugin-console\n */\n\ngoog.provide('fireauth.CordovaHandler');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.AuthEvent');\ngoog.require('fireauth.AuthProvider');\ngoog.require('fireauth.DynamicLink');\ngoog.require('fireauth.OAuthSignInHandler');\ngoog.require('fireauth.UniversalLinkSubscriber');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.iframeclient.IfcHandler');\ngoog.require('fireauth.storage.AuthEventManager');\ngoog.require('fireauth.storage.OAuthHandlerManager');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.Timer');\ngoog.require('goog.Uri');\ngoog.require('goog.array');\ngoog.require('goog.crypt');\ngoog.require('goog.crypt.Sha256');\n\n\n/**\n * Cordova environment utility and helper functions.\n * @param {string} authDomain The application authDomain.\n * @param {string} apiKey The API key.\n * @param {string} appName The App name.\n * @param {?string=} opt_clientVersion The optional client version string.\n * @param {number=} opt_initialTimeout Initial Auth event timeout.\n * @param {number=} opt_redirectTimeout Redirect result timeout.\n * @param {?string=} opt_endpointId The endpoint ID (staging, test Gaia, etc).\n * @constructor\n * @implements {fireauth.OAuthSignInHandler}\n */\nfireauth.CordovaHandler = function(authDomain, apiKey, appName,\n    opt_clientVersion, opt_initialTimeout, opt_redirectTimeout,\n    opt_endpointId) {\n  /** @private {string} The application authDomain. */\n  this.authDomain_ = authDomain;\n  /** @private {string} The application API key. */\n  this.apiKey_ = apiKey;\n  /** @private {string} The application name. */\n  this.appName_ = appName;\n  /** @private {?string} The client version */\n  this.clientVersion_ = opt_clientVersion || null;\n  /** @private {?string} The Auth endpoint ID. */\n  this.endpointId_ = opt_endpointId || null;\n  /** @private {string} The storage key. */\n  this.storageKey_ = fireauth.util.createStorageKey(apiKey, appName);\n  /**\n   * @private {!fireauth.storage.OAuthHandlerManager} The OAuth handler\n   *     storage manager reference, used to save a partial Auth event when\n   *     redirect operation is triggered.\n   */\n  this.savePartialEventManager_ = new fireauth.storage.OAuthHandlerManager();\n  /**\n   * @private {!fireauth.storage.AuthEventManager} The Auth event storage\n   *     manager reference. This is used to get back the saved partial Auth\n   *     event and then delete on successful handling.\n   */\n  this.getAndDeletePartialEventManager_ =\n      new fireauth.storage.AuthEventManager(this.storageKey_);\n  /**\n   * @private {?goog.Promise<!fireauth.AuthEvent>} A promise that resolves with\n   *     the OAuth redirect URL response.\n   */\n  this.initialAuthEvent_ = null;\n  /**\n   * @private {!Array<!function(?fireauth.AuthEvent)>} The Auth event\n   *     listeners.\n   */\n  this.authEventListeners_ = [];\n  /** @private {number} The initial Auth event timeout. */\n  this.initialTimeout_ = opt_initialTimeout ||\n      fireauth.CordovaHandler.INITIAL_TIMEOUT_MS_;\n  /** @private {number} The return to app after redirect timeout. */\n  this.redirectTimeout_ = opt_redirectTimeout ||\n      fireauth.CordovaHandler.REDIRECT_TIMEOUT_MS_;\n  /**\n   * @private {?goog.Promise} The last pending redirect promise. This is null if\n   *     already completed.\n   */\n  this.pendingRedirect_ = null;\n  /**\n   * @private {?Object} The inAppBrowser reference window if available. This is\n   *     relevant to iOS 7 and 8 embedded webviews.\n   */\n  this.inAppBrowserRef_ = null;\n};\n\n\n/**\n * The total number of chars used to generate the session ID string.\n * @const {number}\n * @private\n */\nfireauth.CordovaHandler.SESSION_ID_TOTAL_CHARS_ = 20;\n\n\n/**\n * The default initial Auth event timeout in ms.\n * @const {number}\n * @private\n */\nfireauth.CordovaHandler.INITIAL_TIMEOUT_MS_ = 500;\n\n\n/**\n * The default timeout in milliseconds for a pending redirect operation after\n * returning to the app.\n * @const {number}\n * @private\n */\nfireauth.CordovaHandler.REDIRECT_TIMEOUT_MS_ = 2000;\n\n\n/**\n * Constructs a Cordova configuration error message.\n * @param {?string=} opt_message The optional error message to be used. This\n *     will override the existing default one.\n * @return {!fireauth.AuthError} The Cordova invalid configuration error with\n *     the custom message provided. If no message is provided, the default\n *     message is used.\n * @private\n */\nfireauth.CordovaHandler.getError_ = function(opt_message) {\n  return new fireauth.AuthError(\n      fireauth.authenum.Error.INVALID_CORDOVA_CONFIGURATION,\n      opt_message);\n};\n\n\n/**\n * Initializes the Cordova environment and waits for it to be ready.\n * @return {!goog.Promise} A promise that resolves if the current environment is\n *     a Cordova environment.\n * @override\n */\nfireauth.CordovaHandler.prototype.initializeAndWait = function() {\n  if (this.isReady_) {\n    return this.isReady_;\n  }\n  this.isReady_ = fireauth.util.checkIfCordova().then(function() {\n    // Check all dependencies installed.\n    // Note that cordova-universal-links-plugin has been abandoned.\n    // A fork with latest fixes is available at:\n    // https://www.npmjs.com/package/cordova-universal-links-plugin-fix\n    var subscribe = fireauth.util.getObjectRef(\n        'universalLinks.subscribe', goog.global);\n    if (typeof subscribe !== 'function') {\n      throw fireauth.CordovaHandler.getError_(\n          'cordova-universal-links-plugin-fix is not installed');\n    }\n    // https://www.npmjs.com/package/cordova-plugin-buildinfo\n    var appIdentifier =\n        fireauth.util.getObjectRef('BuildInfo.packageName', goog.global);\n    if (typeof appIdentifier === 'undefined') {\n      throw fireauth.CordovaHandler.getError_(\n          'cordova-plugin-buildinfo is not installed');\n    }\n    // https://github.com/google/cordova-plugin-browsertab\n    var openUrl = fireauth.util.getObjectRef(\n        'cordova.plugins.browsertab.openUrl', goog.global);\n    if (typeof openUrl !== 'function') {\n      throw fireauth.CordovaHandler.getError_(\n          'cordova-plugin-browsertab is not installed');\n    }\n    // https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-inappbrowser/\n    var openInAppBrowser = fireauth.util.getObjectRef(\n        'cordova.InAppBrowser.open', goog.global);\n    if (typeof openInAppBrowser !== 'function') {\n      throw fireauth.CordovaHandler.getError_(\n          'cordova-plugin-inappbrowser is not installed');\n    }\n  }, function(error) {\n    // If not supported.\n    throw new fireauth.AuthError(fireauth.authenum.Error.CORDOVA_NOT_READY);\n  });\n  return this.isReady_;\n};\n\n\n/**\n * Generates a session ID. Used to prevent session fixation attacks.\n * @param {number} numOfChars The number of characters to generate.\n * @return {string} The generated session ID.\n * @private\n */\nfireauth.CordovaHandler.prototype.generateSessionId_ = function(numOfChars) {\n  var chars = [];\n  var allowedChars =\n      '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n  while (numOfChars > 0) {\n    var index = Math.floor(Math.random() * allowedChars.length);\n    chars.push(allowedChars.charAt(index));\n    numOfChars--;\n  }\n  return chars.join('');\n};\n\n\n/**\n * Computes the sha256 hash of a session ID.\n * @param {string} str The string to hash.\n * @return {string} The hashed string.\n * @private\n */\nfireauth.CordovaHandler.prototype.computeSecureHash_ = function(str) {\n  // sha256 the sessionId. This will be passed to the OAuth backend.\n  // When exchanging the Auth code with a firebase ID token, the raw session ID\n  // needs to be provided.\n  var sha256 = new goog.crypt.Sha256();\n  sha256.update(str);\n  return goog.crypt.byteArrayToHex(sha256.digest());\n};\n\n\n/**\n * Waits for popup window to close and time out if the result is unhandled.\n * This is not supported in Cordova.\n * @param {!Window} popupWin The popup window.\n * @param {!function(!fireauth.AuthError)} onError The on error callback.\n * @return {!goog.Promise}\n * @override\n */\nfireauth.CordovaHandler.prototype.startPopupTimeout =\n    function(popupWin, onError, timeoutDuration) {\n  // Not supported operation, check processPopup for details.\n  onError(new fireauth.AuthError(\n      fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n  return goog.Promise.resolve();\n};\n\n\n/**\n * Processes the popup request. This is not supported in Cordova.\n * @param {?Window} popupWin The popup window reference.\n * @param {!fireauth.AuthEvent.Type} mode The Auth event type.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @param {function()} onInitialize The function to call on initialization.\n * @param {function(*)} onError The function to call on error.\n * @param {string=} opt_eventId The optional event ID.\n * @param {boolean=} opt_alreadyRedirected Whether popup is already redirected\n *     to final destination.\n * @param {?string=} opt_tenantId The optional tenant ID.\n * @return {!goog.Promise} The popup window promise.\n * @override\n */\nfireauth.CordovaHandler.prototype.processPopup = function(\n    popupWin,\n    mode,\n    provider,\n    onInitialize,\n    onError,\n    opt_eventId,\n    opt_alreadyRedirected,\n    opt_tenantId) {\n  // Popups not supported in Cordova as the activity could be destroyed in\n  // some cases. Redirect works better as getRedirectResult can be used as a\n  // fallback to get the result when the activity is detroyed.\n  return goog.Promise.reject(new fireauth.AuthError(\n      fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n};\n\n\n/**\n * @return {boolean} Whether the handler will unload the current page on\n *     redirect operations.\n * @override\n */\nfireauth.CordovaHandler.prototype.unloadsOnRedirect = function() {\n  // Does not necessarily unload the page on redirect.\n  return false;\n};\n\n\n/**\n * @return {boolean} Whether the handler should be initialized early.\n * @override\n */\nfireauth.CordovaHandler.prototype.shouldBeInitializedEarly = function() {\n  // Initialize early to detect incoming link. This is not an expensive\n  // operation, unlike embedding an iframe.\n  return true;\n};\n\n\n/**\n * @return {boolean} Whether the sign-in handler in the current environment\n *     has volatile session storage.\n * @override\n */\nfireauth.CordovaHandler.prototype.hasVolatileStorage = function() {\n  // An activity can be destroyed and thereby sessionStorage wiped out.\n  return true;\n};\n\n\n/**\n * Processes the OAuth redirect request. Will resolve when the OAuth response\n * is detected in the incoming link and the corresponding Auth event is\n * triggered.\n * @param {!fireauth.AuthEvent.Type} mode The Auth event type.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @param {?string=} opt_eventId The optional event ID.\n * @param {?string=} opt_tenantId The optional tenant ID.\n * @return {!goog.Promise}\n * @override\n */\nfireauth.CordovaHandler.prototype.processRedirect = function(\n    mode,\n    provider,\n    opt_eventId,\n    opt_tenantId) {\n  // If there is already a pending redirect, throw an error.\n  if (this.pendingRedirect_) {\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.REDIRECT_OPERATION_PENDING));\n  }\n  var self = this;\n  var doc = goog.global.document;\n  // On close timer promise.\n  var onClose = null;\n  // Auth event detection callback;\n  var authEventCallback = null;\n  // On resume (return from the redirect operation).\n  var onResume = null;\n  // On visibility change used to detect return to app in certain versions,\n  // currently iOS.\n  var onVisibilityChange = null;\n  // When the processRedirect promise completes, clean up any remaining\n  // temporary listeners and timers.\n  var cleanup = function() {\n    // Remove current resume listener.\n    if (onResume) {\n      doc.removeEventListener('resume', onResume, false);\n    }\n    // Remove visibility change listener.\n    if (onVisibilityChange) {\n      doc.removeEventListener('visibilitychange', onVisibilityChange, false);\n    }\n    // Cancel onClose promise if not already cancelled.\n    if (onClose) {\n      onClose.cancel();\n    }\n    // Remove Auth event callback.\n    if (authEventCallback) {\n      self.removeAuthEventListener(authEventCallback);\n    }\n    // Clear any pending redirect now that it is completed.\n    self.pendingRedirect_ = null;\n  };\n  // Save the pending redirect promise and clear it on completion.\n  this.pendingRedirect_ = goog.Promise.resolve().then(function() {\n    // Validate provider.\n    // Fail fast in this case.\n    fireauth.AuthProvider.checkIfOAuthSupported(provider);\n    return self.getInitialAuthEvent_();\n  }).then(function() {\n    return self.processRedirectInternal_(\n        mode, provider, opt_eventId, opt_tenantId);\n  }).then(function() {\n    // Wait for result (universal link) before resolving this operation.\n    // This ensures that if the activity is not destroyed, we can still\n    // return the result of this operation.\n    return new goog.Promise(function(resolve, reject) {\n      /**\n       * @param {?fireauth.AuthEvent} event The Auth event detected.\n       * @return {boolean}\n       */\n      authEventCallback = function(event) {\n        // Auth event detected, resolve promise.\n        // Close SFSVC if still open.\n        var closeBrowsertab = fireauth.util.getObjectRef(\n            'cordova.plugins.browsertab.close', goog.global);\n        resolve();\n        // Close the SFSVC if it is still open (iOS 9+).\n        if (typeof closeBrowsertab === 'function') {\n          closeBrowsertab();\n        }\n        // Close inappbrowser emebedded webview in iOS7 and 8 case if still\n        // open.\n        if (self.inAppBrowserRef_ &&\n            typeof self.inAppBrowserRef_['close'] === 'function') {\n          self.inAppBrowserRef_['close']();\n          // Reset reference.\n          self.inAppBrowserRef_ = null;\n        }\n        return false;\n      };\n      // Wait and listen for the operation to complete (Auth event would\n      // trigger).\n      self.addAuthEventListener(authEventCallback);\n      // On resume (return from the redirect operation).\n      onResume = function() {\n        // Already resumed. Do not run again.\n        if (onClose) {\n          return;\n        }\n        // Wait for some time before throwing the error that the flow was\n        // cancelled by the user.\n        onClose = goog.Timer.promise(self.redirectTimeout_).then(function() {\n          // Throw the redirect cancelled by user error.\n          reject(new fireauth.AuthError(\n              fireauth.authenum.Error.REDIRECT_CANCELLED_BY_USER));\n        });\n      };\n      onVisibilityChange = function() {\n        // If app is visible, run onResume. Otherwise, ignore.\n        if (fireauth.util.isAppVisible()) {\n          onResume();\n        }\n      };\n      // Listen to resume event (will trigger when the user returns to the app).\n      doc.addEventListener('resume', onResume, false);\n      // Listen to visibility change. This is used for iOS Cordova Safari 7+.\n      // Does not work in Android stock browser versions older than 4.4.\n      // We rely on resume event in Android as it works reliably in all\n      // versions.\n      if (!fireauth.util.isAndroid()) {\n        doc.addEventListener('visibilitychange', onVisibilityChange, false);\n      }\n    }).thenCatch(function(error) {\n      // Remove any pending partial event.\n      return self.getPartialStoredEvent_().then(function() {\n        throw error;\n      });\n    });\n  }).thenAlways(cleanup);\n  // Return the pending redirect promise.\n  return this.pendingRedirect_;\n};\n\n/**\n * Processes the OAuth redirect request.\n * @param {!fireauth.AuthEvent.Type} mode The Auth event type.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @param {?string=} opt_eventId The optional event ID.\n * @param {?string=} opt_tenantId The optional tenant ID.\n * @return {!goog.Promise}\n * @private\n */\nfireauth.CordovaHandler.prototype.processRedirectInternal_ = function(\n    mode,\n    provider,\n    opt_eventId,\n    opt_tenantId) {\n  var self = this;\n  // https://github.com/google/cordova-plugin-browsertab\n  // Opens chrome custom tab in Android if chrome is installed,\n  // SFSafariViewController in iOS if supported.\n  // If the above are not supported, opens the system browser.\n  // Opening a system browser could result in an app being rejected in the App\n  // Store. The only solution here is to use an insecure embedded UIWebView.\n  // This applies to older iOS versions 8 and under.\n  // Generate a random session ID.\n  var sessionId = this.generateSessionId_(\n      fireauth.CordovaHandler.SESSION_ID_TOTAL_CHARS_);\n  // Create the partial Auth event.\n  var event = new fireauth.AuthEvent(\n      mode,\n      opt_eventId,\n      null,\n      sessionId,\n      new fireauth.AuthError(fireauth.authenum.Error.NO_AUTH_EVENT),\n      null,\n      opt_tenantId);\n  // Use buildinfo package to get app metadata.\n  // https://www.npmjs.com/package/cordova-plugin-buildinfo\n  // Get app identifier.\n  var appIdentifier =\n      fireauth.util.getObjectRef('BuildInfo.packageName', goog.global);\n  // initializeAndWait will ensure this does not happen.\n  if (typeof appIdentifier !== 'string') {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.INVALID_CORDOVA_CONFIGURATION);\n  }\n  // Get app display name.\n  var appDisplayName =\n      fireauth.util.getObjectRef('BuildInfo.displayName', goog.global);\n  // Construct additional params to pass to OAuth handler.\n  var additionalParams  = {};\n  // Append app identifier.\n  if (fireauth.util.isIOS()) {\n    // iOS app.\n    additionalParams['ibi'] = appIdentifier;\n  } else if (fireauth.util.isAndroid()) {\n    // Android app.\n    additionalParams['apn'] = appIdentifier;\n  } else {\n    // This should not happen as Cordova handler should not even be used in this\n    // case.\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n  }\n  // Pass app display name.\n  if (appDisplayName) {\n    additionalParams['appDisplayName'] = appDisplayName;\n  }\n  // Hash the session ID and pass it to additional params.\n  var hashedSessionId = this.computeSecureHash_(sessionId);\n  // Append session ID.\n  additionalParams['sessionId'] = hashedSessionId;\n  // Construct OAuth handler URL.\n  var oauthHelperWidgetUrl =\n      fireauth.iframeclient.IfcHandler.getOAuthHelperWidgetUrl(\n          this.authDomain_,\n          this.apiKey_,\n          this.appName_,\n          mode,\n          provider,\n          null,\n          opt_eventId,\n          this.clientVersion_,\n          additionalParams,\n          this.endpointId_,\n          opt_tenantId);\n  // Make sure handler initialized and ready.\n  // This should also ensure all plugins are installed.\n  return this.initializeAndWait().then(function() {\n    // Save partial Auth event.\n    return self.savePartialEventManager_.setAuthEvent(self.storageKey_, event);\n  }).then(function() {\n    // initializeAndWait will ensure this plugin is installed.\n    var isAvailable = /** @type {!function(!function(*))} */ (\n        fireauth.util.getObjectRef(\n            'cordova.plugins.browsertab.isAvailable', goog.global));\n    if (typeof isAvailable !== 'function') {\n      throw new fireauth.AuthError(\n          fireauth.authenum.Error.INVALID_CORDOVA_CONFIGURATION);\n    }\n    var openUrl = null;\n    // Check if browsertab is supported.\n    isAvailable(function(result) {\n      if (result) {\n        // browsertab supported.\n        openUrl = /** @type {!function(string, ...*)} */ (\n            fireauth.util.getObjectRef(\n                'cordova.plugins.browsertab.openUrl', goog.global));\n        if (typeof openUrl !== 'function') {\n          throw new fireauth.AuthError(\n              fireauth.authenum.Error.INVALID_CORDOVA_CONFIGURATION);\n        }\n        // Open OAuth handler.\n        openUrl(oauthHelperWidgetUrl);\n      } else {\n        // browsertab not supported, switch to inappbrowser.\n        openUrl = /** @type {!function(string, string, string=)} */ (\n            fireauth.util.getObjectRef(\n                'cordova.InAppBrowser.open', goog.global));\n        if (typeof openUrl !== 'function') {\n          throw new fireauth.AuthError(\n              fireauth.authenum.Error.INVALID_CORDOVA_CONFIGURATION);\n        }\n        // Open in embedded webview for iOS 7 and 8 as Apple rejects apps that\n        // switch context.\n        // _blank opens an embedded webview.\n        // _system opens the system browser.\n        // _system (opens a system browser) is used as a fallback when\n        // browsertab plugin is unable to open a chromecustomtab or SFSVC.\n        // This has to exclude all iOS older versions where switching to a\n        // browser is frowned upon by Apple and embedding a UIWebView is the\n        // only option but is insecure and deprecated by Google for OAuth\n        // sign-in. This will be applicable in old versions of Android.\n        self.inAppBrowserRef_ = openUrl(\n            oauthHelperWidgetUrl,\n            fireauth.util.isIOS7Or8() ? '_blank' : '_system',\n            'location=yes');\n      }\n    });\n  });\n};\n\n\n/**\n * Dispatches the detected Auth event to all subscribed listeners.\n * @param {!fireauth.AuthEvent} event A detected Auth event.\n * @private\n */\nfireauth.CordovaHandler.prototype.dispatchEvent_ = function(event) {\n  for (var i = 0; i < this.authEventListeners_.length; i++) {\n    try {\n      this.authEventListeners_[i](event);\n    } catch (e) {\n      // If any handler fails, ignore and run next handler.\n    }\n  }\n};\n\n\n/**\n * Resolves the first redirect Auth event and caches it.\n * @return {!goog.Promise<!fireauth.AuthEvent>} A promise that resolves with the\n *     initial Auth event response from a redirect operation. Initializes the\n *     internal Auth event listener which will dispatch Auth events to all\n *     subscribed listeners.\n * @private\n */\nfireauth.CordovaHandler.prototype.getInitialAuthEvent_ = function() {\n  var self = this;\n  if (!this.initialAuthEvent_) {\n    // Cache this result so on next call, it is not triggered again.\n    this.initialAuthEvent_ = this.initializeAndWait().then(function() {\n      return new goog.Promise(function(resolve, reject) {\n        /**\n         * @param {?fireauth.AuthEvent} event The Auth event detected.\n         * @return {boolean}\n         */\n        var authEventCallback = function(event) {\n          resolve(event);\n          // Remove on completion.\n          self.removeAuthEventListener(authEventCallback);\n          return false;\n        };\n        // Listen to Auth events. If resolved, resolve promise.\n        self.addAuthEventListener(authEventCallback);\n        // This should succeed as initializeAndWait should guarantee plugins are\n        // ready.\n        self.setAuthEventListener_();\n      });\n    });\n  }\n  return this.initialAuthEvent_;\n};\n\n\n/**\n * Gets and deletes the current stored partial event from storage.\n * @return {!goog.Promise<?fireauth.AuthEvent>} A promise that resolves with the\n *     stored Auth event.\n * @private\n */\nfireauth.CordovaHandler.prototype.getPartialStoredEvent_ = function() {\n  var event = null;\n  var self = this;\n  // Get any saved partial Auth event.\n  return this.getAndDeletePartialEventManager_.getAuthEvent()\n    .then(function(authEvent) {\n      // Save partial event locally.\n      event = authEvent;\n      // Delete partial event.\n      return self.getAndDeletePartialEventManager_.removeAuthEvent();\n    }).then(function() {\n      // Return the locally saved partial event.\n      return event;\n    });\n};\n\n\n/**\n * Extracts the Auth event pertaining to the incoming URL.\n * @param {!fireauth.AuthEvent} partialEvent The partial Auth event.\n * @param {string} url The incoming universal link.\n * @return {?fireauth.AuthEvent} The resolved Auth event corresponding to the\n *     callback URL. This is null if no event is found.\n * @private\n */\nfireauth.CordovaHandler.prototype.extractAuthEventFromUrl_ =\n    function(partialEvent, url) {\n  // Default no redirect event result.\n  var authEvent = null;\n  // Parse the deep link within the dynamic link URL.\n  var callbackUrl = fireauth.DynamicLink.parseDeepLink(url);\n  // Confirm it is actually a callback URL.\n  // Currently the universal link will be of this format:\n  // https://<AUTH_DOMAIN>/__/auth/callback<OAUTH_RESPONSE>\n  // This is a fake URL but is not intended to take the user anywhere\n  // and just redirect to the app.\n  if (callbackUrl.indexOf('/__/auth/callback') != -1) {\n    // Check if there is an error in the URL.\n    // This mechanism is also used to pass errors back to the app:\n    // https://<AUTH_DOMAIN>/__/auth/callback?firebaseError=<STRINGIFIED_ERROR>\n    var uri = goog.Uri.parse(callbackUrl);\n    // Get the error object corresponding to the stringified error if found.\n    var errorObject = fireauth.util.parseJSON(\n        uri.getParameterValue('firebaseError') || null);\n    var error = typeof errorObject === 'object' ?\n        fireauth.AuthError.fromPlainObject(\n            /** @type {?Object} */ (errorObject)) :\n        null;\n    if (error) {\n      // Construct the full failed Auth event.\n      authEvent = new fireauth.AuthEvent(\n          partialEvent.getType(),\n          partialEvent.getEventId(),\n          null,\n          null,\n          error,\n          null,\n          partialEvent.getTenantId());\n    } else {\n      // Construct the full successful Auth event.\n      authEvent = new fireauth.AuthEvent(\n          partialEvent.getType(),\n          partialEvent.getEventId(),\n          callbackUrl,\n          partialEvent.getSessionId(),\n          null,\n          null,\n          partialEvent.getTenantId());\n    }\n  }\n  return authEvent;\n};\n\n\n/**\n * Sets the internal Auth event listener. This listens to incoming universal\n * links and on detection, repackages them into an Auth event and then\n * dispatches the events in all event listeners.\n * @private\n */\nfireauth.CordovaHandler.prototype.setAuthEventListener_ = function() {\n  // https://github.com/nordnet/cordova-universal-links-plugin-fix\n  var self = this;\n  // Default no redirect event result.\n  var noEvent = new fireauth.AuthEvent(\n      fireauth.AuthEvent.Type.UNKNOWN,\n      null,\n      null,\n      null,\n      new fireauth.AuthError(fireauth.authenum.Error.NO_AUTH_EVENT));\n  var initialResolve = false;\n  // On initialization, if no incoming universal link detected, trigger\n  // no Auth event (no redirect operation previously called) after waiting\n  // for a short period of time.\n  var noEventTimer = goog.Timer.promise(this.initialTimeout_).then(function() {\n    // Delete any pending unhandled event.\n    return self.getPartialStoredEvent_().then(function(event) {\n      // On timeout trigger noEvent if not already resolved in link\n      // subscriber.\n      if (!initialResolve) {\n        self.dispatchEvent_(noEvent);\n      }\n    });\n  });\n  // No event name needed, subscribe to all incoming universal links.\n  var universalLinkCb = function(eventData) {\n    initialResolve = true;\n    // Cancel no event timer.\n    if (noEventTimer) {\n      noEventTimer.cancel();\n    }\n    // Incoming link detected.\n    // Check for any stored partial event.\n    self.getPartialStoredEvent_().then(function(event) {\n      // Initialize to an unknown event.\n      var authEvent = noEvent;\n      // Confirm OAuth response included.\n      if (event && eventData && eventData['url']) {\n        // Construct complete event. Default to unknown event if none found.\n        authEvent = self.extractAuthEventFromUrl_(event, eventData['url']) ||\n            noEvent;\n      }\n      // Dispatch Auth event.\n      self.dispatchEvent_(authEvent);\n    });\n  };\n  // iOS 7 or 8 custom URL schemes.\n  // This is also the current default behavior for iOS 9+.\n  // For this to work, cordova-plugin-customurlscheme needs to be installed.\n  // https://github.com/EddyVerbruggen/Custom-URL-scheme\n  // Do not overwrite the existing developer's URL handler.\n  var existingHandlerOpenURL = goog.global['handleOpenURL'];\n  goog.global['handleOpenURL'] = function(url) {\n    var appIdentifier =\n        fireauth.util.getObjectRef('BuildInfo.packageName', goog.global);\n    // Apply case insensitive match. While bundle IDs are case sensitive,\n    // when creating a new app, Apple verifies the Bundle ID using\n    // case-insensitive search. So it is not possible that an app in the app\n    // store try to impersonate another one by lower/upper casing characters.\n    if (url.toLowerCase().indexOf(appIdentifier.toLowerCase() + '://') == 0) {\n      universalLinkCb({\n        'url': url\n      });\n    }\n    // Call the developer's handler if it is present.\n    if (typeof existingHandlerOpenURL === 'function') {\n      try {\n        existingHandlerOpenURL(url);\n      } catch(e) {\n        // This doesn't swallow the error but also does not interrupt the flow.\n        console.error(e);\n      }\n    }\n  };\n  fireauth.UniversalLinkSubscriber.getInstance().subscribe(universalLinkCb);\n};\n\n\n/**\n * @param {!function(?fireauth.AuthEvent):boolean} listener The Auth event\n *     listener to add.\n * @override\n */\nfireauth.CordovaHandler.prototype.addAuthEventListener = function(listener) {\n  // TODO: consider creating an abstract base class that OAuth handlers\n  // extend with add, remove Auth event listeners and dispatcher methods.\n  this.authEventListeners_.push(listener);\n  // Set internal listener to Auth events. This will be ignored on subsequent\n  // calls.\n  this.getInitialAuthEvent_().thenCatch(function(error) {\n    // Suppress this error as it should be caught through other actionable\n    // public methods.\n    // This would typically happen on invalid Cordova setup, when the OAuth\n    // plugins are not installed. This should still trigger the Auth event\n    // as developers are not forced to use OAuth sign-in in their Cordova app.\n    // This is needed for onAuthStateChanged listener to trigger initially.\n    if (error.code === 'auth/invalid-cordova-configuration') {\n      var noEvent = new fireauth.AuthEvent(\n          fireauth.AuthEvent.Type.UNKNOWN,\n          null,\n          null,\n          null,\n          new fireauth.AuthError(fireauth.authenum.Error.NO_AUTH_EVENT));\n      listener(noEvent);\n    }\n  });\n};\n\n\n/**\n * @param {!function(?fireauth.AuthEvent):boolean} listener The Auth event\n *     listener to remove.\n * @override\n */\nfireauth.CordovaHandler.prototype.removeAuthEventListener = function(listener) {\n  goog.array.removeAllIf(this.authEventListeners_, function(ele) {\n    return ele == listener;\n  });\n};\n\n","// Copyright 2008 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Namespace with crypto related helper functions.\n */\n\ngoog.provide('goog.crypt');\n\ngoog.require('goog.array');\ngoog.require('goog.asserts');\n\n\n/**\n * Turns a string into an array of bytes; a \"byte\" being a JS number in the\n * range 0-255. Multi-byte characters are written as little-endian.\n * @param {string} str String value to arrify.\n * @return {!Array<number>} Array of numbers corresponding to the\n *     UCS character codes of each character in str.\n */\ngoog.crypt.stringToByteArray = function(str) {\n  var output = [], p = 0;\n  for (var i = 0; i < str.length; i++) {\n    var c = str.charCodeAt(i);\n    // NOTE: c <= 0xffff since JavaScript strings are UTF-16.\n    if (c > 0xff) {\n      output[p++] = c & 0xff;\n      c >>= 8;\n    }\n    output[p++] = c;\n  }\n  return output;\n};\n\n\n/**\n * Turns an array of numbers into the string given by the concatenation of the\n * characters to which the numbers correspond.\n * @param {!Uint8Array|!Array<number>} bytes Array of numbers representing\n *     characters.\n * @return {string} Stringification of the array.\n */\ngoog.crypt.byteArrayToString = function(bytes) {\n  var CHUNK_SIZE = 8192;\n\n  // Special-case the simple case for speed's sake.\n  if (bytes.length <= CHUNK_SIZE) {\n    return String.fromCharCode.apply(null, bytes);\n  }\n\n  // The remaining logic splits conversion by chunks since\n  // Function#apply() has a maximum parameter count.\n  // See discussion: http://goo.gl/LrWmZ9\n\n  var str = '';\n  for (var i = 0; i < bytes.length; i += CHUNK_SIZE) {\n    var chunk = goog.array.slice(bytes, i, i + CHUNK_SIZE);\n    str += String.fromCharCode.apply(null, chunk);\n  }\n  return str;\n};\n\n\n/**\n * Turns an array of numbers into the hex string given by the concatenation of\n * the hex values to which the numbers correspond.\n * @param {Uint8Array|Array<number>} array Array of numbers representing\n *     characters.\n * @param {string=} opt_separator Optional separator between values\n * @return {string} Hex string.\n */\ngoog.crypt.byteArrayToHex = function(array, opt_separator) {\n  return goog.array\n      .map(\n          array,\n          function(numByte) {\n            var hexByte = numByte.toString(16);\n            return hexByte.length > 1 ? hexByte : '0' + hexByte;\n          })\n      .join(opt_separator || '');\n};\n\n\n/**\n * Converts a hex string into an integer array.\n * @param {string} hexString Hex string of 16-bit integers (two characters\n *     per integer).\n * @return {!Array<number>} Array of {0,255} integers for the given string.\n */\ngoog.crypt.hexToByteArray = function(hexString) {\n  goog.asserts.assert(\n      hexString.length % 2 == 0, 'Key string length must be multiple of 2');\n  var arr = [];\n  for (var i = 0; i < hexString.length; i += 2) {\n    arr.push(parseInt(hexString.substring(i, i + 2), 16));\n  }\n  return arr;\n};\n\n\n/**\n * Converts a JS string to a UTF-8 \"byte\" array.\n * @param {string} str 16-bit unicode string.\n * @return {!Array<number>} UTF-8 byte array.\n */\ngoog.crypt.stringToUtf8ByteArray = function(str) {\n  // TODO(user): Use native implementations if/when available\n  var out = [], p = 0;\n  for (var i = 0; i < str.length; i++) {\n    var c = str.charCodeAt(i);\n    if (c < 128) {\n      out[p++] = c;\n    } else if (c < 2048) {\n      out[p++] = (c >> 6) | 192;\n      out[p++] = (c & 63) | 128;\n    } else if (\n        ((c & 0xFC00) == 0xD800) && (i + 1) < str.length &&\n        ((str.charCodeAt(i + 1) & 0xFC00) == 0xDC00)) {\n      // Surrogate Pair\n      c = 0x10000 + ((c & 0x03FF) << 10) + (str.charCodeAt(++i) & 0x03FF);\n      out[p++] = (c >> 18) | 240;\n      out[p++] = ((c >> 12) & 63) | 128;\n      out[p++] = ((c >> 6) & 63) | 128;\n      out[p++] = (c & 63) | 128;\n    } else {\n      out[p++] = (c >> 12) | 224;\n      out[p++] = ((c >> 6) & 63) | 128;\n      out[p++] = (c & 63) | 128;\n    }\n  }\n  return out;\n};\n\n\n/**\n * Converts a UTF-8 byte array to JavaScript's 16-bit Unicode.\n * @param {Uint8Array|Array<number>} bytes UTF-8 byte array.\n * @return {string} 16-bit Unicode string.\n */\ngoog.crypt.utf8ByteArrayToString = function(bytes) {\n  // TODO(user): Use native implementations if/when available\n  var out = [], pos = 0, c = 0;\n  while (pos < bytes.length) {\n    var c1 = bytes[pos++];\n    if (c1 < 128) {\n      out[c++] = String.fromCharCode(c1);\n    } else if (c1 > 191 && c1 < 224) {\n      var c2 = bytes[pos++];\n      out[c++] = String.fromCharCode((c1 & 31) << 6 | c2 & 63);\n    } else if (c1 > 239 && c1 < 365) {\n      // Surrogate Pair\n      var c2 = bytes[pos++];\n      var c3 = bytes[pos++];\n      var c4 = bytes[pos++];\n      var u = ((c1 & 7) << 18 | (c2 & 63) << 12 | (c3 & 63) << 6 | c4 & 63) -\n          0x10000;\n      out[c++] = String.fromCharCode(0xD800 + (u >> 10));\n      out[c++] = String.fromCharCode(0xDC00 + (u & 1023));\n    } else {\n      var c2 = bytes[pos++];\n      var c3 = bytes[pos++];\n      out[c++] =\n          String.fromCharCode((c1 & 15) << 12 | (c2 & 63) << 6 | c3 & 63);\n    }\n  }\n  return out.join('');\n};\n\n\n/**\n * XOR two byte arrays.\n * @param {!Uint8Array|!Int8Array|!Array<number>} bytes1 Byte array 1.\n * @param {!Uint8Array|!Int8Array|!Array<number>} bytes2 Byte array 2.\n * @return {!Array<number>} Resulting XOR of the two byte arrays.\n */\ngoog.crypt.xorByteArray = function(bytes1, bytes2) {\n  goog.asserts.assert(\n      bytes1.length == bytes2.length, 'XOR array lengths must match');\n\n  var result = [];\n  for (var i = 0; i < bytes1.length; i++) {\n    result.push(bytes1[i] ^ bytes2[i]);\n  }\n  return result;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the fireauth.storage.PendingRedirectManager class which\n * provides utilities to store, retrieve and delete the state of whether there\n * is a pending redirect operation previously triggered.\n */\n\ngoog.provide('fireauth.storage.PendingRedirectManager');\n\ngoog.require('fireauth.authStorage');\n\n\n/**\n * Defines the pending redirect storage manager. It provides methods\n * to store, retrieve and delete the state of whether there is a pending\n * redirect operation previously triggered.\n * @param {string} appId The Auth state's application ID.\n * @param {?fireauth.authStorage.Manager=} opt_manager The underlying storage\n *     manager to use. If none is provided, the default global instance is used.\n * @constructor @struct @final\n */\nfireauth.storage.PendingRedirectManager = function(appId, opt_manager) {\n  /** @const @private{string} appId The Auth state's application ID. */\n  this.appId_ = appId;\n  /**\n   * @const @private{!fireauth.authStorage.Manager} The underlying storage\n   *     manager.\n   */\n  this.manager_ = opt_manager || fireauth.authStorage.Manager.getInstance();\n};\n\n\n/**\n * @const @private{!string} The pending redirect flag.\n */\nfireauth.storage.PendingRedirectManager.PENDING_FLAG_ = 'pending';\n\n\n/**\n * @const @private{!fireauth.authStorage.Key} The pending redirect status\n *     storage identifier key.\n */\nfireauth.storage.PendingRedirectManager.PENDING_REDIRECT_KEY_ = {\n  name: 'pendingRedirect',\n  persistent: fireauth.authStorage.Persistence.SESSION\n};\n\n\n/**\n * Stores the pending redirect operation for the provided application ID.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.PendingRedirectManager.prototype.setPendingStatus =\n    function() {\n  return this.manager_.set(\n      fireauth.storage.PendingRedirectManager.PENDING_REDIRECT_KEY_,\n      fireauth.storage.PendingRedirectManager.PENDING_FLAG_,\n      this.appId_);\n};\n\n\n/**\n * Removes the stored pending redirect operation for provided app ID.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.PendingRedirectManager.prototype.removePendingStatus =\n    function() {\n  return this.manager_.remove(\n      fireauth.storage.PendingRedirectManager.PENDING_REDIRECT_KEY_,\n      this.appId_);\n};\n\n\n/**\n * @return {!goog.Promise<boolean>} A promise that resolves with a boolean\n *     whether there is a pending redirect operaiton for the provided app ID.\n */\nfireauth.storage.PendingRedirectManager.prototype.getPendingStatus =\n    function() {\n  return this.manager_.get(\n      fireauth.storage.PendingRedirectManager.PENDING_REDIRECT_KEY_,\n      this.appId_).then(function(response) {\n        return response ==\n            fireauth.storage.PendingRedirectManager.PENDING_FLAG_;\n      });\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the Auth event manager instance.\n */\n\ngoog.provide('fireauth.AuthEventHandler');\ngoog.provide('fireauth.AuthEventManager');\ngoog.provide('fireauth.AuthEventManager.Result');\ngoog.provide('fireauth.PopupAuthEventProcessor');\ngoog.provide('fireauth.RedirectAuthEventProcessor');\n\ngoog.require('fireauth.AuthCredential');\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.AuthEvent');\ngoog.require('fireauth.CordovaHandler');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.constants');\ngoog.require('fireauth.iframeclient.IfcHandler');\ngoog.require('fireauth.storage.PendingRedirectManager');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.Timer');\ngoog.require('goog.array');\n\n\n/**\n * Initializes the Auth event manager which provides the mechanism to connect\n * external Auth events to their corresponding listeners.\n * @param {string} authDomain The Firebase authDomain used to determine the\n *     OAuth helper page domain.\n * @param {string} apiKey The API key for sending backend Auth requests.\n * @param {string} appName The App ID for the Auth instance that triggered this\n *     request.\n * @constructor\n */\nfireauth.AuthEventManager = function(authDomain, apiKey, appName) {\n  /**\n   * @private {!Object<string, boolean>} The map of processed auth event IDs.\n   */\n  this.processedEvents_ = {};\n  /** @private {number} The last saved processed event time in milliseconds. */\n  this.lastProcessedEventTime_ = 0;\n  /** @private {string} The Auth domain. */\n  this.authDomain_ = authDomain;\n  /** @private {string} The browser API key. */\n  this.apiKey_ = apiKey;\n  /** @private {string} The App name. */\n  this.appName_ = appName;\n  /**\n   * @private {!Array<!fireauth.AuthEventHandler>} List of subscribed handlers.\n   */\n  this.subscribedHandlers_ = [];\n  /**\n   * @private {boolean} Whether the Auth event manager instance is initialized.\n   */\n  this.initialized_ = false;\n  /** @private {function(?fireauth.AuthEvent)} The Auth event handler. */\n  this.authEventHandler_ = goog.bind(this.handleAuthEvent_, this);\n  /** @private {!fireauth.RedirectAuthEventProcessor} The redirect event\n   *      processor. */\n  this.redirectAuthEventProcessor_ =\n      new fireauth.RedirectAuthEventProcessor(this);\n  /** @private {!fireauth.PopupAuthEventProcessor} The popup event processor. */\n  this.popupAuthEventProcessor_ = new fireauth.PopupAuthEventProcessor(this);\n  /**\n   * @private {!fireauth.storage.PendingRedirectManager} The pending redirect\n   *     storage manager instance.\n   */\n  this.pendingRedirectStorageManager_ =\n      new fireauth.storage.PendingRedirectManager(\n          fireauth.AuthEventManager.getKey_(this.apiKey_, this.appName_));\n\n  /**\n   * @private {!Object.<!fireauth.AuthEvent.Type, !fireauth.AuthEventProcessor>}\n   *     Map containing Firebase event processor instances keyed by event type.\n   */\n  this.typeToManager_ = {};\n  this.typeToManager_[fireauth.AuthEvent.Type.UNKNOWN] =\n      this.redirectAuthEventProcessor_;\n  this.typeToManager_[fireauth.AuthEvent.Type.SIGN_IN_VIA_REDIRECT] =\n      this.redirectAuthEventProcessor_;\n  this.typeToManager_[fireauth.AuthEvent.Type.LINK_VIA_REDIRECT] =\n      this.redirectAuthEventProcessor_;\n  this.typeToManager_[fireauth.AuthEvent.Type.REAUTH_VIA_REDIRECT] =\n      this.redirectAuthEventProcessor_;\n  this.typeToManager_[fireauth.AuthEvent.Type.SIGN_IN_VIA_POPUP] =\n      this.popupAuthEventProcessor_;\n  this.typeToManager_[fireauth.AuthEvent.Type.LINK_VIA_POPUP] =\n      this.popupAuthEventProcessor_;\n  this.typeToManager_[fireauth.AuthEvent.Type.REAUTH_VIA_POPUP] =\n      this.popupAuthEventProcessor_;\n  /**\n   * @private {!fireauth.OAuthSignInHandler} The OAuth sign in handler depending\n   *     on the current environment.\n   */\n  this.oauthSignInHandler_ =\n      fireauth.AuthEventManager.instantiateOAuthSignInHandler(\n          this.authDomain_, this.apiKey_, this.appName_,\n          firebase.SDK_VERSION || null,\n          fireauth.constants.clientEndpoint);\n};\n\n\n/**\n * @const {number} The number of milliseconds since the last processed\n *     event before the event duplication cache is cleared. This is currently\n *     10 minutes.\n */\nfireauth.AuthEventManager.EVENT_DUPLICATION_CACHE_DURATION = 10 * 60 * 1000;\n\n\n/**\n * @return {!fireauth.RedirectAuthEventProcessor} The redirect event processor.\n */\nfireauth.AuthEventManager.prototype.getRedirectAuthEventProcessor = function() {\n  return this.redirectAuthEventProcessor_;\n};\n\n\n/** @return {!fireauth.PopupAuthEventProcessor} The popup event processor. */\nfireauth.AuthEventManager.prototype.getPopupAuthEventProcessor = function() {\n  return this.popupAuthEventProcessor_;\n};\n\n\n/**\n * Instantiates an OAuth sign-in handler depending on the current environment\n * and returns it.\n * @param {string} authDomain The Firebase authDomain used to determine the\n *     OAuth helper page domain.\n * @param {string} apiKey The API key for sending backend Auth requests.\n * @param {string} appName The App ID for the Auth instance that triggered this\n *     request.\n * @param {?string} version The SDK client version.\n * @param {?string=} opt_endpointId The endpoint ID (staging, test Gaia, etc).\n * @return {!fireauth.OAuthSignInHandler} The OAuth sign in handler depending\n *     on the current environment.\n */\nfireauth.AuthEventManager.instantiateOAuthSignInHandler =\n    function(authDomain, apiKey, appName, version, opt_endpointId) {\n  // This assumes that android/iOS file environment must be a Cordova\n  // environment which is not true. This is the best way currently available\n  // to instantiate this synchronously without waiting for checkIfCordova to\n  // resolve. If it is determined that the Cordova was falsely detected, it will\n  // be caught via actionable public popup and redirect methods.\n  return fireauth.util.isAndroidOrIosCordovaScheme() ?\n      new fireauth.CordovaHandler(\n          authDomain, apiKey, appName, version, undefined, undefined,\n          opt_endpointId) :\n      new fireauth.iframeclient.IfcHandler(\n          authDomain, apiKey, appName, version, opt_endpointId);\n};\n\n\n/** Reset iframe. This will require reinitializing it.*/\nfireauth.AuthEventManager.prototype.reset = function() {\n  // Reset initialized status. This will force a popup request to re-initialize\n  // the iframe.\n  this.initialized_ = false;\n  // Remove any previous existing Auth event listener.\n  this.oauthSignInHandler_.removeAuthEventListener(this.authEventHandler_);\n  // Construct a new instance of OAuth sign in handler.\n\n  this.oauthSignInHandler_ =\n      fireauth.AuthEventManager.instantiateOAuthSignInHandler(\n          this.authDomain_, this.apiKey_, this.appName_,\n          firebase.SDK_VERSION || null);\n  this.processedEvents_ = {};\n};\n\n\n/**\n * Clears the cached redirect result as long as there is no pending redirect\n * result being processed. Unrecoverable errors will not be cleared.\n */\nfireauth.AuthEventManager.prototype.clearRedirectResult = function() {\n  this.redirectAuthEventProcessor_.clearRedirectResult();\n};\n\n\n/**\n * @typedef {{\n *   user: (?fireauth.AuthUser|undefined),\n *   credential: (?fireauth.AuthCredential|undefined),\n *   operationType: (?string|undefined),\n *   additionalUserInfo: (?fireauth.AdditionalUserInfo|undefined)\n * }}\n */\nfireauth.AuthEventManager.Result;\n\n\n/**\n * Whether to enable Auth event manager subscription.\n * @const {boolean}\n */\nfireauth.AuthEventManager.ENABLED = true;\n\n\n/**\n * Initializes the ifchandler and add Auth event listener on it.\n * @return {!goog.Promise} The promise that resolves when the iframe is ready.\n */\nfireauth.AuthEventManager.prototype.initialize = function() {\n  var self = this;\n  // Initialize once.\n  if (!this.initialized_) {\n    this.initialized_ = true;\n    // Listen to Auth events on iframe.\n    this.oauthSignInHandler_.addAuthEventListener(this.authEventHandler_);\n  }\n  var previousOauthSignInHandler = this.oauthSignInHandler_;\n  // This should initialize ifchandler underneath.\n  // Return on OAuth handler ready promise.\n  // Check for error in ifcHandler used to embed the iframe.\n  return this.oauthSignInHandler_.initializeAndWait()\n      .thenCatch(function(error) {\n        // Force ifchandler to reinitialize on retrial.\n        if (self.oauthSignInHandler_ == previousOauthSignInHandler) {\n          // If a new OAuth sign in handler was already created, do not reset.\n          self.reset();\n        }\n        throw error;\n      });\n};\n\n\n/**\n * Called after it is determined that there is no pending redirect result.\n * Will populate the redirect result if it is guaranteed to be null and will\n * force an early initialization of the OAuth sign in handler if the\n * environment requires it.\n * @private\n */\nfireauth.AuthEventManager.prototype.initializeWithNoPendingRedirectResult_ =\n    function() {\n  var self = this;\n  // Check if the OAuth sign in handler should be initialized early in all\n  // cases.\n  if (this.oauthSignInHandler_.shouldBeInitializedEarly()) {\n    this.initialize().thenCatch(function(error) {\n      // Current environment was falsely detected as Cordova, trigger a fake\n      // Auth event to notify getRedirectResult that operation is not supported.\n      var notSupportedEvent = new fireauth.AuthEvent(\n          fireauth.AuthEvent.Type.UNKNOWN,\n          null,\n          null,\n          null,\n          new fireauth.AuthError(\n              fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n      if (fireauth.AuthEventManager.isCordovaFalsePositive_(\n          /** @type {?fireauth.AuthError} */ (error))) {\n        self.handleAuthEvent_(notSupportedEvent);\n      }\n    });\n  }\n  // For environments where storage is volatile, we can't determine that\n  // there is no pending redirect response. This is true in Cordova\n  // where an activity would be destroyed in some cases and the\n  // sessionStorage is lost.\n  if (!this.oauthSignInHandler_.hasVolatileStorage()) {\n    // Since there is no redirect result, it is safe to default to empty\n    // redirect result instead of blocking on this.\n    // The downside here is that on iOS devices, calling signInWithPopup\n    // after getRedirectResult resolves and the iframe does not finish\n    // loading, the popup event propagating to the iframe would not be\n    // detected. This is because in iOS devices, storage events only trigger\n    // in iframes but are not actually saved in web storage. The iframe must\n    // be embedded and ready before the storage event propagates. Otherwise\n    // it won't be detected.\n    this.redirectAuthEventProcessor_.defaultToEmptyResponse();\n  }\n};\n\n\n/**\n * Subscribes an Auth event handler to list of handlers.\n * @param {!fireauth.AuthEventHandler} handler The instance to subscribe.\n */\nfireauth.AuthEventManager.prototype.subscribe = function(handler) {\n  if (!goog.array.contains(this.subscribedHandlers_, handler)) {\n    this.subscribedHandlers_.push(handler);\n  }\n  if (this.initialized_) {\n    return;\n  }\n  var self = this;\n  // Check pending redirect status.\n  this.pendingRedirectStorageManager_.getPendingStatus()\n      .then(function(status) {\n    // Pending redirect detected.\n    if (status) {\n      // Remove pending status and initialize.\n      self.pendingRedirectStorageManager_.removePendingStatus()\n          .then(function() {\n            self.initialize().thenCatch(function(error) {\n              // Current environment was falsely detected as Cordova, trigger a\n              // fake Auth event to notify getRedirectResult that operation is\n              // not supported.\n              var notSupportedEvent = new fireauth.AuthEvent(\n                 fireauth.AuthEvent.Type.UNKNOWN,\n                 null,\n                 null,\n                 null,\n                 new fireauth.AuthError(\n                     fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n              if (fireauth.AuthEventManager.isCordovaFalsePositive_(\n                  /** @type {?fireauth.AuthError} */ (error))) {\n                self.handleAuthEvent_(notSupportedEvent);\n              }\n            });\n          });\n    } else {\n      // No previous redirect, default to empty response.\n      self.initializeWithNoPendingRedirectResult_();\n    }\n  }).thenCatch(function(error) {\n    // Error checking pending status, default to empty response.\n    self.initializeWithNoPendingRedirectResult_();\n  });\n};\n\n\n/**\n * @param {!fireauth.AuthEventHandler} handler The possible subscriber.\n * @return {boolean} Whether the handle is subscribed.\n */\nfireauth.AuthEventManager.prototype.isSubscribed = function(handler) {\n  return goog.array.contains(this.subscribedHandlers_, handler);\n};\n\n\n/**\n * Unsubscribes an Auth event handler to list of handlers.\n * @param {!fireauth.AuthEventHandler} handler The instance to unsubscribe.\n */\nfireauth.AuthEventManager.prototype.unsubscribe = function(handler) {\n  goog.array.removeAllIf(this.subscribedHandlers_, function(ele) {\n    return ele == handler;\n  });\n};\n\n\n/**\n * @param {?fireauth.AuthEvent} authEvent External Auth event to check.\n * @return {boolean} Whether the event was previously processed.\n * @private\n */\nfireauth.AuthEventManager.prototype.hasProcessedAuthEvent_ =\n    function(authEvent) {\n  // Prevent duplicate event tracker from growing too large.\n  if (goog.now() - this.lastProcessedEventTime_ >=\n      fireauth.AuthEventManager.EVENT_DUPLICATION_CACHE_DURATION) {\n    this.processedEvents_ = {};\n    this.lastProcessedEventTime_ = 0;\n  }\n  if (authEvent && authEvent.getUid() &&\n      this.processedEvents_.hasOwnProperty(authEvent.getUid())) {\n    // If event is already processed, ignore it.\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * Saves the provided event uid to prevent processing duplication.\n * @param {?fireauth.AuthEvent} authEvent External Auth event to track in\n *     processed list of events.\n * @private\n */\nfireauth.AuthEventManager.prototype.saveProcessedAuthEvent_ =\n    function(authEvent) {\n  if (authEvent &&\n      (authEvent.getSessionId() || authEvent.getEventId())) {\n    // Save processed event ID. We keep the cache for 10 minutes to prevent it\n    // from growing too large.\n    this.processedEvents_[\n        /** @type {string} */ (authEvent.getUid())] = true;\n    // Save last processing time.\n    this.lastProcessedEventTime_ = goog.now();\n  }\n};\n\n\n/**\n * Handles external Auth event detected by the OAuth sign-in handler.\n * @param {?fireauth.AuthEvent} authEvent External Auth event detected by\n *     iframe.\n * @return {boolean} Whether the event found an appropriate owner that can\n *     handle it. This signals to the OAuth helper iframe that the event is safe\n *     to delete.\n * @private\n */\nfireauth.AuthEventManager.prototype.handleAuthEvent_ = function(authEvent) {\n  // This should not happen as fireauth.iframe.AuthRelay will not send null\n  // events.\n  if (!authEvent) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_AUTH_EVENT);\n  }\n  if (this.hasProcessedAuthEvent_(authEvent)) {\n    // If event is already processed, ignore it.\n    return false;\n  }\n  // Initialize event processed status to false. When set to false, the event is\n  // not clear to delete in the OAuth helper iframe as the owner of this event\n  // could be a user in another tab.\n  var processed = false;\n  // Lookup a potential handler for this event.\n  for (var i = 0; i < this.subscribedHandlers_.length; i++) {\n    var potentialHandler = this.subscribedHandlers_[i];\n    if (potentialHandler.canHandleAuthEvent(\n        authEvent.getType(), authEvent.getEventId())) {\n      var eventManager = this.typeToManager_[authEvent.getType()];\n      if (eventManager) {\n        eventManager.processAuthEvent(authEvent, potentialHandler);\n        // Prevent events with event IDs or session IDs from duplicate\n        // processing.\n        this.saveProcessedAuthEvent_(authEvent);\n      }\n      // Event has been processed, free to clear in OAuth helper.\n      processed = true;\n      break;\n    }\n  }\n  // If no redirect response ready yet, default to an empty response.\n  this.redirectAuthEventProcessor_.defaultToEmptyResponse();\n  // Notify iframe of processed status.\n  return processed;\n};\n\n\n/**\n * The popup promise timeout delay with units in ms between the time the iframe\n * is ready (successfully embedded on the page) and the time the popup Auth\n * event is detected in the parent container.\n * @const {!fireauth.util.Delay}\n * @private\n */\nfireauth.AuthEventManager.POPUP_TIMEOUT_MS_ =\n    new fireauth.util.Delay(2000, 10000);\n\n\n/**\n * The redirect promise timeout delay with units in ms. Unlike the popup\n * timeout, this covers the entire duration from start to getRedirectResult\n * resolution.\n * @const {!fireauth.util.Delay}\n * @private\n */\nfireauth.AuthEventManager.REDIRECT_TIMEOUT_MS_ =\n    new fireauth.util.Delay(30000, 60000);\n\n\n/**\n * Returns the redirect result. If coming back from a successful redirect sign\n * in, will resolve to the signed in user. If coming back from an unsuccessful\n * redirect sign, will reject with the proper error. If no redirect operation\n * called, resolves with null.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthEventManager.prototype.getRedirectResult = function() {\n  return this.redirectAuthEventProcessor_.getRedirectResult();\n};\n\n\n/**\n * Processes the popup request. The popup instance must be provided externally\n * and on error, the requestor must close the window.\n * @param {?Window} popupWin The popup window reference.\n * @param {!fireauth.AuthEvent.Type} mode The Auth event type.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @param {string=} opt_eventId The optional event ID.\n * @param {boolean=} opt_alreadyRedirected Whether popup is already redirected\n *     to final destination.\n * @param {?string=} opt_tenantId The optional tenant ID.\n * @return {!goog.Promise} The popup window promise.\n */\nfireauth.AuthEventManager.prototype.processPopup =\n    function(popupWin, mode, provider, opt_eventId, opt_alreadyRedirected,\n             opt_tenantId) {\n  var self = this;\n  return this.oauthSignInHandler_.processPopup(\n      popupWin,\n      mode,\n      provider,\n      // On initialization, add Auth event listener if not already added.\n      function() {\n        if (!self.initialized_) {\n          self.initialized_ = true;\n          // Listen to Auth events on iframe.\n          self.oauthSignInHandler_.addAuthEventListener(self.authEventHandler_);\n        }\n      },\n      // On error, reset to force re-initialization on retrial.\n      function(error) {\n        self.reset();\n      },\n      opt_eventId,\n      opt_alreadyRedirected,\n      opt_tenantId);\n};\n\n\n/**\n * @param {?fireauth.AuthError} error The error to check for Cordova false\n *     positive.\n * @return {boolean} Whether the current environment was falsely identified as\n *     Cordova.\n * @private\n */\nfireauth.AuthEventManager.isCordovaFalsePositive_ = function(error) {\n  if (error && error['code'] == 'auth/cordova-not-ready') {\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * Processes the redirect request.\n * @param {!fireauth.AuthEvent.Type} mode The Auth event type.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @param {string=} opt_eventId The optional event ID.\n * @param {?string=} opt_tenantId The optional tenant ID.\n * @return {!goog.Promise}\n */\nfireauth.AuthEventManager.prototype.processRedirect =\n    function(mode, provider, opt_eventId, opt_tenantId) {\n  var self = this;\n  var error;\n  // Save pending status first.\n  return this.pendingRedirectStorageManager_.setPendingStatus()\n    .then(function() {\n      // Try to redirect.\n      return self.oauthSignInHandler_.processRedirect(\n          mode, provider, opt_eventId, opt_tenantId)\n        .thenCatch(function(e) {\n          if (fireauth.AuthEventManager.isCordovaFalsePositive_(\n              /** @type {?fireauth.AuthError} */ (e))) {\n            throw new fireauth.AuthError(\n                fireauth.authenum.Error.OPERATION_NOT_SUPPORTED);\n          }\n          // On failure, remove pending status and rethrow the error.\n          error = e;\n          return self.pendingRedirectStorageManager_.removePendingStatus()\n            .then(function() {\n              throw error;\n            });\n        })\n        .then(function() {\n          // Resolve, if the OAuth handler unloads the page on redirect.\n          if (!self.oauthSignInHandler_.unloadsOnRedirect()) {\n            // Relevant to Cordova case, will not matter in web case where\n            // browser redirects.\n            // In Cordova, the activity could still be running in the background\n            // so we need to wait for getRedirectResult to resolve before\n            // resolving this current promise.\n            // Otherwise, if the activity is destroyed, getRedirectResult would\n            // be used.\n            // At this point, authEvent should have been triggered.\n            // When this promise resolves, the developer should be able to\n            // call getRedirectResult to get the result of this operation.\n            // Remove pending status as result should be resolved.\n            return self.pendingRedirectStorageManager_.removePendingStatus()\n                .then(function() {\n                  // Ensure redirect result ready before resolving.\n                  return self.getRedirectResult();\n                }).then(function(result) {\n                  // Do nothing. Developer expected to call getRedirectResult to\n                  // get result.\n                }).thenCatch(function(error) {\n                  // Do nothing. Developer expected to call getRedirectResult to\n                  // get result.\n                });\n          } else {\n            // For environments that will unload the page on redirect, keep\n            // the promise pending on success. This makes it easier to reuse\n            // the same code for Cordova environment and browser environment.\n            // The developer can always add getRedirectResult on promise\n            // resolution and expect that when it runs, the redirect operation\n            // was completed.\n            return new goog.Promise(function(resolve, reject) {\n              // Keep this pending.\n            });\n          }\n        });\n    });\n};\n\n\n/**\n * Waits for popup window to close. When closed start timeout listener for popup\n * pending promise. If in the process, it was detected that the iframe does not\n * support web storage, the popup is closed and the web storage unsupported\n * error is thrown.\n * @param {!fireauth.AuthEventHandler} owner The owner of the event.\n * @param {!fireauth.AuthEvent.Type} mode The Auth event type.\n * @param {!Window} popupWin The popup window.\n * @param {?string=} opt_eventId The event ID.\n * @return {!goog.Promise}\n */\nfireauth.AuthEventManager.prototype.startPopupTimeout =\n    function(owner, mode, popupWin, opt_eventId) {\n  return this.oauthSignInHandler_.startPopupTimeout(\n      popupWin,\n      // On popup error such as popup closed by user or web storage not\n      // supported.\n      function(error) {\n        // Notify owner of the error.\n        owner.resolvePendingPopupEvent(mode, null, error, opt_eventId);\n      },\n      fireauth.AuthEventManager.POPUP_TIMEOUT_MS_.get());\n};\n\n\n\n/**\n * @private {!Object.<string, !fireauth.AuthEventManager>} Map containing\n *     Firebase event manager instances keyed by Auth event manager ID.\n */\nfireauth.AuthEventManager.manager_ = {};\n\n\n/**\n * The separator for manager keys to concatenate app name and apiKey.\n * @const {string}\n * @private\n */\nfireauth.AuthEventManager.KEY_SEPARATOR_ = ':';\n\n\n/**\n * @param {string} apiKey The API key for sending backend Auth requests.\n * @param {string} appName The Auth instance that initiated the Auth event.\n * @return {string} The key identifying the Auth event manager instance.\n * @private\n */\nfireauth.AuthEventManager.getKey_ = function(apiKey, appName) {\n  return apiKey + fireauth.AuthEventManager.KEY_SEPARATOR_ + appName;\n};\n\n\n/**\n * @param {string} authDomain The Firebase authDomain used to determine the\n *     OAuth helper page domain.\n * @param {string} apiKey The API key for sending backend Auth requests.\n * @param {string} appName The Auth instance that initiated the Auth event\n *     manager.\n * @return {!fireauth.AuthEventManager} the requested manager instance.\n */\nfireauth.AuthEventManager.getManager = function(authDomain, apiKey, appName) {\n  // Construct storage key.\n  var key = fireauth.AuthEventManager.getKey_(apiKey, appName);\n  if (!fireauth.AuthEventManager.manager_[key]) {\n    fireauth.AuthEventManager.manager_[key] =\n        new fireauth.AuthEventManager(authDomain, apiKey, appName);\n  }\n  return fireauth.AuthEventManager.manager_[key];\n};\n\n\n\n/**\n * The interface that represents a specific type of Auth event processor.\n * @interface\n */\nfireauth.AuthEventProcessor = function() {};\n\n\n/**\n * Completes the processing of an external Auth event detected by the embedded\n * iframe.\n * @param {?fireauth.AuthEvent} authEvent External Auth event detected by\n *     iframe.\n * @param {!fireauth.AuthEventHandler} owner The owner of the event.\n * @return {!goog.Promise<undefined>}\n */\nfireauth.AuthEventProcessor.prototype.processAuthEvent =\n    function(authEvent, owner) {};\n\n\n\n/**\n * Redirect Auth event manager.\n * @param {!fireauth.AuthEventManager} manager The parent Auth event manager.\n * @constructor\n * @implements {fireauth.AuthEventProcessor}\n */\nfireauth.RedirectAuthEventProcessor = function(manager) {\n  this.manager_ = manager;\n  // Only one redirect result can be tracked on first load.\n  /**\n   * @private {?function():!goog.Promise<!fireauth.AuthEventManager.Result>}\n   *     Redirect result resolver. This will be used to resolve the\n   *     getRedirectResult promise. When the redirect result is obtained, this\n   *     field will be set.\n   */\n  this.redirectedUserPromise_ = null;\n  /**\n   * @private {!Array<function(!fireauth.AuthEventManager.Result)>} Pending\n   *     promise redirect resolver. When the redirect result is obtained and the\n   *     user is detected, this will be called.\n   */\n  this.redirectResolve_ = [];\n  /**\n   * @private {!Array<function(*)>} Pending Promise redirect rejecter. When the\n   *     redirect result is obtained and an error is detected, this will be\n   *     called.\n   */\n  this.redirectReject_ = [];\n  /** @private {?goog.Promise} Pending timeout promise for redirect. */\n  this.redirectTimeoutPromise_ = null;\n  /**\n   * @private {boolean} Whether redirect result is resolved. This is true\n   *     when a valid Auth event has been triggered.\n   */\n  this.redirectResultResolved_ = false;\n  /**\n   * @private {boolean} Whether an unrecoverable error was detected. This\n   *     includes web storage unsupported or operation not allowed errors.\n   */\n  this.unrecoverableErrorDetected_ = false;\n};\n\n\n/** Reset any previous redirect result. */\nfireauth.RedirectAuthEventProcessor.prototype.reset = function() {\n  // Reset to allow override getRedirectResult. This is relevant for Cordova\n  // environment where redirect events do not necessarily unload the current\n  // page.\n  this.redirectedUserPromise_ = null;\n  if (this.redirectTimeoutPromise_) {\n    this.redirectTimeoutPromise_.cancel();\n    this.redirectTimeoutPromise_ = null;\n  }\n};\n\n\n/**\n * Completes the processing of an external Auth event detected by the embedded\n * iframe.\n * @param {?fireauth.AuthEvent} authEvent External Auth event detected by\n *     iframe.\n * @param {!fireauth.AuthEventHandler} owner The owner of the event.\n * @return {!goog.Promise<undefined>}\n * @override\n */\nfireauth.RedirectAuthEventProcessor.prototype.processAuthEvent =\n    function(authEvent, owner) {\n  // This should not happen as fireauth.iframe.AuthRelay will not send null\n  // events.\n  if (!authEvent) {\n    return goog.Promise.reject(\n        new fireauth.AuthError(fireauth.authenum.Error.INVALID_AUTH_EVENT));\n  }\n  // Reset any pending redirect result. This event will overwrite it.\n  this.reset();\n  this.redirectResultResolved_ = true;\n  var mode = authEvent.getType();\n  var eventId = authEvent.getEventId();\n  // Check if web storage is not supported in the iframe.\n  var isWebStorageNotSupported =\n      authEvent.getError() &&\n      authEvent.getError()['code'] == 'auth/web-storage-unsupported';\n  /// Check if operation is supported in this environment.\n  var isOperationNotSupported =\n      authEvent.getError() &&\n      authEvent.getError()['code'] == 'auth/operation-not-supported-in-this-' +\n          'environment';\n  this.unrecoverableErrorDetected_ =\n      !!(isWebStorageNotSupported || isOperationNotSupported);\n  // UNKNOWN mode is always triggered on load by iframe when no popup/redirect\n  // data is available. If web storage unsupported error is thrown, process as\n  // error and not as unknown event. If the operation is not supported in this\n  // environment, also treat as an error and not as an unknown event.\n  if (mode == fireauth.AuthEvent.Type.UNKNOWN &&\n      !isWebStorageNotSupported &&\n      !isOperationNotSupported) {\n    return this.processUnknownEvent_();\n  } else if (authEvent.hasError()) {\n    return this.processErrorEvent_(authEvent, owner);\n  } else if (owner.getAuthEventHandlerFinisher(mode, eventId)) {\n    return this.processSuccessEvent_(authEvent, owner);\n  } else {\n    return goog.Promise.reject(\n        new fireauth.AuthError(fireauth.authenum.Error.INVALID_AUTH_EVENT));\n  }\n};\n\n\n/**\n * Sets an empty redirect result response when no redirect result is available.\n */\nfireauth.RedirectAuthEventProcessor.prototype.defaultToEmptyResponse =\n    function() {\n  // If the first event does not resolve redirectResult and no subscriber can\n  // handle it, set redirect result to null.\n  // An example of this scenario would be a link via redirect that was triggered\n  // by a user that was not logged in. canHandleAuthEvent will be false for all\n  // subscribers. So make sure getRedirectResult when called will resolve to a\n  // null user.\n  if (!this.redirectResultResolved_) {\n    this.redirectResultResolved_ = true;\n    // No Auth event available, getRedirectResult should resolve with null.\n    this.setRedirectResult_(false, null, null);\n  }\n};\n\n\n/**\n * Clears the cached redirect result as long as there is no pending redirect\n * result being processed. Unrecoverable errors will not be cleared.\n */\nfireauth.RedirectAuthEventProcessor.prototype.clearRedirectResult = function() {\n  // Clear the result if it is already resolved and no unrecoverable errors are\n  // detected.\n  if (this.redirectResultResolved_ && !this.unrecoverableErrorDetected_) {\n    this.setRedirectResult_(false, null, null);\n  }\n};\n\n\n/**\n * Processes the unknown event.\n * @return {!goog.Promise<undefined>}\n * @private\n */\nfireauth.RedirectAuthEventProcessor.prototype.processUnknownEvent_ =\n    function() {\n  // No Auth event available, getRedirectResult should resolve with null.\n  this.setRedirectResult_(false, null, null);\n  return goog.Promise.resolve();\n};\n\n\n/**\n * Processes an error event.\n * @param {?fireauth.AuthEvent} authEvent External Auth event detected by\n *     iframe.\n * @param {!fireauth.AuthEventHandler} owner The owner of the event.\n * @return {!goog.Promise<undefined>}\n * @private\n */\nfireauth.RedirectAuthEventProcessor.prototype.processErrorEvent_ =\n    function(authEvent, owner) {\n  // Set redirect result to resolve with null if event is not a redirect or\n  // reject with error if event is an error.\n  this.setRedirectResult_(true, null, authEvent.getError());\n  return goog.Promise.resolve();\n};\n\n\n/**\n * Processes a successful event.\n * @param {?fireauth.AuthEvent} authEvent External Auth event detected by\n *     iframe.\n * @param {!fireauth.AuthEventHandler} owner The owner of the event.\n * @return {!goog.Promise<undefined>}\n * @private\n */\nfireauth.RedirectAuthEventProcessor.prototype.processSuccessEvent_ =\n    function(authEvent, owner) {\n  var self = this;\n  var eventId = authEvent.getEventId();\n  var mode = authEvent.getType();\n  var handler = owner.getAuthEventHandlerFinisher(mode, eventId);\n  var requestUri = /** @type {string} */ (authEvent.getUrlResponse());\n  var sessionId = /** @type {string} */ (authEvent.getSessionId());\n  var postBody = /** @type {?string} */ (authEvent.getPostBody());\n  var tenantId = /** @type {?string} */ (authEvent.getTenantId());\n  var isRedirect = fireauth.AuthEvent.isRedirect(authEvent);\n  // Complete sign in or link account operation and then pass result to\n  // relevant pending popup promise.\n  return handler(requestUri, sessionId, tenantId, postBody)\n      .then(function(popupRedirectResponse) {\n    // Flow completed.\n    // For a redirect operation resolve with the popupRedirectResponse,\n    // otherwise resolve with null.\n    self.setRedirectResult_(isRedirect, popupRedirectResponse, null);\n  }).thenCatch(function(error) {\n    // Flow not completed due to error.\n    // For a redirect operation reject with the error, otherwise resolve\n    // with null.\n    self.setRedirectResult_(\n        isRedirect, null, /** @type {!fireauth.AuthError} */ (error));\n    // Always resolve.\n    return;\n  });\n};\n\n\n/**\n * Sets redirect error result.\n * @param {!fireauth.AuthError} error The redirect operation error.\n * @private\n */\nfireauth.RedirectAuthEventProcessor.prototype.setRedirectReject_ =\n    function(error) {\n  // If a redirect error detected, reject getRedirectResult with that error.\n  this.redirectedUserPromise_ = function() {\n    return goog.Promise.reject(error);\n  };\n  // Reject all pending getRedirectResult promises.\n  if (this.redirectReject_.length) {\n    for (var i = 0; i < this.redirectReject_.length; i++) {\n      this.redirectReject_[i](error);\n    }\n  }\n};\n\n\n/**\n * Sets redirect success result.\n * @param {!fireauth.AuthEventManager.Result} popupRedirectResult The\n *     resolved user for a successful or null user redirect.\n * @private\n */\nfireauth.RedirectAuthEventProcessor.prototype.setRedirectResolve_ =\n    function(popupRedirectResult) {\n  // If a redirect user detected, resolve getRedirectResult with the\n  // popupRedirectResult.\n  // Result should not be null in this case.\n  this.redirectedUserPromise_ = function() {\n    return goog.Promise.resolve(\n        /** @type {!fireauth.AuthEventManager.Result} */ (popupRedirectResult));\n  };\n  // Resolve all pending getRedirectResult promises.\n  if (this.redirectResolve_.length) {\n    for (var i = 0; i < this.redirectResolve_.length; i++) {\n      this.redirectResolve_[i](\n          /** @type {!fireauth.AuthEventManager.Result} */ (\n              popupRedirectResult));\n    }\n  }\n};\n\n\n/**\n * @param {boolean} isRedirect Whether Auth event is a redirect event.\n * @param {?fireauth.AuthEventManager.Result} popupRedirectResult The\n *     resolved user for a successful redirect. This user is null if no redirect\n *     operation run.\n * @param {?fireauth.AuthError} error The redirect operation error.\n * @private\n */\nfireauth.RedirectAuthEventProcessor.prototype.setRedirectResult_ =\n    function(isRedirect, popupRedirectResult, error) {\n  if (isRedirect) {\n    // This is a redirect operation, either resolves with user or error.\n    if (error) {\n      // If a redirect error detected, reject getRedirectResult with that error.\n      this.setRedirectReject_(error);\n    } else {\n      // If a redirect user detected, resolve getRedirectResult with the\n      // popupRedirectResult.\n      // Result should not be null in this case.\n      this.setRedirectResolve_(\n          /** @type {!fireauth.AuthEventManager.Result} */ (\n              popupRedirectResult));\n    }\n  } else {\n    // Not a redirect, set redirectUser_ to return null.\n    this.setRedirectResolve_({\n      'user': null\n    });\n  }\n  // Reset all pending promises.\n  this.redirectResolve_ = [];\n  this.redirectReject_ = [];\n};\n\n\n/**\n * Returns the redirect result. If coming back from a successful redirect sign\n * in, will resolve to the signed in user. If coming back from an unsuccessful\n * redirect sign, will reject with the proper error. If no redirect operation\n * called, resolves with null.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.RedirectAuthEventProcessor.prototype.getRedirectResult = function() {\n  var self = this;\n  // Initial result could be overridden in the case of Cordova.\n  // Auth domain must be included for this to resolve.\n  // If still pending just return the pending promise.\n  var p = new goog.Promise(function(resolve, reject) {\n    // The following logic works if this method was called before Auth event\n    // is triggered.\n    if (!self.redirectedUserPromise_) {\n      // Save resolves and rejects of pending promise for redirect operation.\n      self.redirectResolve_.push(resolve);\n      self.redirectReject_.push(reject);\n      // Start timeout listener to getRedirectResult pending promise.\n      // Call this only when redirectedUserPromise_ is not determined.\n      self.startRedirectTimeout_();\n    } else {\n      // Called after Auth event is triggered.\n      self.redirectedUserPromise_().then(resolve, reject);\n    }\n  });\n  return /** @type {!goog.Promise<!fireauth.AuthEventManager.Result>} */ (p);\n};\n\n\n/**\n * Starts timeout listener for getRedirectResult pending promise. This method\n * should not be called again after getRedirectResult's redirectedUserPromise_\n * is determined.\n * @private\n */\nfireauth.RedirectAuthEventProcessor.prototype.startRedirectTimeout_ =\n    function() {\n  // Expire pending timeout promise for popup operation.\n  var self = this;\n  var error = new fireauth.AuthError(\n      fireauth.authenum.Error.TIMEOUT);\n  if (this.redirectTimeoutPromise_) {\n    this.redirectTimeoutPromise_.cancel();\n  }\n  // For redirect mode.\n  this.redirectTimeoutPromise_ =\n      goog.Timer.promise(fireauth.AuthEventManager.REDIRECT_TIMEOUT_MS_.get())\n      .then(function() {\n        // If not resolved yet, reject with timeout error.\n        if (!self.redirectedUserPromise_) {\n          // Consider redirect result resolved.\n          self.redirectResultResolved_ = true;\n          self.setRedirectResult_(true, null, error);\n        }\n      });\n\n};\n\n\n\n/**\n * Popup Auth event manager.\n * @param {!fireauth.AuthEventManager} manager The parent Auth event manager.\n * @constructor\n * @implements {fireauth.AuthEventProcessor}\n */\nfireauth.PopupAuthEventProcessor = function(manager) {\n  this.manager_ = manager;\n};\n\n\n/**\n * Completes the processing of an external Auth event detected by the embedded\n * iframe.\n * @param {?fireauth.AuthEvent} authEvent External Auth event detected by\n *     iframe.\n * @param {!fireauth.AuthEventHandler} owner The owner of the event.\n * @return {!goog.Promise<undefined>}\n * @override\n */\nfireauth.PopupAuthEventProcessor.prototype.processAuthEvent =\n    function(authEvent, owner) {\n  // This should not happen as fireauth.iframe.AuthRelay will not send null\n  // events.\n  if (!authEvent) {\n    return goog.Promise.reject(\n        new fireauth.AuthError(fireauth.authenum.Error.INVALID_AUTH_EVENT));\n  }\n  var mode = authEvent.getType();\n  var eventId = authEvent.getEventId();\n  if (authEvent.hasError()) {\n    return this.processErrorEvent_(authEvent, owner);\n  } else if (owner.getAuthEventHandlerFinisher(mode, eventId)) {\n    return this.processSuccessEvent_(authEvent, owner);\n  } else {\n    return goog.Promise.reject(\n        new fireauth.AuthError(fireauth.authenum.Error.INVALID_AUTH_EVENT));\n  }\n};\n\n\n/**\n * Processes an error event.\n * @param {?fireauth.AuthEvent} authEvent External Auth event detected by\n *     iframe.\n * @param {!fireauth.AuthEventHandler} owner The owner of the event.\n * @return {!goog.Promise<undefined>}\n * @private\n */\nfireauth.PopupAuthEventProcessor.prototype.processErrorEvent_ =\n    function(authEvent, owner) {\n  var eventId = authEvent.getEventId();\n  var mode = authEvent.getType();\n  // For pending popup promises trigger rejects with the error.\n  owner.resolvePendingPopupEvent(mode, null, authEvent.getError(), eventId);\n  return goog.Promise.resolve();\n};\n\n\n/**\n * Processes a successful event.\n * @param {?fireauth.AuthEvent} authEvent External Auth event detected by\n *     iframe.\n * @param {!fireauth.AuthEventHandler} owner The owner of the event.\n * @return {!goog.Promise<undefined>}\n * @private\n */\nfireauth.PopupAuthEventProcessor.prototype.processSuccessEvent_ =\n    function(authEvent, owner) {\n  var eventId = authEvent.getEventId();\n  var mode = authEvent.getType();\n  var handler = owner.getAuthEventHandlerFinisher(mode, eventId);\n  // Successful operation, complete the exchange for an ID token.\n  var requestUri = /** @type {string} */ (authEvent.getUrlResponse());\n  var sessionId = /** @type {string} */ (authEvent.getSessionId());\n  var postBody = /** @type {?string} */ (authEvent.getPostBody());\n  var tenantId = /** @type {?string} */ (authEvent.getTenantId());\n  // Complete sign in or link account operation and then pass result to\n  // relevant pending popup promise.\n  return handler(requestUri, sessionId, tenantId, postBody)\n      .then(function(popupRedirectResponse) {\n    // Flow completed.\n    // Resolve pending popup promise if it exists.\n    owner.resolvePendingPopupEvent(mode, popupRedirectResponse, null, eventId);\n  }).thenCatch(function(error) {\n    // Flow not completed due to error.\n    // Resolve pending promise if it exists.\n    owner.resolvePendingPopupEvent(\n        mode, null, /** @type {!fireauth.AuthError} */ (error), eventId);\n    // Always resolve.\n    return;\n  });\n};\n\n\n\n/**\n * The interface that represents an Auth event handler. It provides the\n * ability for the Auth event manager to determine the owner of an Auth event,\n * the ability to resolve a pending popup event and the appropriate handler for\n * an event.\n * @interface\n */\nfireauth.AuthEventHandler = function() {};\n\n\n/**\n * @param {!fireauth.AuthEvent.Type} mode The Auth type mode.\n * @param {?string=} opt_eventId The event ID.\n * @return {boolean} Whether the Auth event handler can handler the provided\n *     event.\n */\nfireauth.AuthEventHandler.prototype.canHandleAuthEvent =\n    function(mode, opt_eventId) {};\n\n\n/**\n * Completes the pending popup operation. If error is not null, rejects with the\n * error. Otherwise, it resolves with the popup redirect result.\n * @param {!fireauth.AuthEvent.Type} mode The Auth type mode.\n * @param {?fireauth.AuthEventManager.Result} popupRedirectResult The result\n *     to resolve with when no error supplied.\n * @param {?fireauth.AuthError} error When supplied, the promise will reject.\n * @param {?string=} opt_eventId The event ID.\n */\nfireauth.AuthEventHandler.prototype.resolvePendingPopupEvent =\n    function(mode, popupRedirectResult, error, opt_eventId) {};\n\n\n/**\n * Returns the handler's appropriate popup and redirect sign in operation\n * finisher.\n * @param {!fireauth.AuthEvent.Type} mode The Auth type mode.\n * @param {?string=} opt_eventId The optional event ID.\n * @return {?function(string, string, ?string,\n *     ?string=):!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthEventHandler.prototype.getAuthEventHandlerFinisher =\n    function(mode, opt_eventId) {};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n /**\n * @fileoverview Defines the firebase.auth.AuthSettings structure.\n */\n\ngoog.provide('fireauth.AuthSettings');\n\n\n/**\n * The class used to initialize an Auth settings object currently used to\n * enable or disable app verification for testing.\n * @constructor\n */\nfireauth.AuthSettings = function() {\n  this.appVerificationDisabledForTesting_ = false;\n  Object.defineProperty(\n      /** @type {!Object} */ (this),\n      'appVerificationDisabled',\n      {\n        /**\n         * @this {!Object}\n         * @return {boolean} The current status.\n         */\n        get: function() {\n          return this.getAppVerificationDisabledForTesting();\n        },\n        /**\n         * @this {!Object}\n         * @param {boolean} value The new status.\n         */\n        set: function(value) {\n          this.setAppVerificationDisabledForTesting(value);\n        },\n        enumerable: false\n      });\n};\n\n\n/**\n * Sets whether app verification is disable for testing.\n * @param {boolean} status App verification status for testing.\n */\nfireauth.AuthSettings.prototype.setAppVerificationDisabledForTesting =\n    function(status) {\n  this.appVerificationDisabledForTesting_ = status;\n};\n\n\n/**\n * @return {boolean} Whether app verification is enabled or disabled for\n *     testing.\n */\nfireauth.AuthSettings.prototype.getAppVerificationDisabledForTesting =\n    function() {\n  return this.appVerificationDisabledForTesting_;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the firebase.auth.ConfirmationResult. This is needed\n * to provide first class support for phone Auth API: signInWithPhoneNumber,\n * linkWithPhoneNumber and reauthenticateWithPhoneNumber.\n */\n\ngoog.provide('fireauth.ConfirmationResult');\n\ngoog.require('fireauth.PhoneAuthProvider');\ngoog.require('fireauth.object');\ngoog.require('goog.Promise');\n\n\n/**\n * The confirmation result class. This takes in the verification ID returned\n * from the phone Auth provider and the credential resolver to run when\n * confirming with a verification code.\n * @param {string} verificationId The verification ID returned from the Phone\n *     Auth provider after sending the verification code.\n * @param {!function(!fireauth.AuthCredential):\n *     !goog.Promise<!fireauth.AuthEventManager.Result>} credentialResolver a\n *     function that takes in an AuthCredential and returns a promise that\n *     resolves with a UserCredential object.\n * @constructor\n */\nfireauth.ConfirmationResult = function(verificationId, credentialResolver) {\n  /**\n   * @const @private {!function(!fireauth.AuthCredential):\n   *     !goog.Promise<!fireauth.AuthEventManager.Result>} A function that takes\n   *     in an AuthCredential and returns a promise that resolves with a\n   *     UserCredential object.\n   */\n  this.credentialResolver_ = credentialResolver;\n  // Set verificationId as read-only property.\n  fireauth.object.setReadonlyProperty(this, 'verificationId', verificationId);\n};\n\n\n/**\n * Confirms the verification code and returns a promise that resolves with the\n * User Credential object.\n * @param {string} verificationCode The phone Auth verification code to use to\n *     complete the Auth flow.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.ConfirmationResult.prototype.confirm = function(verificationCode) {\n  // Initialize a phone Auth credential with the verification ID and code.\n  var credential = fireauth.PhoneAuthProvider.credential(\n      this['verificationId'], verificationCode);\n  // Run the credential resolver with the phone Auth credential and return its\n  // result.\n  return this.credentialResolver_(credential);\n};\n\n\n/**\n * Initializes a ConfirmationResult using the provided phone number, app\n * verifier and returns it asynchronously. On code confirmation, the result will\n * resolve using the credential resolver provided.\n * @param {!fireauth.Auth} auth The corresponding Auth instance.\n * @param {string} phoneNumber The phone number to authenticate with.\n * @param {!firebase.auth.ApplicationVerifier} appVerifier The application\n *     verifier.\n * @param {!function(!fireauth.AuthCredential):\n *     !goog.Promise<!fireauth.AuthEventManager.Result>} credentialResolver a\n *     function that takes in an AuthCredential and returns a promise that\n *     resolves with a UserCredential object.\n * @return {!goog.Promise<!fireauth.ConfirmationResult>}\n */\nfireauth.ConfirmationResult.initialize =\n    function(auth, phoneNumber, appVerifier, credentialResolver) {\n  // Initialize a phone Auth provider instance using the provided Auth\n  // instance.\n  var phoneAuthProvider = new fireauth.PhoneAuthProvider(auth);\n  // Verify the phone number.\n  return phoneAuthProvider.verifyPhoneNumber(phoneNumber, appVerifier)\n      .then(function(verificationId) {\n        // When code is sent and verification ID is returned, initialize a\n        // ConfirmationResult with the returned verification ID and credential\n        // resolver, and return that instance.\n        return new fireauth.ConfirmationResult(\n            verificationId, credentialResolver);\n      });\n};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the firebase.auth.IdTokenResult class that is obtained\n * from getIdTokenResult. It contains the ID token JWT string and other helper\n * properties for getting different data associated with the token as well as\n * all the decoded payload claims.\n */\n\ngoog.provide('fireauth.IdTokenResult');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.IdToken');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.object');\ngoog.require('fireauth.util');\n\n\n\n/**\n * This is the ID token result object obtained from getIdTokenResult. It\n * contains the ID token JWT string and other helper properties for getting\n * different data associated with the token as well as all the decoded payload\n * claims.\n * @param {string} tokenString The JWT token.\n * @constructor\n */\nfireauth.IdTokenResult = function(tokenString) {\n  var idToken = fireauth.IdToken.parseIdTokenClaims(tokenString);\n  if (!idToken || !idToken['exp'] || !idToken['auth_time'] || !idToken['iat']) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.INTERNAL_ERROR,\n        'An internal error occurred. The token obtained by Firebase appears ' +\n        'to be malformed. Please retry the operation.');\n  }\n  fireauth.object.setReadonlyProperties(this, {\n    'token': tokenString,\n    'expirationTime': fireauth.util.utcTimestampToDateString(\n        idToken['exp'] * 1000),\n    'authTime': fireauth.util.utcTimestampToDateString(\n        idToken['auth_time'] * 1000),\n    'issuedAtTime': fireauth.util.utcTimestampToDateString(\n        idToken['iat'] * 1000),\n    'signInProvider': (idToken['firebase'] &&\n                       idToken['firebase']['sign_in_provider']) ?\n                      idToken['firebase']['sign_in_provider'] : null,\n    'claims': idToken\n  });\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Utility for proactive refresh with exponential backoff\n * algorithm typically used to define a retry policy for certain async\n * operations.\n */\n\ngoog.provide('fireauth.ProactiveRefresh');\n\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.Timer');\n\n\n/**\n * The helper utility used to proactively refresh a certain operation based on\n * certain constraints with an exponential backoff retrial policy when\n * specific recoverable errors occur. Typically this is used to retry an\n * operation on network errors.\n * @param {!function():!goog.Promise} operation The promise returning operation\n *     to run.\n * @param {!function(*):boolean} retryPolicy A function that takes in an error\n *     and returns whether a retry policy should be implemented based on the\n *     error. If not, the operation will not run again.\n * @param {!function():number} getWaitDuration A function that returns the wait\n *     period before running again.\n * @param {number} lowerBound The lower bound duration to wait when an error\n *     occurs. This is the first interval to wait before rerunning after an\n *     error is detected.\n * @param {number} upperBound The upper bound duration to wait when an error\n *     keeps occurring. This upper bound should not be exceeded.\n * @param {boolean=} opt_runInBackground Whether to run in the background, when\n *     the tab is not visible. If the refresh should only run when the app is\n *     visible, the operation will block until the app is visible and then run.\n * @constructor @struct @final\n */\nfireauth.ProactiveRefresh = function(\n    operation,\n    retryPolicy,\n    getWaitDuration,\n    lowerBound,\n    upperBound,\n    opt_runInBackground) {\n  /**\n   * @const @private {!function():!goog.Promise} The promise returning operation\n   *     to run.\n   */\n  this.operation_ = operation;\n  /**\n   * @const @private {!function(*):boolean} The function that takes in an error\n   *     and returns whether a retry policy should be implemented based on the\n   *     error caught.\n   */\n  this.retryPolicy_ = retryPolicy;\n  /**\n   * @const @private {!function():number} The function that returns the wait\n   *     period after a successful operation before running again.\n   */\n  this.getWaitDuration_ = getWaitDuration;\n  /**\n   * @const @private {number} The lower bound duration to wait when an error\n   *     first occurs.\n   */\n  this.lowerBound_ = lowerBound;\n  /**\n   * @const @private {number} The upper bound duration to wait when an error\n   *     keeps occurring. This upper bound should not be exceeded.\n   */\n  this.upperBound_ = upperBound;\n  /**\n   * @const @private {boolean} Whether to run in the background, when the tab is\n   *     not visible.\n   */\n  this.runInBackground_ = !!opt_runInBackground;\n  /**\n   * @private {?goog.Promise} The pending promise for the next operation to run.\n   */\n  this.pending_ = null;\n  /**\n   * @private {number} The first wait interval when a new error occurs.\n   */\n  this.nextErrorWaitInterval_ = this.lowerBound_;\n  // Throw an error if the lower bound is greater than upper bound.\n  if (this.upperBound_ < this.lowerBound_) {\n    throw new Error('Proactive refresh lower bound greater than upper bound!');\n  }\n};\n\n\n/** Starts the proactive refresh based on the current configuration. */\nfireauth.ProactiveRefresh.prototype.start = function() {\n  // Set the next error wait interval to the lower bound. On each consecutive\n  // error, this will double in value until it reaches the upper bound.\n  this.nextErrorWaitInterval_ = this.lowerBound_;\n  // Start proactive refresh with clean slate (successful status).\n  this.process_(true);\n};\n\n\n/**\n * Returns the wait duration before the next run depending on the last run\n * status. If the last operation has succeeded, returns the getWaitDuration()\n * response. Otherwise, doubles the last error wait interval starting from\n * lowerBound and up to upperBound.\n * @param {boolean} hasSucceeded Whether last run succeeded.\n * @return {number} The wait time for the next run.\n * @private\n */\nfireauth.ProactiveRefresh.prototype.getNextRun_ = function(hasSucceeded) {\n  if (hasSucceeded) {\n    // If last operation succeeded, reset next error wait interval and return\n    // the default wait duration.\n    this.nextErrorWaitInterval_ = this.lowerBound_;\n    // Return typical wait duration interval after a successful operation.\n    return this.getWaitDuration_();\n  } else {\n    // Get next error wait interval.\n    var currentErrorWaitInterval = this.nextErrorWaitInterval_;\n    // Double interval for next consecutive error.\n    this.nextErrorWaitInterval_ *= 2;\n    // Make sure next wait interval does not exceed the maximum upper bound.\n    if (this.nextErrorWaitInterval_  > this.upperBound_) {\n      this.nextErrorWaitInterval_  = this.upperBound_;\n    }\n    return currentErrorWaitInterval;\n  }\n};\n\n\n/**\n * Processes one refresh call and sets the timer for the next call based on\n * the last recorded result.\n * @param {boolean} hasSucceeded Whether last run succeeded.\n * @private\n */\nfireauth.ProactiveRefresh.prototype.process_ = function(hasSucceeded) {\n  var self = this;\n  // Stop any other pending operation.\n  this.stop();\n  // Wait for next scheduled run based on whether an error occurred during last\n  // run.\n  this.pending_ = goog.Timer.promise(this.getNextRun_(hasSucceeded))\n      .then(function() {\n        // Block for conditions (if app is required to be visible) to be ready.\n        return self.waitUntilReady_();\n       })\n       .then(function() {\n         // Run the operation.\n         return self.operation_();\n       })\n      .then(function() {\n         // If successful, try again on next cycle with no previous error\n         // passed.\n         self.process_(true);\n       })\n      .thenCatch(function(error) {\n         // If an error occurs, only rerun when the error meets the retry\n         // policy.\n         if (self.retryPolicy_(error)) {\n           // Should retry with error to trigger exponentional backoff.\n           self.process_(false);\n         }\n         // Any other error is considered unrecoverable. Do not try again.\n       });\n};\n\n\n/**\n * Returns a promise which resolves when the current tab is visible.\n * This resolves quickly if refresh is supposed to run in the background too.\n * @return {!goog.Promise} The promise that resolves when the tab is visible or\n *     that requirement is not needed.\n * @private\n */\nfireauth.ProactiveRefresh.prototype.waitUntilReady_ = function() {\n  // Wait until app is in foreground if required.\n  if (this.runInBackground_) {\n    // If runs in background, resolve quickly.\n    return goog.Promise.resolve();\n  } else {\n    // Wait for the app to be visible before resolving the promise.\n    return fireauth.util.onAppVisible();\n  }\n};\n\n\n/** Stops the proactive refresh from running again. */\nfireauth.ProactiveRefresh.prototype.stop = function() {\n  // If there is a pending promise.\n  if (this.pending_) {\n    // Cancel the pending promise and nullify it.\n    this.pending_.cancel();\n    this.pending_ = null;\n  }\n};\n\n\n/** @return {boolean} Whether the proactive refresh is running or not. */\nfireauth.ProactiveRefresh.prototype.isRunning = function() {\n  return !!this.pending_;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Utility class to retrieve and cache STS token.\n */\ngoog.provide('fireauth.StsTokenManager');\ngoog.provide('fireauth.StsTokenManager.Response');\ngoog.provide('fireauth.StsTokenManager.ResponseData');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.RpcHandler');\ngoog.require('fireauth.authenum.Error');\ngoog.require('goog.Promise');\ngoog.require('goog.asserts');\n\n\n\n/**\n * Creates STS token manager.\n *\n * @param {!fireauth.RpcHandler} rpcHandler Handler for RPC requests.\n * @constructor\n */\nfireauth.StsTokenManager = function(rpcHandler) {\n  /**\n   * @const @private {!fireauth.RpcHandler} The RPC handler used to request STS\n   *     tokens.\n   */\n  this.rpcHandler_ = rpcHandler;\n  /** @private {?string} The STS refresh token. */\n  this.refreshToken_ = null;\n  /** @private {?string} The STS ID token. */\n  this.accessToken_ = null;\n  /** @private {number} The STS expiration timestamp. */\n  this.expirationTime_ = 0;\n};\n\n\n/**\n * @return {!Object} The plain object representation of the STS token manager.\n */\nfireauth.StsTokenManager.prototype.toPlainObject = function() {\n  return {\n    'apiKey': this.rpcHandler_.getApiKey(),\n    'refreshToken': this.refreshToken_,\n    'accessToken': this.accessToken_,\n    'expirationTime': this.expirationTime_\n  };\n};\n\n\n/**\n * @param {!fireauth.RpcHandler} rpcHandler The RPC handler for the token\n *     manager.\n * @param {?Object} obj The plain object whose STS token manager instance is to\n *     be returned.\n * @return {?fireauth.StsTokenManager} The STS token manager instance from the\n *     plain object provided using the RPC handler provided.\n */\nfireauth.StsTokenManager.fromPlainObject = function(rpcHandler, obj) {\n  var stsTokenManager = null;\n  if (obj && obj['apiKey']) {\n    // These should be always equals and must be enforced in internal use.\n    goog.asserts.assert(obj['apiKey'] == rpcHandler.getApiKey());\n    stsTokenManager = new fireauth.StsTokenManager(rpcHandler);\n    stsTokenManager.setRefreshToken(obj['refreshToken']);\n    stsTokenManager.setAccessToken(\n        obj['accessToken'], obj['expirationTime'] || 0);\n  }\n  return stsTokenManager;\n};\n\n\n/**\n * @typedef {{\n *   accessToken: (?string),\n *   expirationTime: (number),\n *   refreshToken: (?string)\n * }}\n */\nfireauth.StsTokenManager.Response;\n\n\n/**\n * @typedef {{\n *   access_token: (?string|undefined),\n *   expires_in: (number|undefined),\n *   refresh_token: (?string|undefined)\n * }}\n */\nfireauth.StsTokenManager.ResponseData;\n\n\n/**\n * @param {?string} refreshToken The STS refresh token.\n */\nfireauth.StsTokenManager.prototype.setRefreshToken = function(refreshToken) {\n  this.refreshToken_ = refreshToken;\n};\n\n\n/**\n * @param {?string} accessToken The STS access token.\n * @param {number} expirationTime  The STS token expiration time.\n */\nfireauth.StsTokenManager.prototype.setAccessToken = function(\n    accessToken, expirationTime) {\n  this.accessToken_ = accessToken;\n  this.expirationTime_ = expirationTime;\n};\n\n\n/**\n * @return {?string} The refresh token.\n */\nfireauth.StsTokenManager.prototype.getRefreshToken = function() {\n  return this.refreshToken_;\n};\n\n\n/**\n * @return {number} The STS access token expiration time.\n */\nfireauth.StsTokenManager.prototype.getExpirationTime = function() {\n  return this.expirationTime_;\n};\n\n\n/**\n * The number of milliseconds before the official expiration time of a token\n * to refresh that token, to provide a buffer for RPCs to complete.\n * @const {number}\n * @private\n */\nfireauth.StsTokenManager.TOKEN_REFRESH_BUFFER_ = 30 * 1000;\n\n\n/**\n * @return {boolean} Whether the STS access token is expired or not.\n * @private\n */\nfireauth.StsTokenManager.prototype.isExpired_ = function() {\n  return goog.now() >\n      this.expirationTime_ - fireauth.StsTokenManager.TOKEN_REFRESH_BUFFER_;\n};\n\n\n/**\n * Parses a response from the server that contains STS tokens (e.g. from\n * VerifyAssertion or VerifyPassword) and save the access token, refresh token,\n * and expiration time.\n * @param {!Object} response The backend response.\n * @return {!string} The STS access token.\n */\nfireauth.StsTokenManager.prototype.parseServerResponse = function(response) {\n  var idToken = response[fireauth.RpcHandler.AuthServerField.ID_TOKEN];\n  var refreshToken =\n      response[fireauth.RpcHandler.AuthServerField.REFRESH_TOKEN];\n  var expirationTime = fireauth.StsTokenManager.calcOffsetTimestamp_(\n      response[fireauth.RpcHandler.AuthServerField.EXPIRES_IN]);\n  this.setAccessToken(idToken, expirationTime);\n  this.setRefreshToken(refreshToken);\n  return idToken;\n};\n\n\n/**\n * Converts STS token manager instance to server response object.\n * @return {!Object}\n */\nfireauth.StsTokenManager.prototype.toServerResponse = function() {\n  var stsTokenManagerResponse = {};\n  stsTokenManagerResponse[fireauth.RpcHandler.AuthServerField.ID_TOKEN] =\n      this.accessToken_;\n  // Refresh token could be expired.\n  stsTokenManagerResponse[fireauth.RpcHandler.AuthServerField.REFRESH_TOKEN] =\n      this.getRefreshToken();\n  stsTokenManagerResponse[fireauth.RpcHandler.AuthServerField.EXPIRES_IN] =\n      (this.getExpirationTime() - goog.now()) / 1000;\n  return stsTokenManagerResponse;\n};\n\n\n/**\n * Copies IdToken, refreshToken and expirationTime from tokenManagerToCopy.\n * @param {!fireauth.StsTokenManager} tokenManagerToCopy\n */\nfireauth.StsTokenManager.prototype.copy = function(tokenManagerToCopy) {\n  this.accessToken_ = tokenManagerToCopy.accessToken_;\n  this.refreshToken_ = tokenManagerToCopy.refreshToken_;\n  this.expirationTime_ = tokenManagerToCopy.expirationTime_;\n};\n\n\n/**\n * @param {number|string} offset The offset to add to the current time, in\n *     seconds.\n * @return {number} The timestamp corresponding to the current time plus offset.\n * @private\n */\nfireauth.StsTokenManager.calcOffsetTimestamp_ = function(offset) {\n  return goog.now() + parseInt(offset, 10) * 1000;\n};\n\n\n/**\n * Exchanges the current refresh token with an access and refresh token.\n * @return {!goog.Promise<?fireauth.StsTokenManager.Response>}\n * @private\n */\nfireauth.StsTokenManager.prototype.exchangeRefreshToken_ = function() {\n  var data = {\n    'grant_type': 'refresh_token',\n    'refresh_token': this.refreshToken_\n  };\n  return this.requestToken_(data);\n};\n\n\n/**\n * Sends a request to STS token endpoint for an access/refresh token.\n * @param {!Object} data The request data to send to STS token endpoint.\n * @return {!goog.Promise<?fireauth.StsTokenManager.Response>}\n * @private\n */\nfireauth.StsTokenManager.prototype.requestToken_ = function(data) {\n  var self = this;\n  // Send RPC request to STS token endpoint.\n  return this.rpcHandler_.requestStsToken(data).then(function(resp) {\n    var response = /** @type {!fireauth.StsTokenManager.ResponseData} */ (resp);\n    self.accessToken_ =\n        response[fireauth.RpcHandler.StsServerField.ACCESS_TOKEN];\n    // Update expiration time.\n    self.expirationTime_ = fireauth.StsTokenManager.calcOffsetTimestamp_(\n        response[fireauth.RpcHandler.StsServerField.EXPIRES_IN]);\n    self.refreshToken_ =\n        response[fireauth.RpcHandler.StsServerField.REFRESH_TOKEN];\n    return /** @type {fireauth.StsTokenManager.Response} */ ({\n      'accessToken': self.accessToken_,\n      'expirationTime': self.expirationTime_,\n      'refreshToken': self.refreshToken_\n    });\n  }).thenCatch(function(error) {\n    // Refresh token expired or user deleted. In this case, reset refresh token\n    // to prevent sending the request again to the STS server unless\n    // the token is manually updated, perhaps via successful reauthentication.\n    if (error['code'] == 'auth/user-token-expired') {\n      self.refreshToken_ = null;\n    }\n    throw error;\n  });\n};\n\n\n/** @return {boolean} Whether the refresh token is expired. */\nfireauth.StsTokenManager.prototype.isRefreshTokenExpired = function() {\n  return !!(this.accessToken_ && !this.refreshToken_);\n};\n\n\n/**\n * Returns an STS token. If the cached one is unexpired it is directly returned.\n * Otherwise the existing ID token or refresh token is exchanged for a new one.\n * If there is no user signed in, returns null.\n *\n * @param {boolean=} opt_forceRefresh Whether to force refresh token exchange.\n * @return {!goog.Promise<?fireauth.StsTokenManager.Response>}\n */\nfireauth.StsTokenManager.prototype.getToken = function(opt_forceRefresh) {\n  var self = this;\n  var forceRefresh = !!opt_forceRefresh;\n  // Refresh token is expired.\n  if (this.isRefreshTokenExpired()) {\n    return goog.Promise.reject(\n        new fireauth.AuthError(fireauth.authenum.Error.TOKEN_EXPIRED));\n  }\n  if (!forceRefresh && this.accessToken_ && !this.isExpired_()) {\n    // Cached STS access token not expired, return it.\n    return /** @type {!goog.Promise} */ (goog.Promise.resolve({\n      'accessToken': self.accessToken_,\n      'expirationTime': self.expirationTime_,\n      'refreshToken': self.refreshToken_\n    }));\n  } else if (this.refreshToken_) {\n    // Expired but refresh token available, exchange refresh token for STS\n    // token.\n    return this.exchangeRefreshToken_();\n  } else {\n    // No token, return null token.\n    return goog.Promise.resolve(\n        /** @type {?fireauth.StsTokenManager.Response} */ (null));\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the user info pertaining to an identity provider and\n * the Firebase user object.\n */\n\ngoog.provide('fireauth.AuthUser');\ngoog.provide('fireauth.AuthUser.AccountInfo');\ngoog.provide('fireauth.AuthUserInfo');\ngoog.provide('fireauth.TokenRefreshTime');\ngoog.provide('fireauth.UserEvent');\ngoog.provide('fireauth.UserEventType');\ngoog.provide('fireauth.UserMetadata');\n\ngoog.require('fireauth.ActionCodeSettings');\ngoog.require('fireauth.AdditionalUserInfo');\ngoog.require('fireauth.AuthCredential');\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.AuthEvent');\ngoog.require('fireauth.AuthEventHandler');\ngoog.require('fireauth.AuthEventManager');\ngoog.require('fireauth.AuthProvider');\ngoog.require('fireauth.ConfirmationResult');\ngoog.require('fireauth.IdTokenResult');\ngoog.require('fireauth.PhoneAuthProvider');\ngoog.require('fireauth.ProactiveRefresh');\ngoog.require('fireauth.RpcHandler');\ngoog.require('fireauth.StsTokenManager');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.constants');\ngoog.require('fireauth.constants.AuthEventType');\ngoog.require('fireauth.deprecation');\ngoog.require('fireauth.idp');\ngoog.require('fireauth.iframeclient.IfcHandler');\ngoog.require('fireauth.object');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.array');\ngoog.require('goog.events');\ngoog.require('goog.events.Event');\ngoog.require('goog.events.EventTarget');\ngoog.require('goog.object');\n\n\n\n/**\n * Initializes an instance of a user metadata object.\n * @param {?string=} opt_createdAt The optional creation date UTC timestamp.\n * @param {?string=} opt_lastLoginAt The optional last login date UTC timestamp.\n * @constructor\n */\nfireauth.UserMetadata = function(opt_createdAt, opt_lastLoginAt) {\n  /** @private {?string} The created at UTC timestamp. */\n  this.createdAt_ = opt_createdAt || null;\n  /** @private {?string} The last login at UTC timestamp. */\n  this.lastLoginAt_ = opt_lastLoginAt || null;\n  fireauth.object.setReadonlyProperties(this, {\n    'lastSignInTime': fireauth.util.utcTimestampToDateString(\n        opt_lastLoginAt || null),\n    'creationTime': fireauth.util.utcTimestampToDateString(\n        opt_createdAt || null),\n  });\n};\n\n\n/**\n * @return {!fireauth.UserMetadata} A clone of the current user metadata object.\n */\nfireauth.UserMetadata.prototype.clone = function() {\n  return new fireauth.UserMetadata(this.createdAt_, this.lastLoginAt_);\n};\n\n\n/**\n * @return {!Object} The object representation of the user metadata instance.\n */\nfireauth.UserMetadata.prototype.toPlainObject = function() {\n  return {\n    'lastLoginAt': this.lastLoginAt_,\n    'createdAt': this.createdAt_\n  };\n};\n\n\n/**\n * Initializes an instance of the user info for an identity provider.\n * @param {string} uid The user ID.\n * @param {!fireauth.idp.ProviderId} providerId The provider ID.\n * @param {?string=} opt_email The optional user email.\n * @param {?string=} opt_displayName The optional display name.\n * @param {?string=} opt_photoURL The optional photo URL.\n * @param {?string=} opt_phoneNumber The optional phone number.\n * @constructor\n */\nfireauth.AuthUserInfo = function(\n    uid,\n    providerId,\n    opt_email,\n    opt_displayName,\n    opt_photoURL,\n    opt_phoneNumber) {\n  fireauth.object.setReadonlyProperties(this, {\n    'uid': uid,\n    'displayName': opt_displayName || null,\n    'photoURL': opt_photoURL || null,\n    'email': opt_email || null,\n    'phoneNumber': opt_phoneNumber || null,\n    'providerId': providerId\n  });\n};\n\n\n\n/**\n * User custom event.\n * @param {string} type The event type.\n * @param {?Object=} opt_properties The optional properties to set to the custom\n *     event using same keys as object provided.\n * @constructor\n * @extends {goog.events.Event}\n */\nfireauth.UserEvent = function(type, opt_properties) {\n  goog.events.Event.call(this, type);\n  // If optional properties provided.\n  // Add each property to custom event.\n  for (var key in opt_properties) {\n    this[key] = opt_properties[key];\n  }\n};\ngoog.inherits(fireauth.UserEvent, goog.events.Event);\n\n\n/**\n * Events dispatched by pages on containers.\n * @enum {string}\n */\nfireauth.UserEventType = {\n  /** Dispatched when token is changed due to Auth event. */\n  TOKEN_CHANGED: 'tokenChanged',\n\n  /** Dispatched when user is deleted. */\n  USER_DELETED: 'userDeleted',\n\n  /**\n   * Dispatched when user session is invalidated. This could happen when the\n   * following errors occur: user-disabled or user-token-expired.\n   */\n  USER_INVALIDATED: 'userInvalidated'\n};\n\n\n/**\n * Defines the proactive token refresh time constraints in milliseconds.\n * @enum {number}\n */\nfireauth.TokenRefreshTime = {\n  /**\n   * The offset time before token natural expiration to run the refresh.\n   * This is currently 5 minutes.\n   */\n  OFFSET_DURATION: 5 * 60 * 1000,\n  /**\n   * This is the first retrial wait after an error. This is currently\n   * 30 seconds.\n   */\n  RETRIAL_MIN_WAIT: 30 * 1000,\n  /**\n   * This is the maximum retrial wait, currently 16 minutes.\n   */\n  RETRIAL_MAX_WAIT: 16 * 60 * 1000\n};\n\n\n\n/**\n * The Firebase user.\n * @param {!Object} appOptions The application options.\n * @param {!Object} stsTokenResponse The server STS token response.\n * @param {?Object=} opt_accountInfo The optional user account info.\n * @constructor\n * @extends {goog.events.EventTarget}\n * @implements {fireauth.AuthEventHandler}\n */\nfireauth.AuthUser =\n    function(appOptions, stsTokenResponse, opt_accountInfo) {\n  /** @private {!Array<!goog.Promise<*, *>|!goog.Promise<void>>} List of pending\n   *      promises. */\n  this.pendingPromises_ = [];\n  // User is only created via Auth so API key should always be available.\n  /** @private {string} The API key. */\n  this.apiKey_ = /** @type {string} */ (appOptions['apiKey']);\n  // This is needed to associate a user to the corresponding Auth instance.\n  /** @private {string} The App name. */\n  this.appName_ = /** @type {string} */ (appOptions['appName']);\n  /** @private {?string} The Auth domain. */\n  this.authDomain_ = appOptions['authDomain'] || null;\n  var clientFullVersion = firebase.SDK_VERSION ?\n      fireauth.util.getClientVersion(\n          fireauth.util.ClientImplementation.JSCORE, firebase.SDK_VERSION) :\n      null;\n  /** @private {!fireauth.RpcHandler} The RPC handler instance. */\n  this.rpcHandler_ = new fireauth.RpcHandler(\n      this.apiKey_,\n      // Get the client Auth endpoint used.\n      fireauth.constants.getEndpointConfig(fireauth.constants.clientEndpoint),\n      clientFullVersion);\n  // TODO: Consider having AuthUser take a fireauth.StsTokenManager\n  // instance instead of a token response but make sure lastAccessToken_ also\n  // initialized at the right time. In this case initializeFromIdTokenResponse\n  // will take in a token response object and convert it to an instance of\n  // fireauth.StsTokenManager to properly initialize user.\n  /** @private {!fireauth.StsTokenManager} The STS token manager instance. */\n  this.stsTokenManager_ = new fireauth.StsTokenManager(this.rpcHandler_);\n\n  this.setLastAccessToken_(\n      stsTokenResponse[fireauth.RpcHandler.AuthServerField.ID_TOKEN]);\n  // STS token manager will always be populated using server response.\n  this.stsTokenManager_.parseServerResponse(stsTokenResponse);\n  fireauth.object.setReadonlyProperty(\n      this, 'refreshToken', this.stsTokenManager_.getRefreshToken());\n  this.setAccountInfo(/** @type {!fireauth.AuthUser.AccountInfo} */ (\n      opt_accountInfo || {}));\n  // Add call to superclass constructor.\n  fireauth.AuthUser.base(this, 'constructor');\n  /** @private {boolean} Whether popup and redirect is enabled on the user. */\n  this.popupRedirectEnabled_ = false;\n  if (this.authDomain_ &&\n      fireauth.AuthEventManager.ENABLED &&\n      // Make sure popup and redirects are supported in the current environment.\n      fireauth.util.isPopupRedirectSupported()) {\n    // Get the Auth event manager associated with this user.\n    this.authEventManager_ = fireauth.AuthEventManager.getManager(\n        this.authDomain_, this.apiKey_, this.appName_);\n  }\n  /** @private {!Array<!function(!fireauth.AuthUser):!goog.Promise>} The list of\n   *      state change listeners. This is needed to make sure state changes are\n   *      resolved before resolving user API promises. For example redirect\n   *      operations should make sure the associated event ID is saved before\n   *      redirecting.\n   */\n  this.stateChangeListeners_ = [];\n  /**\n   * @private {?fireauth.AuthError} The user invalidation error if it exists.\n   */\n  this.userInvalidatedError_ = null;\n  /**\n   * @private {!fireauth.ProactiveRefresh} The reference to the proactive token\n   *     refresher utility for the current user.\n   */\n  this.proactiveRefresh_ = this.initializeProactiveRefreshUtility_();\n  /**\n   * @private {!function(!Object)} The handler for user token changes used to\n   *     realign the proactive token refresh with external token refresh calls.\n   */\n  this.userTokenChangeListener_ = goog.bind(this.handleUserTokenChange_, this);\n  var self = this;\n  /** @private {?string} The current user's language code. */\n  this.languageCode_ = null;\n  /**\n   * @private {function(!goog.events.Event)} The on language code changed event\n   *     handler.\n   */\n  this.onLanguageCodeChanged_ = function(event) {\n    // Update the user language code.\n    self.setLanguageCode(event.languageCode);\n  };\n  /**\n   * @private {?goog.events.EventTarget} The language code change event\n   *     dispatcher.\n   */\n  this.languageCodeChangeEventDispatcher_ = null;\n\n  /** @private {!Array<string>} The current Firebase frameworks. */\n  this.frameworks_ = [];\n  /**\n   * @private {function(!goog.events.Event)} The on framework list changed event\n   *     handler.\n   */\n  this.onFrameworkChanged_ = function(event) {\n    // Update the Firebase frameworks.\n    self.setFramework(event.frameworks);\n  };\n  /**\n   * @private {?goog.events.EventTarget} The framework change event dispatcher.\n   */\n  this.frameworkChangeEventDispatcher_ = null;\n};\ngoog.inherits(fireauth.AuthUser, goog.events.EventTarget);\n\n\n/**\n * Updates the user language code.\n * @param {?string} languageCode The current language code to use in user\n *     requests.\n */\nfireauth.AuthUser.prototype.setLanguageCode = function(languageCode) {\n  // Save current language.\n  this.languageCode_ = languageCode;\n  // Update the custom locale header.\n  this.rpcHandler_.updateCustomLocaleHeader(languageCode);\n};\n\n\n/** @return {?string} The current user's language code. */\nfireauth.AuthUser.prototype.getLanguageCode = function() {\n  return this.languageCode_;\n};\n\n\n/**\n * Listens to language code changes triggered by the provided dispatcher.\n * @param {?goog.events.EventTarget} dispatcher The language code changed event\n *     dispatcher.\n */\nfireauth.AuthUser.prototype.setLanguageCodeChangeDispatcher =\n    function(dispatcher) {\n  // Remove any previous listener.\n  if (this.languageCodeChangeEventDispatcher_) {\n    goog.events.unlisten(\n        this.languageCodeChangeEventDispatcher_,\n        fireauth.constants.AuthEventType.LANGUAGE_CODE_CHANGED,\n        this.onLanguageCodeChanged_);\n  }\n  // Update current dispatcher.\n  this.languageCodeChangeEventDispatcher_ = dispatcher;\n  // Using an event listener makes it easy for non-currentUsers to detect\n  // language changes on the parent Auth instance. A developer could still call\n  // APIs that require localization on signed out user references.\n  if (dispatcher) {\n    goog.events.listen(\n        dispatcher,\n        fireauth.constants.AuthEventType.LANGUAGE_CODE_CHANGED,\n        this.onLanguageCodeChanged_);\n  }\n};\n\n\n/**\n * Updates the Firebase frameworks on the current user.\n * @param {!Array<string>} framework The list of Firebase frameworks.\n */\nfireauth.AuthUser.prototype.setFramework = function(framework) {\n  // Save current frameworks.\n  this.frameworks_ = framework;\n  // Update the client version in RPC handler with the new frameworks.\n  this.rpcHandler_.updateClientVersion(firebase.SDK_VERSION ?\n        fireauth.util.getClientVersion(\n            fireauth.util.ClientImplementation.JSCORE, firebase.SDK_VERSION,\n            this.frameworks_) :\n        null);\n};\n\n\n/** @return {!Array<string>} The current Firebase frameworks. */\nfireauth.AuthUser.prototype.getFramework = function() {\n  return goog.array.clone(this.frameworks_);\n};\n\n\n/**\n * Listens to framework changes triggered by the provided dispatcher.\n * @param {?goog.events.EventTarget} dispatcher The framework changed event\n *     dispatcher.\n */\nfireauth.AuthUser.prototype.setFrameworkChangeDispatcher =\n    function(dispatcher) {\n  // Remove any previous listener.\n  if (this.frameworkChangeEventDispatcher_) {\n    goog.events.unlisten(\n        this.frameworkChangeEventDispatcher_,\n        fireauth.constants.AuthEventType.FRAMEWORK_CHANGED,\n        this.onFrameworkChanged_);\n  }\n  // Update current dispatcher.\n  this.frameworkChangeEventDispatcher_ = dispatcher;\n  // Using an event listener makes it easy for non-currentUsers to detect\n  // framework changes on the parent Auth instance.\n  if (dispatcher) {\n    goog.events.listen(\n        dispatcher,\n        fireauth.constants.AuthEventType.FRAMEWORK_CHANGED,\n        this.onFrameworkChanged_);\n  }\n};\n\n\n/**\n * Handles user token changes. Currently used to realign the proactive token\n * refresh internal timing with successful external token refreshes.\n * @param {!Object} event The token change event.\n * @private\n */\nfireauth.AuthUser.prototype.handleUserTokenChange_ = function(event) {\n  // If an external service refreshes the token, reset the proactive token\n  // refresh utility in case it is still running so the next run time is\n  // up to date.\n  // This will currently also trigger when the proactive refresh succeeds.\n  // This is not ideal but should not have any downsides. It just adds a\n  // redundant reset which can be optimized not to run in the future.\n  if (this.proactiveRefresh_.isRunning()) {\n    this.proactiveRefresh_.stop();\n    this.proactiveRefresh_.start();\n  }\n};\n\n\n/**\n * @return {!fireauth.Auth} The corresponding Auth instance that created the\n *     current user.\n * @private\n */\nfireauth.AuthUser.prototype.getAuth_ = function() {\n  try {\n    // Get the Auth instance for the current app identified by the App name.\n    // This could fail if, for example, the App instance was deleted.\n    return firebase['app'](this.appName_)['auth']();\n  } catch (e) {\n    // Throw appropriate error.\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.INTERNAL_ERROR,\n        'No firebase.auth.Auth instance is available for the Firebase App ' +\n        '\\'' + this.appName_ + '\\'!');\n  }\n};\n\n\n/**\n * @return {string} The user's API key.\n */\nfireauth.AuthUser.prototype.getApiKey = function() {\n  return this.apiKey_;\n};\n\n\n/**\n * Used to initialize the current user's proactive token refresher utility.\n * @return {!fireauth.ProactiveRefresh} The user's proactive token refresh\n *     utility.\n * @private\n */\nfireauth.AuthUser.prototype.initializeProactiveRefreshUtility_ = function() {\n  var self = this;\n  return new fireauth.ProactiveRefresh(\n      // Force ID token refresh right before expiration.\n      function() {\n        // Keep in mind when this fails for any reason other than a network\n        // error, it will effectively stop the proactive refresh.\n        return self.getIdToken(true);\n      },\n      // Retry only on network errors.\n      function(error) {\n        if (error && error.code == 'auth/network-request-failed') {\n          return true;\n        }\n        return false;\n      },\n      // Return next time to run with offset applied.\n      function() {\n        // Get time until expiration minus the refresh offset.\n        var waitInterval =\n            self.stsTokenManager_.getExpirationTime() - goog.now() -\n            fireauth.TokenRefreshTime.OFFSET_DURATION;\n        // Set to zero if wait interval is negative.\n        return waitInterval > 0 ? waitInterval : 0;\n      },\n      // Retrial minimum wait.\n      fireauth.TokenRefreshTime.RETRIAL_MIN_WAIT,\n      // Retrial maximum wait.\n      fireauth.TokenRefreshTime.RETRIAL_MAX_WAIT,\n      // Do not run in background as it is common to have multiple tabs open\n      // in a browser and this could increase QPS on server.\n      false);\n};\n\n\n/** Starts token proactive refresh. */\nfireauth.AuthUser.prototype.startProactiveRefresh = function() {\n  // Only allow if not destroyed and not already started.\n  if (!this.destroyed_ && !this.proactiveRefresh_.isRunning()) {\n    this.proactiveRefresh_.start();\n    // Unlisten any previous token change listener.\n    goog.events.unlisten(\n        this,\n        fireauth.UserEventType.TOKEN_CHANGED,\n        this.userTokenChangeListener_);\n    // Listen to token changes to reset the token refresher.\n    goog.events.listen(\n        this,\n        fireauth.UserEventType.TOKEN_CHANGED,\n        this.userTokenChangeListener_);\n  }\n};\n\n\n/** Stops token proactive refresh. */\nfireauth.AuthUser.prototype.stopProactiveRefresh = function() {\n  // Remove internal token change listener.\n  goog.events.unlisten(\n      this,\n      fireauth.UserEventType.TOKEN_CHANGED,\n      this.userTokenChangeListener_);\n  // Stop proactive token refresh.\n  this.proactiveRefresh_.stop();\n};\n\n\n/**\n * Sets latest access token for the AuthUser object.\n * @param {string} lastAccessToken\n * @private\n */\nfireauth.AuthUser.prototype.setLastAccessToken_ = function(lastAccessToken) {\n  /** @private {?string} Latest access token. */\n  this.lastAccessToken_ = lastAccessToken;\n  fireauth.object.setReadonlyProperty(this, '_lat', lastAccessToken);\n};\n\n\n/**\n * @param {!function(!fireauth.AuthUser):!goog.Promise} listener The listener\n *     to state changes to add.\n */\nfireauth.AuthUser.prototype.addStateChangeListener = function(listener) {\n  this.stateChangeListeners_.push(listener);\n};\n\n\n/**\n * @param {!function(!fireauth.AuthUser):!goog.Promise} listener The listener\n *     to state changes to remove.\n */\nfireauth.AuthUser.prototype.removeStateChangeListener = function(listener) {\n  goog.array.removeAllIf(this.stateChangeListeners_, function(ele) {\n    return ele == listener;\n  });\n};\n\n\n/**\n * Executes all state change listener promises and when all fulfilled, resolves\n * with the current user.\n * @return {!goog.Promise} A promise that resolves when all state listeners\n *     fulfilled.\n * @private\n */\nfireauth.AuthUser.prototype.notifyStateChangeListeners_ = function() {\n  var promises = [];\n  var self = this;\n  for (var i = 0; i < this.stateChangeListeners_.length; i++) {\n    // Run listener with Auth user instance and add to list of promises.\n    promises.push(this.stateChangeListeners_[i](this));\n  }\n  return goog.Promise.allSettled(promises).then(function(results) {\n    // State change errors should be recoverable even if errors occur.\n    return self;\n  });\n};\n\n\n/**\n * Sets the user current pending popup event ID.\n * @param {string} eventId The pending popup event ID.\n */\nfireauth.AuthUser.prototype.setPopupEventId = function(eventId) {\n  // Saving a popup event in a separate property other than redirectEventId\n  // would prevent a pending redirect event from being overwritten by a newly\n  // called popup operation.\n  this.popupEventId_ = eventId;\n};\n\n\n/**\n * @return {?string} The pending popup event ID.\n */\nfireauth.AuthUser.prototype.getPopupEventId = function() {\n  return this.popupEventId_ || null;\n};\n\n\n/**\n * Sets the user current pending redirect event ID.\n * @param {string} eventId The pending redirect event ID.\n */\nfireauth.AuthUser.prototype.setRedirectEventId = function(eventId) {\n  this.redirectEventId_ = eventId;\n};\n\n\n/**\n * @return {?string} The pending redirect event ID.\n */\nfireauth.AuthUser.prototype.getRedirectEventId = function() {\n  return this.redirectEventId_ || null;\n};\n\n\n/**\n * Subscribes to Auth event manager to handle popup and redirect events.\n * This is an explicit operation as users could exist in temporary states. For\n * example a user change could be detected in another tab. When syncing to those\n * changes, a temporary user is retrieved from storage and then copied to\n * existing user. The temporary user should not subscribe to Auth event changes.\n */\nfireauth.AuthUser.prototype.enablePopupRedirect = function() {\n  // Subscribe to Auth event manager if available.\n  if (this.authEventManager_ && !this.popupRedirectEnabled_) {\n    this.popupRedirectEnabled_ = true;\n    this.authEventManager_.subscribe(this);\n  }\n};\n\n\n/**\n * getAccountInfo users field.\n * @const {string}\n */\nfireauth.AuthUser.GET_ACCOUNT_INFO_USERS = 'users';\n\n\n/**\n * getAccountInfo response user fields.\n * @enum {string}\n */\nfireauth.AuthUser.GetAccountInfoField = {\n  CREATED_AT: 'createdAt',\n  DISPLAY_NAME: 'displayName',\n  EMAIL: 'email',\n  EMAIL_VERIFIED: 'emailVerified',\n  LAST_LOGIN_AT: 'lastLoginAt',\n  LOCAL_ID: 'localId',\n  PASSWORD_HASH: 'passwordHash',\n  PASSWORD_UPDATED_AT: 'passwordUpdatedAt',\n  PHONE_NUMBER: 'phoneNumber',\n  PHOTO_URL: 'photoUrl',\n  PROVIDER_USER_INFO: 'providerUserInfo',\n  TENANT_ID: 'tenantId'\n};\n\n\n/**\n * setAccountInfo response user fields.\n * @enum {string}\n */\nfireauth.AuthUser.SetAccountInfoField = {\n  DISPLAY_NAME: 'displayName',\n  EMAIL: 'email',\n  PHOTO_URL: 'photoUrl',\n  PROVIDER_ID: 'providerId',\n  PROVIDER_USER_INFO: 'providerUserInfo'\n};\n\n\n/**\n * getAccountInfo response provider user info fields.\n * @enum {string}\n */\nfireauth.AuthUser.GetAccountInfoProviderField = {\n  DISPLAY_NAME: 'displayName',\n  EMAIL: 'email',\n  PHOTO_URL: 'photoUrl',\n  PHONE_NUMBER: 'phoneNumber',\n  PROVIDER_ID: 'providerId',\n  RAW_ID: 'rawId'\n};\n\n\n/**\n * verifyAssertion response fields.\n * @enum {string}\n */\nfireauth.AuthUser.VerifyAssertionField = {\n  ID_TOKEN: 'idToken',\n  PROVIDER_ID: 'providerId'\n};\n\n\n/** @return {!fireauth.StsTokenManager} The STS token manager instance */\nfireauth.AuthUser.prototype.getStsTokenManager = function() {\n  return this.stsTokenManager_;\n};\n\n\n/**\n * Sets the user account info.\n * @param {!fireauth.AuthUser.AccountInfo} accountInfo The account information\n *     from the default provider.\n */\nfireauth.AuthUser.prototype.setAccountInfo = function(accountInfo) {\n  fireauth.object.setReadonlyProperties(this, {\n    'uid': accountInfo['uid'],\n    'displayName': accountInfo['displayName'] || null,\n    'photoURL': accountInfo['photoURL'] || null,\n    'email': accountInfo['email'] || null,\n    'emailVerified': accountInfo['emailVerified'] || false,\n    'phoneNumber': accountInfo['phoneNumber'] || null,\n    'isAnonymous': accountInfo['isAnonymous'] || false,\n    'tenantId': accountInfo['tenantId'] || null,\n    'metadata': new fireauth.UserMetadata(\n        accountInfo['createdAt'], accountInfo['lastLoginAt']),\n    'providerData': []\n  });\n  // Sets the tenant ID on RPC handler. For requests with ID tokens, the source\n  // of truth is the tenant ID in the ID token. If the request body has a\n  // tenant ID (optional here), the backend will confirm it matches the\n  // tenant ID in the ID token, otherwise throw an error. If no tenant ID is\n  // passed in the request, it will be determined from the ID token.\n  this.rpcHandler_.updateTenantId(this['tenantId']);\n};\n\n\n/**\n * Type specifying the parameters that can be passed to the\n * {@code fireauth.AuthUser} constructor.\n * @typedef {{\n *   uid: (?string|undefined),\n *   displayName: (?string|undefined),\n *   photoURL: (?string|undefined),\n *   email: (?string|undefined),\n *   emailVerified: ?boolean,\n *   phoneNumber: (?string|undefined),\n *   isAnonymous: ?boolean,\n *   createdAt: (?string|undefined),\n *   lastLoginAt: (?string|undefined),\n *   tenantId: (?string|undefined)\n * }}\n */\nfireauth.AuthUser.AccountInfo;\n\n\n/**\n * The provider for all fireauth.AuthUser objects is 'firebase'.\n */\nfireauth.object.setReadonlyProperty(fireauth.AuthUser.prototype, 'providerId',\n    fireauth.idp.ProviderId.FIREBASE);\n\n\n/**\n * Returns nothing. This can be used to consume the output of a Promise.\n * @private\n */\nfireauth.AuthUser.returnNothing_ = function() {\n  // Return nothing. Intentionally left empty.\n};\n\n\n/**\n * Ensures the user is still logged in before moving to the next promise\n * resolution.\n * @return {!goog.Promise<undefined,undefined>}\n * @private\n */\nfireauth.AuthUser.prototype.checkDestroyed_ = function() {\n  var self = this;\n  return goog.Promise.resolve().then(function() {\n    if (self.destroyed_) {\n      throw new fireauth.AuthError(fireauth.authenum.Error.MODULE_DESTROYED);\n    }\n  });\n};\n\n\n/**\n * @return {!Array<!fireauth.idp.ProviderId>} The list of provider IDs.\n */\nfireauth.AuthUser.prototype.getProviderIds = function() {\n  return goog.array.map(this['providerData'], function(userInfo) {\n    return userInfo['providerId'];\n  });\n};\n\n\n/**\n * Adds the provided user info to list of providers' data.\n * @param {?fireauth.AuthUserInfo} providerData Provider data to store for user.\n */\nfireauth.AuthUser.prototype.addProviderData = function(providerData) {\n  if (!providerData) {\n    return;\n  }\n  this.removeProviderData(providerData['providerId']);\n  this['providerData'].push(providerData);\n};\n\n\n/**\n * @param {!fireauth.idp.ProviderId} providerId The provider ID whose\n *     data should be removed.\n */\nfireauth.AuthUser.prototype.removeProviderData = function(providerId) {\n  goog.array.removeAllIf(this['providerData'], function(userInfo) {\n    return userInfo['providerId'] == providerId;\n  });\n};\n\n\n/**\n * @param {string} propName The property name to modify.\n * @param {?string|boolean} value The new value to set.\n */\nfireauth.AuthUser.prototype.updateProperty = function(propName, value) {\n  // User ID is required.\n  if (propName == 'uid' && !value) {\n    return;\n  }\n  if (this.hasOwnProperty(propName)) {\n    fireauth.object.setReadonlyProperty(this, propName, value);\n  }\n};\n\n\n/**\n * @param {!fireauth.AuthUser} otherUser The other user to compare to.\n * @return {boolean} True if both User objects have the same user ID.\n */\nfireauth.AuthUser.prototype.hasSameUserIdAs = function(otherUser) {\n  var thisId = this['uid'];\n  var thatId = otherUser['uid'];\n  if (thisId === undefined || thisId === null || thisId === '' ||\n      thatId === undefined || thatId === null || thatId === '') {\n    return false;\n  }\n  return thisId == thatId;\n};\n\n\n/**\n * Copies all properties and STS token manager instance from userToCopy to\n * current user without triggering any Auth state change or token change\n * listener.\n * @param {!fireauth.AuthUser} userToCopy The updated user to overwrite current\n *     user.\n */\nfireauth.AuthUser.prototype.copy = function(userToCopy) {\n  var self = this;\n  // Copy to self.\n  if (self == userToCopy) {\n    return;\n  }\n  fireauth.object.setReadonlyProperties(this, {\n    'uid': userToCopy['uid'],\n    'displayName': userToCopy['displayName'],\n    'photoURL': userToCopy['photoURL'],\n    'email': userToCopy['email'],\n    'emailVerified': userToCopy['emailVerified'],\n    'phoneNumber': userToCopy['phoneNumber'],\n    'isAnonymous': userToCopy['isAnonymous'],\n    'tenantId': userToCopy['tenantId'],\n    'providerData': []\n  });\n  // This should always be available but just in case there is a conflict with\n  // a user from an older version.\n  if (userToCopy['metadata']) {\n    fireauth.object.setReadonlyProperty(\n        this,\n        'metadata',\n        /** @type{!fireauth.UserMetadata} */ (userToCopy['metadata']).clone());\n  } else {\n    // User to copy has no metadata. Align with that.\n    fireauth.object.setReadonlyProperty(\n        this, 'metadata', new fireauth.UserMetadata());\n  }\n  goog.array.forEach(userToCopy['providerData'], function(userInfo) {\n    self.addProviderData(userInfo);\n  });\n  this.stsTokenManager_.copy(userToCopy.getStsTokenManager());\n  fireauth.object.setReadonlyProperty(\n      this, 'refreshToken', this.stsTokenManager_.getRefreshToken());\n};\n\n\n/**\n * Set the Auth user redirect storage manager.\n * @param {?fireauth.storage.RedirectUserManager} redirectStorageManager The\n *     utility used to store or delete the user on redirect.\n */\nfireauth.AuthUser.prototype.setRedirectStorageManager =\n    function(redirectStorageManager) {\n  /**\n   * @private {?fireauth.storage.RedirectUserManager} The redirect user storage\n   *     manager.\n   */\n  this.redirectStorageManager_ = redirectStorageManager;\n};\n\n\n/**\n * Refreshes the current user, if signed in.\n * @return {!goog.Promise<void>}\n */\nfireauth.AuthUser.prototype.reload = function() {\n  var self = this;\n  // Register this pending promise. This will also check for user invalidation.\n  return this.registerPendingPromise_(this.checkDestroyed_().then(function() {\n    return self.reloadWithoutSaving_()\n        .then(function() {\n          return self.notifyStateChangeListeners_();\n        })\n        .then(fireauth.AuthUser.returnNothing_);\n  }));\n};\n\n\n/**\n * Refreshes the current user, if signed in.\n * @return {!goog.Promise<string>} Promise that resolves with the idToken.\n * @private\n */\nfireauth.AuthUser.prototype.reloadWithoutSaving_ = function() {\n  var self = this;\n  // ID token is required to refresh the user's data.\n  // If this is called after invalidation, getToken will throw the cached error.\n  return this.getIdToken().then(function(idToken) {\n    var isAnonymous = self['isAnonymous'];\n    return self.setUserAccountInfoFromToken_(idToken)\n        .then(function(user) {\n          if (!isAnonymous) {\n            // Preserves the not anonymous status of the stored user,\n            // even if no more credentials (federated or email/password)\n            // linked to the user.\n            self.updateProperty('isAnonymous', false);\n          }\n          return idToken;\n        });\n  });\n};\n\n\n/**\n * This operation resolves with the Firebase ID token result which contains\n * the entire payload claims.\n * @param {boolean=} opt_forceRefresh Whether to force refresh token exchange.\n * @return {!goog.Promise<!fireauth.IdTokenResult>} A Promise that resolves with\n *     the ID token result.\n */\nfireauth.AuthUser.prototype.getIdTokenResult = function(opt_forceRefresh) {\n  return this.getIdToken(opt_forceRefresh).then(function(idToken) {\n    return new fireauth.IdTokenResult(idToken);\n  });\n};\n\n\n/**\n * This operation resolves with the Firebase ID token.\n * @param {boolean=} opt_forceRefresh Whether to force refresh token exchange.\n * @return {!goog.Promise<string>} A Promise that resolves with the ID token.\n */\nfireauth.AuthUser.prototype.getIdToken = function(opt_forceRefresh) {\n  var self = this;\n  // Register this pending promise. This will also check for user invalidation.\n  return this.registerPendingPromise_(this.checkDestroyed_().then(function() {\n    return self.stsTokenManager_.getToken(opt_forceRefresh);\n  }).then(function(response) {\n    if (!response) {\n      // If the user exists, the token manager should be initialized.\n      throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n    }\n    // Only if the access token is refreshed, notify Auth listeners.\n    if (response['accessToken'] != self.lastAccessToken_) {\n      self.setLastAccessToken_(response['accessToken']);\n      // Auth state change, notify listeners.\n      self.notifyAuthListeners_();\n    }\n    self.updateProperty('refreshToken', response['refreshToken']);\n    return response['accessToken'];\n  }));\n};\n\n\n/**\n * Checks if the error corresponds to a user invalidation action.\n * @param {*} error The error returned by a user operation.\n * @return {boolean} Whether the user is invalidated based on the error\n *     provided.\n * @private\n */\nfireauth.AuthUser.isUserInvalidated_ = function(error) {\n  return !!(error &&\n      (error.code == 'auth/user-disabled' ||\n       error.code == 'auth/user-token-expired'));\n};\n\n\n/**\n * Updates the current tokens using a server response, if new tokens are\n * present and are different from the current ones, and notify the Auth\n * listeners.\n * @param {!Object} response The response from the server.\n * @private\n */\nfireauth.AuthUser.prototype.updateTokensIfPresent_ = function(response) {\n  if (response[fireauth.RpcHandler.AuthServerField.ID_TOKEN] &&\n      this.lastAccessToken_ != response[\n          fireauth.RpcHandler.AuthServerField.ID_TOKEN]) {\n    this.stsTokenManager_.parseServerResponse(response);\n    this.notifyAuthListeners_();\n    this.setLastAccessToken_(response[\n        fireauth.RpcHandler.AuthServerField.ID_TOKEN]);\n    // Update refresh token property.\n    this.updateProperty(\n        'refreshToken', this.stsTokenManager_.getRefreshToken());\n  }\n};\n\n\n/**\n * Called internally on Auth (access token) changes to notify listeners.\n * @private\n */\nfireauth.AuthUser.prototype.notifyAuthListeners_ = function() {\n  this.dispatchEvent(\n      new fireauth.UserEvent(fireauth.UserEventType.TOKEN_CHANGED));\n};\n\n\n/**\n * Called internally on user deletion to notify listeners.\n * @private\n */\nfireauth.AuthUser.prototype.notifyUserDeletedListeners_ = function() {\n  this.dispatchEvent(\n      new fireauth.UserEvent(fireauth.UserEventType.USER_DELETED));\n};\n\n\n/**\n * Called internally on user session invalidation to notify listeners.\n * @private\n */\nfireauth.AuthUser.prototype.notifyUserInvalidatedListeners_ = function() {\n  this.dispatchEvent(\n      new fireauth.UserEvent(fireauth.UserEventType.USER_INVALIDATED));\n};\n\n\n/**\n * Queries the backend using the provided ID token for all linked accounts to\n * build the Firebase user object.\n * @param {!string} idToken The ID token string.\n * @return {!goog.Promise<undefined>}\n * @private\n */\nfireauth.AuthUser.prototype.setUserAccountInfoFromToken_ = function(idToken) {\n  return this.rpcHandler_.getAccountInfoByIdToken(idToken)\n      .then(goog.bind(this.parseAccountInfo_, this));\n};\n\n\n/**\n * Parses the response from the getAccountInfo endpoint.\n * @param {!Object} resp The backend response.\n * @private\n */\nfireauth.AuthUser.prototype.parseAccountInfo_ = function(resp) {\n  var users = resp[fireauth.AuthUser.GET_ACCOUNT_INFO_USERS];\n  if (!users || !users.length) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n  var user = users[0];\n  var accountInfo = /** @type {!fireauth.AuthUser.AccountInfo} */ ({\n    'uid': /** @type {string} */ (\n        user[fireauth.AuthUser.GetAccountInfoField.LOCAL_ID]),\n    'displayName': /** @type {?string|undefined} */ (\n        user[fireauth.AuthUser.GetAccountInfoField.DISPLAY_NAME]),\n    'photoURL': /** @type {?string|undefined} */ (\n        user[fireauth.AuthUser.GetAccountInfoField.PHOTO_URL]),\n    'email': /** @type {?string|undefined} */ (\n        user[fireauth.AuthUser.GetAccountInfoField.EMAIL]),\n    'emailVerified':\n        !!user[fireauth.AuthUser.GetAccountInfoField.EMAIL_VERIFIED],\n    'phoneNumber': /** @type {?string|undefined} */ (\n        user[fireauth.AuthUser.GetAccountInfoField.PHONE_NUMBER]),\n    'lastLoginAt': /** @type {?string|undefined} */ (\n        user[fireauth.AuthUser.GetAccountInfoField.LAST_LOGIN_AT]),\n    'createdAt': /** @type {?string|undefined} */ (\n        user[fireauth.AuthUser.GetAccountInfoField.CREATED_AT]),\n    'tenantId': /** @type {?string|undefined} */ (\n        user[fireauth.AuthUser.GetAccountInfoField.TENANT_ID])\n  });\n  this.setAccountInfo(accountInfo);\n  var linkedAccounts = this.extractLinkedAccounts_(user);\n  for (var i = 0; i < linkedAccounts.length; i++) {\n    this.addProviderData(linkedAccounts[i]);\n  }\n  // Sets the isAnonymous flag based on email, passwordHash and providerData.\n  var isAnonymous = !(this['email'] &&\n      user[fireauth.AuthUser.GetAccountInfoField.PASSWORD_HASH]) &&\n      !(this['providerData'] && this['providerData'].length);\n  this.updateProperty('isAnonymous', isAnonymous);\n};\n\n\n/**\n * Extracts the linked accounts from getAccountInfo response and returns an\n * array of corresponding provider data.\n * @param {!Object} resp The response object.\n * @return {!Array.<!fireauth.AuthUserInfo>} The linked accounts.\n * @private\n */\nfireauth.AuthUser.prototype.extractLinkedAccounts_ = function(resp) {\n  var providerInfo =\n      resp[fireauth.AuthUser.GetAccountInfoField.PROVIDER_USER_INFO];\n  if (!providerInfo || !providerInfo.length) {\n    return [];\n  }\n\n  return goog.array.map(providerInfo, function(info) {\n    return new fireauth.AuthUserInfo(\n        info[fireauth.AuthUser.GetAccountInfoProviderField.RAW_ID],\n        info[fireauth.AuthUser.GetAccountInfoProviderField.PROVIDER_ID],\n        info[fireauth.AuthUser.GetAccountInfoProviderField.EMAIL],\n        info[fireauth.AuthUser.GetAccountInfoProviderField.DISPLAY_NAME],\n        info[fireauth.AuthUser.GetAccountInfoProviderField.PHOTO_URL],\n        info[fireauth.AuthUser.GetAccountInfoProviderField.PHONE_NUMBER]);\n  });\n};\n\n\n/**\n * Reauthenticates a user using a fresh credential, to be used before operations\n * such as updatePassword that require tokens from recent login attempts. It\n * also returns any additional user info data or credentials returned form the\n * backend. It has been deprecated in favor of reauthenticateWithCredential.\n * @param {!fireauth.AuthCredential} credential\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthUser.prototype.reauthenticateAndRetrieveDataWithCredential =\n    function(credential) {\n  fireauth.deprecation.log(\n      fireauth.deprecation.Deprecations.REAUTH_WITH_CREDENTIAL);\n  return this.reauthenticateWithCredential(credential);\n};\n\n\n/**\n * Reauthenticates a user using a fresh credential, to be used before operations\n * such as updatePassword that require tokens from recent login attempts. It\n * also returns any additional user info data or credentials returned form the\n * backend.\n * @param {!fireauth.AuthCredential} credential\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthUser.prototype.reauthenticateWithCredential =\n    function(credential) {\n  var self = this;\n  var userCredential = null;\n  // Register this pending promise but bypass user invalidation check.\n  return this.registerPendingPromise_(\n      // Match ID token from credential with the current user UID.\n      credential.matchIdTokenWithUid(this.rpcHandler_, this['uid'])\n      .then(function(response) {\n        // If the credential is valid and matches the current user ID, then\n        // update the tokens accordingly.\n        self.updateTokensIfPresent_(response);\n        // Get user credential.\n        userCredential = self.getUserCredential_(\n            response, fireauth.constants.OperationType.REAUTHENTICATE);\n        // This could potentially validate an invalidated user. This happens in\n        // the case a password reset was applied. The refresh token is expired.\n        // Reauthentication should revalidate the user.\n        // User would remain non current if already signed out, but should be\n        // enabled again.\n        self.userInvalidatedError_ = null;\n        return self.reload();\n      }).then(function() {\n        // Return user credential after reauthenticated user is reloaded.\n        return userCredential;\n      }),\n      // Skip invalidation check as reauthentication could revalidate a user.\n      true);\n};\n\n\n/**\n * Reloads the user and then checks if a provider is already linked. If so,\n * this returns a Promise that rejects. Note that state change listeners are not\n * notified on success, so that operations using this can make changes and then\n * do one final listener notification.\n * @param {string} providerId\n * @return {!goog.Promise<void>}\n * @private\n */\nfireauth.AuthUser.prototype.checkIfAlreadyLinked_ =\n    function(providerId) {\n  var self = this;\n  // Reload first in case the user was updated elsewhere.\n  return this.reloadWithoutSaving_()\n      .then(function() {\n        if (goog.array.contains(self.getProviderIds(), providerId)) {\n          return self.notifyStateChangeListeners_()\n              .then(function() {\n                  throw new fireauth.AuthError(\n                      fireauth.authenum.Error.PROVIDER_ALREADY_LINKED);\n              });\n        }\n      });\n};\n\n\n/**\n * Links a provider to the current user and returns any additional user info\n * data or credentials returned form the backend. It has been deprecated in\n * favor of linkWithCredential.\n * @param {!fireauth.AuthCredential} credential The credential from the Auth\n *     provider.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthUser.prototype.linkAndRetrieveDataWithCredential =\n    function(credential) {\n  fireauth.deprecation.log(\n      fireauth.deprecation.Deprecations.LINK_WITH_CREDENTIAL);\n  return this.linkWithCredential(credential);\n};\n\n\n/**\n * Links a provider to the current user and returns any additional user info\n * data or credentials returned form the backend.\n * @param {!fireauth.AuthCredential} credential The credential from the Auth\n *     provider.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthUser.prototype.linkWithCredential = function(credential) {\n  var self = this;\n  var userCredential = null;\n  // Register this pending promise. This will also check for user invalidation.\n  return this.registerPendingPromise_(\n      this.checkIfAlreadyLinked_(credential['providerId'])\n      .then(function() {\n        return self.getIdToken();\n      })\n      .then(function(idToken) {\n        return credential.linkToIdToken(self.rpcHandler_, idToken);\n      })\n      .then(function(response) {\n        // Get user credential.\n        userCredential = self.getUserCredential_(\n            response, fireauth.constants.OperationType.LINK);\n        // Finalize linking.\n        return self.finalizeLinking_(response);\n      })\n      .then(function(user) {\n        // Return user credential after finalizing linking.\n        return userCredential;\n      })\n  );\n};\n\n\n/**\n * Links a phone number using the App verifier instance and returns a\n * promise that resolves with the confirmation result which on confirmation\n * will resolve with the UserCredential object.\n * @param {string} phoneNumber The phone number to authenticate with.\n * @param {!firebase.auth.ApplicationVerifier} appVerifier The application\n *     verifier.\n * @return {!goog.Promise<!fireauth.ConfirmationResult>}\n */\nfireauth.AuthUser.prototype.linkWithPhoneNumber =\n    function(phoneNumber, appVerifier) {\n  var self = this;\n  return /** @type {!goog.Promise<!fireauth.ConfirmationResult>} */ (\n      this.registerPendingPromise_(\n          // Check if linked already. If so, throw an error.\n          // This is redundant but is needed to prevent the need to send the\n          // SMS (worth the cost).\n          this.checkIfAlreadyLinked_(fireauth.idp.ProviderId.PHONE)\n              .then(function() {\n                return fireauth.ConfirmationResult.initialize(\n                    self.getAuth_(),\n                    phoneNumber,\n                    appVerifier,\n                    // This will check again if the credential is linked.\n                    goog.bind(self.linkWithCredential, self));\n              })));\n};\n\n\n/**\n * Reauthenticates a user with a phone number using the App verifier instance\n * and returns a promise that resolves with the confirmation result which on\n * confirmation will resolve with the UserCredential object.\n * @param {string} phoneNumber The phone number to authenticate with.\n * @param {!firebase.auth.ApplicationVerifier} appVerifier The application\n *     verifier.\n * @return {!goog.Promise<!fireauth.ConfirmationResult>}\n */\nfireauth.AuthUser.prototype.reauthenticateWithPhoneNumber =\n    function(phoneNumber, appVerifier) {\n  var self = this;\n  return /** @type {!goog.Promise<!fireauth.ConfirmationResult>} */ (\n      this.registerPendingPromise_(\n          // Wrap this operation in a Promise since self.getAuth_() may throw an\n          // error synchronously.\n          goog.Promise.resolve().then(function() {\n            return fireauth.ConfirmationResult.initialize(\n                // Get corresponding Auth instance.\n                self.getAuth_(),\n                phoneNumber,\n                appVerifier,\n                goog.bind(self.reauthenticateWithCredential,\n                    self));\n          }),\n          // Skip invalidation check as reauthentication could revalidate a\n          // user.\n          true));\n};\n\n\n/**\n * Converts an ID token response (eg. verifyAssertion) to a UserCredential\n * object.\n * @param {!Object} idTokenResponse The ID token response.\n * @param {!fireauth.constants.OperationType} operationType The operation type\n *     to set in the user credential.\n * @return {!fireauth.AuthEventManager.Result} The UserCredential object\n *     constructed from the response.\n * @private\n */\nfireauth.AuthUser.prototype.getUserCredential_ =\n    function(idTokenResponse, operationType) {\n  // Get credential if available in the response.\n  var credential = fireauth.AuthProvider.getCredentialFromResponse(\n      idTokenResponse);\n  // Get additional user info data if available in the response.\n  var additionalUserInfo = fireauth.AdditionalUserInfo.fromPlainObject(\n      idTokenResponse);\n  // Return the readonly copy of the user credential object.\n  return fireauth.object.makeReadonlyCopy({\n    // Return the current user reference.\n    'user': this,\n    // Return any credential passed from the backend.\n    'credential': credential,\n    // Return any additional IdP data passed from the backend.\n    'additionalUserInfo': additionalUserInfo,\n    // Return the operation type in the user credential object.\n    'operationType': operationType\n  });\n};\n\n\n/**\n * Finalizes a linking flow, updating idToken and user's data using the\n * RPC linking response.\n * @param {!Object} response The RPC linking response.\n * @return {!goog.Promise<!fireauth.AuthUser>}\n * @private\n */\nfireauth.AuthUser.prototype.finalizeLinking_ = function(response) {\n  // The response may contain a new access token,\n  // so we should update them just like a new sign in.\n  this.updateTokensIfPresent_(response);\n  // This will take care of saving the updated state.\n  var self = this;\n  return this.reload().then(function() {\n    return self;\n  });\n};\n\n\n/**\n * Updates the user's email.\n * @param {string} newEmail The new email.\n * @return {!goog.Promise<void>}\n */\nfireauth.AuthUser.prototype.updateEmail = function(newEmail) {\n  var self = this;\n  // Register this pending promise. This will also check for user invalidation.\n  return this.registerPendingPromise_(this.getIdToken()\n      .then(function(idToken) {\n        return self.rpcHandler_.updateEmail(idToken, newEmail);\n      })\n      .then(function(response) {\n        // Calls to SetAccountInfo may invalidate old tokens.\n        self.updateTokensIfPresent_(response);\n        // Reloads the user to update emailVerified.\n        return self.reload();\n      }));\n};\n\n\n/**\n * Updates the user's phone number.\n * @param {!fireauth.PhoneAuthCredential} phoneCredential\n * @return {!goog.Promise<void>}\n */\nfireauth.AuthUser.prototype.updatePhoneNumber = function(phoneCredential) {\n  var self = this;\n  return this.registerPendingPromise_(this.getIdToken()\n      .then(function(idToken) {\n        // The backend always overwrites the existing phone number during a\n        // link operation.\n        return phoneCredential.linkToIdToken(self.rpcHandler_, idToken);\n      })\n      .then(function(response) {\n        self.updateTokensIfPresent_(response);\n        return self.reload();\n      }));\n};\n\n\n/**\n * Updates the user's password.\n * @param {string} newPassword The new password.\n * @return {!goog.Promise<void>}\n */\nfireauth.AuthUser.prototype.updatePassword = function(newPassword) {\n  var self = this;\n  // Register this pending promise. This will also check for user invalidation.\n  return this.registerPendingPromise_(\n      this.getIdToken()\n      .then(function(idToken) {\n        return self.rpcHandler_.updatePassword(idToken, newPassword);\n      })\n      .then(function(response) {\n        self.updateTokensIfPresent_(response);\n        // Reloads the user in case email has also been updated and the user\n        // was anonymous.\n        return self.reload();\n      }));\n};\n\n\n/**\n * Updates the user's profile data.\n * @param {!Object} profile The profile data to update.\n * @return {!goog.Promise<undefined>}\n */\nfireauth.AuthUser.prototype.updateProfile = function(profile) {\n  if (profile['displayName'] === undefined &&\n      profile['photoURL'] === undefined) {\n    // No change, directly return.\n    return this.checkDestroyed_();\n  }\n  var self = this;\n  // Register this pending promise. This will also check for user invalidation.\n  return this.registerPendingPromise_(\n      this.getIdToken().then(function(idToken) {\n        // Translate the request into one that the backend accepts.\n        var profileRequest = {\n          'displayName': profile['displayName'],\n          'photoUrl': profile['photoURL']\n        };\n        return self.rpcHandler_.updateProfile(idToken, profileRequest);\n      })\n      .then(function(response) {\n        // Calls to SetAccountInfo may invalidate old tokens.\n        self.updateTokensIfPresent_(response);\n        // Update properties.\n        self.updateProperty('displayName',\n            response[fireauth.AuthUser.SetAccountInfoField.DISPLAY_NAME] ||\n            null);\n        self.updateProperty('photoURL',\n            response[fireauth.AuthUser.SetAccountInfoField.PHOTO_URL] || null);\n        goog.array.forEach(self['providerData'], function(userInfo) {\n          // Check if password provider is linked.\n          if (userInfo['providerId'] === fireauth.idp.ProviderId.PASSWORD) {\n            // If so, update both fields in that provider.\n            fireauth.object.setReadonlyProperty(\n                userInfo, 'displayName', self['displayName']);\n            fireauth.object.setReadonlyProperty(\n                userInfo, 'photoURL', self['photoURL']);\n          }\n        });\n        // Notify changes and resolve.\n        return self.notifyStateChangeListeners_();\n      })\n      .then(fireauth.AuthUser.returnNothing_));\n};\n\n\n/**\n * Unlinks a provider from an account.\n * @param {!fireauth.idp.ProviderId} providerId The ID of the provider to\n *     unlink.\n * @return {!goog.Promise<!fireauth.AuthUser>}\n */\nfireauth.AuthUser.prototype.unlink = function(providerId) {\n  var self = this;\n  // Make sure we have updated user providers to avoid removing a linked\n  // provider that hasn't been updated in current copy of user.\n  // Register this pending promise. This will also check for user invalidation.\n  return this.registerPendingPromise_(\n      this.reloadWithoutSaving_()\n      .then(function(idToken) {\n        // Provider already unlinked.\n        if (!goog.array.contains(self.getProviderIds(), providerId)) {\n          return self.notifyStateChangeListeners_()\n              .then(function() {\n                throw new fireauth.AuthError(\n                    fireauth.authenum.Error.NO_SUCH_PROVIDER);\n              });\n        }\n        // We delete the providerId given.\n        return self.rpcHandler_\n            .deleteLinkedAccounts(idToken, [providerId])\n            .then(function(resp) {\n              // Construct the set of provider IDs returned by server.\n              var remainingProviderIds = {};\n              var userInfo = resp[fireauth.AuthUser.SetAccountInfoField.\n                  PROVIDER_USER_INFO] || [];\n              goog.array.forEach(userInfo, function(obj) {\n                remainingProviderIds[\n                    obj[fireauth.AuthUser.SetAccountInfoField.PROVIDER_ID]] =\n                    true;\n              });\n\n              // Remove all provider data objects where the provider ID no\n              // longer exists in this user.\n              goog.array.forEach(self.getProviderIds(), function(pId) {\n                if (!remainingProviderIds[pId]) {\n                  // This provider no longer linked, remove it from user.\n                  self.removeProviderData(pId);\n                }\n              });\n\n              // Remove the phone number if the phone provider was unlinked.\n              if (!remainingProviderIds[fireauth.PhoneAuthProvider[\n                      'PROVIDER_ID']]) {\n                fireauth.object.setReadonlyProperty(self, 'phoneNumber', null);\n              }\n\n              return self.notifyStateChangeListeners_();\n            });\n      }));\n};\n\n\n/**\n * Deletes the user, triggering an Auth token change if successful.\n * @return {!goog.Promise<void>}\n */\nfireauth.AuthUser.prototype.delete = function() {\n  // Notice the way of declaring the method, it's to avoid a weird bug on IE8.\n  var self = this;\n  // Register this pending promise. This will also check for user invalidation.\n  return this.registerPendingPromise_(\n      this.getIdToken()\n      .then(function(idToken) {\n        return self.rpcHandler_.deleteAccount(idToken);\n      })\n      .then(function() {\n        self.notifyUserDeletedListeners_();\n      }))\n      .then(function() {\n        // Destroying after the registered promise is handled ensures it won't\n        // be canceled.\n        self.destroy();\n      });\n};\n\n\n/**\n * Tells the Auth event manager if this user is the owner of a detected Auth\n * event. A user can handle linkWithPopup and linkWithRedirect operations.\n * In addition, the event ID should match the user's event IDs.\n * @param {!fireauth.AuthEvent.Type} mode The Auth operation mode (popup,\n *     redirect).\n * @param {?string=} opt_eventId The event ID.\n * @return {boolean} Whether the Auth event handler can handler the provided\n *     event.\n * @override\n */\nfireauth.AuthUser.prototype.canHandleAuthEvent = function(mode, opt_eventId) {\n  if (mode == fireauth.AuthEvent.Type.LINK_VIA_POPUP &&\n      this.getPopupEventId() == opt_eventId &&\n      this.pendingPopupResolvePromise_) {\n    // The link via popup event's ID matches the user's popup event ID which\n    // makes this user the owner of this event.\n    return true;\n  } else if (mode == fireauth.AuthEvent.Type.REAUTH_VIA_POPUP &&\n      this.getPopupEventId() == opt_eventId &&\n      this.pendingPopupResolvePromise_) {\n    // The reauth via popup event's ID matches the user's popup event ID which\n    // makes this user the owner of this event.\n    return true;\n  } else if (mode == fireauth.AuthEvent.Type.LINK_VIA_REDIRECT &&\n             this.getRedirectEventId() == opt_eventId) {\n    // The link via redirect event's ID matches the user's redirect event ID\n    // which makes this user the owner of this event.\n    return true;\n  } else if (mode == fireauth.AuthEvent.Type.REAUTH_VIA_REDIRECT &&\n             this.getRedirectEventId() == opt_eventId) {\n    // The reauth via redirect event's ID matches the user's redirect event ID\n    // which makes this user the owner of this event.\n    return true;\n  }\n  return false;\n};\n\n\n/**\n * Completes the pending popup operation. If error is not null, rejects with the\n * error. Otherwise, it resolves with the popup redirect result.\n * @param {!fireauth.AuthEvent.Type} mode The Auth operation mode (popup,\n *     redirect).\n * @param {?fireauth.AuthEventManager.Result} popupRedirectResult The result\n *     to resolve with when no error supplied.\n * @param {?fireauth.AuthError} error When supplied, the promise will reject.\n * @param {?string=} opt_eventId The event ID.\n * @override\n */\nfireauth.AuthUser.prototype.resolvePendingPopupEvent =\n    function(mode, popupRedirectResult, error, opt_eventId) {\n  // Only handles popup events with event IDs that match a pending popup ID.\n  if ((mode != fireauth.AuthEvent.Type.LINK_VIA_POPUP &&\n       mode != fireauth.AuthEvent.Type.REAUTH_VIA_POPUP) ||\n      opt_eventId != this.getPopupEventId()) {\n    return;\n  }\n  if (error && this.pendingPopupRejectPromise_) {\n    // Reject with error for supplied mode.\n    this.pendingPopupRejectPromise_(error);\n  } else if (popupRedirectResult &&\n             !error &&\n             this.pendingPopupResolvePromise_) {\n    // Resolve with result for supplied mode.\n    this.pendingPopupResolvePromise_(popupRedirectResult);\n  }\n  // Now that event is resolved, delete timeout promise.\n  if (this.popupTimeoutPromise_) {\n    this.popupTimeoutPromise_.cancel();\n    this.popupTimeoutPromise_ = null;\n  }\n  // Delete pending promises.\n  delete this.pendingPopupResolvePromise_;\n  delete this.pendingPopupRejectPromise_;\n};\n\n\n/**\n * Returns the handler's appropriate popup and redirect sign in operation\n * finisher. Can handle link or reauth events that match existing event IDs.\n * @param {!fireauth.AuthEvent.Type} mode The Auth operation mode (popup,\n *     redirect).\n * @param {?string=} opt_eventId The optional event ID.\n * @return {?function(string, string, ?string,\n *     ?string=):!goog.Promise<!fireauth.AuthEventManager.Result>}\n * @override\n */\nfireauth.AuthUser.prototype.getAuthEventHandlerFinisher =\n    function(mode, opt_eventId) {\n  if (mode == fireauth.AuthEvent.Type.LINK_VIA_POPUP &&\n      opt_eventId == this.getPopupEventId()) {\n    // Link with popup ID matches popup event ID.\n    return goog.bind(this.finishPopupAndRedirectLink, this);\n  } else if (mode == fireauth.AuthEvent.Type.REAUTH_VIA_POPUP &&\n      opt_eventId == this.getPopupEventId()) {\n    // Reauth with popup ID matches popup event ID.\n    return goog.bind(this.finishPopupAndRedirectReauth, this);\n  } else if (mode == fireauth.AuthEvent.Type.LINK_VIA_REDIRECT &&\n             this.getRedirectEventId() == opt_eventId) {\n    // Link with redirect ID matches redirect event ID.\n    return goog.bind(this.finishPopupAndRedirectLink, this);\n  } else if (mode == fireauth.AuthEvent.Type.REAUTH_VIA_REDIRECT &&\n             this.getRedirectEventId() == opt_eventId) {\n    // Reauth with redirect ID matches redirect event ID.\n    return goog.bind(this.finishPopupAndRedirectReauth, this);\n  }\n  return null;\n};\n\n\n/**\n * @return {string} The generated event ID used to identify a popup or redirect\n *     event.\n * @private\n */\nfireauth.AuthUser.prototype.generateEventId_ = function() {\n  return fireauth.util.generateEventId(this['uid'] + ':::');\n};\n\n\n/**\n * Links to Auth provider via popup.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthUser.prototype.linkWithPopup = function(provider) {\n  var self = this;\n  // Additional check to return to fail when the provider is already linked.\n  var additionalCheck = function() {\n    return self.checkIfAlreadyLinked_(provider['providerId'])\n        .then(function() {\n          // Notify state listeners after the check as it will update the user\n          // state.\n          return self.notifyStateChangeListeners_();\n        });\n  };\n  return this.runOperationWithPopup_(\n      fireauth.AuthEvent.Type.LINK_VIA_POPUP, provider, additionalCheck, false);\n};\n\n\n/**\n * Reauthenticate to Auth provider via popup.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthUser.prototype.reauthenticateWithPopup = function(provider) {\n  // No additional check needed before running this operation.\n  var additionalCheck = function() {\n    return goog.Promise.resolve();\n  };\n  return this.runOperationWithPopup_(\n      fireauth.AuthEvent.Type.REAUTH_VIA_POPUP,\n      provider,\n      additionalCheck,\n      // Do not update token and skip session invalidation check.\n      true);\n};\n\n\n/**\n * Runs a specific OAuth operation using the Auth provider via popup.\n * @param {!fireauth.AuthEvent.Type} mode The mode of operation (link or\n *     reauth).\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @param {!function():!goog.Promise} additionalCheck The additional check to\n *     run before proceeding with the popup processing.\n * @param {boolean} isReauthOperation whether this is a reauth operation or not.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n * @private\n */\nfireauth.AuthUser.prototype.runOperationWithPopup_ =\n    function(mode, provider, additionalCheck, isReauthOperation) {\n  // Check if popup and redirect are supported in this environment.\n  if (!fireauth.util.isPopupRedirectSupported()) {\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n  }\n  // Quickly throw user invalidation error if already invalidated.\n  if (this.userInvalidatedError_ &&\n      // Skip invalidation check as reauthentication could revalidate a user.\n      !isReauthOperation) {\n    return goog.Promise.reject(this.userInvalidatedError_);\n  }\n  var self = this;\n  // Popup the window immediately to make sure the browser associates the\n  // popup with the click that triggered it.\n\n  // Get provider settings.\n  var settings = fireauth.idp.getIdpSettings(provider['providerId']);\n  // There could multiple users at the same time and multiple users could have\n  // the same UID. So try to ensure event ID uniqueness.\n  var eventId = this.generateEventId_();\n  // If incapable of redirecting popup from opener, popup destination URL\n  // directly. This could also happen in a sandboxed iframe.\n  var oauthHelperWidgetUrl = null;\n  if ((!fireauth.util.runsInBackground() || fireauth.util.isIframe()) &&\n      this.authDomain_ &&\n      provider['isOAuthProvider']) {\n    oauthHelperWidgetUrl =\n        fireauth.iframeclient.IfcHandler.getOAuthHelperWidgetUrl(\n            this.authDomain_,\n            this.apiKey_,\n            this.appName_,\n            mode,\n            provider,\n            null,\n            eventId,\n            firebase.SDK_VERSION || null,\n            null,\n            null,\n            this['tenantId']);\n  }\n  // The popup must have a name, otherwise when successive popups are triggered\n  // they will all render in the same instance and none will succeed since the\n  // popup cancel of first window will close the shared popup window instance.\n  var popupWin =\n      fireauth.util.popup(\n          oauthHelperWidgetUrl,\n          fireauth.util.generateRandomString(),\n          settings && settings.popupWidth,\n          settings && settings.popupHeight);\n  var p = additionalCheck().then(function() {\n    // Auth event manager must be available for account linking or\n    // reauthentication to be possible.\n    self.getAuthEventManager();\n    if (!isReauthOperation) {\n      // Some operations like reauthenticate do not require this.\n      return self.getIdToken().then(function(idToken) {});\n    }\n  }).then(function() {\n    // Process popup request.\n    return self.authEventManager_.processPopup(\n        popupWin, mode, provider, eventId, !!oauthHelperWidgetUrl,\n        self['tenantId']);\n  }).then(function() {\n    return new goog.Promise(function(resolve, reject) {\n      // Expire other pending promises if still available.\n      self.resolvePendingPopupEvent(\n          mode,\n          null,\n          new fireauth.AuthError(fireauth.authenum.Error.EXPIRED_POPUP_REQUEST),\n          // Existing popup event ID.\n          self.getPopupEventId());\n      // Save current pending promises.\n      self.pendingPopupResolvePromise_ = resolve;\n      self.pendingPopupRejectPromise_ = reject;\n      // Overwrite popup event ID with new one.\n      self.setPopupEventId(eventId);\n      // Keep track of timeout promise to cancel it on promise resolution before\n      // it times out.\n      self.popupTimeoutPromise_ =\n          self.authEventManager_.startPopupTimeout(\n              self, mode, /** @type {!Window} */ (popupWin), eventId);\n    });\n  }).then(function(result) {\n    // On resolution, close popup if still opened and pass result through.\n    if (popupWin) {\n      fireauth.util.closeWindow(popupWin);\n    }\n    if (result) {\n      return fireauth.object.makeReadonlyCopy(result);\n    }\n    return null;\n  }).thenCatch(function(error) {\n    if (popupWin) {\n      fireauth.util.closeWindow(popupWin);\n    }\n    throw error;\n  });\n  // Register this pending promise. This will also check for user invalidation.\n  return /** @type {!goog.Promise<!fireauth.AuthEventManager.Result>} */ (\n      this.registerPendingPromise_(\n          p,\n          // Skip invalidation check as reauthentication could revalidate a\n          // user.\n          isReauthOperation));\n};\n\n\n/**\n * Links to Auth provider via redirect.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @return {!goog.Promise<void>}\n */\nfireauth.AuthUser.prototype.linkWithRedirect = function(provider) {\n  var mode = fireauth.AuthEvent.Type.LINK_VIA_REDIRECT;\n  var self = this;\n  // Additional check to return to fail when the provider is already linked.\n  var additionalCheck = function() {\n    return self.checkIfAlreadyLinked_(provider['providerId']);\n  };\n  return this.runOperationWithRedirect_(mode, provider, additionalCheck, false);\n};\n\n\n/**\n * Reauthenticates to Auth provider via redirect.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @return {!goog.Promise<void>}\n */\nfireauth.AuthUser.prototype.reauthenticateWithRedirect = function(provider) {\n  // No additional check needed.\n  var additionalCheck = function() {\n    return goog.Promise.resolve();\n  };\n  return this.runOperationWithRedirect_(\n      fireauth.AuthEvent.Type.REAUTH_VIA_REDIRECT,\n      provider,\n      additionalCheck,\n      // Do not update token and skip session invalidation check.\n      true);\n};\n\n\n\n/**\n * Runs a specific OAuth operation using the Auth provider via redirect.\n * @param {!fireauth.AuthEvent.Type} mode The mode of operation (link or\n *     reauth).\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @param {!function():!goog.Promise} additionalCheck The additional check to\n *     run before proceeding with the redirect processing.\n * @param {boolean} isReauthOperation whether this is a reauth operation or not.\n * @return {!goog.Promise<void>}\n * @private\n */\nfireauth.AuthUser.prototype.runOperationWithRedirect_ =\n    function(mode, provider, additionalCheck, isReauthOperation) {\n  // Check if popup and redirect are supported in this environment.\n  if (!fireauth.util.isPopupRedirectSupported()) {\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n  }\n  // Quickly throw user invalidation error if already invalidated.\n  if (this.userInvalidatedError_ &&\n      // Skip invalidation check as reauthentication could revalidate a user.\n      !isReauthOperation) {\n    return goog.Promise.reject(this.userInvalidatedError_);\n  }\n  var self = this;\n  var errorThrown = null;\n  // There could multiple users at the same time and multiple users could have\n  // the same UID. So try to ensure event ID uniqueness.\n  var eventId = this.generateEventId_();\n  var p = additionalCheck().then(function() {\n    // Auth event manager must be available for account linking or\n    // reauthentication to be possible.\n    self.getAuthEventManager();\n    if (!isReauthOperation) {\n      // Some operations like reauthenticate do not require this.\n      return self.getIdToken().then(function(idToken) {});\n    }\n  }).then(function() {\n    // Process redirect operation.\n    self.setRedirectEventId(eventId);\n    // Before redirecting save the event ID.\n    // It is important that the user redirect event ID is updated in storage\n    // before redirecting.\n    return self.notifyStateChangeListeners_();\n  }).then(function(user) {\n    if (self.redirectStorageManager_) {\n      // Save the user before redirecting in case it is not current so that it\n      // can be retrieved after reloading for linking or reauthentication to\n      // succeed.\n      return self.redirectStorageManager_.setRedirectUser(self);\n    }\n    return user;\n  }).then(function(user) {\n    // Complete the redirect operation.\n    return self.authEventManager_.processRedirect(\n        mode, provider, eventId, self['tenantId']);\n  }).thenCatch(function(error) {\n    // Catch error if any is generated.\n    errorThrown = error;\n    if (self.redirectStorageManager_) {\n      // If an error is detected, delete the redirected user from storage.\n      return self.redirectStorageManager_.removeRedirectUser();\n    }\n    // No storage manager, just throw error.\n    throw errorThrown;\n  }).then(function() {\n    // Rethrow the error.\n    if (errorThrown) {\n      throw errorThrown;\n    }\n  });\n  // Register this pending promise. This will also check for user invalidation.\n  return /** @type {!goog.Promise<void>} */ (this.registerPendingPromise_(\n      p,\n      // Skip invalidation check as reauthentication could revalidate a user.\n      isReauthOperation));\n};\n\n\n/**\n * @return {!fireauth.AuthEventManager} The user's Auth event manager.\n */\nfireauth.AuthUser.prototype.getAuthEventManager = function() {\n  // Either return the manager instance if available, otherwise throw an error.\n  if (this.authEventManager_ && this.popupRedirectEnabled_) {\n    return this.authEventManager_;\n  } else if (this.authEventManager_ && !this.popupRedirectEnabled_) {\n    // This should not happen as Auth will enable a user after it is created.\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR);\n  }\n  throw new fireauth.AuthError(fireauth.authenum.Error.MISSING_AUTH_DOMAIN);\n};\n\n\n/**\n * Finishes the popup and redirect account linking operations.\n * @param {string} requestUri The callback URL with the OAuth response.\n * @param {string} sessionId The session ID used to generate the authUri.\n * @param {?string} tenantId The tenant ID.\n * @param {?string=} opt_postBody The optional POST body content.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthUser.prototype.finishPopupAndRedirectLink =\n    function(requestUri, sessionId, tenantId, opt_postBody) {\n  var self = this;\n  // Now that popup has responded, delete popup timeout promise.\n  if (this.popupTimeoutPromise_) {\n    this.popupTimeoutPromise_.cancel();\n    this.popupTimeoutPromise_ = null;\n  }\n  var userCredential = null;\n  // This routine could be run before init state, make sure it waits for that to\n  // complete otherwise this would fail as user not loaded from storage yet.\n  var p = this.getIdToken()\n      .then(function(idToken) {\n        var request = {\n          'requestUri': requestUri,\n          'postBody': opt_postBody,\n          'sessionId': sessionId,\n          // To link a tenant user, the tenant ID will be passed to the\n          // backend as part of the ID token.\n          'idToken': idToken\n        };\n        // This operation should fail if new ID token differs from old one.\n        // So this can be treate as a profile update operation.\n        return self.rpcHandler_.verifyAssertionForLinking(request);\n      })\n      .then(function(response) {\n        // Get user credential.\n        userCredential = self.getUserCredential_(\n            response, fireauth.constants.OperationType.LINK);\n        // Finalizes the linking process.\n        return self.finalizeLinking_(response);\n      })\n      .then(function(user) {\n        // Return the user credential response.\n        return userCredential;\n      });\n  return /** @type {!goog.Promise<!fireauth.AuthEventManager.Result>} */ (\n      this.registerPendingPromise_(p));\n};\n\n\n/**\n * Finishes the popup and redirect account reauthentication operations.\n * @param {string} requestUri The callback URL with the OAuth response.\n * @param {string} sessionId The session ID used to generate the authUri.\n * @param {?string} tenantId The tenant ID.\n * @param {?string=} opt_postBody The optional POST body content.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.AuthUser.prototype.finishPopupAndRedirectReauth =\n    function(requestUri, sessionId, tenantId, opt_postBody) {\n  var self = this;\n  // Now that popup has responded, delete popup timeout promise.\n  if (this.popupTimeoutPromise_) {\n    this.popupTimeoutPromise_.cancel();\n    this.popupTimeoutPromise_ = null;\n  }\n  var userCredential = null;\n  // This routine could be run before init state, make sure it waits for that to\n  // complete otherwise this would fail as user not loaded from storage yet.\n  var p = goog.Promise.resolve()\n      .then(function() {\n        var request = {\n          'requestUri': requestUri,\n          'sessionId': sessionId,\n          'postBody': opt_postBody,\n          // To reauthenticate a tenant user, the tenant ID will be passed to\n          // the backend explicitly.\n          // Even if tenant ID is null, still pass it to RPC handler explicitly\n          // so that it won't be overridden by RPC handler's tenant ID.\n          'tenantId': tenantId\n        };\n        // Finish sign in by calling verifyAssertionForExisting and then\n        // matching the returned ID token's UID with the current user's.\n        return fireauth.AuthCredential.verifyTokenResponseUid(\n            self.rpcHandler_.verifyAssertionForExisting(request),\n            self['uid']);\n      }).then(function(response) {\n        // Get credential from response if available.\n        // Get user credential.\n        userCredential = self.getUserCredential_(\n            response, fireauth.constants.OperationType.REAUTHENTICATE);\n        // If the credential is valid and matches the current user ID, then\n        // update the tokens accordingly.\n        self.updateTokensIfPresent_(response);\n        // This could potentially validate an invalidated user. This happens in\n        // the case a password reset was applied. The refresh token is expired.\n        // Reauthentication should revalidate the user.\n        // User would remain non current if already signed out, but should be\n        // enabled again.\n        self.userInvalidatedError_ = null;\n        return self.reload();\n      })\n      .then(function() {\n        // Return the user credential response.\n        return userCredential;\n      });\n  return /** @type {!goog.Promise<!fireauth.AuthEventManager.Result>} */ (\n      this.registerPendingPromise_(\n          p,\n          // Skip invalidation check as reauthentication could revalidate a\n          // user.\n          true));\n};\n\n\n/**\n * Sends the email verification email to the email in the user's account.\n * @param {?Object=} opt_actionCodeSettings The optional action code settings\n *     object.\n * @return {!goog.Promise<void>}\n */\nfireauth.AuthUser.prototype.sendEmailVerification =\n    function(opt_actionCodeSettings) {\n  var self = this;\n  var idToken = null;\n  // Register this pending promise. This will also check for user invalidation.\n  return this.registerPendingPromise_(\n      // Wrap in promise as ActionCodeSettings constructor could throw a\n      // synchronous error if invalid arguments are specified.\n      this.getIdToken().then(function(latestIdToken) {\n        idToken = latestIdToken;\n        if (typeof opt_actionCodeSettings !== 'undefined' &&\n            // Ignore empty objects.\n            !goog.object.isEmpty(opt_actionCodeSettings)) {\n          return new fireauth.ActionCodeSettings(\n              /** @type {!Object} */ (opt_actionCodeSettings)).buildRequest();\n        }\n        return {};\n      })\n      .then(function(additionalRequestData) {\n        return self.rpcHandler_.sendEmailVerification(\n            /** @type {string} */ (idToken), additionalRequestData);\n      })\n      .then(function(email) {\n        if (self['email'] != email) {\n          // Our local copy does not have an email. If the email changed,\n          // reload the user.\n          return self.reload();\n        }\n      })\n      .then(function() {\n        // Return nothing.\n      }));\n};\n\n\n/**\n * Destroys the user object and makes further operations invalid. Sensitive\n * fields (refreshToken) are also cleared.\n */\nfireauth.AuthUser.prototype.destroy = function() {\n  // Cancel all pending promises.\n  for (var i = 0; i < this.pendingPromises_.length; i++) {\n    this.pendingPromises_[i].cancel(fireauth.authenum.Error.MODULE_DESTROYED);\n  }\n  // Stop listening to language code changes.\n  this.setLanguageCodeChangeDispatcher(null);\n  // Stop listening to framework changes.\n  this.setFrameworkChangeDispatcher(null);\n  // Empty pending promises array.\n  this.pendingPromises_ = [];\n  this.destroyed_ = true;\n  // Stop proactive refresh if running.\n  this.stopProactiveRefresh();\n  fireauth.object.setReadonlyProperty(this, 'refreshToken', null);\n  // Make sure the destroyed user is unsubscribed from Auth event handling.\n  if (this.authEventManager_) {\n    this.authEventManager_.unsubscribe(this);\n  }\n};\n\n\n/**\n * Takes in a pending promise, saves it and adds a clean up callback which\n * forgets the pending promise after it is fulfilled and echoes the promise\n * back. If in the process, a user invalidation error is detected, caches the\n * error so next time a call is made on the user, the operation will fail with\n * the cached error.\n * @param {!goog.Promise<*, *>|!goog.Promise<void>} p The pending promise.\n * @param {boolean=} opt_skipInvalidationCheck Whether to skip invalidation\n *     check.\n * @return {!goog.Promise<*, *>|!goog.Promise<void>}\n * @private\n */\nfireauth.AuthUser.prototype.registerPendingPromise_ =\n    function(p, opt_skipInvalidationCheck) {\n  var self = this;\n  // Check if user invalidation occurs.\n  var processedP = this.checkIfInvalidated_(p, opt_skipInvalidationCheck);\n  // Save created promise in pending list.\n  this.pendingPromises_.push(processedP);\n  processedP.thenAlways(function() {\n    // When fulfilled, remove from pending list.\n    goog.array.remove(self.pendingPromises_, processedP);\n  });\n  // Return the promise.\n  return processedP;\n};\n\n\n/**\n * Check if user invalidation occurs. If so, it caches the error so it can be\n * thrown immediately the next time an operation is run on the user.\n * @param {!goog.Promise<*, *>|!goog.Promise<void>} p The pending promise.\n * @param {boolean=} opt_skipInvalidationCheck Whether to skip invalidation\n *     check.\n * @return {!goog.Promise<*, *>|!goog.Promise<void>}\n * @private\n */\nfireauth.AuthUser.prototype.checkIfInvalidated_ =\n    function(p, opt_skipInvalidationCheck) {\n  var self = this;\n  // Already invalidated, reject with token expired error.\n  // Unless invalidation check is to be skipped.\n  if (this.userInvalidatedError_ && !opt_skipInvalidationCheck) {\n    // Cancel pending promise.\n    p.cancel();\n    // Reject with cached error.\n    return goog.Promise.reject(this.userInvalidatedError_);\n  }\n  return p.thenCatch(function(error) {\n    // Session invalidated.\n    if (fireauth.AuthUser.isUserInvalidated_(error)) {\n      // Notify listeners of invalidated session.\n      if (!self.userInvalidatedError_) {\n        self.notifyUserInvalidatedListeners_();\n      }\n      // Cache the invalidation error.\n      self.userInvalidatedError_ = /** @type {!fireauth.AuthError} */ (error);\n    }\n    // Rethrow the error.\n    throw error;\n  });\n};\n\n\n/**\n * @return {!Object} The object representation of the user instance.\n * @override\n */\nfireauth.AuthUser.prototype.toJSON = function() {\n  // Return the plain object representation in case JSON.stringify is called on\n  // a user instance.\n  return this.toPlainObject();\n};\n\n\n/**\n * @return {!Object} The object representation of the user instance.\n */\nfireauth.AuthUser.prototype.toPlainObject = function() {\n  var obj = {\n    'uid': this['uid'],\n    'displayName': this['displayName'],\n    'photoURL': this['photoURL'],\n    'email': this['email'],\n    'emailVerified': this['emailVerified'],\n    'phoneNumber': this['phoneNumber'],\n    'isAnonymous': this['isAnonymous'],\n    'tenantId': this['tenantId'],\n    'providerData': [],\n    'apiKey': this.apiKey_,\n    'appName': this.appName_,\n    'authDomain': this.authDomain_,\n    'stsTokenManager': this.stsTokenManager_.toPlainObject(),\n    // Redirect event ID must be maintained in case there is a pending redirect\n    // event.\n    'redirectEventId': this.getRedirectEventId()\n  };\n  // Extend user plain object with metadata object.\n  if (this['metadata']) {\n    goog.object.extend(obj, this['metadata'].toPlainObject());\n  }\n  goog.array.forEach(this['providerData'], function(userInfo) {\n    obj['providerData'].push(fireauth.object.makeWritableCopy(userInfo));\n  });\n  return obj;\n};\n\n\n/**\n * Converts a plain user object to {@code fireauth.AuthUser}.\n * @param {!Object} user The object representation of the user instance.\n * @return {?fireauth.AuthUser} The Firebase user object corresponding to\n *     object.\n */\nfireauth.AuthUser.fromPlainObject = function(user) {\n  if (!user['apiKey']) {\n    return null;\n  }\n  var options = {\n    'apiKey': user['apiKey'],\n    'authDomain': user['authDomain'],\n    'appName': user['appName']\n  };\n  // Convert to server response format. Constructor does not take\n  // stsTokenManager toPlainObject as that format is different than the return\n  // server response which is always used to initialize a user instance. It is\n  // also difficult to have toPlainObject equal server response due to expiresIn\n  // field in server response. toPlainObject will return an expiration time\n  // instead.\n  var stsTokenManagerResponse = {};\n  if (user['stsTokenManager'] &&\n      user['stsTokenManager']['accessToken'] &&\n      user['stsTokenManager']['expirationTime']) {\n    stsTokenManagerResponse[fireauth.RpcHandler.AuthServerField.ID_TOKEN] =\n        user['stsTokenManager']['accessToken'];\n    // Refresh token could be expired.\n    stsTokenManagerResponse[fireauth.RpcHandler.AuthServerField.REFRESH_TOKEN] =\n        user['stsTokenManager']['refreshToken'] || null;\n    stsTokenManagerResponse[fireauth.RpcHandler.AuthServerField.EXPIRES_IN] =\n        (user['stsTokenManager']['expirationTime'] - goog.now()) / 1000;\n  } else {\n    // Token response is a required field.\n    return null;\n  }\n  var firebaseUser = new fireauth.AuthUser(options,\n      stsTokenManagerResponse,\n      /** @type {!fireauth.AuthUser.AccountInfo} */ (user));\n  if (user['providerData']) {\n    goog.array.forEach(user['providerData'], function(userInfo) {\n      if (userInfo) {\n        firebaseUser.addProviderData(/** @type {!fireauth.AuthUserInfo} */ (\n            fireauth.object.makeReadonlyCopy(userInfo)));\n      }\n    });\n  }\n  // Redirect event ID must be restored to complete any pending link with\n  // redirect operation owned by this user.\n  if (user['redirectEventId']) {\n    firebaseUser.setRedirectEventId(user['redirectEventId']);\n  }\n  return firebaseUser;\n};\n\n\n\n/**\n * Factory method for initializing a Firebase user object and populating its\n * user info. This is the recommended way for initializing a user externally.\n * On sign in/up operation, the server returns a token response. The response is\n * all that is needed to initialize this user.\n * @param {!Object} appOptions The application options.\n * @param {!Object} stsTokenResponse The server STS token response.\n * @param {?fireauth.storage.RedirectUserManager=}\n *     opt_redirectStorageManager The utility used to store and delete a user on\n *     link with redirect.\n * @param {?Array<string>=} opt_frameworks The list of frameworks to log on the\n *     user on initialization.\n * @return {!goog.Promise<!fireauth.AuthUser>}\n */\nfireauth.AuthUser.initializeFromIdTokenResponse = function(appOptions,\n    stsTokenResponse, opt_redirectStorageManager, opt_frameworks) {\n  // Initialize the Firebase Auth user.\n  var user = new fireauth.AuthUser(\n      appOptions, stsTokenResponse);\n  // If redirect storage manager provided, set it.\n  if (opt_redirectStorageManager) {\n    user.setRedirectStorageManager(opt_redirectStorageManager);\n  }\n  // If frameworks provided, set it.\n  if (opt_frameworks) {\n    user.setFramework(opt_frameworks);\n  }\n  // Updates the user info and data and resolves with a user instance.\n  return user.reload().then(function() {\n    return user;\n  });\n};\n\n\n/**\n * Returns an AuthUser copy of the provided user using the provided parameters\n * without making any network request.\n * @param {!fireauth.AuthUser} user The user to be copied.\n * @param {?Object=} opt_appOptions The application options.\n * @param {?fireauth.storage.RedirectUserManager=}\n *     opt_redirectStorageManager The utility used to store and delete a user on\n *     link with redirect.\n * @param {?Array<string>=} opt_frameworks The list of frameworks to log on the\n *     user on initialization.\n * @return {!fireauth.AuthUser}\n */\nfireauth.AuthUser.copyUser = function(user, opt_appOptions,\n    opt_redirectStorageManager, opt_frameworks) {\n  var appOptions = opt_appOptions || {\n    'apiKey': user.apiKey_,\n    'authDomain': user.authDomain_,\n    'appName': user.appName_\n  };\n  var newUser = new fireauth.AuthUser(\n      appOptions, user.getStsTokenManager().toServerResponse());\n  // If redirect storage manager provided, set it.\n  if (opt_redirectStorageManager) {\n    newUser.setRedirectStorageManager(opt_redirectStorageManager);\n  }\n  // If frameworks provided, set it.\n  if (opt_frameworks) {\n    newUser.setFramework(opt_frameworks);\n  }\n  // Copy remaining properties.\n  newUser.copy(user);\n  return newUser;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the fireauth.storage.RedirectUserManager class which\n * provides utilities to store, retrieve and delete an Auth user during a\n * redirect operation.\n */\n\ngoog.provide('fireauth.storage.RedirectUserManager');\n\ngoog.require('fireauth.AuthUser');\ngoog.require('fireauth.authStorage');\n\n\n/**\n * Defines the Auth redirect user storage manager. It provides methods\n * to store, load and delete a user going through a link with redirect\n * operation.\n * @param {string} appId The Auth state's application ID.\n * @param {?fireauth.authStorage.Manager=} opt_manager The underlying storage\n *     manager to use. If none is provided, the default global instance is used.\n * @constructor @struct @final\n */\nfireauth.storage.RedirectUserManager = function(appId, opt_manager) {\n  /** @const @private{string} appId The Auth state's application ID. */\n  this.appId_ = appId;\n  /**\n   * @const @private{!fireauth.authStorage.Manager} The underlying storage\n   *     manager.\n   */\n  this.manager_ = opt_manager || fireauth.authStorage.Manager.getInstance();\n};\n\n\n/**\n * @const @private{!fireauth.authStorage.Key} The Auth redirect user storage\n *     identifier.\n */\nfireauth.storage.RedirectUserManager.REDIRECT_USER_KEY_ = {\n  name: 'redirectUser',\n  persistent: fireauth.authStorage.Persistence.SESSION\n};\n\n\n/**\n * Stores the user being redirected for the provided application ID.\n * @param {!fireauth.AuthUser} redirectUser The user being redirected.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.RedirectUserManager.prototype.setRedirectUser =\n    function(redirectUser) {\n  return this.manager_.set(\n      fireauth.storage.RedirectUserManager.REDIRECT_USER_KEY_,\n      redirectUser.toPlainObject(),\n      this.appId_);\n};\n\n\n/**\n * Removes the stored redirected user for provided app ID.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.RedirectUserManager.prototype.removeRedirectUser =\n    function() {\n  return this.manager_.remove(\n      fireauth.storage.RedirectUserManager.REDIRECT_USER_KEY_, this.appId_);\n};\n\n\n/**\n * @param {?string=} opt_authDomain The optional Auth domain to override if\n *     provided.\n * @return {!goog.Promise<?fireauth.AuthUser>} A promise that resolves with\n *     the stored redirected user for the provided app ID.\n */\nfireauth.storage.RedirectUserManager.prototype.getRedirectUser =\n    function(opt_authDomain) {\n  return this.manager_.get(\n      fireauth.storage.RedirectUserManager.REDIRECT_USER_KEY_, this.appId_)\n      .then(function(response) {\n        // If potential user saved, override Auth domain if authDomain is\n        // provided.\n        if (response && opt_authDomain) {\n          response['authDomain'] = opt_authDomain;\n        }\n        return fireauth.AuthUser.fromPlainObject(response || {});\n      });\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the fireauth.storage.UserManager class which provides\n * utilities to retrieve, store and delete the currently logged in user and to\n * listen to external authentication changes for the same app.\n * With the ability to modify Auth state persistence. The behavior is as\n * follows:\n * Common cases:\n * <ul>\n * <li>Initially, local and session storage will be checked and the state will\n *     be loaded from there without changing it unless the developer calls\n *     setPersistence explicitly. The requirement is that at any time, Auth\n *     state can be saved using one type only of persistence and never more than\n *     one.</li>\n * <li>If the developer tries to sign in with no persistence specified, the\n *     default setting will be used (local in a browser).</li>\n * <li>If the user is not signed in and persistence is set, any future sign-in\n *     attempt will use that type of persistence.</li>\n * <li>If the user is signed in and the developer then switches persistence,\n *     that existing signed in user will change persistence to the new one. All\n *     future sign-in attempts will use that same persistence.</li>\n * <li>When signInWithRedirect is called, the current persistence type is passed\n *     along with that request and on redirect back to app will pass that type\n *     to determine how that state is saved (overriding the default). If the\n *     persistence is explicitly specified on that page, it will change that\n *     redirected Auth state persistence. This is the only time the persistence\n *     is passed from one page to another.\n *     So internally, on redirect, the redirect state is retrieved and then we\n *     check: If the persistence was explicitly provided, we override the\n *     previous type and save the Auth state using that. If no persistence was\n *     explicitly provided, we use the previous persistence type that was passed\n *     in the redirect response.</li>\n * </ul>\n * Behavior across tabs:\n * <ul>\n * <li>User can sign in using session storage on multiple tabs. Each tab cannot\n *     see the state of the other tab.</li>\n * <li>Any attempt to sign in using local storage will be detected and\n *     synchronized on all tabs. If the user was previously signed in on a\n *     specific tab using session storage, that state will be cleared.</li>\n * <li>If the user was previously signed in using local storage and then signs\n *     in using session storage, the user will be signed in on the current tab\n *     only and signed out on all other tabs.</li>\n * <li>Similar logic is applied to the none state. In one tab, switching to\n *     none state will delete any previously saved state in local\n *     persistence in other tabs.</li>\n * </ul>\n */\n\ngoog.provide('fireauth.storage.UserManager');\n\ngoog.require('fireauth.AuthUser');\ngoog.require('fireauth.authStorage');\ngoog.require('goog.Promise');\n\n\n/**\n * Defines the Auth user storage manager. It provides methods to\n * store, load and delete an authenticated current user. It also provides\n * methods to listen to external user changes (updates, sign in, sign out, etc.)\n * @param {string} appId The Auth state's application ID.\n * @param {?fireauth.authStorage.Manager=} opt_manager The underlying storage\n *     manager to use. If none is provided, the default global instance is used.\n * @constructor @struct @final\n */\nfireauth.storage.UserManager = function(appId, opt_manager) {\n  /** @const @private{string} appId The Auth state's application ID. */\n  this.appId_ = appId;\n  /**\n   * @const @private{!fireauth.authStorage.Manager} The underlying storage\n   *     manager.\n   */\n  this.manager_ = opt_manager || fireauth.authStorage.Manager.getInstance();\n  /**\n   * @private {?fireauth.authStorage.Key} The current Auth user storage\n   *     identifier.\n   */\n  this.currentAuthUserKey_ = null;\n  /**\n   * @private {!goog.Promise} Storage operation serializer promise. This will\n   *     initialize the current persistence used and clean up any duplicate\n   *     states or temporary values (persistence for pending redirect).\n   *     Afterwards this is used to queue storage requests to make sure\n   *     storage operations are always synchronized and read/write events are\n   *     processed on the same storage.\n   */\n  this.onReady_ = this.initialize_();\n  // This internal listener will always run before the external ones.\n  // This is needed to queue processing of this first before any getCurrentUser\n  // is called from external listeners.\n  this.manager_.addListener(\n      fireauth.storage.UserManager.getAuthUserKey_(\n          fireauth.authStorage.Persistence.LOCAL),\n      this.appId_,\n      goog.bind(this.switchToLocalOnExternalEvent_, this));\n};\n\n\n/**\n * Switches to local storage on external storage event. This will happen when\n * state is specified as local in an external tab while it is none or session\n * in the current one. If a user signs in in an external tab, the current window\n * should detect this, clear existing storage and switch to local storage.\n * @private\n */\nfireauth.storage.UserManager.prototype.switchToLocalOnExternalEvent_ =\n    function() {\n  var self = this;\n  var localKey = fireauth.storage.UserManager.getAuthUserKey_(\n      fireauth.authStorage.Persistence.LOCAL);\n  // Wait for any pending operation to finish first.\n  // Block next read/write operation until persistence is transitioned to\n  // local.\n  this.waitForReady_(function() {\n    return goog.Promise.resolve().then(function() {\n      // If current persistence is not already local.\n      if (self.currentAuthUserKey_ &&\n          self.currentAuthUserKey_.persistent !=\n          fireauth.authStorage.Persistence.LOCAL) {\n        // Check if new current user is available in local storage.\n        return self.manager_.get(localKey, self.appId_);\n      }\n      return null;\n    }).then(function(response) {\n      // Sign in on an external tab.\n      if (response) {\n        // Remove any existing non-local user.\n        return self.removeAllExcept_(\n            fireauth.authStorage.Persistence.LOCAL).then(function() {\n              // Set persistence to local.\n              self.currentAuthUserKey_ = localKey;\n            });\n      }\n    });\n  });\n};\n\n\n/**\n * Removes all states stored in all supported persistence types excluding the\n * specified one.\n * @param {?fireauth.authStorage.Persistence} persistence The type of storage\n *     persistence to switch to.\n * @return {!goog.Promise} The promise that resolves when all stored values are\n *     removed for types of storage excluding specified persistence. This helps\n *     ensure there is always one type of persistence at any time.\n * @private\n */\nfireauth.storage.UserManager.prototype.removeAllExcept_ =\n    function(persistence) {\n  var promises = [];\n  // Queue all promises to remove current user in any other persistence type.\n  for (var key in fireauth.authStorage.Persistence) {\n    // Skip specified persistence.\n    if (fireauth.authStorage.Persistence[key] !== persistence) {\n      var storageKey = fireauth.storage.UserManager.getAuthUserKey_(\n          fireauth.authStorage.Persistence[key]);\n      promises.push(this.manager_.remove(\n          /** @type {!fireauth.authStorage.Key} */ (storageKey),\n          this.appId_));\n    }\n  }\n  // Clear persistence key (only useful for initial load upon returning from a\n  // a redirect sign-in operation).\n  promises.push(this.manager_.remove(\n      fireauth.storage.UserManager.PERSISTENCE_KEY_,\n      this.appId_));\n  return goog.Promise.all(promises);\n};\n\n\n/**\n * Initializes the current persistence state. This will check the 3 supported\n * types. The first one that is found will be the current persistence. All\n * others will be cleared. If none is found we check PERSISTENCE_KEY_ which\n * when specified means that the operation is returning from a\n * signInWithRedirect call. This persistence will be applied.\n * Otherwise the default local persistence is used.\n * @return {!goog.Promise} A promise that resolves when the current persistence\n *     is resolved.\n * @private\n */\nfireauth.storage.UserManager.prototype.initialize_ = function() {\n  var self = this;\n  // Local key.\n  var localKey = fireauth.storage.UserManager.getAuthUserKey_(\n      fireauth.authStorage.Persistence.LOCAL);\n  // Session key.\n  var sessionKey = fireauth.storage.UserManager.getAuthUserKey_(\n      fireauth.authStorage.Persistence.SESSION);\n  // In memory key. This is unlikely to contain anything on load.\n  var inMemoryKey = fireauth.storage.UserManager.getAuthUserKey_(\n      fireauth.authStorage.Persistence.NONE);\n  // Migrate any old currentUser from localStorage to indexedDB.\n  // This keeps any user signed in without the need for reauthentication and\n  // minimizes risks of dangling Auth states.\n  return this.manager_.migrateFromLocalStorage(\n      localKey, this.appId_).then(function() {\n    // Check if state is stored in session storage.\n    return self.manager_.get(sessionKey, self.appId_);\n  }).then(function(response) {\n    if (response) {\n      // Session storage is being used.\n      return sessionKey;\n    } else {\n      // Session storage is empty. Check in memory storage.\n      return self.manager_.get(inMemoryKey, self.appId_)\n          .then(function(response) {\n            if (response) {\n              // In memory storage being used.\n              return inMemoryKey;\n            } else {\n              // Check local storage.\n              return self.manager_.get(localKey, self.appId_)\n                  .then(function(response) {\n                    if (response) {\n                      // Local storage being used.\n                      return localKey;\n                    } else {\n                      // Nothing found in any supported storage.\n                      // Check current user persistence in storage.\n                      return self.manager_.get(\n                          fireauth.storage.UserManager.PERSISTENCE_KEY_,\n                          self.appId_).then(function(persistence) {\n                            if (persistence) {\n                              // Sign in with redirect operation, apply this\n                              // persistence to any current user.\n                              return fireauth.storage.UserManager\n                                  .getAuthUserKey_(persistence);\n                            } else {\n                              // No persistence found, use the default.\n                              return localKey;\n                            }\n                          });\n                    }\n                  });\n            }\n          });\n    }\n  }).then(function(currentKey) {\n    // Set current key according to the persistence detected.\n    self.currentAuthUserKey_ = currentKey;\n    // Make sure only one state available. Clean up everything else.\n    return self.removeAllExcept_(currentKey.persistent);\n  }).thenCatch(function(error) {\n    // If an error occurs in the process and no current key detected, set to\n    // persistence value to default.\n    if (!self.currentAuthUserKey_) {\n      self.currentAuthUserKey_ = localKey;\n    }\n  });\n};\n\n\n/**\n * @const @private {string} The Auth current user storage identifier name.\n */\nfireauth.storage.UserManager.AUTH_USER_KEY_NAME_ = 'authUser';\n\n\n/**\n * @const @private{!fireauth.authStorage.Key} The Auth user storage persistence\n *     identifier. This is needed to remember the previous persistence state for\n *     sign-in with redirect.\n */\nfireauth.storage.UserManager.PERSISTENCE_KEY_ = {\n  name: 'persistence',\n  persistent: fireauth.authStorage.Persistence.SESSION\n};\n\n\n/**\n * Returns the Auth user key corresponding to the persistence type provided.\n * @param {!fireauth.authStorage.Persistence} persistence The key for the\n *     specified type of persistence.\n * @return {!fireauth.authStorage.Key} The corresponding Auth user storage\n *     identifier.\n * @private\n */\nfireauth.storage.UserManager.getAuthUserKey_ = function(persistence) {\n  return {\n    name: fireauth.storage.UserManager.AUTH_USER_KEY_NAME_,\n    persistent: persistence\n  };\n};\n\n\n/**\n * Sets the persistence to the specified type.\n * If an existing user already is in storage, it copies that value to the new\n * storage and clears all the others.\n * @param {!fireauth.authStorage.Persistence} persistence The type of storage\n *     persistence to switch to.\n * @return {!goog.Promise} A promise that resolves when persistence change is\n *     applied.\n */\nfireauth.storage.UserManager.prototype.setPersistence = function(persistence) {\n  var currentUser = null;\n  var self = this;\n  // Validate the persistence type provided. This will throw a synchronous error\n  // if invalid.\n  fireauth.authStorage.validatePersistenceArgument(persistence);\n  // Wait for turn in queue.\n  return this.waitForReady_(function() {\n    // If persistence hasn't changed, do nothing.\n    if (persistence != self.currentAuthUserKey_.persistent) {\n      // Persistence changed. Copy from current storage to new one.\n      return self.manager_.get(\n        /** @type {!fireauth.authStorage.Key} */ (self.currentAuthUserKey_),\n        self.appId_).then(function(result) {\n        // Save current user.\n        currentUser = result;\n        // Clear from current storage.\n        return self.removeAllExcept_(persistence);\n      }).then(function() {\n        // Update persistence key to the new one.\n        self.currentAuthUserKey_ =\n            fireauth.storage.UserManager.getAuthUserKey_(persistence);\n        // Copy current storage type to the new one.\n        if (currentUser) {\n          return self.manager_.set(\n              /** @type {!fireauth.authStorage.Key} */ (\n                  self.currentAuthUserKey_),\n              currentUser,\n              self.appId_);\n        }\n      });\n    }\n    // No change in persistence type.\n    return goog.Promise.resolve();\n  });\n};\n\n\n/**\n * Saves the current persistence type so it can be retrieved after a page\n * redirect. This is relevant for signInWithRedirect.\n * @return {!goog.Promise} Promise that resolve when current persistence is\n *     saved.\n */\nfireauth.storage.UserManager.prototype.savePersistenceForRedirect = function() {\n  var self = this;\n  return this.waitForReady_(function() {\n    // Save persistence to survive redirect.\n    return self.manager_.set(\n        fireauth.storage.UserManager.PERSISTENCE_KEY_,\n        self.currentAuthUserKey_.persistent,\n        self.appId_);\n  });\n};\n\n\n/**\n * Stores the current Auth user for the provided application ID.\n * @param {!fireauth.AuthUser} currentUser The app current Auth user to save.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.UserManager.prototype.setCurrentUser = function(currentUser) {\n  var self = this;\n  // Wait for any pending persistence change to be resolved.\n  return this.waitForReady_(function() {\n    return self.manager_.set(\n        /** @type {!fireauth.authStorage.Key} */ (self.currentAuthUserKey_),\n        currentUser.toPlainObject(),\n        self.appId_);\n  });\n};\n\n\n/**\n * Removes the stored current user for provided app ID.\n * @return {!goog.Promise<void>} A promise that resolves on success.\n */\nfireauth.storage.UserManager.prototype.removeCurrentUser = function() {\n  var self = this;\n  // Wait for any pending persistence change to be resolved.\n  return this.waitForReady_(function() {\n    return self.manager_.remove(\n        /** @type {!fireauth.authStorage.Key} */ (self.currentAuthUserKey_),\n        self.appId_);\n  });\n};\n\n\n/**\n * @param {?string=} opt_authDomain The optional Auth domain to override if\n *     provided.\n * @return {!goog.Promise<?fireauth.AuthUser>} A promise that resolves with\n *     the stored current user for the provided app ID.\n */\nfireauth.storage.UserManager.prototype.getCurrentUser =\n    function(opt_authDomain) {\n  var self = this;\n  // Wait for any pending persistence change to be resolved.\n  return this.waitForReady_(function() {\n    return self.manager_.get(\n        /** @type {!fireauth.authStorage.Key} */ (self.currentAuthUserKey_),\n        self.appId_).then(function(response) {\n          // If potential user saved, override Auth domain if authDomain is\n          // provided.\n          // This is useful in cases where on one page the developer initializes\n          // the Auth instance without authDomain and signs in user using\n          // headless methods. On another page, Auth is initialized with\n          // authDomain for the purpose of linking with a popup. The loaded user\n          // (stored without the authDomain) must have this field updated with\n          // the current authDomain.\n          if (response && opt_authDomain) {\n            response['authDomain'] = opt_authDomain;\n          }\n          return fireauth.AuthUser.fromPlainObject(response || {});\n        });\n  });\n};\n\n\n/**\n * Serializes storage access operations especially since persistence\n * could be updated from one type to the other while read/write operations\n * occur.\n * @param {function():!goog.Promise<T>} cb The promise return callback to chain\n *     when pending operations are resolved.\n * @return {!goog.Promise<T>} The resulting promise that resolves when provided\n *     promise finally resolves.\n * @template T\n * @private\n */\nfireauth.storage.UserManager.prototype.waitForReady_ = function(cb) {\n  // Wait for any pending persistence change to be resolved before running\n  // storage related operation. Chain to onReady so next call will wait for\n  // this operation to resolve.\n  // While an error is unlikely, run callback even if it happens, otherwise\n  // no storage related event will be allowed to complete after an error.\n  this.onReady_ = this.onReady_.then(cb, cb);\n  return this.onReady_;\n};\n\n\n/**\n * Adds a listener to Auth current user change event for app ID provided.\n * @param {!function()} listener The listener to run on current user change\n *     event.\n */\nfireauth.storage.UserManager.prototype.addCurrentUserChangeListener =\n    function(listener) {\n  // When this is triggered, getCurrentUser is called, that will have to wait\n  // for switchToLocalOnExternalEvent_ to resolve which is ahead of it in the\n  // queue.\n  this.manager_.addListener(\n      fireauth.storage.UserManager.getAuthUserKey_(\n          fireauth.authStorage.Persistence.LOCAL),\n      this.appId_,\n      listener);\n};\n\n\n/**\n * Removes a listener to Auth current user change event for app ID provided.\n * @param {!function()} listener The listener to remove from current user change\n *     event changes.\n */\nfireauth.storage.UserManager.prototype.removeCurrentUserChangeListener =\n    function(listener) {\n  this.manager_.removeListener(\n      fireauth.storage.UserManager.getAuthUserKey_(\n          fireauth.authStorage.Persistence.LOCAL),\n      this.appId_,\n      listener);\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview The headless Auth class used for authenticating Firebase users.\n */\n\ngoog.provide('fireauth.Auth');\n\ngoog.require('fireauth.ActionCodeInfo');\ngoog.require('fireauth.ActionCodeSettings');\ngoog.require('fireauth.AdditionalUserInfo');\ngoog.require('fireauth.AuthCredential');\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.AuthEvent');\ngoog.require('fireauth.AuthEventHandler');\ngoog.require('fireauth.AuthEventManager');\ngoog.require('fireauth.AuthProvider');\ngoog.require('fireauth.AuthSettings');\ngoog.require('fireauth.AuthUser');\ngoog.require('fireauth.ConfirmationResult');\ngoog.require('fireauth.EmailAuthProvider');\ngoog.require('fireauth.RpcHandler');\ngoog.require('fireauth.UserEventType');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.constants');\ngoog.require('fireauth.deprecation');\ngoog.require('fireauth.idp');\ngoog.require('fireauth.iframeclient.IfcHandler');\ngoog.require('fireauth.object');\ngoog.require('fireauth.storage.RedirectUserManager');\ngoog.require('fireauth.storage.UserManager');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.array');\ngoog.require('goog.events');\ngoog.require('goog.events.Event');\ngoog.require('goog.events.EventTarget');\ngoog.require('goog.object');\n\n\n\n/**\n * Creates the Firebase Auth corresponding for the App provided.\n *\n * @param {!firebase.app.App} app The corresponding Firebase App.\n * @constructor\n * @implements {fireauth.AuthEventHandler}\n * @implements {firebase.Service}\n * @extends {goog.events.EventTarget}\n */\nfireauth.Auth = function(app) {\n  /** @private {boolean} Whether this instance is deleted. */\n  this.deleted_ = false;\n  /** The Auth instance's settings object. */\n  fireauth.object.setReadonlyProperty(\n      this, 'settings', new fireauth.AuthSettings());\n  /** Auth's corresponding App. */\n  fireauth.object.setReadonlyProperty(this, 'app', app);\n  // Initialize RPC handler.\n  // API key is required for web client RPC calls.\n  if (this.app_().options && this.app_().options['apiKey']) {\n    var clientFullVersion = firebase.SDK_VERSION ?\n        fireauth.util.getClientVersion(\n            fireauth.util.ClientImplementation.JSCORE, firebase.SDK_VERSION) :\n        null;\n    this.rpcHandler_ = new fireauth.RpcHandler(\n        this.app_().options && this.app_().options['apiKey'],\n        // Get the client Auth endpoint used.\n        fireauth.constants.getEndpointConfig(fireauth.constants.clientEndpoint),\n        clientFullVersion);\n  } else {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_API_KEY);\n  }\n  /** @private {!Array<!goog.Promise<*, *>|!goog.Promise<void>>} List of\n   *      pending promises. */\n  this.pendingPromises_ = [];\n  /** @private {!Array<!function(?string)>} Auth token listeners. */\n  this.authListeners_ = [];\n  /** @private {!Array<!function(?string)>} User change listeners. */\n  this.userChangeListeners_ = [];\n  /**\n   * @private {!firebase.Subscribe} The subscribe function to the Auth ID token\n   *     change observer. This will trigger on ID token changes, including\n   *     token refresh on the same user.\n   */\n  this.onIdTokenChanged_ = firebase.INTERNAL.createSubscribe(\n      goog.bind(this.initIdTokenChangeObserver_, this));\n  /**\n   * @private {?string|undefined} The UID of the user that last triggered the\n   *     user state change listener.\n   */\n  this.userStateChangeUid_ = undefined;\n  /**\n   * @private {!firebase.Subscribe} The subscribe function to the user state\n   *     change observer.\n   */\n  this.onUserStateChanged_ = firebase.INTERNAL.createSubscribe(\n      goog.bind(this.initUserStateObserver_, this));\n  // Set currentUser to null.\n  this.setCurrentUser_(null);\n  /**\n   * @private {!fireauth.storage.UserManager} The Auth user storage\n   *     manager instance.\n   */\n  this.userStorageManager_ =\n      new fireauth.storage.UserManager(this.getStorageKey());\n  /**\n   * @private {!fireauth.storage.RedirectUserManager} The redirect user\n   *     storagemanager instance.\n   */\n  this.redirectUserStorageManager_ =\n      new fireauth.storage.RedirectUserManager(this.getStorageKey());\n  /**\n   * @private {!goog.Promise<undefined>} Promise that resolves when initial\n   *     state is loaded from storage.\n   */\n  this.authStateLoaded_ = this.registerPendingPromise_(this.initAuthState_());\n  /**\n   * @private {!goog.Promise<undefined>} Promise that resolves when state and\n   *     redirect result is ready, after which sign in and sign out operations\n   *     are safe to execute.\n   */\n  this.redirectStateIsReady_ = this.registerPendingPromise_(\n      this.initAuthRedirectState_());\n  /** @private {boolean} Whether initial state has already been resolved. */\n  this.isStateResolved_ = false;\n  /**\n   * @private {!function()} The syncAuthChanges function with context set to\n   *     auth instance.\n   */\n  this.getSyncAuthUserChanges_ = goog.bind(this.syncAuthUserChanges_, this);\n  /** @private {!function(!fireauth.AuthUser):!goog.Promise} The handler for\n   *      user state changes. */\n  this.userStateChangeListener_ =\n      goog.bind(this.handleUserStateChange_, this);\n  /** @private {!function(!Object)} The handler for user token changes. */\n  this.userTokenChangeListener_ =\n      goog.bind(this.handleUserTokenChange_, this);\n  /** @private {!function(!Object)} The handler for user deletion. */\n  this.userDeleteListener_ = goog.bind(this.handleUserDelete_, this);\n  /** @private {!function(!Object)} The handler for user invalidation. */\n  this.userInvalidatedListener_ = goog.bind(this.handleUserInvalidated_, this);\n  /**\n   * @private {?fireauth.AuthEventManager} The Auth event manager instance.\n   */\n  this.authEventManager_ = null;\n  // TODO: find better way to enable or disable auth event manager.\n  if (fireauth.AuthEventManager.ENABLED) {\n    // Initialize Auth event manager to handle popup and redirect operations.\n    this.initAuthEventManager_();\n  }\n\n  // Export INTERNAL namespace.\n  this.INTERNAL = {};\n  this.INTERNAL['delete'] = goog.bind(this.delete, this);\n  this.INTERNAL['logFramework'] = goog.bind(this.logFramework, this);\n  /**\n   * @private {number} The number of Firebase services subscribed to Auth\n   *     changes.\n   */\n  this.firebaseServices_ = 0;\n  // Add call to superclass constructor.\n  fireauth.Auth.base(this, 'constructor');\n  // Initialize readable/writable Auth properties.\n  this.initializeReadableWritableProps_();\n  /**\n   * @private {!Array<string>} List of Firebase frameworks/libraries used. This\n   *     is currently only used to log FirebaseUI.\n   */\n  this.frameworks_ = [];\n};\ngoog.inherits(fireauth.Auth, goog.events.EventTarget);\n\n\n/**\n * Language code change custom event.\n * @param {?string} languageCode The new language code.\n * @constructor\n * @extends {goog.events.Event}\n */\nfireauth.Auth.LanguageCodeChangeEvent = function(languageCode) {\n  goog.events.Event.call(\n      this, fireauth.constants.AuthEventType.LANGUAGE_CODE_CHANGED);\n  this.languageCode = languageCode;\n};\ngoog.inherits(fireauth.Auth.LanguageCodeChangeEvent, goog.events.Event);\n\n\n/**\n * Framework change custom event.\n * @param {!Array<string>} frameworks The new frameworks array.\n * @constructor\n * @extends {goog.events.Event}\n */\nfireauth.Auth.FrameworkChangeEvent = function(frameworks) {\n  goog.events.Event.call(\n      this, fireauth.constants.AuthEventType.FRAMEWORK_CHANGED);\n  this.frameworks = frameworks;\n};\ngoog.inherits(fireauth.Auth.FrameworkChangeEvent, goog.events.Event);\n\n\n/**\n * Changes the Auth state persistence to the specified one.\n * @param {!fireauth.authStorage.Persistence} persistence The Auth state\n *     persistence mechanism.\n * @return {!goog.Promise<void>}\n */\nfireauth.Auth.prototype.setPersistence = function(persistence) {\n  // TODO: fix auth.delete() behavior and how this affects persistence\n  // change after deletion.\n  // Throw an error if already destroyed.\n  // Set current persistence.\n  var p = this.userStorageManager_.setPersistence(persistence);\n  return /** @type {!goog.Promise<void>} */ (this.registerPendingPromise_(p));\n};\n\n\n/**\n * Get rid of Closure warning - the property is adding in the constructor.\n * @type {!firebase.app.App}\n */\nfireauth.Auth.prototype.app;\n\n\n/**\n * Sets the language code.\n * @param {?string} languageCode\n */\nfireauth.Auth.prototype.setLanguageCode = function(languageCode) {\n  // Don't do anything if no change detected.\n  if (this.languageCode_ !== languageCode && !this.deleted_) {\n    this.languageCode_ = languageCode;\n    // Update custom Firebase locale field.\n    this.rpcHandler_.updateCustomLocaleHeader(this.languageCode_);\n    // Notify external language code change listeners.\n    this.notifyLanguageCodeListeners_();\n  }\n};\n\n\n/**\n * Returns the current auth instance's language code if available.\n * @return {?string}\n */\nfireauth.Auth.prototype.getLanguageCode = function() {\n  return this.languageCode_;\n};\n\n\n/**\n * Sets the current language to the default device/browser preference.\n */\nfireauth.Auth.prototype.useDeviceLanguage = function() {\n  this.setLanguageCode(fireauth.util.getUserLanguage());\n};\n\n\n/**\n * @param {string} frameworkId The framework identifier.\n */\nfireauth.Auth.prototype.logFramework = function(frameworkId) {\n  // Theoretically multiple frameworks could be used\n  // (angularfire and FirebaseUI). Once a framework is used, it is not going\n  // to be unused, so no point adding a method to remove the framework ID.\n  this.frameworks_.push(frameworkId);\n  // Update the client version in RPC handler with the new frameworks.\n  this.rpcHandler_.updateClientVersion(firebase.SDK_VERSION ?\n        fireauth.util.getClientVersion(\n            fireauth.util.ClientImplementation.JSCORE, firebase.SDK_VERSION,\n            this.frameworks_) :\n        null);\n  this.dispatchEvent(new fireauth.Auth.FrameworkChangeEvent(\n      this.frameworks_));\n};\n\n\n/** @return {!Array<string>} The current Firebase frameworks. */\nfireauth.Auth.prototype.getFramework = function() {\n  return goog.array.clone(this.frameworks_);\n};\n\n\n/**\n * Updates the framework list on the provided user and configures the user to\n * listen to the Auth instance for any framework ID changes.\n * @param {!fireauth.AuthUser} user The user to whose framework list needs to be\n *     updated.\n * @private\n */\nfireauth.Auth.prototype.setUserFramework_ = function(user) {\n  // Sets the framework ID on the user.\n  user.setFramework(this.frameworks_);\n  // Sets current Auth instance as framework list change dispatcher on the user.\n  user.setFrameworkChangeDispatcher(this);\n};\n\n\n/**\n * Sets the tenant ID.\n * @param {?string} tenantId The tenant ID of the tenant project if available.\n */\nfireauth.Auth.prototype.setTenantId = function(tenantId) {\n  // Don't do anything if no change detected.\n  if (this.tenantId_ !== tenantId && !this.deleted_) {\n    this.tenantId_ = tenantId;\n    this.rpcHandler_.updateTenantId(this.tenantId_);\n  }\n};\n\n\n/**\n * Returns the current Auth instance's tenant ID.\n * @return {?string}\n */\nfireauth.Auth.prototype.getTenantId = function() {\n  return this.tenantId_;\n};\n\n\n/**\n * Initializes readable/writable properties on Auth.\n * @suppress {invalidCasts}\n * @private\n */\nfireauth.Auth.prototype.initializeReadableWritableProps_ = function() {\n  Object.defineProperty(/** @type {!Object} */ (this), 'lc', {\n    /**\n     * @this {!Object}\n     * @return {?string} The current language code.\n     */\n    get: function() {\n      return this.getLanguageCode();\n    },\n    /**\n     * @this {!Object}\n     * @param {string} value The new language code.\n     */\n    set: function(value) {\n      this.setLanguageCode(value);\n    },\n    enumerable: false\n  });\n  // Initialize to null.\n  /** @private {?string} The current Auth instance's language code. */\n  this.languageCode_ = null;\n\n  // Initialize tenant ID.\n  Object.defineProperty(/** @type {!Object} */ (this), 'ti', {\n    /**\n     * @this {!Object}\n     * @return {?string} The current tenant ID.\n     */\n    get: function() {\n      return this.getTenantId();\n    },\n    /**\n     * @this {!Object}\n     * @param {?string} value The new tenant ID.\n     */\n    set: function(value) {\n      this.setTenantId(value);\n    },\n    enumerable: false\n  });\n  // Initialize to null.\n  /** @private {?string} The current Auth instance's tenant ID. */\n  this.tenantId_ = null;\n};\n\n\n/**\n * Notifies all external listeners of the language code change.\n * @private\n */\nfireauth.Auth.prototype.notifyLanguageCodeListeners_ = function() {\n  // Notify external listeners on the language code change.\n  this.dispatchEvent(new fireauth.Auth.LanguageCodeChangeEvent(\n      this.getLanguageCode()));\n};\n\n\n\n\n\n/**\n * @return {!Object} The object representation of the Auth instance.\n * @override\n */\nfireauth.Auth.prototype.toJSON = function() {\n  // Return the plain object representation in case JSON.stringify is called on\n  // an Auth instance.\n  return {\n    'apiKey': this.app_().options['apiKey'],\n    'authDomain': this.app_().options['authDomain'],\n    'appName': this.app_().name,\n    'currentUser': this.currentUser_() && this.currentUser_().toPlainObject()\n  };\n};\n\n\n/**\n * Returns the Auth event manager promise.\n * @return {!goog.Promise<!fireauth.AuthEventManager>}\n * @private\n */\nfireauth.Auth.prototype.getAuthEventManager_ = function() {\n  // Either return cached Auth event manager promise provider if available or a\n  // promise that rejects with missing Auth domain error.\n  return this.eventManagerProviderPromise_ ||\n      goog.Promise.reject(\n          new fireauth.AuthError(fireauth.authenum.Error.MISSING_AUTH_DOMAIN));\n};\n\n\n/**\n * Initializes the Auth event manager when state is ready.\n * @private\n */\nfireauth.Auth.prototype.initAuthEventManager_ = function() {\n  // Initialize Auth event manager on initState.\n  var self = this;\n  var authDomain = this.app_().options['authDomain'];\n  var apiKey = this.app_().options['apiKey'];\n  // Make sure environment also supports popup and redirect.\n  if (authDomain && fireauth.util.isPopupRedirectSupported()) {\n    // Auth domain is required for Auth event manager to resolve.\n    // Auth state has to be loaded first. One reason is to process link events.\n    this.eventManagerProviderPromise_ = this.authStateLoaded_.then(function() {\n      if (self.deleted_) {\n        return;\n      }\n      // By this time currentUser should be ready if available and will be able\n      // to resolve linkWithRedirect if detected.\n      self.authEventManager_ = fireauth.AuthEventManager.getManager(\n          authDomain, apiKey, self.app_().name);\n      // Subscribe Auth instance.\n      self.authEventManager_.subscribe(self);\n      // Subscribe current user by enabling popup and redirect on that user.\n      if (self.currentUser_()) {\n        self.currentUser_().enablePopupRedirect();\n      }\n      // If a redirect user is present, subscribe to popup and redirect events.\n      // In case current user was not available and the developer called link\n      // with redirect on a signed out user, this will work and the linked\n      // logged out user will be returned in getRedirectResult.\n      // current user and redirect user are the same (was already logged in),\n      // currentUser will have priority as it is subscribed before redirect\n      // user. This change will also allow further popup and redirect events on\n      // the redirect user going forward.\n      if (self.redirectUser_) {\n        self.redirectUser_.enablePopupRedirect();\n        // Set the user language for the redirect user.\n        self.setUserLanguage_(\n            /** @type {!fireauth.AuthUser} */ (self.redirectUser_));\n        // Set the user Firebase frameworks for the redirect user.\n        self.setUserFramework_(\n            /** @type {!fireauth.AuthUser} */ (self.redirectUser_));\n        // Reference to redirect user no longer needed.\n        self.redirectUser_ = null;\n      }\n      return self.authEventManager_;\n    });\n  }\n};\n\n\n/**\n * @param {!fireauth.AuthEvent.Type} mode The Auth type mode.\n * @param {?string=} opt_eventId The event ID.\n * @return {boolean} Whether the auth event handler can handler the provided\n *     event.\n * @override\n */\nfireauth.Auth.prototype.canHandleAuthEvent = function(mode, opt_eventId) {\n  // Only sign in events are handled.\n  switch (mode) {\n    // Accept all general sign in with redirect and unknowns.\n    // Migrating redirect events to use session storage will prevent this event\n    // from leaking to other tabs.\n    case fireauth.AuthEvent.Type.UNKNOWN:\n    case fireauth.AuthEvent.Type.SIGN_IN_VIA_REDIRECT:\n      return true;\n    case fireauth.AuthEvent.Type. SIGN_IN_VIA_POPUP:\n      // Pending sign in with popup event must match the stored popup event ID.\n      return this.popupEventId_ == opt_eventId &&\n          !!this.pendingPopupResolvePromise_;\n    default:\n      return false;\n  }\n};\n\n\n/**\n * Completes the pending popup operation. If error is not null, rejects with the\n * error. Otherwise, it resolves with the popup redirect result.\n * @param {!fireauth.AuthEvent.Type} mode The Auth type mode.\n * @param {?fireauth.AuthEventManager.Result} popupRedirectResult The result\n *     to resolve with when no error supplied.\n * @param {?fireauth.AuthError} error When supplied, the promise will reject.\n * @param {?string=} opt_eventId The event ID.\n * @override\n */\nfireauth.Auth.prototype.resolvePendingPopupEvent =\n    function(mode, popupRedirectResult, error, opt_eventId) {\n  // Only handles popup events of type sign in and which match popup event ID.\n  if (mode != fireauth.AuthEvent.Type.SIGN_IN_VIA_POPUP ||\n      this.popupEventId_ != opt_eventId) {\n    return;\n  }\n  if (error && this.pendingPopupRejectPromise_) {\n    // Reject with error for supplied mode.\n    this.pendingPopupRejectPromise_(error);\n  } else if (popupRedirectResult &&\n             !error &&\n             this.pendingPopupResolvePromise_) {\n    // Resolve with result for supplied mode.\n    this.pendingPopupResolvePromise_(popupRedirectResult);\n  }\n  // Now that event is resolved, delete popup timeout promise.\n  if (this.popupTimeoutPromise_) {\n    this.popupTimeoutPromise_.cancel();\n    this.popupTimeoutPromise_ = null;\n  }\n  // Delete pending promises.\n  delete this.pendingPopupResolvePromise_;\n  delete this.pendingPopupRejectPromise_;\n};\n\n\n/**\n * Returns the handler's appropriate popup and redirect sign in operation\n * finisher.\n * @param {!fireauth.AuthEvent.Type} mode The Auth type mode.\n * @param {?string=} opt_eventId The optional event ID.\n * @return {?function(string, string, ?string,\n *     ?string=):!goog.Promise<!fireauth.AuthEventManager.Result>}\n * @override\n */\nfireauth.Auth.prototype.getAuthEventHandlerFinisher =\n    function(mode, opt_eventId) {\n  // Sign in events will be completed by finishPopupAndRedirectSignIn.\n  if (mode == fireauth.AuthEvent.Type.SIGN_IN_VIA_REDIRECT) {\n    return goog.bind(this.finishPopupAndRedirectSignIn, this);\n  } else if (mode == fireauth.AuthEvent.Type.SIGN_IN_VIA_POPUP &&\n             this.popupEventId_ == opt_eventId &&\n             this.pendingPopupResolvePromise_) {\n    return goog.bind(this.finishPopupAndRedirectSignIn, this);\n  }\n  return null;\n};\n\n\n/**\n * Finishes the popup and redirect sign in operations.\n * @param {string} requestUri The callback url with the oauth response.\n * @param {string} sessionId The session id used to generate the authUri.\n * @param {?string} tenantId The tenant ID.\n * @param {?string=} opt_postBody The optional POST body content.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.finishPopupAndRedirectSignIn =\n    function(requestUri, sessionId, tenantId, opt_postBody) {\n  var self = this;\n  // Verify assertion request.\n  var request = {\n    'requestUri': requestUri,\n    'postBody': opt_postBody,\n    'sessionId': sessionId,\n    // Even if tenant ID is null, still pass it to RPC handler explicitly so\n    // that it won't be overridden by RPC handler's tenant ID.\n    'tenantId': tenantId\n  };\n  // Now that popup has responded, delete popup timeout promise.\n  if (this.popupTimeoutPromise_) {\n    this.popupTimeoutPromise_.cancel();\n    this.popupTimeoutPromise_ = null;\n  }\n  // This routine could be run before init state, make sure it waits for that to\n  // complete.\n  var credential = null;\n  var additionalUserInfo = null;\n  var idTokenResolver = self.rpcHandler_.verifyAssertion(request)\n      .then(function(response) {\n        // Get Auth credential from verify assert request and save it.\n        credential = fireauth.AuthProvider.getCredentialFromResponse(response);\n        // Get additional IdP data if available in the response.\n        additionalUserInfo = fireauth.AdditionalUserInfo.fromPlainObject(\n            response);\n        return response;\n      });\n  // When state is ready, run verify assertion request.\n  // This will only run either after initial and redirect state is ready for\n  // popups or after initial state is ready for redirect resolution.\n  var p = self.authStateLoaded_.then(function() {\n    return idTokenResolver;\n  }).then(function(idTokenResponse) {\n    // Use ID token response to sign in the Auth user.\n    return self.signInWithIdTokenResponse(idTokenResponse);\n  }).then(function() {\n    // On sign in success, construct redirect and popup result and return a\n    // readonly copy of it.\n    return fireauth.object.makeReadonlyCopy({\n      'user': self.currentUser_(),\n      'credential': credential,\n      'additionalUserInfo': additionalUserInfo,\n      // Sign in operation type.\n      'operationType': fireauth.constants.OperationType.SIGN_IN\n    });\n  });\n  return /** @type {!goog.Promise<!fireauth.AuthEventManager.Result>} */ (\n      this.registerPendingPromise_(p));\n};\n\n\n/**\n * @return {string} The generated event ID used to identify a popup event.\n * @private\n */\nfireauth.Auth.prototype.generateEventId_ = function() {\n  return fireauth.util.generateEventId();\n};\n\n\n/**\n * Signs in to Auth provider via popup.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.signInWithPopup = function(provider) {\n  // Check if popup and redirect are supported in this environment.\n  if (!fireauth.util.isPopupRedirectSupported()) {\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n  }\n  var mode = fireauth.AuthEvent.Type.SIGN_IN_VIA_POPUP;\n  var self = this;\n  // Popup the window immediately to make sure the browser associates the\n  // popup with the click that triggered it.\n\n  // Get provider settings.\n  var settings = fireauth.idp.getIdpSettings(provider['providerId']);\n  // There could multiple sign in with popup events in different windows.\n  // We need to match the correct popup to the correct pending promise.\n  var eventId = this.generateEventId_();\n  // If incapable of redirecting popup from opener, popup destination URL\n  // directly. This could also happen in a sandboxed iframe.\n  var oauthHelperWidgetUrl = null;\n  if ((!fireauth.util.runsInBackground() || fireauth.util.isIframe()) &&\n      this.app_().options['authDomain'] &&\n      provider['isOAuthProvider']) {\n    oauthHelperWidgetUrl =\n        fireauth.iframeclient.IfcHandler.getOAuthHelperWidgetUrl(\n            this.app_().options['authDomain'],\n            this.app_().options['apiKey'],\n            this.app_().name,\n            mode,\n            provider,\n            null,\n            eventId,\n            firebase.SDK_VERSION || null,\n            null,\n            null,\n            this.getTenantId());\n  }\n  // The popup must have a name, otherwise when successive popups are triggered\n  // they will all render in the same instance and none will succeed since the\n  // popup cancel of first window will close the shared popup window instance.\n  var popupWin =\n      fireauth.util.popup(\n          oauthHelperWidgetUrl,\n          fireauth.util.generateRandomString(),\n          settings && settings.popupWidth,\n          settings && settings.popupHeight);\n  // Auth event manager must be available for popup sign in to be possible.\n  var p = this.getAuthEventManager_().then(function(manager) {\n    // Process popup request tagging it with newly created event ID.\n    return manager.processPopup(\n        popupWin, mode, provider, eventId, !!oauthHelperWidgetUrl,\n        self.getTenantId());\n  }).then(function() {\n    return new goog.Promise(function(resolve, reject) {\n      // Expire other pending promises if still available..\n      self.resolvePendingPopupEvent(\n          mode,\n          null,\n          new fireauth.AuthError(fireauth.authenum.Error.EXPIRED_POPUP_REQUEST),\n          // Existing pending popup event ID.\n          self.popupEventId_);\n      // Save current pending promises.\n      self.pendingPopupResolvePromise_ = resolve;\n      self.pendingPopupRejectPromise_ = reject;\n      // Overwrite popup event ID with new one corresponding to popup.\n      self.popupEventId_ = eventId;\n      // Keep track of timeout promise to cancel it on promise resolution before\n      // it times out.\n      self.popupTimeoutPromise_ =\n          self.authEventManager_.startPopupTimeout(\n              self, mode, /** @type {!Window} */ (popupWin), eventId);\n    });\n  }).then(function(result) {\n    // On resolution, close popup if still opened and pass result through.\n    if (popupWin) {\n      fireauth.util.closeWindow(popupWin);\n    }\n    if (result) {\n      return fireauth.object.makeReadonlyCopy(result);\n    }\n    return null;\n  }).thenCatch(function(error) {\n    if (popupWin) {\n      fireauth.util.closeWindow(popupWin);\n    }\n    throw error;\n  });\n  return /** @type {!goog.Promise<!fireauth.AuthEventManager.Result>} */ (\n      this.registerPendingPromise_(p));\n};\n\n\n/**\n * Signs in to Auth provider via redirect.\n * @param {!fireauth.AuthProvider} provider The Auth provider to sign in with.\n * @return {!goog.Promise<void>}\n */\nfireauth.Auth.prototype.signInWithRedirect = function(provider) {\n  // Check if popup and redirect are supported in this environment.\n  if (!fireauth.util.isPopupRedirectSupported()) {\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n  }\n  var self = this;\n  var mode = fireauth.AuthEvent.Type.SIGN_IN_VIA_REDIRECT;\n  // Auth event manager must be available for sign in via redirect to be\n  // possible.\n  var p = this.getAuthEventManager_().then(function(manager) {\n    // Remember current persistence to apply it on the next page.\n    // This is the only time the state is passed to the next page (when user is\n    // not already logged in).\n    // This is not needed for link and reauthenticate as the user is already\n    // stored with specified persistence.\n    return self.userStorageManager_.savePersistenceForRedirect();\n  }).then(function() {\n    // Process redirect operation.\n    return self.authEventManager_.processRedirect(\n        mode, provider, undefined, self.getTenantId());\n  });\n  return /** @type {!goog.Promise<void>} */ (this.registerPendingPromise_(p));\n};\n\n\n/**\n * Returns the redirect result. If coming back from a successful redirect sign\n * in, will resolve to the signed in user. If coming back from an unsuccessful\n * redirect sign, will reject with the proper error. If no redirect operation\n * called, resolves with null.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n * @private\n */\nfireauth.Auth.prototype.getRedirectResultWithoutClearing_ = function() {\n  // Check if popup and redirect are supported in this environment.\n  if (!fireauth.util.isPopupRedirectSupported()) {\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.OPERATION_NOT_SUPPORTED));\n  }\n  var self = this;\n  // Auth event manager must be available for get redirect result to be\n  // possible.\n  var p = this.getAuthEventManager_().then(function(manager) {\n    // Return redirect result when resolved.\n    return self.authEventManager_.getRedirectResult();\n  }).then(function(result) {\n    if (result) {\n      return fireauth.object.makeReadonlyCopy(result);\n    }\n    return null;\n  });\n  return /** @type {!goog.Promise<!fireauth.AuthEventManager.Result>} */ (\n      this.registerPendingPromise_(p));\n};\n\n\n/**\n * In addition to returning the redirect result as in\n * `getRedirectResultWithoutClearing_`, this will also clear the cached\n * redirect result for security reasons.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.getRedirectResult = function() {\n  return this.getRedirectResultWithoutClearing_()\n        .then((result) => {\n          if (this.authEventManager_) {\n            this.authEventManager_.clearRedirectResult();\n          }\n          return result;\n        })\n        .thenCatch((error) => {\n          if (this.authEventManager_) {\n            this.authEventManager_.clearRedirectResult();\n          }\n          throw error;\n        });\n};\n\n\n/**\n * Asynchronously sets the provided user as currentUser on the current Auth\n * instance.\n * @param {?fireauth.AuthUser} user The user to be copied to Auth instance.\n * @return {!goog.Promise<void>}\n */\nfireauth.Auth.prototype.updateCurrentUser = function(user) {\n  if (!user) {\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.NULL_USER));\n  }\n  if (this.tenantId_ != user['tenantId']) {\n    return goog.Promise.reject(new fireauth.AuthError(\n        fireauth.authenum.Error.TENANT_ID_MISMATCH));\n  }\n  var self = this;\n  var options = {};\n  options['apiKey'] = this.app_().options['apiKey'];\n  options['authDomain'] = this.app_().options['authDomain'];\n  options['appName'] = this.app_().name;\n  var newUser = fireauth.AuthUser.copyUser(user, options,\n      self.redirectUserStorageManager_, self.getFramework());\n  return this.registerPendingPromise_(\n      this.redirectStateIsReady_.then(function() {\n        if (self.app_().options['apiKey'] != user.getApiKey()) {\n          // Throws auth/invalid-user-token if user doesn't belong to app.\n          // Throws auth/user-token-expired if token expires.\n          return newUser.reload();\n        }\n      }).then(function() {\n        if (self.currentUser_() && user['uid'] == self.currentUser_()['uid']) {\n          // Same user signed in. Update user data and notify Auth listeners.\n          // No need to resubscribe to user events.\n          // TODO: Check if the user to copy is older than current user and skip\n          // the copy logic in that case.\n          self.currentUser_().copy(user);\n          return self.handleUserStateChange_(user);\n        }\n        self.setCurrentUser_(newUser);\n        // Enable popup and redirect events.\n        newUser.enablePopupRedirect();\n        // Save user changes.\n        return self.handleUserStateChange_(newUser);\n      }).then(function(user) {\n        self.notifyAuthListeners_();\n      }));\n};\n\n\n/**\n * Completes the headless sign in with the server response containing the STS\n * access and refresh tokens, and sets the Auth user as current user while\n * setting all listeners to it and saving it to storage.\n * @param {!Object<string, string>} idTokenResponse The ID token response from\n *     the server.\n * @return {!goog.Promise<void>}\n */\nfireauth.Auth.prototype.signInWithIdTokenResponse =\n    function(idTokenResponse) {\n  var self = this;\n  var options = {};\n  options['apiKey'] = self.app_().options['apiKey'];\n  options['authDomain'] = self.app_().options['authDomain'];\n  options['appName'] = self.app_().name;\n  // Wait for state to be ready.\n  // This is used internally and is also used for redirect sign in so there is\n  // no need for waiting for redirect result to resolve since redirect result\n  // depends on it.\n  return this.authStateLoaded_.then(function() {\n    // Initialize an Auth user using the provided ID token response.\n    return fireauth.AuthUser.initializeFromIdTokenResponse(\n        options,\n        idTokenResponse,\n        /** @type {!fireauth.storage.RedirectUserManager} */ (\n            self.redirectUserStorageManager_),\n        // Pass frameworks so they are logged in getAccountInfo while populating\n        // the user info.\n        self.getFramework());\n  }).then(function(user) {\n    // Check if the same user is already signed in.\n    if (self.currentUser_() &&\n        user['uid'] == self.currentUser_()['uid']) {\n      // Same user signed in. Update user data and notify Auth listeners.\n      // No need to resubscribe to user events.\n      self.currentUser_().copy(user);\n      return self.handleUserStateChange_(user);\n    }\n    // New user.\n    // Set current user and attach all listeners to it.\n    self.setCurrentUser_(user);\n    // Enable popup and redirect events.\n    user.enablePopupRedirect();\n    // Save user changes.\n    return self.handleUserStateChange_(user);\n  }).then(function() {\n    // Notify external Auth listeners only when state is ready.\n    self.notifyAuthListeners_();\n  });\n};\n\n\n/**\n * Updates the current auth user and attaches event listeners to changes on it.\n * Also removes all event listeners from previously signed in user.\n * @param {?fireauth.AuthUser} user The current user instance.\n * @private\n */\nfireauth.Auth.prototype.setCurrentUser_ = function(user) {\n  // Must be called first before updating currentUser reference.\n  this.attachEventListeners_(user);\n  // Update currentUser property.\n  fireauth.object.setReadonlyProperty(this, 'currentUser', user);\n  if (user) {\n    // If a user is available, set the language code on it and set current Auth\n    // instance as language code change dispatcher.\n    this.setUserLanguage_(user);\n    // Set the current frameworks used on the user and set current Auth instance\n    // as the framework change dispatcher.\n    this.setUserFramework_(user);\n  }\n};\n\n\n/**\n * Signs out the current user while deleting the Auth user from storage and\n * removing all listeners from it.\n * @return {!goog.Promise<void>}\n */\nfireauth.Auth.prototype.signOut = function() {\n  var self = this;\n  // Wait for final state to be ready first, otherwise a signed out user could\n  // come back to life.\n  var p = this.redirectStateIsReady_.then(function() {\n    // Clear any cached redirect result on sign out, even if user is already\n    // signed out. For example, sign in could fail due to account conflict\n    // error, the error in redirect result should still be cleared. There is\n    // also the use case where you keep a reference to a signed out user and\n    // call signedOutUser.linkWithRedirect(provider). Even though the user is\n    // signed out, getRedirectResult() will resolve with the modified signed\n    // out user. This could also throw an error\n    // (provider already linked, etc).\n    if (self.authEventManager_) {\n      self.authEventManager_.clearRedirectResult();\n    }\n    // Ignore if already signed out.\n    if (!self.currentUser_()) {\n      return goog.Promise.resolve();\n    }\n    // Detach all event listeners.\n    // Set current user to null.\n    self.setCurrentUser_(null);\n    // Remove current user from storage\n    return /** @type {!fireauth.storage.UserManager} */ (\n        self.userStorageManager_).removeCurrentUser()\n        .then(function() {\n          // Notify external Auth listeners of this Auth change event.\n          self.notifyAuthListeners_();\n        });\n  });\n  return /** @type {!goog.Promise<void>} */ (this.registerPendingPromise_(p));\n};\n\n\n/**\n * @return {!goog.Promise} A promise that resolved when any stored redirect user\n *     is loaded and removed from session storage and then stored locally.\n * @private\n */\nfireauth.Auth.prototype.initRedirectUser_ = function() {\n  var self = this;\n  var authDomain = this.app_().options['authDomain'];\n  // Get any saved redirect user and delete from session storage.\n  // Override user's authDomain with app's authDomain if there is a mismatch.\n  var p = /** @type {!fireauth.storage.RedirectUserManager} */ (\n      this.redirectUserStorageManager_).getRedirectUser(authDomain)\n          .then(function(user) {\n            // Save redirect user.\n            self.redirectUser_ = user;\n            if (user) {\n              // Set redirect storage manager on user.\n              user.setRedirectStorageManager(\n                  /** @type {!fireauth.storage.RedirectUserManager} */ (\n                      self.redirectUserStorageManager_));\n            }\n            // Delete redirect user.\n            return /** @type {!fireauth.storage.RedirectUserManager} */ (\n                self.redirectUserStorageManager_).removeRedirectUser();\n          });\n  return /** @type {!goog.Promise<undefined>} */ (\n      this.registerPendingPromise_(p));\n};\n\n\n/**\n * Loads the initial Auth state for current application from web storage and\n * initializes Auth user accordingly to reflect that state. This routine does\n * not wait for any pending redirect result to be resolved.\n * @return {!goog.Promise<undefined>} Promise that resolves when state is ready,\n *     loaded from storage.\n * @private\n */\nfireauth.Auth.prototype.initAuthState_ = function() {\n  // Load current user from storage.\n  var self = this;\n  var authDomain = this.app_().options['authDomain'];\n  // Get any saved redirected user first.\n  var p = this.initRedirectUser_().then(function() {\n    // Override user's authDomain with app's authDomain if there is a mismatch.\n    return /** @type {!fireauth.storage.UserManager} */ (\n        self.userStorageManager_).getCurrentUser(authDomain);\n  }).then(function(user) {\n    // Logged in user.\n    if (user) {\n      // Set redirect storage manager on user.\n      user.setRedirectStorageManager(\n          /** @type {!fireauth.storage.RedirectUserManager} */ (\n              self.redirectUserStorageManager_));\n      // If the current user is undergoing a redirect operation, do not reload\n      // as that could could potentially delete the user if the token is\n      // expired. Instead any token problems will be detected via the\n      // verifyAssertion flow or the remaining flow. This is critical for\n      // reauthenticateWithRedirect as this flow is potentially used to recover\n      // from a token expiration error.\n      if (self.redirectUser_ &&\n          self.redirectUser_.getRedirectEventId() ==\n          user.getRedirectEventId()) {\n        return user;\n      }\n      // Confirm user valid first before setting listeners.\n      return user.reload().then(function() {\n        // Force user saving after reload as state change listeners not\n        // subscribed yet below via setCurrentUser_. Changes may have happened\n        // externally such as email actions or changes on another device.\n        return self.userStorageManager_.setCurrentUser(user).then(function() {\n          return user;\n        });\n      }).thenCatch(function(error) {\n        if (error['code'] == 'auth/network-request-failed') {\n          // Do not delete the user from storage if connection is lost or app is\n          // offline.\n          return user;\n        }\n        // Invalid user, could be deleted, remove from storage and resolve with\n        // null.\n        return /** @type {!fireauth.storage.UserManager} */(\n            self.userStorageManager_).removeCurrentUser();\n      });\n    }\n    // No logged in user, resolve with null;\n    return null;\n  }).then(function(user) {\n    // Even though state not ready yet pending any redirect result.\n    // Current user needs to be available for link with redirect to complete.\n    // This will also set listener on the user changes in case state changes\n    // occur they would get updated in storage too.\n    self.setCurrentUser_(user || null);\n  });\n  // In case the app is deleted before it is initialized with state from\n  // storage.\n  return /** @type {!goog.Promise<undefined>} */ (\n      this.registerPendingPromise_(p));\n};\n\n\n/**\n * After initial Auth state is loaded, waits for any pending redirect result,\n * resolves it and then adds the external Auth state change listeners and\n * triggers first state of all observers.\n * @return {!goog.Promise<undefined>} Promise that resolves when state is ready\n *     taking into account any pending redirect result.\n * @private\n */\nfireauth.Auth.prototype.initAuthRedirectState_ = function() {\n  var self = this;\n  // Wait first for state to be loaded from storage.\n  return this.authStateLoaded_.then(function() {\n    // Resolve any pending redirect result.\n    return self.getRedirectResultWithoutClearing_();\n  }).thenCatch(function(error) {\n    // Ignore any error in the process. Redirect could be not supported.\n    return;\n  }).then(function() {\n    // Make sure instance was not deleted before proceeding.\n    if (self.deleted_) {\n      return;\n    }\n    // Between init Auth state and get redirect result resolution there\n    // could have been a sign in attempt in another window.\n    // Force sync and then add listener to run sync on change below.\n    return self.getSyncAuthUserChanges_();\n  }).thenCatch(function(error) {\n    // Ignore any error in the process.\n    return;\n  }).then(function() {\n    // Now that final state is ready, make sure instance was not deleted before\n    // proceeding.\n    if (self.deleted_) {\n      return;\n    }\n    // Initial state has been resolved.\n    self.isStateResolved_ = true;\n    // Add user state change listener so changes are synchronized with\n    // other windows and tabs.\n    /** @type {!fireauth.storage.UserManager} */ (self.userStorageManager_\n        ).addCurrentUserChangeListener(self.getSyncAuthUserChanges_);\n  });\n};\n\n\n/**\n * Synchronizes current Auth to stored auth state, used when external state\n * changes occur.\n * @return {!goog.Promise<void>}\n * @private\n */\nfireauth.Auth.prototype.syncAuthUserChanges_ = function() {\n  // Get Auth user state from storage and compare to current state.\n  // Safe to run when no external change is detected.\n  var self = this;\n  var authDomain = this.app_().options['authDomain'];\n  // Override user's authDomain with app's authDomain if there is a mismatch.\n  return /** @type {!fireauth.storage.UserManager} */ (\n      this.userStorageManager_).getCurrentUser(authDomain)\n      .then(function(user) {\n        // In case this was deleted.\n        if (self.deleted_) {\n          return;\n        }\n        // Since the authDomain could be modified here, saving to storage here\n        // could trigger an infinite loop of changes between this tab and\n        // another tab using different Auth domain but since sync Auth user\n        // changes does not save changes to storage, except for getToken below\n        // if the token needs refreshing but will stop triggering the first time\n        // the token is refreshed on one of the first tab that refreshes it.\n        // The latter should not happen anyway since getToken should be valid\n        // at all times since anything that triggers the storage change should\n        // have communicated with the backend and that requires a valid token.\n        // In addition, authDomain difference is an edge case to begin with.\n\n        // If the same user is to be synchronized.\n        if (self.currentUser_() &&\n            user &&\n            self.currentUser_().hasSameUserIdAs(user)) {\n          // Data update, simply copy data changes.\n          self.currentUser_().copy(user);\n          // If tokens changed from previous user tokens, this will trigger\n          // notifyAuthListeners_.\n          return self.currentUser_().getIdToken();\n        } else if (!self.currentUser_() && !user) {\n          // No change, do nothing (was signed out and remained signed out).\n          return;\n        } else {\n          // Update current Auth state. Either a new login or logout.\n          self.setCurrentUser_(user);\n          // If a new user is signed in, enabled popup and redirect on that\n          // user.\n          if (user) {\n            user.enablePopupRedirect();\n            // Set redirect storage manager on user.\n            user.setRedirectStorageManager(\n                /** @type {!fireauth.storage.RedirectUserManager} */ (\n                    self.redirectUserStorageManager_));\n          }\n          if (self.authEventManager_) {\n            self.authEventManager_.subscribe(self);\n          }\n          // Notify external Auth changes of Auth change event.\n          self.notifyAuthListeners_();\n        }\n      });\n};\n\n\n/**\n * Updates the language code on the provided user and configures the user to\n * listen to the Auth instance for any language code changes.\n * @param {!fireauth.AuthUser} user The user to whose language needs to be set.\n * @private\n */\nfireauth.Auth.prototype.setUserLanguage_ = function(user) {\n  // Sets the current language code on the user.\n  user.setLanguageCode(this.getLanguageCode());\n  // Sets current Auth instance as language code change dispatcher on the user.\n  user.setLanguageCodeChangeDispatcher(this);\n};\n\n\n/**\n * Handles user state changes.\n * @param {!fireauth.AuthUser} user The user which triggered the state changes.\n * @return {!goog.Promise} The promise that resolves when state changes are\n *     handled.\n * @private\n */\nfireauth.Auth.prototype.handleUserStateChange_ = function(user) {\n  // Save Auth user state changes.\n  return /** @type {!fireauth.storage.UserManager} */ (\n      this.userStorageManager_).setCurrentUser(user);\n};\n\n\n/**\n * Handles user token changes.\n * @param {!Object} event The token change event.\n * @private\n */\nfireauth.Auth.prototype.handleUserTokenChange_ = function(event) {\n  // This is only called when user is ready and Auth state has been resolved.\n  // Notify external Auth change listeners.\n  this.notifyAuthListeners_();\n  // Save user token changes.\n  this.handleUserStateChange_(/** @type {!fireauth.AuthUser} */ (\n      this.currentUser_()));\n};\n\n\n/**\n * Handles user deletion events.\n * @param {!Object} event The user delete event.\n * @private\n */\nfireauth.Auth.prototype.handleUserDelete_ = function(event) {\n  // A deleted user will be treated like a sign out event.\n  this.signOut();\n};\n\n\n/**\n * Handles user invalidation events.\n * @param {!Object} event The user invalidation event.\n * @private\n */\nfireauth.Auth.prototype.handleUserInvalidated_ = function(event) {\n  // An invalidated user will be treated like a sign out event.\n  this.signOut();\n};\n\n\n/**\n * Detaches all previous listeners on current user and reattach new listeners to\n * provided user if not null.\n * @param {?fireauth.AuthUser} user The user to attach event listeners to.\n * @private\n */\nfireauth.Auth.prototype.attachEventListeners_ = function(user) {\n  // Remove existing event listeners from previous current user if available.\n  if (this.currentUser_()) {\n    this.currentUser_().removeStateChangeListener(\n        this.userStateChangeListener_);\n    goog.events.unlisten(\n        this.currentUser_(),\n        fireauth.UserEventType.TOKEN_CHANGED,\n        this.userTokenChangeListener_);\n    goog.events.unlisten(\n        this.currentUser_(),\n        fireauth.UserEventType.USER_DELETED,\n        this.userDeleteListener_);\n    goog.events.unlisten(\n        this.currentUser_(),\n        fireauth.UserEventType.USER_INVALIDATED,\n        this.userInvalidatedListener_);\n    // Stop proactive token refresh on the current user.\n    this.currentUser_().stopProactiveRefresh();\n  }\n  // If a new user is provided, attach event listeners to state, token, user\n  // invalidation and delete events.\n  if (user) {\n    user.addStateChangeListener(this.userStateChangeListener_);\n    goog.events.listen(\n        user,\n        fireauth.UserEventType.TOKEN_CHANGED,\n        this.userTokenChangeListener_);\n    goog.events.listen(\n        user,\n        fireauth.UserEventType.USER_DELETED,\n        this.userDeleteListener_);\n     goog.events.listen(\n        user,\n        fireauth.UserEventType.USER_INVALIDATED,\n        this.userInvalidatedListener_);\n    // Start proactive token refresh on new user if there is at least one\n    // Firebase service subscribed to Auth changes.\n    if (this.firebaseServices_ > 0) {\n      user.startProactiveRefresh();\n    }\n  }\n};\n\n\n/**\n * Signs in with ID token promise provider.\n * @param {!goog.Promise<!Object>} idTokenPromise\n *     The rpc handler method that returns a promise which resolves with an ID\n *     token.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n * @private\n */\nfireauth.Auth.prototype.signInWithIdTokenProvider_ = function(idTokenPromise) {\n  var self = this;\n  var credential = null;\n  var additionalUserInfo = null;\n  return /** @type {!goog.Promise<!fireauth.AuthEventManager.Result>} */ (\n      this.registerPendingPromise_(\n          idTokenPromise\n          .then(function(idTokenResponse) {\n            // Get credential if available in the response.\n            credential = fireauth.AuthProvider.getCredentialFromResponse(\n                idTokenResponse);\n            // Get additional IdP data if available in the response.\n            additionalUserInfo = fireauth.AdditionalUserInfo.fromPlainObject(\n                idTokenResponse);\n            // When custom token is exchanged for idToken, continue sign in with\n            // ID token and return firebase Auth user.\n            return self.signInWithIdTokenResponse(idTokenResponse);\n          })\n          .then(function() {\n            // Resolve promise with a readonly user credential object.\n            return fireauth.object.makeReadonlyCopy({\n              // Return the current user reference.\n              'user': self.currentUser_(),\n              // Return any credential passed from the backend.\n              'credential': credential,\n              // Return any additional IdP data passed from the backend.\n              'additionalUserInfo': additionalUserInfo,\n              // Sign in operation type.\n              'operationType': fireauth.constants.OperationType.SIGN_IN\n            });\n          })));\n};\n\n\n/**\n * Initializes the Auth state change observer returned by the\n * firebase.INTERNAL.createSubscribe helper.\n * @param {!firebase.Observer} observer The Auth state change observer.\n * @private\n */\nfireauth.Auth.prototype.initIdTokenChangeObserver_ = function(observer) {\n  var self = this;\n  // Adds a listener that will transmit the event everytime it's called.\n  this.addAuthTokenListener(function(accessToken) {\n    observer.next(self.currentUser_());\n  });\n};\n\n\n/**\n * Initializes the user state change observer returned by the\n * firebase.INTERNAL.createSubscribe helper.\n * @param {!firebase.Observer} observer The user state change observer.\n * @private\n */\nfireauth.Auth.prototype.initUserStateObserver_ = function(observer) {\n  var self = this;\n  // Adds a listener that will transmit the event everytime it's called.\n  this.addUserChangeListener_(function(accessToken) {\n    observer.next(self.currentUser_());\n  });\n};\n\n\n/**\n * Adds an observer for Auth state changes, we need to wrap the call as\n * the args checking code needs a method defined on the prototype this way,\n * not within the constructor, and we also have to implement the behavior\n * that will trigger an observer right away if state is ready.\n * @param {!firebase.Observer|function(?fireauth.AuthUser)}\n *     nextOrObserver An observer object or a function triggered on change.\n * @param {function(!fireauth.AuthError)=} opt_error Optional A function\n *     triggered on Auth error.\n * @param {function()=} opt_completed Optional A function triggered when the\n *     observer is removed.\n * @return {!function()} The unsubscribe function for the observer.\n */\nfireauth.Auth.prototype.onIdTokenChanged = function(\n    nextOrObserver, opt_error, opt_completed) {\n  var self = this;\n  // State already determined. Trigger immediately, otherwise initState will\n  // take care of notifying all pending listeners on initialization.\n  // In this case we do not trigger synchronously and trigger via a resolved\n  // promise as required by specs.\n  if (this.isStateResolved_) {\n    // The observer cannot be called synchronously. We're using the\n    // native Promise implementation as otherwise it creates weird behavior\n    // where the order of promises resolution would not be as expected.\n    // It is due to the fact fireauth and firebase.app use their own\n    // and different promises library and this leads to calls resolutions order\n    // being different from the promises registration order.\n    Promise.resolve().then(function() {\n      if (goog.isFunction(nextOrObserver)) {\n        nextOrObserver(self.currentUser_());\n      } else if (goog.isFunction(nextOrObserver['next'])) {\n        nextOrObserver['next'](self.currentUser_());\n      }\n    });\n  }\n  return this.onIdTokenChanged_(\n      /** @type {!firebase.Observer|function(*)|undefined} */ (nextOrObserver),\n      /** @type {function(!Error)|undefined} */ (opt_error),\n      opt_completed);\n};\n\n\n/**\n * Adds an observer for user state changes, we need to wrap the call as\n * the args checking code needs a method defined on the prototype this way,\n * not within the constructor, and we also have to implement the behavior\n * that will trigger an observer right away if state is ready.\n * @param {!firebase.Observer|function(?fireauth.AuthUser)}\n *     nextOrObserver An observer object or a function triggered on change.\n * @param {function(!fireauth.AuthError)=} opt_error Optional A function\n *     triggered on Auth error.\n * @param {function()=} opt_completed Optional A function triggered when the\n *     observer is removed.\n * @return {!function()} The unsubscribe function for the observer.\n */\nfireauth.Auth.prototype.onAuthStateChanged = function(\n    nextOrObserver, opt_error, opt_completed) {\n  var self = this;\n  // State already determined. Trigger immediately, otherwise initState will\n  // take care of notifying all pending listeners on initialization.\n  // In this case we do not trigger synchronously and trigger via a resolved\n  // promise as required by specs.\n  if (this.isStateResolved_) {\n    // The observer cannot be called synchronously. We're using the\n    // native Promise implementation as otherwise it creates weird behavior\n    // where the order of promises resolution would not be as expected.\n    // It is due to the fact fireauth and firebase.app use their own\n    // and different promises library and this leads to calls resolutions order\n    // being different from the promises registration order.\n    Promise.resolve().then(function() {\n      // This ensures that the first time notifyAuthListeners_ is triggered,\n      // it has the correct UID before triggering the user state change\n      // listeners.\n      self.userStateChangeUid_ = self.getUid();\n      if (goog.isFunction(nextOrObserver)) {\n        nextOrObserver(self.currentUser_());\n      } else if (goog.isFunction(nextOrObserver['next'])) {\n        nextOrObserver['next'](self.currentUser_());\n      }\n    });\n  }\n  return this.onUserStateChanged_(\n      /** @type {!firebase.Observer|function(*)|undefined} */ (nextOrObserver),\n      /** @type {function(!Error)|undefined} */ (opt_error),\n      opt_completed);\n};\n\n\n/**\n * Returns an STS token. If the cached one is unexpired it is directly returned.\n * Otherwise the existing ID token or refresh token is exchanged for a new one.\n * If there is no user signed in, returns null.\n *\n * This method is called getIdTokenInternal as the symbol getIdToken is not\n * obfuscated, which could lead to developers incorrectly calling\n * firebase.auth().getIdToken().\n *\n * @param {boolean=} opt_forceRefresh Whether to force refresh token exchange.\n * @return {!goog.Promise<?Object>}\n */\nfireauth.Auth.prototype.getIdTokenInternal = function(opt_forceRefresh) {\n  var self = this;\n  // Wait for state to be ready.\n  var p = this.redirectStateIsReady_.then(function() {\n    // Call user's underlying getIdToken method.\n    if (self.currentUser_()) {\n      return self.currentUser_().getIdToken(opt_forceRefresh)\n          .then(function(stsAccessToken) {\n            // This is used internally by other services which expect the access\n            // token to be returned in an object.\n            return {\n              'accessToken': stsAccessToken\n            };\n          });\n    }\n    // No logged in user, return null token.\n    return null;\n  });\n  return /** @type {!goog.Promise<?Object>} */ (\n      this.registerPendingPromise_(p));\n};\n\n\n/**\n * Signs in a user asynchronously using a custom token and returns any\n * additional user info data or credentials returned form the backend.\n * @param {string} token The custom token to sign in with.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.signInWithCustomToken = function(token) {\n  var self = this;\n  // Wait for the redirect state to be determined before proceeding. If critical\n  // errors like web storage unsupported are detected, fail before RPC, instead\n  // of after.\n  return this.redirectStateIsReady_.then(function() {\n    return self.signInWithIdTokenProvider_(\n        self.getRpcHandler().verifyCustomToken(token));\n  }).then(function(result) {\n    var user = result['user'];\n    // Manually sets the isAnonymous flag to false as the GetAccountInfo\n    // response will look like an anonymous user (no credentials visible).\n    user.updateProperty('isAnonymous', false);\n    // Save isAnonymous flag changes to current user in storage.\n    self.handleUserStateChange_(user);\n    return result;\n  });\n};\n\n\n/**\n * Sign in using an email and password and returns any additional user info\n * data or credentials returned form the backend.\n * @param {string} email The email to sign in with.\n * @param {string} password The password to sign in with.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.signInWithEmailAndPassword =\n    function(email, password) {\n  var self = this;\n  // Wait for the redirect state to be determined before proceeding. If critical\n  // errors like web storage unsupported are detected, fail before RPC, instead\n  // of after.\n  return this.redirectStateIsReady_.then(function() {\n    return self.signInWithIdTokenProvider_(\n        self.getRpcHandler().verifyPassword(email, password));\n  });\n};\n\n\n/**\n * Creates a new email and password account and returns any additional user\n * info data or credentials returned form the backend.\n * @param {string} email The email to sign up with.\n * @param {string} password The password to sign up with.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.createUserWithEmailAndPassword =\n    function(email, password) {\n  var self = this;\n  // Wait for the redirect state to be determined before proceeding. If critical\n  // errors like web storage unsupported are detected, fail before RPC, instead\n  // of after.\n  return this.redirectStateIsReady_.then(function() {\n    return self.signInWithIdTokenProvider_(\n        self.getRpcHandler().createAccount(email, password));\n  });\n};\n\n\n/**\n * Logs into Firebase with the given 3rd party credentials and returns any\n * additional user info data or credentials returned form the backend.\n * @param {!fireauth.AuthCredential} credential The Auth credential.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.signInWithCredential = function(credential) {\n  // Credential could be extended in the future, so leave it to credential to\n  // decide how to retrieve ID token.\n  var self = this;\n  // Wait for the redirect state to be determined before proceeding. If critical\n  // errors like web storage unsupported are detected, fail before RPC, instead\n  // of after.\n  return this.redirectStateIsReady_.then(function() {\n    // Return the full response object and not just the user.\n    return self.signInWithIdTokenProvider_(\n        credential.getIdTokenProvider(self.getRpcHandler()));\n  });\n};\n\n\n/**\n * Logs into Firebase with the given 3rd party credentials and returns any\n * additional user info data or credentials returned form the backend. It has\n * been deprecated in favor of signInWithCredential.\n * @param {!fireauth.AuthCredential} credential The Auth credential.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.signInAndRetrieveDataWithCredential =\n    function(credential) {\n  fireauth.deprecation.log(\n      fireauth.deprecation.Deprecations.SIGN_IN_WITH_CREDENTIAL);\n  return this.signInWithCredential(credential);\n};\n\n\n/**\n * Signs in a user anonymously and returns any additional user info data or\n * credentials returned form the backend.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.signInAnonymously = function() {\n  var self = this;\n  // Wait for the redirect state to be determined before proceeding. If critical\n  // errors like web storage unsupported are detected, fail before RPC, instead\n  // of after.\n  return this.redirectStateIsReady_.then(function() {\n    var user = self.currentUser_();\n    // If an anonymous user is already signed in, no need to sign him again.\n    if (user && user['isAnonymous']) {\n      var additionalUserInfo = fireauth.object.makeReadonlyCopy({\n        'providerId': null,\n        'isNewUser': false\n      });\n      return fireauth.object.makeReadonlyCopy({\n        // Return the signed in user reference.\n        'user': user,\n        // Do not return credential for anonymous user.\n        'credential': null,\n        // Return any additional IdP data.\n        'additionalUserInfo': additionalUserInfo,\n        // Sign in operation type.\n        'operationType': fireauth.constants.OperationType.SIGN_IN\n      });\n    } else {\n      // No anonymous user currently signed in.\n      return self.signInWithIdTokenProvider_(\n          self.getRpcHandler().signInAnonymously())\n          .then(function(result) {\n            var user = result['user'];\n            // Manually sets the isAnonymous flag to true as\n            // initializeFromIdTokenResponse uses the default value of false and\n            // even though getAccountInfo sets that to true, it will be reverted\n            // to false in reloadWithoutSaving.\n            // TODO: consider optimizing this and cleaning these manual\n            // overwrites.\n            user.updateProperty('isAnonymous', true);\n            // Save isAnonymous flag changes to current user in storage.\n            self.handleUserStateChange_(user);\n            return result;\n          });\n    }\n  });\n};\n\n\n/**\n * @return {string} The key used for storing Auth state.\n */\nfireauth.Auth.prototype.getStorageKey = function() {\n  return fireauth.util.createStorageKey(\n      this.app_().options['apiKey'],\n      this.app_().name);\n};\n\n\n/**\n * @return {!firebase.app.App} The Firebase App this auth object is connected\n *     to.\n * @private\n */\nfireauth.Auth.prototype.app_ = function() {\n  return this['app'];\n};\n\n\n/**\n * @return {!fireauth.RpcHandler} The RPC handler.\n */\nfireauth.Auth.prototype.getRpcHandler = function() {\n  return this.rpcHandler_;\n};\n\n\n/**\n * @return {?fireauth.AuthUser} The currently logged in user.\n * @private\n */\nfireauth.Auth.prototype.currentUser_ = function() {\n  return this['currentUser'];\n};\n\n\n/** @return {?string} The current user UID if available, null if not. */\nfireauth.Auth.prototype.getUid = function() {\n  return (this.currentUser_() && this.currentUser_()['uid']) || null;\n};\n\n\n/**\n * @return {?string} The last cached access token.\n * @private\n */\nfireauth.Auth.prototype.getLastAccessToken_ = function() {\n  return (this.currentUser_() && this.currentUser_()['_lat']) || null;\n};\n\n\n\n/**\n * Called internally on Auth state change to notify listeners.\n * @private\n */\nfireauth.Auth.prototype.notifyAuthListeners_ = function() {\n  // Only run when state is resolved. After state is resolved, the Auth listener\n  // will always trigger.\n  if (this.isStateResolved_) {\n    for (var i = 0; i < this.authListeners_.length; i++) {\n      if (this.authListeners_[i]) {\n        this.authListeners_[i](this.getLastAccessToken_());\n      }\n    }\n    // Trigger user change only if UID changed.\n    if (this.userStateChangeUid_ !== this.getUid() &&\n        this.userChangeListeners_.length) {\n      // Update user state change UID.\n      this.userStateChangeUid_ = this.getUid();\n      // Trigger all subscribed user state change listeners.\n      for (var i = 0; i < this.userChangeListeners_.length; i++) {\n        if (this.userChangeListeners_[i]) {\n          this.userChangeListeners_[i](this.getLastAccessToken_());\n        }\n      }\n    }\n  }\n};\n\n\n/**\n * Attaches a listener function to Auth state change.\n * This is used only by internal Firebase services.\n * @param {!function(?string)} listener The auth state change listener.\n */\nfireauth.Auth.prototype.addAuthTokenListenerInternal = function(listener) {\n  this.addAuthTokenListener(listener);\n  // This is not exact science but should be good enough to detect Firebase\n  // services subscribing to Auth token changes.\n  // This is needed to start proactive token refresh on a user.\n  this.firebaseServices_++;\n  if (this.firebaseServices_ > 0 && this.currentUser_()) {\n    // Start proactive token refresh on the current user.\n    this.currentUser_().startProactiveRefresh();\n  }\n};\n\n\n/**\n * Detaches the provided listener from Auth state change event.\n * This is used only by internal Firebase services.\n * @param {!function(?string)} listener The Auth state change listener.\n */\nfireauth.Auth.prototype.removeAuthTokenListenerInternal = function(listener) {\n  // This is unlikely to be called by Firebase services. Services are unlikely\n  // to remove Auth token listeners.\n  // Make sure listener is still subscribed before decrementing.\n  var self = this;\n  goog.array.forEach(this.authListeners_, function(ele) {\n    // This covers the case where the same listener is subscribed more than\n    // once.\n    if (ele == listener) {\n      self.firebaseServices_--;\n    }\n  });\n  if (this.firebaseServices_ < 0) {\n    this.firebaseServices_ = 0;\n  }\n  if (this.firebaseServices_ == 0 && this.currentUser_()) {\n    // Stop proactive token refresh on the current user.\n    this.currentUser_().stopProactiveRefresh();\n  }\n  this.removeAuthTokenListener(listener);\n};\n\n\n/**\n * Attaches a listener function to Auth state change.\n * @param {!function(?string)} listener The Auth state change listener.\n */\nfireauth.Auth.prototype.addAuthTokenListener = function(listener) {\n  var self = this;\n  // Save listener.\n  this.authListeners_.push(listener);\n  // Make sure redirect state is ready and then trigger listener.\n  this.registerPendingPromise_(this.redirectStateIsReady_.then(function() {\n    // Do nothing if deleted.\n    if (self.deleted_) {\n      return;\n    }\n    // Make sure listener is still subscribed.\n    if (goog.array.contains(self.authListeners_, listener)) {\n      // Trigger the first call for this now that redirect state is resolved.\n      listener(self.getLastAccessToken_());\n    }\n  }));\n};\n\n\n/**\n * Detaches the provided listener from Auth state change event.\n * @param {!function(?string)} listener The Auth state change listener.\n */\nfireauth.Auth.prototype.removeAuthTokenListener = function(listener) {\n  // Remove from Auth listeners.\n  goog.array.removeAllIf(this.authListeners_, function(ele) {\n    return ele == listener;\n  });\n};\n\n\n/**\n * Attaches a listener function to user state change.\n * @param {!function(?string)} listener The user state change listener.\n * @private\n */\nfireauth.Auth.prototype.addUserChangeListener_ = function(listener) {\n  var self = this;\n  // Save listener.\n  this.userChangeListeners_.push(listener);\n  // Make sure redirect state is ready and then trigger listener.\n  this.registerPendingPromise_(this.redirectStateIsReady_.then(function() {\n    // Do nothing if deleted.\n    if (self.deleted_) {\n      return;\n    }\n    // Make sure listener is still subscribed.\n    if (goog.array.contains(self.userChangeListeners_, listener)) {\n      // Confirm UID change before triggering.\n      if (self.userStateChangeUid_ !== self.getUid()) {\n        self.userStateChangeUid_ = self.getUid();\n        // Trigger the first call for this now that redirect state is resolved.\n        listener(self.getLastAccessToken_());\n      }\n    }\n  }));\n};\n\n\n/**\n * Deletes the Auth instance, handling cancellation of all pending async Auth\n * operations.\n * @return {!Promise<void>}\n */\nfireauth.Auth.prototype.delete = function() {\n  this.deleted_ = true;\n  // Cancel all pending promises.\n  for (var i = 0; i < this.pendingPromises_.length; i++) {\n    this.pendingPromises_[i].cancel(fireauth.authenum.Error.MODULE_DESTROYED);\n  }\n\n  // Empty pending promises array.\n  this.pendingPromises_ = [];\n  // Remove current user change listener.\n  if (this.userStorageManager_) {\n    this.userStorageManager_.removeCurrentUserChangeListener(\n        this.getSyncAuthUserChanges_);\n  }\n  // Unsubscribe from Auth event handling.\n  if (this.authEventManager_) {\n    this.authEventManager_.unsubscribe(this);\n    this.authEventManager_.clearRedirectResult();\n  }\n  return Promise.resolve();\n};\n\n\n/** @return {boolean} Whether Auth instance has pending promises. */\nfireauth.Auth.prototype.hasPendingPromises = function() {\n  return this.pendingPromises_.length != 0;\n};\n\n\n/**\n * Takes in a pending promise, saves it and adds a clean up callback which\n * forgets the pending promise after it is fulfilled and echoes the promise\n * back.\n * @param {!goog.Promise<*, *>|!goog.Promise<void>} p The pending promise.\n * @return {!goog.Promise<*, *>|!goog.Promise<void>}\n * @private\n */\nfireauth.Auth.prototype.registerPendingPromise_ = function(p) {\n  var self = this;\n  // Save created promise in pending list.\n  this.pendingPromises_.push(p);\n  p.thenAlways(function() {\n    // When fulfilled, remove from pending list.\n    goog.array.remove(self.pendingPromises_, p);\n  });\n  // Return the promise.\n  return p;\n};\n\n\n/**\n * Gets the list of possible sign in methods for the given email address.\n * @param {string} email The email address.\n * @return {!goog.Promise<!Array<string>>}\n */\nfireauth.Auth.prototype.fetchSignInMethodsForEmail = function(email) {\n  return /** @type {!goog.Promise<!Array<string>>} */ (\n      this.registerPendingPromise_(\n          this.getRpcHandler().fetchSignInMethodsForIdentifier(email)));\n};\n\n\n/**\n * @param {string} emailLink The email link.\n * @return {boolean} Whether the link is a sign in with email link.\n */\nfireauth.Auth.prototype.isSignInWithEmailLink = function(emailLink) {\n  return  !!fireauth.EmailAuthProvider\n      .getActionCodeUrlFromSignInEmailLink(emailLink);\n};\n\n\n/**\n * Sends the sign-in with email link for the email account provided.\n * @param {string} email The email account to sign in with.\n * @param {!Object} actionCodeSettings The action code settings object.\n * @return {!goog.Promise<void>}\n */\nfireauth.Auth.prototype.sendSignInLinkToEmail = function(\n    email, actionCodeSettings) {\n  var self = this;\n  return this.registerPendingPromise_(\n      // Wrap in promise as ActionCodeSettings constructor could throw a\n      // synchronous error if invalid arguments are specified.\n      goog.Promise.resolve()\n          .then(function() {\n            var actionCodeSettingsBuilder =\n                new fireauth.ActionCodeSettings(actionCodeSettings);\n            if (!actionCodeSettingsBuilder.canHandleCodeInApp()) {\n              throw new fireauth.AuthError(\n                  fireauth.authenum.Error.ARGUMENT_ERROR,\n                  fireauth.ActionCodeSettings.RawField.HANDLE_CODE_IN_APP +\n                  ' must be true when sending sign in link to email');\n            }\n            return actionCodeSettingsBuilder.buildRequest();\n          }).then(function(additionalRequestData) {\n            return self.getRpcHandler().sendSignInLinkToEmail(\n                email, additionalRequestData);\n          }).then(function(email) {\n            // Do not return the email.\n          }));\n};\n\n\n/**\n * Verifies an email action code for password reset and returns a promise\n * that resolves with the associated email if verified.\n * @param {string} code The email action code to verify for password reset.\n * @return {!goog.Promise<string>}\n */\nfireauth.Auth.prototype.verifyPasswordResetCode = function(code) {\n  return this.checkActionCode(code).then(function(info) {\n    return info['data']['email'];\n  });\n};\n\n\n/**\n * Requests resetPassword endpoint for password reset, verifies the action code\n * and updates the new password, returns an empty promise.\n * @param {string} code The email action code to confirm for password reset.\n * @param {string} newPassword The new password.\n * @return {!goog.Promise<undefined, !fireauth.AuthError>}\n */\nfireauth.Auth.prototype.confirmPasswordReset = function(code, newPassword) {\n  return this.registerPendingPromise_(\n      this.getRpcHandler().confirmPasswordReset(code, newPassword)\n      .then(function(email) {\n        // Do not return the email.\n      }));\n};\n\n\n/**\n * Verifies an email action code and returns an empty promise if verified.\n * @param {string} code The email action code to verify for password reset.\n * @return {!goog.Promise<!Object>}\n */\nfireauth.Auth.prototype.checkActionCode = function(code) {\n  return this.registerPendingPromise_(\n      this.getRpcHandler().checkActionCode(code)\n      .then(function(response) {\n        return new fireauth.ActionCodeInfo(response);\n      }));\n};\n\n\n/**\n * Applies an out-of-band email action code, such as an email verification code.\n * @param {string} code The email action code.\n * @return {!goog.Promise<void>}\n */\nfireauth.Auth.prototype.applyActionCode = function(code) {\n  return this.registerPendingPromise_(\n      this.getRpcHandler().applyActionCode(code)\n      .then(function(email) {\n        // Returns nothing.\n      }));\n};\n\n\n/**\n * Sends the password reset email for the email account provided.\n * @param {string} email The email account with the password to be reset.\n * @param {?Object=} opt_actionCodeSettings The optional action code settings\n *     object.\n * @return {!goog.Promise<void>}\n */\nfireauth.Auth.prototype.sendPasswordResetEmail =\n    function(email, opt_actionCodeSettings) {\n  var self = this;\n  return this.registerPendingPromise_(\n      // Wrap in promise as ActionCodeSettings constructor could throw a\n      // synchronous error if invalid arguments are specified.\n      goog.Promise.resolve().then(function() {\n        if (typeof opt_actionCodeSettings !== 'undefined' &&\n            // Ignore empty objects.\n            !goog.object.isEmpty(opt_actionCodeSettings)) {\n          return new fireauth.ActionCodeSettings(\n              /** @type {!Object} */ (opt_actionCodeSettings)).buildRequest();\n        }\n        return {};\n      })\n      .then(function(additionalRequestData) {\n        return self.getRpcHandler().sendPasswordResetEmail(\n            email, additionalRequestData);\n      }).then(function(email) {\n        // Do not return the email.\n      }));\n};\n\n\n/**\n * Signs in with a phone number using the app verifier instance and returns a\n * promise that resolves with the confirmation result which on confirmation\n * will resolve with the UserCredential object.\n * @param {string} phoneNumber The phone number to authenticate with.\n * @param {!firebase.auth.ApplicationVerifier} appVerifier The application\n *     verifier.\n * @return {!goog.Promise<!fireauth.ConfirmationResult>}\n */\nfireauth.Auth.prototype.signInWithPhoneNumber =\n    function(phoneNumber, appVerifier) {\n  return /** @type {!goog.Promise<!fireauth.ConfirmationResult>} */ (\n      this.registerPendingPromise_(fireauth.ConfirmationResult.initialize(\n          this,\n          phoneNumber,\n          appVerifier,\n          // This will wait for redirectStateIsReady to resolve first.\n          goog.bind(this.signInWithCredential, this))));\n};\n\n\n/**\n * Signs in a Firebase User with the provided email and the passwordless\n * sign-in email link.\n * @param {string} email The email account to sign in with.\n * @param {?string=} opt_link The optional link which contains the OTP needed\n *     to complete the sign in with email link. If not specified, the current\n *     URL is used instead.\n * @return {!goog.Promise<!fireauth.AuthEventManager.Result>}\n */\nfireauth.Auth.prototype.signInWithEmailLink = function(email, opt_link) {\n  return this.registerPendingPromise_(goog.Promise.resolve().then(() => {\n      const link = opt_link || fireauth.util.getCurrentUrl();\n      const credential = fireauth.EmailAuthProvider.credentialWithLink(\n          email, link);\n      // Check if the tenant ID in the email link matches the tenant ID on Auth\n      // instance.\n      const actionCodeUrl =\n          fireauth.EmailAuthProvider.getActionCodeUrlFromSignInEmailLink(link);\n      if (!actionCodeUrl) {\n        throw new fireauth.AuthError(\n            fireauth.authenum.Error.ARGUMENT_ERROR, 'Invalid email link!');\n      }\n      if (actionCodeUrl['tenantId'] !== this.getTenantId()) {\n        throw new fireauth.AuthError(\n            fireauth.authenum.Error.TENANT_ID_MISMATCH);\n      }\n      return this.signInWithCredential(credential);\n  }));\n};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n /**\n * @fileoverview Defines the grecaptcha interface.\n */\n\ngoog.provide('fireauth.grecaptcha');\n\n\n/**\n * The reCAPTCHA interface for initializing and managing visible v2\n * reCAPTCHAs as well as invisible ones.\n * @interface\n */\nfireauth.grecaptcha = function() {};\n\n\n/**\n * Creates a new instance of the recaptcha client.\n *\n * @param {!Element|string} elementOrId Element or element ID for the\n *     placeholder to render the reCAPTCHA client.\n * @param {!Object} params Parameters for the recaptcha client.\n * @return {number} The client ID.\n */\nfireauth.grecaptcha.prototype.render = function(elementOrId, params) {};\n\n\n/**\n * Resets a client with the given ID.  If an ID is not provided, resets the\n * default client.\n *\n * @param {number=} id The ID of the recaptcha client.\n * @param {?Object=} params Parameters for the recaptcha client.\n */\nfireauth.grecaptcha.prototype.reset = function(id, params) {};\n\n\n/**\n * Gets the response for the client with the given ID.  If an ID is not\n * provided, gets the response for the default client.\n *\n * @param {number=} id The ID of the recaptcha client.\n * @return {?string}\n */\nfireauth.grecaptcha.prototype.getResponse = function(id) {};\n\n\n/**\n * Programmatically triggers the invisible reCAPTCHA.\n *\n * @param {number=} opt_id The ID of the recaptcha client. Defaults to the\n *     first widget created if unspecified.\n */\nfireauth.grecaptcha.prototype.execute = function(opt_id) {};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n /**\n * @fileoverview Defines the mock grecaptcha utilities used for development\n * testing.\n */\ngoog.provide('fireauth.GRecaptchaMockFactory');\ngoog.provide('fireauth.RecaptchaMock');\n\ngoog.require('fireauth.grecaptcha');\ngoog.require('fireauth.util');\ngoog.require('goog.dom');\ngoog.require('goog.events');\ngoog.require('goog.events.EventType');\n\n\n/**\n * The mock grecaptcha factory.\n * @constructor\n * @implements {fireauth.grecaptcha}\n */\nfireauth.GRecaptchaMockFactory = function() {\n  /**\n   * @const @private {!Object<string, !fireauth.RecaptchaMock>} The hash map\n   *     that stores the widget ID to mock reCAPTCHA instances.\n   */\n  this.map_ = {};\n  /**\n   * @private {number} The current widget ID counter, incremented each time\n   *     a new mock reCAPTCHA is created.\n   */\n  this.counter_ = fireauth.GRecaptchaMockFactory.START_INSTANCE_ID;\n};\n\n\n/**\n * @const {number} The start ID of the first created mock reCAPTCHA.\n */\nfireauth.GRecaptchaMockFactory.START_INSTANCE_ID = 1000000000000;\n\n\n/** @const {number} The reCAPTCHA expiration time in milliseconds. */\nfireauth.GRecaptchaMockFactory.EXPIRATION_TIME_MS = 60000;\n\n\n/** @const {number} The reCAPTCHA auto solving time in milliseconds. */\nfireauth.GRecaptchaMockFactory.SOLVE_TIME_MS = 500;\n\n\n/**\n * @private {?fireauth.GRecaptchaMockFactory} The singleton instance\n *     for grecaptcha mock object.\n */\nfireauth.GRecaptchaMockFactory.instance_ = null;\n\n\n/**\n * @return {!fireauth.GRecaptchaMockFactory} The singleton grecaptcha mock\n *     instance.\n */\nfireauth.GRecaptchaMockFactory.getInstance = function() {\n  // Check if there is an existing instance. Otherwise, create one and cache it.\n  if (!fireauth.GRecaptchaMockFactory.instance_) {\n    fireauth.GRecaptchaMockFactory.instance_ =\n        new fireauth.GRecaptchaMockFactory();\n  }\n  return fireauth.GRecaptchaMockFactory.instance_;\n};\n\n\n/**\n * Creates a new instance of the mock reCAPTCHA widget.\n *\n * @param {(!Element|string)} elementOrId Element or element ID for the\n *     placeholder to render the reCAPTCHA client.\n * @param {!Object} params Parameters for the reCAPTCHA client.\n * @return {number} The client ID.\n * @override\n */\nfireauth.GRecaptchaMockFactory.prototype.render =\n    function(elementOrId, params) {\n  this.map_[this.counter_.toString()] =\n      new fireauth.RecaptchaMock(elementOrId, params);\n  return this.counter_++;\n};\n\n\n/**\n * Resets a reCAPTCHA with the given ID. If an ID is not provided, resets the\n * first instance.\n *\n * @param {number=} opt_id The id of the reCAPTCHA client. Defaults to the first\n *     widget created if unspecified.\n * @override\n */\nfireauth.GRecaptchaMockFactory.prototype.reset = function(opt_id) {\n  var mock = this.getMock_(opt_id);\n  var id = this.getId_(opt_id);\n  if (mock && id) {\n    mock.delete();\n    delete this.map_[/** @type {string} */ (id)];\n  }\n};\n\n\n/**\n * Gets the response for the client with the given ID. If an ID is not\n * provided, gets the response for the default client.\n *\n * @param {number=} opt_id The ID of the reCAPTCHA widget. Defaults to the first\n *     widget created if unspecified.\n * @return {?string}\n * @override\n */\nfireauth.GRecaptchaMockFactory.prototype.getResponse = function(opt_id) {\n  var mock = this.getMock_(opt_id);\n  return mock ? mock.getResponse() : null;\n};\n\n\n/**\n * Programmatically triggers the invisible reCAPTCHA.\n *\n * @param {number=} opt_id The ID of the recaptcha client. Defaults to the first\n *     widget created if unspecified.\n * @override\n */\nfireauth.GRecaptchaMockFactory.prototype.execute = function(opt_id) {\n  var mock = this.getMock_(opt_id);\n  if (mock) {\n    mock.execute();\n  }\n};\n\n\n/**\n * @param {number=} opt_id The optional ID to lookup.\n * @return {?fireauth.RecaptchaMock} The corresponding reCAPTCHA mock if found.\n * @private\n */\nfireauth.GRecaptchaMockFactory.prototype.getMock_ = function(opt_id) {\n  var id = this.getId_(opt_id);\n  return id ? this.map_[id] || null : null;\n};\n\n\n/**\n * @param {number=} opt_id The optional ID to lookup.\n * @return {?string} The corresponding reCAPTCHA mock ID if found.\n * @private\n */\nfireauth.GRecaptchaMockFactory.prototype.getId_ = function(opt_id) {\n  var id = typeof opt_id === 'undefined' ?\n      fireauth.GRecaptchaMockFactory.START_INSTANCE_ID : opt_id;\n  return id ? id.toString() : null;\n};\n\n\n/**\n * Mock single reCAPTCHA instance.\n * @param {(!Element|string)} elementOrId Element or element ID for the\n *     placeholder to render the reCAPTCHA client.\n * @param {!Object} params Parameters for the reCAPTCHA client.\n * @constructor\n */\nfireauth.RecaptchaMock = function(elementOrId, params) {\n  /** @private {boolean} Whether the instance was deleted. */\n  this.deleted_ = false;\n  /** @const @private {!Object} The reCAPTCHA parameters. */\n  this.params_ = params;\n  /** @private {?string} The simulated response token if available. */\n  this.responseToken_ = null;\n  /**\n   * @private {?number} The timer ID for response callback/expiration callback\n   *     to trigger.\n   */\n  this.timerId_ = null;\n  /** @const @private {boolean} Whether the reCAPTCHA is visible or not. */\n  this.isVisible_ = this.params_['size'] !== 'invisible';\n  /**\n   * @const @private {?Element} The container or button trigger of the\n   *     reCAPTCHA.\n   */\n  this.element_ = goog.dom.getElement(elementOrId);\n  var self = this;\n  /** @private {function(?)} The on click handler for invisible reCAPTCHAs. */\n  this.onClickHandler_ = function(event) {\n    self.execute();\n  };\n  if (this.isVisible_) {\n    // For a visible reCAPTCHA, simulate reCAPTCHA continuously solved\n    // and then expired.\n    this.execute();\n  } else {\n    // Trigger on button click on when execute is directly called.\n    goog.events.listen(\n        this.element_,\n        goog.events.EventType.CLICK,\n        this.onClickHandler_);\n  }\n};\n\n\n/** @return {?string} The current reCAPTCHA response. */\nfireauth.RecaptchaMock.prototype.getResponse = function() {\n  this.checkIfDeleted_();\n  return this.responseToken_;\n};\n\n\n/** Starts the reCAPTCHA mock solving/expiration cycle. */\nfireauth.RecaptchaMock.prototype.execute = function() {\n  this.checkIfDeleted_();\n  var self = this;\n  if (this.timerId_) {\n    return;\n  }\n  // Wait for expected delay before auto-solving.\n  this.timerId_ = setTimeout(function() {\n    // Generate random string as reCAPTCHA response token.\n    self.responseToken_ = fireauth.util.generateRandomAlphaNumericString(50);\n    // Trigger developer's callbacks.\n    var callback = self.params_['callback'];\n    var expirationCallback = self.params_['expired-callback'];\n    if (callback) {\n      try {\n        callback(self.responseToken_);\n      } catch (e) {}\n    }\n    // Wait for token to expire before triggering expiration callback and\n    // resetting token response.\n    self.timerId_ = setTimeout(function() {\n      self.timerId_ = null;\n      self.responseToken_ = null;\n      if (expirationCallback) {\n        try {\n          expirationCallback();\n        } catch (e) {}\n      }\n      if (self.isVisible_) {\n        self.execute();\n      }\n    }, fireauth.GRecaptchaMockFactory.EXPIRATION_TIME_MS);\n  }, fireauth.GRecaptchaMockFactory.SOLVE_TIME_MS);\n};\n\n\n/** Deletes the current mock instance. */\nfireauth.RecaptchaMock.prototype.delete = function() {\n  this.checkIfDeleted_();\n  this.deleted_ = true;\n  clearTimeout(this.timerId_);\n  this.timerId_ = null;\n  goog.events.unlisten(\n      this.element_,\n      goog.events.EventType.CLICK,\n      this.onClickHandler_);\n};\n\n\n/**\n * Checks whether the instance was deleted.\n * @private\n */\nfireauth.RecaptchaMock.prototype.checkIfDeleted_ = function() {\n  // This error should never be thrown externally.\n  // GRecaptchaMockFactory will ensure that a deleted instance is removed.\n  if (this.deleted_) {\n    throw new Error('reCAPTCHA mock was already deleted!');\n  }\n};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n /**\n * @fileoverview Defines the RecaptchaLoader implementation used to mock loading\n * of grecaptcha dependencies.\n */\n\ngoog.provide('fireauth.RecaptchaMockLoader');\n\ngoog.require('fireauth.GRecaptchaMockFactory');\ngoog.require('fireauth.RecaptchaLoader');\ngoog.require('goog.Promise');\n\n\n/**\n * Defines a mock reCAPTCHA loader by implementing the fireauth.RecaptchaLoader\n * interface.\n * @constructor\n * @implements {fireauth.RecaptchaLoader}\n */\nfireauth.RecaptchaMockLoader = function() {};\n\n\n/**\n * Loads the grecaptcha mock library if it is not loaded and returns a promise\n * that resolves on success. If the right conditions are available, will reload\n * the dependencies for a specified language code.\n * @param {?string} hl The reCAPTCHA language code.\n * @return {!goog.Promise<!fireauth.grecaptcha>} A promise that resolves when\n *     grecaptcha is loaded.\n * @override\n */\nfireauth.RecaptchaMockLoader.prototype.loadRecaptchaDeps =\n    function(hl) {\n  return goog.Promise.resolve(\n  \t/** @type {!fireauth.grecaptcha} */ (fireauth.GRecaptchaMockFactory.getInstance()));\n};\n\n\n/**\n * Decrements the reCAPTCHA instance counter.\n * @override\n */\nfireauth.RecaptchaMockLoader.prototype.clearSingleRecaptcha =\n    function() {};\n\n\n/**\n * @private {?fireauth.RecaptchaMockLoader} The singleton instance\n *     for the mock reCAPTCHA dependency loader.\n */\nfireauth.RecaptchaMockLoader.instance_ = null;\n\n\n/**\n * @return {!fireauth.RecaptchaMockLoader} The singleton mock reCAPTCHA\n *     dependency loader instance.\n */\nfireauth.RecaptchaMockLoader.getInstance = function() {\n  // Check if there is an existing instance. Otherwise create one and cache it.\n  if (!fireauth.RecaptchaMockLoader.instance_) {\n    fireauth.RecaptchaMockLoader.instance_ =\n        new fireauth.RecaptchaMockLoader();\n  }\n  return fireauth.RecaptchaMockLoader.instance_;\n};\n","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n /**\n * @fileoverview Defines the RecaptchaLoader implementation used to load all\n * the grecaptcha dependencies.\n */\n\ngoog.provide('fireauth.RecaptchaRealLoader');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.RecaptchaLoader');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.net.jsloader');\ngoog.require('goog.string.Const');\n\n\n/**\n * Utility to help load reCAPTCHA dependencies for specified languages.\n * @constructor\n * @implements {fireauth.RecaptchaLoader}\n */\nfireauth.RecaptchaRealLoader = function() {\n  /**\n   * @private {number} The reCAPTCHA instance counter. This is used to track the\n   *     number of reCAPTCHAs rendered on the page. This is needed to allow\n   *     localization of the reCAPTCHA. Localization is applied by loading the\n   *     grecaptcha SDK with the hl field provided. However, this will break\n   *     existing reCAPTCHAs. So we should only support i18n when there are no\n   *     other widgets rendered on this screen. If the developer is already\n   *     using reCAPTCHA in another context, we will disable localization so we\n   *     don't accidentally break existing reCAPTCHA widgets.\n   */\n  this.counter_ = goog.global['grecaptcha'] ? Infinity : 0;\n  /** @private {?string} The current reCAPTCHA language code. */\n  this.hl_ = null;\n  /** @const @private {string} The reCAPTCHA callback name. */\n  this.cbName_ = '__rcb' + Math.floor(Math.random() * 1000000).toString();\n};\n\n\n/** @private @const {!goog.string.Const} The reCAPTCHA javascript source URL. */\nfireauth.RecaptchaRealLoader.RECAPTCHA_SRC_ = goog.string.Const.from(\n    'https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit' +\n    '&hl=%{hl}');\n\n\n/**\n * The default timeout delay (units in milliseconds) for requests loading\n * the external reCAPTCHA dependencies.\n * @const {!fireauth.util.Delay}\n * @private\n */\nfireauth.RecaptchaRealLoader.DEFAULT_DEPENDENCY_TIMEOUT_ =\n    new fireauth.util.Delay(30000, 60000);\n\n\n/**\n * Loads the grecaptcha client library if it is not loaded and returns a promise\n * that resolves on success. If the right conditions are available, will reload\n * the dependencies for a specified language code.\n * @param {?string} hl The reCAPTCHA language code.\n * @return {!goog.Promise<!fireauth.grecaptcha>} A promise that resolves when\n *     grecaptcha is loaded.\n * @override\n */\nfireauth.RecaptchaRealLoader.prototype.loadRecaptchaDeps =\n    function(hl) {\n  var self = this;\n  return new goog.Promise(function(resolve, reject) {\n    var timer = setTimeout(\n        function() {\n          reject(new fireauth.AuthError(\n              fireauth.authenum.Error.NETWORK_REQUEST_FAILED));\n        },\n        fireauth.RecaptchaRealLoader.DEFAULT_DEPENDENCY_TIMEOUT_\n            .get()\n    );\n    // Load grecaptcha SDK if not already loaded or language changed since last\n    // load and no other rendered reCAPTCHA is visible,\n    if (!goog.global['grecaptcha'] || (hl !== self.hl_ && !self.counter_)) {\n      // reCAPTCHA saves the onload function and applies it on subsequent\n      // reloads. This means that the callback name has to remain the same.\n      goog.global[self.cbName_] = function() {\n        if (!goog.global['grecaptcha']) {\n          clearTimeout(timer);\n          // This should not happen.\n          reject(new fireauth.AuthError(\n              fireauth.authenum.Error.INTERNAL_ERROR));\n        } else {\n          // Update the current language code.\n          self.hl_ = hl;\n          var render = goog.global['grecaptcha']['render'];\n          // Wrap grecaptcha.render to keep track of rendered grecaptcha. This\n          // helps detect if the developer rendered a non\n          // firebase.auth.RecaptchaVerifier reCAPTCHA.\n          goog.global['grecaptcha']['render'] =\n              function(container, parameters) {\n            var widgetId = render(container, parameters);\n            // Increment only after render succeeds, in case an error is thrown\n            // during rendering.\n            self.counter_++;\n            return widgetId;\n          };\n          clearTimeout(timer);\n          resolve(goog.global['grecaptcha']);\n        }\n        delete goog.global[self.cbName_];\n      };\n      // Construct reCAPTCHA URL and on load, run the temporary function.\n      var url = goog.html.TrustedResourceUrl.format(\n          fireauth.RecaptchaRealLoader.RECAPTCHA_SRC_,\n          {'onload': self.cbName_, 'hl': hl || ''});\n      // TODO: eventually, replace all dependencies on goog.net.jsloader.\n      goog.Promise.resolve(goog.net.jsloader.safeLoad(url))\n          .thenCatch(function(error) {\n            clearTimeout(timer);\n            // In case library fails to load, typically due to a network error,\n            // reset cached loader to null to force a refresh on a retrial.\n            reject(new fireauth.AuthError(\n                fireauth.authenum.Error.INTERNAL_ERROR,\n                'Unable to load external reCAPTCHA dependencies!'));\n          });\n    } else {\n      clearTimeout(timer);\n      resolve(goog.global['grecaptcha']);\n    }\n  });\n};\n\n\n/**\n * Decrements the reCAPTCHA instance counter.\n * @override\n */\nfireauth.RecaptchaRealLoader.prototype.clearSingleRecaptcha =\n    function() {\n  this.counter_--;\n};\n\n\n/**\n * @private {?fireauth.RecaptchaRealLoader} The singleton instance\n *     for reCAPTCHA dependency loader.\n */\nfireauth.RecaptchaRealLoader.instance_ = null;\n\n\n/**\n * @return {!fireauth.RecaptchaRealLoader} The singleton reCAPTCHA\n *     dependency loader instance.\n */\nfireauth.RecaptchaRealLoader.getInstance = function() {\n  // Check if there is an existing instance. Otherwise create one and cache it.\n  if (!fireauth.RecaptchaRealLoader.instance_) {\n    fireauth.RecaptchaRealLoader.instance_ =\n        new fireauth.RecaptchaRealLoader();\n  }\n  return fireauth.RecaptchaRealLoader.instance_;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Defines the reCAPTCHA app verifier and its base class. The\n * former is currently used for web phone authentication whereas the latter is\n * used for the mobile app verification web fallback.\n */\ngoog.provide('fireauth.BaseRecaptchaVerifier');\ngoog.provide('fireauth.RecaptchaVerifier');\n\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.RecaptchaMockLoader');\ngoog.require('fireauth.RecaptchaRealLoader');\ngoog.require('fireauth.RpcHandler');\ngoog.require('fireauth.authenum.Error');\ngoog.require('fireauth.constants');\ngoog.require('fireauth.object');\ngoog.require('fireauth.util');\ngoog.require('goog.Promise');\ngoog.require('goog.array');\ngoog.require('goog.dom');\n\n\n/**\n * Creates the firebase base reCAPTCHA app verifier independent of Firebase\n * App or Auth instances.\n *\n * @param {string} apiKey The API key used to initialize the RPC handler for\n *     querying the Auth backend.\n * @param {!Element|string} container The reCAPTCHA container parameter. This\n *     has different meaning depending on whether the reCAPTCHA is hidden or\n *     visible.\n * @param {?Object=} opt_parameters The optional reCAPTCHA parameters.\n * @param {?(function():?string)=} opt_getLanguageCode The language code getter\n *     function.\n * @param {?string=} opt_clientVersion The optional client version to append to\n *     RPC header.\n * @param {?Object=} opt_rpcHandlerConfig The optional RPC handler\n *     configuration, typically passed when different Auth endpoints are to be\n *     used.\n * @param {boolean=} opt_isTestingMode Whether the reCAPTCHA is to be rendered\n *     in testing mode.\n * @constructor\n */\nfireauth.BaseRecaptchaVerifier = function(apiKey, container, opt_parameters,\n    opt_getLanguageCode, opt_clientVersion, opt_rpcHandlerConfig,\n    opt_isTestingMode) {\n  // Set the type readonly property needed for full implementation of the\n  // firebase.auth.ApplicationVerifier interface.\n  fireauth.object.setReadonlyProperty(this, 'type', 'recaptcha');\n  /**\n   * @private {?goog.Promise<void>} The cached reCAPTCHA ready response. This is\n   *     null until the first time it is triggered or when an error occurs in\n   *     getting ready.\n   */\n  this.cachedReadyPromise_ = null;\n  /** @private {?number} The reCAPTCHA widget ID. Null when not rendered. */\n  this.widgetId_ = null;\n  /** @private {boolean} Whether the instance is already destroyed. */\n  this.destroyed_ = false;\n  /** @private {!Element|string} The reCAPTCHA container. */\n  this.container_ = container;\n  /**\n   * @private {?fireauth.grecaptcha} The reCAPTCHA client library namespace.\n   */\n  this.grecaptcha_ = null;\n  /**\n   * @const @private {!fireauth.RecaptchaLoader} The grecaptcha loader.\n   */\n  this.recaptchaLoader_ = !!opt_isTestingMode ?\n      fireauth.RecaptchaMockLoader.getInstance() :\n      fireauth.RecaptchaRealLoader.getInstance();\n  // If no parameters passed, use default settings.\n  // Currently, visible recaptcha is the default setting as invisible reCAPTCHA\n  // is not yet supported by the backend.\n  /** @private {!Object} The reCAPTCHA parameters. */\n  this.parameters_ = opt_parameters || {\n    'theme': 'light',\n    'type': 'image'\n  };\n  /** @private {!Array<!goog.Promise<*>|!goog.Promise<void>>} List of\n   *      pending promises. */\n  this.pendingPromises_ = [];\n  if (this.parameters_[fireauth.BaseRecaptchaVerifier.ParamName.SITEKEY]) {\n    // sitekey should not be provided.\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR,\n        'sitekey should not be provided for reCAPTCHA as one is ' +\n        'automatically provisioned for the current project.');\n  }\n  /** @private {boolean} Whether the reCAPTCHA is invisible or not. */\n  this.isInvisible_ =\n      this.parameters_[fireauth.BaseRecaptchaVerifier.ParamName.SIZE] ===\n      'invisible';\n  // Check if DOM is supported.\n  if (!fireauth.util.isDOMSupported()) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.OPERATION_NOT_SUPPORTED,\n        'RecaptchaVerifier is only supported in a browser HTTP/HTTPS ' +\n        'environment with DOM support.');\n  }\n  // reCAPTCHA container must be valid and if visible, not empty.\n  // An invisible reCAPTCHA will not render in its container. That container\n  // will execute the reCAPTCHA when it is clicked.\n  if (!goog.dom.getElement(container) ||\n      (!this.isInvisible_ && goog.dom.getElement(container).hasChildNodes())) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR,\n        'reCAPTCHA container is either not found or already contains inner ' +\n        'elements!');\n  }\n  /**\n   * @private {!fireauth.RpcHandler} The RPC handler for querying the auth\n   *     backend.\n   */\n  this.rpcHandler_ = new fireauth.RpcHandler(\n      apiKey,\n      opt_rpcHandlerConfig || null,\n      opt_clientVersion || null);\n  /**\n   * @private {function():?string} Current language code getter.\n   */\n  this.getLanguageCode_ = opt_getLanguageCode || function() {return null;};\n  var self = this;\n  /**\n   * @private {!Array<function(?string)>} The token change listeners.\n   */\n  this.tokenListeners_ = [];\n  // Wrap token callback.\n  var existingCallback =\n      this.parameters_[fireauth.BaseRecaptchaVerifier.ParamName.CALLBACK];\n  this.parameters_[fireauth.BaseRecaptchaVerifier.ParamName.CALLBACK] =\n      function(response) {\n    // Dispatch internal event for the token response.\n    self.dispatchEvent_(response);\n    if (typeof existingCallback === 'function') {\n      existingCallback(response);\n    } else if (typeof existingCallback === 'string') {\n      // Check if the provided callback is a global function name.\n      var cb = fireauth.util.getObjectRef(existingCallback, goog.global);\n      if (typeof cb === 'function') {\n        // If so, trigger it.\n        cb(response);\n      }\n    }\n  };\n  // Wrap expired token callback.\n  var existingExpiredCallback = this.parameters_[\n    fireauth.BaseRecaptchaVerifier.ParamName.EXPIRED_CALLBACK];\n  this.parameters_[fireauth.BaseRecaptchaVerifier.ParamName.EXPIRED_CALLBACK] =\n      function() {\n    // Dispatch internal event for the token expiration.\n    self.dispatchEvent_(null);\n    if (typeof existingExpiredCallback === 'function') {\n      existingExpiredCallback();\n    } else if (typeof existingExpiredCallback === 'string') {\n      // Check if the provided expired callback is a global function name.\n      var cb = fireauth.util.getObjectRef(existingExpiredCallback, goog.global);\n      if (typeof cb === 'function') {\n        // If so, trigger it.\n        cb();\n      }\n    }\n  };\n};\n\n\n/**\n * grecaptcha parameter names.\n * @enum {string}\n */\nfireauth.BaseRecaptchaVerifier.ParamName = {\n  CALLBACK: 'callback',\n  EXPIRED_CALLBACK: 'expired-callback',\n  SITEKEY: 'sitekey',\n  SIZE: 'size'\n};\n\n\n/**\n * Dispatches the token change event to all subscribed listeners.\n * @param {?string} token The current detected token, null for none.\n * @private\n */\nfireauth.BaseRecaptchaVerifier.prototype.dispatchEvent_ = function(token) {\n  for (var i = 0; i < this.tokenListeners_.length; i++) {\n    try {\n      this.tokenListeners_[i](token);\n    } catch (e) {\n      // If any handler fails, ignore and run next handler.\n    }\n  }\n};\n\n\n/**\n * Add a reCAPTCHA token change listener.\n * @param {function(?string)} listener The token listener to add.\n * @private\n */\nfireauth.BaseRecaptchaVerifier.prototype.addTokenChangeListener_ =\n    function(listener) {\n  this.tokenListeners_.push(listener);\n};\n\n\n/**\n * Remove a reCAPTCHA token change listener.\n * @param {function(?string)} listener The token listener to remove.\n * @private\n */\nfireauth.BaseRecaptchaVerifier.prototype.removeTokenChangeListener_ =\n    function(listener) {\n  goog.array.removeAllIf(this.tokenListeners_, function(ele) {\n    return ele == listener;\n  });\n};\n\n\n/**\n * Takes in a pending promise, saves it and adds a clean up callback which\n * forgets the pending promise after it is fulfilled and echoes the promise\n * back.\n * @param {!goog.Promise<*, *>|!goog.Promise<void>} p The pending promise.\n * @return {!goog.Promise<*, *>|!goog.Promise<void>}\n * @private\n */\nfireauth.BaseRecaptchaVerifier.prototype.registerPendingPromise_ = function(p) {\n  var self = this;\n  // Save created promise in pending list.\n  this.pendingPromises_.push(p);\n  p.thenAlways(function() {\n    // When fulfilled, remove from pending list.\n    goog.array.remove(self.pendingPromises_, p);\n  });\n  // Return the promise.\n  return p;\n};\n\n\n/** @return {boolean} Whether verifier instance has pending promises. */\nfireauth.BaseRecaptchaVerifier.prototype.hasPendingPromises = function() {\n  return this.pendingPromises_.length != 0;\n};\n\n\n/**\n * Gets the current RecaptchaVerifier in a ready state for rendering by first\n * checking that the environment supports a reCAPTCHA, loading reCAPTCHA\n * dependencies if not already available and then getting the Firebase project's\n * provisioned reCAPTCHA configuration.\n * @return {!goog.Promise<void>} The promise that resolves when recaptcha\n *     is ready for rendering.\n * @private\n */\nfireauth.BaseRecaptchaVerifier.prototype.isReady_ = function() {\n  var self = this;\n  // If previously called, return the cached response.\n  if (this.cachedReadyPromise_) {\n    return this.cachedReadyPromise_;\n  }\n  this.cachedReadyPromise_ = this.registerPendingPromise_(goog.Promise.resolve()\n      .then(function() {\n        // Verify environment first.\n        // Fail quickly from a worker environment or non-HTTP/HTTPS environment.\n        if (fireauth.util.isHttpOrHttps() && !fireauth.util.isWorker()) {\n          // Wait for DOM to be ready as this feature depends on that.\n          return fireauth.util.onDomReady();\n        } else {\n          throw new fireauth.AuthError(\n              fireauth.authenum.Error.OPERATION_NOT_SUPPORTED,\n              'RecaptchaVerifier is only supported in a browser HTTP/HTTPS ' +\n              'environment.');\n        }\n      })\n      .then(function() {\n        // Load external reCAPTCHA dependencies if not already there, taking\n        // into account the current language code.\n        return self.recaptchaLoader_.loadRecaptchaDeps(self.getLanguageCode_());\n      })\n      .then(function(grecaptcha) {\n        self.grecaptcha_ = grecaptcha;\n        // Load Firebase project's reCAPTCHA configuration.\n        return self.rpcHandler_.getRecaptchaParam();\n      })\n      .then(function(result) {\n        // Update the reCAPTCHA parameters.\n        self.parameters_[fireauth.BaseRecaptchaVerifier.ParamName.SITEKEY] =\n            result[fireauth.RpcHandler.AuthServerField.RECAPTCHA_SITE_KEY];\n      }).thenCatch(function(error) {\n        // Anytime an error occurs, reset the cached ready promise to rerun on\n        // retrial.\n        self.cachedReadyPromise_ = null;\n        // Rethrow the error.\n        throw error;\n      }));\n  // Return the cached/pending ready promise.\n  return this.cachedReadyPromise_;\n};\n\n/**\n * Renders the reCAPTCHA and returns the allocated widget ID.\n * @return {!goog.Promise<number>} The promise that resolves with the reCAPTCHA\n *     widget ID when it is rendered.\n */\nfireauth.BaseRecaptchaVerifier.prototype.render = function() {\n  this.checkIfDestroyed_();\n  var self = this;\n  // Get reCAPTCHA ready.\n  return this.registerPendingPromise_(this.isReady_().then(function() {\n    if (self.widgetId_ === null) {\n      // For a visible reCAPTCHA, embed in a wrapper DIV container to allow\n      // re-rendering in the same developer provided container.\n      var container = self.container_;\n      if (!self.isInvisible_) {\n        // Get outer container (the developer provided container).\n        var outerContainer = goog.dom.getElement(container);\n        // Create wrapper temp DIV container.\n        container = goog.dom.createDom(goog.dom.TagName.DIV);\n        // Add temp DIV to outer container.\n        outerContainer.appendChild(container);\n      }\n      // If not initialized, initialize reCAPTCHA and return its widget ID.\n      self.widgetId_ = self.grecaptcha_.render(container, self.parameters_);\n    }\n    return self.widgetId_;\n  }));\n};\n\n\n/**\n * Gets the reCAPTCHA ready and waits for the reCAPTCHA token to be available\n * before resolving the promise returned.\n * @return {!goog.Promise<string>} The promise that resolves with the reCAPTCHA\n *     token when reCAPTCHA challenge is solved.\n */\nfireauth.BaseRecaptchaVerifier.prototype.verify = function() {\n  // Fail if reCAPTCHA is already destroyed.\n  this.checkIfDestroyed_();\n  var self = this;\n  // Render reCAPTCHA.\n  return this.registerPendingPromise_(this.render().then(function(widgetId) {\n    return new goog.Promise(function(resolve, reject) {\n      // Get current reCAPTCHA token.\n      var recaptchaToken = self.grecaptcha_.getResponse(widgetId);\n      if (recaptchaToken) {\n        // Unexpired token already available. Resolve pending promise with that\n        // token.\n        resolve(recaptchaToken);\n      } else {\n        // No token available. Listen to token change.\n        var cb = function(token) {\n          if (!token) {\n            // Ignore token expirations.\n            return;\n          }\n          // Remove temporary token change listener.\n          self.removeTokenChangeListener_(cb);\n          // Resolve with new token.\n          resolve(token);\n        };\n        // Add temporary token change listener.\n        self.addTokenChangeListener_(cb);\n        if (self.isInvisible_) {\n          // Execute invisible reCAPTCHA to force a challenge.\n          // This should do nothing if already triggered either by developer or\n          // by a button click.\n          self.grecaptcha_.execute(/** @type {number} */ (self.widgetId_));\n        }\n      }\n    });\n  }));\n};\n\n\n/**\n * Resets the reCAPTCHA widget.\n */\nfireauth.BaseRecaptchaVerifier.prototype.reset = function() {\n  this.checkIfDestroyed_();\n  if (this.widgetId_ !== null) {\n    this.grecaptcha_.reset(this.widgetId_);\n  }\n};\n\n\n/**\n * Throws an error if the reCAPTCHA verifier is already cleared.\n * @private\n */\nfireauth.BaseRecaptchaVerifier.prototype.checkIfDestroyed_ = function() {\n  if (this.destroyed_) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.INTERNAL_ERROR,\n        'RecaptchaVerifier instance has been destroyed.');\n  }\n};\n\n\n/**\n * Removes the reCAPTCHA from the DOM.\n */\nfireauth.BaseRecaptchaVerifier.prototype.clear = function() {\n  this.checkIfDestroyed_();\n  this.destroyed_ = true;\n  // Decrement reCAPTCHA instance counter.\n  this.recaptchaLoader_.clearSingleRecaptcha();\n  // Cancel all pending promises.\n  for (var i = 0; i < this.pendingPromises_.length; i++) {\n    this.pendingPromises_[i].cancel(\n        'RecaptchaVerifier instance has been destroyed.');\n  }\n  if (!this.isInvisible_) {\n    goog.dom.removeChildren(goog.dom.getElement(this.container_));\n  }\n};\n\n\n/**\n * Creates the Firebase reCAPTCHA app verifier, publicly available, for the\n * Firebase app provided, used for web phone authentication.\n * This is a subclass of fireauth.BaseRecaptchaVerifier.\n *\n * @param {!Element|string} container The reCAPTCHA container parameter. This\n *     has different meaning depending on whether the reCAPTCHA is hidden or\n *     visible.\n * @param {?Object=} opt_parameters The optional reCAPTCHA parameters.\n * @param {?firebase.app.App=} opt_app The corresponding Firebase app.\n * @constructor\n * @extends {fireauth.BaseRecaptchaVerifier}\n */\nfireauth.RecaptchaVerifier = function(container, opt_parameters, opt_app) {\n  var isTestingMode = false;\n  var apiKey;\n  try {\n    /** @private {!firebase.app.App} The corresponding Firebase app instance. */\n    this.app_ = opt_app || firebase.app();\n  } catch (error) {\n    throw new fireauth.AuthError(\n        fireauth.authenum.Error.ARGUMENT_ERROR,\n        'No firebase.app.App instance is currently initialized.');\n  }\n  // API key is required for web client RPC calls.\n  if (this.app_.options && this.app_.options['apiKey']) {\n    apiKey = this.app_.options['apiKey'];\n  } else {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INVALID_API_KEY);\n  }\n  var self = this;\n  // Construct the language code getter based on the underlying Auth instance.\n  var getLanguageCode = function() {\n    var languageCode;\n    // Get the latest language setting.\n    // reCAPTCHA does not support updating the language of an already\n    // rendered reCAPTCHA. Reloading the SDK with the new hl will break\n    // the existing rendered localized reCAPTCHA. We will need to\n    // document that a new fireauth.BaseRecaptchaVerifier instance needs\n    // to be instantiated after the language is updated. Otherwise, the\n    // old language code will remain active on the existing instance.\n    try {\n      languageCode = self.app_['auth']().getLanguageCode();\n    } catch (e) {\n      languageCode = null;\n    }\n    return languageCode;\n  };\n  // Get the framework version from Auth instance.\n  var frameworkVersion = null;\n  try {\n    frameworkVersion = this.app_['auth']().getFramework();\n  } catch (e) {\n    // Do nothing.\n  }\n  try {\n    isTestingMode =\n        this.app_['auth']()['settings']['appVerificationDisabledForTesting'];\n  } catch (e) {\n    // Do nothing.\n  }\n  // Get the client version based on the Firebase JS version.\n  var clientFullVersion = firebase.SDK_VERSION ?\n      fireauth.util.getClientVersion(\n          fireauth.util.ClientImplementation.JSCORE, firebase.SDK_VERSION,\n          frameworkVersion) :\n      null;\n  // Call the superclass constructor with the computed API key, reCAPTCHA\n  // container, optional parameters, language code getter, Firebase JS client\n  // version and the current client configuration endpoints.\n  fireauth.RecaptchaVerifier.base(this, 'constructor', apiKey,\n      container, opt_parameters, getLanguageCode, clientFullVersion,\n      fireauth.constants.getEndpointConfig(fireauth.constants.clientEndpoint),\n      isTestingMode);\n};\ngoog.inherits(fireauth.RecaptchaVerifier, fireauth.BaseRecaptchaVerifier);\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Provides function argument validation for third-party calls\n * that cannot be validated with Closure compiler.\n */\n\ngoog.provide('fireauth.args');\ngoog.provide('fireauth.args.Argument');\n\ngoog.require('fireauth.Auth');\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.AuthUser');\ngoog.require('fireauth.authenum.Error');\n\n\n/**\n * Represents an argument to a function. Fields:\n * <ul>\n * <li> name: A label for the argument. For example, the names of the arguments\n *      to a signIn() function might be \"email\" and \"password\".\n * <li> typeLabel: A label for the expected type of the argument, starting with\n *      an article, for example, \"an object\" or \"a valid credential\".\n * <li> optional: Whether or not this argument is optional. Optional arguments\n *      cannot come after non-optional arguments in the input to validate().\n * <li> validator: A function that takes the passed value of this argument\n *      and returns whether the value is valid or not.\n * </ul>\n * @typedef {{\n *   name: string,\n *   typeLabel: string,\n *   optional: boolean,\n *   validator: function (*) : boolean,\n * }}\n */\nfireauth.args.Argument;\n\n\n/**\n * Validates the arguments to a method call and throws an error if invalid. This\n * can be used to validate external calls where the Closure compiler cannot\n * detect errors.\n *\n * Example usage:\n * function greet(recipient, opt_useFormalLanguage) {\n *   fireauth.args.validate('greet', [\n *     fireauth.args.string('recipient'),\n *     fireauth.args.bool('opt_useFormalLanguage', true)\n *   ], arguments);\n *   if (opt_useFormalLanguage) {\n *     console.log('Good day, ' + recipient + '.');\n *   } else {\n *     console.log('Wassup, ' + recipient + '?');\n *   }\n * }\n * greet('Mr. Manager', true); // Prints 'Good day, Mr. Manager.'\n * greet('Billy Bob'); // Prints 'Wassup, Billy Bob?'\n * greet(133); // Throws 'greet failed: First argument \"recipient\" must be a\n *             // valid string.'\n * greet(); // Throws 'greet failed: Expected 1-2 arguments but got 0.'\n * greet('Mr. Manager', true, 'ohno'); // Throws 'greet failed: Expected 1-2\n *                                     // arguments but got 3.'\n *\n * This can also be used to validate setters by passing an additional true\n * argument to fireauth.args.validate. This modifies the error message to be\n * relevant for that setter.\n *\n * @param {string} apiName The name of the method being called, to display in\n *     the error message for debugging purposes.\n * @param {!Array<!fireauth.args.Argument>} expected The expected arguments.\n * @param {!IArrayLike} actual The arguments object of the function whose\n *     parameters we want to validate.\n * @param {boolean=} opt_isSetter Whether the function is a setter which takes\n *     a single argument.\n */\nfireauth.args.validate = function(apiName, expected, actual, opt_isSetter) {\n  // Convert the arguments object into a real array.\n  var actualAsArray = Array.prototype.slice.call(actual);\n  var errorMessage = fireauth.args.validateAndGetMessage_(\n      expected, actualAsArray, opt_isSetter);\n  if (errorMessage) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.ARGUMENT_ERROR,\n        apiName + ' failed: ' + errorMessage);\n  }\n};\n\n\n/**\n * @param {!Array<!fireauth.args.Argument>} expected\n * @param {!Array<*>} actual\n * @param {boolean=} opt_isSetter Whether the function is a setter which takes\n *     a single argument.\n * @return {?string} The error message if there is an error, or otherwise\n *     null.\n * @private\n */\nfireauth.args.validateAndGetMessage_ =\n    function(expected, actual, opt_isSetter) {\n  var minNumArgs = fireauth.args.calcNumRequiredArgs_(expected);\n  var maxNumArgs = expected.length;\n  if (actual.length < minNumArgs || maxNumArgs < actual.length) {\n    return fireauth.args.makeLengthError_(minNumArgs, maxNumArgs,\n        actual.length);\n  }\n\n  for (var i = 0; i < actual.length; i++) {\n    // Argument is optional and undefined is explicitly passed.\n    var optionalUndefined = expected[i].optional && actual[i] === undefined;\n    // Check if invalid argument and the argument is not optional with undefined\n    // passed.\n    if (!expected[i].validator(actual[i]) && !optionalUndefined) {\n      return fireauth.args.makeErrorAtPosition_(i, expected[i], opt_isSetter);\n    }\n  }\n\n  return null;\n};\n\n\n/**\n * @param {!Array<!fireauth.args.Argument>} expected\n * @return {number} The number of required arguments.\n * @private\n */\nfireauth.args.calcNumRequiredArgs_ = function(expected) {\n  var numRequiredArgs = 0;\n  var isOptionalSection = false;\n  for (var i = 0; i < expected.length; i++) {\n    if (expected[i].optional) {\n      isOptionalSection = true;\n    } else {\n      if (isOptionalSection) {\n        throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR,\n            'Argument validator encountered a required argument after an ' +\n            'optional argument.');\n      }\n      numRequiredArgs++;\n    }\n  }\n  return numRequiredArgs;\n};\n\n\n/**\n * @param {number} min The minimum number of arguments to the function,\n *     inclusive.\n * @param {number} max The maximum number of arguments to the function,\n *     inclusive.\n * @param {number} actual The actual number of arguments received.\n * @return {string} The error message.\n * @private\n */\nfireauth.args.makeLengthError_ = function(min, max, actual) {\n  var numExpectedString;\n  if (min == max) {\n    if (min == 1) {\n      numExpectedString = '1 argument';\n    } else {\n      numExpectedString = min + ' arguments';\n    }\n  } else {\n    numExpectedString = min + '-' + max + ' arguments';\n  }\n  return 'Expected ' + numExpectedString + ' but got ' + actual + '.';\n};\n\n\n/**\n * @param {number} position The position at which there was an error.\n * @param {!fireauth.args.Argument} expectedType The expected type of the\n *     argument, which was violated.\n * @param {boolean=} opt_isSetter Whether the function is a setter which takes\n *     a single argument.\n * @return {string} The error message.\n * @private\n */\nfireauth.args.makeErrorAtPosition_ =\n    function(position, expectedType, opt_isSetter) {\n  var ordinal = fireauth.args.makeOrdinal_(position);\n  var argName = expectedType.name ?\n      fireauth.args.quoteString_(expectedType.name) + ' ' : '';\n  // Add support to setters for readable/writable properties which take a\n  // required single argument.\n  var errorPrefix = !!opt_isSetter ? '' : ordinal + ' argument ';\n  return errorPrefix + argName + 'must be ' +\n      expectedType.typeLabel + '.';\n};\n\n\n/** @private {!Array<string>} The first few ordinal numbers. */\nfireauth.args.ORDINAL_NUMBERS_ = ['First', 'Second', 'Third', 'Fourth',\n  'Fifth', 'Sixth', 'Seventh', 'Eighth', 'Ninth'];\n\n\n/**\n * @param {number} cardinal An integer.\n * @return {string} The integer converted to an ordinal number, starting at\n *     \"First\". That is, makeOrdinal_(0) returns \"First\" and makeOrdinal_(1)\n *     returns \"Second\", etc.\n * @private\n */\nfireauth.args.makeOrdinal_ = function(cardinal) {\n  // We only support the first few ordinal numbers. We could provide a more\n  // robust solution, but it is unlikely that a function would need more than\n  // nine arguments.\n  if (cardinal < 0 || cardinal >= fireauth.args.ORDINAL_NUMBERS_.length) {\n    throw new fireauth.AuthError(fireauth.authenum.Error.INTERNAL_ERROR,\n        'Argument validator received an unsupported number of arguments.');\n  }\n  return fireauth.args.ORDINAL_NUMBERS_[cardinal];\n};\n\n\n/**\n * Specifies a string argument.\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.string = function(opt_name, opt_optional) {\n  return {\n    name: opt_name || '',\n    typeLabel: 'a valid string',\n    optional: !!opt_optional,\n    validator: goog.isString\n  };\n};\n\n\n/**\n * Specifies a boolean argument.\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.bool = function(opt_name, opt_optional) {\n  return {\n    name: opt_name || '',\n    typeLabel: 'a boolean',\n    optional: !!opt_optional,\n    validator: goog.isBoolean\n  };\n};\n\n\n/**\n * Specifies a number argument.\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.number = function(opt_name, opt_optional) {\n  return {\n    name: opt_name || '',\n    typeLabel: 'a valid number',\n    optional: !!opt_optional,\n    validator: goog.isNumber\n  };\n};\n\n\n/**\n * Specifies an object argument.\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.object = function(opt_name, opt_optional) {\n  return {\n    name: opt_name || '',\n    typeLabel: 'a valid object',\n    optional: !!opt_optional,\n    validator: goog.isObject\n  };\n};\n\n\n/**\n * Specifies a function argument.\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.func = function(opt_name, opt_optional) {\n  return {\n    name: opt_name || '',\n    typeLabel: 'a function',\n    optional: !!opt_optional,\n    validator: goog.isFunction\n  };\n};\n\n\n/**\n * Specifies a null argument.\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.null = function(opt_name, opt_optional) {\n  return {\n    name: opt_name || '',\n    typeLabel: 'null',\n    optional: !!opt_optional,\n    validator: goog.isNull\n  };\n};\n\n\n/**\n * Specifies an HTML element argument.\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.element = function(opt_name, opt_optional) {\n   return /** @type {!fireauth.args.Argument} */ ({\n    name: opt_name || '',\n    typeLabel: 'an HTML element',\n    optional: !!opt_optional,\n    validator: /** @type {function(!Element) : boolean} */ (\n        function(element) {\n          return !!(element && element instanceof Element);\n        })\n  });\n};\n\n\n/**\n * Specifies an instance of Firebase Auth.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.firebaseAuth = function(opt_optional) {\n  return /** @type {!fireauth.args.Argument} */ ({\n    name: 'auth',\n    typeLabel: 'an instance of Firebase Auth',\n    optional: !!opt_optional,\n    validator: /** @type {function(!fireauth.Auth) : boolean} */ (\n        function(auth) {\n          return !!(auth && auth instanceof fireauth.Auth);\n        })\n  });\n};\n\n\n/**\n * Specifies an instance of Firebase User.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.firebaseUser = function(opt_optional) {\n  return /** @type {!fireauth.args.Argument} */ ({\n    name: 'user',\n    typeLabel: 'an instance of Firebase User',\n    optional: !!opt_optional,\n    validator: /** @type {function(!fireauth.AuthUser) : boolean} */ (\n        function(user) {\n          return !!(user && user instanceof fireauth.AuthUser);\n        })\n  });\n};\n\n\n/**\n * Specifies an instance of Firebase App.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.firebaseApp = function(opt_optional) {\n  return /** @type {!fireauth.args.Argument} */ ({\n    name: 'app',\n    typeLabel: 'an instance of Firebase App',\n    optional: !!opt_optional,\n    validator: /** @type {function(!firebase.app.App) : boolean} */ (\n        function(app) {\n          return !!(app && app instanceof firebase.app.App);\n        })\n  });\n};\n\n\n/**\n * Specifies an argument that implements the fireauth.AuthCredential interface.\n * @param {?fireauth.idp.ProviderId=} opt_requiredProviderId The required type\n *     of provider.\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.authCredential =\n    function(opt_requiredProviderId, opt_name, opt_optional) {\n  var name = opt_name ||\n      (opt_requiredProviderId ?\n       opt_requiredProviderId + 'Credential' :\n       'credential');\n  var typeLabel = opt_requiredProviderId ?\n      'a valid ' + opt_requiredProviderId + ' credential' :\n      'a valid credential';\n  return /** @type {!fireauth.args.Argument} */ ({\n    name: name,\n    typeLabel: typeLabel,\n    optional: !!opt_optional,\n    validator: /** @type {function(!fireauth.AuthCredential) : boolean} */ (\n        function(credential) {\n          if (!credential) {\n            return false;\n          }\n          // If opt_requiredProviderId is set, make sure it matches the\n          // credential's providerId.\n          var matchesRequiredProvider = !opt_requiredProviderId ||\n              (credential['providerId'] === opt_requiredProviderId);\n          return !!(credential.getIdTokenProvider && matchesRequiredProvider);\n        })\n  });\n};\n\n\n/**\n * Specifies an argument that implements the fireauth.AuthProvider interface.\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.authProvider = function(opt_name, opt_optional) {\n  return /** @type {!fireauth.args.Argument} */ ({\n    name: opt_name || 'authProvider',\n    typeLabel: 'a valid Auth provider',\n    optional: !!opt_optional,\n    validator: /** @type {function(!fireauth.AuthProvider) : boolean} */ (\n        function(provider) {\n          return !!(provider &&\n                    provider['providerId'] &&\n                    provider.hasOwnProperty &&\n                    provider.hasOwnProperty('isOAuthProvider'));\n        })\n  });\n};\n\n\n/**\n * Specifies an argument that implements the firebase.auth.ApplicationVerifier\n * interface.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.applicationVerifier = function(opt_optional) {\n  return /** @type {!fireauth.args.Argument} */ ({\n    name: 'applicationVerifier',\n    typeLabel: 'an implementation of firebase.auth.ApplicationVerifier',\n    optional: !!opt_optional,\n    validator:\n        /** @type {function(!firebase.auth.ApplicationVerifier) : boolean} */ (\n        function(applicationVerifier) {\n          return !!(applicationVerifier &&\n                    goog.isString(applicationVerifier.type) &&\n                    goog.isFunction(applicationVerifier.verify));\n        })\n  });\n};\n\n\n/**\n * Specifies an argument that can be either of two argument types.\n * @param {!fireauth.args.Argument} optionA\n * @param {!fireauth.args.Argument} optionB\n * @param {?string=} opt_name The name of the argument.\n * @param {?boolean=} opt_optional Whether or not this argument is optional.\n *     Defaults to false.\n * @return {!fireauth.args.Argument}\n */\nfireauth.args.or = function(optionA, optionB, opt_name, opt_optional) {\n  return {\n    name: opt_name || '',\n    typeLabel: optionA.typeLabel + ' or ' + optionB.typeLabel,\n    optional: !!opt_optional,\n    validator: function(value) {\n      return optionA.validator(value) || optionB.validator(value);\n    }\n  };\n};\n\n\n/**\n * @param {string} str\n * @return {string} The string surrounded with quotes.\n * @private\n */\nfireauth.args.quoteString_ = function(str) {\n  return '\"' + str + '\"';\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Provides utilities for exporting public APIs, with error\n *     checking.\n */\n\ngoog.provide('fireauth.exportlib');\ngoog.provide('fireauth.exportlib.ExportedMethod');\n\ngoog.require('fireauth.args');\n\n\n/**\n * Type constant for Firebase Auth.\n * @const {string}\n */\nfireauth.exportlib.AUTH_TYPE = 'auth';\n\n\n/**\n * Represents an exported method, with the exported name of the method and the\n * expected arguments to that method.\n * @typedef {{\n *   name: string,\n *   args: (Array<!fireauth.args.Argument>|null|undefined)\n * }}\n */\nfireauth.exportlib.ExportedMethod;\n\n\n/**\n * Represents an exported property, with the exported name of the property and\n * the expected argument to the setter of this property.\n * @typedef {{\n *   name: string,\n *   arg: !fireauth.args.Argument\n * }}\n */\nfireauth.exportlib.ExportedProperty;\n\n\n/**\n * Exports prototype methods of an object.\n * @param {!Object} protObj The prototype of an object.\n * @param {!Object<string, fireauth.exportlib.ExportedMethod>} fnMap The map of\n *     prototype functions to their export name and expected arguments.\n */\nfireauth.exportlib.exportPrototypeMethods = function(protObj, fnMap) {\n  // This method exports methods by aliasing the unobfuscated function name\n  // (specified as a string in the \"name\" field of ExportedMethod) to the\n  // obfuscated function name (specified as a key of the fnMap object).\n  //\n  // To give a concrete example, let's say that we have this method:\n  // fireauth.Auth.prototype.fetchProvidersForEmail = function() { ... };\n  //\n  // In the exports file, we export as follows:\n  // fireauth.exportlib.exportPrototypeMethods(fireauth.Auth.prototype, {\n  //   fetchProvidersForEmail: {name: 'fetchProvidersForEmail', args: ...}\n  // });\n  //\n  // When the compiler obfuscates the code, the code above will become something\n  // like this:\n  // fireauth.Auth.prototype.qZ = function() { ... };\n  // fireauth.exportlib.exportPrototypeMethods(fireauth.Auth.prototype, {\n  //   qZ: {name: 'fetchProvidersForEmail', args: ...}\n  // });\n  //\n  // (Of course, fireauth.Auth and fireauth.exportlib.exportPrototypeMethods\n  // would also be obfuscated). Note that the key in fnMap is obfuscated but the\n  // \"name\" field in the ExportedMethod is not. Now, exportPrototypeMethods can\n  // export fetchProvidersForEmail by reading the key (\"qZ\") and the \"name\"\n  // field (\"fetchProvidersForEmail\") and essentially executing this:\n  // fireauth.Auth.prototype['fetchProvidersForEmail'] =\n  //     fireauth.Auth.prototype['qZ'];\n  for (var obfuscatedFnName in fnMap) {\n    var unobfuscatedFnName = fnMap[obfuscatedFnName].name;\n    protObj[unobfuscatedFnName] =\n        fireauth.exportlib.wrapMethodWithArgumentVerifier_(\n        unobfuscatedFnName, protObj[obfuscatedFnName],\n        fnMap[obfuscatedFnName].args);\n  }\n};\n\n\n/**\n * Exports properties of an object. See the docs for exportPrototypeMethods for\n * more information about how this works.\n * @param {!Object} protObj The prototype of an object.\n * @param {!Object<string, !fireauth.exportlib.ExportedProperty>} propMap The\n *     map of properties to their export names.\n */\nfireauth.exportlib.exportPrototypeProperties = function(protObj, propMap) {\n  for (var obfuscatedPropName in propMap) {\n    var unobfuscatedPropName = propMap[obfuscatedPropName].name;\n    // Don't alias a property to itself.\n    // Downside is that argument validation will not be possible. For now, to\n    // get around it, ensure unobfuscated property names are different\n    // than the corresponding obfuscated property names.\n    if (unobfuscatedPropName === obfuscatedPropName) {\n      continue;\n    }\n    /**\n     * @this {!Object}\n     * @param {string} obfuscatedPropName The obfuscated property name.\n     * @return {*} The value of the property.\n     */\n    var getter = function(obfuscatedPropName) {\n      return this[obfuscatedPropName];\n    };\n    /**\n     * @this {!Object}\n     * @param {string} unobfuscatedPropName The unobfuscated property name.\n     * @param {string} obfuscatedPropName The obfuscated property name.\n     * @param {!fireauth.args.Argument} expectedArg The expected argument to the\n     *     setter of this property.\n     * @param {*} value The new value of the property.\n     */\n    var setter = function(unobfuscatedPropName, obfuscatedPropName,\n                          expectedArg, value) {\n      // Validate the argument before setting it.\n      fireauth.args.validate(\n          unobfuscatedPropName, [expectedArg], [value], true);\n      this[obfuscatedPropName] = value;\n    };\n    // Get the expected argument.\n    var expectedArg = propMap[obfuscatedPropName].arg;\n    Object.defineProperty(protObj, unobfuscatedPropName, {\n      /**\n       * @this {!Object}\n       * @return {*} The value of the property.\n       */\n      get: goog.partial(getter, obfuscatedPropName),\n      /**\n       * @this {!Object}\n       * @param {*} value The new value of the property.\n       */\n      set: goog.partial(setter, unobfuscatedPropName, obfuscatedPropName,\n                        expectedArg),\n      enumerable: true\n    });\n  }\n};\n\n\n/**\n * Export a static method as a public API.\n * @param {!Object} parentObj The parent object to patch.\n * @param {string} name The public name of the method.\n * @param {!Function} func The method.\n * @param {?Array<!fireauth.args.Argument>=} opt_expectedArgs The expected\n *     arguments to the method.\n */\nfireauth.exportlib.exportFunction = function(parentObj, name, func,\n    opt_expectedArgs) {\n  parentObj[name] = fireauth.exportlib.wrapMethodWithArgumentVerifier_(\n      name, func, opt_expectedArgs);\n};\n\n\n/**\n * Wraps a method with a function that first verifies the arguments to the\n * method and then calls the original method.\n * @param {string} methodName The name of the method, which will be displayed\n *     on the error message if the arguments are not valid.\n * @param {!Function} method The method to be wrapped.\n * @param {?Array<!fireauth.args.Argument>=} opt_expectedArgs The expected\n *     arguments.\n * @return {!Function} The wrapped method.\n * @private\n */\nfireauth.exportlib.wrapMethodWithArgumentVerifier_ = function(methodName,\n    method, opt_expectedArgs) {\n  if (!opt_expectedArgs) {\n    return method;\n  }\n  var shortName = fireauth.exportlib.extractMethodNameFromFullPath_(methodName);\n  var wrapper = function() {\n    var argumentsAsArray = Array.prototype.slice.call(arguments);\n    fireauth.args.validate(shortName,\n        /** @type {!Array<!fireauth.args.Argument>} */ (opt_expectedArgs),\n        argumentsAsArray);\n    return method.apply(this, argumentsAsArray);\n  };\n  // Reattach all static stuff to wrapper.\n  for (var key in method) {\n    wrapper[key] = method[key];\n  }\n  // Reattach all prototype stuff to wrapper.\n  for (var key in method.prototype) {\n    wrapper.prototype[key] = method.prototype[key];\n  }\n  // Return wrapper with all of method's static and prototype methods and\n  // properties.\n  return wrapper;\n};\n\n\n/**\n * From a full path to a method (e.g. \"fireauth.GoogleAuthProvider.credential\"),\n * get just the method name (\"credential\").\n * @param {string} path The full path.\n * @return {string} The method name.\n * @private\n */\nfireauth.exportlib.extractMethodNameFromFullPath_ = function(path) {\n  var parts = path.split('.');\n  return parts[parts.length - 1];\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ngoog.provide('fireauth.exports');\n\ngoog.require('fireauth.ActionCodeInfo');\ngoog.require('fireauth.ActionCodeURL');\ngoog.require('fireauth.Auth');\ngoog.require('fireauth.AuthCredential');\ngoog.require('fireauth.AuthError');\ngoog.require('fireauth.AuthErrorWithCredential');\ngoog.require('fireauth.AuthSettings');\ngoog.require('fireauth.AuthUser');\ngoog.require('fireauth.ConfirmationResult');\ngoog.require('fireauth.EmailAuthCredential');\ngoog.require('fireauth.EmailAuthProvider');\ngoog.require('fireauth.FacebookAuthProvider');\ngoog.require('fireauth.GRecaptchaMockFactory');\ngoog.require('fireauth.GithubAuthProvider');\ngoog.require('fireauth.GoogleAuthProvider');\ngoog.require('fireauth.InvalidOriginError');\ngoog.require('fireauth.OAuthCredential');\ngoog.require('fireauth.OAuthProvider');\ngoog.require('fireauth.PhoneAuthCredential');\ngoog.require('fireauth.PhoneAuthProvider');\ngoog.require('fireauth.RecaptchaVerifier');\ngoog.require('fireauth.SAMLAuthCredential');\ngoog.require('fireauth.SAMLAuthProvider');\ngoog.require('fireauth.TwitterAuthProvider');\ngoog.require('fireauth.args');\ngoog.require('fireauth.authStorage.Persistence');\ngoog.require('fireauth.exportlib');\ngoog.require('fireauth.grecaptcha');\ngoog.require('fireauth.idp.ProviderId');\ngoog.require('goog.Promise');\n\n/** @define {string} */\nconst AUTH_NPM_PACKAGE_VERSION = '';\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.Auth.prototype, {\n      applyActionCode: {\n        name: 'applyActionCode',\n        args: [fireauth.args.string('code')]\n      },\n      checkActionCode: {\n        name: 'checkActionCode',\n        args: [fireauth.args.string('code')]\n      },\n      confirmPasswordReset: {\n        name: 'confirmPasswordReset',\n        args: [\n          fireauth.args.string('code'),\n          fireauth.args.string('newPassword')\n        ]\n      },\n      createUserWithEmailAndPassword: {\n        name: 'createUserWithEmailAndPassword',\n        args: [fireauth.args.string('email'), fireauth.args.string('password')]\n      },\n      fetchSignInMethodsForEmail: {\n        name: 'fetchSignInMethodsForEmail',\n        args: [fireauth.args.string('email')]\n      },\n      getRedirectResult: {\n        name: 'getRedirectResult',\n        args: []\n      },\n      isSignInWithEmailLink: {\n        name: 'isSignInWithEmailLink',\n        args: [fireauth.args.string('emailLink')]\n      },\n      onAuthStateChanged: {\n        name: 'onAuthStateChanged',\n        args: [\n          fireauth.args.or(\n              fireauth.args.object(),\n              fireauth.args.func(),\n              'nextOrObserver'),\n          fireauth.args.func('opt_error', true),\n          fireauth.args.func('opt_completed', true)\n        ]\n      },\n      onIdTokenChanged: {\n        name: 'onIdTokenChanged',\n        args: [\n          fireauth.args.or(\n              fireauth.args.object(),\n              fireauth.args.func(),\n              'nextOrObserver'),\n          fireauth.args.func('opt_error', true),\n          fireauth.args.func('opt_completed', true)\n        ]\n      },\n      sendPasswordResetEmail: {\n        name: 'sendPasswordResetEmail',\n        args: [\n          fireauth.args.string('email'),\n          fireauth.args.or(\n              fireauth.args.object('opt_actionCodeSettings', true),\n              fireauth.args.null(null, true),\n              'opt_actionCodeSettings',\n              true)\n        ]\n      },\n      sendSignInLinkToEmail: {\n        name: 'sendSignInLinkToEmail',\n        args: [\n          fireauth.args.string('email'),\n          fireauth.args.object('actionCodeSettings')\n        ]\n      },\n      setPersistence: {\n        name: 'setPersistence',\n        args:  [fireauth.args.string('persistence')]\n      },\n      signInAndRetrieveDataWithCredential: {\n        name: 'signInAndRetrieveDataWithCredential',\n        args: [fireauth.args.authCredential()]\n      },\n      signInAnonymously: {\n        name: 'signInAnonymously',\n        args: []\n      },\n      signInWithCredential: {\n        name: 'signInWithCredential',\n        args: [fireauth.args.authCredential()]\n      },\n      signInWithCustomToken: {\n        name: 'signInWithCustomToken',\n        args: [fireauth.args.string('token')]\n      },\n      signInWithEmailAndPassword: {\n        name: 'signInWithEmailAndPassword',\n        args: [fireauth.args.string('email'), fireauth.args.string('password')]\n      },\n      signInWithEmailLink: {\n        name: 'signInWithEmailLink',\n        args: [\n          fireauth.args.string('email'), fireauth.args.string('emailLink', true)\n        ]\n      },\n      signInWithPhoneNumber: {\n        name: 'signInWithPhoneNumber',\n        args: [\n          fireauth.args.string('phoneNumber'),\n          fireauth.args.applicationVerifier()\n        ]\n      },\n      signInWithPopup: {\n        name: 'signInWithPopup',\n        args: [fireauth.args.authProvider()]\n      },\n      signInWithRedirect: {\n        name: 'signInWithRedirect',\n        args: [fireauth.args.authProvider()]\n      },\n      updateCurrentUser: {\n        name: 'updateCurrentUser',\n        args: [\n          fireauth.args.or(\n            fireauth.args.firebaseUser(),\n            fireauth.args.null(),\n            'user')\n        ]\n      },\n      signOut: {\n        name: 'signOut',\n        args: []\n      },\n      toJSON: {\n        name: 'toJSON',\n        // This shouldn't take an argument but a blank string is being passed\n        // on JSON.stringify and causing this to fail with an argument error.\n        // So allow an optional string.\n        args: [fireauth.args.string(null, true)]\n      },\n      useDeviceLanguage: {\n        name: 'useDeviceLanguage',\n        args: []\n      },\n      verifyPasswordResetCode: {\n        name: 'verifyPasswordResetCode',\n        args: [fireauth.args.string('code')]\n      }\n    });\n\nfireauth.exportlib.exportPrototypeProperties(\n    fireauth.Auth.prototype, {\n      'lc': {\n        name: 'languageCode',\n        arg: fireauth.args.or(\n            fireauth.args.string(),\n            fireauth.args.null(),\n            'languageCode')\n      },\n      'ti': {\n        name: 'tenantId',\n        arg: fireauth.args.or(\n            fireauth.args.string(),\n            fireauth.args.null(),\n            'tenantId')\n      }\n    });\n\n// Exports firebase.auth.Auth.Persistence.\nfireauth.Auth['Persistence'] = fireauth.authStorage.Persistence;\nfireauth.Auth['Persistence']['LOCAL'] = fireauth.authStorage.Persistence.LOCAL;\nfireauth.Auth['Persistence']['SESSION'] =\n    fireauth.authStorage.Persistence.SESSION;\nfireauth.Auth['Persistence']['NONE'] = fireauth.authStorage.Persistence.NONE;\n\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.AuthUser.prototype, {\n      'delete': {\n        name: 'delete',\n        args: []\n      },\n      getIdTokenResult: {\n        name: 'getIdTokenResult',\n        args: [fireauth.args.bool('opt_forceRefresh', true)]\n      },\n      getIdToken: {\n        name: 'getIdToken',\n        args: [fireauth.args.bool('opt_forceRefresh', true)]\n      },\n      linkAndRetrieveDataWithCredential: {\n        name: 'linkAndRetrieveDataWithCredential',\n        args: [fireauth.args.authCredential()]\n      },\n      linkWithCredential: {\n        name: 'linkWithCredential',\n        args: [fireauth.args.authCredential()]\n      },\n      linkWithPhoneNumber: {\n        name: 'linkWithPhoneNumber',\n        args: [\n          fireauth.args.string('phoneNumber'),\n          fireauth.args.applicationVerifier()\n        ]\n      },\n      linkWithPopup: {\n        name: 'linkWithPopup',\n        args: [fireauth.args.authProvider()]\n      },\n      linkWithRedirect: {\n        name: 'linkWithRedirect',\n        args: [fireauth.args.authProvider()]\n      },\n      reauthenticateAndRetrieveDataWithCredential: {\n        name: 'reauthenticateAndRetrieveDataWithCredential',\n        args: [fireauth.args.authCredential()]\n      },\n      reauthenticateWithCredential: {\n        name: 'reauthenticateWithCredential',\n        args: [fireauth.args.authCredential()]\n      },\n      reauthenticateWithPhoneNumber: {\n        name: 'reauthenticateWithPhoneNumber',\n        args: [\n          fireauth.args.string('phoneNumber'),\n          fireauth.args.applicationVerifier()\n        ]\n      },\n      reauthenticateWithPopup: {\n        name: 'reauthenticateWithPopup',\n        args: [fireauth.args.authProvider()]\n      },\n      reauthenticateWithRedirect: {\n        name: 'reauthenticateWithRedirect',\n        args: [fireauth.args.authProvider()]\n      },\n      reload: {\n        name: 'reload',\n        args: []\n      },\n      sendEmailVerification: {\n        name: 'sendEmailVerification',\n        args: [\n          fireauth.args.or(\n              fireauth.args.object('opt_actionCodeSettings', true),\n              fireauth.args.null(null, true),\n              'opt_actionCodeSettings',\n              true)\n        ]\n      },\n      toJSON: {\n        name: 'toJSON',\n        // This shouldn't take an argument but a blank string is being passed\n        // on JSON.stringify and causing this to fail with an argument error.\n        // So allow an optional string.\n        args: [fireauth.args.string(null, true)]\n      },\n      unlink: {\n        name: 'unlink',\n        args: [fireauth.args.string('provider')]\n      },\n      updateEmail: {\n        name: 'updateEmail',\n        args: [fireauth.args.string('email')]\n      },\n      updatePassword: {\n        name: 'updatePassword',\n        args: [fireauth.args.string('password')]\n      },\n      updatePhoneNumber: {\n        name: 'updatePhoneNumber',\n        args: [fireauth.args.authCredential(fireauth.idp.ProviderId.PHONE)]\n      },\n      updateProfile: {\n        name: 'updateProfile',\n        args: [fireauth.args.object('profile')]\n      }\n    });\n\n// Ensure internal grecaptcha mock API do not get obfuscated.\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.GRecaptchaMockFactory.prototype, {\n      execute: {\n        name: 'execute'\n      },\n      render: {\n        name: 'render'\n      },\n      reset: {\n        name: 'reset'\n      },\n      getResponse: {\n        name: 'getResponse'\n      }\n    });\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.grecaptcha.prototype, {\n      execute: {\n        name: 'execute'\n      },\n      render: {\n        name: 'render'\n      },\n      reset: {\n        name: 'reset'\n      },\n      getResponse: {\n        name: 'getResponse'\n      }\n    });\n\nfireauth.exportlib.exportPrototypeMethods(\n    goog.Promise.prototype, {\n      thenAlways: {\n        name: 'finally'\n      },\n      thenCatch: {\n        name: 'catch'\n      },\n      then: {\n        name: 'then'\n      }\n    });\n\nfireauth.exportlib.exportPrototypeProperties(\n    fireauth.AuthSettings.prototype, {\n      'appVerificationDisabled': {\n        name: 'appVerificationDisabledForTesting',\n        arg: fireauth.args.bool('appVerificationDisabledForTesting')\n      }\n    });\n\nfireauth.exportlib.exportPrototypeMethods(\n   fireauth.ConfirmationResult.prototype, {\n      confirm: {\n        name: 'confirm',\n        args: [\n          fireauth.args.string('verificationCode')\n        ]\n      }\n    });\n\nfireauth.exportlib.exportFunction(\n    fireauth.AuthCredential, 'fromJSON',\n    fireauth.AuthCredential.fromPlainObject, [\n      fireauth.args.or(fireauth.args.string(), fireauth.args.object(), 'json')\n    ]);\n\nfireauth.exportlib.exportFunction(\n    fireauth.EmailAuthProvider, 'credential',\n    fireauth.EmailAuthProvider.credential, [\n      fireauth.args.string('email'),\n      fireauth.args.string('password')\n    ]);\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.EmailAuthCredential.prototype, {\n     toPlainObject: {\n        name: 'toJSON',\n        // This shouldn't take an argument but a blank string is being passed\n        // on JSON.stringify and causing this to fail with an argument error.\n        // So allow an optional string.\n        args: [fireauth.args.string(null, true)]\n      }\n    });\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.FacebookAuthProvider.prototype, {\n      addScope: {\n        name: 'addScope',\n        args: [fireauth.args.string('scope')]\n      },\n      setCustomParameters: {\n        name: 'setCustomParameters',\n        args: [fireauth.args.object('customOAuthParameters')]\n      }\n    });\nfireauth.exportlib.exportFunction(\n    fireauth.FacebookAuthProvider, 'credential',\n    fireauth.FacebookAuthProvider.credential, [\n      fireauth.args.or(fireauth.args.string(), fireauth.args.object(),\n          'token')\n    ]);\nfireauth.exportlib.exportFunction(\n    fireauth.EmailAuthProvider, 'credentialWithLink',\n    fireauth.EmailAuthProvider.credentialWithLink, [\n      fireauth.args.string('email'),\n      fireauth.args.string('emailLink')\n    ]);\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.GithubAuthProvider.prototype, {\n      addScope: {\n        name: 'addScope',\n        args: [fireauth.args.string('scope')]\n      },\n      setCustomParameters: {\n        name: 'setCustomParameters',\n        args: [fireauth.args.object('customOAuthParameters')]\n      }\n    });\nfireauth.exportlib.exportFunction(\n    fireauth.GithubAuthProvider, 'credential',\n    fireauth.GithubAuthProvider.credential, [\n      fireauth.args.or(fireauth.args.string(), fireauth.args.object(),\n          'token')\n    ]);\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.GoogleAuthProvider.prototype, {\n      addScope: {\n        name: 'addScope',\n        args: [fireauth.args.string('scope')]\n      },\n      setCustomParameters: {\n        name: 'setCustomParameters',\n        args: [fireauth.args.object('customOAuthParameters')]\n      }\n    });\nfireauth.exportlib.exportFunction(\n    fireauth.GoogleAuthProvider, 'credential',\n    fireauth.GoogleAuthProvider.credential, [\n      fireauth.args.or(fireauth.args.string(),\n          fireauth.args.or(fireauth.args.object(), fireauth.args.null()),\n          'idToken'),\n      fireauth.args.or(fireauth.args.string(), fireauth.args.null(),\n          'accessToken', true)\n    ]);\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.TwitterAuthProvider.prototype, {\n      setCustomParameters: {\n        name: 'setCustomParameters',\n        args: [fireauth.args.object('customOAuthParameters')]\n      }\n    });\nfireauth.exportlib.exportFunction(\n    fireauth.TwitterAuthProvider, 'credential',\n    fireauth.TwitterAuthProvider.credential, [\n      fireauth.args.or(fireauth.args.string(), fireauth.args.object(),\n          'token'),\n      fireauth.args.string('secret', true)\n    ]);\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.OAuthProvider.prototype, {\n      addScope: {\n        name: 'addScope',\n        args: [fireauth.args.string('scope')]\n      },\n      credential: {\n        name: 'credential',\n        args: [\n          fireauth.args.or(\n              fireauth.args.string(),\n              fireauth.args.or(fireauth.args.object(), fireauth.args.null()),\n              'optionsOrIdToken'),\n          fireauth.args.or(fireauth.args.string(), fireauth.args.null(),\n              'accessToken', true)\n        ]\n      },\n      setCustomParameters: {\n        name: 'setCustomParameters',\n        args: [fireauth.args.object('customOAuthParameters')]\n      }\n    });\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.OAuthCredential.prototype, {\n     toPlainObject: {\n        name: 'toJSON',\n        // This shouldn't take an argument but a blank string is being passed\n        // on JSON.stringify and causing this to fail with an argument error.\n        // So allow an optional string.\n        args: [fireauth.args.string(null, true)]\n      }\n    });\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.SAMLAuthCredential.prototype, {\n     toPlainObject: {\n        name: 'toJSON',\n        // This shouldn't take an argument but a blank string is being passed\n        // on JSON.stringify and causing this to fail with an argument error.\n        // So allow an optional string.\n        args: [fireauth.args.string(null, true)]\n      }\n    });\n\nfireauth.exportlib.exportFunction(\n    fireauth.PhoneAuthProvider, 'credential',\n    fireauth.PhoneAuthProvider.credential, [\n      fireauth.args.string('verificationId'),\n      fireauth.args.string('verificationCode')\n    ]);\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.PhoneAuthProvider.prototype, {\n      verifyPhoneNumber: {\n        name: 'verifyPhoneNumber',\n        args: [\n          fireauth.args.string('phoneNumber'),\n          fireauth.args.applicationVerifier()\n        ]\n      }\n    });\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.PhoneAuthCredential.prototype, {\n     toPlainObject: {\n        name: 'toJSON',\n        // This shouldn't take an argument but a blank string is being passed\n        // on JSON.stringify and causing this to fail with an argument error.\n        // So allow an optional string.\n        args: [fireauth.args.string(null, true)]\n      }\n    });\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.AuthError.prototype, {\n      toJSON: {\n        name: 'toJSON',\n        // This shouldn't take an argument but a blank string is being passed\n        // on JSON.stringify and causing this to fail with an argument error.\n        // So allow an optional string.\n        args: [fireauth.args.string(null, true)]\n      }\n    });\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.AuthErrorWithCredential.prototype, {\n      toJSON: {\n        name: 'toJSON',\n        // This shouldn't take an argument but a blank string is being passed\n        // on JSON.stringify and causing this to fail with an argument error.\n        // So allow an optional string.\n        args: [fireauth.args.string(null, true)]\n      }\n    });\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.InvalidOriginError.prototype, {\n      toJSON: {\n        name: 'toJSON',\n        // This shouldn't take an argument but a blank string is being passed\n        // on JSON.stringify and causing this to fail with an argument error.\n        // So allow an optional string.\n        args: [fireauth.args.string(null, true)]\n      }\n    });\n\nfireauth.exportlib.exportPrototypeMethods(\n    fireauth.RecaptchaVerifier.prototype, {\n      clear: {\n        name: 'clear',\n        args: []\n      },\n      render: {\n        name: 'render',\n        args: []\n      },\n      verify: {\n        name: 'verify',\n        args: []\n      }\n    });\n\nfireauth.exportlib.exportFunction(\n    fireauth.ActionCodeURL, 'parseLink',\n    fireauth.ActionCodeURL.parseLink, [fireauth.args.string('link')]);\n\n\n(function() {\n  if (typeof firebase === 'undefined' || !firebase.INTERNAL ||\n      !firebase.INTERNAL.registerComponent) {\n    throw new Error('Cannot find the firebase namespace; be sure to include ' +\n        'firebase-app.js before this library.');\n  } else {\n    var namespace = {\n      // Exports firebase.auth.ActionCodeInfo.Operation.\n      'ActionCodeInfo': {\n        'Operation': {\n          'EMAIL_SIGNIN': fireauth.ActionCodeInfo.Operation.EMAIL_SIGNIN,\n          'PASSWORD_RESET': fireauth.ActionCodeInfo.Operation.PASSWORD_RESET,\n          'RECOVER_EMAIL': fireauth.ActionCodeInfo.Operation.RECOVER_EMAIL,\n          'VERIFY_EMAIL': fireauth.ActionCodeInfo.Operation.VERIFY_EMAIL\n        }\n      },\n      'Auth': fireauth.Auth,\n      'AuthCredential': fireauth.AuthCredential,\n      'Error': fireauth.AuthError\n    };\n    fireauth.exportlib.exportFunction(namespace,\n        'EmailAuthProvider', fireauth.EmailAuthProvider, []);\n    fireauth.exportlib.exportFunction(namespace,\n        'FacebookAuthProvider', fireauth.FacebookAuthProvider, []);\n    fireauth.exportlib.exportFunction(namespace,\n        'GithubAuthProvider', fireauth.GithubAuthProvider, []);\n    fireauth.exportlib.exportFunction(namespace,\n        'GoogleAuthProvider', fireauth.GoogleAuthProvider, []);\n    fireauth.exportlib.exportFunction(namespace,\n        'TwitterAuthProvider', fireauth.TwitterAuthProvider, []);\n    fireauth.exportlib.exportFunction(namespace,\n        'OAuthProvider', fireauth.OAuthProvider, [\n          fireauth.args.string('providerId')\n        ]);\n    fireauth.exportlib.exportFunction(namespace,\n        'SAMLAuthProvider', fireauth.SAMLAuthProvider, [\n          fireauth.args.string('providerId')\n        ]);\n    fireauth.exportlib.exportFunction(namespace,\n        'PhoneAuthProvider', fireauth.PhoneAuthProvider, [\n          fireauth.args.firebaseAuth(true)\n        ]);\n    fireauth.exportlib.exportFunction(namespace,\n        'RecaptchaVerifier', fireauth.RecaptchaVerifier, [\n          fireauth.args.or(\n              fireauth.args.string(),\n              fireauth.args.element(),\n              'recaptchaContainer'),\n          fireauth.args.object('recaptchaParameters', true),\n          fireauth.args.firebaseApp(true)\n        ]);\n    fireauth.exportlib.exportFunction(namespace,\n        'ActionCodeURL', fireauth.ActionCodeURL, []);\n\n    // Create auth components to register with firebase.\n    // Provides Auth public APIs.\n    const authComponent = { \n      'name': fireauth.exportlib.AUTH_TYPE,\n      'instanceFactory': function(container) {\n        var app = container['getProvider']('app')['getImmediate']();\n        return new fireauth.Auth(app);\n      },\n      'multipleInstances': false,\n      'serviceProps': namespace,\n      'instantiationMode': 'LAZY',\n      'type':  'PUBLIC'\n    };\n  \n    // Provides Auth internal APIs.\n    const authInteropComponent = { \n      'name': 'auth-internal',\n      'instanceFactory': function(container) {\n        var auth = container['getProvider'](fireauth.exportlib.AUTH_TYPE)['getImmediate']();\n        return {\n          'getUid': goog.bind(auth.getUid, auth),\n          'getToken': goog.bind(auth.getIdTokenInternal, auth),\n          'addAuthTokenListener':\n            goog.bind(auth.addAuthTokenListenerInternal, auth),\n          'removeAuthTokenListener':\n            goog.bind(auth.removeAuthTokenListenerInternal, auth)\n        };\n      },\n      'multipleInstances': false,\n      'instantiationMode': 'LAZY',\n      'type':  'PRIVATE'\n    };\n  \n    firebase.INTERNAL.registerComponent(authComponent);\n    firebase.INTERNAL.registerComponent(authInteropComponent);\n    firebase.registerVersion('@firebase/auth', AUTH_NPM_PACKAGE_VERSION);\n\n    // Expose User as firebase.User.\n    firebase.INTERNAL.extendNamespace({\n      'User': fireauth.AuthUser\n    });\n  }\n})();","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"firebase/app\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"firebase/app\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"firebase/app\")) : factory(root[\"firebase/app\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function(__WEBPACK_EXTERNAL_MODULE_6__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(1);\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _utils = __webpack_require__(2);\n\n\tvar _validators = __webpack_require__(5);\n\n\tvar _app = __webpack_require__(6);\n\n\tvar _app2 = _interopRequireDefault(_app);\n\n\tvar _push2 = __webpack_require__(7);\n\n\tvar _push3 = _interopRequireDefault(_push2);\n\n\tvar _fetch2 = __webpack_require__(8);\n\n\tvar _fetch3 = _interopRequireDefault(_fetch2);\n\n\tvar _post2 = __webpack_require__(9);\n\n\tvar _post3 = _interopRequireDefault(_post2);\n\n\tvar _sync2 = __webpack_require__(10);\n\n\tvar _sync3 = _interopRequireDefault(_sync2);\n\n\tvar _bind2 = __webpack_require__(11);\n\n\tvar _bind3 = _interopRequireDefault(_bind2);\n\n\tvar _update2 = __webpack_require__(12);\n\n\tvar _update3 = _interopRequireDefault(_update2);\n\n\tvar _reset2 = __webpack_require__(13);\n\n\tvar _reset3 = _interopRequireDefault(_reset2);\n\n\tvar _removeBinding2 = __webpack_require__(3);\n\n\tvar _removeBinding3 = _interopRequireDefault(_removeBinding2);\n\n\tvar _remove2 = __webpack_require__(14);\n\n\tvar _remove3 = _interopRequireDefault(_remove2);\n\n\tvar _fsSync2 = __webpack_require__(15);\n\n\tvar _fsSync3 = _interopRequireDefault(_fsSync2);\n\n\tvar _fsRemoveBinding2 = __webpack_require__(4);\n\n\tvar _fsRemoveBinding3 = _interopRequireDefault(_fsRemoveBinding2);\n\n\tvar _fsBind2 = __webpack_require__(16);\n\n\tvar _fsBind3 = _interopRequireDefault(_fsBind2);\n\n\tvar _fsGet2 = __webpack_require__(17);\n\n\tvar _fsGet3 = _interopRequireDefault(_fsGet2);\n\n\tvar _fsRemoveDoc2 = __webpack_require__(18);\n\n\tvar _fsRemoveDoc3 = _interopRequireDefault(_fsRemoveDoc2);\n\n\tvar _fsAddToCollection2 = __webpack_require__(19);\n\n\tvar _fsAddToCollection3 = _interopRequireDefault(_fsAddToCollection2);\n\n\tvar _fsRemoveFromCollection2 = __webpack_require__(20);\n\n\tvar _fsRemoveFromCollection3 = _interopRequireDefault(_fsRemoveFromCollection2);\n\n\tvar _fsUpdateDoc2 = __webpack_require__(21);\n\n\tvar _fsUpdateDoc3 = _interopRequireDefault(_fsUpdateDoc2);\n\n\tvar _fsReset2 = __webpack_require__(22);\n\n\tvar _fsReset3 = _interopRequireDefault(_fsReset2);\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\t//database\n\tmodule.exports = function () {\n\t  function init(db) {\n\t    return function () {\n\t      var refs = new Map();\n\t      var listeners = new Map();\n\t      var syncs = new WeakMap();\n\n\t      if (typeof db.ref === 'function') {\n\t        var rebase = {\n\t          initializedApp: db.app,\n\t          timestamp: _app2.default.database.ServerValue.TIMESTAMP,\n\t          listenTo: function listenTo(endpoint, options) {\n\t            return _bind3.default.call(this, endpoint, options, 'listenTo', {\n\t              db: db,\n\t              refs: refs,\n\t              listeners: listeners,\n\t              syncs: syncs\n\t            });\n\t          },\n\t          bindToState: function bindToState(endpoint, options) {\n\t            return _bind3.default.call(this, endpoint, options, 'bindToState', {\n\t              db: db,\n\t              refs: refs,\n\t              listeners: listeners\n\t            });\n\t          },\n\t          syncState: function syncState(endpoint, options) {\n\t            return _sync3.default.call(this, endpoint, options, {\n\t              db: db,\n\t              refs: refs,\n\t              listeners: listeners,\n\t              syncs: syncs\n\t            });\n\t          },\n\t          fetch: function fetch(endpoint, options) {\n\t            return (0, _fetch3.default)(endpoint, options, db);\n\t          },\n\t          post: function post(endpoint, options) {\n\t            return (0, _post3.default)(endpoint, options, db);\n\t          },\n\t          update: function update(endpoint, options) {\n\t            return (0, _update3.default)(endpoint, options, { db: db });\n\t          },\n\t          push: function push(endpoint, options) {\n\t            return (0, _push3.default)(endpoint, options, db);\n\t          },\n\t          removeBinding: function removeBinding(binding) {\n\t            (0, _removeBinding3.default)(binding, {\n\t              refs: refs,\n\t              listeners: listeners,\n\t              syncs: syncs\n\t            });\n\t          },\n\t          remove: function remove(endpoint, fn) {\n\t            return (0, _remove3.default)(endpoint, db, fn);\n\t          },\n\t          reset: function reset() {\n\t            return (0, _reset3.default)({\n\t              refs: refs,\n\t              listeners: listeners,\n\t              syncs: syncs\n\t            });\n\t          }\n\t        };\n\t      } else {\n\t        var rebase = {\n\t          initializedApp: db.app,\n\t          timestamp: _app2.default.firestore.FieldValue.serverTimestamp(),\n\t          bindDoc: function bindDoc(path, options) {\n\t            return _fsBind3.default.call(this, path, options, 'bindDoc', {\n\t              db: db,\n\t              refs: refs,\n\t              listeners: listeners\n\t            });\n\t          },\n\t          bindCollection: function bindCollection(path, options) {\n\t            return _fsBind3.default.call(this, path, options, 'bindCollection', {\n\t              db: db,\n\t              refs: refs,\n\t              listeners: listeners\n\t            });\n\t          },\n\t          syncDoc: function syncDoc(doc, options) {\n\t            return _fsSync3.default.call(this, doc, options, {\n\t              db: db,\n\t              refs: refs,\n\t              listeners: listeners,\n\t              syncs: syncs\n\t            });\n\t          },\n\t          listenToDoc: function listenToDoc(doc, options) {\n\t            return _fsBind3.default.call(this, doc, options, 'listenToDoc', {\n\t              db: db,\n\t              refs: refs,\n\t              listeners: listeners\n\t            });\n\t          },\n\t          listenToCollection: function listenToCollection(path, options) {\n\t            return _fsBind3.default.call(this, path, options, 'listenToCollection', {\n\t              db: db,\n\t              refs: refs,\n\t              listeners: listeners\n\t            });\n\t          },\n\t          addToCollection: function addToCollection(path, doc, key) {\n\t            return _fsAddToCollection3.default.call(this, path, doc, db, key);\n\t          },\n\t          updateDoc: function updateDoc(path, doc, options) {\n\t            return _fsUpdateDoc3.default.call(this, path, doc, db);\n\t          },\n\t          get: function get(path, options) {\n\t            return _fsGet3.default.call(this, path, options, db);\n\t          },\n\t          removeDoc: function removeDoc(path) {\n\t            return (0, _fsRemoveDoc3.default)(path, db);\n\t          },\n\t          removeFromCollection: function removeFromCollection(path, options) {\n\t            return (0, _fsRemoveFromCollection3.default)(path, db, options);\n\t          },\n\t          removeBinding: function removeBinding(binding) {\n\t            (0, _fsRemoveBinding3.default)(binding, {\n\t              refs: refs,\n\t              listeners: listeners,\n\t              syncs: syncs\n\t            });\n\t          },\n\t          reset: function reset() {\n\t            return (0, _fsReset3.default)({\n\t              refs: refs,\n\t              listeners: listeners,\n\t              syncs: syncs\n\t            });\n\t          }\n\t        };\n\t      }\n\t      return rebase;\n\t    }();\n\t  }\n\n\t  return {\n\t    createClass: function createClass(db) {\n\t      (0, _validators._validateDatabase)(db);\n\t      return init(db);\n\t    }\n\t  };\n\t}();\n\n\t//firestore\n\t//helpers\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports._fsCreateRef = exports._fsSetUnmountHandler = exports._setData = exports._handleError = exports._createNestedObject = exports._setUnmountHandler = exports._addFirestoreListener = exports._addListener = exports._fsUpdateSyncState = exports._updateSyncState = exports._firebaseRefsMixin = exports._addSync = exports._hasOwnNestedProperty = exports._getSegmentCount = exports._getNestedObject = exports._isNestedPath = exports._isObject = exports._isValid = exports._toArray = exports._fsPrepareData = exports._prepareData = exports._throwError = exports._setState = exports._returnRef = exports._addFirestoreQuery = exports._addQueries = exports._createHash = undefined;\n\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n\tvar _removeBinding2 = __webpack_require__(3);\n\n\tvar _removeBinding3 = _interopRequireDefault(_removeBinding2);\n\n\tvar _fsRemoveBinding2 = __webpack_require__(4);\n\n\tvar _fsRemoveBinding3 = _interopRequireDefault(_fsRemoveBinding2);\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\tfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\tvar _isObject = function _isObject(obj) {\n\t  return Object.prototype.toString.call(obj) === '[object Object]' ? true : false;\n\t};\n\n\tvar _toArray = function _toArray(snapshot) {\n\t  var arr = [];\n\t  snapshot.forEach(function (childSnapshot) {\n\t    var val = childSnapshot.val();\n\t    if (_isObject(val)) {\n\t      val.key = childSnapshot.key;\n\t    }\n\t    arr.push(val);\n\t  });\n\t  return arr;\n\t};\n\n\tvar _isValid = function _isValid(value) {\n\t  return typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean' || (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' ? true : false;\n\t};\n\n\tvar _isNestedPath = function _isNestedPath(path) {\n\t  return path.split('.').length > 1 ? true : false;\n\t};\n\n\tvar _createNestedObject = function _createNestedObject(path, value) {\n\t  var obj = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n\t  var keys = path.split('.');\n\t  var lastKey = value === undefined ? false : keys.pop();\n\t  var root = obj;\n\n\t  var _iteratorNormalCompletion = true;\n\t  var _didIteratorError = false;\n\t  var _iteratorError = undefined;\n\n\t  try {\n\t    for (var _iterator = keys[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t      var key = _step.value;\n\n\t      obj = obj[key] = obj[key] || {};\n\t    }\n\t  } catch (err) {\n\t    _didIteratorError = true;\n\t    _iteratorError = err;\n\t  } finally {\n\t    try {\n\t      if (!_iteratorNormalCompletion && _iterator.return) {\n\t        _iterator.return();\n\t      }\n\t    } finally {\n\t      if (_didIteratorError) {\n\t        throw _iteratorError;\n\t      }\n\t    }\n\t  }\n\n\t  if (lastKey) obj[lastKey] = value;\n\n\t  return root;\n\t};\n\n\tvar _getNestedObject = function _getNestedObject(obj, path) {\n\t  if (_isNestedPath(path) === false) return;\n\n\t  var keys = path.split('.');\n\t  var _iteratorNormalCompletion2 = true;\n\t  var _didIteratorError2 = false;\n\t  var _iteratorError2 = undefined;\n\n\t  try {\n\t    for (var _iterator2 = keys[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t      var key = _step2.value;\n\n\t      if (!obj || (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object') return;\n\t      obj = obj[key];\n\t    }\n\t  } catch (err) {\n\t    _didIteratorError2 = true;\n\t    _iteratorError2 = err;\n\t  } finally {\n\t    try {\n\t      if (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t        _iterator2.return();\n\t      }\n\t    } finally {\n\t      if (_didIteratorError2) {\n\t        throw _iteratorError2;\n\t      }\n\t    }\n\t  }\n\n\t  return obj;\n\t};\n\n\tvar _hasOwnNestedProperty = function _hasOwnNestedProperty(obj, path) {\n\t  return _getNestedObject(obj, path) === undefined ? false : true;\n\t};\n\n\tvar _prepareData = function _prepareData(snapshot) {\n\t  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t  var defaultValue = options.defaultValue,\n\t      asArray = options.asArray;\n\n\t  var data = snapshot.val();\n\t  if (data === null && _isValid(defaultValue)) return defaultValue;\n\t  if (asArray === true) return _toArray(snapshot);\n\t  return data === null ? {} : data;\n\t};\n\n\tvar _addSync = function _addSync(context, sync, syncs) {\n\t  var existingSyncs = syncs.get(context) || [];\n\t  existingSyncs.push(sync);\n\t  syncs.set(context, existingSyncs);\n\t};\n\n\tvar _throwError = function _throwError(msg, code) {\n\t  var err = new Error('REBASE: ' + msg);\n\t  err.code = code;\n\t  throw err;\n\t};\n\n\tvar _setState = function _setState(newState) {\n\t  this.setState(newState);\n\t};\n\n\tvar _returnRef = function _returnRef(endpoint, method, id, context) {\n\t  return { endpoint: endpoint, method: method, id: id, context: context };\n\t};\n\n\tvar _addQueries = function _addQueries(ref, queries) {\n\t  var needArgs = {\n\t    limitToFirst: true,\n\t    limitToLast: true,\n\t    orderByChild: true,\n\t    startAt: true,\n\t    endAt: true,\n\t    equalTo: true\n\t  };\n\n\t  for (var key in queries) {\n\t    /* istanbul ignore else */\n\t    if (queries.hasOwnProperty(key)) {\n\t      if (needArgs[key]) {\n\t        ref = ref[key](queries[key]);\n\t      } else {\n\t        ref = ref[key]();\n\t      }\n\t    }\n\t  }\n\t  return ref;\n\t};\n\n\tvar _addFirestoreQuery = function _addFirestoreQuery(ref, query) {\n\t  if (query) {\n\t    return query(ref);\n\t  }\n\t  return ref;\n\t};\n\n\tvar _createHash = function _createHash(endpoint, invoker) {\n\t  var hash = 0;\n\t  var str = endpoint + invoker + Math.random();\n\t  for (var i = 0; i < str.length; i++) {\n\t    var char = str.charCodeAt(i);\n\t    hash = (hash << 5) - hash + char;\n\t    hash = hash & hash;\n\t  }\n\t  return hash;\n\t};\n\n\tvar _firebaseRefsMixin = function _firebaseRefsMixin(id, ref, refs) {\n\t  refs.set(id, ref);\n\t};\n\n\tvar _handleError = function _handleError(onFailure, err) {\n\t  if (err && typeof onFailure === 'function') {\n\t    onFailure(err);\n\t  }\n\t};\n\n\tvar _setUnmountHandler = function _setUnmountHandler(context, id, refs, listeners, syncs) {\n\t  var removeListeners = function removeListeners() {\n\t    (0, _removeBinding3.default)({ context: context, id: id }, { refs: refs, listeners: listeners, syncs: syncs });\n\t  };\n\t  if (typeof context.componentWillUnmount === 'function') {\n\t    var unmount = context.componentWillUnmount;\n\t  }\n\t  context.componentWillUnmount = function () {\n\t    removeListeners();\n\t    if (unmount) unmount.call(context);\n\t  };\n\t};\n\n\tvar _fsSetUnmountHandler = function _fsSetUnmountHandler(context, id, refs, listeners, syncs) {\n\t  var removeListeners = function removeListeners() {\n\t    (0, _fsRemoveBinding3.default)({ context: context, id: id }, { refs: refs, listeners: listeners, syncs: syncs });\n\t  };\n\t  if (typeof context.componentWillUnmount === 'function') {\n\t    var unmount = context.componentWillUnmount;\n\t  }\n\t  context.componentWillUnmount = function () {\n\t    removeListeners();\n\t    if (unmount) unmount.call(context);\n\t  };\n\t};\n\n\tvar _setData = function _setData(ref, data, handleError, keepKeys) {\n\t  if (Array.isArray(data) && keepKeys) {\n\t    var shouldConvertToObject = data.reduce(function (acc, curr) {\n\t      return acc ? acc : _isObject(curr) && curr.hasOwnProperty('key');\n\t    }, false);\n\t    if (shouldConvertToObject) {\n\t      data = data.reduce(function (acc, item) {\n\t        acc[item.key] = item;\n\t        return acc;\n\t      }, {});\n\t    }\n\t  }\n\t  ref.set(data, handleError);\n\t};\n\n\tvar _updateSyncState = function _updateSyncState(ref, onFailure, keepKeys, data) {\n\t  if (_isObject(data)) {\n\t    for (var prop in data) {\n\t      //allow timestamps to be set\n\t      if (prop !== '.sv') {\n\t        _updateSyncState(ref.child(prop), onFailure, keepKeys, data[prop]);\n\t      } else {\n\t        _setData(ref, data, _handleError.bind(null, onFailure), keepKeys);\n\t      }\n\t    }\n\t  } else {\n\t    _setData(ref, data, _handleError.bind(null, onFailure), keepKeys);\n\t  }\n\t};\n\n\tvar _fsUpdateSyncState = function _fsUpdateSyncState(ref, data) {\n\t  ref.set(data);\n\t};\n\n\tvar _addListener = function _addListener(id, invoker, options, ref, listeners) {\n\t  ref = _addQueries(ref, options.queries);\n\t  var boundOnFailure = typeof options.onFailure === 'function' ? options.onFailure.bind(options.context) : null;\n\t  listeners.set(id, ref.on('value', function (snapshot) {\n\t    var data = _prepareData(snapshot, options);\n\t    if (invoker === 'listenTo') {\n\t      options.then.call(options.context, data);\n\t    } else {\n\t      var newState = _defineProperty({}, options.state, data);\n\t      if (_isNestedPath(options.state)) {\n\t        var root = options.state.split('.')[0];\n\t        // Merge the previous state with the new one\n\t        var prevState = _defineProperty({}, root, options.context.state[root]);\n\t        newState = _createNestedObject(options.state, data, prevState);\n\t      }\n\t      if (invoker === 'syncState') {\n\t        options.reactSetState.call(options.context, newState);\n\t        if (options.then && options.then.called === false) {\n\t          options.then.call(options.context);\n\t          options.then.called = true;\n\t        }\n\t      } else if (invoker === 'bindToState') {\n\t        _setState.call(options.context, newState);\n\t        if (options.then && options.then.called === false) {\n\t          options.then.call(options.context);\n\t          options.then.called = true;\n\t        }\n\t      }\n\t    }\n\t  }, boundOnFailure));\n\t};\n\n\tvar _addFirestoreListener = function _addFirestoreListener(id, invoker, options, ref, listeners) {\n\t  ref = _addFirestoreQuery(ref, options.query);\n\t  var boundOnFailure = typeof options.onFailure === 'function' ? options.onFailure.bind(options.context) : undefined;\n\t  listeners.set(id, ref.onSnapshot(function (snapshot) {\n\t    if (invoker.match(/^listenTo/)) {\n\t      if (invoker === 'listenToDoc') {\n\t        var newState = _fsPrepareData(snapshot, options);\n\t        return options.then.call(options.context, newState);\n\t      }\n\t      if (invoker === 'listenToCollection') {\n\t        var _newState2 = _fsPrepareData(snapshot, options, true);\n\t        return options.then.call(options.context, _newState2);\n\t      }\n\t    } else {\n\t      if (invoker === 'syncDoc') {\n\t        var _newState3 = _fsPrepareData(snapshot, options);\n\t        options.reactSetState.call(options.context, function (currentState) {\n\t          return Object.assign(currentState, _newState3);\n\t        });\n\t      } else if (invoker === 'bindDoc') {\n\t        var _newState4 = _fsPrepareData(snapshot, options);\n\t        _setState.call(options.context, function (currentState) {\n\t          return Object.assign(currentState, _newState4);\n\t        });\n\t      } else if (invoker === 'bindCollection') {\n\t        var _newState5 = _fsPrepareData(snapshot, options, true);\n\t        _setState.call(options.context, function (currentState) {\n\t          return Object.assign(currentState, _newState5);\n\t        });\n\t      }\n\t      if (options.then && options.then.called === false) {\n\t        options.then.call(options.context);\n\t        options.then.called = true;\n\t      }\n\t    }\n\t  }, boundOnFailure));\n\t};\n\n\tvar _getSegmentCount = function _getSegmentCount(path) {\n\t  return path.match(/^\\//) ? path.split('/').slice(1).length : path.split('/').length;\n\t};\n\n\tvar _fsPrepareData = function _fsPrepareData(snapshot, options) {\n\t  var isCollection = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n\t  var meta = {};\n\t  if (!isCollection) {\n\t    var data = {};\n\t    if (snapshot.exists) {\n\t      if (options.withRefs) meta.ref = snapshot.ref;\n\t      if (options.withIds) meta.id = snapshot.id;\n\t      data = snapshot.data();\n\t    } else {\n\t      data = {};\n\t    }\n\t    return options.state ? _defineProperty({}, options.state, Object.assign({}, data, meta)) : Object.assign({}, data, meta);\n\t  }\n\t  var collection = [];\n\t  if (!snapshot.empty) {\n\t    snapshot.forEach(function (doc) {\n\t      if (options.withRefs) meta.ref = doc.ref;\n\t      if (options.withIds) meta.id = doc.id;\n\t      collection.push(Object.assign({}, doc.data(), meta));\n\t    });\n\t  }\n\t  return options.state ? _defineProperty({}, options.state, collection) : collection;\n\t};\n\n\tvar _fsCreateRef = function _fsCreateRef(pathOrRef, db) {\n\t  if ((typeof pathOrRef === 'undefined' ? 'undefined' : _typeof(pathOrRef)) === 'object') {\n\t    return pathOrRef;\n\t  }\n\t  var segmentCount = _getSegmentCount(pathOrRef);\n\t  var ref;\n\t  if (segmentCount % 2 === 0) {\n\t    ref = db.doc(pathOrRef);\n\t  } else {\n\t    ref = db.collection(pathOrRef);\n\t  }\n\t  return ref;\n\t};\n\n\texports._createHash = _createHash;\n\texports._addQueries = _addQueries;\n\texports._addFirestoreQuery = _addFirestoreQuery;\n\texports._returnRef = _returnRef;\n\texports._setState = _setState;\n\texports._throwError = _throwError;\n\texports._prepareData = _prepareData;\n\texports._fsPrepareData = _fsPrepareData;\n\texports._toArray = _toArray;\n\texports._isValid = _isValid;\n\texports._isObject = _isObject;\n\texports._isNestedPath = _isNestedPath;\n\texports._getNestedObject = _getNestedObject;\n\texports._getSegmentCount = _getSegmentCount;\n\texports._hasOwnNestedProperty = _hasOwnNestedProperty;\n\texports._addSync = _addSync;\n\texports._firebaseRefsMixin = _firebaseRefsMixin;\n\texports._updateSyncState = _updateSyncState;\n\texports._fsUpdateSyncState = _fsUpdateSyncState;\n\texports._addListener = _addListener;\n\texports._addFirestoreListener = _addFirestoreListener;\n\texports._setUnmountHandler = _setUnmountHandler;\n\texports._createNestedObject = _createNestedObject;\n\texports._handleError = _handleError;\n\texports._setData = _setData;\n\texports._fsSetUnmountHandler = _fsSetUnmountHandler;\n\texports._fsCreateRef = _fsCreateRef;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _removeBinding;\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _removeBinding(_ref, _ref2) {\n\t  var id = _ref.id,\n\t      context = _ref.context;\n\t  var refs = _ref2.refs,\n\t      listeners = _ref2.listeners,\n\t      syncs = _ref2.syncs;\n\n\t  var ref = refs.get(id);\n\t  var listener = listeners.get(id);\n\t  if (typeof ref !== 'undefined') {\n\t    ref.off('value', listener);\n\t    refs.delete(id);\n\t    listeners.delete(id);\n\t    if (syncs) {\n\t      var currentSyncs = syncs.get(context);\n\t      if (currentSyncs && currentSyncs.length > 0) {\n\t        var idx = currentSyncs.findIndex(function (item, index) {\n\t          return item.id === id;\n\t        });\n\t        /*istanbul ignore else */\n\t        if (idx !== -1) {\n\t          currentSyncs.splice(idx, 1);\n\t          syncs.set(context, currentSyncs);\n\t        }\n\t      }\n\t    }\n\t  }\n\t}\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fsRemoveBinding;\n\tfunction _fsRemoveBinding(_ref, _ref2) {\n\t  var id = _ref.id,\n\t      context = _ref.context;\n\t  var refs = _ref2.refs,\n\t      listeners = _ref2.listeners,\n\t      syncs = _ref2.syncs;\n\n\t  var unsubscribe = listeners.get(id);\n\t  if (typeof unsubscribe === 'function') {\n\t    unsubscribe();\n\t    refs.delete(id);\n\t    listeners.delete(id);\n\t    if (syncs) {\n\t      var currentSyncs = syncs.get(context);\n\t      if (currentSyncs && currentSyncs.length > 0) {\n\t        var idx = currentSyncs.findIndex(function (item, index) {\n\t          return item.id === id;\n\t        });\n\t        /*istanbul ignore else */\n\t        if (idx !== -1) {\n\t          currentSyncs.splice(idx, 1);\n\t          syncs.set(context, currentSyncs);\n\t        }\n\t      }\n\t    }\n\t  }\n\t}\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports._validateCollectionPath = exports._validateDocumentPath = exports._validateEndpoint = exports._validateDatabase = exports.optionValidators = undefined;\n\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n\tvar _utils = __webpack_require__(2);\n\n\tvar optionValidators = {\n\t  notObject: function notObject(options) {\n\t    if (!(0, _utils._isObject)(options)) {\n\t      (0, _utils._throwError)('The options argument must be an object. Instead, got ' + options, 'INVALID_OPTIONS');\n\t    }\n\t  },\n\t  context: function context(options) {\n\t    this.notObject(options);\n\t    if (!options.context || !(0, _utils._isObject)(options.context)) {\n\t      this.makeError('context', 'object', options.context);\n\t    }\n\t  },\n\t  state: function state(options) {\n\t    this.notObject(options);\n\t    if (!options.state || typeof options.state !== 'string') {\n\t      this.makeError('state', 'string', options.state);\n\t    }\n\t  },\n\t  then: function then(options) {\n\t    this.notObject(options);\n\t    if (typeof options.then === 'undefined' || typeof options.then !== 'function') {\n\t      this.makeError('then', 'function', options.then);\n\t    }\n\t  },\n\t  data: function data(options) {\n\t    this.notObject(options);\n\t    if (typeof options.data === 'undefined') {\n\t      this.makeError('data', 'ANY', options.data);\n\t    }\n\t  },\n\t  query: function query(options) {\n\t    this.notObject(options);\n\t    var validQueries = ['limitToFirst', 'limitToLast', 'orderByChild', 'orderByValue', 'orderByKey', 'orderByPriority', 'startAt', 'endAt', 'equalTo'];\n\t    var queries = options.queries;\n\t    for (var key in queries) {\n\t      if (queries.hasOwnProperty(key) && validQueries.indexOf(key) === -1) {\n\t        (0, _utils._throwError)('The query field must contain valid Firebase queries.  Expected one of [' + validQueries.join(', ') + ']. Instead, got ' + key, 'INVALID_OPTIONS');\n\t      }\n\t    }\n\t  },\n\t  defaultValue: function defaultValue(options) {\n\t    this.notObject(options);\n\t    if (options.hasOwnProperty('defaultValue')) {\n\t      if (!(0, _utils._isValid)(options.defaultValue)) {\n\t        (0, _utils._throwError)('The typeof defaultValue must be one of string, number, boolean, object.', 'INVALID_OPTIONS');\n\t      }\n\t    }\n\t  },\n\t  makeError: function makeError(prop, type, actual) {\n\t    (0, _utils._throwError)('The options argument must contain a ' + prop + ' property of type ' + type + '. Instead, got ' + actual, 'INVALID_OPTIONS');\n\t  }\n\t};\n\n\tvar _validateEndpoint = function _validateEndpoint(endpoint) {\n\t  if ((typeof endpoint === 'undefined' ? 'undefined' : _typeof(endpoint)) === 'object') {\n\t    if (endpoint.hasOwnProperty('firestore')) {\n\t      return;\n\t    }\n\t  }\n\t  var defaultError = 'The Firebase endpoint you are trying to listen to';\n\t  var errorMsg;\n\t  if (typeof endpoint !== 'string') {\n\t    errorMsg = defaultError + ' must be a string. Instead, got ' + endpoint;\n\t  } else if (endpoint.length === 0) {\n\t    errorMsg = defaultError + ' must be a non-empty string. Instead, got ' + endpoint;\n\t  } else if (endpoint.length > 768) {\n\t    errorMsg = defaultError + ' is too long to be stored in Firebase. It must be less than 768 characters.';\n\t  } else if (/^$|[\\[\\]\\#\\$]|.{1}[\\.]/.test(endpoint)) {\n\t    errorMsg = defaultError + ' in invalid. Paths must be non-empty strings and can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\".';\n\t  }\n\n\t  if (typeof errorMsg !== 'undefined') {\n\t    (0, _utils._throwError)(errorMsg, 'INVALID_ENDPOINT');\n\t  }\n\t};\n\n\tvar _validateDatabase = function _validateDatabase(db) {\n\t  var defaultError = 'Rebase.createClass failed.';\n\t  var errorMsg;\n\t  if ((typeof db === 'undefined' ? 'undefined' : _typeof(db)) !== 'object' || !db.ref && !db.collection) {\n\t    errorMsg = defaultError + ' Expected an initialized firebase or firestore database object.';\n\t  }\n\t  if (typeof errorMsg !== 'undefined') {\n\t    (0, _utils._throwError)(errorMsg, 'INVALID_CONFIG');\n\t  }\n\t};\n\n\tvar _validateDocumentPath = function _validateDocumentPath(path) {\n\t  if ((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path.hasOwnProperty('firestore')) return;\n\t  var defaultError = 'Invalid document path or reference.';\n\t  if (typeof path !== 'string') (0, _utils._throwError)(defaultError, 'INVALID_ENDPOINT');\n\t  var segmentCount = (0, _utils._getSegmentCount)(path);\n\t  if (segmentCount % 2 !== 0) (0, _utils._throwError)(defaultError, 'INVALID_ENDPOINT');\n\t};\n\n\tvar _validateCollectionPath = function _validateCollectionPath(path) {\n\t  if ((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path.hasOwnProperty('firestore')) return;\n\t  var defaultError = 'Invalid collection path or reference.';\n\t  if (typeof path !== 'string') (0, _utils._throwError)(defaultError, 'INVALID_ENDPOINT');\n\t  var segmentCount = (0, _utils._getSegmentCount)(path);\n\t  if (segmentCount % 2 === 0) (0, _utils._throwError)(defaultError, 'INVALID_ENDPOINT');\n\t};\n\n\texports.optionValidators = optionValidators;\n\texports._validateDatabase = _validateDatabase;\n\texports._validateEndpoint = _validateEndpoint;\n\texports._validateDocumentPath = _validateDocumentPath;\n\texports._validateCollectionPath = _validateCollectionPath;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _push;\n\n\tvar _validators = __webpack_require__(5);\n\n\tfunction _push(endpoint, options, db) {\n\t  (0, _validators._validateEndpoint)(endpoint);\n\t  _validators.optionValidators.data(options);\n\t  var ref = db.ref(endpoint);\n\t  var returnEndpoint;\n\t  if (options.then) {\n\t    returnEndpoint = ref.push(options.data, options.then);\n\t  } else {\n\t    returnEndpoint = ref.push(options.data);\n\t  }\n\t  return returnEndpoint;\n\t}\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fetch;\n\n\tvar _validators = __webpack_require__(5);\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _fetch(endpoint, options, db) {\n\t  (0, _validators._validateEndpoint)(endpoint);\n\t  _validators.optionValidators.defaultValue(options);\n\t  options.queries && _validators.optionValidators.query(options);\n\t  var ref = db.ref(endpoint);\n\t  ref = (0, _utils._addQueries)(ref, options.queries);\n\t  return ref.once('value').then(function (snapshot) {\n\t    var data = (0, _utils._prepareData)(snapshot, options);\n\t    if (options.then) {\n\t      options.then.call(options.context, data);\n\t    }\n\t    return data;\n\t  }).catch(function (err) {\n\t    //call onFailure callback if it exists otherwise rethrow error\n\t    if (options.onFailure && typeof options.onFailure === 'function') {\n\t      options.onFailure.call(options.context, err);\n\t    } else {\n\t      throw err;\n\t    }\n\t  });\n\t}\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _post;\n\n\tvar _validators = __webpack_require__(5);\n\n\tfunction _post(endpoint, options, db) {\n\t  (0, _validators._validateEndpoint)(endpoint);\n\t  _validators.optionValidators.data(options);\n\t  var ref = db.ref(endpoint);\n\t  if (options.then) {\n\t    return ref.set(options.data, options.then);\n\t  } else {\n\t    return ref.set(options.data);\n\t  }\n\t}\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _sync;\n\n\tvar _validators = __webpack_require__(5);\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _sync(endpoint, options, state) {\n\t  (0, _validators._validateEndpoint)(endpoint);\n\t  _validators.optionValidators.context(options);\n\t  _validators.optionValidators.state(options);\n\t  _validators.optionValidators.defaultValue(options);\n\t  options.queries && _validators.optionValidators.query(options);\n\t  options.then && (options.then.called = false);\n\t  options.onFailure = options.onFailure ? options.onFailure.bind(options.context) : null;\n\t  options.keepKeys = options.keepKeys && options.asArray;\n\n\t  //store reference to react's setState\n\t  if (_sync.called !== true) {\n\t    _sync.reactSetState = options.context.setState;\n\t    _sync.called = true;\n\t  }\n\t  options.reactSetState = _sync.reactSetState;\n\n\t  var ref = state.db.ref(endpoint);\n\t  var id = (0, _utils._createHash)(endpoint, 'syncState');\n\t  (0, _utils._firebaseRefsMixin)(id, ref, state.refs);\n\t  (0, _utils._addListener)(id, 'syncState', options, ref, state.listeners);\n\t  (0, _utils._setUnmountHandler)(options.context, id, state.refs, state.listeners, state.syncs);\n\t  var sync = {\n\t    id: id,\n\t    updateFirebase: _utils._updateSyncState.bind(null, ref, options.onFailure, options.keepKeys),\n\t    stateKey: options.state\n\t  };\n\t  (0, _utils._addSync)(options.context, sync, state.syncs);\n\n\t  options.context.setState = function (data, cb) {\n\t    //if setState is a function, call it first before syncing to fb\n\t    if (typeof data === 'function') {\n\t      return _sync.reactSetState.call(options.context, data, function () {\n\t        if (cb) cb.call(options.context);\n\t        return options.context.setState.call(options.context, options.context.state);\n\t      });\n\t    }\n\t    //if callback is supplied, call setState first before syncing to fb\n\t    if (typeof cb === 'function') {\n\t      return _sync.reactSetState.call(options.context, data, function () {\n\t        cb();\n\t        return options.context.setState.call(options.context, data);\n\t      });\n\t    }\n\t    var syncsToCall = state.syncs.get(this);\n\t    //if sync does not exist, call original Component.setState\n\t    if (!syncsToCall || syncsToCall.length === 0) {\n\t      return _sync.reactSetState.call(this, data, cb);\n\t    }\n\t    var syncedKeys = syncsToCall.map(function (sync) {\n\t      return {\n\t        key: sync.stateKey,\n\t        update: sync.updateFirebase,\n\t        nested: (0, _utils._isNestedPath)(sync.stateKey)\n\t      };\n\t    });\n\t    syncedKeys.forEach(function (syncedKey) {\n\t      if (syncedKey.nested === true) {\n\t        if ((0, _utils._hasOwnNestedProperty)(data, syncedKey.key)) {\n\t          var datum = (0, _utils._getNestedObject)(data, syncedKey.key);\n\t          syncedKey.update(datum);\n\t        }\n\t      } else if (data.hasOwnProperty(syncedKey.key)) {\n\t        syncedKey.update(data[syncedKey.key]);\n\t      }\n\t    });\n\t    var allKeys = Object.keys(data);\n\t    allKeys.forEach(function (key) {\n\t      var absent = !syncedKeys.find(function (syncedKey) {\n\t        var k = syncedKey.key;\n\t        if (syncedKey.nested === true) {\n\t          // Check with the root\n\t          k = syncedKey.key.split('.')[0];\n\t        }\n\t        return k === key;\n\t      });\n\n\t      if (absent) {\n\t        var update = {};\n\t        update[key] = data[key];\n\t        _sync.reactSetState.call(options.context, update, cb);\n\t      }\n\t    });\n\t  };\n\t  return (0, _utils._returnRef)(endpoint, 'syncState', id, options.context);\n\t}\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _bind;\n\n\tvar _validators = __webpack_require__(5);\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _bind(endpoint, options, invoker, state) {\n\t  (0, _validators._validateEndpoint)(endpoint);\n\t  _validators.optionValidators.context(options);\n\t  _validators.optionValidators.defaultValue(options);\n\t  invoker === 'listenTo' && _validators.optionValidators.then(options);\n\t  invoker === 'bindToState' && _validators.optionValidators.state(options);\n\t  options.queries && _validators.optionValidators.query(options);\n\t  options.then && (options.then.called = false);\n\n\t  var id = (0, _utils._createHash)(endpoint, invoker);\n\t  var ref = state.db.ref(endpoint);\n\t  (0, _utils._firebaseRefsMixin)(id, ref, state.refs);\n\t  (0, _utils._addListener)(id, invoker, options, ref, state.listeners);\n\t  (0, _utils._setUnmountHandler)(options.context, id, state.refs, state.listeners, state.syncs);\n\t  return (0, _utils._returnRef)(endpoint, invoker, id, options.context);\n\t}\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _update;\n\n\tvar _validators = __webpack_require__(5);\n\n\tfunction _update(endpoint, options, state) {\n\t  (0, _validators._validateEndpoint)(endpoint);\n\t  _validators.optionValidators.data(options);\n\t  var ref = state.db.ref(endpoint);\n\t  if (options.then) {\n\t    return ref.update(options.data, options.then);\n\t  } else {\n\t    return ref.update(options.data);\n\t  }\n\t}\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _reset;\n\tfunction _reset(state) {\n\t  state.refs.forEach(function (ref, id) {\n\t    ref.off('value', state.listeners.get(id));\n\t  });\n\t  state.listeners = new Map();\n\t  state.refs = new Map();\n\t  state.syncs = new WeakMap();\n\t  return null;\n\t}\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports) {\n\n\t\"use strict\";\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\n\texports.default = function (endpoint, db, fn) {\n\t  return db.ref().child(endpoint).remove(fn);\n\t};\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fsSync;\n\n\tvar _validators = __webpack_require__(5);\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _fsSync(document, options, state) {\n\t  //validate arguments\n\t  (0, _validators._validateDocumentPath)(document);\n\t  _validators.optionValidators.context(options);\n\t  _validators.optionValidators.state(options);\n\t  options.then && (options.then.called = false);\n\t  //store reference to react's setState\n\t  if (_fsSync.called !== true) {\n\t    _fsSync.reactSetState = options.context.setState;\n\t    _fsSync.called = true;\n\t  }\n\t  options.reactSetState = _fsSync.reactSetState;\n\n\t  var id = (0, _utils._createHash)(document, 'syncDoc');\n\t  var ref = (0, _utils._fsCreateRef)(document, state.db);\n\t  (0, _utils._firebaseRefsMixin)(id, ref, state.refs);\n\t  (0, _utils._addFirestoreListener)(id, 'syncDoc', options, ref, state.listeners);\n\t  (0, _utils._fsSetUnmountHandler)(options.context, id, state.refs, state.listeners, state.syncs);\n\t  var sync = {\n\t    id: id,\n\t    updateFirebase: _utils._fsUpdateSyncState.bind(null, ref),\n\t    stateKey: options.state\n\t  };\n\t  (0, _utils._addSync)(options.context, sync, state.syncs);\n\t  options.context.setState = function (data, cb) {\n\t    //if setState is a function, call it first before syncing to fb\n\t    if (typeof data === 'function') {\n\t      return _fsSync.reactSetState.call(options.context, data, function () {\n\t        if (cb) cb.call(options.context);\n\t        return options.context.setState.call(options.context, options.context.state);\n\t      });\n\t    }\n\t    //if callback is supplied, call setState first before syncing to fb\n\t    if (typeof cb === 'function') {\n\t      return _fsSync.reactSetState.call(options.context, data, function () {\n\t        cb();\n\t        return options.context.setState.call(options.context, data);\n\t      });\n\t    }\n\t    var syncsToCall = state.syncs.get(this);\n\t    //if sync does not exist, call original Component.setState\n\t    if (!syncsToCall || syncsToCall.length === 0) {\n\t      return _fsSync.reactSetState.call(this, data, cb);\n\t    }\n\t    //send the update of synced keys to firestore\n\t    var syncedKeys = syncsToCall.map(function (sync) {\n\t      return {\n\t        key: sync.stateKey,\n\t        update: sync.updateFirebase\n\t      };\n\t    });\n\t    syncedKeys.forEach(function (syncedKey) {\n\t      if (data[syncedKey.key]) {\n\t        syncedKey.update(data[syncedKey.key]);\n\t      }\n\t    });\n\t    //send the update of all other keys through setState\n\t    var allKeys = Object.keys(data);\n\t    allKeys.forEach(function (key) {\n\t      var absent = !syncedKeys.find(function (syncedKey) {\n\t        return syncedKey.key === key;\n\t      });\n\t      if (absent) {\n\t        var update = {};\n\t        update[key] = data[key];\n\t        _fsSync.reactSetState.call(options.context, function (currentState) {\n\t          return Object.assign(currentState, update);\n\t        }, cb);\n\t      }\n\t    });\n\t  };\n\t  return (0, _utils._returnRef)(document, 'syncDoc', id, options.context);\n\t}\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fsBind;\n\n\tvar _validators = __webpack_require__(5);\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _fsBind(path, options, invoker, state) {\n\t  _validators.optionValidators.context(options);\n\t  options.then && (options.then.called = false);\n\t  if (invoker === 'bindDoc') {\n\t    (0, _validators._validateDocumentPath)(path);\n\t  }\n\t  if (invoker === 'bindCollection') {\n\t    _validators.optionValidators.state(options);\n\t    (0, _validators._validateCollectionPath)(path);\n\t  }\n\t  if (invoker === 'listenToDoc') {\n\t    (0, _validators._validateDocumentPath)(path);\n\t    _validators.optionValidators.then(options);\n\t  }\n\t  if (invoker === 'listenToCollection') {\n\t    (0, _validators._validateCollectionPath)(path);\n\t    _validators.optionValidators.then(options);\n\t  }\n\t  var ref = (0, _utils._fsCreateRef)(path, state.db);\n\t  var id = (0, _utils._createHash)(path, invoker);\n\t  (0, _utils._firebaseRefsMixin)(id, ref, state.refs);\n\t  (0, _utils._addFirestoreListener)(id, invoker, options, ref, state.listeners);\n\t  (0, _utils._fsSetUnmountHandler)(options.context, id, state.refs, state.listeners, state.syncs);\n\t  return (0, _utils._returnRef)(path, invoker, id, options.context);\n\t}\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fsGet;\n\n\tvar _utils = __webpack_require__(2);\n\n\tvar _validators = __webpack_require__(5);\n\n\tfunction _fsGet(endpoint) {\n\t  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t  var db = arguments[2];\n\n\t  (0, _validators._validateEndpoint)(endpoint);\n\t  var ref = (0, _utils._fsCreateRef)(endpoint, db);\n\t  //check if ref is a collection\n\t  var isCollection = !!ref.add;\n\t  ref = (0, _utils._addFirestoreQuery)(ref, options.query);\n\t  return ref.get().then(function (snapshot) {\n\t    if (isCollection && !snapshot.empty || !isCollection && snapshot.exists) {\n\t      return (0, _utils._fsPrepareData)(snapshot, options, isCollection);\n\t    } else {\n\t      return Promise.reject(new Error('No Result'));\n\t    }\n\t  });\n\t}\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fsRemoveDoc;\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _fsRemoveDoc(path, db) {\n\t  var ref = (0, _utils._fsCreateRef)(path, db);\n\t  return ref.delete();\n\t}\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fsAddToCollection;\n\n\tvar _validators = __webpack_require__(5);\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _fsAddToCollection(path, doc, db, key) {\n\t  (0, _validators._validateCollectionPath)(path);\n\t  var ref = (0, _utils._fsCreateRef)(path, db);\n\t  if (key) {\n\t    return ref.doc(key).set(doc);\n\t  }\n\t  return ref.add(doc);\n\t}\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fsRemoveFromCollection;\n\n\tvar _validators = __webpack_require__(5);\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _fsRemoveFromCollection(path, db) {\n\t  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n\t  (0, _validators._validateCollectionPath)(path);\n\t  var ref = (0, _utils._fsCreateRef)(path, db);\n\t  ref = (0, _utils._addFirestoreQuery)(ref, options.query);\n\t  return ref.get().then(function (snapshot) {\n\t    if (!snapshot.empty) {\n\t      var batch = db.batch();\n\t      snapshot.forEach(function (doc) {\n\t        batch.delete(doc.ref);\n\t      });\n\t      return batch.commit();\n\t    }\n\t  });\n\t}\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fsUpdateDoc;\n\n\tvar _validators = __webpack_require__(5);\n\n\tvar _utils = __webpack_require__(2);\n\n\tfunction _fsUpdateDoc(document, data, db) {\n\t  (0, _validators._validateDocumentPath)(document);\n\t  var ref = (0, _utils._fsCreateRef)(document, db);\n\t  return ref.update(data);\n\t}\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports) {\n\n\t\"use strict\";\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = _fsReset;\n\tfunction _fsReset(state) {\n\t  state.listeners.forEach(function (unsubscribe, id) {\n\t    unsubscribe();\n\t  });\n\t  state.listeners = new Map();\n\t  state.refs = new Map();\n\t  state.syncs = new WeakMap();\n\t  return null;\n\t}\n\n/***/ })\n/******/ ])\n});\n;","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { jsonEval, stringify } from '@firebase/util';\n\n/**\n * Wraps a DOM Storage object and:\n * - automatically encode objects as JSON strings before storing them to allow us to store arbitrary types.\n * - prefixes names with \"firebase:\" to avoid collisions with app data.\n *\n * We automatically (see storage.js) create two such wrappers, one for sessionStorage,\n * and one for localStorage.\n *\n * @constructor\n */\nexport class DOMStorageWrapper {\n  // Use a prefix to avoid collisions with other stuff saved by the app.\n  private prefix_ = 'firebase:';\n\n  /**\n   * @param {Storage} domStorage_ The underlying storage object (e.g. localStorage or sessionStorage)\n   */\n  constructor(private domStorage_: Storage) {}\n\n  /**\n   * @param {string} key The key to save the value under\n   * @param {?Object} value The value being stored, or null to remove the key.\n   */\n  set(key: string, value: any | null) {\n    if (value == null) {\n      this.domStorage_.removeItem(this.prefixedName_(key));\n    } else {\n      this.domStorage_.setItem(this.prefixedName_(key), stringify(value));\n    }\n  }\n\n  /**\n   * @param {string} key\n   * @return {*} The value that was stored under this key, or null\n   */\n  get(key: string): any {\n    const storedVal = this.domStorage_.getItem(this.prefixedName_(key));\n    if (storedVal == null) {\n      return null;\n    } else {\n      return jsonEval(storedVal);\n    }\n  }\n\n  /**\n   * @param {string} key\n   */\n  remove(key: string) {\n    this.domStorage_.removeItem(this.prefixedName_(key));\n  }\n\n  isInMemoryStorage: boolean;\n\n  /**\n   * @param {string} name\n   * @return {string}\n   */\n  prefixedName_(name: string): string {\n    return this.prefix_ + name;\n  }\n\n  toString(): string {\n    return this.domStorage_.toString();\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { contains } from '@firebase/util';\n\n/**\n * An in-memory storage implementation that matches the API of DOMStorageWrapper\n * (TODO: create interface for both to implement).\n *\n * @constructor\n */\nexport class MemoryStorage {\n  private cache_: { [k: string]: any } = {};\n\n  set(key: string, value: any | null) {\n    if (value == null) {\n      delete this.cache_[key];\n    } else {\n      this.cache_[key] = value;\n    }\n  }\n\n  get(key: string): any {\n    if (contains(this.cache_, key)) {\n      return this.cache_[key];\n    }\n    return null;\n  }\n\n  remove(key: string) {\n    delete this.cache_[key];\n  }\n\n  isInMemoryStorage = true;\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DOMStorageWrapper } from './DOMStorageWrapper';\nimport { MemoryStorage } from './MemoryStorage';\n\ndeclare const window: any;\n\n/**\n * Helper to create a DOMStorageWrapper or else fall back to MemoryStorage.\n * TODO: Once MemoryStorage and DOMStorageWrapper have a shared interface this method annotation should change\n * to reflect this type\n *\n * @param {string} domStorageName Name of the underlying storage object\n *   (e.g. 'localStorage' or 'sessionStorage').\n * @return {?} Turning off type information until a common interface is defined.\n */\nconst createStoragefor = function(\n  domStorageName: string\n): DOMStorageWrapper | MemoryStorage {\n  try {\n    // NOTE: just accessing \"localStorage\" or \"window['localStorage']\" may throw a security exception,\n    // so it must be inside the try/catch.\n    if (\n      typeof window !== 'undefined' &&\n      typeof window[domStorageName] !== 'undefined'\n    ) {\n      // Need to test cache. Just because it's here doesn't mean it works\n      const domStorage = window[domStorageName];\n      domStorage.setItem('firebase:sentinel', 'cache');\n      domStorage.removeItem('firebase:sentinel');\n      return new DOMStorageWrapper(domStorage);\n    }\n  } catch (e) {}\n\n  // Failed to create wrapper.  Just return in-memory storage.\n  // TODO: log?\n  return new MemoryStorage();\n};\n\n/** A storage object that lasts across sessions */\nexport const PersistentStorage = createStoragefor('localStorage');\n\n/** A storage object that only lasts one session */\nexport const SessionStorage = createStoragefor('sessionStorage');\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Query } from '../../api/Query';\n\ndeclare const window: any;\ndeclare const Windows: any;\n\nimport { assert } from '@firebase/util';\nimport { base64 } from '@firebase/util';\nimport { Sha1 } from '@firebase/util';\nimport { stringToByteArray } from '@firebase/util';\nimport { stringify } from '@firebase/util';\nimport { SessionStorage } from '../storage/storage';\nimport { isNodeSdk } from '@firebase/util';\nimport { Logger, LogLevel } from '@firebase/logger';\n\nconst logClient = new Logger('@firebase/database');\n\n/**\n * Returns a locally-unique ID (generated by just incrementing up from 0 each time its called).\n * @type {function(): number} Generated ID.\n */\nexport const LUIDGenerator: () => number = (function() {\n  let id = 1;\n  return function() {\n    return id++;\n  };\n})();\n\n/**\n * Sha1 hash of the input string\n * @param {!string} str The string to hash\n * @return {!string} The resulting hash\n */\nexport const sha1 = function(str: string): string {\n  const utf8Bytes = stringToByteArray(str);\n  const sha1 = new Sha1();\n  sha1.update(utf8Bytes);\n  const sha1Bytes = sha1.digest();\n  return base64.encodeByteArray(sha1Bytes);\n};\n\n/**\n * @param {...*} var_args\n * @return {string}\n * @private\n */\nconst buildLogMessage_ = function(...var_args: any[]): string {\n  let message = '';\n  for (let i = 0; i < var_args.length; i++) {\n    if (\n      Array.isArray(var_args[i]) ||\n      (var_args[i] &&\n        typeof var_args[i] === 'object' &&\n        typeof var_args[i].length === 'number')\n    ) {\n      message += buildLogMessage_.apply(null, var_args[i]);\n    } else if (typeof var_args[i] === 'object') {\n      message += stringify(var_args[i]);\n    } else {\n      message += var_args[i];\n    }\n    message += ' ';\n  }\n\n  return message;\n};\n\n/**\n * Use this for all debug messages in Firebase.\n * @type {?function(string)}\n */\nexport let logger: ((a: string) => void) | null = null;\n\n/**\n * Flag to check for log availability on first log message\n * @type {boolean}\n * @private\n */\nlet firstLog_ = true;\n\n/**\n * The implementation of Firebase.enableLogging (defined here to break dependencies)\n * @param {boolean|?function(string)} logger_ A flag to turn on logging, or a custom logger\n * @param {boolean=} persistent Whether or not to persist logging settings across refreshes\n */\nexport const enableLogging = function(\n  logger_?: boolean | ((a: string) => void) | null,\n  persistent?: boolean\n) {\n  assert(\n    !persistent || logger_ === true || logger_ === false,\n    \"Can't turn on custom loggers persistently.\"\n  );\n  if (logger_ === true) {\n    logClient.logLevel = LogLevel.VERBOSE;\n    logger = logClient.log.bind(logClient);\n    if (persistent) SessionStorage.set('logging_enabled', true);\n  } else if (typeof logger_ === 'function') {\n    logger = logger_;\n  } else {\n    logger = null;\n    SessionStorage.remove('logging_enabled');\n  }\n};\n\n/**\n *\n * @param {...(string|Arguments)} var_args\n */\nexport const log = function(...var_args: string[]) {\n  if (firstLog_ === true) {\n    firstLog_ = false;\n    if (logger === null && SessionStorage.get('logging_enabled') === true)\n      enableLogging(true);\n  }\n\n  if (logger) {\n    const message = buildLogMessage_.apply(null, var_args);\n    logger(message);\n  }\n};\n\n/**\n * @param {!string} prefix\n * @return {function(...[*])}\n */\nexport const logWrapper = function(\n  prefix: string\n): (...var_args: any[]) => void {\n  return function(...var_args: any[]) {\n    log(prefix, ...var_args);\n  };\n};\n\n/**\n * @param {...string} var_args\n */\nexport const error = function(...var_args: string[]) {\n  const message = 'FIREBASE INTERNAL ERROR: ' + buildLogMessage_(...var_args);\n  logClient.error(message);\n};\n\n/**\n * @param {...string} var_args\n */\nexport const fatal = function(...var_args: string[]) {\n  const message = `FIREBASE FATAL ERROR: ${buildLogMessage_(...var_args)}`;\n  logClient.error(message);\n  throw new Error(message);\n};\n\n/**\n * @param {...*} var_args\n */\nexport const warn = function(...var_args: any[]) {\n  const message = 'FIREBASE WARNING: ' + buildLogMessage_(...var_args);\n  logClient.warn(message);\n};\n\n/**\n * Logs a warning if the containing page uses https. Called when a call to new Firebase\n * does not use https.\n */\nexport const warnIfPageIsSecure = function() {\n  // Be very careful accessing browser globals. Who knows what may or may not exist.\n  if (\n    typeof window !== 'undefined' &&\n    window.location &&\n    window.location.protocol &&\n    window.location.protocol.indexOf('https:') !== -1\n  ) {\n    warn(\n      'Insecure Firebase access from a secure page. ' +\n        'Please use https in calls to new Firebase().'\n    );\n  }\n};\n\n/**\n * @param {!String} methodName\n */\nexport const warnAboutUnsupportedMethod = function(methodName: string) {\n  warn(\n    methodName +\n      ' is unsupported and will likely change soon.  ' +\n      'Please do not use.'\n  );\n};\n\n/**\n * Returns true if data is NaN, or +/- Infinity.\n * @param {*} data\n * @return {boolean}\n */\nexport const isInvalidJSONNumber = function(data: any): boolean {\n  return (\n    typeof data === 'number' &&\n    (data != data || // NaN\n      data == Number.POSITIVE_INFINITY ||\n      data == Number.NEGATIVE_INFINITY)\n  );\n};\n\n/**\n * @param {function()} fn\n */\nexport const executeWhenDOMReady = function(fn: () => void) {\n  if (isNodeSdk() || document.readyState === 'complete') {\n    fn();\n  } else {\n    // Modeled after jQuery. Try DOMContentLoaded and onreadystatechange (which\n    // fire before onload), but fall back to onload.\n\n    let called = false;\n    let wrappedFn = function() {\n      if (!document.body) {\n        setTimeout(wrappedFn, Math.floor(10));\n        return;\n      }\n\n      if (!called) {\n        called = true;\n        fn();\n      }\n    };\n\n    if (document.addEventListener) {\n      document.addEventListener('DOMContentLoaded', wrappedFn, false);\n      // fallback to onload.\n      window.addEventListener('load', wrappedFn, false);\n    } else if ((document as any).attachEvent) {\n      // IE.\n      (document as any).attachEvent('onreadystatechange', function() {\n        if (document.readyState === 'complete') wrappedFn();\n      });\n      // fallback to onload.\n      (window as any).attachEvent('onload', wrappedFn);\n\n      // jQuery has an extra hack for IE that we could employ (based on\n      // http://javascript.nwbox.com/IEContentLoaded/) But it looks really old.\n      // I'm hoping we don't need it.\n    }\n  }\n};\n\n/**\n * Minimum key name. Invalid for actual data, used as a marker to sort before any valid names\n * @type {!string}\n */\nexport const MIN_NAME = '[MIN_NAME]';\n\n/**\n * Maximum key name. Invalid for actual data, used as a marker to sort above any valid names\n * @type {!string}\n */\nexport const MAX_NAME = '[MAX_NAME]';\n\n/**\n * Compares valid Firebase key names, plus min and max name\n * @param {!string} a\n * @param {!string} b\n * @return {!number}\n */\nexport const nameCompare = function(a: string, b: string): number {\n  if (a === b) {\n    return 0;\n  } else if (a === MIN_NAME || b === MAX_NAME) {\n    return -1;\n  } else if (b === MIN_NAME || a === MAX_NAME) {\n    return 1;\n  } else {\n    const aAsInt = tryParseInt(a),\n      bAsInt = tryParseInt(b);\n\n    if (aAsInt !== null) {\n      if (bAsInt !== null) {\n        return aAsInt - bAsInt == 0 ? a.length - b.length : aAsInt - bAsInt;\n      } else {\n        return -1;\n      }\n    } else if (bAsInt !== null) {\n      return 1;\n    } else {\n      return a < b ? -1 : 1;\n    }\n  }\n};\n\n/**\n * @param {!string} a\n * @param {!string} b\n * @return {!number} comparison result.\n */\nexport const stringCompare = function(a: string, b: string): number {\n  if (a === b) {\n    return 0;\n  } else if (a < b) {\n    return -1;\n  } else {\n    return 1;\n  }\n};\n\n/**\n * @param {string} key\n * @param {Object} obj\n * @return {*}\n */\nexport const requireKey = function(\n  key: string,\n  obj: { [k: string]: any }\n): any {\n  if (obj && key in obj) {\n    return obj[key];\n  } else {\n    throw new Error(\n      'Missing required key (' + key + ') in object: ' + stringify(obj)\n    );\n  }\n};\n\n/**\n * @param {*} obj\n * @return {string}\n */\nexport const ObjectToUniqueKey = function(obj: any): string {\n  if (typeof obj !== 'object' || obj === null) return stringify(obj);\n\n  const keys = [];\n  for (let k in obj) {\n    keys.push(k);\n  }\n\n  // Export as json, but with the keys sorted.\n  keys.sort();\n  let key = '{';\n  for (let i = 0; i < keys.length; i++) {\n    if (i !== 0) key += ',';\n    key += stringify(keys[i]);\n    key += ':';\n    key += ObjectToUniqueKey(obj[keys[i]]);\n  }\n\n  key += '}';\n  return key;\n};\n\n/**\n * Splits a string into a number of smaller segments of maximum size\n * @param {!string} str The string\n * @param {!number} segsize The maximum number of chars in the string.\n * @return {Array.<string>} The string, split into appropriately-sized chunks\n */\nexport const splitStringBySize = function(\n  str: string,\n  segsize: number\n): string[] {\n  const len = str.length;\n\n  if (len <= segsize) {\n    return [str];\n  }\n\n  const dataSegs = [];\n  for (let c = 0; c < len; c += segsize) {\n    if (c + segsize > len) {\n      dataSegs.push(str.substring(c, len));\n    } else {\n      dataSegs.push(str.substring(c, c + segsize));\n    }\n  }\n  return dataSegs;\n};\n\n/**\n * Apply a function to each (key, value) pair in an object or\n * apply a function to each (index, value) pair in an array\n * @param obj The object or array to iterate over\n * @param fn The function to apply\n */\nexport function each(obj: object, fn: (k: string, v: any) => void) {\n  for (const key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      fn(key, obj[key]);\n    }\n  }\n}\n\n/**\n * Like goog.bind, but doesn't bother to create a closure if opt_context is null/undefined.\n * @param {function(*)} callback Callback function.\n * @param {?Object=} context Optional context to bind to.\n * @return {function(*)}\n */\nexport const bindCallback = function(\n  callback: (a: any) => void,\n  context?: object | null\n): Function {\n  return context ? callback.bind(context) : callback;\n};\n\n/**\n * Borrowed from http://hg.secondlife.com/llsd/src/tip/js/typedarray.js (MIT License)\n * I made one modification at the end and removed the NaN / Infinity\n * handling (since it seemed broken [caused an overflow] and we don't need it).  See MJL comments.\n * @param {!number} v A double\n * @return {string}\n */\nexport const doubleToIEEE754String = function(v: number): string {\n  assert(!isInvalidJSONNumber(v), 'Invalid JSON number'); // MJL\n\n  const ebits = 11,\n    fbits = 52;\n  let bias = (1 << (ebits - 1)) - 1,\n    s,\n    e,\n    f,\n    ln,\n    i,\n    bits,\n    str;\n\n  // Compute sign, exponent, fraction\n  // Skip NaN / Infinity handling --MJL.\n  if (v === 0) {\n    e = 0;\n    f = 0;\n    s = 1 / v === -Infinity ? 1 : 0;\n  } else {\n    s = v < 0;\n    v = Math.abs(v);\n\n    if (v >= Math.pow(2, 1 - bias)) {\n      // Normalized\n      ln = Math.min(Math.floor(Math.log(v) / Math.LN2), bias);\n      e = ln + bias;\n      f = Math.round(v * Math.pow(2, fbits - ln) - Math.pow(2, fbits));\n    } else {\n      // Denormalized\n      e = 0;\n      f = Math.round(v / Math.pow(2, 1 - bias - fbits));\n    }\n  }\n\n  // Pack sign, exponent, fraction\n  bits = [];\n  for (i = fbits; i; i -= 1) {\n    bits.push(f % 2 ? 1 : 0);\n    f = Math.floor(f / 2);\n  }\n  for (i = ebits; i; i -= 1) {\n    bits.push(e % 2 ? 1 : 0);\n    e = Math.floor(e / 2);\n  }\n  bits.push(s ? 1 : 0);\n  bits.reverse();\n  str = bits.join('');\n\n  // Return the data as a hex string. --MJL\n  let hexByteString = '';\n  for (i = 0; i < 64; i += 8) {\n    let hexByte = parseInt(str.substr(i, 8), 2).toString(16);\n    if (hexByte.length === 1) hexByte = '0' + hexByte;\n    hexByteString = hexByteString + hexByte;\n  }\n  return hexByteString.toLowerCase();\n};\n\n/**\n * Used to detect if we're in a Chrome content script (which executes in an\n * isolated environment where long-polling doesn't work).\n * @return {boolean}\n */\nexport const isChromeExtensionContentScript = function(): boolean {\n  return !!(\n    typeof window === 'object' &&\n    window['chrome'] &&\n    window['chrome']['extension'] &&\n    !/^chrome/.test(window.location.href)\n  );\n};\n\n/**\n * Used to detect if we're in a Windows 8 Store app.\n * @return {boolean}\n */\nexport const isWindowsStoreApp = function(): boolean {\n  // Check for the presence of a couple WinRT globals\n  return typeof Windows === 'object' && typeof Windows.UI === 'object';\n};\n\n/**\n * Converts a server error code to a Javascript Error\n * @param {!string} code\n * @param {!Query} query\n * @return {Error}\n */\nexport const errorForServerCode = function(code: string, query: Query): Error {\n  let reason = 'Unknown Error';\n  if (code === 'too_big') {\n    reason =\n      'The data requested exceeds the maximum size ' +\n      'that can be accessed with a single request.';\n  } else if (code == 'permission_denied') {\n    reason = \"Client doesn't have permission to access the desired data.\";\n  } else if (code == 'unavailable') {\n    reason = 'The service is unavailable';\n  }\n\n  const error = new Error(\n    code + ' at ' + query.path.toString() + ': ' + reason\n  );\n  (error as any).code = code.toUpperCase();\n  return error;\n};\n\n/**\n * Used to test for integer-looking strings\n * @type {RegExp}\n * @private\n */\nexport const INTEGER_REGEXP_ = new RegExp('^-?(0*)\\\\d{1,10}$');\n\n/**\n * If the string contains a 32-bit integer, return it.  Else return null.\n * @param {!string} str\n * @return {?number}\n */\nexport const tryParseInt = function(str: string): number | null {\n  if (INTEGER_REGEXP_.test(str)) {\n    const intVal = Number(str);\n    if (intVal >= -2147483648 && intVal <= 2147483647) {\n      return intVal;\n    }\n  }\n  return null;\n};\n\n/**\n * Helper to run some code but catch any exceptions and re-throw them later.\n * Useful for preventing user callbacks from breaking internal code.\n *\n * Re-throwing the exception from a setTimeout is a little evil, but it's very\n * convenient (we don't have to try to figure out when is a safe point to\n * re-throw it), and the behavior seems reasonable:\n *\n * * If you aren't pausing on exceptions, you get an error in the console with\n *   the correct stack trace.\n * * If you're pausing on all exceptions, the debugger will pause on your\n *   exception and then again when we rethrow it.\n * * If you're only pausing on uncaught exceptions, the debugger will only pause\n *   on us re-throwing it.\n *\n * @param {!function()} fn The code to guard.\n */\nexport const exceptionGuard = function(fn: () => void) {\n  try {\n    fn();\n  } catch (e) {\n    // Re-throw exception when it's safe.\n    setTimeout(function() {\n      // It used to be that \"throw e\" would result in a good console error with\n      // relevant context, but as of Chrome 39, you just get the firebase.js\n      // file/line number where we re-throw it, which is useless. So we log\n      // e.stack explicitly.\n      const stack = e.stack || '';\n      warn('Exception was thrown by user callback.', stack);\n      throw e;\n    }, Math.floor(0));\n  }\n};\n\n/**\n * Helper function to safely call opt_callback with the specified arguments.  It:\n * 1. Turns into a no-op if opt_callback is null or undefined.\n * 2. Wraps the call inside exceptionGuard to prevent exceptions from breaking our state.\n *\n * @param {?Function=} callback Optional onComplete callback.\n * @param {...*} var_args Arbitrary args to be passed to opt_onComplete\n */\nexport const callUserCallback = function(\n  callback?: Function | null,\n  ...var_args: any[]\n) {\n  if (typeof callback === 'function') {\n    exceptionGuard(function() {\n      callback(...var_args);\n    });\n  }\n};\n\n/**\n * @return {boolean} true if we think we're currently being crawled.\n */\nexport const beingCrawled = function(): boolean {\n  const userAgent =\n    (typeof window === 'object' &&\n      window['navigator'] &&\n      window['navigator']['userAgent']) ||\n    '';\n\n  // For now we whitelist the most popular crawlers.  We should refine this to be the set of crawlers we\n  // believe to support JavaScript/AJAX rendering.\n  // NOTE: Google Webmaster Tools doesn't really belong, but their \"This is how a visitor to your website\n  // would have seen the page\" is flaky if we don't treat it as a crawler.\n  return (\n    userAgent.search(\n      /googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i\n    ) >= 0\n  );\n};\n\n/**\n * Export a property of an object using a getter function.\n *\n * @param {!Object} object\n * @param {string} name\n * @param {!function(): *} fnGet\n */\nexport const exportPropGetter = function(\n  object: Object,\n  name: string,\n  fnGet: () => any\n) {\n  Object.defineProperty(object, name, { get: fnGet });\n};\n\n/**\n * Same as setTimeout() except on Node.JS it will /not/ prevent the process from exiting.\n *\n * It is removed with clearTimeout() as normal.\n *\n * @param {Function} fn Function to run.\n * @param {number} time Milliseconds to wait before running.\n * @return {number|Object} The setTimeout() return value.\n */\nexport const setTimeoutNonBlocking = function(\n  fn: Function,\n  time: number\n): number | Object {\n  const timeout: number | Object = setTimeout(fn, time);\n  if (typeof timeout === 'object' && (timeout as any)['unref']) {\n    (timeout as any)['unref']();\n  }\n  return timeout;\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { nameCompare } from './util';\nimport { stringLength } from '@firebase/util';\n/**\n * An immutable object representing a parsed path.  It's immutable so that you\n * can pass them around to other functions without worrying about them changing\n * it.\n */\n\nexport class Path {\n  private pieces_: string[];\n  private pieceNum_: number;\n\n  /**\n   * Singleton to represent an empty path\n   *\n   * @const\n   */\n  static get Empty() {\n    return new Path('');\n  }\n\n  /**\n   * @param {string|Array.<string>} pathOrString Path string to parse,\n   *      or another path, or the raw tokens array\n   * @param {number=} pieceNum\n   */\n  constructor(pathOrString: string | string[], pieceNum?: number) {\n    if (pieceNum === void 0) {\n      this.pieces_ = (pathOrString as string).split('/');\n\n      // Remove empty pieces.\n      let copyTo = 0;\n      for (let i = 0; i < this.pieces_.length; i++) {\n        if (this.pieces_[i].length > 0) {\n          this.pieces_[copyTo] = this.pieces_[i];\n          copyTo++;\n        }\n      }\n      this.pieces_.length = copyTo;\n\n      this.pieceNum_ = 0;\n    } else {\n      this.pieces_ = pathOrString as string[];\n      this.pieceNum_ = pieceNum;\n    }\n  }\n\n  getFront(): string | null {\n    if (this.pieceNum_ >= this.pieces_.length) return null;\n\n    return this.pieces_[this.pieceNum_];\n  }\n\n  /**\n   * @return {number} The number of segments in this path\n   */\n  getLength(): number {\n    return this.pieces_.length - this.pieceNum_;\n  }\n\n  /**\n   * @return {!Path}\n   */\n  popFront(): Path {\n    let pieceNum = this.pieceNum_;\n    if (pieceNum < this.pieces_.length) {\n      pieceNum++;\n    }\n    return new Path(this.pieces_, pieceNum);\n  }\n\n  /**\n   * @return {?string}\n   */\n  getBack(): string | null {\n    if (this.pieceNum_ < this.pieces_.length)\n      return this.pieces_[this.pieces_.length - 1];\n\n    return null;\n  }\n\n  toString(): string {\n    let pathString = '';\n    for (let i = this.pieceNum_; i < this.pieces_.length; i++) {\n      if (this.pieces_[i] !== '') pathString += '/' + this.pieces_[i];\n    }\n\n    return pathString || '/';\n  }\n\n  toUrlEncodedString(): string {\n    let pathString = '';\n    for (let i = this.pieceNum_; i < this.pieces_.length; i++) {\n      if (this.pieces_[i] !== '')\n        pathString += '/' + encodeURIComponent(String(this.pieces_[i]));\n    }\n\n    return pathString || '/';\n  }\n\n  /**\n   * Shallow copy of the parts of the path.\n   *\n   * @param {number=} begin\n   * @return {!Array<string>}\n   */\n  slice(begin: number = 0): string[] {\n    return this.pieces_.slice(this.pieceNum_ + begin);\n  }\n\n  /**\n   * @return {?Path}\n   */\n  parent(): Path | null {\n    if (this.pieceNum_ >= this.pieces_.length) return null;\n\n    const pieces = [];\n    for (let i = this.pieceNum_; i < this.pieces_.length - 1; i++)\n      pieces.push(this.pieces_[i]);\n\n    return new Path(pieces, 0);\n  }\n\n  /**\n   * @param {string|!Path} childPathObj\n   * @return {!Path}\n   */\n  child(childPathObj: string | Path): Path {\n    const pieces = [];\n    for (let i = this.pieceNum_; i < this.pieces_.length; i++)\n      pieces.push(this.pieces_[i]);\n\n    if (childPathObj instanceof Path) {\n      for (\n        let i = childPathObj.pieceNum_;\n        i < childPathObj.pieces_.length;\n        i++\n      ) {\n        pieces.push(childPathObj.pieces_[i]);\n      }\n    } else {\n      const childPieces = childPathObj.split('/');\n      for (let i = 0; i < childPieces.length; i++) {\n        if (childPieces[i].length > 0) pieces.push(childPieces[i]);\n      }\n    }\n\n    return new Path(pieces, 0);\n  }\n\n  /**\n   * @return {boolean} True if there are no segments in this path\n   */\n  isEmpty(): boolean {\n    return this.pieceNum_ >= this.pieces_.length;\n  }\n\n  /**\n   * @param {!Path} outerPath\n   * @param {!Path} innerPath\n   * @return {!Path} The path from outerPath to innerPath\n   */\n  static relativePath(outerPath: Path, innerPath: Path): Path {\n    const outer = outerPath.getFront(),\n      inner = innerPath.getFront();\n    if (outer === null) {\n      return innerPath;\n    } else if (outer === inner) {\n      return Path.relativePath(outerPath.popFront(), innerPath.popFront());\n    } else {\n      throw new Error(\n        'INTERNAL ERROR: innerPath (' +\n          innerPath +\n          ') is not within ' +\n          'outerPath (' +\n          outerPath +\n          ')'\n      );\n    }\n  }\n\n  /**\n   * @param {!Path} left\n   * @param {!Path} right\n   * @return {number} -1, 0, 1 if left is less, equal, or greater than the right.\n   */\n  static comparePaths(left: Path, right: Path): number {\n    const leftKeys = left.slice();\n    const rightKeys = right.slice();\n    for (let i = 0; i < leftKeys.length && i < rightKeys.length; i++) {\n      const cmp = nameCompare(leftKeys[i], rightKeys[i]);\n      if (cmp !== 0) return cmp;\n    }\n    if (leftKeys.length === rightKeys.length) return 0;\n    return leftKeys.length < rightKeys.length ? -1 : 1;\n  }\n\n  /**\n   *\n   * @param {Path} other\n   * @return {boolean} true if paths are the same.\n   */\n  equals(other: Path): boolean {\n    if (this.getLength() !== other.getLength()) {\n      return false;\n    }\n\n    for (\n      let i = this.pieceNum_, j = other.pieceNum_;\n      i <= this.pieces_.length;\n      i++, j++\n    ) {\n      if (this.pieces_[i] !== other.pieces_[j]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   *\n   * @param {!Path} other\n   * @return {boolean} True if this path is a parent (or the same as) other\n   */\n  contains(other: Path): boolean {\n    let i = this.pieceNum_;\n    let j = other.pieceNum_;\n    if (this.getLength() > other.getLength()) {\n      return false;\n    }\n    while (i < this.pieces_.length) {\n      if (this.pieces_[i] !== other.pieces_[j]) {\n        return false;\n      }\n      ++i;\n      ++j;\n    }\n    return true;\n  }\n} // end Path\n\n/**\n * Dynamic (mutable) path used to count path lengths.\n *\n * This class is used to efficiently check paths for valid\n * length (in UTF8 bytes) and depth (used in path validation).\n *\n * Throws Error exception if path is ever invalid.\n *\n * The definition of a path always begins with '/'.\n */\nexport class ValidationPath {\n  /** @type {!Array<string>} */\n  private parts_: string[];\n  /** @type {number} Initialize to number of '/' chars needed in path. */\n  private byteLength_: number;\n\n  /**\n   * @param {!Path} path Initial Path.\n   * @param {string} errorPrefix_ Prefix for any error messages.\n   */\n  constructor(path: Path, private errorPrefix_: string) {\n    /** @type {!Array<string>} */\n    this.parts_ = path.slice();\n    /** @type {number} Initialize to number of '/' chars needed in path. */\n    this.byteLength_ = Math.max(1, this.parts_.length);\n\n    for (let i = 0; i < this.parts_.length; i++) {\n      this.byteLength_ += stringLength(this.parts_[i]);\n    }\n    this.checkValid_();\n  }\n\n  /** @const {number} Maximum key depth. */\n  static get MAX_PATH_DEPTH() {\n    return 32;\n  }\n\n  /** @const {number} Maximum number of (UTF8) bytes in a Firebase path. */\n  static get MAX_PATH_LENGTH_BYTES() {\n    return 768;\n  }\n\n  /** @param {string} child */\n  push(child: string) {\n    // Count the needed '/'\n    if (this.parts_.length > 0) {\n      this.byteLength_ += 1;\n    }\n    this.parts_.push(child);\n    this.byteLength_ += stringLength(child);\n    this.checkValid_();\n  }\n\n  pop() {\n    const last = this.parts_.pop();\n    this.byteLength_ -= stringLength(last);\n    // Un-count the previous '/'\n    if (this.parts_.length > 0) {\n      this.byteLength_ -= 1;\n    }\n  }\n\n  private checkValid_() {\n    if (this.byteLength_ > ValidationPath.MAX_PATH_LENGTH_BYTES) {\n      throw new Error(\n        this.errorPrefix_ +\n          'has a key path longer than ' +\n          ValidationPath.MAX_PATH_LENGTH_BYTES +\n          ' bytes (' +\n          this.byteLength_ +\n          ').'\n      );\n    }\n    if (this.parts_.length > ValidationPath.MAX_PATH_DEPTH) {\n      throw new Error(\n        this.errorPrefix_ +\n          'path specified exceeds the maximum depth that can be written (' +\n          ValidationPath.MAX_PATH_DEPTH +\n          ') or object contains a cycle ' +\n          this.toErrorString()\n      );\n    }\n  }\n\n  /**\n   * String for use in error messages - uses '.' notation for path.\n   *\n   * @return {string}\n   */\n  toErrorString(): string {\n    if (this.parts_.length == 0) {\n      return '';\n    }\n    return \"in property '\" + this.parts_.join('.') + \"'\";\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PROTOCOL_VERSION = '5';\n\nexport const VERSION_PARAM = 'v';\n\nexport const TRANSPORT_SESSION_PARAM = 's';\n\nexport const REFERER_PARAM = 'r';\n\nexport const FORGE_REF = 'f';\n\nexport const FORGE_DOMAIN = 'firebaseio.com';\n\nexport const LAST_SESSION_PARAM = 'ls';\n\nexport const WEBSOCKET = 'websocket';\n\nexport const LONG_POLLING = 'long_polling';\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { PersistentStorage } from './storage/storage';\nimport { LONG_POLLING, WEBSOCKET } from '../realtime/Constants';\nimport { each } from './util/util';\n\n/**\n * A class that holds metadata about a Repo object\n *\n * @constructor\n */\nexport class RepoInfo {\n  host: string;\n  domain: string;\n  internalHost: string;\n\n  /**\n   * @param {string} host Hostname portion of the url for the repo\n   * @param {boolean} secure Whether or not this repo is accessed over ssl\n   * @param {string} namespace The namespace represented by the repo\n   * @param {boolean} webSocketOnly Whether to prefer websockets over all other transports (used by Nest).\n   * @param {string=} persistenceKey Override the default session persistence storage key\n   */\n  constructor(\n    host: string,\n    public secure: boolean,\n    public namespace: string,\n    public webSocketOnly: boolean,\n    public persistenceKey: string = '',\n    public includeNamespaceInQueryParams: boolean = false\n  ) {\n    this.host = host.toLowerCase();\n    this.domain = this.host.substr(this.host.indexOf('.') + 1);\n    this.internalHost = PersistentStorage.get('host:' + host) || this.host;\n  }\n\n  needsQueryParam(): boolean {\n    return (\n      this.host !== this.internalHost ||\n      this.isCustomHost() ||\n      this.includeNamespaceInQueryParams\n    );\n  }\n\n  isCacheableHost(): boolean {\n    return this.internalHost.substr(0, 2) === 's-';\n  }\n\n  isDemoHost() {\n    return this.domain === 'firebaseio-demo.com';\n  }\n\n  isCustomHost() {\n    return (\n      this.domain !== 'firebaseio.com' && this.domain !== 'firebaseio-demo.com'\n    );\n  }\n\n  updateHost(newHost: string) {\n    if (newHost !== this.internalHost) {\n      this.internalHost = newHost;\n      if (this.isCacheableHost()) {\n        PersistentStorage.set('host:' + this.host, this.internalHost);\n      }\n    }\n  }\n\n  /**\n   * Returns the websocket URL for this repo\n   * @param {string} type of connection\n   * @param {Object} params list\n   * @return {string} The URL for this repo\n   */\n  connectionURL(type: string, params: { [k: string]: string }): string {\n    assert(typeof type === 'string', 'typeof type must == string');\n    assert(typeof params === 'object', 'typeof params must == object');\n\n    let connURL: string;\n    if (type === WEBSOCKET) {\n      connURL =\n        (this.secure ? 'wss://' : 'ws://') + this.internalHost + '/.ws?';\n    } else if (type === LONG_POLLING) {\n      connURL =\n        (this.secure ? 'https://' : 'http://') + this.internalHost + '/.lp?';\n    } else {\n      throw new Error('Unknown connection type: ' + type);\n    }\n    if (this.needsQueryParam()) {\n      params['ns'] = this.namespace;\n    }\n\n    const pairs: string[] = [];\n\n    each(params, (key: string, value: string) => {\n      pairs.push(key + '=' + value);\n    });\n\n    return connURL + pairs.join('&');\n  }\n\n  /** @return {string} */\n  toString(): string {\n    let str = this.toURLString();\n    if (this.persistenceKey) {\n      str += '<' + this.persistenceKey + '>';\n    }\n    return str;\n  }\n\n  /** @return {string} */\n  toURLString(): string {\n    return (this.secure ? 'https://' : 'http://') + this.host;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Path } from '../Path';\nimport { RepoInfo } from '../../RepoInfo';\nimport { warnIfPageIsSecure, warn, fatal } from '../util';\n\n/**\n * @param {!string} pathString\n * @return {string}\n */\nfunction decodePath(pathString: string): string {\n  let pathStringDecoded = '';\n  const pieces = pathString.split('/');\n  for (let i = 0; i < pieces.length; i++) {\n    if (pieces[i].length > 0) {\n      let piece = pieces[i];\n      try {\n        piece = decodeURIComponent(piece.replace(/\\+/g, ' '));\n      } catch (e) {}\n      pathStringDecoded += '/' + piece;\n    }\n  }\n  return pathStringDecoded;\n}\n\n/**\n * @param {!string} queryString\n * @return {!{[key:string]:string}} key value hash\n */\nfunction decodeQuery(queryString: string): { [key: string]: string } {\n  let results = {};\n  if (queryString.charAt(0) === '?') {\n    queryString = queryString.substring(1);\n  }\n  for (const segment of queryString.split('&')) {\n    if (segment.length === 0) {\n      continue;\n    }\n    const kv = segment.split('=');\n    if (kv.length === 2) {\n      results[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1]);\n    } else {\n      warn(`Invalid query segment '${segment}' in query '${queryString}'`);\n    }\n  }\n  return results;\n}\n\n/**\n *\n * @param {!string} dataURL\n * @return {{repoInfo: !RepoInfo, path: !Path}}\n */\nexport const parseRepoInfo = function(\n  dataURL: string\n): { repoInfo: RepoInfo; path: Path } {\n  const parsedUrl = parseDatabaseURL(dataURL),\n    namespace = parsedUrl.namespace;\n\n  if (parsedUrl.domain === 'firebase') {\n    fatal(\n      parsedUrl.host +\n        ' is no longer supported. ' +\n        'Please use <YOUR FIREBASE>.firebaseio.com instead'\n    );\n  }\n\n  // Catch common error of uninitialized namespace value.\n  if (\n    (!namespace || namespace == 'undefined') &&\n    parsedUrl.domain !== 'localhost'\n  ) {\n    fatal(\n      'Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com'\n    );\n  }\n\n  if (!parsedUrl.secure) {\n    warnIfPageIsSecure();\n  }\n\n  const webSocketOnly = parsedUrl.scheme === 'ws' || parsedUrl.scheme === 'wss';\n\n  return {\n    repoInfo: new RepoInfo(\n      parsedUrl.host,\n      parsedUrl.secure,\n      namespace,\n      webSocketOnly,\n      /*persistenceKey=*/ '',\n      /*includeNamespaceInQueryParams=*/ namespace != parsedUrl.subdomain\n    ),\n    path: new Path(parsedUrl.pathString)\n  };\n};\n\n/**\n *\n * @param {!string} dataURL\n * @return {{host: string, port: number, domain: string, subdomain: string, secure: boolean, scheme: string, pathString: string, namespace: string}}\n */\nexport const parseDatabaseURL = function(\n  dataURL: string\n): {\n  host: string;\n  port: number;\n  domain: string;\n  subdomain: string;\n  secure: boolean;\n  scheme: string;\n  pathString: string;\n  namespace: string;\n} {\n  // Default to empty strings in the event of a malformed string.\n  let host = '',\n    domain = '',\n    subdomain = '',\n    pathString = '',\n    namespace = '';\n\n  // Always default to SSL, unless otherwise specified.\n  let secure = true,\n    scheme = 'https',\n    port = 443;\n\n  // Don't do any validation here. The caller is responsible for validating the result of parsing.\n  if (typeof dataURL === 'string') {\n    // Parse scheme.\n    let colonInd = dataURL.indexOf('//');\n    if (colonInd >= 0) {\n      scheme = dataURL.substring(0, colonInd - 1);\n      dataURL = dataURL.substring(colonInd + 2);\n    }\n\n    // Parse host, path, and query string.\n    let slashInd = dataURL.indexOf('/');\n    if (slashInd === -1) {\n      slashInd = dataURL.length;\n    }\n    let questionMarkInd = dataURL.indexOf('?');\n    if (questionMarkInd === -1) {\n      questionMarkInd = dataURL.length;\n    }\n    host = dataURL.substring(0, Math.min(slashInd, questionMarkInd));\n    if (slashInd < questionMarkInd) {\n      // For pathString, questionMarkInd will always come after slashInd\n      pathString = decodePath(dataURL.substring(slashInd, questionMarkInd));\n    }\n    let queryParams = decodeQuery(\n      dataURL.substring(Math.min(dataURL.length, questionMarkInd))\n    );\n\n    // If we have a port, use scheme for determining if it's secure.\n    colonInd = host.indexOf(':');\n    if (colonInd >= 0) {\n      secure = scheme === 'https' || scheme === 'wss';\n      port = parseInt(host.substring(colonInd + 1), 10);\n    } else {\n      colonInd = dataURL.length;\n    }\n\n    const parts = host.split('.');\n    if (parts.length === 3) {\n      // Normalize namespaces to lowercase to share storage / connection.\n      domain = parts[1];\n      subdomain = parts[0].toLowerCase();\n      // We interpret the subdomain of a 3 component URL as the namespace name.\n      namespace = subdomain;\n    } else if (parts.length === 2) {\n      domain = parts[0];\n    } else if (parts[0].slice(0, colonInd).toLowerCase() === 'localhost') {\n      domain = 'localhost';\n    }\n    // Always treat the value of the `ns` as the namespace name if it is present.\n    if ('ns' in queryParams) {\n      namespace = queryParams['ns'];\n    }\n  }\n\n  return {\n    host,\n    port,\n    domain,\n    subdomain,\n    secure,\n    scheme,\n    pathString,\n    namespace\n  };\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Index } from './Index';\nimport { Node, NamedNode } from '../Node';\nimport { nameCompare, MAX_NAME } from '../../util/util';\nimport { assert, assertionError } from '@firebase/util';\nimport { ChildrenNode } from '../ChildrenNode';\n\nlet __EMPTY_NODE: ChildrenNode;\n\nexport class KeyIndex extends Index {\n  static get __EMPTY_NODE() {\n    return __EMPTY_NODE;\n  }\n\n  static set __EMPTY_NODE(val) {\n    __EMPTY_NODE = val;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  compare(a: NamedNode, b: NamedNode): number {\n    return nameCompare(a.name, b.name);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  isDefinedOn(node: Node): boolean {\n    // We could probably return true here (since every node has a key), but it's never called\n    // so just leaving unimplemented for now.\n    throw assertionError('KeyIndex.isDefinedOn not expected to be called.');\n  }\n\n  /**\n   * @inheritDoc\n   */\n  indexedValueChanged(oldNode: Node, newNode: Node): boolean {\n    return false; // The key for a node never changes.\n  }\n\n  /**\n   * @inheritDoc\n   */\n  minPost() {\n    return (NamedNode as any).MIN;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  maxPost(): NamedNode {\n    // TODO: This should really be created once and cached in a static property, but\n    // NamedNode isn't defined yet, so I can't use it in a static.  Bleh.\n    return new NamedNode(MAX_NAME, __EMPTY_NODE);\n  }\n\n  /**\n   * @param {*} indexValue\n   * @param {string} name\n   * @return {!NamedNode}\n   */\n  makePost(indexValue: string, name: string): NamedNode {\n    assert(\n      typeof indexValue === 'string',\n      'KeyIndex indexValue must always be a string.'\n    );\n    // We just use empty node, but it'll never be compared, since our comparator only looks at name.\n    return new NamedNode(indexValue, __EMPTY_NODE);\n  }\n\n  /**\n   * @return {!string} String representation for inclusion in a query spec\n   */\n  toString(): string {\n    return '.key';\n  }\n}\n\nexport const KEY_INDEX = new KeyIndex();\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { doubleToIEEE754String } from '../util/util';\nimport { contains } from '@firebase/util';\nimport { Node } from './Node';\n\nlet MAX_NODE: Node;\n\nexport function setMaxNode(val: Node) {\n  MAX_NODE = val;\n}\n\n/**\n * @param {(!string|!number)} priority\n * @return {!string}\n */\nexport const priorityHashText = function(priority: string | number): string {\n  if (typeof priority === 'number')\n    return 'number:' + doubleToIEEE754String(priority);\n  else return 'string:' + priority;\n};\n\n/**\n * Validates that a priority snapshot Node is valid.\n *\n * @param {!Node} priorityNode\n */\nexport const validatePriorityNode = function(priorityNode: Node) {\n  if (priorityNode.isLeafNode()) {\n    const val = priorityNode.val();\n    assert(\n      typeof val === 'string' ||\n        typeof val === 'number' ||\n        (typeof val === 'object' &&\n          contains(val as { [key: string]: unknown }, '.sv')),\n      'Priority must be a string or number.'\n    );\n  } else {\n    assert(\n      priorityNode === MAX_NODE || priorityNode.isEmpty(),\n      'priority of unexpected type.'\n    );\n  }\n  // Don't call getPriority() on MAX_NODE to avoid hitting assertion.\n  assert(\n    priorityNode === MAX_NODE || priorityNode.getPriority().isEmpty(),\n    \"Priority nodes can't have a priority of their own.\"\n  );\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Path, ValidationPath } from './Path';\nimport { contains, safeGet } from '@firebase/util';\nimport { isInvalidJSONNumber, each } from './util';\nimport { errorPrefix as errorPrefixFxn } from '@firebase/util';\nimport { stringLength } from '@firebase/util';\nimport { RepoInfo } from '../RepoInfo';\n\n/**\n * True for invalid Firebase keys\n * @type {RegExp}\n * @private\n */\nexport const INVALID_KEY_REGEX_ = /[\\[\\].#$\\/\\u0000-\\u001F\\u007F]/;\n\n/**\n * True for invalid Firebase paths.\n * Allows '/' in paths.\n * @type {RegExp}\n * @private\n */\nexport const INVALID_PATH_REGEX_ = /[\\[\\].#$\\u0000-\\u001F\\u007F]/;\n\n/**\n * Maximum number of characters to allow in leaf value\n * @type {number}\n * @private\n */\nexport const MAX_LEAF_SIZE_ = 10 * 1024 * 1024;\n\n/**\n * @param {*} key\n * @return {boolean}\n */\nexport const isValidKey = function(key: any): boolean {\n  return (\n    typeof key === 'string' && key.length !== 0 && !INVALID_KEY_REGEX_.test(key)\n  );\n};\n\n/**\n * @param {string} pathString\n * @return {boolean}\n */\nexport const isValidPathString = function(pathString: string): boolean {\n  return (\n    typeof pathString === 'string' &&\n    pathString.length !== 0 &&\n    !INVALID_PATH_REGEX_.test(pathString)\n  );\n};\n\n/**\n * @param {string} pathString\n * @return {boolean}\n */\nexport const isValidRootPathString = function(pathString: string): boolean {\n  if (pathString) {\n    // Allow '/.info/' at the beginning.\n    pathString = pathString.replace(/^\\/*\\.info(\\/|$)/, '/');\n  }\n\n  return isValidPathString(pathString);\n};\n\n/**\n * @param {*} priority\n * @return {boolean}\n */\nexport const isValidPriority = function(priority: any): boolean {\n  return (\n    priority === null ||\n    typeof priority === 'string' ||\n    (typeof priority === 'number' && !isInvalidJSONNumber(priority)) ||\n    (priority && typeof priority === 'object' && contains(priority, '.sv'))\n  );\n};\n\n/**\n * Pre-validate a datum passed as an argument to Firebase function.\n *\n * @param {string} fnName\n * @param {number} argumentNumber\n * @param {*} data\n * @param {!Path} path\n * @param {boolean} optional\n */\nexport const validateFirebaseDataArg = function(\n  fnName: string,\n  argumentNumber: number,\n  data: any,\n  path: Path,\n  optional: boolean\n) {\n  if (optional && data === undefined) return;\n\n  validateFirebaseData(\n    errorPrefixFxn(fnName, argumentNumber, optional),\n    data,\n    path\n  );\n};\n\n/**\n * Validate a data object client-side before sending to server.\n *\n * @param {string} errorPrefix\n * @param {*} data\n * @param {!Path|!ValidationPath} path_\n */\nexport const validateFirebaseData = function(\n  errorPrefix: string,\n  data: any,\n  path_: Path | ValidationPath\n) {\n  const path =\n    path_ instanceof Path ? new ValidationPath(path_, errorPrefix) : path_;\n\n  if (data === undefined) {\n    throw new Error(errorPrefix + 'contains undefined ' + path.toErrorString());\n  }\n  if (typeof data === 'function') {\n    throw new Error(\n      errorPrefix +\n        'contains a function ' +\n        path.toErrorString() +\n        ' with contents = ' +\n        data.toString()\n    );\n  }\n  if (isInvalidJSONNumber(data)) {\n    throw new Error(\n      errorPrefix + 'contains ' + data.toString() + ' ' + path.toErrorString()\n    );\n  }\n\n  // Check max leaf size, but try to avoid the utf8 conversion if we can.\n  if (\n    typeof data === 'string' &&\n    data.length > MAX_LEAF_SIZE_ / 3 &&\n    stringLength(data) > MAX_LEAF_SIZE_\n  ) {\n    throw new Error(\n      errorPrefix +\n        'contains a string greater than ' +\n        MAX_LEAF_SIZE_ +\n        ' utf8 bytes ' +\n        path.toErrorString() +\n        \" ('\" +\n        data.substring(0, 50) +\n        \"...')\"\n    );\n  }\n\n  // TODO = Perf = Consider combining the recursive validation of keys into NodeFromJSON\n  // to save extra walking of large objects.\n  if (data && typeof data === 'object') {\n    let hasDotValue = false;\n    let hasActualChild = false;\n    each(data, function(key: string, value: any) {\n      if (key === '.value') {\n        hasDotValue = true;\n      } else if (key !== '.priority' && key !== '.sv') {\n        hasActualChild = true;\n        if (!isValidKey(key)) {\n          throw new Error(\n            errorPrefix +\n              ' contains an invalid key (' +\n              key +\n              ') ' +\n              path.toErrorString() +\n              '.  Keys must be non-empty strings ' +\n              'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"'\n          );\n        }\n      }\n\n      path.push(key);\n      validateFirebaseData(errorPrefix, value, path);\n      path.pop();\n    });\n\n    if (hasDotValue && hasActualChild) {\n      throw new Error(\n        errorPrefix +\n          ' contains \".value\" child ' +\n          path.toErrorString() +\n          ' in addition to actual children.'\n      );\n    }\n  }\n};\n\n/**\n * Pre-validate paths passed in the firebase function.\n *\n * @param {string} errorPrefix\n * @param {Array<!Path>} mergePaths\n */\nexport const validateFirebaseMergePaths = function(\n  errorPrefix: string,\n  mergePaths: Path[]\n) {\n  let i, curPath;\n  for (i = 0; i < mergePaths.length; i++) {\n    curPath = mergePaths[i];\n    const keys = curPath.slice();\n    for (let j = 0; j < keys.length; j++) {\n      if (keys[j] === '.priority' && j === keys.length - 1) {\n        // .priority is OK\n      } else if (!isValidKey(keys[j])) {\n        throw new Error(\n          errorPrefix +\n            'contains an invalid key (' +\n            keys[j] +\n            ') in path ' +\n            curPath.toString() +\n            '. Keys must be non-empty strings ' +\n            'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"'\n        );\n      }\n    }\n  }\n\n  // Check that update keys are not descendants of each other.\n  // We rely on the property that sorting guarantees that ancestors come\n  // right before descendants.\n  mergePaths.sort(Path.comparePaths);\n  let prevPath: Path | null = null;\n  for (i = 0; i < mergePaths.length; i++) {\n    curPath = mergePaths[i];\n    if (prevPath !== null && prevPath.contains(curPath)) {\n      throw new Error(\n        errorPrefix +\n          'contains a path ' +\n          prevPath.toString() +\n          ' that is ancestor of another path ' +\n          curPath.toString()\n      );\n    }\n    prevPath = curPath;\n  }\n};\n\n/**\n * pre-validate an object passed as an argument to firebase function (\n * must be an object - e.g. for firebase.update()).\n *\n * @param {string} fnName\n * @param {number} argumentNumber\n * @param {*} data\n * @param {!Path} path\n * @param {boolean} optional\n */\nexport const validateFirebaseMergeDataArg = function(\n  fnName: string,\n  argumentNumber: number,\n  data: any,\n  path: Path,\n  optional: boolean\n) {\n  if (optional && data === undefined) return;\n\n  const errorPrefix = errorPrefixFxn(fnName, argumentNumber, optional);\n\n  if (!(data && typeof data === 'object') || Array.isArray(data)) {\n    throw new Error(\n      errorPrefix + ' must be an object containing the children to replace.'\n    );\n  }\n\n  const mergePaths: Path[] = [];\n  each(data, function(key: string, value: any) {\n    const curPath = new Path(key);\n    validateFirebaseData(errorPrefix, value, path.child(curPath));\n    if (curPath.getBack() === '.priority') {\n      if (!isValidPriority(value)) {\n        throw new Error(\n          errorPrefix +\n            \"contains an invalid value for '\" +\n            curPath.toString() +\n            \"', which must be a valid \" +\n            'Firebase priority (a string, finite number, server value, or null).'\n        );\n      }\n    }\n    mergePaths.push(curPath);\n  });\n  validateFirebaseMergePaths(errorPrefix, mergePaths);\n};\n\nexport const validatePriority = function(\n  fnName: string,\n  argumentNumber: number,\n  priority: any,\n  optional: boolean\n) {\n  if (optional && priority === undefined) return;\n  if (isInvalidJSONNumber(priority))\n    throw new Error(\n      errorPrefixFxn(fnName, argumentNumber, optional) +\n        'is ' +\n        priority.toString() +\n        ', but must be a valid Firebase priority (a string, finite number, ' +\n        'server value, or null).'\n    );\n  // Special case to allow importing data with a .sv.\n  if (!isValidPriority(priority))\n    throw new Error(\n      errorPrefixFxn(fnName, argumentNumber, optional) +\n        'must be a valid Firebase priority ' +\n        '(a string, finite number, server value, or null).'\n    );\n};\n\nexport const validateEventType = function(\n  fnName: string,\n  argumentNumber: number,\n  eventType: string,\n  optional: boolean\n) {\n  if (optional && eventType === undefined) return;\n\n  switch (eventType) {\n    case 'value':\n    case 'child_added':\n    case 'child_removed':\n    case 'child_changed':\n    case 'child_moved':\n      break;\n    default:\n      throw new Error(\n        errorPrefixFxn(fnName, argumentNumber, optional) +\n          'must be a valid event type = \"value\", \"child_added\", \"child_removed\", ' +\n          '\"child_changed\", or \"child_moved\".'\n      );\n  }\n};\n\nexport const validateKey = function(\n  fnName: string,\n  argumentNumber: number,\n  key: string,\n  optional: boolean\n) {\n  if (optional && key === undefined) return;\n  if (!isValidKey(key))\n    throw new Error(\n      errorPrefixFxn(fnName, argumentNumber, optional) +\n        'was an invalid key = \"' +\n        key +\n        '\".  Firebase keys must be non-empty strings and ' +\n        'can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\").'\n    );\n};\n\nexport const validatePathString = function(\n  fnName: string,\n  argumentNumber: number,\n  pathString: string,\n  optional: boolean\n) {\n  if (optional && pathString === undefined) return;\n\n  if (!isValidPathString(pathString))\n    throw new Error(\n      errorPrefixFxn(fnName, argumentNumber, optional) +\n        'was an invalid path = \"' +\n        pathString +\n        '\". Paths must be non-empty strings and ' +\n        'can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\"'\n    );\n};\n\nexport const validateRootPathString = function(\n  fnName: string,\n  argumentNumber: number,\n  pathString: string,\n  optional: boolean\n) {\n  if (pathString) {\n    // Allow '/.info/' at the beginning.\n    pathString = pathString.replace(/^\\/*\\.info(\\/|$)/, '/');\n  }\n\n  validatePathString(fnName, argumentNumber, pathString, optional);\n};\n\nexport const validateWritablePath = function(fnName: string, path: Path) {\n  if (path.getFront() === '.info') {\n    throw new Error(fnName + \" failed = Can't modify data under /.info/\");\n  }\n};\n\nexport const validateUrl = function(\n  fnName: string,\n  argumentNumber: number,\n  parsedUrl: { repoInfo: RepoInfo; path: Path }\n) {\n  // TODO = Validate server better.\n  const pathString = parsedUrl.path.toString();\n  if (\n    !(typeof parsedUrl.repoInfo.host === 'string') ||\n    parsedUrl.repoInfo.host.length === 0 ||\n    (!isValidKey(parsedUrl.repoInfo.namespace) &&\n      parsedUrl.repoInfo.host.split(':')[0] !== 'localhost') ||\n    (pathString.length !== 0 && !isValidRootPathString(pathString))\n  ) {\n    throw new Error(\n      errorPrefixFxn(fnName, argumentNumber, false) +\n        'must be a valid firebase URL and ' +\n        'the path can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\".'\n    );\n  }\n};\n\nexport const validateCredential = function(\n  fnName: string,\n  argumentNumber: number,\n  cred: any,\n  optional: boolean\n) {\n  if (optional && cred === undefined) return;\n  if (!(typeof cred === 'string'))\n    throw new Error(\n      errorPrefixFxn(fnName, argumentNumber, optional) +\n        'must be a valid credential (a string).'\n    );\n};\n\nexport const validateBoolean = function(\n  fnName: string,\n  argumentNumber: number,\n  bool: any,\n  optional: boolean\n) {\n  if (optional && bool === undefined) return;\n  if (typeof bool !== 'boolean')\n    throw new Error(\n      errorPrefixFxn(fnName, argumentNumber, optional) + 'must be a boolean.'\n    );\n};\n\nexport const validateString = function(\n  fnName: string,\n  argumentNumber: number,\n  string: any,\n  optional: boolean\n) {\n  if (optional && string === undefined) return;\n  if (!(typeof string === 'string')) {\n    throw new Error(\n      errorPrefixFxn(fnName, argumentNumber, optional) +\n        'must be a valid string.'\n    );\n  }\n};\n\nexport const validateObject = function(\n  fnName: string,\n  argumentNumber: number,\n  obj: any,\n  optional: boolean\n) {\n  if (optional && obj === undefined) return;\n  if (!(obj && typeof obj === 'object') || obj === null) {\n    throw new Error(\n      errorPrefixFxn(fnName, argumentNumber, optional) +\n        'must be a valid object.'\n    );\n  }\n};\n\nexport const validateObjectContainsKey = function(\n  fnName: string,\n  argumentNumber: number,\n  obj: any,\n  key: string,\n  optional: boolean,\n  opt_type?: string\n) {\n  const objectContainsKey =\n    obj && typeof obj === 'object' && contains(obj, key);\n\n  if (!objectContainsKey) {\n    if (optional) {\n      return;\n    } else {\n      throw new Error(\n        errorPrefixFxn(fnName, argumentNumber, optional) +\n          'must contain the key \"' +\n          key +\n          '\"'\n      );\n    }\n  }\n\n  if (opt_type) {\n    const val = safeGet(obj, key);\n    if (\n      (opt_type === 'number' && !(typeof val === 'number')) ||\n      (opt_type === 'string' && !(typeof val === 'string')) ||\n      (opt_type === 'boolean' && !(typeof val === 'boolean')) ||\n      (opt_type === 'function' && !(typeof val === 'function')) ||\n      (opt_type === 'object' && !(typeof val === 'object') && val)\n    ) {\n      if (optional) {\n        throw new Error(\n          errorPrefixFxn(fnName, argumentNumber, optional) +\n            'contains invalid value for key \"' +\n            key +\n            '\" (must be of type \"' +\n            opt_type +\n            '\")'\n        );\n      } else {\n        throw new Error(\n          errorPrefixFxn(fnName, argumentNumber, optional) +\n            'must contain the key \"' +\n            key +\n            '\" with type \"' +\n            opt_type +\n            '\"'\n        );\n      }\n    }\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { validateArgCount, validateCallback } from '@firebase/util';\nimport {\n  validateWritablePath,\n  validateFirebaseDataArg,\n  validatePriority,\n  validateFirebaseMergeDataArg\n} from '../core/util/validation';\nimport { warn } from '../core/util/util';\nimport { Deferred } from '@firebase/util';\nimport { Repo } from '../core/Repo';\nimport { Path } from '../core/util/Path';\n\n/**\n * @constructor\n */\nexport class OnDisconnect {\n  /**\n   * @param {!Repo} repo_\n   * @param {!Path} path_\n   */\n  constructor(private repo_: Repo, private path_: Path) {}\n\n  /**\n   * @param {function(?Error)=} onComplete\n   * @return {!firebase.Promise}\n   */\n  cancel(onComplete?: (a: Error | null) => void): Promise<void> {\n    validateArgCount('OnDisconnect.cancel', 0, 1, arguments.length);\n    validateCallback('OnDisconnect.cancel', 1, onComplete, true);\n    const deferred = new Deferred<void>();\n    this.repo_.onDisconnectCancel(\n      this.path_,\n      deferred.wrapCallback(onComplete)\n    );\n    return deferred.promise;\n  }\n\n  /**\n   * @param {function(?Error)=} onComplete\n   * @return {!firebase.Promise}\n   */\n  remove(onComplete?: (a: Error | null) => void): Promise<void> {\n    validateArgCount('OnDisconnect.remove', 0, 1, arguments.length);\n    validateWritablePath('OnDisconnect.remove', this.path_);\n    validateCallback('OnDisconnect.remove', 1, onComplete, true);\n    const deferred = new Deferred<void>();\n    this.repo_.onDisconnectSet(\n      this.path_,\n      null,\n      deferred.wrapCallback(onComplete)\n    );\n    return deferred.promise;\n  }\n\n  /**\n   * @param {*} value\n   * @param {function(?Error)=} onComplete\n   * @return {!firebase.Promise}\n   */\n  set(value: any, onComplete?: (a: Error | null) => void): Promise<void> {\n    validateArgCount('OnDisconnect.set', 1, 2, arguments.length);\n    validateWritablePath('OnDisconnect.set', this.path_);\n    validateFirebaseDataArg('OnDisconnect.set', 1, value, this.path_, false);\n    validateCallback('OnDisconnect.set', 2, onComplete, true);\n    const deferred = new Deferred<void>();\n    this.repo_.onDisconnectSet(\n      this.path_,\n      value,\n      deferred.wrapCallback(onComplete)\n    );\n    return deferred.promise;\n  }\n\n  /**\n   * @param {*} value\n   * @param {number|string|null} priority\n   * @param {function(?Error)=} onComplete\n   * @return {!firebase.Promise}\n   */\n  setWithPriority(\n    value: any,\n    priority: number | string | null,\n    onComplete?: (a: Error | null) => void\n  ): Promise<void> {\n    validateArgCount('OnDisconnect.setWithPriority', 2, 3, arguments.length);\n    validateWritablePath('OnDisconnect.setWithPriority', this.path_);\n    validateFirebaseDataArg(\n      'OnDisconnect.setWithPriority',\n      1,\n      value,\n      this.path_,\n      false\n    );\n    validatePriority('OnDisconnect.setWithPriority', 2, priority, false);\n    validateCallback('OnDisconnect.setWithPriority', 3, onComplete, true);\n\n    const deferred = new Deferred<void>();\n    this.repo_.onDisconnectSetWithPriority(\n      this.path_,\n      value,\n      priority,\n      deferred.wrapCallback(onComplete)\n    );\n    return deferred.promise;\n  }\n\n  /**\n   * @param {!Object} objectToMerge\n   * @param {function(?Error)=} onComplete\n   * @return {!firebase.Promise}\n   */\n  update(\n    objectToMerge: object,\n    onComplete?: (a: Error | null) => void\n  ): Promise<void> {\n    validateArgCount('OnDisconnect.update', 1, 2, arguments.length);\n    validateWritablePath('OnDisconnect.update', this.path_);\n    if (Array.isArray(objectToMerge)) {\n      const newObjectToMerge: { [k: string]: any } = {};\n      for (let i = 0; i < objectToMerge.length; ++i) {\n        newObjectToMerge['' + i] = objectToMerge[i];\n      }\n      objectToMerge = newObjectToMerge;\n      warn(\n        'Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the ' +\n          'existing data, or an Object with integer keys if you really do want to only update some of the children.'\n      );\n    }\n    validateFirebaseMergeDataArg(\n      'OnDisconnect.update',\n      1,\n      objectToMerge,\n      this.path_,\n      false\n    );\n    validateCallback('OnDisconnect.update', 2, onComplete, true);\n    const deferred = new Deferred<void>();\n    this.repo_.onDisconnectUpdate(\n      this.path_,\n      objectToMerge,\n      deferred.wrapCallback(onComplete)\n    );\n    return deferred.promise;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DataSnapshot } from './DataSnapshot';\nimport { validateArgCount } from '@firebase/util';\n\nexport class TransactionResult {\n  /**\n   * A type for the resolve value of Firebase.transaction.\n   * @constructor\n   * @dict\n   * @param {boolean} committed\n   * @param {DataSnapshot} snapshot\n   */\n  constructor(public committed: boolean, public snapshot: DataSnapshot) {}\n\n  // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\n  // for end-users\n  toJSON(): object {\n    validateArgCount('TransactionResult.toJSON', 0, 1, arguments.length);\n    return { committed: this.committed, snapshot: this.snapshot.toJSON() };\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\n\n/**\n * Fancy ID generator that creates 20-character string identifiers with the\n * following properties:\n *\n * 1. They're based on timestamp so that they sort *after* any existing ids.\n * 2. They contain 72-bits of random data after the timestamp so that IDs won't\n *    collide with other clients' IDs.\n * 3. They sort *lexicographically* (so the timestamp is converted to characters\n *    that will sort properly).\n * 4. They're monotonically increasing. Even if you generate more than one in\n *    the same timestamp, the latter ones will sort after the former ones. We do\n *    this by using the previous random bits but \"incrementing\" them by 1 (only\n *    in the case of a timestamp collision).\n */\nexport const nextPushId = (function() {\n  // Modeled after base64 web-safe chars, but ordered by ASCII.\n  const PUSH_CHARS =\n    '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\n\n  // Timestamp of last push, used to prevent local collisions if you push twice\n  // in one ms.\n  let lastPushTime = 0;\n\n  // We generate 72-bits of randomness which get turned into 12 characters and\n  // appended to the timestamp to prevent collisions with other clients. We\n  // store the last characters we generated because in the event of a collision,\n  // we'll use those same characters except \"incremented\" by one.\n  const lastRandChars: number[] = [];\n\n  return function(now: number) {\n    const duplicateTime = now === lastPushTime;\n    lastPushTime = now;\n\n    let i;\n    const timeStampChars = new Array(8);\n    for (i = 7; i >= 0; i--) {\n      timeStampChars[i] = PUSH_CHARS.charAt(now % 64);\n      // NOTE: Can't use << here because javascript will convert to int and lose\n      // the upper bits.\n      now = Math.floor(now / 64);\n    }\n    assert(now === 0, 'Cannot push at time == 0');\n\n    let id = timeStampChars.join('');\n\n    if (!duplicateTime) {\n      for (i = 0; i < 12; i++) {\n        lastRandChars[i] = Math.floor(Math.random() * 64);\n      }\n    } else {\n      // If the timestamp hasn't changed since last push, use the same random\n      // number, except incremented by 1.\n      for (i = 11; i >= 0 && lastRandChars[i] === 63; i--) {\n        lastRandChars[i] = 0;\n      }\n      lastRandChars[i]++;\n    }\n    for (i = 0; i < 12; i++) {\n      id += PUSH_CHARS.charAt(lastRandChars[i]);\n    }\n    assert(id.length === 20, 'nextPushId: Length should be 20.');\n\n    return id;\n  };\n})();\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Path } from '../util/Path';\nimport { Index } from './indexes/Index';\n\n/**\n * Node is an interface defining the common functionality for nodes in\n * a DataSnapshot.\n *\n * @interface\n */\nexport interface Node {\n  /**\n   * Whether this node is a leaf node.\n   * @return {boolean} Whether this is a leaf node.\n   */\n  isLeafNode(): boolean;\n\n  /**\n   * Gets the priority of the node.\n   * @return {!Node} The priority of the node.\n   */\n  getPriority(): Node;\n\n  /**\n   * Returns a duplicate node with the new priority.\n   * @param {!Node} newPriorityNode New priority to set for the node.\n   * @return {!Node} Node with new priority.\n   */\n  updatePriority(newPriorityNode: Node): Node;\n\n  /**\n   * Returns the specified immediate child, or null if it doesn't exist.\n   * @param {string} childName The name of the child to retrieve.\n   * @return {!Node} The retrieved child, or an empty node.\n   */\n  getImmediateChild(childName: string): Node;\n\n  /**\n   * Returns a child by path, or null if it doesn't exist.\n   * @param {!Path} path The path of the child to retrieve.\n   * @return {!Node} The retrieved child or an empty node.\n   */\n  getChild(path: Path): Node;\n\n  /**\n   * Returns the name of the child immediately prior to the specified childNode, or null.\n   * @param {!string} childName The name of the child to find the predecessor of.\n   * @param {!Node} childNode The node to find the predecessor of.\n   * @param {!Index} index The index to use to determine the predecessor\n   * @return {?string} The name of the predecessor child, or null if childNode is the first child.\n   */\n  getPredecessorChildName(\n    childName: String,\n    childNode: Node,\n    index: Index\n  ): string | null;\n\n  /**\n   * Returns a duplicate node, with the specified immediate child updated.\n   * Any value in the node will be removed.\n   * @param {string} childName The name of the child to update.\n   * @param {!Node} newChildNode The new child node\n   * @return {!Node} The updated node.\n   */\n  updateImmediateChild(childName: string, newChildNode: Node): Node;\n\n  /**\n   * Returns a duplicate node, with the specified child updated.  Any value will\n   * be removed.\n   * @param {!Path} path The path of the child to update.\n   * @param {!Node} newChildNode The new child node, which may be an empty node\n   * @return {!Node} The updated node.\n   */\n  updateChild(path: Path, newChildNode: Node): Node;\n\n  /**\n   * True if the immediate child specified exists\n   * @param {!string} childName\n   * @return {boolean}\n   */\n  hasChild(childName: string): boolean;\n\n  /**\n   * @return {boolean} True if this node has no value or children.\n   */\n  isEmpty(): boolean;\n\n  /**\n   * @return {number} The number of children of this node.\n   */\n  numChildren(): number;\n\n  /**\n   * Calls action for each child.\n   * @param {!Index} index\n   * @param {function(string, !Node)} action Action to be called for\n   * each child.  It's passed the child name and the child node.\n   * @return {*} The first truthy value return by action, or the last falsey one\n   */\n  forEachChild(index: Index, action: (a: string, b: Node) => void): any;\n\n  /**\n   * @param exportFormat True for export format (also wire protocol format).\n   * @return Value of this node as JSON.\n   */\n  val(exportFormat?: boolean): unknown;\n\n  /**\n   * @return {string} hash representing the node contents.\n   */\n  hash(): string;\n\n  /**\n   * @param {!Node} other Another node\n   * @return {!number} -1 for less than, 0 for equal, 1 for greater than other\n   */\n  compareTo(other: Node): number;\n\n  /**\n   * @param {!Node} other\n   * @return {boolean} Whether or not this snapshot equals other\n   */\n  equals(other: Node): boolean;\n\n  /**\n   * @param {!Index} indexDefinition\n   * @return {!Node} This node, with the specified index now available\n   */\n  withIndex(indexDefinition: Index): Node;\n\n  /**\n   * @param {!Index} indexDefinition\n   * @return {boolean}\n   */\n  isIndexed(indexDefinition: Index): boolean;\n}\n\n/**\n *\n * @param {!string} name\n * @param {!Node} node\n * @constructor\n * @struct\n */\nexport class NamedNode {\n  constructor(public name: string, public node: Node) {}\n\n  /**\n   *\n   * @param {!string} name\n   * @param {!Node} node\n   * @return {NamedNode}\n   */\n  static Wrap(name: string, node: Node) {\n    return new NamedNode(name, node);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Node, NamedNode } from '../Node';\nimport { MIN_NAME, MAX_NAME } from '../../util/util';\nimport { Comparator } from '../../util/SortedMap';\n\n/**\n *\n * @constructor\n */\nexport abstract class Index {\n  /**\n   * @param {!NamedNode} a\n   * @param {!NamedNode} b\n   * @return {number}\n   */\n  abstract compare(a: NamedNode, b: NamedNode): number;\n\n  /**\n   * @param {!Node} node\n   * @return {boolean}\n   */\n  abstract isDefinedOn(node: Node): boolean;\n\n  /**\n   * @return {function(!NamedNode, !NamedNode):number} A standalone comparison function for\n   * this index\n   */\n  getCompare(): Comparator<NamedNode> {\n    return this.compare.bind(this);\n  }\n\n  /**\n   * Given a before and after value for a node, determine if the indexed value has changed. Even if they are different,\n   * it's possible that the changes are isolated to parts of the snapshot that are not indexed.\n   *\n   * @param {!Node} oldNode\n   * @param {!Node} newNode\n   * @return {boolean} True if the portion of the snapshot being indexed changed between oldNode and newNode\n   */\n  indexedValueChanged(oldNode: Node, newNode: Node): boolean {\n    const oldWrapped = new NamedNode(MIN_NAME, oldNode);\n    const newWrapped = new NamedNode(MIN_NAME, newNode);\n    return this.compare(oldWrapped, newWrapped) !== 0;\n  }\n\n  /**\n   * @return {!NamedNode} a node wrapper that will sort equal to or less than\n   * any other node wrapper, using this index\n   */\n  minPost(): NamedNode {\n    return (NamedNode as any).MIN;\n  }\n\n  /**\n   * @return {!NamedNode} a node wrapper that will sort greater than or equal to\n   * any other node wrapper, using this index\n   */\n  abstract maxPost(): NamedNode;\n\n  /**\n   * @param {*} indexValue\n   * @param {string} name\n   * @return {!NamedNode}\n   */\n  abstract makePost(indexValue: any, name: string): NamedNode;\n\n  /**\n   * @return {!string} String representation for inclusion in a query spec\n   */\n  abstract toString(): string;\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { doubleToIEEE754String, sha1 } from '../util/util';\nimport { priorityHashText, validatePriorityNode } from './snap';\nimport { Node } from './Node';\nimport { Path } from '../util/Path';\nimport { Index } from './indexes/Index';\nimport { ChildrenNodeConstructor } from './ChildrenNode';\n\nlet __childrenNodeConstructor: ChildrenNodeConstructor;\n\n/**\n * LeafNode is a class for storing leaf nodes in a DataSnapshot.  It\n * implements Node and stores the value of the node (a string,\n * number, or boolean) accessible via getValue().\n */\nexport class LeafNode implements Node {\n  static set __childrenNodeConstructor(val: ChildrenNodeConstructor) {\n    __childrenNodeConstructor = val;\n  }\n\n  static get __childrenNodeConstructor() {\n    return __childrenNodeConstructor;\n  }\n\n  /**\n   * The sort order for comparing leaf nodes of different types. If two leaf nodes have\n   * the same type, the comparison falls back to their value\n   * @type {Array.<!string>}\n   * @const\n   */\n  static VALUE_TYPE_ORDER = ['object', 'boolean', 'number', 'string'];\n\n  private lazyHash_: string | null = null;\n\n  /**\n   * @implements {Node}\n   * @param {!(string|number|boolean|Object)} value_ The value to store in this leaf node.\n   *                                         The object type is possible in the event of a deferred value\n   * @param {!Node=} priorityNode_ The priority of this node.\n   */\n  constructor(\n    private readonly value_: string | number | boolean | object,\n    private priorityNode_: Node = LeafNode.__childrenNodeConstructor.EMPTY_NODE\n  ) {\n    assert(\n      this.value_ !== undefined && this.value_ !== null,\n      \"LeafNode shouldn't be created with null/undefined value.\"\n    );\n\n    validatePriorityNode(this.priorityNode_);\n  }\n\n  /** @inheritDoc */\n  isLeafNode(): boolean {\n    return true;\n  }\n\n  /** @inheritDoc */\n  getPriority(): Node {\n    return this.priorityNode_;\n  }\n\n  /** @inheritDoc */\n  updatePriority(newPriorityNode: Node): Node {\n    return new LeafNode(this.value_, newPriorityNode);\n  }\n\n  /** @inheritDoc */\n  getImmediateChild(childName: string): Node {\n    // Hack to treat priority as a regular child\n    if (childName === '.priority') {\n      return this.priorityNode_;\n    } else {\n      return LeafNode.__childrenNodeConstructor.EMPTY_NODE;\n    }\n  }\n\n  /** @inheritDoc */\n  getChild(path: Path): Node {\n    if (path.isEmpty()) {\n      return this;\n    } else if (path.getFront() === '.priority') {\n      return this.priorityNode_;\n    } else {\n      return LeafNode.__childrenNodeConstructor.EMPTY_NODE;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  hasChild(): boolean {\n    return false;\n  }\n\n  /** @inheritDoc */\n  getPredecessorChildName(childName: String, childNode: Node): null {\n    return null;\n  }\n\n  /** @inheritDoc */\n  updateImmediateChild(childName: string, newChildNode: Node): Node {\n    if (childName === '.priority') {\n      return this.updatePriority(newChildNode);\n    } else if (newChildNode.isEmpty() && childName !== '.priority') {\n      return this;\n    } else {\n      return LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(\n        childName,\n        newChildNode\n      ).updatePriority(this.priorityNode_);\n    }\n  }\n\n  /** @inheritDoc */\n  updateChild(path: Path, newChildNode: Node): Node {\n    const front = path.getFront();\n    if (front === null) {\n      return newChildNode;\n    } else if (newChildNode.isEmpty() && front !== '.priority') {\n      return this;\n    } else {\n      assert(\n        front !== '.priority' || path.getLength() === 1,\n        '.priority must be the last token in a path'\n      );\n\n      return this.updateImmediateChild(\n        front,\n        LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(\n          path.popFront(),\n          newChildNode\n        )\n      );\n    }\n  }\n\n  /** @inheritDoc */\n  isEmpty(): boolean {\n    return false;\n  }\n\n  /** @inheritDoc */\n  numChildren(): number {\n    return 0;\n  }\n\n  /** @inheritDoc */\n  forEachChild(index: Index, action: (s: string, n: Node) => void): any {\n    return false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  val(exportFormat?: boolean): Object {\n    if (exportFormat && !this.getPriority().isEmpty())\n      return {\n        '.value': this.getValue(),\n        '.priority': this.getPriority().val()\n      };\n    else return this.getValue();\n  }\n\n  /** @inheritDoc */\n  hash(): string {\n    if (this.lazyHash_ === null) {\n      let toHash = '';\n      if (!this.priorityNode_.isEmpty())\n        toHash +=\n          'priority:' +\n          priorityHashText(this.priorityNode_.val() as number | string) +\n          ':';\n\n      const type = typeof this.value_;\n      toHash += type + ':';\n      if (type === 'number') {\n        toHash += doubleToIEEE754String(this.value_ as number);\n      } else {\n        toHash += this.value_;\n      }\n      this.lazyHash_ = sha1(toHash);\n    }\n    return this.lazyHash_;\n  }\n\n  /**\n   * Returns the value of the leaf node.\n   * @return {Object|string|number|boolean} The value of the node.\n   */\n  getValue(): object | string | number | boolean {\n    return this.value_;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  compareTo(other: Node): number {\n    if (other === LeafNode.__childrenNodeConstructor.EMPTY_NODE) {\n      return 1;\n    } else if (other instanceof LeafNode.__childrenNodeConstructor) {\n      return -1;\n    } else {\n      assert(other.isLeafNode(), 'Unknown node type');\n      return this.compareToLeafNode_(other as LeafNode);\n    }\n  }\n\n  /**\n   * Comparison specifically for two leaf nodes\n   * @param {!LeafNode} otherLeaf\n   * @return {!number}\n   * @private\n   */\n  private compareToLeafNode_(otherLeaf: LeafNode): number {\n    const otherLeafType = typeof otherLeaf.value_;\n    const thisLeafType = typeof this.value_;\n    const otherIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(otherLeafType);\n    const thisIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(thisLeafType);\n    assert(otherIndex >= 0, 'Unknown leaf type: ' + otherLeafType);\n    assert(thisIndex >= 0, 'Unknown leaf type: ' + thisLeafType);\n    if (otherIndex === thisIndex) {\n      // Same type, compare values\n      if (thisLeafType === 'object') {\n        // Deferred value nodes are all equal, but we should also never get to this point...\n        return 0;\n      } else {\n        // Note that this works because true > false, all others are number or string comparisons\n        if (this.value_ < otherLeaf.value_) {\n          return -1;\n        } else if (this.value_ === otherLeaf.value_) {\n          return 0;\n        } else {\n          return 1;\n        }\n      }\n    } else {\n      return thisIndex - otherIndex;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  withIndex(): Node {\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  isIndexed(): boolean {\n    return true;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  equals(other: Node): boolean {\n    /**\n     * @inheritDoc\n     */\n    if (other === this) {\n      return true;\n    } else if (other.isLeafNode()) {\n      const otherLeaf = other as LeafNode;\n      return (\n        this.value_ === otherLeaf.value_ &&\n        this.priorityNode_.equals(otherLeaf.priorityNode_)\n      );\n    } else {\n      return false;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Index } from './Index';\nimport { nameCompare, MAX_NAME } from '../../util/util';\nimport { NamedNode, Node } from '../Node';\nimport { LeafNode } from '../LeafNode';\n\nlet nodeFromJSON: (a: any) => Node;\nlet MAX_NODE: Node;\n\nexport function setNodeFromJSON(val: (a: any) => Node) {\n  nodeFromJSON = val;\n}\n\nexport function setMaxNode(val: Node) {\n  MAX_NODE = val;\n}\n\n/**\n * @constructor\n * @extends {Index}\n * @private\n */\nexport class PriorityIndex extends Index {\n  /**\n   * @inheritDoc\n   */\n  compare(a: NamedNode, b: NamedNode): number {\n    const aPriority = a.node.getPriority();\n    const bPriority = b.node.getPriority();\n    const indexCmp = aPriority.compareTo(bPriority);\n    if (indexCmp === 0) {\n      return nameCompare(a.name, b.name);\n    } else {\n      return indexCmp;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  isDefinedOn(node: Node): boolean {\n    return !node.getPriority().isEmpty();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  indexedValueChanged(oldNode: Node, newNode: Node): boolean {\n    return !oldNode.getPriority().equals(newNode.getPriority());\n  }\n\n  /**\n   * @inheritDoc\n   */\n  minPost(): NamedNode {\n    return (NamedNode as any).MIN;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  maxPost(): NamedNode {\n    return new NamedNode(MAX_NAME, new LeafNode('[PRIORITY-POST]', MAX_NODE));\n  }\n\n  /**\n   * @param {*} indexValue\n   * @param {string} name\n   * @return {!NamedNode}\n   */\n  makePost(indexValue: any, name: string): NamedNode {\n    const priorityNode = nodeFromJSON(indexValue);\n    return new NamedNode(name, new LeafNode('[PRIORITY-POST]', priorityNode));\n  }\n\n  /**\n   * @return {!string} String representation for inclusion in a query spec\n   */\n  toString(): string {\n    return '.priority';\n  }\n}\n\nexport const PRIORITY_INDEX = new PriorityIndex();\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { buildChildSet } from './childSet';\nimport { contains, map, safeGet } from '@firebase/util';\nimport { NamedNode, Node } from './Node';\nimport { PRIORITY_INDEX } from './indexes/PriorityIndex';\nimport { KEY_INDEX } from './indexes/KeyIndex';\nimport { SortedMap } from '../util/SortedMap';\nimport { Index } from './indexes/Index';\n\nlet _defaultIndexMap: IndexMap;\n\nconst fallbackObject = {};\n\nexport class IndexMap {\n  /**\n   * The default IndexMap for nodes without a priority\n   */\n  static get Default(): IndexMap {\n    assert(\n      fallbackObject && PRIORITY_INDEX,\n      'ChildrenNode.ts has not been loaded'\n    );\n    _defaultIndexMap =\n      _defaultIndexMap ||\n      new IndexMap(\n        { '.priority': fallbackObject },\n        { '.priority': PRIORITY_INDEX }\n      );\n    return _defaultIndexMap;\n  }\n\n  constructor(\n    private indexes_: {\n      [k: string]: SortedMap<NamedNode, Node> | /*FallbackType*/ object;\n    },\n    private indexSet_: { [k: string]: Index }\n  ) {}\n\n  get(indexKey: string): SortedMap<NamedNode, Node> | null {\n    const sortedMap = safeGet(this.indexes_, indexKey);\n    if (!sortedMap) throw new Error('No index defined for ' + indexKey);\n\n    if (sortedMap instanceof SortedMap) {\n      return sortedMap;\n    } else {\n      // The index exists, but it falls back to just name comparison. Return null so that the calling code uses the\n      // regular child map\n      return null;\n    }\n  }\n\n  hasIndex(indexDefinition: Index): boolean {\n    return contains(this.indexSet_, indexDefinition.toString());\n  }\n\n  addIndex(\n    indexDefinition: Index,\n    existingChildren: SortedMap<string, Node>\n  ): IndexMap {\n    assert(\n      indexDefinition !== KEY_INDEX,\n      \"KeyIndex always exists and isn't meant to be added to the IndexMap.\"\n    );\n    const childList = [];\n    let sawIndexedValue = false;\n    const iter = existingChildren.getIterator(NamedNode.Wrap);\n    let next = iter.getNext();\n    while (next) {\n      sawIndexedValue =\n        sawIndexedValue || indexDefinition.isDefinedOn(next.node);\n      childList.push(next);\n      next = iter.getNext();\n    }\n    let newIndex;\n    if (sawIndexedValue) {\n      newIndex = buildChildSet(childList, indexDefinition.getCompare());\n    } else {\n      newIndex = fallbackObject;\n    }\n    const indexName = indexDefinition.toString();\n    const newIndexSet = { ...this.indexSet_ };\n    newIndexSet[indexName] = indexDefinition;\n    const newIndexes = { ...this.indexes_ };\n    newIndexes[indexName] = newIndex;\n    return new IndexMap(newIndexes, newIndexSet);\n  }\n\n  /**\n   * Ensure that this node is properly tracked in any indexes that we're maintaining\n   */\n  addToIndexes(\n    namedNode: NamedNode,\n    existingChildren: SortedMap<string, Node>\n  ): IndexMap {\n    const newIndexes = map(\n      this.indexes_,\n      (indexedChildren: SortedMap<NamedNode, Node>, indexName: string) => {\n        const index = safeGet(this.indexSet_, indexName);\n        assert(index, 'Missing index implementation for ' + indexName);\n        if (indexedChildren === fallbackObject) {\n          // Check to see if we need to index everything\n          if (index.isDefinedOn(namedNode.node)) {\n            // We need to build this index\n            const childList = [];\n            const iter = existingChildren.getIterator(NamedNode.Wrap);\n            let next = iter.getNext();\n            while (next) {\n              if (next.name != namedNode.name) {\n                childList.push(next);\n              }\n              next = iter.getNext();\n            }\n            childList.push(namedNode);\n            return buildChildSet(childList, index.getCompare());\n          } else {\n            // No change, this remains a fallback\n            return fallbackObject;\n          }\n        } else {\n          const existingSnap = existingChildren.get(namedNode.name);\n          let newChildren = indexedChildren;\n          if (existingSnap) {\n            newChildren = newChildren.remove(\n              new NamedNode(namedNode.name, existingSnap)\n            );\n          }\n          return newChildren.insert(namedNode, namedNode.node);\n        }\n      }\n    );\n    return new IndexMap(newIndexes, this.indexSet_);\n  }\n\n  /**\n   * Create a new IndexMap instance with the given value removed\n   */\n  removeFromIndexes(\n    namedNode: NamedNode,\n    existingChildren: SortedMap<string, Node>\n  ): IndexMap {\n    const newIndexes = map(this.indexes_, function(\n      indexedChildren: SortedMap<NamedNode, Node>\n    ) {\n      if (indexedChildren === fallbackObject) {\n        // This is the fallback. Just return it, nothing to do in this case\n        return indexedChildren;\n      } else {\n        const existingSnap = existingChildren.get(namedNode.name);\n        if (existingSnap) {\n          return indexedChildren.remove(\n            new NamedNode(namedNode.name, existingSnap)\n          );\n        } else {\n          // No record of this child\n          return indexedChildren;\n        }\n      }\n    });\n    return new IndexMap(newIndexes, this.indexSet_);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { sha1, MAX_NAME, MIN_NAME } from '../util/util';\nimport { SortedMap, SortedMapIterator } from '../util/SortedMap';\nimport { Node, NamedNode } from './Node';\nimport { validatePriorityNode, priorityHashText, setMaxNode } from './snap';\nimport {\n  PRIORITY_INDEX,\n  setMaxNode as setPriorityMaxNode\n} from './indexes/PriorityIndex';\nimport { KEY_INDEX, KeyIndex } from './indexes/KeyIndex';\nimport { IndexMap } from './IndexMap';\nimport { LeafNode } from './LeafNode';\nimport { NAME_COMPARATOR } from './comparators';\nimport { Index } from './indexes/Index';\nimport { Path } from '../util/Path';\n\nexport interface ChildrenNodeConstructor {\n  new (\n    children_: SortedMap<string, Node>,\n    priorityNode_: Node | null,\n    indexMap_: IndexMap\n  ): ChildrenNode;\n  EMPTY_NODE: ChildrenNode;\n}\n\n// TODO: For memory savings, don't store priorityNode_ if it's empty.\n\nlet EMPTY_NODE: ChildrenNode;\n\n/**\n * ChildrenNode is a class for storing internal nodes in a DataSnapshot\n * (i.e. nodes with children).  It implements Node and stores the\n * list of children in the children property, sorted by child name.\n *\n * @constructor\n * @implements {Node}\n */\nexport class ChildrenNode implements Node {\n  private lazyHash_: string | null = null;\n\n  static get EMPTY_NODE(): ChildrenNode {\n    return (\n      EMPTY_NODE ||\n      (EMPTY_NODE = new ChildrenNode(\n        new SortedMap<string, Node>(NAME_COMPARATOR),\n        null,\n        IndexMap.Default\n      ))\n    );\n  }\n\n  /**\n   *\n   * @param {!SortedMap.<string, !Node>} children_ List of children\n   * of this node..\n   * @param {?Node} priorityNode_ The priority of this node (as a snapshot node).\n   * @param {!IndexMap} indexMap_\n   */\n  constructor(\n    private readonly children_: SortedMap<string, Node>,\n    private readonly priorityNode_: Node | null,\n    private indexMap_: IndexMap\n  ) {\n    /**\n     * Note: The only reason we allow null priority is for EMPTY_NODE, since we can't use\n     * EMPTY_NODE as the priority of EMPTY_NODE.  We might want to consider making EMPTY_NODE its own\n     * class instead of an empty ChildrenNode.\n     */\n    if (this.priorityNode_) {\n      validatePriorityNode(this.priorityNode_);\n    }\n\n    if (this.children_.isEmpty()) {\n      assert(\n        !this.priorityNode_ || this.priorityNode_.isEmpty(),\n        'An empty node cannot have a priority'\n      );\n    }\n  }\n\n  /** @inheritDoc */\n  isLeafNode(): boolean {\n    return false;\n  }\n\n  /** @inheritDoc */\n  getPriority(): Node {\n    return this.priorityNode_ || EMPTY_NODE;\n  }\n\n  /** @inheritDoc */\n  updatePriority(newPriorityNode: Node): Node {\n    if (this.children_.isEmpty()) {\n      // Don't allow priorities on empty nodes\n      return this;\n    } else {\n      return new ChildrenNode(this.children_, newPriorityNode, this.indexMap_);\n    }\n  }\n\n  /** @inheritDoc */\n  getImmediateChild(childName: string): Node {\n    // Hack to treat priority as a regular child\n    if (childName === '.priority') {\n      return this.getPriority();\n    } else {\n      const child = this.children_.get(childName);\n      return child === null ? EMPTY_NODE : child;\n    }\n  }\n\n  /** @inheritDoc */\n  getChild(path: Path): Node {\n    const front = path.getFront();\n    if (front === null) return this;\n\n    return this.getImmediateChild(front).getChild(path.popFront());\n  }\n\n  /** @inheritDoc */\n  hasChild(childName: string): boolean {\n    return this.children_.get(childName) !== null;\n  }\n\n  /** @inheritDoc */\n  updateImmediateChild(childName: string, newChildNode: Node): Node {\n    assert(newChildNode, 'We should always be passing snapshot nodes');\n    if (childName === '.priority') {\n      return this.updatePriority(newChildNode);\n    } else {\n      const namedNode = new NamedNode(childName, newChildNode);\n      let newChildren, newIndexMap, newPriority;\n      if (newChildNode.isEmpty()) {\n        newChildren = this.children_.remove(childName);\n        newIndexMap = this.indexMap_.removeFromIndexes(\n          namedNode,\n          this.children_\n        );\n      } else {\n        newChildren = this.children_.insert(childName, newChildNode);\n        newIndexMap = this.indexMap_.addToIndexes(namedNode, this.children_);\n      }\n\n      newPriority = newChildren.isEmpty() ? EMPTY_NODE : this.priorityNode_;\n      return new ChildrenNode(newChildren, newPriority, newIndexMap);\n    }\n  }\n\n  /** @inheritDoc */\n  updateChild(path: Path, newChildNode: Node): Node {\n    const front = path.getFront();\n    if (front === null) {\n      return newChildNode;\n    } else {\n      assert(\n        path.getFront() !== '.priority' || path.getLength() === 1,\n        '.priority must be the last token in a path'\n      );\n      const newImmediateChild = this.getImmediateChild(front).updateChild(\n        path.popFront(),\n        newChildNode\n      );\n      return this.updateImmediateChild(front, newImmediateChild);\n    }\n  }\n\n  /** @inheritDoc */\n  isEmpty(): boolean {\n    return this.children_.isEmpty();\n  }\n\n  /** @inheritDoc */\n  numChildren(): number {\n    return this.children_.count();\n  }\n\n  /**\n   * @private\n   * @type {RegExp}\n   */\n  private static INTEGER_REGEXP_ = /^(0|[1-9]\\d*)$/;\n\n  /** @inheritDoc */\n  val(exportFormat?: boolean): object {\n    if (this.isEmpty()) return null;\n\n    const obj: { [k: string]: unknown } = {};\n    let numKeys = 0,\n      maxKey = 0,\n      allIntegerKeys = true;\n    this.forEachChild(PRIORITY_INDEX, function(key: string, childNode: Node) {\n      obj[key] = childNode.val(exportFormat);\n\n      numKeys++;\n      if (allIntegerKeys && ChildrenNode.INTEGER_REGEXP_.test(key)) {\n        maxKey = Math.max(maxKey, Number(key));\n      } else {\n        allIntegerKeys = false;\n      }\n    });\n\n    if (!exportFormat && allIntegerKeys && maxKey < 2 * numKeys) {\n      // convert to array.\n      const array: unknown[] = [];\n      for (let key in obj) array[(key as any) as number] = obj[key];\n\n      return array;\n    } else {\n      if (exportFormat && !this.getPriority().isEmpty()) {\n        obj['.priority'] = this.getPriority().val();\n      }\n      return obj;\n    }\n  }\n\n  /** @inheritDoc */\n  hash(): string {\n    if (this.lazyHash_ === null) {\n      let toHash = '';\n      if (!this.getPriority().isEmpty())\n        toHash +=\n          'priority:' +\n          priorityHashText(this.getPriority().val() as string | number) +\n          ':';\n\n      this.forEachChild(PRIORITY_INDEX, function(key, childNode) {\n        const childHash = childNode.hash();\n        if (childHash !== '') toHash += ':' + key + ':' + childHash;\n      });\n\n      this.lazyHash_ = toHash === '' ? '' : sha1(toHash);\n    }\n    return this.lazyHash_;\n  }\n\n  /** @inheritDoc */\n  getPredecessorChildName(\n    childName: string,\n    childNode: Node,\n    index: Index\n  ): string {\n    const idx = this.resolveIndex_(index);\n    if (idx) {\n      const predecessor = idx.getPredecessorKey(\n        new NamedNode(childName, childNode)\n      );\n      return predecessor ? predecessor.name : null;\n    } else {\n      return this.children_.getPredecessorKey(childName);\n    }\n  }\n\n  /**\n   * @param {!Index} indexDefinition\n   * @return {?string}\n   */\n  getFirstChildName(indexDefinition: Index): string | null {\n    const idx = this.resolveIndex_(indexDefinition);\n    if (idx) {\n      const minKey = idx.minKey();\n      return minKey && minKey.name;\n    } else {\n      return this.children_.minKey();\n    }\n  }\n\n  /**\n   * @param {!Index} indexDefinition\n   * @return {?NamedNode}\n   */\n  getFirstChild(indexDefinition: Index): NamedNode | null {\n    const minKey = this.getFirstChildName(indexDefinition);\n    if (minKey) {\n      return new NamedNode(minKey, this.children_.get(minKey));\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Given an index, return the key name of the largest value we have, according to that index\n   * @param {!Index} indexDefinition\n   * @return {?string}\n   */\n  getLastChildName(indexDefinition: Index): string | null {\n    const idx = this.resolveIndex_(indexDefinition);\n    if (idx) {\n      const maxKey = idx.maxKey();\n      return maxKey && maxKey.name;\n    } else {\n      return this.children_.maxKey();\n    }\n  }\n\n  /**\n   * @param {!Index} indexDefinition\n   * @return {?NamedNode}\n   */\n  getLastChild(indexDefinition: Index): NamedNode | null {\n    const maxKey = this.getLastChildName(indexDefinition);\n    if (maxKey) {\n      return new NamedNode(maxKey, this.children_.get(maxKey));\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  forEachChild(\n    index: Index,\n    action: (key: string, node: Node) => boolean | void\n  ): boolean {\n    const idx = this.resolveIndex_(index);\n    if (idx) {\n      return idx.inorderTraversal(function(wrappedNode) {\n        return action(wrappedNode.name, wrappedNode.node);\n      });\n    } else {\n      return this.children_.inorderTraversal(action);\n    }\n  }\n\n  /**\n   * @param {!Index} indexDefinition\n   * @return {SortedMapIterator}\n   */\n  getIterator(\n    indexDefinition: Index\n  ): SortedMapIterator<string | NamedNode, Node, NamedNode> {\n    return this.getIteratorFrom(indexDefinition.minPost(), indexDefinition);\n  }\n\n  /**\n   *\n   * @param {!NamedNode} startPost\n   * @param {!Index} indexDefinition\n   * @return {!SortedMapIterator}\n   */\n  getIteratorFrom(\n    startPost: NamedNode,\n    indexDefinition: Index\n  ): SortedMapIterator<string | NamedNode, Node, NamedNode> {\n    const idx = this.resolveIndex_(indexDefinition);\n    if (idx) {\n      return idx.getIteratorFrom(startPost, key => key);\n    } else {\n      const iterator = this.children_.getIteratorFrom(\n        startPost.name,\n        NamedNode.Wrap\n      );\n      let next = iterator.peek();\n      while (next != null && indexDefinition.compare(next, startPost) < 0) {\n        iterator.getNext();\n        next = iterator.peek();\n      }\n      return iterator;\n    }\n  }\n\n  /**\n   * @param {!Index} indexDefinition\n   * @return {!SortedMapIterator}\n   */\n  getReverseIterator(\n    indexDefinition: Index\n  ): SortedMapIterator<string | NamedNode, Node, NamedNode> {\n    return this.getReverseIteratorFrom(\n      indexDefinition.maxPost(),\n      indexDefinition\n    );\n  }\n\n  /**\n   * @param {!NamedNode} endPost\n   * @param {!Index} indexDefinition\n   * @return {!SortedMapIterator}\n   */\n  getReverseIteratorFrom(\n    endPost: NamedNode,\n    indexDefinition: Index\n  ): SortedMapIterator<string | NamedNode, Node, NamedNode> {\n    const idx = this.resolveIndex_(indexDefinition);\n    if (idx) {\n      return idx.getReverseIteratorFrom(endPost, function(key) {\n        return key;\n      });\n    } else {\n      const iterator = this.children_.getReverseIteratorFrom(\n        endPost.name,\n        NamedNode.Wrap\n      );\n      let next = iterator.peek();\n      while (next != null && indexDefinition.compare(next, endPost) > 0) {\n        iterator.getNext();\n        next = iterator.peek();\n      }\n      return iterator;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  compareTo(other: ChildrenNode): number {\n    if (this.isEmpty()) {\n      if (other.isEmpty()) {\n        return 0;\n      } else {\n        return -1;\n      }\n    } else if (other.isLeafNode() || other.isEmpty()) {\n      return 1;\n    } else if (other === MAX_NODE) {\n      return -1;\n    } else {\n      // Must be another node with children.\n      return 0;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  withIndex(indexDefinition: Index): Node {\n    if (\n      indexDefinition === KEY_INDEX ||\n      this.indexMap_.hasIndex(indexDefinition)\n    ) {\n      return this;\n    } else {\n      const newIndexMap = this.indexMap_.addIndex(\n        indexDefinition,\n        this.children_\n      );\n      return new ChildrenNode(this.children_, this.priorityNode_, newIndexMap);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  isIndexed(index: Index): boolean {\n    return index === KEY_INDEX || this.indexMap_.hasIndex(index);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  equals(other: Node): boolean {\n    if (other === this) {\n      return true;\n    } else if (other.isLeafNode()) {\n      return false;\n    } else {\n      const otherChildrenNode = other as ChildrenNode;\n      if (!this.getPriority().equals(otherChildrenNode.getPriority())) {\n        return false;\n      } else if (\n        this.children_.count() === otherChildrenNode.children_.count()\n      ) {\n        const thisIter = this.getIterator(PRIORITY_INDEX);\n        const otherIter = otherChildrenNode.getIterator(PRIORITY_INDEX);\n        let thisCurrent = thisIter.getNext();\n        let otherCurrent = otherIter.getNext();\n        while (thisCurrent && otherCurrent) {\n          if (\n            thisCurrent.name !== otherCurrent.name ||\n            !thisCurrent.node.equals(otherCurrent.node)\n          ) {\n            return false;\n          }\n          thisCurrent = thisIter.getNext();\n          otherCurrent = otherIter.getNext();\n        }\n        return thisCurrent === null && otherCurrent === null;\n      } else {\n        return false;\n      }\n    }\n  }\n\n  /**\n   * Returns a SortedMap ordered by index, or null if the default (by-key) ordering can be used\n   * instead.\n   *\n   * @private\n   * @param {!Index} indexDefinition\n   * @return {?SortedMap.<NamedNode, Node>}\n   */\n  private resolveIndex_(\n    indexDefinition: Index\n  ): SortedMap<NamedNode, Node> | null {\n    if (indexDefinition === KEY_INDEX) {\n      return null;\n    } else {\n      return this.indexMap_.get(indexDefinition.toString());\n    }\n  }\n}\n\n/**\n * @constructor\n * @extends {ChildrenNode}\n * @private\n */\nexport class MaxNode extends ChildrenNode {\n  constructor() {\n    super(\n      new SortedMap<string, Node>(NAME_COMPARATOR),\n      ChildrenNode.EMPTY_NODE,\n      IndexMap.Default\n    );\n  }\n\n  compareTo(other: Node): number {\n    if (other === this) {\n      return 0;\n    } else {\n      return 1;\n    }\n  }\n\n  equals(other: Node): boolean {\n    // Not that we every compare it, but MAX_NODE is only ever equal to itself\n    return other === this;\n  }\n\n  getPriority(): MaxNode {\n    return this;\n  }\n\n  getImmediateChild(childName: string): ChildrenNode {\n    return ChildrenNode.EMPTY_NODE;\n  }\n\n  isEmpty(): boolean {\n    return false;\n  }\n}\n\n/**\n * Marker that will sort higher than any other snapshot.\n * @type {!MAX_NODE}\n * @const\n */\nexport const MAX_NODE = new MaxNode();\n\n/**\n * Document NamedNode extensions\n */\ndeclare module './Node' {\n  interface NamedNode {\n    MIN: NamedNode;\n    MAX: NamedNode;\n  }\n}\n\nObject.defineProperties(NamedNode, {\n  MIN: {\n    value: new NamedNode(MIN_NAME, ChildrenNode.EMPTY_NODE)\n  },\n  MAX: {\n    value: new NamedNode(MAX_NAME, MAX_NODE)\n  }\n});\n\n/**\n * Reference Extensions\n */\nKeyIndex.__EMPTY_NODE = ChildrenNode.EMPTY_NODE;\nLeafNode.__childrenNodeConstructor = ChildrenNode;\nsetMaxNode(MAX_NODE);\nsetPriorityMaxNode(MAX_NODE);\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Implementation of an immutable SortedMap using a Left-leaning\n * Red-Black Tree, adapted from the implementation in Mugs\n * (http://mads379.github.com/mugs/) by Mads Hartmann Jensen\n * (mads379@gmail.com).\n *\n * Original paper on Left-leaning Red-Black Trees:\n *   http://www.cs.princeton.edu/~rs/talks/LLRB/LLRB.pdf\n *\n * Invariant 1: No red node has a red child\n * Invariant 2: Every leaf path has the same number of black nodes\n * Invariant 3: Only the left child can be red (left leaning)\n */\n\n// TODO: There are some improvements I'd like to make to improve memory / perf:\n//  * Create two prototypes, LLRedNode and LLBlackNode, instead of storing a\n//    color property in every node.\n// TODO: It would also be good (and possibly necessary) to create a base\n// interface for LLRBNode and LLRBEmptyNode.\n\nexport type Comparator<K> = (key1: K, key2: K) => number;\n\n/**\n * An iterator over an LLRBNode.\n */\nexport class SortedMapIterator<K, V, T> {\n  /** @private\n   * @type {Array.<!LLRBNode>}\n   */\n  private nodeStack_: (LLRBNode<K, V> | LLRBEmptyNode<K, V>)[] = [];\n\n  /**\n   * @template K, V, T\n   * @param {LLRBNode|LLRBEmptyNode} node Node to iterate.\n   * @param {?K} startKey\n   * @param {function(K, K): number} comparator\n   * @param {boolean} isReverse_ Whether or not to iterate in reverse\n   * @param {(function(K, V):T)=} resultGenerator_\n   */\n  constructor(\n    node: LLRBNode<K, V> | LLRBEmptyNode<K, V>,\n    startKey: K | null,\n    comparator: Comparator<K>,\n    private isReverse_: boolean,\n    private resultGenerator_: ((k: K, v: V) => T) | null = null\n  ) {\n    let cmp = 1;\n    while (!node.isEmpty()) {\n      node = node as LLRBNode<K, V>;\n      cmp = startKey ? comparator(node.key, startKey) : 1;\n      // flip the comparison if we're going in reverse\n      if (isReverse_) cmp *= -1;\n\n      if (cmp < 0) {\n        // This node is less than our start key. ignore it\n        if (this.isReverse_) {\n          node = node.left;\n        } else {\n          node = node.right;\n        }\n      } else if (cmp === 0) {\n        // This node is exactly equal to our start key. Push it on the stack, but stop iterating;\n        this.nodeStack_.push(node);\n        break;\n      } else {\n        // This node is greater than our start key, add it to the stack and move to the next one\n        this.nodeStack_.push(node);\n        if (this.isReverse_) {\n          node = node.right;\n        } else {\n          node = node.left;\n        }\n      }\n    }\n  }\n\n  getNext(): T {\n    if (this.nodeStack_.length === 0) return null;\n\n    let node = this.nodeStack_.pop();\n    let result: T;\n    if (this.resultGenerator_)\n      result = this.resultGenerator_(node.key, node.value);\n    else result = { key: node.key, value: node.value } as any;\n\n    if (this.isReverse_) {\n      node = node.left;\n      while (!node.isEmpty()) {\n        this.nodeStack_.push(node);\n        node = node.right;\n      }\n    } else {\n      node = node.right;\n      while (!node.isEmpty()) {\n        this.nodeStack_.push(node);\n        node = node.left;\n      }\n    }\n\n    return result;\n  }\n\n  hasNext(): boolean {\n    return this.nodeStack_.length > 0;\n  }\n\n  peek(): T {\n    if (this.nodeStack_.length === 0) return null;\n\n    const node = this.nodeStack_[this.nodeStack_.length - 1];\n    if (this.resultGenerator_) {\n      return this.resultGenerator_(node.key, node.value);\n    } else {\n      return { key: node.key, value: node.value } as any;\n    }\n  }\n}\n\n/**\n * Represents a node in a Left-leaning Red-Black tree.\n */\nexport class LLRBNode<K, V> {\n  color: boolean;\n  left: LLRBNode<K, V> | LLRBEmptyNode<K, V>;\n  right: LLRBNode<K, V> | LLRBEmptyNode<K, V>;\n\n  /**\n   * @template K, V\n   * @param {!K} key Key associated with this node.\n   * @param {!V} value Value associated with this node.\n   * @param {?boolean} color Whether this node is red.\n   * @param {?(LLRBNode|LLRBEmptyNode)=} left Left child.\n   * @param {?(LLRBNode|LLRBEmptyNode)=} right Right child.\n   */\n  constructor(\n    public key: K,\n    public value: V,\n    color: boolean | null,\n    left?: LLRBNode<K, V> | LLRBEmptyNode<K, V> | null,\n    right?: LLRBNode<K, V> | LLRBEmptyNode<K, V> | null\n  ) {\n    this.color = color != null ? color : LLRBNode.RED;\n    this.left =\n      left != null ? left : (SortedMap.EMPTY_NODE as LLRBEmptyNode<K, V>);\n    this.right =\n      right != null ? right : (SortedMap.EMPTY_NODE as LLRBEmptyNode<K, V>);\n  }\n\n  static RED = true;\n  static BLACK = false;\n\n  /**\n   * Returns a copy of the current node, optionally replacing pieces of it.\n   *\n   * @param {?K} key New key for the node, or null.\n   * @param {?V} value New value for the node, or null.\n   * @param {?boolean} color New color for the node, or null.\n   * @param {?LLRBNode|LLRBEmptyNode} left New left child for the node, or null.\n   * @param {?LLRBNode|LLRBEmptyNode} right New right child for the node, or null.\n   * @return {!LLRBNode} The node copy.\n   */\n  copy(\n    key: K | null,\n    value: V | null,\n    color: boolean | null,\n    left: LLRBNode<K, V> | LLRBEmptyNode<K, V> | null,\n    right: LLRBNode<K, V> | LLRBEmptyNode<K, V> | null\n  ): LLRBNode<K, V> {\n    return new LLRBNode(\n      key != null ? key : this.key,\n      value != null ? value : this.value,\n      color != null ? color : this.color,\n      left != null ? left : this.left,\n      right != null ? right : this.right\n    );\n  }\n\n  /**\n   * @return {number} The total number of nodes in the tree.\n   */\n  count(): number {\n    return this.left.count() + 1 + this.right.count();\n  }\n\n  /**\n   * @return {boolean} True if the tree is empty.\n   */\n  isEmpty(): boolean {\n    return false;\n  }\n\n  /**\n   * Traverses the tree in key order and calls the specified action function\n   * for each node.\n   *\n   * @param {function(!K, !V):*} action Callback function to be called for each\n   *   node.  If it returns true, traversal is aborted.\n   * @return {*} The first truthy value returned by action, or the last falsey\n   *   value returned by action\n   */\n  inorderTraversal(action: (k: K, v: V) => any): boolean {\n    return (\n      this.left.inorderTraversal(action) ||\n      action(this.key, this.value) ||\n      this.right.inorderTraversal(action)\n    );\n  }\n\n  /**\n   * Traverses the tree in reverse key order and calls the specified action function\n   * for each node.\n   *\n   * @param {function(!Object, !Object)} action Callback function to be called for each\n   * node.  If it returns true, traversal is aborted.\n   * @return {*} True if traversal was aborted.\n   */\n  reverseTraversal(action: (k: K, v: V) => void): boolean {\n    return (\n      this.right.reverseTraversal(action) ||\n      action(this.key, this.value) ||\n      this.left.reverseTraversal(action)\n    );\n  }\n\n  /**\n   * @return {!Object} The minimum node in the tree.\n   * @private\n   */\n  private min_(): LLRBNode<K, V> {\n    if (this.left.isEmpty()) {\n      return this;\n    } else {\n      return (this.left as LLRBNode<K, V>).min_();\n    }\n  }\n\n  /**\n   * @return {!K} The maximum key in the tree.\n   */\n  minKey(): K {\n    return this.min_().key;\n  }\n\n  /**\n   * @return {!K} The maximum key in the tree.\n   */\n  maxKey(): K {\n    if (this.right.isEmpty()) {\n      return this.key;\n    } else {\n      return this.right.maxKey();\n    }\n  }\n\n  /**\n   *\n   * @param {!Object} key Key to insert.\n   * @param {!Object} value Value to insert.\n   * @param {Comparator} comparator Comparator.\n   * @return {!LLRBNode} New tree, with the key/value added.\n   */\n  insert(key: K, value: V, comparator: Comparator<K>): LLRBNode<K, V> {\n    let cmp, n;\n    n = this;\n    cmp = comparator(key, n.key);\n    if (cmp < 0) {\n      n = n.copy(null, null, null, n.left.insert(key, value, comparator), null);\n    } else if (cmp === 0) {\n      n = n.copy(null, value, null, null, null);\n    } else {\n      n = n.copy(\n        null,\n        null,\n        null,\n        null,\n        n.right.insert(key, value, comparator)\n      );\n    }\n    return n.fixUp_();\n  }\n\n  /**\n   * @private\n   * @return {!LLRBNode|LLRBEmptyNode} New tree, with the minimum key removed.\n   */\n  private removeMin_(): LLRBNode<K, V> | LLRBEmptyNode<K, V> {\n    if (this.left.isEmpty()) {\n      return SortedMap.EMPTY_NODE as LLRBEmptyNode<K, V>;\n    }\n    let n: LLRBNode<K, V> = this;\n    if (!n.left.isRed_() && !n.left.left.isRed_()) n = n.moveRedLeft_();\n    n = n.copy(null, null, null, (n.left as LLRBNode<K, V>).removeMin_(), null);\n    return n.fixUp_();\n  }\n\n  /**\n   * @param {!Object} key The key of the item to remove.\n   * @param {Comparator} comparator Comparator.\n   * @return {!LLRBNode|LLRBEmptyNode} New tree, with the specified item removed.\n   */\n  remove(\n    key: K,\n    comparator: Comparator<K>\n  ): LLRBNode<K, V> | LLRBEmptyNode<K, V> {\n    let n, smallest;\n    n = this;\n    if (comparator(key, n.key) < 0) {\n      if (!n.left.isEmpty() && !n.left.isRed_() && !n.left.left.isRed_()) {\n        n = n.moveRedLeft_();\n      }\n      n = n.copy(null, null, null, n.left.remove(key, comparator), null);\n    } else {\n      if (n.left.isRed_()) n = n.rotateRight_();\n      if (!n.right.isEmpty() && !n.right.isRed_() && !n.right.left.isRed_()) {\n        n = n.moveRedRight_();\n      }\n      if (comparator(key, n.key) === 0) {\n        if (n.right.isEmpty()) {\n          return SortedMap.EMPTY_NODE as LLRBEmptyNode<K, V>;\n        } else {\n          smallest = (n.right as LLRBNode<K, V>).min_();\n          n = n.copy(\n            smallest.key,\n            smallest.value,\n            null,\n            null,\n            (n.right as LLRBNode<K, V>).removeMin_()\n          );\n        }\n      }\n      n = n.copy(null, null, null, null, n.right.remove(key, comparator));\n    }\n    return n.fixUp_();\n  }\n\n  /**\n   * @private\n   * @return {boolean} Whether this is a RED node.\n   */\n  isRed_(): boolean {\n    return this.color;\n  }\n\n  /**\n   * @private\n   * @return {!LLRBNode} New tree after performing any needed rotations.\n   */\n  private fixUp_(): LLRBNode<K, V> {\n    let n = this as any;\n    if (n.right.isRed_() && !n.left.isRed_()) n = n.rotateLeft_();\n    if (n.left.isRed_() && n.left.left.isRed_()) n = n.rotateRight_();\n    if (n.left.isRed_() && n.right.isRed_()) n = n.colorFlip_();\n    return n;\n  }\n\n  /**\n   * @private\n   * @return {!LLRBNode} New tree, after moveRedLeft.\n   */\n  private moveRedLeft_(): LLRBNode<K, V> {\n    let n = this.colorFlip_();\n    if (n.right.left.isRed_()) {\n      n = n.copy(\n        null,\n        null,\n        null,\n        null,\n        (n.right as LLRBNode<K, V>).rotateRight_()\n      );\n      n = n.rotateLeft_();\n      n = n.colorFlip_();\n    }\n    return n;\n  }\n\n  /**\n   * @private\n   * @return {!LLRBNode} New tree, after moveRedRight.\n   */\n  private moveRedRight_(): LLRBNode<K, V> {\n    let n = this.colorFlip_();\n    if (n.left.left.isRed_()) {\n      n = n.rotateRight_();\n      n = n.colorFlip_();\n    }\n    return n;\n  }\n\n  /**\n   * @private\n   * @return {!LLRBNode} New tree, after rotateLeft.\n   */\n  private rotateLeft_(): LLRBNode<K, V> {\n    const nl = this.copy(null, null, LLRBNode.RED, null, this.right.left);\n    return this.right.copy(null, null, this.color, nl, null) as LLRBNode<K, V>;\n  }\n\n  /**\n   * @private\n   * @return {!LLRBNode} New tree, after rotateRight.\n   */\n  private rotateRight_(): LLRBNode<K, V> {\n    const nr = this.copy(null, null, LLRBNode.RED, this.left.right, null);\n    return this.left.copy(null, null, this.color, null, nr) as LLRBNode<K, V>;\n  }\n\n  /**\n   * @private\n   * @return {!LLRBNode} New tree, after colorFlip.\n   */\n  private colorFlip_(): LLRBNode<K, V> {\n    const left = this.left.copy(null, null, !this.left.color, null, null);\n    const right = this.right.copy(null, null, !this.right.color, null, null);\n    return this.copy(null, null, !this.color, left, right);\n  }\n\n  /**\n   * For testing.\n   *\n   * @private\n   * @return {boolean} True if all is well.\n   */\n  private checkMaxDepth_(): boolean {\n    const blackDepth = this.check_();\n    return Math.pow(2.0, blackDepth) <= this.count() + 1;\n  }\n\n  /**\n   * @private\n   * @return {number} Not sure what this returns exactly. :-).\n   */\n  check_(): number {\n    let blackDepth;\n    if (this.isRed_() && this.left.isRed_()) {\n      throw new Error(\n        'Red node has red child(' + this.key + ',' + this.value + ')'\n      );\n    }\n    if (this.right.isRed_()) {\n      throw new Error(\n        'Right child of (' + this.key + ',' + this.value + ') is red'\n      );\n    }\n    blackDepth = this.left.check_();\n    if (blackDepth !== this.right.check_()) {\n      throw new Error('Black depths differ');\n    } else {\n      return blackDepth + (this.isRed_() ? 0 : 1);\n    }\n  }\n}\n\n/**\n * Represents an empty node (a leaf node in the Red-Black Tree).\n */\nexport class LLRBEmptyNode<K, V> {\n  key: K;\n  value: V;\n  left: LLRBNode<K, V> | LLRBEmptyNode<K, V>;\n  right: LLRBNode<K, V> | LLRBEmptyNode<K, V>;\n  color: boolean;\n\n  /**\n   * Returns a copy of the current node.\n   *\n   * @return {!LLRBEmptyNode} The node copy.\n   */\n  copy(\n    key: K | null,\n    value: V | null,\n    color: boolean | null,\n    left: LLRBNode<K, V> | LLRBEmptyNode<K, V> | null,\n    right: LLRBNode<K, V> | LLRBEmptyNode<K, V> | null\n  ): LLRBEmptyNode<K, V> {\n    return this;\n  }\n\n  /**\n   * Returns a copy of the tree, with the specified key/value added.\n   *\n   * @param {!K} key Key to be added.\n   * @param {!V} value Value to be added.\n   * @param {Comparator} comparator Comparator.\n   * @return {!LLRBNode} New tree, with item added.\n   */\n  insert(key: K, value: V, comparator: Comparator<K>): LLRBNode<K, V> {\n    return new LLRBNode(key, value, null);\n  }\n\n  /**\n   * Returns a copy of the tree, with the specified key removed.\n   *\n   * @param {!K} key The key to remove.\n   * @param {Comparator} comparator Comparator.\n   * @return {!LLRBEmptyNode} New tree, with item removed.\n   */\n  remove(key: K, comparator: Comparator<K>): LLRBEmptyNode<K, V> {\n    return this;\n  }\n\n  /**\n   * @return {number} The total number of nodes in the tree.\n   */\n  count(): number {\n    return 0;\n  }\n\n  /**\n   * @return {boolean} True if the tree is empty.\n   */\n  isEmpty(): boolean {\n    return true;\n  }\n\n  /**\n   * Traverses the tree in key order and calls the specified action function\n   * for each node.\n   *\n   * @param {function(!K, !V):*} action Callback function to be called for each\n   * node.  If it returns true, traversal is aborted.\n   * @return {boolean} True if traversal was aborted.\n   */\n  inorderTraversal(action: (k: K, v: V) => any): boolean {\n    return false;\n  }\n\n  /**\n   * Traverses the tree in reverse key order and calls the specified action function\n   * for each node.\n   *\n   * @param {function(!K, !V)} action Callback function to be called for each\n   * node.  If it returns true, traversal is aborted.\n   * @return {boolean} True if traversal was aborted.\n   */\n  reverseTraversal(action: (k: K, v: V) => void): boolean {\n    return false;\n  }\n\n  /**\n   * @return {null}\n   */\n  minKey(): null {\n    return null;\n  }\n\n  /**\n   * @return {null}\n   */\n  maxKey(): null {\n    return null;\n  }\n\n  /**\n   * @private\n   * @return {number} Not sure what this returns exactly. :-).\n   */\n  check_(): number {\n    return 0;\n  }\n\n  /**\n   * @private\n   * @return {boolean} Whether this node is red.\n   */\n  isRed_() {\n    return false;\n  }\n}\n\n/**\n * An immutable sorted map implementation, based on a Left-leaning Red-Black\n * tree.\n */\nexport class SortedMap<K, V> {\n  /**\n   * Always use the same empty node, to reduce memory.\n   * @const\n   */\n  static EMPTY_NODE = new LLRBEmptyNode();\n\n  /**\n   * @template K, V\n   * @param {function(K, K):number} comparator_ Key comparator.\n   * @param {LLRBNode=} root_ (Optional) Root node for the map.\n   */\n  constructor(\n    private comparator_: Comparator<K>,\n    private root_:\n      | LLRBNode<K, V>\n      | LLRBEmptyNode<K, V> = SortedMap.EMPTY_NODE as LLRBEmptyNode<K, V>\n  ) {}\n\n  /**\n   * Returns a copy of the map, with the specified key/value added or replaced.\n   * (TODO: We should perhaps rename this method to 'put')\n   *\n   * @param {!K} key Key to be added.\n   * @param {!V} value Value to be added.\n   * @return {!SortedMap.<K, V>} New map, with item added.\n   */\n  insert(key: K, value: V): SortedMap<K, V> {\n    return new SortedMap(\n      this.comparator_,\n      this.root_\n        .insert(key, value, this.comparator_)\n        .copy(null, null, LLRBNode.BLACK, null, null)\n    );\n  }\n\n  /**\n   * Returns a copy of the map, with the specified key removed.\n   *\n   * @param {!K} key The key to remove.\n   * @return {!SortedMap.<K, V>} New map, with item removed.\n   */\n  remove(key: K): SortedMap<K, V> {\n    return new SortedMap(\n      this.comparator_,\n      this.root_\n        .remove(key, this.comparator_)\n        .copy(null, null, LLRBNode.BLACK, null, null)\n    );\n  }\n\n  /**\n   * Returns the value of the node with the given key, or null.\n   *\n   * @param {!K} key The key to look up.\n   * @return {?V} The value of the node with the given key, or null if the\n   * key doesn't exist.\n   */\n  get(key: K): V | null {\n    let cmp;\n    let node = this.root_;\n    while (!node.isEmpty()) {\n      cmp = this.comparator_(key, node.key);\n      if (cmp === 0) {\n        return node.value;\n      } else if (cmp < 0) {\n        node = node.left;\n      } else if (cmp > 0) {\n        node = node.right;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Returns the key of the item *before* the specified key, or null if key is the first item.\n   * @param {K} key The key to find the predecessor of\n   * @return {?K} The predecessor key.\n   */\n  getPredecessorKey(key: K): K | null {\n    let cmp,\n      node = this.root_,\n      rightParent = null;\n    while (!node.isEmpty()) {\n      cmp = this.comparator_(key, node.key);\n      if (cmp === 0) {\n        if (!node.left.isEmpty()) {\n          node = node.left;\n          while (!node.right.isEmpty()) node = node.right;\n          return node.key;\n        } else if (rightParent) {\n          return rightParent.key;\n        } else {\n          return null; // first item.\n        }\n      } else if (cmp < 0) {\n        node = node.left;\n      } else if (cmp > 0) {\n        rightParent = node;\n        node = node.right;\n      }\n    }\n\n    throw new Error(\n      'Attempted to find predecessor key for a nonexistent key.  What gives?'\n    );\n  }\n\n  /**\n   * @return {boolean} True if the map is empty.\n   */\n  isEmpty(): boolean {\n    return this.root_.isEmpty();\n  }\n\n  /**\n   * @return {number} The total number of nodes in the map.\n   */\n  count(): number {\n    return this.root_.count();\n  }\n\n  /**\n   * @return {?K} The minimum key in the map.\n   */\n  minKey(): K | null {\n    return this.root_.minKey();\n  }\n\n  /**\n   * @return {?K} The maximum key in the map.\n   */\n  maxKey(): K | null {\n    return this.root_.maxKey();\n  }\n\n  /**\n   * Traverses the map in key order and calls the specified action function\n   * for each key/value pair.\n   *\n   * @param {function(!K, !V):*} action Callback function to be called\n   * for each key/value pair.  If action returns true, traversal is aborted.\n   * @return {*} The first truthy value returned by action, or the last falsey\n   *   value returned by action\n   */\n  inorderTraversal(action: (k: K, v: V) => any): boolean {\n    return this.root_.inorderTraversal(action);\n  }\n\n  /**\n   * Traverses the map in reverse key order and calls the specified action function\n   * for each key/value pair.\n   *\n   * @param {function(!Object, !Object)} action Callback function to be called\n   * for each key/value pair.  If action returns true, traversal is aborted.\n   * @return {*} True if the traversal was aborted.\n   */\n  reverseTraversal(action: (k: K, v: V) => void): boolean {\n    return this.root_.reverseTraversal(action);\n  }\n\n  /**\n   * Returns an iterator over the SortedMap.\n   * @template T\n   * @param {(function(K, V):T)=} resultGenerator\n   * @return {SortedMapIterator.<K, V, T>} The iterator.\n   */\n  getIterator<T>(\n    resultGenerator?: (k: K, v: V) => T\n  ): SortedMapIterator<K, V, T> {\n    return new SortedMapIterator(\n      this.root_,\n      null,\n      this.comparator_,\n      false,\n      resultGenerator\n    );\n  }\n\n  getIteratorFrom<T>(\n    key: K,\n    resultGenerator?: (k: K, v: V) => T\n  ): SortedMapIterator<K, V, T> {\n    return new SortedMapIterator(\n      this.root_,\n      key,\n      this.comparator_,\n      false,\n      resultGenerator\n    );\n  }\n\n  getReverseIteratorFrom<T>(\n    key: K,\n    resultGenerator?: (k: K, v: V) => T\n  ): SortedMapIterator<K, V, T> {\n    return new SortedMapIterator(\n      this.root_,\n      key,\n      this.comparator_,\n      true,\n      resultGenerator\n    );\n  }\n\n  getReverseIterator<T>(\n    resultGenerator?: (k: K, v: V) => T\n  ): SortedMapIterator<K, V, T> {\n    return new SortedMapIterator(\n      this.root_,\n      null,\n      this.comparator_,\n      true,\n      resultGenerator\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LLRBNode } from '../util/SortedMap';\nimport { SortedMap } from '../util/SortedMap';\nimport { NamedNode } from './Node';\n\nconst LOG_2 = Math.log(2);\n\n/**\n * @constructor\n */\nclass Base12Num {\n  count: number;\n  private current_: number;\n  private bits_: number;\n\n  /**\n   * @param {number} length\n   */\n  constructor(length: number) {\n    const logBase2 = (num: number) =>\n      parseInt((Math.log(num) / LOG_2) as any, 10);\n    const bitMask = (bits: number) => parseInt(Array(bits + 1).join('1'), 2);\n    this.count = logBase2(length + 1);\n    this.current_ = this.count - 1;\n    const mask = bitMask(this.count);\n    this.bits_ = (length + 1) & mask;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  nextBitIsOne(): boolean {\n    //noinspection JSBitwiseOperatorUsage\n    const result = !(this.bits_ & (0x1 << this.current_));\n    this.current_--;\n    return result;\n  }\n}\n\n/**\n * Takes a list of child nodes and constructs a SortedSet using the given comparison\n * function\n *\n * Uses the algorithm described in the paper linked here:\n * http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.46.1458\n *\n * @template K, V\n * @param {Array.<!NamedNode>} childList Unsorted list of children\n * @param {function(!NamedNode, !NamedNode):number} cmp The comparison method to be used\n * @param {(function(NamedNode):K)=} keyFn An optional function to extract K from a node wrapper, if K's\n *                                                        type is not NamedNode\n * @param {(function(K, K):number)=} mapSortFn An optional override for comparator used by the generated sorted map\n * @return {SortedMap.<K, V>}\n */\nexport const buildChildSet = function<K, V>(\n  childList: NamedNode[],\n  cmp: (a: NamedNode, b: NamedNode) => number,\n  keyFn?: (a: NamedNode) => K,\n  mapSortFn?: (a: K, b: K) => number\n): SortedMap<K, V> {\n  childList.sort(cmp);\n\n  const buildBalancedTree = function(\n    low: number,\n    high: number\n  ): LLRBNode<K, V> | null {\n    const length = high - low;\n    let namedNode: NamedNode;\n    let key: K;\n    if (length == 0) {\n      return null;\n    } else if (length == 1) {\n      namedNode = childList[low];\n      key = keyFn ? keyFn(namedNode) : ((namedNode as any) as K);\n      return new LLRBNode(\n        key,\n        (namedNode.node as any) as V,\n        LLRBNode.BLACK,\n        null,\n        null\n      );\n    } else {\n      const middle = parseInt((length / 2) as any, 10) + low;\n      const left = buildBalancedTree(low, middle);\n      const right = buildBalancedTree(middle + 1, high);\n      namedNode = childList[middle];\n      key = keyFn ? keyFn(namedNode) : ((namedNode as any) as K);\n      return new LLRBNode(\n        key,\n        (namedNode.node as any) as V,\n        LLRBNode.BLACK,\n        left,\n        right\n      );\n    }\n  };\n\n  const buildFrom12Array = function(base12: Base12Num): LLRBNode<K, V> {\n    let node: LLRBNode<K, V> = null;\n    let root = null;\n    let index = childList.length;\n\n    const buildPennant = function(chunkSize: number, color: boolean) {\n      const low = index - chunkSize;\n      const high = index;\n      index -= chunkSize;\n      const childTree = buildBalancedTree(low + 1, high);\n      const namedNode = childList[low];\n      const key: K = keyFn ? keyFn(namedNode) : ((namedNode as any) as K);\n      attachPennant(\n        new LLRBNode(key, (namedNode.node as any) as V, color, null, childTree)\n      );\n    };\n\n    const attachPennant = function(pennant: LLRBNode<K, V>) {\n      if (node) {\n        node.left = pennant;\n        node = pennant;\n      } else {\n        root = pennant;\n        node = pennant;\n      }\n    };\n\n    for (let i = 0; i < base12.count; ++i) {\n      const isOne = base12.nextBitIsOne();\n      // The number of nodes taken in each slice is 2^(arr.length - (i + 1))\n      const chunkSize = Math.pow(2, base12.count - (i + 1));\n      if (isOne) {\n        buildPennant(chunkSize, LLRBNode.BLACK);\n      } else {\n        // current == 2\n        buildPennant(chunkSize, LLRBNode.BLACK);\n        buildPennant(chunkSize, LLRBNode.RED);\n      }\n    }\n    return root;\n  };\n\n  const base12 = new Base12Num(childList.length);\n  const root = buildFrom12Array(base12);\n\n  return new SortedMap<K, V>(mapSortFn || (cmp as any), root);\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { nameCompare } from '../util/util';\nimport { NamedNode } from './Node';\n\nexport function NAME_ONLY_COMPARATOR(left: NamedNode, right: NamedNode) {\n  return nameCompare(left.name, right.name);\n}\n\nexport function NAME_COMPARATOR(left: string, right: string) {\n  return nameCompare(left, right);\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ChildrenNode } from './ChildrenNode';\nimport { LeafNode } from './LeafNode';\nimport { NamedNode, Node } from './Node';\nimport { contains } from '@firebase/util';\nimport { assert } from '@firebase/util';\nimport { buildChildSet } from './childSet';\nimport { NAME_COMPARATOR, NAME_ONLY_COMPARATOR } from './comparators';\nimport { IndexMap } from './IndexMap';\nimport { PRIORITY_INDEX, setNodeFromJSON } from './indexes/PriorityIndex';\nimport { SortedMap } from '../util/SortedMap';\nimport { each } from '../util/util';\n\nconst USE_HINZE = true;\n\n/**\n * Constructs a snapshot node representing the passed JSON and returns it.\n * @param {*} json JSON to create a node for.\n * @param {?string|?number=} priority Optional priority to use.  This will be ignored if the\n * passed JSON contains a .priority property.\n * @return {!Node}\n */\nexport function nodeFromJSON(\n  json: any | null,\n  priority: string | number | null = null\n): Node {\n  if (json === null) {\n    return ChildrenNode.EMPTY_NODE;\n  }\n\n  if (typeof json === 'object' && '.priority' in json) {\n    priority = json['.priority'];\n  }\n\n  assert(\n    priority === null ||\n      typeof priority === 'string' ||\n      typeof priority === 'number' ||\n      (typeof priority === 'object' && '.sv' in (priority as object)),\n    'Invalid priority type found: ' + typeof priority\n  );\n\n  if (typeof json === 'object' && '.value' in json && json['.value'] !== null) {\n    json = json['.value'];\n  }\n\n  // Valid leaf nodes include non-objects or server-value wrapper objects\n  if (typeof json !== 'object' || '.sv' in json) {\n    const jsonLeaf = json as string | number | boolean | object;\n    return new LeafNode(jsonLeaf, nodeFromJSON(priority));\n  }\n\n  if (!(json instanceof Array) && USE_HINZE) {\n    const children: NamedNode[] = [];\n    let childrenHavePriority = false;\n    const hinzeJsonObj: { [k: string]: any } = json;\n    each(hinzeJsonObj, (key, child) => {\n      if (key.substring(0, 1) !== '.') {\n        // Ignore metadata nodes\n        const childNode = nodeFromJSON(child);\n        if (!childNode.isEmpty()) {\n          childrenHavePriority =\n            childrenHavePriority || !childNode.getPriority().isEmpty();\n          children.push(new NamedNode(key, childNode));\n        }\n      }\n    });\n\n    if (children.length == 0) {\n      return ChildrenNode.EMPTY_NODE;\n    }\n\n    const childSet = buildChildSet(\n      children,\n      NAME_ONLY_COMPARATOR,\n      namedNode => namedNode.name,\n      NAME_COMPARATOR\n    ) as SortedMap<string, Node>;\n    if (childrenHavePriority) {\n      const sortedChildSet = buildChildSet(\n        children,\n        PRIORITY_INDEX.getCompare()\n      );\n      return new ChildrenNode(\n        childSet,\n        nodeFromJSON(priority),\n        new IndexMap(\n          { '.priority': sortedChildSet },\n          { '.priority': PRIORITY_INDEX }\n        )\n      );\n    } else {\n      return new ChildrenNode(\n        childSet,\n        nodeFromJSON(priority),\n        IndexMap.Default\n      );\n    }\n  } else {\n    let node: Node = ChildrenNode.EMPTY_NODE;\n    each(json, (key: string, childData: any) => {\n      if (contains(json, key)) {\n        if (key.substring(0, 1) !== '.') {\n          // ignore metadata nodes.\n          const childNode = nodeFromJSON(childData);\n          if (childNode.isLeafNode() || !childNode.isEmpty())\n            node = node.updateImmediateChild(key, childNode);\n        }\n      }\n    });\n\n    return node.updatePriority(nodeFromJSON(priority));\n  }\n}\n\nsetNodeFromJSON(nodeFromJSON);\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Index } from './Index';\nimport { NamedNode, Node } from '../Node';\nimport { nameCompare } from '../../util/util';\nimport { nodeFromJSON } from '../nodeFromJSON';\n\n/**\n * @constructor\n * @extends {Index}\n * @private\n */\nexport class ValueIndex extends Index {\n  /**\n   * @inheritDoc\n   */\n  compare(a: NamedNode, b: NamedNode): number {\n    const indexCmp = a.node.compareTo(b.node);\n    if (indexCmp === 0) {\n      return nameCompare(a.name, b.name);\n    } else {\n      return indexCmp;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  isDefinedOn(node: Node): boolean {\n    return true;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  indexedValueChanged(oldNode: Node, newNode: Node): boolean {\n    return !oldNode.equals(newNode);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  minPost(): NamedNode {\n    return (NamedNode as any).MIN;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  maxPost(): NamedNode {\n    return (NamedNode as any).MAX;\n  }\n\n  /**\n   * @param {*} indexValue\n   * @param {string} name\n   * @return {!NamedNode}\n   */\n  makePost(indexValue: object, name: string): NamedNode {\n    const valueNode = nodeFromJSON(indexValue);\n    return new NamedNode(name, valueNode);\n  }\n\n  /**\n   * @return {!string} String representation for inclusion in a query spec\n   */\n  toString(): string {\n    return '.value';\n  }\n}\n\nexport const VALUE_INDEX = new ValueIndex();\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { KEY_INDEX } from '../core/snap/indexes/KeyIndex';\nimport { PRIORITY_INDEX } from '../core/snap/indexes/PriorityIndex';\nimport { VALUE_INDEX } from '../core/snap/indexes/ValueIndex';\nimport { PathIndex } from '../core/snap/indexes/PathIndex';\nimport { MIN_NAME, MAX_NAME, ObjectToUniqueKey } from '../core/util/util';\nimport { Path } from '../core/util/Path';\nimport {\n  isValidPriority,\n  validateEventType,\n  validatePathString,\n  validateFirebaseDataArg,\n  validateKey\n} from '../core/util/validation';\nimport {\n  errorPrefix,\n  validateArgCount,\n  validateCallback,\n  validateContextObject\n} from '@firebase/util';\nimport {\n  ValueEventRegistration,\n  ChildEventRegistration,\n  EventRegistration\n} from '../core/view/EventRegistration';\nimport { Deferred } from '@firebase/util';\nimport { Repo } from '../core/Repo';\nimport { QueryParams } from '../core/view/QueryParams';\nimport { Reference } from './Reference';\nimport { DataSnapshot } from './DataSnapshot';\n\nlet __referenceConstructor: new (repo: Repo, path: Path) => Query;\n\nexport interface SnapshotCallback {\n  (a: DataSnapshot, b?: string | null): any;\n}\n\n/**\n * A Query represents a filter to be applied to a firebase location.  This object purely represents the\n * query expression (and exposes our public API to build the query).  The actual query logic is in ViewBase.js.\n *\n * Since every Firebase reference is a query, Firebase inherits from this object.\n */\nexport class Query {\n  static set __referenceConstructor(val) {\n    __referenceConstructor = val;\n  }\n\n  static get __referenceConstructor() {\n    assert(__referenceConstructor, 'Reference.ts has not been loaded');\n    return __referenceConstructor;\n  }\n\n  constructor(\n    public repo: Repo,\n    public path: Path,\n    private queryParams_: QueryParams,\n    private orderByCalled_: boolean\n  ) {}\n\n  /**\n   * Validates start/end values for queries.\n   * @param {!QueryParams} params\n   * @private\n   */\n  private static validateQueryEndpoints_(params: QueryParams) {\n    let startNode = null;\n    let endNode = null;\n    if (params.hasStart()) {\n      startNode = params.getIndexStartValue();\n    }\n    if (params.hasEnd()) {\n      endNode = params.getIndexEndValue();\n    }\n\n    if (params.getIndex() === KEY_INDEX) {\n      const tooManyArgsError =\n        'Query: When ordering by key, you may only pass one argument to ' +\n        'startAt(), endAt(), or equalTo().';\n      const wrongArgTypeError =\n        'Query: When ordering by key, the argument passed to startAt(), endAt(),' +\n        'or equalTo() must be a string.';\n      if (params.hasStart()) {\n        const startName = params.getIndexStartName();\n        if (startName != MIN_NAME) {\n          throw new Error(tooManyArgsError);\n        } else if (typeof startNode !== 'string') {\n          throw new Error(wrongArgTypeError);\n        }\n      }\n      if (params.hasEnd()) {\n        const endName = params.getIndexEndName();\n        if (endName != MAX_NAME) {\n          throw new Error(tooManyArgsError);\n        } else if (typeof endNode !== 'string') {\n          throw new Error(wrongArgTypeError);\n        }\n      }\n    } else if (params.getIndex() === PRIORITY_INDEX) {\n      if (\n        (startNode != null && !isValidPriority(startNode)) ||\n        (endNode != null && !isValidPriority(endNode))\n      ) {\n        throw new Error(\n          'Query: When ordering by priority, the first argument passed to startAt(), ' +\n            'endAt(), or equalTo() must be a valid priority value (null, a number, or a string).'\n        );\n      }\n    } else {\n      assert(\n        params.getIndex() instanceof PathIndex ||\n          params.getIndex() === VALUE_INDEX,\n        'unknown index type.'\n      );\n      if (\n        (startNode != null && typeof startNode === 'object') ||\n        (endNode != null && typeof endNode === 'object')\n      ) {\n        throw new Error(\n          'Query: First argument passed to startAt(), endAt(), or equalTo() cannot be ' +\n            'an object.'\n        );\n      }\n    }\n  }\n\n  /**\n   * Validates that limit* has been called with the correct combination of parameters\n   * @param {!QueryParams} params\n   * @private\n   */\n  private static validateLimit_(params: QueryParams) {\n    if (\n      params.hasStart() &&\n      params.hasEnd() &&\n      params.hasLimit() &&\n      !params.hasAnchoredLimit()\n    ) {\n      throw new Error(\n        \"Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.\"\n      );\n    }\n  }\n\n  /**\n   * Validates that no other order by call has been made\n   * @param {!string} fnName\n   * @private\n   */\n  private validateNoPreviousOrderByCall_(fnName: string) {\n    if (this.orderByCalled_ === true) {\n      throw new Error(fnName + \": You can't combine multiple orderBy calls.\");\n    }\n  }\n\n  /**\n   * @return {!QueryParams}\n   */\n  getQueryParams(): QueryParams {\n    return this.queryParams_;\n  }\n\n  /**\n   * @return {!Reference}\n   */\n  getRef(): Reference {\n    validateArgCount('Query.ref', 0, 0, arguments.length);\n    // This is a slight hack. We cannot goog.require('fb.api.Firebase'), since Firebase requires fb.api.Query.\n    // However, we will always export 'Firebase' to the global namespace, so it's guaranteed to exist by the time this\n    // method gets called.\n    return new Query.__referenceConstructor(this.repo, this.path) as Reference;\n  }\n\n  /**\n   * @param {!string} eventType\n   * @param {!function(DataSnapshot, string=)} callback\n   * @param {(function(Error)|Object)=} cancelCallbackOrContext\n   * @param {Object=} context\n   * @return {!function(DataSnapshot, string=)}\n   */\n  on(\n    eventType: string,\n    callback: SnapshotCallback,\n    cancelCallbackOrContext?: ((a: Error) => any) | Object | null,\n    context?: Object | null\n  ): SnapshotCallback {\n    validateArgCount('Query.on', 2, 4, arguments.length);\n    validateEventType('Query.on', 1, eventType, false);\n    validateCallback('Query.on', 2, callback, false);\n\n    const ret = Query.getCancelAndContextArgs_(\n      'Query.on',\n      cancelCallbackOrContext,\n      context\n    );\n\n    if (eventType === 'value') {\n      this.onValueEvent(callback, ret.cancel, ret.context);\n    } else {\n      const callbacks: { [k: string]: typeof callback } = {};\n      callbacks[eventType] = callback;\n      this.onChildEvent(callbacks, ret.cancel, ret.context);\n    }\n    return callback;\n  }\n\n  /**\n   * @param {!function(!DataSnapshot)} callback\n   * @param {?function(Error)} cancelCallback\n   * @param {?Object} context\n   * @protected\n   */\n  protected onValueEvent(\n    callback: (a: DataSnapshot) => void,\n    cancelCallback: ((a: Error) => void) | null,\n    context: Object | null\n  ) {\n    const container = new ValueEventRegistration(\n      callback,\n      cancelCallback || null,\n      context || null\n    );\n    this.repo.addEventCallbackForQuery(this, container);\n  }\n\n  /**\n   * @param {!Object.<string, !function(!DataSnapshot, ?string)>} callbacks\n   * @param {?function(Error)} cancelCallback\n   * @param {?Object} context\n   * @protected\n   */\n  onChildEvent(\n    callbacks: { [k: string]: SnapshotCallback },\n    cancelCallback: ((a: Error) => any) | null,\n    context: Object | null\n  ) {\n    const container = new ChildEventRegistration(\n      callbacks,\n      cancelCallback,\n      context\n    );\n    this.repo.addEventCallbackForQuery(this, container);\n  }\n\n  /**\n   * @param {string=} eventType\n   * @param {(function(!DataSnapshot, ?string=))=} callback\n   * @param {Object=} context\n   */\n  off(\n    eventType?: string,\n    callback?: SnapshotCallback,\n    context?: Object | null\n  ): void {\n    validateArgCount('Query.off', 0, 3, arguments.length);\n    validateEventType('Query.off', 1, eventType, true);\n    validateCallback('Query.off', 2, callback, true);\n    validateContextObject('Query.off', 3, context, true);\n\n    let container: EventRegistration | null = null;\n    let callbacks: { [k: string]: typeof callback } | null = null;\n    if (eventType === 'value') {\n      const valueCallback = callback || null;\n      container = new ValueEventRegistration(\n        valueCallback,\n        null,\n        context || null\n      );\n    } else if (eventType) {\n      if (callback) {\n        callbacks = {};\n        callbacks[eventType] = callback;\n      }\n      container = new ChildEventRegistration(callbacks, null, context || null);\n    }\n    this.repo.removeEventCallbackForQuery(this, container);\n  }\n\n  /**\n   * Attaches a listener, waits for the first event, and then removes the listener\n   * @param {!string} eventType\n   * @param {!function(!DataSnapshot, string=)} userCallback\n   * @param failureCallbackOrContext\n   * @param context\n   * @return {!firebase.Promise}\n   */\n  once(\n    eventType: string,\n    userCallback?: SnapshotCallback,\n    failureCallbackOrContext?: ((a: Error) => void) | Object | null,\n    context?: Object | null\n  ): Promise<DataSnapshot> {\n    validateArgCount('Query.once', 1, 4, arguments.length);\n    validateEventType('Query.once', 1, eventType, false);\n    validateCallback('Query.once', 2, userCallback, true);\n\n    const ret = Query.getCancelAndContextArgs_(\n      'Query.once',\n      failureCallbackOrContext,\n      context\n    );\n\n    // TODO: Implement this more efficiently (in particular, use 'get' wire protocol for 'value' event)\n    // TODO: consider actually wiring the callbacks into the promise. We cannot do this without a breaking change\n    // because the API currently expects callbacks will be called synchronously if the data is cached, but this is\n    // against the Promise specification.\n    let firstCall = true;\n    const deferred = new Deferred<DataSnapshot>();\n\n    // A dummy error handler in case a user wasn't expecting promises\n    deferred.promise.catch(() => {});\n\n    const onceCallback = (snapshot: DataSnapshot) => {\n      // NOTE: Even though we unsubscribe, we may get called multiple times if a single action (e.g. set() with JSON)\n      // triggers multiple events (e.g. child_added or child_changed).\n      if (firstCall) {\n        firstCall = false;\n        this.off(eventType, onceCallback);\n\n        if (userCallback) {\n          userCallback.bind(ret.context)(snapshot);\n        }\n        deferred.resolve(snapshot);\n      }\n    };\n\n    this.on(\n      eventType,\n      onceCallback,\n      /*cancel=*/ err => {\n        this.off(eventType, onceCallback);\n\n        if (ret.cancel) ret.cancel.bind(ret.context)(err);\n        deferred.reject(err);\n      }\n    );\n    return deferred.promise;\n  }\n\n  /**\n   * Set a limit and anchor it to the start of the window.\n   * @param {!number} limit\n   * @return {!Query}\n   */\n  limitToFirst(limit: number): Query {\n    validateArgCount('Query.limitToFirst', 1, 1, arguments.length);\n    if (\n      typeof limit !== 'number' ||\n      Math.floor(limit) !== limit ||\n      limit <= 0\n    ) {\n      throw new Error(\n        'Query.limitToFirst: First argument must be a positive integer.'\n      );\n    }\n    if (this.queryParams_.hasLimit()) {\n      throw new Error(\n        'Query.limitToFirst: Limit was already set (by another call to limit, ' +\n          'limitToFirst, or limitToLast).'\n      );\n    }\n\n    return new Query(\n      this.repo,\n      this.path,\n      this.queryParams_.limitToFirst(limit),\n      this.orderByCalled_\n    );\n  }\n\n  /**\n   * Set a limit and anchor it to the end of the window.\n   * @param {!number} limit\n   * @return {!Query}\n   */\n  limitToLast(limit: number): Query {\n    validateArgCount('Query.limitToLast', 1, 1, arguments.length);\n    if (\n      typeof limit !== 'number' ||\n      Math.floor(limit) !== limit ||\n      limit <= 0\n    ) {\n      throw new Error(\n        'Query.limitToLast: First argument must be a positive integer.'\n      );\n    }\n    if (this.queryParams_.hasLimit()) {\n      throw new Error(\n        'Query.limitToLast: Limit was already set (by another call to limit, ' +\n          'limitToFirst, or limitToLast).'\n      );\n    }\n\n    return new Query(\n      this.repo,\n      this.path,\n      this.queryParams_.limitToLast(limit),\n      this.orderByCalled_\n    );\n  }\n\n  /**\n   * Given a child path, return a new query ordered by the specified grandchild path.\n   * @param {!string} path\n   * @return {!Query}\n   */\n  orderByChild(path: string): Query {\n    validateArgCount('Query.orderByChild', 1, 1, arguments.length);\n    if (path === '$key') {\n      throw new Error(\n        'Query.orderByChild: \"$key\" is invalid.  Use Query.orderByKey() instead.'\n      );\n    } else if (path === '$priority') {\n      throw new Error(\n        'Query.orderByChild: \"$priority\" is invalid.  Use Query.orderByPriority() instead.'\n      );\n    } else if (path === '$value') {\n      throw new Error(\n        'Query.orderByChild: \"$value\" is invalid.  Use Query.orderByValue() instead.'\n      );\n    }\n    validatePathString('Query.orderByChild', 1, path, false);\n    this.validateNoPreviousOrderByCall_('Query.orderByChild');\n    const parsedPath = new Path(path);\n    if (parsedPath.isEmpty()) {\n      throw new Error(\n        'Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.'\n      );\n    }\n    const index = new PathIndex(parsedPath);\n    const newParams = this.queryParams_.orderBy(index);\n    Query.validateQueryEndpoints_(newParams);\n\n    return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\n  }\n\n  /**\n   * Return a new query ordered by the KeyIndex\n   * @return {!Query}\n   */\n  orderByKey(): Query {\n    validateArgCount('Query.orderByKey', 0, 0, arguments.length);\n    this.validateNoPreviousOrderByCall_('Query.orderByKey');\n    const newParams = this.queryParams_.orderBy(KEY_INDEX);\n    Query.validateQueryEndpoints_(newParams);\n    return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\n  }\n\n  /**\n   * Return a new query ordered by the PriorityIndex\n   * @return {!Query}\n   */\n  orderByPriority(): Query {\n    validateArgCount('Query.orderByPriority', 0, 0, arguments.length);\n    this.validateNoPreviousOrderByCall_('Query.orderByPriority');\n    const newParams = this.queryParams_.orderBy(PRIORITY_INDEX);\n    Query.validateQueryEndpoints_(newParams);\n    return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\n  }\n\n  /**\n   * Return a new query ordered by the ValueIndex\n   * @return {!Query}\n   */\n  orderByValue(): Query {\n    validateArgCount('Query.orderByValue', 0, 0, arguments.length);\n    this.validateNoPreviousOrderByCall_('Query.orderByValue');\n    const newParams = this.queryParams_.orderBy(VALUE_INDEX);\n    Query.validateQueryEndpoints_(newParams);\n    return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\n  }\n\n  /**\n   * @param {number|string|boolean|null} value\n   * @param {?string=} name\n   * @return {!Query}\n   */\n  startAt(\n    value: number | string | boolean | null = null,\n    name?: string | null\n  ): Query {\n    validateArgCount('Query.startAt', 0, 2, arguments.length);\n    validateFirebaseDataArg('Query.startAt', 1, value, this.path, true);\n    validateKey('Query.startAt', 2, name, true);\n\n    const newParams = this.queryParams_.startAt(value, name);\n    Query.validateLimit_(newParams);\n    Query.validateQueryEndpoints_(newParams);\n    if (this.queryParams_.hasStart()) {\n      throw new Error(\n        'Query.startAt: Starting point was already set (by another call to startAt ' +\n          'or equalTo).'\n      );\n    }\n\n    // Calling with no params tells us to start at the beginning.\n    if (value === undefined) {\n      value = null;\n      name = null;\n    }\n    return new Query(this.repo, this.path, newParams, this.orderByCalled_);\n  }\n\n  /**\n   * @param {number|string|boolean|null} value\n   * @param {?string=} name\n   * @return {!Query}\n   */\n  endAt(\n    value: number | string | boolean | null = null,\n    name?: string | null\n  ): Query {\n    validateArgCount('Query.endAt', 0, 2, arguments.length);\n    validateFirebaseDataArg('Query.endAt', 1, value, this.path, true);\n    validateKey('Query.endAt', 2, name, true);\n\n    const newParams = this.queryParams_.endAt(value, name);\n    Query.validateLimit_(newParams);\n    Query.validateQueryEndpoints_(newParams);\n    if (this.queryParams_.hasEnd()) {\n      throw new Error(\n        'Query.endAt: Ending point was already set (by another call to endAt or ' +\n          'equalTo).'\n      );\n    }\n\n    return new Query(this.repo, this.path, newParams, this.orderByCalled_);\n  }\n\n  /**\n   * Load the selection of children with exactly the specified value, and, optionally,\n   * the specified name.\n   * @param {number|string|boolean|null} value\n   * @param {string=} name\n   * @return {!Query}\n   */\n  equalTo(value: number | string | boolean | null, name?: string) {\n    validateArgCount('Query.equalTo', 1, 2, arguments.length);\n    validateFirebaseDataArg('Query.equalTo', 1, value, this.path, false);\n    validateKey('Query.equalTo', 2, name, true);\n    if (this.queryParams_.hasStart()) {\n      throw new Error(\n        'Query.equalTo: Starting point was already set (by another call to startAt or ' +\n          'equalTo).'\n      );\n    }\n    if (this.queryParams_.hasEnd()) {\n      throw new Error(\n        'Query.equalTo: Ending point was already set (by another call to endAt or ' +\n          'equalTo).'\n      );\n    }\n    return this.startAt(value, name).endAt(value, name);\n  }\n\n  /**\n   * @return {!string} URL for this location.\n   */\n  toString(): string {\n    validateArgCount('Query.toString', 0, 0, arguments.length);\n\n    return this.repo.toString() + this.path.toUrlEncodedString();\n  }\n\n  // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\n  // for end-users.\n  toJSON() {\n    // An optional spacer argument is unnecessary for a string.\n    validateArgCount('Query.toJSON', 0, 1, arguments.length);\n    return this.toString();\n  }\n\n  /**\n   * An object representation of the query parameters used by this Query.\n   * @return {!Object}\n   */\n  queryObject(): Object {\n    return this.queryParams_.getQueryObject();\n  }\n\n  /**\n   * @return {!string}\n   */\n  queryIdentifier(): string {\n    const obj = this.queryObject();\n    const id = ObjectToUniqueKey(obj);\n    return id === '{}' ? 'default' : id;\n  }\n\n  /**\n   * Return true if this query and the provided query are equivalent; otherwise, return false.\n   * @param {Query} other\n   * @return {boolean}\n   */\n  isEqual(other: Query): boolean {\n    validateArgCount('Query.isEqual', 1, 1, arguments.length);\n    if (!(other instanceof Query)) {\n      const error =\n        'Query.isEqual failed: First argument must be an instance of firebase.database.Query.';\n      throw new Error(error);\n    }\n\n    const sameRepo = this.repo === other.repo;\n    const samePath = this.path.equals(other.path);\n    const sameQueryIdentifier =\n      this.queryIdentifier() === other.queryIdentifier();\n\n    return sameRepo && samePath && sameQueryIdentifier;\n  }\n\n  /**\n   * Helper used by .on and .once to extract the context and or cancel arguments.\n   * @param {!string} fnName The function name (on or once)\n   * @param {(function(Error)|Object)=} cancelOrContext\n   * @param {Object=} context\n   * @return {{cancel: ?function(Error), context: ?Object}}\n   * @private\n   */\n  private static getCancelAndContextArgs_(\n    fnName: string,\n    cancelOrContext?: ((a: Error) => void) | Object | null,\n    context?: Object | null\n  ): { cancel: ((a: Error) => void) | null; context: Object | null } {\n    const ret: {\n      cancel: ((a: Error) => void) | null;\n      context: Object | null;\n    } = { cancel: null, context: null };\n    if (cancelOrContext && context) {\n      ret.cancel = cancelOrContext as (a: Error) => void;\n      validateCallback(fnName, 3, ret.cancel, true);\n\n      ret.context = context;\n      validateContextObject(fnName, 4, ret.context, true);\n    } else if (cancelOrContext) {\n      // we have either a cancel callback or a context.\n      if (typeof cancelOrContext === 'object' && cancelOrContext !== null) {\n        // it's a context!\n        ret.context = cancelOrContext;\n      } else if (typeof cancelOrContext === 'function') {\n        ret.cancel = cancelOrContext as (a: Error) => void;\n      } else {\n        throw new Error(\n          errorPrefix(fnName, 3, true) +\n            ' must either be a cancel callback or a context object.'\n        );\n      }\n    }\n    return ret;\n  }\n\n  get ref(): Reference {\n    return this.getRef();\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { Path } from '../util/Path';\n\n/**\n *\n * @enum\n */\nexport enum OperationType {\n  OVERWRITE,\n  MERGE,\n  ACK_USER_WRITE,\n  LISTEN_COMPLETE\n}\n\n/**\n * @interface\n */\nexport interface Operation {\n  /**\n   * @type {!OperationSource}\n   */\n  source: OperationSource;\n\n  /**\n   * @type {!OperationType}\n   */\n  type: OperationType;\n\n  /**\n   * @type {!Path}\n   */\n  path: Path;\n\n  /**\n   * @param {string} childName\n   * @return {?Operation}\n   */\n  operationForChild(childName: string): Operation | null;\n}\n\n/**\n * @param {boolean} fromUser\n * @param {boolean} fromServer\n * @param {?string} queryId\n * @param {boolean} tagged\n * @constructor\n */\nexport class OperationSource {\n  constructor(\n    public fromUser: boolean,\n    public fromServer: boolean,\n    public queryId: string | null,\n    public tagged: boolean\n  ) {\n    assert(!tagged || fromServer, 'Tagged queries must be from server.');\n  }\n  /**\n   * @const\n   * @type {!OperationSource}\n   */\n  static User = new OperationSource(\n    /*fromUser=*/ true,\n    false,\n    null,\n    /*tagged=*/ false\n  );\n\n  /**\n   * @const\n   * @type {!OperationSource}\n   */\n  static Server = new OperationSource(\n    false,\n    /*fromServer=*/ true,\n    null,\n    /*tagged=*/ false\n  );\n\n  /**\n   * @param {string} queryId\n   * @return {!OperationSource}\n   */\n  static forServerTaggedQuery = function(queryId: string): OperationSource {\n    return new OperationSource(\n      false,\n      /*fromServer=*/ true,\n      queryId,\n      /*tagged=*/ true\n    );\n  };\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { nameCompare, MAX_NAME } from '../../util/util';\nimport { Index } from './Index';\nimport { ChildrenNode, MAX_NODE } from '../ChildrenNode';\nimport { NamedNode, Node } from '../Node';\nimport { nodeFromJSON } from '../nodeFromJSON';\nimport { Path } from '../../util/Path';\n\n/**\n * @param {!Path} indexPath\n * @constructor\n * @extends {Index}\n */\nexport class PathIndex extends Index {\n  constructor(private indexPath_: Path) {\n    super();\n\n    assert(\n      !indexPath_.isEmpty() && indexPath_.getFront() !== '.priority',\n      \"Can't create PathIndex with empty path or .priority key\"\n    );\n  }\n\n  /**\n   * @param {!Node} snap\n   * @return {!Node}\n   * @protected\n   */\n  protected extractChild(snap: Node): Node {\n    return snap.getChild(this.indexPath_);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  isDefinedOn(node: Node): boolean {\n    return !node.getChild(this.indexPath_).isEmpty();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  compare(a: NamedNode, b: NamedNode): number {\n    const aChild = this.extractChild(a.node);\n    const bChild = this.extractChild(b.node);\n    const indexCmp = aChild.compareTo(bChild);\n    if (indexCmp === 0) {\n      return nameCompare(a.name, b.name);\n    } else {\n      return indexCmp;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  makePost(indexValue: object, name: string): NamedNode {\n    const valueNode = nodeFromJSON(indexValue);\n    const node = ChildrenNode.EMPTY_NODE.updateChild(\n      this.indexPath_,\n      valueNode\n    );\n    return new NamedNode(name, node);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  maxPost(): NamedNode {\n    const node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, MAX_NODE);\n    return new NamedNode(MAX_NAME, node);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  toString(): string {\n    return this.indexPath_.slice().join('/');\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { validateArgCount, validateCallback } from '@firebase/util';\nimport { validatePathString } from '../core/util/validation';\nimport { Path } from '../core/util/Path';\nimport { PRIORITY_INDEX } from '../core/snap/indexes/PriorityIndex';\nimport { Node } from '../core/snap/Node';\nimport { Reference } from './Reference';\nimport { Index } from '../core/snap/indexes/Index';\nimport { ChildrenNode } from '../core/snap/ChildrenNode';\n\n/**\n * Class representing a firebase data snapshot.  It wraps a SnapshotNode and\n * surfaces the public methods (val, forEach, etc.) we want to expose.\n */\nexport class DataSnapshot {\n  /**\n   * @param {!Node} node_ A SnapshotNode to wrap.\n   * @param {!Reference} ref_ The ref of the location this snapshot came from.\n   * @param {!Index} index_ The iteration order for this snapshot\n   */\n  constructor(\n    private readonly node_: Node,\n    private readonly ref_: Reference,\n    private readonly index_: Index\n  ) {}\n\n  /**\n   * Retrieves the snapshot contents as JSON.  Returns null if the snapshot is\n   * empty.\n   *\n   * @return {*} JSON representation of the DataSnapshot contents, or null if empty.\n   */\n  val(): any {\n    validateArgCount('DataSnapshot.val', 0, 0, arguments.length);\n    return this.node_.val();\n  }\n\n  /**\n   * Returns the snapshot contents as JSON, including priorities of node.  Suitable for exporting\n   * the entire node contents.\n   * @return {*} JSON representation of the DataSnapshot contents, or null if empty.\n   */\n  exportVal(): any {\n    validateArgCount('DataSnapshot.exportVal', 0, 0, arguments.length);\n    return this.node_.val(true);\n  }\n\n  // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\n  // for end-users\n  toJSON(): any {\n    // Optional spacer argument is unnecessary because we're depending on recursion rather than stringifying the content\n    validateArgCount('DataSnapshot.toJSON', 0, 1, arguments.length);\n    return this.exportVal();\n  }\n\n  /**\n   * Returns whether the snapshot contains a non-null value.\n   *\n   * @return {boolean} Whether the snapshot contains a non-null value, or is empty.\n   */\n  exists(): boolean {\n    validateArgCount('DataSnapshot.exists', 0, 0, arguments.length);\n    return !this.node_.isEmpty();\n  }\n\n  /**\n   * Returns a DataSnapshot of the specified child node's contents.\n   *\n   * @param {!string} childPathString Path to a child.\n   * @return {!DataSnapshot} DataSnapshot for child node.\n   */\n  child(childPathString: string): DataSnapshot {\n    validateArgCount('DataSnapshot.child', 0, 1, arguments.length);\n    // Ensure the childPath is a string (can be a number)\n    childPathString = String(childPathString);\n    validatePathString('DataSnapshot.child', 1, childPathString, false);\n\n    const childPath = new Path(childPathString);\n    const childRef = this.ref_.child(childPath);\n    return new DataSnapshot(\n      this.node_.getChild(childPath),\n      childRef,\n      PRIORITY_INDEX\n    );\n  }\n\n  /**\n   * Returns whether the snapshot contains a child at the specified path.\n   *\n   * @param {!string} childPathString Path to a child.\n   * @return {boolean} Whether the child exists.\n   */\n  hasChild(childPathString: string): boolean {\n    validateArgCount('DataSnapshot.hasChild', 1, 1, arguments.length);\n    validatePathString('DataSnapshot.hasChild', 1, childPathString, false);\n\n    const childPath = new Path(childPathString);\n    return !this.node_.getChild(childPath).isEmpty();\n  }\n\n  /**\n   * Returns the priority of the object, or null if no priority was set.\n   *\n   * @return {string|number|null} The priority.\n   */\n  getPriority(): string | number | null {\n    validateArgCount('DataSnapshot.getPriority', 0, 0, arguments.length);\n\n    // typecast here because we never return deferred values or internal priorities (MAX_PRIORITY)\n    return this.node_.getPriority().val() as string | number | null;\n  }\n\n  /**\n   * Iterates through child nodes and calls the specified action for each one.\n   *\n   * @param {function(!DataSnapshot)} action Callback function to be called\n   * for each child.\n   * @return {boolean} True if forEach was canceled by action returning true for\n   * one of the child nodes.\n   */\n  forEach(action: (d: DataSnapshot) => boolean | void): boolean {\n    validateArgCount('DataSnapshot.forEach', 1, 1, arguments.length);\n    validateCallback('DataSnapshot.forEach', 1, action, false);\n\n    if (this.node_.isLeafNode()) return false;\n\n    const childrenNode = this.node_ as ChildrenNode;\n    // Sanitize the return value to a boolean. ChildrenNode.forEachChild has a weird return type...\n    return !!childrenNode.forEachChild(this.index_, (key, node) => {\n      return action(\n        new DataSnapshot(node, this.ref_.child(key), PRIORITY_INDEX)\n      );\n    });\n  }\n\n  /**\n   * Returns whether this DataSnapshot has children.\n   * @return {boolean} True if the DataSnapshot contains 1 or more child nodes.\n   */\n  hasChildren(): boolean {\n    validateArgCount('DataSnapshot.hasChildren', 0, 0, arguments.length);\n\n    if (this.node_.isLeafNode()) return false;\n    else return !this.node_.isEmpty();\n  }\n\n  get key() {\n    return this.ref_.getKey();\n  }\n\n  /**\n   * Returns the number of children for this DataSnapshot.\n   * @return {number} The number of children that this DataSnapshot contains.\n   */\n  numChildren(): number {\n    validateArgCount('DataSnapshot.numChildren', 0, 0, arguments.length);\n\n    return this.node_.numChildren();\n  }\n\n  /**\n   * @return {Reference} The Firebase reference for the location this snapshot's data came from.\n   */\n  getRef(): Reference {\n    validateArgCount('DataSnapshot.ref', 0, 0, arguments.length);\n\n    return this.ref_;\n  }\n\n  get ref() {\n    return this.getRef();\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringify } from '@firebase/util';\nimport { Path } from '../util/Path';\nimport { EventRegistration } from './EventRegistration';\nimport { DataSnapshot } from '../../api/DataSnapshot';\n\n/**\n * Encapsulates the data needed to raise an event\n * @interface\n */\nexport interface Event {\n  /**\n   * @return {!Path}\n   */\n  getPath(): Path;\n\n  /**\n   * @return {!string}\n   */\n  getEventType(): string;\n\n  /**\n   * @return {!function()}\n   */\n  getEventRunner(): () => void;\n\n  /**\n   * @return {!string}\n   */\n  toString(): string;\n}\n\n/**\n * Encapsulates the data needed to raise an event\n * @implements {Event}\n */\nexport class DataEvent implements Event {\n  /**\n   * @param {!string} eventType One of: value, child_added, child_changed, child_moved, child_removed\n   * @param {!EventRegistration} eventRegistration The function to call to with the event data. User provided\n   * @param {!DataSnapshot} snapshot The data backing the event\n   * @param {?string=} prevName Optional, the name of the previous child for child_* events.\n   */\n  constructor(\n    public eventType:\n      | 'value'\n      | ' child_added'\n      | ' child_changed'\n      | ' child_moved'\n      | ' child_removed',\n    public eventRegistration: EventRegistration,\n    public snapshot: DataSnapshot,\n    public prevName?: string | null\n  ) {}\n\n  /**\n   * @inheritDoc\n   */\n  getPath(): Path {\n    const ref = this.snapshot.getRef();\n    if (this.eventType === 'value') {\n      return ref.path;\n    } else {\n      return ref.getParent().path;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getEventType(): string {\n    return this.eventType;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getEventRunner(): () => void {\n    return this.eventRegistration.getEventRunner(this);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  toString(): string {\n    return (\n      this.getPath().toString() +\n      ':' +\n      this.eventType +\n      ':' +\n      stringify(this.snapshot.exportVal())\n    );\n  }\n}\n\nexport class CancelEvent implements Event {\n  /**\n   * @param {EventRegistration} eventRegistration\n   * @param {Error} error\n   * @param {!Path} path\n   */\n  constructor(\n    public eventRegistration: EventRegistration,\n    public error: Error,\n    public path: Path\n  ) {}\n\n  /**\n   * @inheritDoc\n   */\n  getPath(): Path {\n    return this.path;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getEventType(): string {\n    return 'cancel';\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getEventRunner(): () => void {\n    return this.eventRegistration.getEventRunner(this);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  toString(): string {\n    return this.path.toString() + ':cancel';\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DataSnapshot } from '../../api/DataSnapshot';\nimport { DataEvent, CancelEvent, Event } from './Event';\nimport { contains } from '@firebase/util';\nimport { assert } from '@firebase/util';\nimport { Path } from '../util/Path';\nimport { Change } from './Change';\nimport { Query } from '../../api/Query';\n\n/**\n * An EventRegistration is basically an event type ('value', 'child_added', etc.) and a callback\n * to be notified of that type of event.\n *\n * That said, it can also contain a cancel callback to be notified if the event is canceled.  And\n * currently, this code is organized around the idea that you would register multiple child_ callbacks\n * together, as a single EventRegistration.  Though currently we don't do that.\n */\nexport interface EventRegistration {\n  /**\n   * True if this container has a callback to trigger for this event type\n   * @param {!string} eventType\n   * @return {boolean}\n   */\n  respondsTo(eventType: string): boolean;\n\n  /**\n   * @param {!Change} change\n   * @param {!Query} query\n   * @return {!Event}\n   */\n  createEvent(change: Change, query: Query): Event;\n\n  /**\n   * Given event data, return a function to trigger the user's callback\n   * @param {!Event} eventData\n   * @return {function()}\n   */\n  getEventRunner(eventData: Event): () => void;\n\n  /**\n   * @param {!Error} error\n   * @param {!Path} path\n   * @return {?CancelEvent}\n   */\n  createCancelEvent(error: Error, path: Path): CancelEvent | null;\n\n  /**\n   * @param {!EventRegistration} other\n   * @return {boolean}\n   */\n  matches(other: EventRegistration): boolean;\n\n  /**\n   * False basically means this is a \"dummy\" callback container being used as a sentinel\n   * to remove all callback containers of a particular type.  (e.g. if the user does\n   * ref.off('value') without specifying a specific callback).\n   *\n   * (TODO: Rework this, since it's hacky)\n   *\n   * @return {boolean}\n   */\n  hasAnyCallback(): boolean;\n}\n\n/**\n * Represents registration for 'value' events.\n */\nexport class ValueEventRegistration implements EventRegistration {\n  /**\n   * @param {?function(!DataSnapshot)} callback_\n   * @param {?function(Error)} cancelCallback_\n   * @param {?Object} context_\n   */\n  constructor(\n    private callback_: ((d: DataSnapshot) => void) | null,\n    private cancelCallback_: ((e: Error) => void) | null,\n    private context_: Object | null\n  ) {}\n\n  /**\n   * @inheritDoc\n   */\n  respondsTo(eventType: string): boolean {\n    return eventType === 'value';\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createEvent(change: Change, query: Query): DataEvent {\n    const index = query.getQueryParams().getIndex();\n    return new DataEvent(\n      'value',\n      this,\n      new DataSnapshot(change.snapshotNode, query.getRef(), index)\n    );\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getEventRunner(eventData: CancelEvent | DataEvent): () => void {\n    const ctx = this.context_;\n    if (eventData.getEventType() === 'cancel') {\n      assert(\n        this.cancelCallback_,\n        'Raising a cancel event on a listener with no cancel callback'\n      );\n      const cancelCB = this.cancelCallback_;\n      return function() {\n        // We know that error exists, we checked above that this is a cancel event\n        cancelCB.call(ctx, (eventData as CancelEvent).error);\n      };\n    } else {\n      const cb = this.callback_;\n      return function() {\n        cb.call(ctx, (eventData as DataEvent).snapshot);\n      };\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createCancelEvent(error: Error, path: Path): CancelEvent | null {\n    if (this.cancelCallback_) {\n      return new CancelEvent(this, error, path);\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  matches(other: EventRegistration): boolean {\n    if (!(other instanceof ValueEventRegistration)) {\n      return false;\n    } else if (!other.callback_ || !this.callback_) {\n      // If no callback specified, we consider it to match any callback.\n      return true;\n    } else {\n      return (\n        other.callback_ === this.callback_ && other.context_ === this.context_\n      );\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  hasAnyCallback(): boolean {\n    return this.callback_ !== null;\n  }\n}\n\n/**\n * Represents the registration of 1 or more child_xxx events.\n *\n * Currently, it is always exactly 1 child_xxx event, but the idea is we might let you\n * register a group of callbacks together in the future.\n *\n * @constructor\n * @implements {EventRegistration}\n */\nexport class ChildEventRegistration implements EventRegistration {\n  /**\n   * @param {?Object.<string, function(!DataSnapshot, ?string=)>} callbacks_\n   * @param {?function(Error)} cancelCallback_\n   * @param {Object=} context_\n   */\n  constructor(\n    private callbacks_: {\n      [k: string]: (d: DataSnapshot, s?: string | null) => void;\n    } | null,\n    private cancelCallback_: ((e: Error) => void) | null,\n    private context_?: Object\n  ) {}\n\n  /**\n   * @inheritDoc\n   */\n  respondsTo(eventType: string): boolean {\n    let eventToCheck =\n      eventType === 'children_added' ? 'child_added' : eventType;\n    eventToCheck =\n      eventToCheck === 'children_removed' ? 'child_removed' : eventToCheck;\n    return contains(this.callbacks_, eventToCheck);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createCancelEvent(error: Error, path: Path): CancelEvent | null {\n    if (this.cancelCallback_) {\n      return new CancelEvent(this, error, path);\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createEvent(change: Change, query: Query): DataEvent {\n    assert(change.childName != null, 'Child events should have a childName.');\n    const ref = query.getRef().child(/** @type {!string} */ change.childName);\n    const index = query.getQueryParams().getIndex();\n    return new DataEvent(\n      change.type as any,\n      this,\n      new DataSnapshot(change.snapshotNode, ref, index as any),\n      change.prevName\n    );\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getEventRunner(eventData: CancelEvent | DataEvent): () => void {\n    const ctx = this.context_;\n    if (eventData.getEventType() === 'cancel') {\n      assert(\n        this.cancelCallback_,\n        'Raising a cancel event on a listener with no cancel callback'\n      );\n      const cancelCB = this.cancelCallback_;\n      return function() {\n        // We know that error exists, we checked above that this is a cancel event\n        cancelCB.call(ctx, (eventData as CancelEvent).error);\n      };\n    } else {\n      const cb = this.callbacks_[(eventData as DataEvent).eventType];\n      return function() {\n        cb.call(\n          ctx,\n          (eventData as DataEvent).snapshot,\n          (eventData as DataEvent).prevName\n        );\n      };\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  matches(other: EventRegistration): boolean {\n    if (other instanceof ChildEventRegistration) {\n      if (!this.callbacks_ || !other.callbacks_) {\n        return true;\n      } else if (this.context_ === other.context_) {\n        const otherKeys = Object.keys(other.callbacks_);\n        const thisKeys = Object.keys(this.callbacks_);\n        const otherCount = otherKeys.length;\n        const thisCount = thisKeys.length;\n        if (otherCount === thisCount) {\n          // If count is 1, do an exact match on eventType, if either is defined but null, it's a match.\n          // If event types don't match, not a match\n          // If count is not 1, exact match across all\n\n          if (otherCount === 1) {\n            const otherKey = otherKeys[0];\n            const thisKey = thisKeys[0];\n            return (\n              thisKey === otherKey &&\n              (!other.callbacks_[otherKey] ||\n                !this.callbacks_[thisKey] ||\n                other.callbacks_[otherKey] === this.callbacks_[thisKey])\n            );\n          } else {\n            // Exact match on each key.\n            return thisKeys.every(\n              eventType =>\n                other.callbacks_[eventType] === this.callbacks_[eventType]\n            );\n          }\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  hasAnyCallback(): boolean {\n    return this.callbacks_ !== null;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Path } from './util/Path';\nimport { PRIORITY_INDEX } from './snap/indexes/PriorityIndex';\nimport { Node } from './snap/Node';\n\n/**\n * Helper class to store a sparse set of snapshots.\n */\nexport class SparseSnapshotTree {\n  private value: Node | null = null;\n\n  private readonly children: Map<string, SparseSnapshotTree> = new Map();\n\n  /**\n   * Gets the node stored at the given path if one exists.\n   *\n   * @param path Path to look up snapshot for.\n   * @return The retrieved node, or null.\n   */\n  find(path: Path): Node | null {\n    if (this.value != null) {\n      return this.value.getChild(path);\n    } else if (!path.isEmpty() && this.children.size > 0) {\n      const childKey = path.getFront();\n      path = path.popFront();\n      if (this.children.has(childKey)) {\n        const childTree = this.children.get(childKey);\n        return childTree.find(path);\n      } else {\n        return null;\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Stores the given node at the specified path. If there is already a node\n   * at a shallower path, it merges the new data into that snapshot node.\n   *\n   * @param path Path to look up snapshot for.\n   * @param data The new data, or null.\n   */\n  remember(path: Path, data: Node) {\n    if (path.isEmpty()) {\n      this.value = data;\n      this.children.clear();\n    } else if (this.value !== null) {\n      this.value = this.value.updateChild(path, data);\n    } else {\n      const childKey = path.getFront();\n      if (!this.children.has(childKey)) {\n        this.children.set(childKey, new SparseSnapshotTree());\n      }\n\n      const child = this.children.get(childKey);\n      path = path.popFront();\n      child.remember(path, data);\n    }\n  }\n\n  /**\n   * Purge the data at path from the cache.\n   *\n   * @param path Path to look up snapshot for.\n   * @return True if this node should now be removed.\n   */\n  forget(path: Path): boolean {\n    if (path.isEmpty()) {\n      this.value = null;\n      this.children.clear();\n      return true;\n    } else {\n      if (this.value !== null) {\n        if (this.value.isLeafNode()) {\n          // We're trying to forget a node that doesn't exist\n          return false;\n        } else {\n          const value = this.value;\n          this.value = null;\n\n          const self = this;\n          value.forEachChild(PRIORITY_INDEX, function(key, tree) {\n            self.remember(new Path(key), tree);\n          });\n\n          return this.forget(path);\n        }\n      } else if (this.children.size > 0) {\n        const childKey = path.getFront();\n        path = path.popFront();\n        if (this.children.has(childKey)) {\n          const safeToRemove = this.children.get(childKey).forget(path);\n          if (safeToRemove) {\n            this.children.delete(childKey);\n          }\n        }\n\n        return this.children.size === 0;\n      } else {\n        return true;\n      }\n    }\n  }\n\n  /**\n   * Recursively iterates through all of the stored tree and calls the\n   * callback on each one.\n   *\n   * @param prefixPath Path to look up node for.\n   * @param func The function to invoke for each tree.\n   */\n  forEachTree(prefixPath: Path, func: (a: Path, b: Node) => any) {\n    if (this.value !== null) {\n      func(prefixPath, this.value);\n    } else {\n      this.forEachChild((key, tree) => {\n        const path = new Path(prefixPath.toString() + '/' + key);\n        tree.forEachTree(path, func);\n      });\n    }\n  }\n\n  /**\n   * Iterates through each immediate child and triggers the callback.\n   *\n   * @param func The function to invoke for each child.\n   */\n  forEachChild(func: (a: string, b: SparseSnapshotTree) => void) {\n    this.children.forEach((tree, key) => {\n      func(key, tree);\n    });\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { Path } from './Path';\nimport { SparseSnapshotTree } from '../SparseSnapshotTree';\nimport { LeafNode } from '../snap/LeafNode';\nimport { nodeFromJSON } from '../snap/nodeFromJSON';\nimport { PRIORITY_INDEX } from '../snap/indexes/PriorityIndex';\nimport { Node } from '../snap/Node';\nimport { ChildrenNode } from '../snap/ChildrenNode';\nimport { SyncTree } from '../SyncTree';\n\n/**\n * Generate placeholders for deferred values.\n * @param {?Object} values\n * @return {!Object}\n */\nexport const generateWithValues = function(\n  values: {\n    [k: string]: any;\n  } | null\n): { [k: string]: any } {\n  values = values || {};\n  values['timestamp'] = values['timestamp'] || new Date().getTime();\n  return values;\n};\n\n/**\n * Value to use when firing local events. When writing server values, fire\n * local events with an approximate value, otherwise return value as-is.\n * @param {(Object|string|number|boolean)} value\n * @param {!Object} serverValues\n * @return {!(string|number|boolean)}\n */\nexport const resolveDeferredValue = function(\n  value: { [k: string]: any } | string | number | boolean,\n  existing: Node,\n  serverValues: { [k: string]: any }\n): string | number | boolean {\n  if (!value || typeof value !== 'object') {\n    return value as string | number | boolean;\n  }\n  assert('.sv' in value, 'Unexpected leaf node or priority contents');\n\n  if (typeof value['.sv'] === 'string') {\n    return resolveScalarDeferredValue(value['.sv'], existing, serverValues);\n  } else if (typeof value['.sv'] === 'object') {\n    return resolveComplexDeferredValue(value['.sv'], existing, serverValues);\n  } else {\n    assert(false, 'Unexpected server value: ' + JSON.stringify(value, null, 2));\n  }\n};\n\nconst resolveScalarDeferredValue = function(\n  op: string,\n  existing: Node,\n  serverValues: { [k: string]: any }\n): string | number | boolean {\n  switch (op) {\n    case 'timestamp':\n      return serverValues['timestamp'];\n    default:\n      assert(false, 'Unexpected server value: ' + op);\n  }\n};\n\nconst resolveComplexDeferredValue = function(\n  op: Object,\n  existing: Node,\n  unused: { [k: string]: any }\n): string | number | boolean {\n  if (!op.hasOwnProperty('increment')) {\n    assert(false, 'Unexpected server value: ' + JSON.stringify(op, null, 2));\n  }\n  const delta = op['increment'];\n  if (typeof delta !== 'number') {\n    assert(false, 'Unexpected increment value: ' + delta);\n  }\n\n  // Incrementing a non-number sets the value to the incremented amount\n  if (!existing.isLeafNode()) {\n    return delta;\n  }\n\n  const leaf = existing as LeafNode;\n  const existingVal = leaf.getValue();\n  if (typeof existingVal !== 'number') {\n    return delta;\n  }\n\n  // No need to do over/underflow arithmetic here because JS only handles floats under the covers\n  return existingVal + delta;\n};\n\n/**\n * Recursively replace all deferred values and priorities in the tree with the\n * specified generated replacement values.\n * @param {!SparseSnapshotTree} tree\n * @param {!Object} serverValues\n * @return {!SparseSnapshotTree}\n */\nexport const resolveDeferredValueTree = function(\n  tree: SparseSnapshotTree,\n  syncTree: SyncTree,\n  serverValues: Object\n): SparseSnapshotTree {\n  const resolvedTree = new SparseSnapshotTree();\n  tree.forEachTree(new Path(''), function(path, node) {\n    const existing = syncTree.calcCompleteEventCache(path);\n    assert(\n      existing !== null && typeof existing !== 'undefined',\n      'Expected ChildrenNode.EMPTY_NODE for nulls'\n    );\n    resolvedTree.remember(\n      path,\n      resolveDeferredValueSnapshot(node, existing, serverValues)\n    );\n  });\n  return resolvedTree;\n};\n\n/**\n * Recursively replace all deferred values and priorities in the node with the\n * specified generated replacement values.  If there are no server values in the node,\n * it'll be returned as-is.\n * @param {!Node} node\n * @param {!Object} serverValues\n * @return {!Node}\n */\nexport const resolveDeferredValueSnapshot = function(\n  node: Node,\n  existing: Node,\n  serverValues: Object\n): Node {\n  const rawPri = node.getPriority().val() as\n    | object\n    | boolean\n    | null\n    | number\n    | string;\n  const priority = resolveDeferredValue(\n    rawPri,\n    existing.getPriority(),\n    serverValues\n  );\n  let newNode: Node;\n\n  if (node.isLeafNode()) {\n    const leafNode = node as LeafNode;\n    const value = resolveDeferredValue(\n      leafNode.getValue(),\n      existing,\n      serverValues\n    );\n    if (\n      value !== leafNode.getValue() ||\n      priority !== leafNode.getPriority().val()\n    ) {\n      return new LeafNode(value, nodeFromJSON(priority));\n    } else {\n      return node;\n    }\n  } else {\n    const childrenNode = node as ChildrenNode;\n    newNode = childrenNode;\n    if (priority !== childrenNode.getPriority().val()) {\n      newNode = newNode.updatePriority(new LeafNode(priority));\n    }\n    childrenNode.forEachChild(PRIORITY_INDEX, function(childName, childNode) {\n      const newChildNode = resolveDeferredValueSnapshot(\n        childNode,\n        existing.getImmediateChild(childName),\n        serverValues\n      );\n      if (newChildNode !== childNode) {\n        newNode = newNode.updateImmediateChild(childName, newChildNode);\n      }\n    });\n    return newNode;\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SortedMap } from './SortedMap';\nimport { Path } from './Path';\nimport { stringCompare, each } from './util';\n\nlet emptyChildrenSingleton: SortedMap<string, ImmutableTree<null>>;\n\n/**\n * Singleton empty children collection.\n *\n * @const\n * @type {!SortedMap.<string, !ImmutableTree.<?>>}\n */\nconst EmptyChildren = (): SortedMap<string, ImmutableTree<null>> => {\n  if (!emptyChildrenSingleton) {\n    emptyChildrenSingleton = new SortedMap<string, ImmutableTree<null>>(\n      stringCompare\n    );\n  }\n  return emptyChildrenSingleton;\n};\n\n/**\n * A tree with immutable elements.\n */\nexport class ImmutableTree<T> {\n  static Empty = new ImmutableTree<any>(null);\n\n  /**\n   * @template T\n   * @param {!Object.<string, !T>} obj\n   * @return {!ImmutableTree.<!T>}\n   */\n  static fromObject<T>(obj: { [k: string]: T }): ImmutableTree<T> {\n    let tree: ImmutableTree<T> = ImmutableTree.Empty;\n    each(obj, (childPath: string, childSnap: T) => {\n      tree = tree.set(new Path(childPath), childSnap);\n    });\n    return tree;\n  }\n\n  /**\n   * @template T\n   * @param {?T} value\n   * @param {SortedMap.<string, !ImmutableTree.<T>>=} children\n   */\n  constructor(\n    public readonly value: T | null,\n    public readonly children: SortedMap<\n      string,\n      ImmutableTree<T>\n    > = EmptyChildren()\n  ) {}\n\n  /**\n   * True if the value is empty and there are no children\n   * @return {boolean}\n   */\n  isEmpty(): boolean {\n    return this.value === null && this.children.isEmpty();\n  }\n\n  /**\n   * Given a path and predicate, return the first node and the path to that node\n   * where the predicate returns true.\n   *\n   * TODO Do a perf test -- If we're creating a bunch of {path: value:} objects\n   * on the way back out, it may be better to pass down a pathSoFar obj.\n   *\n   * @param {!Path} relativePath The remainder of the path\n   * @param {function(T):boolean} predicate The predicate to satisfy to return a\n   *   node\n   * @return {?{path:!Path, value:!T}}\n   */\n  findRootMostMatchingPathAndValue(\n    relativePath: Path,\n    predicate: (a: T) => boolean\n  ): { path: Path; value: T } | null {\n    if (this.value != null && predicate(this.value)) {\n      return { path: Path.Empty, value: this.value };\n    } else {\n      if (relativePath.isEmpty()) {\n        return null;\n      } else {\n        const front = relativePath.getFront();\n        const child = this.children.get(front);\n        if (child !== null) {\n          const childExistingPathAndValue = child.findRootMostMatchingPathAndValue(\n            relativePath.popFront(),\n            predicate\n          );\n          if (childExistingPathAndValue != null) {\n            const fullPath = new Path(front).child(\n              childExistingPathAndValue.path\n            );\n            return { path: fullPath, value: childExistingPathAndValue.value };\n          } else {\n            return null;\n          }\n        } else {\n          return null;\n        }\n      }\n    }\n  }\n\n  /**\n   * Find, if it exists, the shortest subpath of the given path that points a defined\n   * value in the tree\n   * @param {!Path} relativePath\n   * @return {?{path: !Path, value: !T}}\n   */\n  findRootMostValueAndPath(\n    relativePath: Path\n  ): { path: Path; value: T } | null {\n    return this.findRootMostMatchingPathAndValue(relativePath, () => true);\n  }\n\n  /**\n   * @param {!Path} relativePath\n   * @return {!ImmutableTree.<T>} The subtree at the given path\n   */\n  subtree(relativePath: Path): ImmutableTree<T> {\n    if (relativePath.isEmpty()) {\n      return this;\n    } else {\n      const front = relativePath.getFront();\n      const childTree = this.children.get(front);\n      if (childTree !== null) {\n        return childTree.subtree(relativePath.popFront());\n      } else {\n        return ImmutableTree.Empty;\n      }\n    }\n  }\n\n  /**\n   * Sets a value at the specified path.\n   *\n   * @param {!Path} relativePath Path to set value at.\n   * @param {?T} toSet Value to set.\n   * @return {!ImmutableTree.<T>} Resulting tree.\n   */\n  set(relativePath: Path, toSet: T | null): ImmutableTree<T> {\n    if (relativePath.isEmpty()) {\n      return new ImmutableTree(toSet, this.children);\n    } else {\n      const front = relativePath.getFront();\n      const child = this.children.get(front) || ImmutableTree.Empty;\n      const newChild = child.set(relativePath.popFront(), toSet);\n      const newChildren = this.children.insert(front, newChild);\n      return new ImmutableTree(this.value, newChildren);\n    }\n  }\n\n  /**\n   * Removes the value at the specified path.\n   *\n   * @param {!Path} relativePath Path to value to remove.\n   * @return {!ImmutableTree.<T>} Resulting tree.\n   */\n  remove(relativePath: Path): ImmutableTree<T> {\n    if (relativePath.isEmpty()) {\n      if (this.children.isEmpty()) {\n        return ImmutableTree.Empty;\n      } else {\n        return new ImmutableTree(null, this.children);\n      }\n    } else {\n      const front = relativePath.getFront();\n      const child = this.children.get(front);\n      if (child) {\n        const newChild = child.remove(relativePath.popFront());\n        let newChildren;\n        if (newChild.isEmpty()) {\n          newChildren = this.children.remove(front);\n        } else {\n          newChildren = this.children.insert(front, newChild);\n        }\n        if (this.value === null && newChildren.isEmpty()) {\n          return ImmutableTree.Empty;\n        } else {\n          return new ImmutableTree(this.value, newChildren);\n        }\n      } else {\n        return this;\n      }\n    }\n  }\n\n  /**\n   * Gets a value from the tree.\n   *\n   * @param {!Path} relativePath Path to get value for.\n   * @return {?T} Value at path, or null.\n   */\n  get(relativePath: Path): T | null {\n    if (relativePath.isEmpty()) {\n      return this.value;\n    } else {\n      const front = relativePath.getFront();\n      const child = this.children.get(front);\n      if (child) {\n        return child.get(relativePath.popFront());\n      } else {\n        return null;\n      }\n    }\n  }\n\n  /**\n   * Replace the subtree at the specified path with the given new tree.\n   *\n   * @param {!Path} relativePath Path to replace subtree for.\n   * @param {!ImmutableTree} newTree New tree.\n   * @return {!ImmutableTree} Resulting tree.\n   */\n  setTree(relativePath: Path, newTree: ImmutableTree<T>): ImmutableTree<T> {\n    if (relativePath.isEmpty()) {\n      return newTree;\n    } else {\n      const front = relativePath.getFront();\n      const child = this.children.get(front) || ImmutableTree.Empty;\n      const newChild = child.setTree(relativePath.popFront(), newTree);\n      let newChildren;\n      if (newChild.isEmpty()) {\n        newChildren = this.children.remove(front);\n      } else {\n        newChildren = this.children.insert(front, newChild);\n      }\n      return new ImmutableTree(this.value, newChildren);\n    }\n  }\n\n  /**\n   * Performs a depth first fold on this tree. Transforms a tree into a single\n   * value, given a function that operates on the path to a node, an optional\n   * current value, and a map of child names to folded subtrees\n   * @template V\n   * @param {function(Path, ?T, Object.<string, V>):V} fn\n   * @return {V}\n   */\n  fold<V>(fn: (path: Path, value: T, children: { [k: string]: V }) => V): V {\n    return this.fold_(Path.Empty, fn);\n  }\n\n  /**\n   * Recursive helper for public-facing fold() method\n   * @template V\n   * @param {!Path} pathSoFar\n   * @param {function(Path, ?T, Object.<string, V>):V} fn\n   * @return {V}\n   * @private\n   */\n  private fold_<V>(\n    pathSoFar: Path,\n    fn: (path: Path, value: T | null, children: { [k: string]: V }) => V\n  ): V {\n    const accum: { [k: string]: V } = {};\n    this.children.inorderTraversal(function(\n      childKey: string,\n      childTree: ImmutableTree<T>\n    ) {\n      accum[childKey] = childTree.fold_(pathSoFar.child(childKey), fn);\n    });\n    return fn(pathSoFar, this.value, accum);\n  }\n\n  /**\n   * Find the first matching value on the given path. Return the result of applying f to it.\n   * @template V\n   * @param {!Path} path\n   * @param {!function(!Path, !T):?V} f\n   * @return {?V}\n   */\n  findOnPath<V>(path: Path, f: (path: Path, value: T) => V | null): V | null {\n    return this.findOnPath_(path, Path.Empty, f);\n  }\n\n  private findOnPath_<V>(\n    pathToFollow: Path,\n    pathSoFar: Path,\n    f: (path: Path, value: T) => V | null\n  ): V | null {\n    const result = this.value ? f(pathSoFar, this.value) : false;\n    if (result) {\n      return result;\n    } else {\n      if (pathToFollow.isEmpty()) {\n        return null;\n      } else {\n        const front = pathToFollow.getFront()!;\n        const nextChild = this.children.get(front);\n        if (nextChild) {\n          return nextChild.findOnPath_(\n            pathToFollow.popFront(),\n            pathSoFar.child(front),\n            f\n          );\n        } else {\n          return null;\n        }\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {!Path} path\n   * @param {!function(!Path, !T)} f\n   * @returns {!ImmutableTree.<T>}\n   */\n  foreachOnPath(\n    path: Path,\n    f: (path: Path, value: T) => void\n  ): ImmutableTree<T> {\n    return this.foreachOnPath_(path, Path.Empty, f);\n  }\n\n  private foreachOnPath_(\n    pathToFollow: Path,\n    currentRelativePath: Path,\n    f: (path: Path, value: T) => void\n  ): ImmutableTree<T> {\n    if (pathToFollow.isEmpty()) {\n      return this;\n    } else {\n      if (this.value) {\n        f(currentRelativePath, this.value);\n      }\n      const front = pathToFollow.getFront();\n      const nextChild = this.children.get(front);\n      if (nextChild) {\n        return nextChild.foreachOnPath_(\n          pathToFollow.popFront(),\n          currentRelativePath.child(front),\n          f\n        );\n      } else {\n        return ImmutableTree.Empty;\n      }\n    }\n  }\n\n  /**\n   * Calls the given function for each node in the tree that has a value.\n   *\n   * @param {function(!Path, !T)} f A function to be called with\n   *   the path from the root of the tree to a node, and the value at that node.\n   *   Called in depth-first order.\n   */\n  foreach(f: (path: Path, value: T) => void) {\n    this.foreach_(Path.Empty, f);\n  }\n\n  private foreach_(\n    currentRelativePath: Path,\n    f: (path: Path, value: T) => void\n  ) {\n    this.children.inorderTraversal(function(childName, childTree) {\n      childTree.foreach_(currentRelativePath.child(childName), f);\n    });\n    if (this.value) {\n      f(currentRelativePath, this.value);\n    }\n  }\n\n  /**\n   *\n   * @param {function(string, !T)} f\n   */\n  foreachChild(f: (name: string, value: T) => void) {\n    this.children.inorderTraversal(\n      (childName: string, childTree: ImmutableTree<T>) => {\n        if (childTree.value) {\n          f(childName, childTree.value);\n        }\n      }\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CacheNode } from './view/CacheNode';\nimport { ChildrenNode } from './snap/ChildrenNode';\nimport { assert } from '@firebase/util';\nimport { ViewCache } from './view/ViewCache';\nimport { View } from './view/View';\nimport { Operation } from './operation/Operation';\nimport { WriteTreeRef } from './WriteTree';\nimport { Query } from '../api/Query';\nimport { EventRegistration } from './view/EventRegistration';\nimport { Node } from './snap/Node';\nimport { Path } from './util/Path';\nimport { Event } from './view/Event';\nimport { Reference, ReferenceConstructor } from '../api/Reference';\n\nlet __referenceConstructor: ReferenceConstructor;\n\n/**\n * SyncPoint represents a single location in a SyncTree with 1 or more event registrations, meaning we need to\n * maintain 1 or more Views at this location to cache server data and raise appropriate events for server changes\n * and user writes (set, transaction, update).\n *\n * It's responsible for:\n *  - Maintaining the set of 1 or more views necessary at this location (a SyncPoint with 0 views should be removed).\n *  - Proxying user / server operations to the views as appropriate (i.e. applyServerOverwrite,\n *    applyUserOverwrite, etc.)\n */\nexport class SyncPoint {\n  static set __referenceConstructor(val: ReferenceConstructor) {\n    assert(\n      !__referenceConstructor,\n      '__referenceConstructor has already been defined'\n    );\n    __referenceConstructor = val;\n  }\n\n  static get __referenceConstructor() {\n    assert(__referenceConstructor, 'Reference.ts has not been loaded');\n    return __referenceConstructor;\n  }\n\n  /**\n   * The Views being tracked at this location in the tree, stored as a map where the key is a\n   * queryId and the value is the View for that query.\n   *\n   * NOTE: This list will be quite small (usually 1, but perhaps 2 or 3; any more is an odd use case).\n   */\n  private readonly views: Map<string, View> = new Map();\n\n  isEmpty(): boolean {\n    return this.views.size === 0;\n  }\n\n  applyOperation(\n    operation: Operation,\n    writesCache: WriteTreeRef,\n    optCompleteServerCache: Node | null\n  ): Event[] {\n    const queryId = operation.source.queryId;\n    if (queryId !== null) {\n      const view = this.views.get(queryId);\n      assert(view != null, 'SyncTree gave us an op for an invalid query.');\n      return view.applyOperation(\n        operation,\n        writesCache,\n        optCompleteServerCache\n      );\n    } else {\n      let events: Event[] = [];\n\n      for (const view of this.views.values()) {\n        events = events.concat(\n          view.applyOperation(operation, writesCache, optCompleteServerCache)\n        );\n      }\n\n      return events;\n    }\n  }\n\n  /**\n   * Add an event callback for the specified query.\n   *\n   * @param {!Query} query\n   * @param {!EventRegistration} eventRegistration\n   * @param {!WriteTreeRef} writesCache\n   * @param {?Node} serverCache Complete server cache, if we have it.\n   * @param {boolean} serverCacheComplete\n   * @return {!Array.<!Event>} Events to raise.\n   */\n  addEventRegistration(\n    query: Query,\n    eventRegistration: EventRegistration,\n    writesCache: WriteTreeRef,\n    serverCache: Node | null,\n    serverCacheComplete: boolean\n  ): Event[] {\n    const queryId = query.queryIdentifier();\n    let view = this.views.get(queryId);\n    if (!view) {\n      // TODO: make writesCache take flag for complete server node\n      let eventCache = writesCache.calcCompleteEventCache(\n        serverCacheComplete ? serverCache : null\n      );\n      let eventCacheComplete = false;\n      if (eventCache) {\n        eventCacheComplete = true;\n      } else if (serverCache instanceof ChildrenNode) {\n        eventCache = writesCache.calcCompleteEventChildren(serverCache);\n        eventCacheComplete = false;\n      } else {\n        eventCache = ChildrenNode.EMPTY_NODE;\n        eventCacheComplete = false;\n      }\n      const viewCache = new ViewCache(\n        new CacheNode(\n          /** @type {!Node} */ eventCache,\n          eventCacheComplete,\n          false\n        ),\n        new CacheNode(\n          /** @type {!Node} */ serverCache,\n          serverCacheComplete,\n          false\n        )\n      );\n      view = new View(query, viewCache);\n      this.views.set(queryId, view);\n    }\n\n    // This is guaranteed to exist now, we just created anything that was missing\n    view.addEventRegistration(eventRegistration);\n    return view.getInitialEvents(eventRegistration);\n  }\n\n  /**\n   * Remove event callback(s).  Return cancelEvents if a cancelError is specified.\n   *\n   * If query is the default query, we'll check all views for the specified eventRegistration.\n   * If eventRegistration is null, we'll remove all callbacks for the specified view(s).\n   *\n   * @param {!Query} query\n   * @param {?EventRegistration} eventRegistration If null, remove all callbacks.\n   * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\n   * @return {{removed:!Array.<!Query>, events:!Array.<!Event>}} removed queries and any cancel events\n   */\n  removeEventRegistration(\n    query: Query,\n    eventRegistration: EventRegistration | null,\n    cancelError?: Error\n  ): { removed: Query[]; events: Event[] } {\n    const queryId = query.queryIdentifier();\n    const removed: Query[] = [];\n    let cancelEvents: Event[] = [];\n    const hadCompleteView = this.hasCompleteView();\n    if (queryId === 'default') {\n      // When you do ref.off(...), we search all views for the registration to remove.\n      for (const [viewQueryId, view] of this.views.entries()) {\n        cancelEvents = cancelEvents.concat(\n          view.removeEventRegistration(eventRegistration, cancelError)\n        );\n        if (view.isEmpty()) {\n          this.views.delete(viewQueryId);\n\n          // We'll deal with complete views later.\n          if (\n            !view\n              .getQuery()\n              .getQueryParams()\n              .loadsAllData()\n          ) {\n            removed.push(view.getQuery());\n          }\n        }\n      }\n    } else {\n      // remove the callback from the specific view.\n      const view = this.views.get(queryId);\n      if (view) {\n        cancelEvents = cancelEvents.concat(\n          view.removeEventRegistration(eventRegistration, cancelError)\n        );\n        if (view.isEmpty()) {\n          this.views.delete(queryId);\n\n          // We'll deal with complete views later.\n          if (\n            !view\n              .getQuery()\n              .getQueryParams()\n              .loadsAllData()\n          ) {\n            removed.push(view.getQuery());\n          }\n        }\n      }\n    }\n\n    if (hadCompleteView && !this.hasCompleteView()) {\n      // We removed our last complete view.\n      removed.push(\n        new SyncPoint.__referenceConstructor(query.repo, query.path)\n      );\n    }\n\n    return { removed: removed, events: cancelEvents };\n  }\n\n  getQueryViews(): View[] {\n    const result = [];\n    for (const view of this.views.values()) {\n      if (\n        !view\n          .getQuery()\n          .getQueryParams()\n          .loadsAllData()\n      ) {\n        result.push(view);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @param path The path to the desired complete snapshot\n   * @return A complete cache, if it exists\n   */\n  getCompleteServerCache(path: Path): Node | null {\n    let serverCache: Node | null = null;\n    for (const view of this.views.values()) {\n      serverCache = serverCache || view.getCompleteServerCache(path);\n    }\n    return serverCache;\n  }\n\n  viewForQuery(query: Query): View | null {\n    const params = query.getQueryParams();\n    if (params.loadsAllData()) {\n      return this.getCompleteView();\n    } else {\n      const queryId = query.queryIdentifier();\n      return this.views.get(queryId);\n    }\n  }\n\n  viewExistsForQuery(query: Query): boolean {\n    return this.viewForQuery(query) != null;\n  }\n\n  hasCompleteView(): boolean {\n    return this.getCompleteView() != null;\n  }\n\n  getCompleteView(): View | null {\n    for (const view of this.views.values()) {\n      if (\n        view\n          .getQuery()\n          .getQueryParams()\n          .loadsAllData()\n      ) {\n        return view;\n      }\n    }\n    return null;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { Path } from '../util/Path';\nimport { Operation, OperationSource, OperationType } from './Operation';\nimport { ImmutableTree } from '../util/ImmutableTree';\n\nexport class AckUserWrite implements Operation {\n  /** @inheritDoc */\n  type = OperationType.ACK_USER_WRITE;\n\n  /** @inheritDoc */\n  source = OperationSource.User;\n\n  /**\n   *\n   * @param {!Path} path\n   * @param {!ImmutableTree<!boolean>} affectedTree A tree containing true for each affected path. Affected paths can't overlap.\n   * @param {!boolean} revert\n   */\n  constructor(\n    /**@inheritDoc */ public path: Path,\n    /**@inheritDoc */ public affectedTree: ImmutableTree<boolean>,\n    /**@inheritDoc */ public revert: boolean\n  ) {}\n\n  /**\n   * @inheritDoc\n   */\n  operationForChild(childName: string): AckUserWrite {\n    if (!this.path.isEmpty()) {\n      assert(\n        this.path.getFront() === childName,\n        'operationForChild called for unrelated child.'\n      );\n      return new AckUserWrite(\n        this.path.popFront(),\n        this.affectedTree,\n        this.revert\n      );\n    } else if (this.affectedTree.value != null) {\n      assert(\n        this.affectedTree.children.isEmpty(),\n        'affectedTree should not have overlapping affected paths.'\n      );\n      // All child locations are affected as well; just return same operation.\n      return this;\n    } else {\n      const childTree = this.affectedTree.subtree(new Path(childName));\n      return new AckUserWrite(Path.Empty, childTree, this.revert);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Path } from '../util/Path';\nimport { Operation, OperationSource, OperationType } from './Operation';\n\n/**\n * @param {!OperationSource} source\n * @param {!Path} path\n * @constructor\n * @implements {Operation}\n */\nexport class ListenComplete implements Operation {\n  /** @inheritDoc */\n  type = OperationType.LISTEN_COMPLETE;\n\n  constructor(public source: OperationSource, public path: Path) {}\n\n  operationForChild(childName: string): ListenComplete {\n    if (this.path.isEmpty()) {\n      return new ListenComplete(this.source, Path.Empty);\n    } else {\n      return new ListenComplete(this.source, this.path.popFront());\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Operation, OperationSource, OperationType } from './Operation';\nimport { Path } from '../util/Path';\nimport { Node } from '../snap/Node';\n\n/**\n * @param {!OperationSource} source\n * @param {!Path} path\n * @param {!Node} snap\n * @constructor\n * @implements {Operation}\n */\nexport class Overwrite implements Operation {\n  /** @inheritDoc */\n  type = OperationType.OVERWRITE;\n\n  constructor(\n    public source: OperationSource,\n    public path: Path,\n    public snap: Node\n  ) {}\n\n  operationForChild(childName: string): Overwrite {\n    if (this.path.isEmpty()) {\n      return new Overwrite(\n        this.source,\n        Path.Empty,\n        this.snap.getImmediateChild(childName)\n      );\n    } else {\n      return new Overwrite(this.source, this.path.popFront(), this.snap);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Operation, OperationSource, OperationType } from './Operation';\nimport { Overwrite } from './Overwrite';\nimport { Path } from '../util/Path';\nimport { assert } from '@firebase/util';\nimport { ImmutableTree } from '../util/ImmutableTree';\nimport { Node } from '../snap/Node';\n\n/**\n * @param {!OperationSource} source\n * @param {!Path} path\n * @param {!ImmutableTree.<!Node>} children\n * @constructor\n * @implements {Operation}\n */\nexport class Merge implements Operation {\n  /** @inheritDoc */\n  type = OperationType.MERGE;\n\n  constructor(\n    /**@inheritDoc */ public source: OperationSource,\n    /**@inheritDoc */ public path: Path,\n    /**@inheritDoc */ public children: ImmutableTree<Node>\n  ) {}\n\n  /**\n   * @inheritDoc\n   */\n  operationForChild(childName: string): Operation {\n    if (this.path.isEmpty()) {\n      const childTree = this.children.subtree(new Path(childName));\n      if (childTree.isEmpty()) {\n        // This child is unaffected\n        return null;\n      } else if (childTree.value) {\n        // We have a snapshot for the child in question.  This becomes an overwrite of the child.\n        return new Overwrite(this.source, Path.Empty, childTree.value);\n      } else {\n        // This is a merge at a deeper level\n        return new Merge(this.source, Path.Empty, childTree);\n      }\n    } else {\n      assert(\n        this.path.getFront() === childName,\n        \"Can't get a merge for a child not on the path of the operation\"\n      );\n      return new Merge(this.source, this.path.popFront(), this.children);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  toString(): string {\n    return (\n      'Operation(' +\n      this.path +\n      ': ' +\n      this.source.toString() +\n      ' merge: ' +\n      this.children.toString() +\n      ')'\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Node } from '../snap/Node';\nimport { Path } from '../util/Path';\n\n/**\n * A cache node only stores complete children. Additionally it holds a flag whether the node can be considered fully\n * initialized in the sense that we know at one point in time this represented a valid state of the world, e.g.\n * initialized with data from the server, or a complete overwrite by the client. The filtered flag also tracks\n * whether a node potentially had children removed due to a filter.\n */\nexport class CacheNode {\n  /**\n   * @param {!Node} node_\n   * @param {boolean} fullyInitialized_\n   * @param {boolean} filtered_\n   */\n  constructor(\n    private node_: Node,\n    private fullyInitialized_: boolean,\n    private filtered_: boolean\n  ) {}\n\n  /**\n   * Returns whether this node was fully initialized with either server data or a complete overwrite by the client\n   * @return {boolean}\n   */\n  isFullyInitialized(): boolean {\n    return this.fullyInitialized_;\n  }\n\n  /**\n   * Returns whether this node is potentially missing children due to a filter applied to the node\n   * @return {boolean}\n   */\n  isFiltered(): boolean {\n    return this.filtered_;\n  }\n\n  /**\n   * @param {!Path} path\n   * @return {boolean}\n   */\n  isCompleteForPath(path: Path): boolean {\n    if (path.isEmpty()) {\n      return this.isFullyInitialized() && !this.filtered_;\n    }\n\n    const childKey = path.getFront();\n    return this.isCompleteForChild(childKey);\n  }\n\n  /**\n   * @param {!string} key\n   * @return {boolean}\n   */\n  isCompleteForChild(key: string): boolean {\n    return (\n      (this.isFullyInitialized() && !this.filtered_) || this.node_.hasChild(key)\n    );\n  }\n\n  /**\n   * @return {!Node}\n   */\n  getNode(): Node {\n    return this.node_;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ChildrenNode } from '../snap/ChildrenNode';\nimport { CacheNode } from './CacheNode';\nimport { Node } from '../snap/Node';\n\n/**\n * Stores the data we have cached for a view.\n *\n * serverSnap is the cached server data, eventSnap is the cached event data (server data plus any local writes).\n *\n * @constructor\n */\nexport class ViewCache {\n  /**\n   *\n   * @param {!CacheNode} eventCache_\n   * @param {!CacheNode} serverCache_\n   */\n  constructor(\n    private readonly eventCache_: CacheNode,\n    private readonly serverCache_: CacheNode\n  ) {}\n\n  /**\n   * @const\n   * @type {ViewCache}\n   */\n  static Empty = new ViewCache(\n    new CacheNode(\n      ChildrenNode.EMPTY_NODE,\n      /*fullyInitialized=*/ false,\n      /*filtered=*/ false\n    ),\n    new CacheNode(\n      ChildrenNode.EMPTY_NODE,\n      /*fullyInitialized=*/ false,\n      /*filtered=*/ false\n    )\n  );\n\n  /**\n   * @param {!Node} eventSnap\n   * @param {boolean} complete\n   * @param {boolean} filtered\n   * @return {!ViewCache}\n   */\n  updateEventSnap(\n    eventSnap: Node,\n    complete: boolean,\n    filtered: boolean\n  ): ViewCache {\n    return new ViewCache(\n      new CacheNode(eventSnap, complete, filtered),\n      this.serverCache_\n    );\n  }\n\n  /**\n   * @param {!Node} serverSnap\n   * @param {boolean} complete\n   * @param {boolean} filtered\n   * @return {!ViewCache}\n   */\n  updateServerSnap(\n    serverSnap: Node,\n    complete: boolean,\n    filtered: boolean\n  ): ViewCache {\n    return new ViewCache(\n      this.eventCache_,\n      new CacheNode(serverSnap, complete, filtered)\n    );\n  }\n\n  /**\n   * @return {!CacheNode}\n   */\n  getEventCache(): CacheNode {\n    return this.eventCache_;\n  }\n\n  /**\n   * @return {?Node}\n   */\n  getCompleteEventSnap(): Node | null {\n    return this.eventCache_.isFullyInitialized()\n      ? this.eventCache_.getNode()\n      : null;\n  }\n\n  /**\n   * @return {!CacheNode}\n   */\n  getServerCache(): CacheNode {\n    return this.serverCache_;\n  }\n\n  /**\n   * @return {?Node}\n   */\n  getCompleteServerSnap(): Node | null {\n    return this.serverCache_.isFullyInitialized()\n      ? this.serverCache_.getNode()\n      : null;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Node } from '../snap/Node';\n\n/**\n * @constructor\n * @struct\n * @param {!string} type The event type\n * @param {!Node} snapshotNode The data\n * @param {string=} childName The name for this child, if it's a child event\n * @param {Node=} oldSnap Used for intermediate processing of child changed events\n * @param {string=} prevName The name for the previous child, if applicable\n */\nexport class Change {\n  constructor(\n    public type: string,\n    public snapshotNode: Node,\n    public childName?: string,\n    public oldSnap?: Node,\n    public prevName?: string | null\n  ) {}\n\n  /**\n   * @param {!Node} snapshot\n   * @return {!Change}\n   */\n  static valueChange(snapshot: Node): Change {\n    return new Change(Change.VALUE, snapshot);\n  }\n\n  /**\n   * @param {string} childKey\n   * @param {!Node} snapshot\n   * @return {!Change}\n   */\n  static childAddedChange(childKey: string, snapshot: Node): Change {\n    return new Change(Change.CHILD_ADDED, snapshot, childKey);\n  }\n\n  /**\n   * @param {string} childKey\n   * @param {!Node} snapshot\n   * @return {!Change}\n   */\n  static childRemovedChange(childKey: string, snapshot: Node): Change {\n    return new Change(Change.CHILD_REMOVED, snapshot, childKey);\n  }\n\n  /**\n   * @param {string} childKey\n   * @param {!Node} newSnapshot\n   * @param {!Node} oldSnapshot\n   * @return {!Change}\n   */\n  static childChangedChange(\n    childKey: string,\n    newSnapshot: Node,\n    oldSnapshot: Node\n  ): Change {\n    return new Change(Change.CHILD_CHANGED, newSnapshot, childKey, oldSnapshot);\n  }\n\n  /**\n   * @param {string} childKey\n   * @param {!Node} snapshot\n   * @return {!Change}\n   */\n  static childMovedChange(childKey: string, snapshot: Node): Change {\n    return new Change(Change.CHILD_MOVED, snapshot, childKey);\n  }\n\n  //event types\n  /** Event type for a child added */\n  static CHILD_ADDED = 'child_added';\n\n  /** Event type for a child removed */\n  static CHILD_REMOVED = 'child_removed';\n\n  /** Event type for a child changed */\n  static CHILD_CHANGED = 'child_changed';\n\n  /** Event type for a child moved */\n  static CHILD_MOVED = 'child_moved';\n\n  /** Event type for a value change */\n  static VALUE = 'value';\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { Change } from '../Change';\nimport { ChildrenNode } from '../../snap/ChildrenNode';\nimport { PRIORITY_INDEX } from '../../snap/indexes/PriorityIndex';\nimport { NodeFilter } from './NodeFilter';\nimport { Index } from '../../snap/indexes/Index';\nimport { Path } from '../../util/Path';\nimport { CompleteChildSource } from '../CompleteChildSource';\nimport { ChildChangeAccumulator } from '../ChildChangeAccumulator';\nimport { Node } from '../../snap/Node';\n\n/**\n * Doesn't really filter nodes but applies an index to the node and keeps track of any changes\n *\n * @constructor\n * @implements {NodeFilter}\n * @param {!Index} index\n */\nexport class IndexedFilter implements NodeFilter {\n  constructor(private readonly index_: Index) {}\n\n  updateChild(\n    snap: Node,\n    key: string,\n    newChild: Node,\n    affectedPath: Path,\n    source: CompleteChildSource,\n    optChangeAccumulator: ChildChangeAccumulator | null\n  ): Node {\n    assert(\n      snap.isIndexed(this.index_),\n      'A node must be indexed if only a child is updated'\n    );\n    const oldChild = snap.getImmediateChild(key);\n    // Check if anything actually changed.\n    if (\n      oldChild.getChild(affectedPath).equals(newChild.getChild(affectedPath))\n    ) {\n      // There's an edge case where a child can enter or leave the view because affectedPath was set to null.\n      // In this case, affectedPath will appear null in both the old and new snapshots.  So we need\n      // to avoid treating these cases as \"nothing changed.\"\n      if (oldChild.isEmpty() == newChild.isEmpty()) {\n        // Nothing changed.\n\n        // This assert should be valid, but it's expensive (can dominate perf testing) so don't actually do it.\n        //assert(oldChild.equals(newChild), 'Old and new snapshots should be equal.');\n        return snap;\n      }\n    }\n\n    if (optChangeAccumulator != null) {\n      if (newChild.isEmpty()) {\n        if (snap.hasChild(key)) {\n          optChangeAccumulator.trackChildChange(\n            Change.childRemovedChange(key, oldChild)\n          );\n        } else {\n          assert(\n            snap.isLeafNode(),\n            'A child remove without an old child only makes sense on a leaf node'\n          );\n        }\n      } else if (oldChild.isEmpty()) {\n        optChangeAccumulator.trackChildChange(\n          Change.childAddedChange(key, newChild)\n        );\n      } else {\n        optChangeAccumulator.trackChildChange(\n          Change.childChangedChange(key, newChild, oldChild)\n        );\n      }\n    }\n    if (snap.isLeafNode() && newChild.isEmpty()) {\n      return snap;\n    } else {\n      // Make sure the node is indexed\n      return snap.updateImmediateChild(key, newChild).withIndex(this.index_);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  updateFullNode(\n    oldSnap: Node,\n    newSnap: Node,\n    optChangeAccumulator: ChildChangeAccumulator | null\n  ): Node {\n    if (optChangeAccumulator != null) {\n      if (!oldSnap.isLeafNode()) {\n        oldSnap.forEachChild(PRIORITY_INDEX, function(key, childNode) {\n          if (!newSnap.hasChild(key)) {\n            optChangeAccumulator.trackChildChange(\n              Change.childRemovedChange(key, childNode)\n            );\n          }\n        });\n      }\n      if (!newSnap.isLeafNode()) {\n        newSnap.forEachChild(PRIORITY_INDEX, function(key, childNode) {\n          if (oldSnap.hasChild(key)) {\n            const oldChild = oldSnap.getImmediateChild(key);\n            if (!oldChild.equals(childNode)) {\n              optChangeAccumulator.trackChildChange(\n                Change.childChangedChange(key, childNode, oldChild)\n              );\n            }\n          } else {\n            optChangeAccumulator.trackChildChange(\n              Change.childAddedChange(key, childNode)\n            );\n          }\n        });\n      }\n    }\n    return newSnap.withIndex(this.index_);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  updatePriority(oldSnap: Node, newPriority: Node): Node {\n    if (oldSnap.isEmpty()) {\n      return ChildrenNode.EMPTY_NODE;\n    } else {\n      return oldSnap.updatePriority(newPriority);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  filtersNodes(): boolean {\n    return false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getIndexedFilter(): IndexedFilter {\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getIndex(): Index {\n    return this.index_;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Change } from './Change';\nimport { assert, assertionError } from '@firebase/util';\n\nexport class ChildChangeAccumulator {\n  private readonly changeMap: Map<string, Change> = new Map();\n\n  trackChildChange(change: Change) {\n    const type = change.type;\n    const childKey = change.childName!;\n    assert(\n      type == Change.CHILD_ADDED ||\n        type == Change.CHILD_CHANGED ||\n        type == Change.CHILD_REMOVED,\n      'Only child changes supported for tracking'\n    );\n    assert(\n      childKey !== '.priority',\n      'Only non-priority child changes can be tracked.'\n    );\n    const oldChange = this.changeMap.get(childKey);\n    if (oldChange) {\n      const oldType = oldChange.type;\n      if (type == Change.CHILD_ADDED && oldType == Change.CHILD_REMOVED) {\n        this.changeMap.set(\n          childKey,\n          Change.childChangedChange(\n            childKey,\n            change.snapshotNode,\n            oldChange.snapshotNode\n          )\n        );\n      } else if (\n        type == Change.CHILD_REMOVED &&\n        oldType == Change.CHILD_ADDED\n      ) {\n        this.changeMap.delete(childKey);\n      } else if (\n        type == Change.CHILD_REMOVED &&\n        oldType == Change.CHILD_CHANGED\n      ) {\n        this.changeMap.set(\n          childKey,\n          Change.childRemovedChange(childKey, oldChange.oldSnap)\n        );\n      } else if (\n        type == Change.CHILD_CHANGED &&\n        oldType == Change.CHILD_ADDED\n      ) {\n        this.changeMap.set(\n          childKey,\n          Change.childAddedChange(childKey, change.snapshotNode)\n        );\n      } else if (\n        type == Change.CHILD_CHANGED &&\n        oldType == Change.CHILD_CHANGED\n      ) {\n        this.changeMap.set(\n          childKey,\n          Change.childChangedChange(\n            childKey,\n            change.snapshotNode,\n            oldChange.oldSnap\n          )\n        );\n      } else {\n        throw assertionError(\n          'Illegal combination of changes: ' +\n            change +\n            ' occurred after ' +\n            oldChange\n        );\n      }\n    } else {\n      this.changeMap.set(childKey, change);\n    }\n  }\n\n  getChanges(): Change[] {\n    return Array.from(this.changeMap.values());\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CacheNode } from './CacheNode';\nimport { NamedNode, Node } from '../snap/Node';\nimport { Index } from '../snap/indexes/Index';\nimport { WriteTreeRef } from '../WriteTree';\nimport { ViewCache } from './ViewCache';\n\n/**\n * Since updates to filtered nodes might require nodes to be pulled in from \"outside\" the node, this interface\n * can help to get complete children that can be pulled in.\n * A class implementing this interface takes potentially multiple sources (e.g. user writes, server data from\n * other views etc.) to try it's best to get a complete child that might be useful in pulling into the view.\n *\n * @interface\n */\nexport interface CompleteChildSource {\n  /**\n   * @param {!string} childKey\n   * @return {?Node}\n   */\n  getCompleteChild(childKey: string): Node | null;\n\n  /**\n   * @param {!Index} index\n   * @param {!NamedNode} child\n   * @param {boolean} reverse\n   * @return {?NamedNode}\n   */\n  getChildAfterChild(\n    index: Index,\n    child: NamedNode,\n    reverse: boolean\n  ): NamedNode | null;\n}\n\n/**\n * An implementation of CompleteChildSource that never returns any additional children\n *\n * @private\n * @constructor\n * @implements CompleteChildSource\n */\nexport class NoCompleteChildSource_ implements CompleteChildSource {\n  /**\n   * @inheritDoc\n   */\n  getCompleteChild(childKey?: string): Node | null {\n    return null;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getChildAfterChild(\n    index?: Index,\n    child?: NamedNode,\n    reverse?: boolean\n  ): NamedNode | null {\n    return null;\n  }\n}\n\n/**\n * Singleton instance.\n * @const\n * @type {!CompleteChildSource}\n */\nexport const NO_COMPLETE_CHILD_SOURCE = new NoCompleteChildSource_();\n\n/**\n * An implementation of CompleteChildSource that uses a WriteTree in addition to any other server data or\n * old event caches available to calculate complete children.\n *\n *\n * @implements CompleteChildSource\n */\nexport class WriteTreeCompleteChildSource implements CompleteChildSource {\n  /**\n   * @param {!WriteTreeRef} writes_\n   * @param {!ViewCache} viewCache_\n   * @param {?Node} optCompleteServerCache_\n   */\n  constructor(\n    private writes_: WriteTreeRef,\n    private viewCache_: ViewCache,\n    private optCompleteServerCache_: Node | null = null\n  ) {}\n\n  /**\n   * @inheritDoc\n   */\n  getCompleteChild(childKey: string): Node | null {\n    const node = this.viewCache_.getEventCache();\n    if (node.isCompleteForChild(childKey)) {\n      return node.getNode().getImmediateChild(childKey);\n    } else {\n      const serverNode =\n        this.optCompleteServerCache_ != null\n          ? new CacheNode(this.optCompleteServerCache_, true, false)\n          : this.viewCache_.getServerCache();\n      return this.writes_.calcCompleteChild(childKey, serverNode);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getChildAfterChild(\n    index: Index,\n    child: NamedNode,\n    reverse: boolean\n  ): NamedNode | null {\n    const completeServerData =\n      this.optCompleteServerCache_ != null\n        ? this.optCompleteServerCache_\n        : this.viewCache_.getCompleteServerSnap();\n    const nodes = this.writes_.calcIndexedSlice(\n      completeServerData,\n      child,\n      1,\n      reverse,\n      index\n    );\n    if (nodes.length === 0) {\n      return null;\n    } else {\n      return nodes[0];\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Operation, OperationType } from '../operation/Operation';\nimport { assert, assertionError } from '@firebase/util';\nimport { ChildChangeAccumulator } from './ChildChangeAccumulator';\nimport { Change } from './Change';\nimport { ChildrenNode } from '../snap/ChildrenNode';\nimport { KEY_INDEX } from '../snap/indexes/KeyIndex';\nimport { ImmutableTree } from '../util/ImmutableTree';\nimport { Path } from '../util/Path';\nimport {\n  WriteTreeCompleteChildSource,\n  NO_COMPLETE_CHILD_SOURCE,\n  CompleteChildSource\n} from './CompleteChildSource';\nimport { ViewCache } from './ViewCache';\nimport { NodeFilter } from './filter/NodeFilter';\nimport { WriteTreeRef } from '../WriteTree';\nimport { Overwrite } from '../operation/Overwrite';\nimport { Merge } from '../operation/Merge';\nimport { AckUserWrite } from '../operation/AckUserWrite';\nimport { Node } from '../snap/Node';\n\n/**\n * @constructor\n * @struct\n */\nexport class ProcessorResult {\n  /**\n   * @param {!ViewCache} viewCache\n   * @param {!Array.<!Change>} changes\n   */\n  constructor(\n    public readonly viewCache: ViewCache,\n    public readonly changes: Change[]\n  ) {}\n}\n\n/**\n * @constructor\n */\nexport class ViewProcessor {\n  /**\n   * @param {!NodeFilter} filter_\n   */\n  constructor(private readonly filter_: NodeFilter) {}\n\n  /**\n   * @param {!ViewCache} viewCache\n   */\n  assertIndexed(viewCache: ViewCache) {\n    assert(\n      viewCache\n        .getEventCache()\n        .getNode()\n        .isIndexed(this.filter_.getIndex()),\n      'Event snap not indexed'\n    );\n    assert(\n      viewCache\n        .getServerCache()\n        .getNode()\n        .isIndexed(this.filter_.getIndex()),\n      'Server snap not indexed'\n    );\n  }\n\n  /**\n   * @param {!ViewCache} oldViewCache\n   * @param {!Operation} operation\n   * @param {!WriteTreeRef} writesCache\n   * @param {?Node} completeCache\n   * @return {!ProcessorResult}\n   */\n  applyOperation(\n    oldViewCache: ViewCache,\n    operation: Operation,\n    writesCache: WriteTreeRef,\n    completeCache: Node | null\n  ): ProcessorResult {\n    const accumulator = new ChildChangeAccumulator();\n    let newViewCache, filterServerNode;\n    if (operation.type === OperationType.OVERWRITE) {\n      const overwrite = operation as Overwrite;\n      if (overwrite.source.fromUser) {\n        newViewCache = this.applyUserOverwrite_(\n          oldViewCache,\n          overwrite.path,\n          overwrite.snap,\n          writesCache,\n          completeCache,\n          accumulator\n        );\n      } else {\n        assert(overwrite.source.fromServer, 'Unknown source.');\n        // We filter the node if it's a tagged update or the node has been previously filtered  and the\n        // update is not at the root in which case it is ok (and necessary) to mark the node unfiltered\n        // again\n        filterServerNode =\n          overwrite.source.tagged ||\n          (oldViewCache.getServerCache().isFiltered() &&\n            !overwrite.path.isEmpty());\n        newViewCache = this.applyServerOverwrite_(\n          oldViewCache,\n          overwrite.path,\n          overwrite.snap,\n          writesCache,\n          completeCache,\n          filterServerNode,\n          accumulator\n        );\n      }\n    } else if (operation.type === OperationType.MERGE) {\n      const merge = operation as Merge;\n      if (merge.source.fromUser) {\n        newViewCache = this.applyUserMerge_(\n          oldViewCache,\n          merge.path,\n          merge.children,\n          writesCache,\n          completeCache,\n          accumulator\n        );\n      } else {\n        assert(merge.source.fromServer, 'Unknown source.');\n        // We filter the node if it's a tagged update or the node has been previously filtered\n        filterServerNode =\n          merge.source.tagged || oldViewCache.getServerCache().isFiltered();\n        newViewCache = this.applyServerMerge_(\n          oldViewCache,\n          merge.path,\n          merge.children,\n          writesCache,\n          completeCache,\n          filterServerNode,\n          accumulator\n        );\n      }\n    } else if (operation.type === OperationType.ACK_USER_WRITE) {\n      const ackUserWrite = operation as AckUserWrite;\n      if (!ackUserWrite.revert) {\n        newViewCache = this.ackUserWrite_(\n          oldViewCache,\n          ackUserWrite.path,\n          ackUserWrite.affectedTree,\n          writesCache,\n          completeCache,\n          accumulator\n        );\n      } else {\n        newViewCache = this.revertUserWrite_(\n          oldViewCache,\n          ackUserWrite.path,\n          writesCache,\n          completeCache,\n          accumulator\n        );\n      }\n    } else if (operation.type === OperationType.LISTEN_COMPLETE) {\n      newViewCache = this.listenComplete_(\n        oldViewCache,\n        operation.path,\n        writesCache,\n        accumulator\n      );\n    } else {\n      throw assertionError('Unknown operation type: ' + operation.type);\n    }\n    const changes = accumulator.getChanges();\n    ViewProcessor.maybeAddValueEvent_(oldViewCache, newViewCache, changes);\n    return new ProcessorResult(newViewCache, changes);\n  }\n\n  /**\n   * @param {!ViewCache} oldViewCache\n   * @param {!ViewCache} newViewCache\n   * @param {!Array.<!Change>} accumulator\n   * @private\n   */\n  private static maybeAddValueEvent_(\n    oldViewCache: ViewCache,\n    newViewCache: ViewCache,\n    accumulator: Change[]\n  ) {\n    const eventSnap = newViewCache.getEventCache();\n    if (eventSnap.isFullyInitialized()) {\n      const isLeafOrEmpty =\n        eventSnap.getNode().isLeafNode() || eventSnap.getNode().isEmpty();\n      const oldCompleteSnap = oldViewCache.getCompleteEventSnap();\n      if (\n        accumulator.length > 0 ||\n        !oldViewCache.getEventCache().isFullyInitialized() ||\n        (isLeafOrEmpty &&\n          !eventSnap.getNode().equals(/** @type {!Node} */ oldCompleteSnap)) ||\n        !eventSnap\n          .getNode()\n          .getPriority()\n          .equals(oldCompleteSnap.getPriority())\n      ) {\n        accumulator.push(\n          Change.valueChange(\n            /** @type {!Node} */ newViewCache.getCompleteEventSnap()\n          )\n        );\n      }\n    }\n  }\n\n  /**\n   * @param {!ViewCache} viewCache\n   * @param {!Path} changePath\n   * @param {!WriteTreeRef} writesCache\n   * @param {!CompleteChildSource} source\n   * @param {!ChildChangeAccumulator} accumulator\n   * @return {!ViewCache}\n   * @private\n   */\n  private generateEventCacheAfterServerEvent_(\n    viewCache: ViewCache,\n    changePath: Path,\n    writesCache: WriteTreeRef,\n    source: CompleteChildSource,\n    accumulator: ChildChangeAccumulator\n  ): ViewCache {\n    const oldEventSnap = viewCache.getEventCache();\n    if (writesCache.shadowingWrite(changePath) != null) {\n      // we have a shadowing write, ignore changes\n      return viewCache;\n    } else {\n      let newEventCache, serverNode;\n      if (changePath.isEmpty()) {\n        // TODO: figure out how this plays with \"sliding ack windows\"\n        assert(\n          viewCache.getServerCache().isFullyInitialized(),\n          'If change path is empty, we must have complete server data'\n        );\n        if (viewCache.getServerCache().isFiltered()) {\n          // We need to special case this, because we need to only apply writes to complete children, or\n          // we might end up raising events for incomplete children. If the server data is filtered deep\n          // writes cannot be guaranteed to be complete\n          const serverCache = viewCache.getCompleteServerSnap();\n          const completeChildren =\n            serverCache instanceof ChildrenNode\n              ? serverCache\n              : ChildrenNode.EMPTY_NODE;\n          const completeEventChildren = writesCache.calcCompleteEventChildren(\n            completeChildren\n          );\n          newEventCache = this.filter_.updateFullNode(\n            viewCache.getEventCache().getNode(),\n            completeEventChildren,\n            accumulator\n          );\n        } else {\n          const completeNode = writesCache.calcCompleteEventCache(\n            viewCache.getCompleteServerSnap()\n          );\n          newEventCache = this.filter_.updateFullNode(\n            viewCache.getEventCache().getNode(),\n            completeNode,\n            accumulator\n          );\n        }\n      } else {\n        const childKey = changePath.getFront();\n        if (childKey == '.priority') {\n          assert(\n            changePath.getLength() == 1,\n            \"Can't have a priority with additional path components\"\n          );\n          const oldEventNode = oldEventSnap.getNode();\n          serverNode = viewCache.getServerCache().getNode();\n          // we might have overwrites for this priority\n          const updatedPriority = writesCache.calcEventCacheAfterServerOverwrite(\n            changePath,\n            oldEventNode,\n            serverNode\n          );\n          if (updatedPriority != null) {\n            newEventCache = this.filter_.updatePriority(\n              oldEventNode,\n              updatedPriority\n            );\n          } else {\n            // priority didn't change, keep old node\n            newEventCache = oldEventSnap.getNode();\n          }\n        } else {\n          const childChangePath = changePath.popFront();\n          // update child\n          let newEventChild;\n          if (oldEventSnap.isCompleteForChild(childKey)) {\n            serverNode = viewCache.getServerCache().getNode();\n            const eventChildUpdate = writesCache.calcEventCacheAfterServerOverwrite(\n              changePath,\n              oldEventSnap.getNode(),\n              serverNode\n            );\n            if (eventChildUpdate != null) {\n              newEventChild = oldEventSnap\n                .getNode()\n                .getImmediateChild(childKey)\n                .updateChild(childChangePath, eventChildUpdate);\n            } else {\n              // Nothing changed, just keep the old child\n              newEventChild = oldEventSnap\n                .getNode()\n                .getImmediateChild(childKey);\n            }\n          } else {\n            newEventChild = writesCache.calcCompleteChild(\n              childKey,\n              viewCache.getServerCache()\n            );\n          }\n          if (newEventChild != null) {\n            newEventCache = this.filter_.updateChild(\n              oldEventSnap.getNode(),\n              childKey,\n              newEventChild,\n              childChangePath,\n              source,\n              accumulator\n            );\n          } else {\n            // no complete child available or no change\n            newEventCache = oldEventSnap.getNode();\n          }\n        }\n      }\n      return viewCache.updateEventSnap(\n        newEventCache,\n        oldEventSnap.isFullyInitialized() || changePath.isEmpty(),\n        this.filter_.filtersNodes()\n      );\n    }\n  }\n\n  /**\n   * @param {!ViewCache} oldViewCache\n   * @param {!Path} changePath\n   * @param {!Node} changedSnap\n   * @param {!WriteTreeRef} writesCache\n   * @param {?Node} completeCache\n   * @param {boolean} filterServerNode\n   * @param {!ChildChangeAccumulator} accumulator\n   * @return {!ViewCache}\n   * @private\n   */\n  applyServerOverwrite_(\n    oldViewCache: ViewCache,\n    changePath: Path,\n    changedSnap: Node,\n    writesCache: WriteTreeRef,\n    completeCache: Node | null,\n    filterServerNode: boolean,\n    accumulator: ChildChangeAccumulator\n  ): ViewCache {\n    const oldServerSnap = oldViewCache.getServerCache();\n    let newServerCache;\n    const serverFilter = filterServerNode\n      ? this.filter_\n      : this.filter_.getIndexedFilter();\n    if (changePath.isEmpty()) {\n      newServerCache = serverFilter.updateFullNode(\n        oldServerSnap.getNode(),\n        changedSnap,\n        null\n      );\n    } else if (serverFilter.filtersNodes() && !oldServerSnap.isFiltered()) {\n      // we want to filter the server node, but we didn't filter the server node yet, so simulate a full update\n      const newServerNode = oldServerSnap\n        .getNode()\n        .updateChild(changePath, changedSnap);\n      newServerCache = serverFilter.updateFullNode(\n        oldServerSnap.getNode(),\n        newServerNode,\n        null\n      );\n    } else {\n      const childKey = changePath.getFront();\n      if (\n        !oldServerSnap.isCompleteForPath(changePath) &&\n        changePath.getLength() > 1\n      ) {\n        // We don't update incomplete nodes with updates intended for other listeners\n        return oldViewCache;\n      }\n      const childChangePath = changePath.popFront();\n      const childNode = oldServerSnap.getNode().getImmediateChild(childKey);\n      const newChildNode = childNode.updateChild(childChangePath, changedSnap);\n      if (childKey == '.priority') {\n        newServerCache = serverFilter.updatePriority(\n          oldServerSnap.getNode(),\n          newChildNode\n        );\n      } else {\n        newServerCache = serverFilter.updateChild(\n          oldServerSnap.getNode(),\n          childKey,\n          newChildNode,\n          childChangePath,\n          NO_COMPLETE_CHILD_SOURCE,\n          null\n        );\n      }\n    }\n    const newViewCache = oldViewCache.updateServerSnap(\n      newServerCache,\n      oldServerSnap.isFullyInitialized() || changePath.isEmpty(),\n      serverFilter.filtersNodes()\n    );\n    const source = new WriteTreeCompleteChildSource(\n      writesCache,\n      newViewCache,\n      completeCache\n    );\n    return this.generateEventCacheAfterServerEvent_(\n      newViewCache,\n      changePath,\n      writesCache,\n      source,\n      accumulator\n    );\n  }\n\n  /**\n   * @param {!ViewCache} oldViewCache\n   * @param {!Path} changePath\n   * @param {!Node} changedSnap\n   * @param {!WriteTreeRef} writesCache\n   * @param {?Node} completeCache\n   * @param {!ChildChangeAccumulator} accumulator\n   * @return {!ViewCache}\n   * @private\n   */\n  applyUserOverwrite_(\n    oldViewCache: ViewCache,\n    changePath: Path,\n    changedSnap: Node,\n    writesCache: WriteTreeRef,\n    completeCache: Node | null,\n    accumulator: ChildChangeAccumulator\n  ): ViewCache {\n    const oldEventSnap = oldViewCache.getEventCache();\n    let newViewCache, newEventCache;\n    const source = new WriteTreeCompleteChildSource(\n      writesCache,\n      oldViewCache,\n      completeCache\n    );\n    if (changePath.isEmpty()) {\n      newEventCache = this.filter_.updateFullNode(\n        oldViewCache.getEventCache().getNode(),\n        changedSnap,\n        accumulator\n      );\n      newViewCache = oldViewCache.updateEventSnap(\n        newEventCache,\n        true,\n        this.filter_.filtersNodes()\n      );\n    } else {\n      const childKey = changePath.getFront();\n      if (childKey === '.priority') {\n        newEventCache = this.filter_.updatePriority(\n          oldViewCache.getEventCache().getNode(),\n          changedSnap\n        );\n        newViewCache = oldViewCache.updateEventSnap(\n          newEventCache,\n          oldEventSnap.isFullyInitialized(),\n          oldEventSnap.isFiltered()\n        );\n      } else {\n        const childChangePath = changePath.popFront();\n        const oldChild = oldEventSnap.getNode().getImmediateChild(childKey);\n        let newChild;\n        if (childChangePath.isEmpty()) {\n          // Child overwrite, we can replace the child\n          newChild = changedSnap;\n        } else {\n          const childNode = source.getCompleteChild(childKey);\n          if (childNode != null) {\n            if (\n              childChangePath.getBack() === '.priority' &&\n              childNode.getChild(childChangePath.parent()).isEmpty()\n            ) {\n              // This is a priority update on an empty node. If this node exists on the server, the\n              // server will send down the priority in the update, so ignore for now\n              newChild = childNode;\n            } else {\n              newChild = childNode.updateChild(childChangePath, changedSnap);\n            }\n          } else {\n            // There is no complete child node available\n            newChild = ChildrenNode.EMPTY_NODE;\n          }\n        }\n        if (!oldChild.equals(newChild)) {\n          const newEventSnap = this.filter_.updateChild(\n            oldEventSnap.getNode(),\n            childKey,\n            newChild,\n            childChangePath,\n            source,\n            accumulator\n          );\n          newViewCache = oldViewCache.updateEventSnap(\n            newEventSnap,\n            oldEventSnap.isFullyInitialized(),\n            this.filter_.filtersNodes()\n          );\n        } else {\n          newViewCache = oldViewCache;\n        }\n      }\n    }\n    return newViewCache;\n  }\n\n  /**\n   * @param {!ViewCache} viewCache\n   * @param {string} childKey\n   * @return {boolean}\n   * @private\n   */\n  private static cacheHasChild_(\n    viewCache: ViewCache,\n    childKey: string\n  ): boolean {\n    return viewCache.getEventCache().isCompleteForChild(childKey);\n  }\n\n  /**\n   * @param {!ViewCache} viewCache\n   * @param {!Path} path\n   * @param {ImmutableTree.<!Node>} changedChildren\n   * @param {!WriteTreeRef} writesCache\n   * @param {?Node} serverCache\n   * @param {!ChildChangeAccumulator} accumulator\n   * @return {!ViewCache}\n   * @private\n   */\n  private applyUserMerge_(\n    viewCache: ViewCache,\n    path: Path,\n    changedChildren: ImmutableTree<Node>,\n    writesCache: WriteTreeRef,\n    serverCache: Node | null,\n    accumulator: ChildChangeAccumulator\n  ): ViewCache {\n    // HACK: In the case of a limit query, there may be some changes that bump things out of the\n    // window leaving room for new items.  It's important we process these changes first, so we\n    // iterate the changes twice, first processing any that affect items currently in view.\n    // TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\n    // and event snap.  I'm not sure if this will result in edge cases when a child is in one but\n    // not the other.\n    let curViewCache = viewCache;\n    changedChildren.foreach((relativePath, childNode) => {\n      const writePath = path.child(relativePath);\n      if (ViewProcessor.cacheHasChild_(viewCache, writePath.getFront())) {\n        curViewCache = this.applyUserOverwrite_(\n          curViewCache,\n          writePath,\n          childNode,\n          writesCache,\n          serverCache,\n          accumulator\n        );\n      }\n    });\n\n    changedChildren.foreach((relativePath, childNode) => {\n      const writePath = path.child(relativePath);\n      if (!ViewProcessor.cacheHasChild_(viewCache, writePath.getFront())) {\n        curViewCache = this.applyUserOverwrite_(\n          curViewCache,\n          writePath,\n          childNode,\n          writesCache,\n          serverCache,\n          accumulator\n        );\n      }\n    });\n\n    return curViewCache;\n  }\n\n  /**\n   * @param {!Node} node\n   * @param {ImmutableTree.<!Node>} merge\n   * @return {!Node}\n   * @private\n   */\n  private applyMerge_(node: Node, merge: ImmutableTree<Node>): Node {\n    merge.foreach(function(relativePath, childNode) {\n      node = node.updateChild(relativePath, childNode);\n    });\n    return node;\n  }\n\n  /**\n   * @param {!ViewCache} viewCache\n   * @param {!Path} path\n   * @param {!ImmutableTree.<!Node>} changedChildren\n   * @param {!WriteTreeRef} writesCache\n   * @param {?Node} serverCache\n   * @param {boolean} filterServerNode\n   * @param {!ChildChangeAccumulator} accumulator\n   * @return {!ViewCache}\n   * @private\n   */\n  private applyServerMerge_(\n    viewCache: ViewCache,\n    path: Path,\n    changedChildren: ImmutableTree<Node>,\n    writesCache: WriteTreeRef,\n    serverCache: Node | null,\n    filterServerNode: boolean,\n    accumulator: ChildChangeAccumulator\n  ): ViewCache {\n    // If we don't have a cache yet, this merge was intended for a previously listen in the same location. Ignore it and\n    // wait for the complete data update coming soon.\n    if (\n      viewCache\n        .getServerCache()\n        .getNode()\n        .isEmpty() &&\n      !viewCache.getServerCache().isFullyInitialized()\n    ) {\n      return viewCache;\n    }\n\n    // HACK: In the case of a limit query, there may be some changes that bump things out of the\n    // window leaving room for new items.  It's important we process these changes first, so we\n    // iterate the changes twice, first processing any that affect items currently in view.\n    // TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\n    // and event snap.  I'm not sure if this will result in edge cases when a child is in one but\n    // not the other.\n    let curViewCache = viewCache;\n    let viewMergeTree;\n    if (path.isEmpty()) {\n      viewMergeTree = changedChildren;\n    } else {\n      viewMergeTree = ImmutableTree.Empty.setTree(path, changedChildren);\n    }\n    const serverNode = viewCache.getServerCache().getNode();\n    viewMergeTree.children.inorderTraversal((childKey, childTree) => {\n      if (serverNode.hasChild(childKey)) {\n        const serverChild = viewCache\n          .getServerCache()\n          .getNode()\n          .getImmediateChild(childKey);\n        const newChild = this.applyMerge_(serverChild, childTree);\n        curViewCache = this.applyServerOverwrite_(\n          curViewCache,\n          new Path(childKey),\n          newChild,\n          writesCache,\n          serverCache,\n          filterServerNode,\n          accumulator\n        );\n      }\n    });\n    viewMergeTree.children.inorderTraversal((childKey, childMergeTree) => {\n      const isUnknownDeepMerge =\n        !viewCache.getServerCache().isCompleteForChild(childKey) &&\n        childMergeTree.value == null;\n      if (!serverNode.hasChild(childKey) && !isUnknownDeepMerge) {\n        const serverChild = viewCache\n          .getServerCache()\n          .getNode()\n          .getImmediateChild(childKey);\n        const newChild = this.applyMerge_(serverChild, childMergeTree);\n        curViewCache = this.applyServerOverwrite_(\n          curViewCache,\n          new Path(childKey),\n          newChild,\n          writesCache,\n          serverCache,\n          filterServerNode,\n          accumulator\n        );\n      }\n    });\n\n    return curViewCache;\n  }\n\n  /**\n   * @param {!ViewCache} viewCache\n   * @param {!Path} ackPath\n   * @param {!ImmutableTree<!boolean>} affectedTree\n   * @param {!WriteTreeRef} writesCache\n   * @param {?Node} completeCache\n   * @param {!ChildChangeAccumulator} accumulator\n   * @return {!ViewCache}\n   * @private\n   */\n  private ackUserWrite_(\n    viewCache: ViewCache,\n    ackPath: Path,\n    affectedTree: ImmutableTree<boolean>,\n    writesCache: WriteTreeRef,\n    completeCache: Node | null,\n    accumulator: ChildChangeAccumulator\n  ): ViewCache {\n    if (writesCache.shadowingWrite(ackPath) != null) {\n      return viewCache;\n    }\n\n    // Only filter server node if it is currently filtered\n    const filterServerNode = viewCache.getServerCache().isFiltered();\n\n    // Essentially we'll just get our existing server cache for the affected paths and re-apply it as a server update\n    // now that it won't be shadowed.\n    const serverCache = viewCache.getServerCache();\n    if (affectedTree.value != null) {\n      // This is an overwrite.\n      if (\n        (ackPath.isEmpty() && serverCache.isFullyInitialized()) ||\n        serverCache.isCompleteForPath(ackPath)\n      ) {\n        return this.applyServerOverwrite_(\n          viewCache,\n          ackPath,\n          serverCache.getNode().getChild(ackPath),\n          writesCache,\n          completeCache,\n          filterServerNode,\n          accumulator\n        );\n      } else if (ackPath.isEmpty()) {\n        // This is a goofy edge case where we are acking data at this location but don't have full data.  We\n        // should just re-apply whatever we have in our cache as a merge.\n        let changedChildren = ImmutableTree.Empty;\n        serverCache.getNode().forEachChild(KEY_INDEX, function(name, node) {\n          changedChildren = changedChildren.set(new Path(name), node);\n        });\n        return this.applyServerMerge_(\n          viewCache,\n          ackPath,\n          changedChildren,\n          writesCache,\n          completeCache,\n          filterServerNode,\n          accumulator\n        );\n      } else {\n        return viewCache;\n      }\n    } else {\n      // This is a merge.\n      let changedChildren = ImmutableTree.Empty;\n      affectedTree.foreach(function(mergePath, value) {\n        const serverCachePath = ackPath.child(mergePath);\n        if (serverCache.isCompleteForPath(serverCachePath)) {\n          changedChildren = changedChildren.set(\n            mergePath,\n            serverCache.getNode().getChild(serverCachePath)\n          );\n        }\n      });\n      return this.applyServerMerge_(\n        viewCache,\n        ackPath,\n        changedChildren,\n        writesCache,\n        completeCache,\n        filterServerNode,\n        accumulator\n      );\n    }\n  }\n\n  /**\n   * @param {!ViewCache} viewCache\n   * @param {!Path} path\n   * @param {!WriteTreeRef} writesCache\n   * @param {!ChildChangeAccumulator} accumulator\n   * @return {!ViewCache}\n   * @private\n   */\n  private listenComplete_(\n    viewCache: ViewCache,\n    path: Path,\n    writesCache: WriteTreeRef,\n    accumulator: ChildChangeAccumulator\n  ): ViewCache {\n    const oldServerNode = viewCache.getServerCache();\n    const newViewCache = viewCache.updateServerSnap(\n      oldServerNode.getNode(),\n      oldServerNode.isFullyInitialized() || path.isEmpty(),\n      oldServerNode.isFiltered()\n    );\n    return this.generateEventCacheAfterServerEvent_(\n      newViewCache,\n      path,\n      writesCache,\n      NO_COMPLETE_CHILD_SOURCE,\n      accumulator\n    );\n  }\n\n  /**\n   * @param {!ViewCache} viewCache\n   * @param {!Path} path\n   * @param {!WriteTreeRef} writesCache\n   * @param {?Node} completeServerCache\n   * @param {!ChildChangeAccumulator} accumulator\n   * @return {!ViewCache}\n   * @private\n   */\n  private revertUserWrite_(\n    viewCache: ViewCache,\n    path: Path,\n    writesCache: WriteTreeRef,\n    completeServerCache: Node | null,\n    accumulator: ChildChangeAccumulator\n  ): ViewCache {\n    let complete;\n    if (writesCache.shadowingWrite(path) != null) {\n      return viewCache;\n    } else {\n      const source = new WriteTreeCompleteChildSource(\n        writesCache,\n        viewCache,\n        completeServerCache\n      );\n      const oldEventCache = viewCache.getEventCache().getNode();\n      let newEventCache;\n      if (path.isEmpty() || path.getFront() === '.priority') {\n        let newNode;\n        if (viewCache.getServerCache().isFullyInitialized()) {\n          newNode = writesCache.calcCompleteEventCache(\n            viewCache.getCompleteServerSnap()\n          );\n        } else {\n          const serverChildren = viewCache.getServerCache().getNode();\n          assert(\n            serverChildren instanceof ChildrenNode,\n            'serverChildren would be complete if leaf node'\n          );\n          newNode = writesCache.calcCompleteEventChildren(\n            serverChildren as ChildrenNode\n          );\n        }\n        newNode = newNode as Node;\n        newEventCache = this.filter_.updateFullNode(\n          oldEventCache,\n          newNode,\n          accumulator\n        );\n      } else {\n        const childKey = path.getFront();\n        let newChild = writesCache.calcCompleteChild(\n          childKey,\n          viewCache.getServerCache()\n        );\n        if (\n          newChild == null &&\n          viewCache.getServerCache().isCompleteForChild(childKey)\n        ) {\n          newChild = oldEventCache.getImmediateChild(childKey);\n        }\n        if (newChild != null) {\n          newEventCache = this.filter_.updateChild(\n            oldEventCache,\n            childKey,\n            newChild,\n            path.popFront(),\n            source,\n            accumulator\n          );\n        } else if (\n          viewCache\n            .getEventCache()\n            .getNode()\n            .hasChild(childKey)\n        ) {\n          // No complete child available, delete the existing one, if any\n          newEventCache = this.filter_.updateChild(\n            oldEventCache,\n            childKey,\n            ChildrenNode.EMPTY_NODE,\n            path.popFront(),\n            source,\n            accumulator\n          );\n        } else {\n          newEventCache = oldEventCache;\n        }\n        if (\n          newEventCache.isEmpty() &&\n          viewCache.getServerCache().isFullyInitialized()\n        ) {\n          // We might have reverted all child writes. Maybe the old event was a leaf node\n          complete = writesCache.calcCompleteEventCache(\n            viewCache.getCompleteServerSnap()\n          );\n          if (complete.isLeafNode()) {\n            newEventCache = this.filter_.updateFullNode(\n              newEventCache,\n              complete,\n              accumulator\n            );\n          }\n        }\n      }\n      complete =\n        viewCache.getServerCache().isFullyInitialized() ||\n        writesCache.shadowingWrite(Path.Empty) != null;\n      return viewCache.updateEventSnap(\n        newEventCache,\n        complete,\n        this.filter_.filtersNodes()\n      );\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { NamedNode, Node } from '../snap/Node';\nimport { Change } from './Change';\nimport { assertionError } from '@firebase/util';\nimport { Query } from '../../api/Query';\nimport { Index } from '../snap/indexes/Index';\nimport { EventRegistration } from './EventRegistration';\nimport { Event } from './Event';\n\n/**\n * An EventGenerator is used to convert \"raw\" changes (Change) as computed by the\n * CacheDiffer into actual events (Event) that can be raised.  See generateEventsForChanges()\n * for details.\n *\n * @constructor\n */\nexport class EventGenerator {\n  private index_: Index;\n\n  /**\n   *\n   * @param {!Query} query_\n   */\n  constructor(private query_: Query) {\n    /**\n     * @private\n     * @type {!Index}\n     */\n    this.index_ = this.query_.getQueryParams().getIndex();\n  }\n\n  /**\n   * Given a set of raw changes (no moved events and prevName not specified yet), and a set of\n   * EventRegistrations that should be notified of these changes, generate the actual events to be raised.\n   *\n   * Notes:\n   *  - child_moved events will be synthesized at this time for any child_changed events that affect\n   *    our index.\n   *  - prevName will be calculated based on the index ordering.\n   *\n   * @param {!Array.<!Change>} changes\n   * @param {!Node} eventCache\n   * @param {!Array.<!EventRegistration>} eventRegistrations\n   * @return {!Array.<!Event>}\n   */\n  generateEventsForChanges(\n    changes: Change[],\n    eventCache: Node,\n    eventRegistrations: EventRegistration[]\n  ): Event[] {\n    const events: Event[] = [];\n    const moves: Change[] = [];\n\n    changes.forEach(change => {\n      if (\n        change.type === Change.CHILD_CHANGED &&\n        this.index_.indexedValueChanged(\n          change.oldSnap as Node,\n          change.snapshotNode\n        )\n      ) {\n        moves.push(\n          Change.childMovedChange(\n            change.childName as string,\n            change.snapshotNode\n          )\n        );\n      }\n    });\n\n    this.generateEventsForType_(\n      events,\n      Change.CHILD_REMOVED,\n      changes,\n      eventRegistrations,\n      eventCache\n    );\n    this.generateEventsForType_(\n      events,\n      Change.CHILD_ADDED,\n      changes,\n      eventRegistrations,\n      eventCache\n    );\n    this.generateEventsForType_(\n      events,\n      Change.CHILD_MOVED,\n      moves,\n      eventRegistrations,\n      eventCache\n    );\n    this.generateEventsForType_(\n      events,\n      Change.CHILD_CHANGED,\n      changes,\n      eventRegistrations,\n      eventCache\n    );\n    this.generateEventsForType_(\n      events,\n      Change.VALUE,\n      changes,\n      eventRegistrations,\n      eventCache\n    );\n\n    return events;\n  }\n\n  /**\n   * Given changes of a single change type, generate the corresponding events.\n   *\n   * @param {!Array.<!Event>} events\n   * @param {!string} eventType\n   * @param {!Array.<!Change>} changes\n   * @param {!Array.<!EventRegistration>} registrations\n   * @param {!Node} eventCache\n   * @private\n   */\n  private generateEventsForType_(\n    events: Event[],\n    eventType: string,\n    changes: Change[],\n    registrations: EventRegistration[],\n    eventCache: Node\n  ) {\n    const filteredChanges = changes.filter(change => change.type === eventType);\n\n    filteredChanges.sort(this.compareChanges_.bind(this));\n    filteredChanges.forEach(change => {\n      const materializedChange = this.materializeSingleChange_(\n        change,\n        eventCache\n      );\n      registrations.forEach(registration => {\n        if (registration.respondsTo(change.type)) {\n          events.push(\n            registration.createEvent(materializedChange, this.query_)\n          );\n        }\n      });\n    });\n  }\n\n  /**\n   * @param {!Change} change\n   * @param {!Node} eventCache\n   * @return {!Change}\n   * @private\n   */\n  private materializeSingleChange_(change: Change, eventCache: Node): Change {\n    if (change.type === 'value' || change.type === 'child_removed') {\n      return change;\n    } else {\n      change.prevName = eventCache.getPredecessorChildName(\n        /** @type {!string} */\n        change.childName,\n        change.snapshotNode,\n        this.index_\n      );\n      return change;\n    }\n  }\n\n  /**\n   * @param {!Change} a\n   * @param {!Change} b\n   * @return {number}\n   * @private\n   */\n  private compareChanges_(a: Change, b: Change) {\n    if (a.childName == null || b.childName == null) {\n      throw assertionError('Should only compare child_ events.');\n    }\n    const aWrapped = new NamedNode(a.childName, a.snapshotNode);\n    const bWrapped = new NamedNode(b.childName, b.snapshotNode);\n    return this.index_.compare(aWrapped, bWrapped);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IndexedFilter } from './filter/IndexedFilter';\nimport { ViewProcessor } from './ViewProcessor';\nimport { ChildrenNode } from '../snap/ChildrenNode';\nimport { CacheNode } from './CacheNode';\nimport { ViewCache } from './ViewCache';\nimport { EventGenerator } from './EventGenerator';\nimport { assert } from '@firebase/util';\nimport { Operation, OperationType } from '../operation/Operation';\nimport { Change } from './Change';\nimport { PRIORITY_INDEX } from '../snap/indexes/PriorityIndex';\nimport { Query } from '../../api/Query';\nimport { EventRegistration } from './EventRegistration';\nimport { Node } from '../snap/Node';\nimport { Path } from '../util/Path';\nimport { WriteTreeRef } from '../WriteTree';\nimport { CancelEvent, Event } from './Event';\n\n/**\n * A view represents a specific location and query that has 1 or more event registrations.\n *\n * It does several things:\n *  - Maintains the list of event registrations for this location/query.\n *  - Maintains a cache of the data visible for this location/query.\n *  - Applies new operations (via applyOperation), updates the cache, and based on the event\n *    registrations returns the set of events to be raised.\n * @constructor\n */\nexport class View {\n  private processor_: ViewProcessor;\n  private viewCache_: ViewCache;\n  private eventRegistrations_: EventRegistration[] = [];\n  private eventGenerator_: EventGenerator;\n\n  /**\n   *\n   * @param {!Query} query_\n   * @param {!ViewCache} initialViewCache\n   */\n  constructor(private query_: Query, initialViewCache: ViewCache) {\n    const params = this.query_.getQueryParams();\n\n    const indexFilter = new IndexedFilter(params.getIndex());\n    const filter = params.getNodeFilter();\n\n    /**\n     * @type {ViewProcessor}\n     * @private\n     */\n    this.processor_ = new ViewProcessor(filter);\n\n    const initialServerCache = initialViewCache.getServerCache();\n    const initialEventCache = initialViewCache.getEventCache();\n\n    // Don't filter server node with other filter than index, wait for tagged listen\n    const serverSnap = indexFilter.updateFullNode(\n      ChildrenNode.EMPTY_NODE,\n      initialServerCache.getNode(),\n      null\n    );\n    const eventSnap = filter.updateFullNode(\n      ChildrenNode.EMPTY_NODE,\n      initialEventCache.getNode(),\n      null\n    );\n    const newServerCache = new CacheNode(\n      serverSnap,\n      initialServerCache.isFullyInitialized(),\n      indexFilter.filtersNodes()\n    );\n    const newEventCache = new CacheNode(\n      eventSnap,\n      initialEventCache.isFullyInitialized(),\n      filter.filtersNodes()\n    );\n\n    /**\n     * @type {!ViewCache}\n     * @private\n     */\n    this.viewCache_ = new ViewCache(newEventCache, newServerCache);\n\n    /**\n     * @type {!EventGenerator}\n     * @private\n     */\n    this.eventGenerator_ = new EventGenerator(this.query_);\n  }\n\n  /**\n   * @return {!Query}\n   */\n  getQuery(): Query {\n    return this.query_;\n  }\n\n  /**\n   * @return {?Node}\n   */\n  getServerCache(): Node | null {\n    return this.viewCache_.getServerCache().getNode();\n  }\n\n  /**\n   * @param {!Path} path\n   * @return {?Node}\n   */\n  getCompleteServerCache(path: Path): Node | null {\n    const cache = this.viewCache_.getCompleteServerSnap();\n    if (cache) {\n      // If this isn't a \"loadsAllData\" view, then cache isn't actually a complete cache and\n      // we need to see if it contains the child we're interested in.\n      if (\n        this.query_.getQueryParams().loadsAllData() ||\n        (!path.isEmpty() && !cache.getImmediateChild(path.getFront()).isEmpty())\n      ) {\n        return cache.getChild(path);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isEmpty(): boolean {\n    return this.eventRegistrations_.length === 0;\n  }\n\n  /**\n   * @param {!EventRegistration} eventRegistration\n   */\n  addEventRegistration(eventRegistration: EventRegistration) {\n    this.eventRegistrations_.push(eventRegistration);\n  }\n\n  /**\n   * @param {?EventRegistration} eventRegistration If null, remove all callbacks.\n   * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\n   * @return {!Array.<!Event>} Cancel events, if cancelError was provided.\n   */\n  removeEventRegistration(\n    eventRegistration: EventRegistration | null,\n    cancelError?: Error\n  ): Event[] {\n    const cancelEvents: CancelEvent[] = [];\n    if (cancelError) {\n      assert(\n        eventRegistration == null,\n        'A cancel should cancel all event registrations.'\n      );\n      const path = this.query_.path;\n      this.eventRegistrations_.forEach(function(registration) {\n        cancelError /** @type {!Error} */ = cancelError;\n        const maybeEvent = registration.createCancelEvent(cancelError, path);\n        if (maybeEvent) {\n          cancelEvents.push(maybeEvent);\n        }\n      });\n    }\n\n    if (eventRegistration) {\n      let remaining = [];\n      for (let i = 0; i < this.eventRegistrations_.length; ++i) {\n        const existing = this.eventRegistrations_[i];\n        if (!existing.matches(eventRegistration)) {\n          remaining.push(existing);\n        } else if (eventRegistration.hasAnyCallback()) {\n          // We're removing just this one\n          remaining = remaining.concat(this.eventRegistrations_.slice(i + 1));\n          break;\n        }\n      }\n      this.eventRegistrations_ = remaining;\n    } else {\n      this.eventRegistrations_ = [];\n    }\n    return cancelEvents;\n  }\n\n  /**\n   * Applies the given Operation, updates our cache, and returns the appropriate events.\n   *\n   * @param {!Operation} operation\n   * @param {!WriteTreeRef} writesCache\n   * @param {?Node} completeServerCache\n   * @return {!Array.<!Event>}\n   */\n  applyOperation(\n    operation: Operation,\n    writesCache: WriteTreeRef,\n    completeServerCache: Node | null\n  ): Event[] {\n    if (\n      operation.type === OperationType.MERGE &&\n      operation.source.queryId !== null\n    ) {\n      assert(\n        this.viewCache_.getCompleteServerSnap(),\n        'We should always have a full cache before handling merges'\n      );\n      assert(\n        this.viewCache_.getCompleteEventSnap(),\n        'Missing event cache, even though we have a server cache'\n      );\n    }\n\n    const oldViewCache = this.viewCache_;\n    const result = this.processor_.applyOperation(\n      oldViewCache,\n      operation,\n      writesCache,\n      completeServerCache\n    );\n    this.processor_.assertIndexed(result.viewCache);\n\n    assert(\n      result.viewCache.getServerCache().isFullyInitialized() ||\n        !oldViewCache.getServerCache().isFullyInitialized(),\n      'Once a server snap is complete, it should never go back'\n    );\n\n    this.viewCache_ = result.viewCache;\n\n    return this.generateEventsForChanges_(\n      result.changes,\n      result.viewCache.getEventCache().getNode(),\n      null\n    );\n  }\n\n  /**\n   * @param {!EventRegistration} registration\n   * @return {!Array.<!Event>}\n   */\n  getInitialEvents(registration: EventRegistration): Event[] {\n    const eventSnap = this.viewCache_.getEventCache();\n    const initialChanges: Change[] = [];\n    if (!eventSnap.getNode().isLeafNode()) {\n      const eventNode = eventSnap.getNode() as ChildrenNode;\n      eventNode.forEachChild(PRIORITY_INDEX, function(key, childNode) {\n        initialChanges.push(Change.childAddedChange(key, childNode));\n      });\n    }\n    if (eventSnap.isFullyInitialized()) {\n      initialChanges.push(Change.valueChange(eventSnap.getNode()));\n    }\n    return this.generateEventsForChanges_(\n      initialChanges,\n      eventSnap.getNode(),\n      registration\n    );\n  }\n\n  /**\n   * @private\n   * @param {!Array.<!Change>} changes\n   * @param {!Node} eventCache\n   * @param {EventRegistration=} eventRegistration\n   * @return {!Array.<!Event>}\n   */\n  generateEventsForChanges_(\n    changes: Change[],\n    eventCache: Node,\n    eventRegistration?: EventRegistration\n  ): Event[] {\n    const registrations = eventRegistration\n      ? [eventRegistration]\n      : this.eventRegistrations_;\n    return this.eventGenerator_.generateEventsForChanges(\n      changes,\n      eventCache,\n      registrations\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ImmutableTree } from './util/ImmutableTree';\nimport { Path } from './util/Path';\nimport { Node, NamedNode } from './snap/Node';\nimport { PRIORITY_INDEX } from './snap/indexes/PriorityIndex';\nimport { assert } from '@firebase/util';\nimport { ChildrenNode } from './snap/ChildrenNode';\nimport { each } from './util/util';\n\n/**\n * This class holds a collection of writes that can be applied to nodes in unison. It abstracts away the logic with\n * dealing with priority writes and multiple nested writes. At any given path there is only allowed to be one write\n * modifying that path. Any write to an existing path or shadowing an existing path will modify that existing write\n * to reflect the write added.\n */\nexport class CompoundWrite {\n  constructor(private writeTree_: ImmutableTree<Node>) {}\n\n  static Empty = new CompoundWrite(new ImmutableTree(null));\n\n  addWrite(path: Path, node: Node): CompoundWrite {\n    if (path.isEmpty()) {\n      return new CompoundWrite(new ImmutableTree(node));\n    } else {\n      const rootmost = this.writeTree_.findRootMostValueAndPath(path);\n      if (rootmost != null) {\n        const rootMostPath = rootmost.path;\n        let value = rootmost.value;\n        const relativePath = Path.relativePath(rootMostPath, path);\n        value = value.updateChild(relativePath, node);\n        return new CompoundWrite(this.writeTree_.set(rootMostPath, value));\n      } else {\n        const subtree = new ImmutableTree(node);\n        const newWriteTree = this.writeTree_.setTree(path, subtree);\n        return new CompoundWrite(newWriteTree);\n      }\n    }\n  }\n\n  addWrites(path: Path, updates: { [name: string]: Node }): CompoundWrite {\n    let newWrite = this as CompoundWrite;\n    each(updates, function(childKey: string, node: Node) {\n      newWrite = newWrite.addWrite(path.child(childKey), node);\n    });\n    return newWrite;\n  }\n\n  /**\n   * Will remove a write at the given path and deeper paths. This will <em>not</em> modify a write at a higher\n   * location, which must be removed by calling this method with that path.\n   *\n   * @param path The path at which a write and all deeper writes should be removed\n   * @return {!CompoundWrite} The new CompoundWrite with the removed path\n   */\n  removeWrite(path: Path): CompoundWrite {\n    if (path.isEmpty()) {\n      return CompoundWrite.Empty;\n    } else {\n      const newWriteTree = this.writeTree_.setTree(path, ImmutableTree.Empty);\n      return new CompoundWrite(newWriteTree);\n    }\n  }\n\n  /**\n   * Returns whether this CompoundWrite will fully overwrite a node at a given location and can therefore be\n   * considered \"complete\".\n   *\n   * @param path The path to check for\n   * @return Whether there is a complete write at that path\n   */\n  hasCompleteWrite(path: Path): boolean {\n    return this.getCompleteNode(path) != null;\n  }\n\n  /**\n   * Returns a node for a path if and only if the node is a \"complete\" overwrite at that path. This will not aggregate\n   * writes from deeper paths, but will return child nodes from a more shallow path.\n   *\n   * @param path The path to get a complete write\n   * @return The node if complete at that path, or null otherwise.\n   */\n  getCompleteNode(path: Path): Node | null {\n    const rootmost = this.writeTree_.findRootMostValueAndPath(path);\n    if (rootmost != null) {\n      return this.writeTree_\n        .get(rootmost.path)\n        .getChild(Path.relativePath(rootmost.path, path));\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Returns all children that are guaranteed to be a complete overwrite.\n   *\n   * @return A list of all complete children.\n   */\n  getCompleteChildren(): NamedNode[] {\n    const children: NamedNode[] = [];\n    let node = this.writeTree_.value;\n    if (node != null) {\n      // If it's a leaf node, it has no children; so nothing to do.\n      if (!node.isLeafNode()) {\n        (node as ChildrenNode).forEachChild(PRIORITY_INDEX, function(\n          childName,\n          childNode\n        ) {\n          children.push(new NamedNode(childName, childNode));\n        });\n      }\n    } else {\n      this.writeTree_.children.inorderTraversal(function(childName, childTree) {\n        if (childTree.value != null) {\n          children.push(new NamedNode(childName, childTree.value));\n        }\n      });\n    }\n    return children;\n  }\n\n  childCompoundWrite(path: Path): CompoundWrite {\n    if (path.isEmpty()) {\n      return this;\n    } else {\n      const shadowingNode = this.getCompleteNode(path);\n      if (shadowingNode != null) {\n        return new CompoundWrite(new ImmutableTree(shadowingNode));\n      } else {\n        return new CompoundWrite(this.writeTree_.subtree(path));\n      }\n    }\n  }\n\n  /**\n   * Returns true if this CompoundWrite is empty and therefore does not modify any nodes.\n   * @return Whether this CompoundWrite is empty\n   */\n  isEmpty(): boolean {\n    return this.writeTree_.isEmpty();\n  }\n\n  /**\n   * Applies this CompoundWrite to a node. The node is returned with all writes from this CompoundWrite applied to the\n   * node\n   * @param node The node to apply this CompoundWrite to\n   * @return The node with all writes applied\n   */\n  apply(node: Node): Node {\n    return applySubtreeWrite(Path.Empty, this.writeTree_, node);\n  }\n}\n\nfunction applySubtreeWrite(\n  relativePath: Path,\n  writeTree: ImmutableTree<Node>,\n  node: Node\n): Node {\n  if (writeTree.value != null) {\n    // Since there a write is always a leaf, we're done here\n    return node.updateChild(relativePath, writeTree.value);\n  } else {\n    let priorityWrite = null;\n    writeTree.children.inorderTraversal(function(childKey, childTree) {\n      if (childKey === '.priority') {\n        // Apply priorities at the end so we don't update priorities for either empty nodes or forget\n        // to apply priorities to empty nodes that are later filled\n        assert(\n          childTree.value !== null,\n          'Priority writes must always be leaf nodes'\n        );\n        priorityWrite = childTree.value;\n      } else {\n        node = applySubtreeWrite(relativePath.child(childKey), childTree, node);\n      }\n    });\n    // If there was a priority write, we only apply it if the node is not empty\n    if (!node.getChild(relativePath).isEmpty() && priorityWrite !== null) {\n      node = node.updateChild(relativePath.child('.priority'), priorityWrite);\n    }\n    return node;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { safeGet } from '@firebase/util';\nimport { assert, assertionError } from '@firebase/util';\nimport { Path } from './util/Path';\nimport { CompoundWrite } from './CompoundWrite';\nimport { PRIORITY_INDEX } from './snap/indexes/PriorityIndex';\nimport { ChildrenNode } from './snap/ChildrenNode';\nimport { NamedNode, Node } from './snap/Node';\nimport { CacheNode } from './view/CacheNode';\nimport { Index } from './snap/indexes/Index';\nimport { each } from './util/util';\n\n/**\n * Defines a single user-initiated write operation. May be the result of a set(), transaction(), or update() call. In\n * the case of a set() or transaction, snap wil be non-null.  In the case of an update(), children will be non-null.\n */\nexport interface WriteRecord {\n  writeId: number;\n  path: Path;\n  snap?: Node | null;\n  children?: { [k: string]: Node } | null;\n  visible: boolean;\n}\n\n/**\n * WriteTree tracks all pending user-initiated writes and has methods to calculate the result of merging them\n * with underlying server data (to create \"event cache\" data).  Pending writes are added with addOverwrite()\n * and addMerge(), and removed with removeWrite().\n *\n * @constructor\n */\nexport class WriteTree {\n  /**\n   * A tree tracking the result of applying all visible writes.  This does not include transactions with\n   * applyLocally=false or writes that are completely shadowed by other writes.\n   *\n   * @type {!CompoundWrite}\n   * @private\n   */\n  private visibleWrites_: CompoundWrite = CompoundWrite.Empty;\n\n  /**\n   * A list of all pending writes, regardless of visibility and shadowed-ness.  Used to calculate arbitrary\n   * sets of the changed data, such as hidden writes (from transactions) or changes with certain writes excluded (also\n   * used by transactions).\n   *\n   * @type {!Array.<!WriteRecord>}\n   * @private\n   */\n  private allWrites_: WriteRecord[] = [];\n\n  private lastWriteId_ = -1;\n\n  /**\n   * Create a new WriteTreeRef for the given path. For use with a new sync point at the given path.\n   *\n   * @param {!Path} path\n   * @return {!WriteTreeRef}\n   */\n  childWrites(path: Path): WriteTreeRef {\n    return new WriteTreeRef(path, this);\n  }\n\n  /**\n   * Record a new overwrite from user code.\n   *\n   * @param {!Path} path\n   * @param {!Node} snap\n   * @param {!number} writeId\n   * @param {boolean=} visible This is set to false by some transactions. It should be excluded from event caches\n   */\n  addOverwrite(path: Path, snap: Node, writeId: number, visible?: boolean) {\n    assert(\n      writeId > this.lastWriteId_,\n      'Stacking an older write on top of newer ones'\n    );\n    if (visible === undefined) {\n      visible = true;\n    }\n    this.allWrites_.push({\n      path: path,\n      snap: snap,\n      writeId: writeId,\n      visible: visible\n    });\n\n    if (visible) {\n      this.visibleWrites_ = this.visibleWrites_.addWrite(path, snap);\n    }\n    this.lastWriteId_ = writeId;\n  }\n\n  /**\n   * Record a new merge from user code.\n   *\n   * @param {!Path} path\n   * @param {!Object.<string, !Node>} changedChildren\n   * @param {!number} writeId\n   */\n  addMerge(\n    path: Path,\n    changedChildren: { [k: string]: Node },\n    writeId: number\n  ) {\n    assert(\n      writeId > this.lastWriteId_,\n      'Stacking an older merge on top of newer ones'\n    );\n    this.allWrites_.push({\n      path: path,\n      children: changedChildren,\n      writeId: writeId,\n      visible: true\n    });\n\n    this.visibleWrites_ = this.visibleWrites_.addWrites(path, changedChildren);\n    this.lastWriteId_ = writeId;\n  }\n\n  /**\n   * @param {!number} writeId\n   * @return {?WriteRecord}\n   */\n  getWrite(writeId: number): WriteRecord | null {\n    for (let i = 0; i < this.allWrites_.length; i++) {\n      const record = this.allWrites_[i];\n      if (record.writeId === writeId) {\n        return record;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Remove a write (either an overwrite or merge) that has been successfully acknowledge by the server. Recalculates\n   * the tree if necessary.  We return true if it may have been visible, meaning views need to reevaluate.\n   *\n   * @param {!number} writeId\n   * @return {boolean} true if the write may have been visible (meaning we'll need to reevaluate / raise\n   * events as a result).\n   */\n  removeWrite(writeId: number): boolean {\n    // Note: disabling this check. It could be a transaction that preempted another transaction, and thus was applied\n    // out of order.\n    //const validClear = revert || this.allWrites_.length === 0 || writeId <= this.allWrites_[0].writeId;\n    //assert(validClear, \"Either we don't have this write, or it's the first one in the queue\");\n\n    const idx = this.allWrites_.findIndex(function(s) {\n      return s.writeId === writeId;\n    });\n    assert(idx >= 0, 'removeWrite called with nonexistent writeId.');\n    const writeToRemove = this.allWrites_[idx];\n    this.allWrites_.splice(idx, 1);\n\n    let removedWriteWasVisible = writeToRemove.visible;\n    let removedWriteOverlapsWithOtherWrites = false;\n\n    let i = this.allWrites_.length - 1;\n\n    while (removedWriteWasVisible && i >= 0) {\n      const currentWrite = this.allWrites_[i];\n      if (currentWrite.visible) {\n        if (\n          i >= idx &&\n          this.recordContainsPath_(currentWrite, writeToRemove.path)\n        ) {\n          // The removed write was completely shadowed by a subsequent write.\n          removedWriteWasVisible = false;\n        } else if (writeToRemove.path.contains(currentWrite.path)) {\n          // Either we're covering some writes or they're covering part of us (depending on which came first).\n          removedWriteOverlapsWithOtherWrites = true;\n        }\n      }\n      i--;\n    }\n\n    if (!removedWriteWasVisible) {\n      return false;\n    } else if (removedWriteOverlapsWithOtherWrites) {\n      // There's some shadowing going on. Just rebuild the visible writes from scratch.\n      this.resetTree_();\n      return true;\n    } else {\n      // There's no shadowing.  We can safely just remove the write(s) from visibleWrites.\n      if (writeToRemove.snap) {\n        this.visibleWrites_ = this.visibleWrites_.removeWrite(\n          writeToRemove.path\n        );\n      } else {\n        const children = writeToRemove.children;\n        each(children, (childName: string) => {\n          this.visibleWrites_ = this.visibleWrites_.removeWrite(\n            writeToRemove.path.child(childName)\n          );\n        });\n      }\n      return true;\n    }\n  }\n\n  /**\n   * Return a complete snapshot for the given path if there's visible write data at that path, else null.\n   * No server data is considered.\n   *\n   * @param {!Path} path\n   * @return {?Node}\n   */\n  getCompleteWriteData(path: Path): Node | null {\n    return this.visibleWrites_.getCompleteNode(path);\n  }\n\n  /**\n   * Given optional, underlying server data, and an optional set of constraints (exclude some sets, include hidden\n   * writes), attempt to calculate a complete snapshot for the given path\n   *\n   * @param {!Path} treePath\n   * @param {?Node} completeServerCache\n   * @param {Array.<number>=} writeIdsToExclude An optional set to be excluded\n   * @param {boolean=} includeHiddenWrites Defaults to false, whether or not to layer on writes with visible set to false\n   * @return {?Node}\n   */\n  calcCompleteEventCache(\n    treePath: Path,\n    completeServerCache: Node | null,\n    writeIdsToExclude?: number[],\n    includeHiddenWrites?: boolean\n  ): Node | null {\n    if (!writeIdsToExclude && !includeHiddenWrites) {\n      const shadowingNode = this.visibleWrites_.getCompleteNode(treePath);\n      if (shadowingNode != null) {\n        return shadowingNode;\n      } else {\n        const subMerge = this.visibleWrites_.childCompoundWrite(treePath);\n        if (subMerge.isEmpty()) {\n          return completeServerCache;\n        } else if (\n          completeServerCache == null &&\n          !subMerge.hasCompleteWrite(Path.Empty)\n        ) {\n          // We wouldn't have a complete snapshot, since there's no underlying data and no complete shadow\n          return null;\n        } else {\n          const layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;\n          return subMerge.apply(layeredCache);\n        }\n      }\n    } else {\n      const merge = this.visibleWrites_.childCompoundWrite(treePath);\n      if (!includeHiddenWrites && merge.isEmpty()) {\n        return completeServerCache;\n      } else {\n        // If the server cache is null, and we don't have a complete cache, we need to return null\n        if (\n          !includeHiddenWrites &&\n          completeServerCache == null &&\n          !merge.hasCompleteWrite(Path.Empty)\n        ) {\n          return null;\n        } else {\n          const filter = function(write: WriteRecord) {\n            return (\n              (write.visible || includeHiddenWrites) &&\n              (!writeIdsToExclude ||\n                !~writeIdsToExclude.indexOf(write.writeId)) &&\n              (write.path.contains(treePath) || treePath.contains(write.path))\n            );\n          };\n          const mergeAtPath = WriteTree.layerTree_(\n            this.allWrites_,\n            filter,\n            treePath\n          );\n          const layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;\n          return mergeAtPath.apply(layeredCache);\n        }\n      }\n    }\n  }\n\n  /**\n   * With optional, underlying server data, attempt to return a children node of children that we have complete data for.\n   * Used when creating new views, to pre-fill their complete event children snapshot.\n   *\n   * @param {!Path} treePath\n   * @param {?ChildrenNode} completeServerChildren\n   * @return {!ChildrenNode}\n   */\n  calcCompleteEventChildren(\n    treePath: Path,\n    completeServerChildren: ChildrenNode | null\n  ) {\n    let completeChildren = ChildrenNode.EMPTY_NODE as Node;\n    const topLevelSet = this.visibleWrites_.getCompleteNode(treePath);\n    if (topLevelSet) {\n      if (!topLevelSet.isLeafNode()) {\n        // we're shadowing everything. Return the children.\n        topLevelSet.forEachChild(PRIORITY_INDEX, function(\n          childName,\n          childSnap\n        ) {\n          completeChildren = completeChildren.updateImmediateChild(\n            childName,\n            childSnap\n          );\n        });\n      }\n      return completeChildren;\n    } else if (completeServerChildren) {\n      // Layer any children we have on top of this\n      // We know we don't have a top-level set, so just enumerate existing children\n      const merge = this.visibleWrites_.childCompoundWrite(treePath);\n      completeServerChildren.forEachChild(PRIORITY_INDEX, function(\n        childName,\n        childNode\n      ) {\n        const node = merge\n          .childCompoundWrite(new Path(childName))\n          .apply(childNode);\n        completeChildren = completeChildren.updateImmediateChild(\n          childName,\n          node\n        );\n      });\n      // Add any complete children we have from the set\n      merge.getCompleteChildren().forEach(function(namedNode) {\n        completeChildren = completeChildren.updateImmediateChild(\n          namedNode.name,\n          namedNode.node\n        );\n      });\n      return completeChildren;\n    } else {\n      // We don't have anything to layer on top of. Layer on any children we have\n      // Note that we can return an empty snap if we have a defined delete\n      const merge = this.visibleWrites_.childCompoundWrite(treePath);\n      merge.getCompleteChildren().forEach(function(namedNode) {\n        completeChildren = completeChildren.updateImmediateChild(\n          namedNode.name,\n          namedNode.node\n        );\n      });\n      return completeChildren;\n    }\n  }\n\n  /**\n   * Given that the underlying server data has updated, determine what, if anything, needs to be\n   * applied to the event cache.\n   *\n   * Possibilities:\n   *\n   * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\n   *\n   * 2. Some write is completely shadowing. No events to be raised\n   *\n   * 3. Is partially shadowed. Events\n   *\n   * Either existingEventSnap or existingServerSnap must exist\n   *\n   * @param {!Path} treePath\n   * @param {!Path} childPath\n   * @param {?Node} existingEventSnap\n   * @param {?Node} existingServerSnap\n   * @return {?Node}\n   */\n  calcEventCacheAfterServerOverwrite(\n    treePath: Path,\n    childPath: Path,\n    existingEventSnap: Node | null,\n    existingServerSnap: Node | null\n  ): Node | null {\n    assert(\n      existingEventSnap || existingServerSnap,\n      'Either existingEventSnap or existingServerSnap must exist'\n    );\n    const path = treePath.child(childPath);\n    if (this.visibleWrites_.hasCompleteWrite(path)) {\n      // At this point we can probably guarantee that we're in case 2, meaning no events\n      // May need to check visibility while doing the findRootMostValueAndPath call\n      return null;\n    } else {\n      // No complete shadowing. We're either partially shadowing or not shadowing at all.\n      const childMerge = this.visibleWrites_.childCompoundWrite(path);\n      if (childMerge.isEmpty()) {\n        // We're not shadowing at all. Case 1\n        return existingServerSnap.getChild(childPath);\n      } else {\n        // This could be more efficient if the serverNode + updates doesn't change the eventSnap\n        // However this is tricky to find out, since user updates don't necessary change the server\n        // snap, e.g. priority updates on empty nodes, or deep deletes. Another special case is if the server\n        // adds nodes, but doesn't change any existing writes. It is therefore not enough to\n        // only check if the updates change the serverNode.\n        // Maybe check if the merge tree contains these special cases and only do a full overwrite in that case?\n        return childMerge.apply(existingServerSnap.getChild(childPath));\n      }\n    }\n  }\n\n  /**\n   * Returns a complete child for a given server snap after applying all user writes or null if there is no\n   * complete child for this ChildKey.\n   *\n   * @param {!Path} treePath\n   * @param {!string} childKey\n   * @param {!CacheNode} existingServerSnap\n   * @return {?Node}\n   */\n  calcCompleteChild(\n    treePath: Path,\n    childKey: string,\n    existingServerSnap: CacheNode\n  ): Node | null {\n    const path = treePath.child(childKey);\n    const shadowingNode = this.visibleWrites_.getCompleteNode(path);\n    if (shadowingNode != null) {\n      return shadowingNode;\n    } else {\n      if (existingServerSnap.isCompleteForChild(childKey)) {\n        const childMerge = this.visibleWrites_.childCompoundWrite(path);\n        return childMerge.apply(\n          existingServerSnap.getNode().getImmediateChild(childKey)\n        );\n      } else {\n        return null;\n      }\n    }\n  }\n\n  /**\n   * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\n   * a higher path, this will return the child of that write relative to the write and this path.\n   * Returns null if there is no write at this path.\n   */\n  shadowingWrite(path: Path): Node | null {\n    return this.visibleWrites_.getCompleteNode(path);\n  }\n\n  /**\n   * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\n   * the window, but may now be in the window.\n   */\n  calcIndexedSlice(\n    treePath: Path,\n    completeServerData: Node | null,\n    startPost: NamedNode,\n    count: number,\n    reverse: boolean,\n    index: Index\n  ): NamedNode[] {\n    let toIterate: Node;\n    const merge = this.visibleWrites_.childCompoundWrite(treePath);\n    const shadowingNode = merge.getCompleteNode(Path.Empty);\n    if (shadowingNode != null) {\n      toIterate = shadowingNode;\n    } else if (completeServerData != null) {\n      toIterate = merge.apply(completeServerData);\n    } else {\n      // no children to iterate on\n      return [];\n    }\n    toIterate = toIterate.withIndex(index);\n    if (!toIterate.isEmpty() && !toIterate.isLeafNode()) {\n      const nodes = [];\n      const cmp = index.getCompare();\n      const iter = reverse\n        ? (toIterate as ChildrenNode).getReverseIteratorFrom(startPost, index)\n        : (toIterate as ChildrenNode).getIteratorFrom(startPost, index);\n      let next = iter.getNext();\n      while (next && nodes.length < count) {\n        if (cmp(next, startPost) !== 0) {\n          nodes.push(next);\n        }\n        next = iter.getNext();\n      }\n      return nodes;\n    } else {\n      return [];\n    }\n  }\n\n  private recordContainsPath_(writeRecord: WriteRecord, path: Path): boolean {\n    if (writeRecord.snap) {\n      return writeRecord.path.contains(path);\n    } else {\n      for (const childName in writeRecord.children) {\n        if (\n          writeRecord.children.hasOwnProperty(childName) &&\n          writeRecord.path.child(childName).contains(path)\n        ) {\n          return true;\n        }\n      }\n      return false;\n    }\n  }\n\n  /**\n   * Re-layer the writes and merges into a tree so we can efficiently calculate event snapshots\n   */\n  private resetTree_() {\n    this.visibleWrites_ = WriteTree.layerTree_(\n      this.allWrites_,\n      WriteTree.DefaultFilter_,\n      Path.Empty\n    );\n    if (this.allWrites_.length > 0) {\n      this.lastWriteId_ = this.allWrites_[this.allWrites_.length - 1].writeId;\n    } else {\n      this.lastWriteId_ = -1;\n    }\n  }\n\n  /**\n   * The default filter used when constructing the tree. Keep everything that's visible.\n   */\n  private static DefaultFilter_(write: WriteRecord) {\n    return write.visible;\n  }\n\n  /**\n   * Static method. Given an array of WriteRecords, a filter for which ones to include, and a path, construct the tree of\n   * event data at that path.\n   */\n  private static layerTree_(\n    writes: WriteRecord[],\n    filter: (w: WriteRecord) => boolean,\n    treeRoot: Path\n  ): CompoundWrite {\n    let compoundWrite = CompoundWrite.Empty;\n    for (let i = 0; i < writes.length; ++i) {\n      const write = writes[i];\n      // Theory, a later set will either:\n      // a) abort a relevant transaction, so no need to worry about excluding it from calculating that transaction\n      // b) not be relevant to a transaction (separate branch), so again will not affect the data for that transaction\n      if (filter(write)) {\n        const writePath = write.path;\n        let relativePath;\n        if (write.snap) {\n          if (treeRoot.contains(writePath)) {\n            relativePath = Path.relativePath(treeRoot, writePath);\n            compoundWrite = compoundWrite.addWrite(relativePath, write.snap);\n          } else if (writePath.contains(treeRoot)) {\n            relativePath = Path.relativePath(writePath, treeRoot);\n            compoundWrite = compoundWrite.addWrite(\n              Path.Empty,\n              write.snap.getChild(relativePath)\n            );\n          } else {\n            // There is no overlap between root path and write path, ignore write\n          }\n        } else if (write.children) {\n          if (treeRoot.contains(writePath)) {\n            relativePath = Path.relativePath(treeRoot, writePath);\n            compoundWrite = compoundWrite.addWrites(\n              relativePath,\n              write.children\n            );\n          } else if (writePath.contains(treeRoot)) {\n            relativePath = Path.relativePath(writePath, treeRoot);\n            if (relativePath.isEmpty()) {\n              compoundWrite = compoundWrite.addWrites(\n                Path.Empty,\n                write.children\n              );\n            } else {\n              const child = safeGet(write.children, relativePath.getFront());\n              if (child) {\n                // There exists a child in this node that matches the root path\n                const deepNode = child.getChild(relativePath.popFront());\n                compoundWrite = compoundWrite.addWrite(Path.Empty, deepNode);\n              }\n            }\n          } else {\n            // There is no overlap between root path and write path, ignore write\n          }\n        } else {\n          throw assertionError('WriteRecord should have .snap or .children');\n        }\n      }\n    }\n    return compoundWrite;\n  }\n}\n\n/**\n * A WriteTreeRef wraps a WriteTree and a path, for convenient access to a particular subtree.  All of the methods\n * just proxy to the underlying WriteTree.\n *\n * @constructor\n */\nexport class WriteTreeRef {\n  /**\n   * The path to this particular write tree ref. Used for calling methods on writeTree_ while exposing a simpler\n   * interface to callers.\n   *\n   * @type {!Path}\n   * @private\n   * @const\n   */\n  private readonly treePath_: Path;\n\n  /**\n   * * A reference to the actual tree of write data. All methods are pass-through to the tree, but with the appropriate\n   * path prefixed.\n   *\n   * This lets us make cheap references to points in the tree for sync points without having to copy and maintain all of\n   * the data.\n   *\n   * @type {!WriteTree}\n   * @private\n   * @const\n   */\n  private readonly writeTree_: WriteTree;\n\n  /**\n   * @param {!Path} path\n   * @param {!WriteTree} writeTree\n   */\n  constructor(path: Path, writeTree: WriteTree) {\n    this.treePath_ = path;\n    this.writeTree_ = writeTree;\n  }\n\n  /**\n   * If possible, returns a complete event cache, using the underlying server data if possible. In addition, can be used\n   * to get a cache that includes hidden writes, and excludes arbitrary writes. Note that customizing the returned node\n   * can lead to a more expensive calculation.\n   *\n   * @param {?Node} completeServerCache\n   * @param {Array.<number>=} writeIdsToExclude Optional writes to exclude.\n   * @param {boolean=} includeHiddenWrites Defaults to false, whether or not to layer on writes with visible set to false\n   * @return {?Node}\n   */\n  calcCompleteEventCache(\n    completeServerCache: Node | null,\n    writeIdsToExclude?: number[],\n    includeHiddenWrites?: boolean\n  ): Node | null {\n    return this.writeTree_.calcCompleteEventCache(\n      this.treePath_,\n      completeServerCache,\n      writeIdsToExclude,\n      includeHiddenWrites\n    );\n  }\n\n  /**\n   * If possible, returns a children node containing all of the complete children we have data for. The returned data is a\n   * mix of the given server data and write data.\n   *\n   * @param {?ChildrenNode} completeServerChildren\n   * @return {!ChildrenNode}\n   */\n  calcCompleteEventChildren(\n    completeServerChildren: ChildrenNode | null\n  ): ChildrenNode {\n    return this.writeTree_.calcCompleteEventChildren(\n      this.treePath_,\n      completeServerChildren\n    ) as ChildrenNode;\n  }\n\n  /**\n   * Given that either the underlying server data has updated or the outstanding writes have updated, determine what,\n   * if anything, needs to be applied to the event cache.\n   *\n   * Possibilities:\n   *\n   * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\n   *\n   * 2. Some write is completely shadowing. No events to be raised\n   *\n   * 3. Is partially shadowed. Events should be raised\n   *\n   * Either existingEventSnap or existingServerSnap must exist, this is validated via an assert\n   *\n   * @param {!Path} path\n   * @param {?Node} existingEventSnap\n   * @param {?Node} existingServerSnap\n   * @return {?Node}\n   */\n  calcEventCacheAfterServerOverwrite(\n    path: Path,\n    existingEventSnap: Node | null,\n    existingServerSnap: Node | null\n  ): Node | null {\n    return this.writeTree_.calcEventCacheAfterServerOverwrite(\n      this.treePath_,\n      path,\n      existingEventSnap,\n      existingServerSnap\n    );\n  }\n\n  /**\n   * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\n   * a higher path, this will return the child of that write relative to the write and this path.\n   * Returns null if there is no write at this path.\n   *\n   * @param {!Path} path\n   * @return {?Node}\n   */\n  shadowingWrite(path: Path): Node | null {\n    return this.writeTree_.shadowingWrite(this.treePath_.child(path));\n  }\n\n  /**\n   * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\n   * the window, but may now be in the window\n   *\n   * @param {?Node} completeServerData\n   * @param {!NamedNode} startPost\n   * @param {!number} count\n   * @param {boolean} reverse\n   * @param {!Index} index\n   * @return {!Array.<!NamedNode>}\n   */\n  calcIndexedSlice(\n    completeServerData: Node | null,\n    startPost: NamedNode,\n    count: number,\n    reverse: boolean,\n    index: Index\n  ): NamedNode[] {\n    return this.writeTree_.calcIndexedSlice(\n      this.treePath_,\n      completeServerData,\n      startPost,\n      count,\n      reverse,\n      index\n    );\n  }\n\n  /**\n   * Returns a complete child for a given server snap after applying all user writes or null if there is no\n   * complete child for this ChildKey.\n   *\n   * @param {!string} childKey\n   * @param {!CacheNode} existingServerCache\n   * @return {?Node}\n   */\n  calcCompleteChild(\n    childKey: string,\n    existingServerCache: CacheNode\n  ): Node | null {\n    return this.writeTree_.calcCompleteChild(\n      this.treePath_,\n      childKey,\n      existingServerCache\n    );\n  }\n\n  /**\n   * Return a WriteTreeRef for a child.\n   *\n   * @param {string} childName\n   * @return {!WriteTreeRef}\n   */\n  child(childName: string): WriteTreeRef {\n    return new WriteTreeRef(this.treePath_.child(childName), this.writeTree_);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { errorForServerCode, each } from './util/util';\nimport { AckUserWrite } from './operation/AckUserWrite';\nimport { ChildrenNode } from './snap/ChildrenNode';\nimport { ImmutableTree } from './util/ImmutableTree';\nimport { ListenComplete } from './operation/ListenComplete';\nimport { Merge } from './operation/Merge';\nimport { Operation, OperationSource } from './operation/Operation';\nimport { Overwrite } from './operation/Overwrite';\nimport { Path } from './util/Path';\nimport { SyncPoint } from './SyncPoint';\nimport { WriteTree, WriteTreeRef } from './WriteTree';\nimport { Query } from '../api/Query';\nimport { Node } from './snap/Node';\nimport { Event } from './view/Event';\nimport { EventRegistration } from './view/EventRegistration';\nimport { View } from './view/View';\n\n/**\n * @typedef {{\n *   startListening: function(\n *     !Query,\n *     ?number,\n *     function():string,\n *     function(!string, *):!Array.<!Event>\n *   ):!Array.<!Event>,\n *\n *   stopListening: function(!Query, ?number)\n * }}\n */\nexport interface ListenProvider {\n  startListening(\n    query: Query,\n    tag: number | null,\n    hashFn: () => string,\n    onComplete: (a: string, b?: any) => Event[]\n  ): Event[];\n\n  stopListening(a: Query, b: number | null): void;\n}\n\n/**\n * SyncTree is the central class for managing event callback registration, data caching, views\n * (query processing), and event generation.  There are typically two SyncTree instances for\n * each Repo, one for the normal Firebase data, and one for the .info data.\n *\n * It has a number of responsibilities, including:\n *  - Tracking all user event callbacks (registered via addEventRegistration() and removeEventRegistration()).\n *  - Applying and caching data changes for user set(), transaction(), and update() calls\n *    (applyUserOverwrite(), applyUserMerge()).\n *  - Applying and caching data changes for server data changes (applyServerOverwrite(),\n *    applyServerMerge()).\n *  - Generating user-facing events for server and user changes (all of the apply* methods\n *    return the set of events that need to be raised as a result).\n *  - Maintaining the appropriate set of server listens to ensure we are always subscribed\n *    to the correct set of paths and queries to satisfy the current set of user event\n *    callbacks (listens are started/stopped using the provided listenProvider).\n *\n * NOTE: Although SyncTree tracks event callbacks and calculates events to raise, the actual\n * events are returned to the caller rather than raised synchronously.\n *\n * @constructor\n */\nexport class SyncTree {\n  /**\n   * Tree of SyncPoints.  There's a SyncPoint at any location that has 1 or more views.\n   */\n  private syncPointTree_: ImmutableTree<SyncPoint> = ImmutableTree.Empty;\n\n  /**\n   * A tree of all pending user writes (user-initiated set()'s, transaction()'s, update()'s, etc.).\n   */\n  private pendingWriteTree_ = new WriteTree();\n\n  private readonly tagToQueryMap: Map<number, string> = new Map();\n  private readonly queryToTagMap: Map<string, number> = new Map();\n\n  /**\n   * @param {!ListenProvider} listenProvider_ Used by SyncTree to start / stop listening\n   *   to server data.\n   */\n  constructor(private listenProvider_: ListenProvider) {}\n\n  /**\n   * Apply the data changes for a user-generated set() or transaction() call.\n   *\n   * @return Events to raise.\n   */\n  applyUserOverwrite(\n    path: Path,\n    newData: Node,\n    writeId: number,\n    visible?: boolean\n  ): Event[] {\n    // Record pending write.\n    this.pendingWriteTree_.addOverwrite(path, newData, writeId, visible);\n\n    if (!visible) {\n      return [];\n    } else {\n      return this.applyOperationToSyncPoints_(\n        new Overwrite(OperationSource.User, path, newData)\n      );\n    }\n  }\n\n  /**\n   * Apply the data from a user-generated update() call\n   *\n   * @return Events to raise.\n   */\n  applyUserMerge(\n    path: Path,\n    changedChildren: { [k: string]: Node },\n    writeId: number\n  ): Event[] {\n    // Record pending merge.\n    this.pendingWriteTree_.addMerge(path, changedChildren, writeId);\n\n    const changeTree = ImmutableTree.fromObject(changedChildren);\n\n    return this.applyOperationToSyncPoints_(\n      new Merge(OperationSource.User, path, changeTree)\n    );\n  }\n\n  /**\n   * Acknowledge a pending user write that was previously registered with applyUserOverwrite() or applyUserMerge().\n   *\n   * @param revert True if the given write failed and needs to be reverted\n   * @return Events to raise.\n   */\n  ackUserWrite(writeId: number, revert: boolean = false) {\n    const write = this.pendingWriteTree_.getWrite(writeId);\n    const needToReevaluate = this.pendingWriteTree_.removeWrite(writeId);\n    if (!needToReevaluate) {\n      return [];\n    } else {\n      let affectedTree = ImmutableTree.Empty;\n      if (write.snap != null) {\n        // overwrite\n        affectedTree = affectedTree.set(Path.Empty, true);\n      } else {\n        each(write.children, function(pathString: string, node: Node) {\n          affectedTree = affectedTree.set(new Path(pathString), node);\n        });\n      }\n      return this.applyOperationToSyncPoints_(\n        new AckUserWrite(write.path, affectedTree, revert)\n      );\n    }\n  }\n\n  /**\n   * Apply new server data for the specified path..\n   *\n   * @return Events to raise.\n   */\n  applyServerOverwrite(path: Path, newData: Node): Event[] {\n    return this.applyOperationToSyncPoints_(\n      new Overwrite(OperationSource.Server, path, newData)\n    );\n  }\n\n  /**\n   * Apply new server data to be merged in at the specified path.\n   *\n   * @return Events to raise.\n   */\n  applyServerMerge(\n    path: Path,\n    changedChildren: { [k: string]: Node }\n  ): Event[] {\n    const changeTree = ImmutableTree.fromObject(changedChildren);\n\n    return this.applyOperationToSyncPoints_(\n      new Merge(OperationSource.Server, path, changeTree)\n    );\n  }\n\n  /**\n   * Apply a listen complete for a query\n   *\n   * @return Events to raise.\n   */\n  applyListenComplete(path: Path): Event[] {\n    return this.applyOperationToSyncPoints_(\n      new ListenComplete(OperationSource.Server, path)\n    );\n  }\n\n  /**\n   * Apply new server data for the specified tagged query.\n   *\n   * @return Events to raise.\n   */\n  applyTaggedQueryOverwrite(path: Path, snap: Node, tag: number): Event[] {\n    const queryKey = this.queryKeyForTag_(tag);\n    if (queryKey != null) {\n      const r = SyncTree.parseQueryKey_(queryKey);\n      const queryPath = r.path,\n        queryId = r.queryId;\n      const relativePath = Path.relativePath(queryPath, path);\n      const op = new Overwrite(\n        OperationSource.forServerTaggedQuery(queryId),\n        relativePath,\n        snap\n      );\n      return this.applyTaggedOperation_(queryPath, op);\n    } else {\n      // Query must have been removed already\n      return [];\n    }\n  }\n\n  /**\n   * Apply server data to be merged in for the specified tagged query.\n   *\n   * @return Events to raise.\n   */\n  applyTaggedQueryMerge(\n    path: Path,\n    changedChildren: { [k: string]: Node },\n    tag: number\n  ): Event[] {\n    const queryKey = this.queryKeyForTag_(tag);\n    if (queryKey) {\n      const r = SyncTree.parseQueryKey_(queryKey);\n      const queryPath = r.path,\n        queryId = r.queryId;\n      const relativePath = Path.relativePath(queryPath, path);\n      const changeTree = ImmutableTree.fromObject(changedChildren);\n      const op = new Merge(\n        OperationSource.forServerTaggedQuery(queryId),\n        relativePath,\n        changeTree\n      );\n      return this.applyTaggedOperation_(queryPath, op);\n    } else {\n      // We've already removed the query. No big deal, ignore the update\n      return [];\n    }\n  }\n\n  /**\n   * Apply a listen complete for a tagged query\n   *\n   * @return Events to raise.\n   */\n  applyTaggedListenComplete(path: Path, tag: number): Event[] {\n    const queryKey = this.queryKeyForTag_(tag);\n    if (queryKey) {\n      const r = SyncTree.parseQueryKey_(queryKey);\n      const queryPath = r.path,\n        queryId = r.queryId;\n      const relativePath = Path.relativePath(queryPath, path);\n      const op = new ListenComplete(\n        OperationSource.forServerTaggedQuery(queryId),\n        relativePath\n      );\n      return this.applyTaggedOperation_(queryPath, op);\n    } else {\n      // We've already removed the query. No big deal, ignore the update\n      return [];\n    }\n  }\n\n  /**\n   * Add an event callback for the specified query.\n   *\n   * @return Events to raise.\n   */\n  addEventRegistration(\n    query: Query,\n    eventRegistration: EventRegistration\n  ): Event[] {\n    const path = query.path;\n\n    let serverCache: Node | null = null;\n    let foundAncestorDefaultView = false;\n    // Any covering writes will necessarily be at the root, so really all we need to find is the server cache.\n    // Consider optimizing this once there's a better understanding of what actual behavior will be.\n    this.syncPointTree_.foreachOnPath(path, function(pathToSyncPoint, sp) {\n      const relativePath = Path.relativePath(pathToSyncPoint, path);\n      serverCache = serverCache || sp.getCompleteServerCache(relativePath);\n      foundAncestorDefaultView =\n        foundAncestorDefaultView || sp.hasCompleteView();\n    });\n    let syncPoint = this.syncPointTree_.get(path);\n    if (!syncPoint) {\n      syncPoint = new SyncPoint();\n      this.syncPointTree_ = this.syncPointTree_.set(path, syncPoint);\n    } else {\n      foundAncestorDefaultView =\n        foundAncestorDefaultView || syncPoint.hasCompleteView();\n      serverCache = serverCache || syncPoint.getCompleteServerCache(Path.Empty);\n    }\n\n    let serverCacheComplete;\n    if (serverCache != null) {\n      serverCacheComplete = true;\n    } else {\n      serverCacheComplete = false;\n      serverCache = ChildrenNode.EMPTY_NODE;\n      const subtree = this.syncPointTree_.subtree(path);\n      subtree.foreachChild(function(childName, childSyncPoint) {\n        const completeCache = childSyncPoint.getCompleteServerCache(Path.Empty);\n        if (completeCache) {\n          serverCache = serverCache.updateImmediateChild(\n            childName,\n            completeCache\n          );\n        }\n      });\n    }\n\n    const viewAlreadyExists = syncPoint.viewExistsForQuery(query);\n    if (!viewAlreadyExists && !query.getQueryParams().loadsAllData()) {\n      // We need to track a tag for this query\n      const queryKey = SyncTree.makeQueryKey_(query);\n      assert(\n        !this.queryToTagMap.has(queryKey),\n        'View does not exist, but we have a tag'\n      );\n      const tag = SyncTree.getNextQueryTag_();\n      this.queryToTagMap.set(queryKey, tag);\n      this.tagToQueryMap.set(tag, queryKey);\n    }\n    const writesCache = this.pendingWriteTree_.childWrites(path);\n    let events = syncPoint.addEventRegistration(\n      query,\n      eventRegistration,\n      writesCache,\n      serverCache,\n      serverCacheComplete\n    );\n    if (!viewAlreadyExists && !foundAncestorDefaultView) {\n      const view /** @type !View */ = syncPoint.viewForQuery(query);\n      events = events.concat(this.setupListener_(query, view));\n    }\n    return events;\n  }\n\n  /**\n   * Remove event callback(s).\n   *\n   * If query is the default query, we'll check all queries for the specified eventRegistration.\n   * If eventRegistration is null, we'll remove all callbacks for the specified query/queries.\n   *\n   * @param eventRegistration If null, all callbacks are removed.\n   * @param cancelError If a cancelError is provided, appropriate cancel events will be returned.\n   * @return Cancel events, if cancelError was provided.\n   */\n  removeEventRegistration(\n    query: Query,\n    eventRegistration: EventRegistration | null,\n    cancelError?: Error\n  ): Event[] {\n    // Find the syncPoint first. Then deal with whether or not it has matching listeners\n    const path = query.path;\n    const maybeSyncPoint = this.syncPointTree_.get(path);\n    let cancelEvents: Event[] = [];\n    // A removal on a default query affects all queries at that location. A removal on an indexed query, even one without\n    // other query constraints, does *not* affect all queries at that location. So this check must be for 'default', and\n    // not loadsAllData().\n    if (\n      maybeSyncPoint &&\n      (query.queryIdentifier() === 'default' ||\n        maybeSyncPoint.viewExistsForQuery(query))\n    ) {\n      /**\n       * @type {{removed: !Array.<!Query>, events: !Array.<!Event>}}\n       */\n      const removedAndEvents = maybeSyncPoint.removeEventRegistration(\n        query,\n        eventRegistration,\n        cancelError\n      );\n      if (maybeSyncPoint.isEmpty()) {\n        this.syncPointTree_ = this.syncPointTree_.remove(path);\n      }\n      const removed = removedAndEvents.removed;\n      cancelEvents = removedAndEvents.events;\n      // We may have just removed one of many listeners and can short-circuit this whole process\n      // We may also not have removed a default listener, in which case all of the descendant listeners should already be\n      // properly set up.\n      //\n      // Since indexed queries can shadow if they don't have other query constraints, check for loadsAllData(), instead of\n      // queryId === 'default'\n      const removingDefault =\n        -1 !==\n        removed.findIndex(function(query) {\n          return query.getQueryParams().loadsAllData();\n        });\n      const covered = this.syncPointTree_.findOnPath(path, function(\n        relativePath,\n        parentSyncPoint\n      ) {\n        return parentSyncPoint.hasCompleteView();\n      });\n\n      if (removingDefault && !covered) {\n        const subtree = this.syncPointTree_.subtree(path);\n        // There are potentially child listeners. Determine what if any listens we need to send before executing the\n        // removal\n        if (!subtree.isEmpty()) {\n          // We need to fold over our subtree and collect the listeners to send\n          const newViews = this.collectDistinctViewsForSubTree_(subtree);\n\n          // Ok, we've collected all the listens we need. Set them up.\n          for (let i = 0; i < newViews.length; ++i) {\n            const view = newViews[i],\n              newQuery = view.getQuery();\n            const listener = this.createListenerForView_(view);\n            this.listenProvider_.startListening(\n              SyncTree.queryForListening_(newQuery),\n              this.tagForQuery_(newQuery),\n              listener.hashFn,\n              listener.onComplete\n            );\n          }\n        } else {\n          // There's nothing below us, so nothing we need to start listening on\n        }\n      }\n      // If we removed anything and we're not covered by a higher up listen, we need to stop listening on this query\n      // The above block has us covered in terms of making sure we're set up on listens lower in the tree.\n      // Also, note that if we have a cancelError, it's already been removed at the provider level.\n      if (!covered && removed.length > 0 && !cancelError) {\n        // If we removed a default, then we weren't listening on any of the other queries here. Just cancel the one\n        // default. Otherwise, we need to iterate through and cancel each individual query\n        if (removingDefault) {\n          // We don't tag default listeners\n          const defaultTag: number | null = null;\n          this.listenProvider_.stopListening(\n            SyncTree.queryForListening_(query),\n            defaultTag\n          );\n        } else {\n          removed.forEach((queryToRemove: Query) => {\n            const tagToRemove = this.queryToTagMap.get(\n              SyncTree.makeQueryKey_(queryToRemove)\n            );\n            this.listenProvider_.stopListening(\n              SyncTree.queryForListening_(queryToRemove),\n              tagToRemove\n            );\n          });\n        }\n      }\n      // Now, clear all of the tags we're tracking for the removed listens\n      this.removeTags_(removed);\n    } else {\n      // No-op, this listener must've been already removed\n    }\n    return cancelEvents;\n  }\n\n  /**\n   * Returns a complete cache, if we have one, of the data at a particular path. If the location does not have a\n   * listener above it, we will get a false \"null\". This shouldn't be a problem because transactions will always\n   * have a listener above, and atomic operations would correctly show a jitter of <increment value> ->\n   *     <incremented total> as the write is applied locally and then acknowledged at the server.\n   *\n   * Note: this method will *include* hidden writes from transaction with applyLocally set to false.\n   *\n   * @param path The path to the data we want\n   * @param writeIdsToExclude A specific set to be excluded\n   */\n  calcCompleteEventCache(path: Path, writeIdsToExclude?: number[]): Node {\n    const includeHiddenSets = true;\n    const writeTree = this.pendingWriteTree_;\n    const serverCache = this.syncPointTree_.findOnPath(path, function(\n      pathSoFar,\n      syncPoint\n    ) {\n      const relativePath = Path.relativePath(pathSoFar, path);\n      const serverCache = syncPoint.getCompleteServerCache(relativePath);\n      if (serverCache) {\n        return serverCache;\n      }\n    });\n    return writeTree.calcCompleteEventCache(\n      path,\n      serverCache,\n      writeIdsToExclude,\n      includeHiddenSets\n    );\n  }\n\n  /**\n   * This collapses multiple unfiltered views into a single view, since we only need a single\n   * listener for them.\n   */\n  private collectDistinctViewsForSubTree_(\n    subtree: ImmutableTree<SyncPoint>\n  ): View[] {\n    return subtree.fold<View[]>(\n      (relativePath, maybeChildSyncPoint, childMap) => {\n        if (maybeChildSyncPoint && maybeChildSyncPoint.hasCompleteView()) {\n          const completeView = maybeChildSyncPoint.getCompleteView();\n          return [completeView];\n        } else {\n          // No complete view here, flatten any deeper listens into an array\n          let views: View[] = [];\n          if (maybeChildSyncPoint) {\n            views = maybeChildSyncPoint.getQueryViews();\n          }\n          each(childMap, function(_key: string, childViews: View[]) {\n            views = views.concat(childViews);\n          });\n          return views;\n        }\n      }\n    );\n  }\n\n  private removeTags_(queries: Query[]) {\n    for (let j = 0; j < queries.length; ++j) {\n      const removedQuery = queries[j];\n      if (!removedQuery.getQueryParams().loadsAllData()) {\n        // We should have a tag for this\n        const removedQueryKey = SyncTree.makeQueryKey_(removedQuery);\n        const removedQueryTag = this.queryToTagMap.get(removedQueryKey);\n        this.queryToTagMap.delete(removedQueryKey);\n        this.tagToQueryMap.delete(removedQueryTag);\n      }\n    }\n  }\n\n  /**\n   * Normalizes a query to a query we send the server for listening\n   *\n   * @return The normalized query\n   */\n  private static queryForListening_(query: Query): Query {\n    if (\n      query.getQueryParams().loadsAllData() &&\n      !query.getQueryParams().isDefault()\n    ) {\n      // We treat queries that load all data as default queries\n      // Cast is necessary because ref() technically returns Firebase which is actually fb.api.Firebase which inherits\n      // from Query\n      return query.getRef()!;\n    } else {\n      return query;\n    }\n  }\n\n  /**\n   * For a given new listen, manage the de-duplication of outstanding subscriptions.\n   *\n   * @return This method can return events to support synchronous data sources\n   */\n  private setupListener_(query: Query, view: View): Event[] {\n    const path = query.path;\n    const tag = this.tagForQuery_(query);\n    const listener = this.createListenerForView_(view);\n\n    const events = this.listenProvider_.startListening(\n      SyncTree.queryForListening_(query),\n      tag,\n      listener.hashFn,\n      listener.onComplete\n    );\n\n    const subtree = this.syncPointTree_.subtree(path);\n    // The root of this subtree has our query. We're here because we definitely need to send a listen for that, but we\n    // may need to shadow other listens as well.\n    if (tag) {\n      assert(\n        !subtree.value.hasCompleteView(),\n        \"If we're adding a query, it shouldn't be shadowed\"\n      );\n    } else {\n      // Shadow everything at or below this location, this is a default listener.\n      const queriesToStop = subtree.fold<Query[]>(function(\n        relativePath,\n        maybeChildSyncPoint,\n        childMap\n      ) {\n        if (\n          !relativePath.isEmpty() &&\n          maybeChildSyncPoint &&\n          maybeChildSyncPoint.hasCompleteView()\n        ) {\n          return [maybeChildSyncPoint.getCompleteView().getQuery()];\n        } else {\n          // No default listener here, flatten any deeper queries into an array\n          let queries: Query[] = [];\n          if (maybeChildSyncPoint) {\n            queries = queries.concat(\n              maybeChildSyncPoint.getQueryViews().map(view => view.getQuery())\n            );\n          }\n          each(childMap, function(_key: string, childQueries: Query[]) {\n            queries = queries.concat(childQueries);\n          });\n          return queries;\n        }\n      });\n      for (let i = 0; i < queriesToStop.length; ++i) {\n        const queryToStop = queriesToStop[i];\n        this.listenProvider_.stopListening(\n          SyncTree.queryForListening_(queryToStop),\n          this.tagForQuery_(queryToStop)\n        );\n      }\n    }\n    return events;\n  }\n\n  private createListenerForView_(\n    view: View\n  ): { hashFn(): string; onComplete(a: string, b?: any): Event[] } {\n    const query = view.getQuery();\n    const tag = this.tagForQuery_(query);\n\n    return {\n      hashFn: () => {\n        const cache = view.getServerCache() || ChildrenNode.EMPTY_NODE;\n        return cache.hash();\n      },\n      onComplete: (status: string): Event[] => {\n        if (status === 'ok') {\n          if (tag) {\n            return this.applyTaggedListenComplete(query.path, tag);\n          } else {\n            return this.applyListenComplete(query.path);\n          }\n        } else {\n          // If a listen failed, kill all of the listeners here, not just the one that triggered the error.\n          // Note that this may need to be scoped to just this listener if we change permissions on filtered children\n          const error = errorForServerCode(status, query);\n          return this.removeEventRegistration(\n            query,\n            /*eventRegistration*/ null,\n            error\n          );\n        }\n      }\n    };\n  }\n\n  /**\n   * Given a query, computes a \"queryKey\" suitable for use in our queryToTagMap_.\n   */\n  private static makeQueryKey_(query: Query): string {\n    return query.path.toString() + '$' + query.queryIdentifier();\n  }\n\n  /**\n   * Given a queryKey (created by makeQueryKey), parse it back into a path and queryId.\n   */\n  private static parseQueryKey_(\n    queryKey: string\n  ): { queryId: string; path: Path } {\n    const splitIndex = queryKey.indexOf('$');\n    assert(\n      splitIndex !== -1 && splitIndex < queryKey.length - 1,\n      'Bad queryKey.'\n    );\n    return {\n      queryId: queryKey.substr(splitIndex + 1),\n      path: new Path(queryKey.substr(0, splitIndex))\n    };\n  }\n\n  /**\n   * Return the query associated with the given tag, if we have one\n   */\n  private queryKeyForTag_(tag: number): string | null {\n    return this.tagToQueryMap.get(tag);\n  }\n\n  /**\n   * Return the tag associated with the given query.\n   */\n  private tagForQuery_(query: Query): number | null {\n    const queryKey = SyncTree.makeQueryKey_(query);\n    return this.queryToTagMap.get(queryKey);\n  }\n\n  /**\n   * Static tracker for next query tag.\n   */\n  private static nextQueryTag_ = 1;\n\n  /**\n   * Static accessor for query tags.\n   */\n  private static getNextQueryTag_(): number {\n    return SyncTree.nextQueryTag_++;\n  }\n\n  /**\n   * A helper method to apply tagged operations\n   */\n  private applyTaggedOperation_(\n    queryPath: Path,\n    operation: Operation\n  ): Event[] {\n    const syncPoint = this.syncPointTree_.get(queryPath);\n    assert(syncPoint, \"Missing sync point for query tag that we're tracking\");\n    const writesCache = this.pendingWriteTree_.childWrites(queryPath);\n    return syncPoint.applyOperation(\n      operation,\n      writesCache,\n      /*serverCache=*/ null\n    );\n  }\n\n  /**\n   * A helper method that visits all descendant and ancestor SyncPoints, applying the operation.\n   *\n   * NOTES:\n   * - Descendant SyncPoints will be visited first (since we raise events depth-first).\n\n   * - We call applyOperation() on each SyncPoint passing three things:\n   *   1. A version of the Operation that has been made relative to the SyncPoint location.\n   *   2. A WriteTreeRef of any writes we have cached at the SyncPoint location.\n   *   3. A snapshot Node with cached server data, if we have it.\n\n   * - We concatenate all of the events returned by each SyncPoint and return the result.\n   */\n  private applyOperationToSyncPoints_(operation: Operation): Event[] {\n    return this.applyOperationHelper_(\n      operation,\n      this.syncPointTree_,\n      /*serverCache=*/ null,\n      this.pendingWriteTree_.childWrites(Path.Empty)\n    );\n  }\n\n  /**\n   * Recursive helper for applyOperationToSyncPoints_\n   */\n  private applyOperationHelper_(\n    operation: Operation,\n    syncPointTree: ImmutableTree<SyncPoint>,\n    serverCache: Node | null,\n    writesCache: WriteTreeRef\n  ): Event[] {\n    if (operation.path.isEmpty()) {\n      return this.applyOperationDescendantsHelper_(\n        operation,\n        syncPointTree,\n        serverCache,\n        writesCache\n      );\n    } else {\n      const syncPoint = syncPointTree.get(Path.Empty);\n\n      // If we don't have cached server data, see if we can get it from this SyncPoint.\n      if (serverCache == null && syncPoint != null) {\n        serverCache = syncPoint.getCompleteServerCache(Path.Empty);\n      }\n\n      let events: Event[] = [];\n      const childName = operation.path.getFront();\n      const childOperation = operation.operationForChild(childName);\n      const childTree = syncPointTree.children.get(childName);\n      if (childTree && childOperation) {\n        const childServerCache = serverCache\n          ? serverCache.getImmediateChild(childName)\n          : null;\n        const childWritesCache = writesCache.child(childName);\n        events = events.concat(\n          this.applyOperationHelper_(\n            childOperation,\n            childTree,\n            childServerCache,\n            childWritesCache\n          )\n        );\n      }\n\n      if (syncPoint) {\n        events = events.concat(\n          syncPoint.applyOperation(operation, writesCache, serverCache)\n        );\n      }\n\n      return events;\n    }\n  }\n\n  /**\n   * Recursive helper for applyOperationToSyncPoints_\n   */\n  private applyOperationDescendantsHelper_(\n    operation: Operation,\n    syncPointTree: ImmutableTree<SyncPoint>,\n    serverCache: Node | null,\n    writesCache: WriteTreeRef\n  ): Event[] {\n    const syncPoint = syncPointTree.get(Path.Empty);\n\n    // If we don't have cached server data, see if we can get it from this SyncPoint.\n    if (serverCache == null && syncPoint != null) {\n      serverCache = syncPoint.getCompleteServerCache(Path.Empty);\n    }\n\n    let events: Event[] = [];\n    syncPointTree.children.inorderTraversal((childName, childTree) => {\n      const childServerCache = serverCache\n        ? serverCache.getImmediateChild(childName)\n        : null;\n      const childWritesCache = writesCache.child(childName);\n      const childOperation = operation.operationForChild(childName);\n      if (childOperation) {\n        events = events.concat(\n          this.applyOperationDescendantsHelper_(\n            childOperation,\n            childTree,\n            childServerCache,\n            childWritesCache\n          )\n        );\n      }\n    });\n\n    if (syncPoint) {\n      events = events.concat(\n        syncPoint.applyOperation(operation, writesCache, serverCache)\n      );\n    }\n\n    return events;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ChildrenNode } from './snap/ChildrenNode';\nimport { Path } from './util/Path';\nimport { Node } from './snap/Node';\n\n/**\n * Mutable object which basically just stores a reference to the \"latest\" immutable snapshot.\n *\n * @constructor\n */\nexport class SnapshotHolder {\n  private rootNode_: Node = ChildrenNode.EMPTY_NODE;\n\n  getNode(path: Path): Node {\n    return this.rootNode_.getChild(path);\n  }\n\n  updateSnapshot(path: Path, newSnapshotNode: Node) {\n    this.rootNode_ = this.rootNode_.updateChild(path, newSnapshotNode);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseAuthTokenData } from '@firebase/app-types/private';\nimport {\n  FirebaseAuthInternal,\n  FirebaseAuthInternalName\n} from '@firebase/auth-interop-types';\nimport { Provider } from '@firebase/component';\nimport { log, warn } from './util/util';\nimport { FirebaseApp } from '@firebase/app-types';\n\n/**\n * Abstraction around FirebaseApp's token fetching capabilities.\n */\nexport class AuthTokenProvider {\n  private auth_: FirebaseAuthInternal | null = null;\n  constructor(\n    private app_: FirebaseApp,\n    private authProvider_: Provider<FirebaseAuthInternalName>\n  ) {\n    this.auth_ = authProvider_.getImmediate({ optional: true });\n    if (!this.auth_) {\n      authProvider_.get().then(auth => (this.auth_ = auth));\n    }\n  }\n\n  /**\n   * @param {boolean} forceRefresh\n   * @return {!Promise<FirebaseAuthTokenData>}\n   */\n  getToken(forceRefresh: boolean): Promise<FirebaseAuthTokenData> {\n    if (!this.auth_) {\n      return Promise.resolve(null);\n    }\n\n    return this.auth_.getToken(forceRefresh).catch(function(error) {\n      // TODO: Need to figure out all the cases this is raised and whether\n      // this makes sense.\n      if (error && error.code === 'auth/token-not-initialized') {\n        log('Got auth/token-not-initialized error.  Treating as null token.');\n        return null;\n      } else {\n        return Promise.reject(error);\n      }\n    });\n  }\n\n  addTokenChangeListener(listener: (token: string | null) => void) {\n    // TODO: We might want to wrap the listener and call it with no args to\n    // avoid a leaky abstraction, but that makes removing the listener harder.\n    if (this.auth_) {\n      this.auth_.addAuthTokenListener(listener);\n    } else {\n      setTimeout(() => listener(null), 0);\n      this.authProvider_\n        .get()\n        .then(auth => auth.addAuthTokenListener(listener));\n    }\n  }\n\n  removeTokenChangeListener(listener: (token: string | null) => void) {\n    this.authProvider_\n      .get()\n      .then(auth => auth.removeAuthTokenListener(listener));\n  }\n\n  notifyForInvalidToken() {\n    let errorMessage =\n      'Provided authentication credentials for the app named \"' +\n      this.app_.name +\n      '\" are invalid. This usually indicates your app was not ' +\n      'initialized correctly. ';\n    if ('credential' in this.app_.options) {\n      errorMessage +=\n        'Make sure the \"credential\" property provided to initializeApp() ' +\n        'is authorized to access the specified \"databaseURL\" and is from the correct ' +\n        'project.';\n    } else if ('serviceAccount' in this.app_.options) {\n      errorMessage +=\n        'Make sure the \"serviceAccount\" property provided to initializeApp() ' +\n        'is authorized to access the specified \"databaseURL\" and is from the correct ' +\n        'project.';\n    } else {\n      errorMessage +=\n        'Make sure the \"apiKey\" and \"databaseURL\" properties provided to ' +\n        'initializeApp() match the values provided for your app at ' +\n        'https://console.firebase.google.com/.';\n    }\n    warn(errorMessage);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { deepCopy } from '@firebase/util';\nimport { contains } from '@firebase/util';\n\n/**\n * Tracks a collection of stats.\n *\n * @constructor\n */\nexport class StatsCollection {\n  private counters_: { [k: string]: number } = {};\n\n  incrementCounter(name: string, amount: number = 1) {\n    if (!contains(this.counters_, name)) this.counters_[name] = 0;\n\n    this.counters_[name] += amount;\n  }\n\n  get() {\n    return deepCopy(this.counters_);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { StatsCollection } from './StatsCollection';\nimport { RepoInfo } from '../RepoInfo';\n\nexport class StatsManager {\n  private static collections_: { [k: string]: StatsCollection } = {};\n  private static reporters_: { [k: string]: any } = {};\n\n  static getCollection(repoInfo: RepoInfo): StatsCollection {\n    const hashString = repoInfo.toString();\n\n    if (!this.collections_[hashString]) {\n      this.collections_[hashString] = new StatsCollection();\n    }\n\n    return this.collections_[hashString];\n  }\n\n  static getOrCreateReporter<T>(\n    repoInfo: RepoInfo,\n    creatorFunction: () => T\n  ): T {\n    const hashString = repoInfo.toString();\n\n    if (!this.reporters_[hashString]) {\n      this.reporters_[hashString] = creatorFunction();\n    }\n\n    return this.reporters_[hashString];\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { StatsCollection } from './StatsCollection';\nimport { each } from '../util/util';\n\n/**\n * Returns the delta from the previous call to get stats.\n *\n * @param collection_ The collection to \"listen\" to.\n * @constructor\n */\nexport class StatsListener {\n  private last_: { [k: string]: number } | null = null;\n\n  constructor(private collection_: StatsCollection) {}\n\n  get(): { [k: string]: number } {\n    const newStats = this.collection_.get();\n\n    const delta = { ...newStats };\n    if (this.last_) {\n      each(this.last_, (stat: string, value: number) => {\n        delta[stat] = delta[stat] - value;\n      });\n    }\n    this.last_ = newStats;\n\n    return delta;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { contains } from '@firebase/util';\nimport { setTimeoutNonBlocking, each } from '../util/util';\nimport { StatsListener } from './StatsListener';\nimport { StatsCollection } from './StatsCollection';\nimport { ServerActions } from '../ServerActions';\n\n// Assuming some apps may have a short amount of time on page, and a bulk of firebase operations probably\n// happen on page load, we try to report our first set of stats pretty quickly, but we wait at least 10\n// seconds to try to ensure the Firebase connection is established / settled.\nconst FIRST_STATS_MIN_TIME = 10 * 1000;\nconst FIRST_STATS_MAX_TIME = 30 * 1000;\n\n// We'll continue to report stats on average every 5 minutes.\nconst REPORT_STATS_INTERVAL = 5 * 60 * 1000;\n\n/**\n * @constructor\n */\nexport class StatsReporter {\n  private statsListener_: StatsListener;\n  private statsToReport_: { [k: string]: boolean } = {};\n\n  /**\n   * @param collection\n   * @param server_\n   */\n  constructor(collection: StatsCollection, private server_: ServerActions) {\n    this.statsListener_ = new StatsListener(collection);\n\n    const timeout =\n      FIRST_STATS_MIN_TIME +\n      (FIRST_STATS_MAX_TIME - FIRST_STATS_MIN_TIME) * Math.random();\n    setTimeoutNonBlocking(this.reportStats_.bind(this), Math.floor(timeout));\n  }\n\n  includeStat(stat: string) {\n    this.statsToReport_[stat] = true;\n  }\n\n  private reportStats_() {\n    const stats = this.statsListener_.get();\n    const reportedStats: typeof stats = {};\n    let haveStatsToReport = false;\n\n    each(stats, (stat: string, value: number) => {\n      if (value > 0 && contains(this.statsToReport_, stat)) {\n        reportedStats[stat] = value;\n        haveStatsToReport = true;\n      }\n    });\n\n    if (haveStatsToReport) {\n      this.server_.reportStats(reportedStats);\n    }\n\n    // queue our next run.\n    setTimeoutNonBlocking(\n      this.reportStats_.bind(this),\n      Math.floor(Math.random() * 2 * REPORT_STATS_INTERVAL)\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Path } from '../util/Path';\nimport { log, logger, exceptionGuard } from '../util/util';\nimport { Event } from './Event';\n\n/**\n * The event queue serves a few purposes:\n * 1. It ensures we maintain event order in the face of event callbacks doing operations that result in more\n *    events being queued.\n * 2. raiseQueuedEvents() handles being called reentrantly nicely.  That is, if in the course of raising events,\n *    raiseQueuedEvents() is called again, the \"inner\" call will pick up raising events where the \"outer\" call\n *    left off, ensuring that the events are still raised synchronously and in order.\n * 3. You can use raiseEventsAtPath and raiseEventsForChangedPath to ensure only relevant previously-queued\n *    events are raised synchronously.\n *\n * NOTE: This can all go away if/when we move to async events.\n *\n * @constructor\n */\nexport class EventQueue {\n  /**\n   * @private\n   * @type {!Array.<EventList>}\n   */\n  private eventLists_: EventList[] = [];\n\n  /**\n   * Tracks recursion depth of raiseQueuedEvents_, for debugging purposes.\n   * @private\n   * @type {!number}\n   */\n  private recursionDepth_ = 0;\n\n  /**\n   * @param {!Array.<Event>} eventDataList The new events to queue.\n   */\n  queueEvents(eventDataList: Event[]) {\n    // We group events by path, storing them in a single EventList, to make it easier to skip over them quickly.\n    let currList = null;\n    for (let i = 0; i < eventDataList.length; i++) {\n      const eventData = eventDataList[i];\n      const eventPath = eventData.getPath();\n      if (currList !== null && !eventPath.equals(currList.getPath())) {\n        this.eventLists_.push(currList);\n        currList = null;\n      }\n\n      if (currList === null) {\n        currList = new EventList(eventPath);\n      }\n\n      currList.add(eventData);\n    }\n    if (currList) {\n      this.eventLists_.push(currList);\n    }\n  }\n\n  /**\n   * Queues the specified events and synchronously raises all events (including previously queued ones)\n   * for the specified path.\n   *\n   * It is assumed that the new events are all for the specified path.\n   *\n   * @param {!Path} path The path to raise events for.\n   * @param {!Array.<Event>} eventDataList The new events to raise.\n   */\n  raiseEventsAtPath(path: Path, eventDataList: Event[]) {\n    this.queueEvents(eventDataList);\n    this.raiseQueuedEventsMatchingPredicate_((eventPath: Path) =>\n      eventPath.equals(path)\n    );\n  }\n\n  /**\n   * Queues the specified events and synchronously raises all events (including previously queued ones) for\n   * locations related to the specified change path (i.e. all ancestors and descendants).\n   *\n   * It is assumed that the new events are all related (ancestor or descendant) to the specified path.\n   *\n   * @param {!Path} changedPath The path to raise events for.\n   * @param {!Array.<!Event>} eventDataList The events to raise\n   */\n  raiseEventsForChangedPath(changedPath: Path, eventDataList: Event[]) {\n    this.queueEvents(eventDataList);\n\n    this.raiseQueuedEventsMatchingPredicate_((eventPath: Path) => {\n      return eventPath.contains(changedPath) || changedPath.contains(eventPath);\n    });\n  }\n\n  /**\n   * @param {!function(!Path):boolean} predicate\n   * @private\n   */\n  private raiseQueuedEventsMatchingPredicate_(\n    predicate: (path: Path) => boolean\n  ) {\n    this.recursionDepth_++;\n\n    let sentAll = true;\n    for (let i = 0; i < this.eventLists_.length; i++) {\n      const eventList = this.eventLists_[i];\n      if (eventList) {\n        const eventPath = eventList.getPath();\n        if (predicate(eventPath)) {\n          this.eventLists_[i].raise();\n          this.eventLists_[i] = null;\n        } else {\n          sentAll = false;\n        }\n      }\n    }\n\n    if (sentAll) {\n      this.eventLists_ = [];\n    }\n\n    this.recursionDepth_--;\n  }\n}\n\n/**\n * @param {!Path} path\n * @constructor\n */\nexport class EventList {\n  /**\n   * @type {!Array.<Event>}\n   * @private\n   */\n  private events_: Event[] = [];\n\n  constructor(private readonly path_: Path) {}\n\n  /**\n   * @param {!Event} eventData\n   */\n  add(eventData: Event) {\n    this.events_.push(eventData);\n  }\n\n  /**\n   * Iterates through the list and raises each event\n   */\n  raise() {\n    for (let i = 0; i < this.events_.length; i++) {\n      const eventData = this.events_[i];\n      if (eventData !== null) {\n        this.events_[i] = null;\n        const eventFn = eventData.getEventRunner();\n        if (logger) {\n          log('event: ' + eventData.toString());\n        }\n        exceptionGuard(eventFn);\n      }\n    }\n  }\n\n  /**\n   * @return {!Path}\n   */\n  getPath(): Path {\n    return this.path_;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\n\n/**\n * Base class to be used if you want to emit events. Call the constructor with\n * the set of allowed event names.\n */\nexport abstract class EventEmitter {\n  private listeners_: {\n    [eventType: string]: Array<{\n      callback(...args: any[]): void;\n      context: any;\n    }>;\n  } = {};\n\n  /**\n   * @param {!Array.<string>} allowedEvents_\n   */\n  constructor(private allowedEvents_: Array<string>) {\n    assert(\n      Array.isArray(allowedEvents_) && allowedEvents_.length > 0,\n      'Requires a non-empty array'\n    );\n  }\n\n  /**\n   * To be overridden by derived classes in order to fire an initial event when\n   * somebody subscribes for data.\n   *\n   * @param {!string} eventType\n   * @return {Array.<*>} Array of parameters to trigger initial event with.\n   */\n  abstract getInitialEvent(eventType: string): any[];\n\n  /**\n   * To be called by derived classes to trigger events.\n   * @param {!string} eventType\n   * @param {...*} var_args\n   */\n  protected trigger(eventType: string, ...var_args: any[]) {\n    if (Array.isArray(this.listeners_[eventType])) {\n      // Clone the list, since callbacks could add/remove listeners.\n      const listeners = [...this.listeners_[eventType]];\n\n      for (let i = 0; i < listeners.length; i++) {\n        listeners[i].callback.apply(listeners[i].context, var_args);\n      }\n    }\n  }\n\n  on(eventType: string, callback: (a: any) => void, context: any) {\n    this.validateEventType_(eventType);\n    this.listeners_[eventType] = this.listeners_[eventType] || [];\n    this.listeners_[eventType].push({ callback, context });\n\n    const eventData = this.getInitialEvent(eventType);\n    if (eventData) {\n      callback.apply(context, eventData);\n    }\n  }\n\n  off(eventType: string, callback: (a: any) => void, context: any) {\n    this.validateEventType_(eventType);\n    const listeners = this.listeners_[eventType] || [];\n    for (let i = 0; i < listeners.length; i++) {\n      if (\n        listeners[i].callback === callback &&\n        (!context || context === listeners[i].context)\n      ) {\n        listeners.splice(i, 1);\n        return;\n      }\n    }\n  }\n\n  private validateEventType_(eventType: string) {\n    assert(\n      this.allowedEvents_.find(function(et) {\n        return et === eventType;\n      }),\n      'Unknown event: ' + eventType\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from './EventEmitter';\nimport { assert } from '@firebase/util';\n\ndeclare const document: any;\n\n/**\n * @extends {EventEmitter}\n */\nexport class VisibilityMonitor extends EventEmitter {\n  private visible_: boolean;\n\n  static getInstance() {\n    return new VisibilityMonitor();\n  }\n\n  constructor() {\n    super(['visible']);\n    let hidden: string;\n    let visibilityChange: string;\n    if (\n      typeof document !== 'undefined' &&\n      typeof document.addEventListener !== 'undefined'\n    ) {\n      if (typeof document['hidden'] !== 'undefined') {\n        // Opera 12.10 and Firefox 18 and later support\n        visibilityChange = 'visibilitychange';\n        hidden = 'hidden';\n      } else if (typeof document['mozHidden'] !== 'undefined') {\n        visibilityChange = 'mozvisibilitychange';\n        hidden = 'mozHidden';\n      } else if (typeof document['msHidden'] !== 'undefined') {\n        visibilityChange = 'msvisibilitychange';\n        hidden = 'msHidden';\n      } else if (typeof document['webkitHidden'] !== 'undefined') {\n        visibilityChange = 'webkitvisibilitychange';\n        hidden = 'webkitHidden';\n      }\n    }\n\n    // Initially, we always assume we are visible. This ensures that in browsers\n    // without page visibility support or in cases where we are never visible\n    // (e.g. chrome extension), we act as if we are visible, i.e. don't delay\n    // reconnects\n    this.visible_ = true;\n\n    if (visibilityChange) {\n      document.addEventListener(\n        visibilityChange,\n        () => {\n          const visible = !document[hidden];\n          if (visible !== this.visible_) {\n            this.visible_ = visible;\n            this.trigger('visible', visible);\n          }\n        },\n        false\n      );\n    }\n  }\n\n  /**\n   * @param {!string} eventType\n   * @return {Array.<boolean>}\n   */\n  getInitialEvent(eventType: string): boolean[] {\n    assert(eventType === 'visible', 'Unknown event type: ' + eventType);\n    return [this.visible_];\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { EventEmitter } from './EventEmitter';\nimport { isMobileCordova } from '@firebase/util';\n\n/**\n * Monitors online state (as reported by window.online/offline events).\n *\n * The expectation is that this could have many false positives (thinks we are online\n * when we're not), but no false negatives.  So we can safely use it to determine when\n * we definitely cannot reach the internet.\n *\n * @extends {EventEmitter}\n */\nexport class OnlineMonitor extends EventEmitter {\n  private online_ = true;\n\n  static getInstance() {\n    return new OnlineMonitor();\n  }\n\n  constructor() {\n    super(['online']);\n\n    // We've had repeated complaints that Cordova apps can get stuck \"offline\", e.g.\n    // https://forum.ionicframework.com/t/firebase-connection-is-lost-and-never-come-back/43810\n    // It would seem that the 'online' event does not always fire consistently. So we disable it\n    // for Cordova.\n    if (\n      typeof window !== 'undefined' &&\n      typeof window.addEventListener !== 'undefined' &&\n      !isMobileCordova()\n    ) {\n      window.addEventListener(\n        'online',\n        () => {\n          if (!this.online_) {\n            this.online_ = true;\n            this.trigger('online', true);\n          }\n        },\n        false\n      );\n\n      window.addEventListener(\n        'offline',\n        () => {\n          if (this.online_) {\n            this.online_ = false;\n            this.trigger('online', false);\n          }\n        },\n        false\n      );\n    }\n  }\n\n  /**\n   * @param {!string} eventType\n   * @return {Array.<boolean>}\n   */\n  getInitialEvent(eventType: string): boolean[] {\n    assert(eventType === 'online', 'Unknown event type: ' + eventType);\n    return [this.online_];\n  }\n\n  /**\n   * @return {boolean}\n   */\n  currentlyOnline(): boolean {\n    return this.online_;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { exceptionGuard } from '../../core/util/util';\n\n/**\n * This class ensures the packets from the server arrive in order\n * This class takes data from the server and ensures it gets passed into the callbacks in order.\n * @constructor\n */\nexport class PacketReceiver {\n  pendingResponses: any[] = [];\n  currentResponseNum = 0;\n  closeAfterResponse = -1;\n  onClose: (() => void) | null = null;\n\n  /**\n   * @param onMessage_\n   */\n  constructor(private onMessage_: (a: Object) => void) {}\n\n  closeAfter(responseNum: number, callback: () => void) {\n    this.closeAfterResponse = responseNum;\n    this.onClose = callback;\n    if (this.closeAfterResponse < this.currentResponseNum) {\n      this.onClose();\n      this.onClose = null;\n    }\n  }\n\n  /**\n   * Each message from the server comes with a response number, and an array of data. The responseNumber\n   * allows us to ensure that we process them in the right order, since we can't be guaranteed that all\n   * browsers will respond in the same order as the requests we sent\n   * @param {number} requestNum\n   * @param {Array} data\n   */\n  handleResponse(requestNum: number, data: any[]) {\n    this.pendingResponses[requestNum] = data;\n    while (this.pendingResponses[this.currentResponseNum]) {\n      const toProcess = this.pendingResponses[this.currentResponseNum];\n      delete this.pendingResponses[this.currentResponseNum];\n      for (let i = 0; i < toProcess.length; ++i) {\n        if (toProcess[i]) {\n          exceptionGuard(() => {\n            this.onMessage_(toProcess[i]);\n          });\n        }\n      }\n      if (this.currentResponseNum === this.closeAfterResponse) {\n        if (this.onClose) {\n          this.onClose();\n          this.onClose = null;\n        }\n        break;\n      }\n      this.currentResponseNum++;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  executeWhenDOMReady,\n  isChromeExtensionContentScript,\n  isWindowsStoreApp,\n  log,\n  logWrapper,\n  LUIDGenerator,\n  splitStringBySize\n} from '../core/util/util';\nimport { StatsManager } from '../core/stats/StatsManager';\nimport { PacketReceiver } from './polling/PacketReceiver';\nimport {\n  FORGE_DOMAIN,\n  FORGE_REF,\n  LAST_SESSION_PARAM,\n  LONG_POLLING,\n  PROTOCOL_VERSION,\n  REFERER_PARAM,\n  TRANSPORT_SESSION_PARAM,\n  VERSION_PARAM\n} from './Constants';\nimport { base64Encode, stringify } from '@firebase/util';\nimport { isNodeSdk } from '@firebase/util';\nimport { Transport } from './Transport';\nimport { RepoInfo } from '../core/RepoInfo';\nimport { StatsCollection } from '../core/stats/StatsCollection';\n\n// URL query parameters associated with longpolling\nexport const FIREBASE_LONGPOLL_START_PARAM = 'start';\nexport const FIREBASE_LONGPOLL_CLOSE_COMMAND = 'close';\nexport const FIREBASE_LONGPOLL_COMMAND_CB_NAME = 'pLPCommand';\nexport const FIREBASE_LONGPOLL_DATA_CB_NAME = 'pRTLPCB';\nexport const FIREBASE_LONGPOLL_ID_PARAM = 'id';\nexport const FIREBASE_LONGPOLL_PW_PARAM = 'pw';\nexport const FIREBASE_LONGPOLL_SERIAL_PARAM = 'ser';\nexport const FIREBASE_LONGPOLL_CALLBACK_ID_PARAM = 'cb';\nexport const FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM = 'seg';\nexport const FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET = 'ts';\nexport const FIREBASE_LONGPOLL_DATA_PARAM = 'd';\nexport const FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM = 'disconn';\nexport const FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM = 'dframe';\n\n//Data size constants.\n//TODO: Perf: the maximum length actually differs from browser to browser.\n// We should check what browser we're on and set accordingly.\nconst MAX_URL_DATA_SIZE = 1870;\nconst SEG_HEADER_SIZE = 30; //ie: &seg=8299234&ts=982389123&d=\nconst MAX_PAYLOAD_SIZE = MAX_URL_DATA_SIZE - SEG_HEADER_SIZE;\n\n/**\n * Keepalive period\n * send a fresh request at minimum every 25 seconds. Opera has a maximum request\n * length of 30 seconds that we can't exceed.\n * @const\n * @type {number}\n */\nconst KEEPALIVE_REQUEST_INTERVAL = 25000;\n\n/**\n * How long to wait before aborting a long-polling connection attempt.\n * @const\n * @type {number}\n */\nconst LP_CONNECT_TIMEOUT = 30000;\n\n/**\n * This class manages a single long-polling connection.\n *\n * @constructor\n * @implements {Transport}\n */\nexport class BrowserPollConnection implements Transport {\n  bytesSent = 0;\n  bytesReceived = 0;\n  urlFn: (params: object) => string;\n  scriptTagHolder: FirebaseIFrameScriptHolder;\n  myDisconnFrame: HTMLIFrameElement;\n  curSegmentNum: number;\n  myPacketOrderer: PacketReceiver;\n  id: string;\n  password: string;\n  private log_: (...a: any[]) => void;\n  private stats_: StatsCollection;\n  private everConnected_ = false;\n  private isClosed_: boolean;\n  private connectTimeoutTimer_: number | null;\n  private onDisconnect_: ((a?: boolean) => void) | null;\n\n  /**\n   * @param {string} connId An identifier for this connection, used for logging\n   * @param {RepoInfo} repoInfo The info for the endpoint to send data to.\n   * @param {string=} transportSessionId Optional transportSessionid if we are reconnecting for an existing\n   *                                         transport session\n   * @param {string=}  lastSessionId Optional lastSessionId if the PersistentConnection has already created a\n   *                                     connection previously\n   */\n  constructor(\n    public connId: string,\n    public repoInfo: RepoInfo,\n    public transportSessionId?: string,\n    public lastSessionId?: string\n  ) {\n    this.log_ = logWrapper(connId);\n    this.stats_ = StatsManager.getCollection(repoInfo);\n    this.urlFn = (params: { [k: string]: string }) =>\n      repoInfo.connectionURL(LONG_POLLING, params);\n  }\n\n  /**\n   *\n   * @param {function(Object)} onMessage Callback when messages arrive\n   * @param {function()} onDisconnect Callback with connection lost.\n   */\n  open(onMessage: (msg: Object) => void, onDisconnect: (a?: boolean) => void) {\n    this.curSegmentNum = 0;\n    this.onDisconnect_ = onDisconnect;\n    this.myPacketOrderer = new PacketReceiver(onMessage);\n    this.isClosed_ = false;\n\n    this.connectTimeoutTimer_ = setTimeout(() => {\n      this.log_('Timed out trying to connect.');\n      // Make sure we clear the host cache\n      this.onClosed_();\n      this.connectTimeoutTimer_ = null;\n    }, Math.floor(LP_CONNECT_TIMEOUT)) as any;\n\n    // Ensure we delay the creation of the iframe until the DOM is loaded.\n    executeWhenDOMReady(() => {\n      if (this.isClosed_) return;\n\n      //Set up a callback that gets triggered once a connection is set up.\n      this.scriptTagHolder = new FirebaseIFrameScriptHolder(\n        (...args) => {\n          const [command, arg1, arg2, arg3, arg4] = args;\n          this.incrementIncomingBytes_(args);\n          if (!this.scriptTagHolder) return; // we closed the connection.\n\n          if (this.connectTimeoutTimer_) {\n            clearTimeout(this.connectTimeoutTimer_);\n            this.connectTimeoutTimer_ = null;\n          }\n          this.everConnected_ = true;\n          if (command == FIREBASE_LONGPOLL_START_PARAM) {\n            this.id = arg1;\n            this.password = arg2;\n          } else if (command === FIREBASE_LONGPOLL_CLOSE_COMMAND) {\n            // Don't clear the host cache. We got a response from the server, so we know it's reachable\n            if (arg1) {\n              // We aren't expecting any more data (other than what the server's already in the process of sending us\n              // through our already open polls), so don't send any more.\n              this.scriptTagHolder.sendNewPolls = false;\n\n              // arg1 in this case is the last response number sent by the server. We should try to receive\n              // all of the responses up to this one before closing\n              this.myPacketOrderer.closeAfter(arg1, () => {\n                this.onClosed_();\n              });\n            } else {\n              this.onClosed_();\n            }\n          } else {\n            throw new Error('Unrecognized command received: ' + command);\n          }\n        },\n        (...args) => {\n          const [pN, data] = args;\n          this.incrementIncomingBytes_(args);\n          this.myPacketOrderer.handleResponse(pN, data);\n        },\n        () => {\n          this.onClosed_();\n        },\n        this.urlFn\n      );\n\n      //Send the initial request to connect. The serial number is simply to keep the browser from pulling previous results\n      //from cache.\n      const urlParams: { [k: string]: string | number } = {};\n      urlParams[FIREBASE_LONGPOLL_START_PARAM] = 't';\n      urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = Math.floor(\n        Math.random() * 100000000\n      );\n      if (this.scriptTagHolder.uniqueCallbackIdentifier)\n        urlParams[\n          FIREBASE_LONGPOLL_CALLBACK_ID_PARAM\n        ] = this.scriptTagHolder.uniqueCallbackIdentifier;\n      urlParams[VERSION_PARAM] = PROTOCOL_VERSION;\n      if (this.transportSessionId) {\n        urlParams[TRANSPORT_SESSION_PARAM] = this.transportSessionId;\n      }\n      if (this.lastSessionId) {\n        urlParams[LAST_SESSION_PARAM] = this.lastSessionId;\n      }\n      if (\n        typeof location !== 'undefined' &&\n        location.href &&\n        location.href.indexOf(FORGE_DOMAIN) !== -1\n      ) {\n        urlParams[REFERER_PARAM] = FORGE_REF;\n      }\n      const connectURL = this.urlFn(urlParams);\n      this.log_('Connecting via long-poll to ' + connectURL);\n      this.scriptTagHolder.addTag(connectURL, () => {\n        /* do nothing */\n      });\n    });\n  }\n\n  /**\n   * Call this when a handshake has completed successfully and we want to consider the connection established\n   */\n  start() {\n    this.scriptTagHolder.startLongPoll(this.id, this.password);\n    this.addDisconnectPingFrame(this.id, this.password);\n  }\n\n  private static forceAllow_: boolean;\n\n  /**\n   * Forces long polling to be considered as a potential transport\n   */\n  static forceAllow() {\n    BrowserPollConnection.forceAllow_ = true;\n  }\n\n  private static forceDisallow_: boolean;\n\n  /**\n   * Forces longpolling to not be considered as a potential transport\n   */\n  static forceDisallow() {\n    BrowserPollConnection.forceDisallow_ = true;\n  }\n\n  // Static method, use string literal so it can be accessed in a generic way\n  static isAvailable() {\n    if (isNodeSdk()) {\n      return false;\n    } else if (BrowserPollConnection.forceAllow_) {\n      return true;\n    } else {\n      // NOTE: In React-Native there's normally no 'document', but if you debug a React-Native app in\n      // the Chrome debugger, 'document' is defined, but document.createElement is null (2015/06/08).\n      return (\n        !BrowserPollConnection.forceDisallow_ &&\n        typeof document !== 'undefined' &&\n        document.createElement != null &&\n        !isChromeExtensionContentScript() &&\n        !isWindowsStoreApp()\n      );\n    }\n  }\n\n  /**\n   * No-op for polling\n   */\n  markConnectionHealthy() {}\n\n  /**\n   * Stops polling and cleans up the iframe\n   * @private\n   */\n  private shutdown_() {\n    this.isClosed_ = true;\n\n    if (this.scriptTagHolder) {\n      this.scriptTagHolder.close();\n      this.scriptTagHolder = null;\n    }\n\n    //remove the disconnect frame, which will trigger an XHR call to the server to tell it we're leaving.\n    if (this.myDisconnFrame) {\n      document.body.removeChild(this.myDisconnFrame);\n      this.myDisconnFrame = null;\n    }\n\n    if (this.connectTimeoutTimer_) {\n      clearTimeout(this.connectTimeoutTimer_);\n      this.connectTimeoutTimer_ = null;\n    }\n  }\n\n  /**\n   * Triggered when this transport is closed\n   * @private\n   */\n  private onClosed_() {\n    if (!this.isClosed_) {\n      this.log_('Longpoll is closing itself');\n      this.shutdown_();\n\n      if (this.onDisconnect_) {\n        this.onDisconnect_(this.everConnected_);\n        this.onDisconnect_ = null;\n      }\n    }\n  }\n\n  /**\n   * External-facing close handler. RealTime has requested we shut down. Kill our connection and tell the server\n   * that we've left.\n   */\n  close() {\n    if (!this.isClosed_) {\n      this.log_('Longpoll is being closed.');\n      this.shutdown_();\n    }\n  }\n\n  /**\n   * Send the JSON object down to the server. It will need to be stringified, base64 encoded, and then\n   * broken into chunks (since URLs have a small maximum length).\n   * @param {!Object} data The JSON data to transmit.\n   */\n  send(data: Object) {\n    const dataStr = stringify(data);\n    this.bytesSent += dataStr.length;\n    this.stats_.incrementCounter('bytes_sent', dataStr.length);\n\n    //first, lets get the base64-encoded data\n    const base64data = base64Encode(dataStr);\n\n    //We can only fit a certain amount in each URL, so we need to split this request\n    //up into multiple pieces if it doesn't fit in one request.\n    const dataSegs = splitStringBySize(base64data, MAX_PAYLOAD_SIZE);\n\n    //Enqueue each segment for transmission. We assign each chunk a sequential ID and a total number\n    //of segments so that we can reassemble the packet on the server.\n    for (let i = 0; i < dataSegs.length; i++) {\n      this.scriptTagHolder.enqueueSegment(\n        this.curSegmentNum,\n        dataSegs.length,\n        dataSegs[i]\n      );\n      this.curSegmentNum++;\n    }\n  }\n\n  /**\n   * This is how we notify the server that we're leaving.\n   * We aren't able to send requests with DHTML on a window close event, but we can\n   * trigger XHR requests in some browsers (everything but Opera basically).\n   * @param {!string} id\n   * @param {!string} pw\n   */\n  addDisconnectPingFrame(id: string, pw: string) {\n    if (isNodeSdk()) return;\n    this.myDisconnFrame = document.createElement('iframe');\n    const urlParams: { [k: string]: string } = {};\n    urlParams[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM] = 't';\n    urlParams[FIREBASE_LONGPOLL_ID_PARAM] = id;\n    urlParams[FIREBASE_LONGPOLL_PW_PARAM] = pw;\n    this.myDisconnFrame.src = this.urlFn(urlParams);\n    this.myDisconnFrame.style.display = 'none';\n\n    document.body.appendChild(this.myDisconnFrame);\n  }\n\n  /**\n   * Used to track the bytes received by this client\n   * @param {*} args\n   * @private\n   */\n  private incrementIncomingBytes_(args: any) {\n    // TODO: This is an annoying perf hit just to track the number of incoming bytes.  Maybe it should be opt-in.\n    const bytesReceived = stringify(args).length;\n    this.bytesReceived += bytesReceived;\n    this.stats_.incrementCounter('bytes_received', bytesReceived);\n  }\n}\n\nexport interface IFrameElement extends HTMLIFrameElement {\n  doc: Document;\n}\n\n/*********************************************************************************************\n * A wrapper around an iframe that is used as a long-polling script holder.\n * @constructor\n *********************************************************************************************/\nexport class FirebaseIFrameScriptHolder {\n  //We maintain a count of all of the outstanding requests, because if we have too many active at once it can cause\n  //problems in some browsers.\n  outstandingRequests = new Set<number>();\n\n  //A queue of the pending segments waiting for transmission to the server.\n  pendingSegs: { seg: number; ts: number; d: any }[] = [];\n\n  //A serial number. We use this for two things:\n  // 1) A way to ensure the browser doesn't cache responses to polls\n  // 2) A way to make the server aware when long-polls arrive in a different order than we started them. The\n  //    server needs to release both polls in this case or it will cause problems in Opera since Opera can only execute\n  //    JSONP code in the order it was added to the iframe.\n  currentSerial = Math.floor(Math.random() * 100000000);\n\n  // This gets set to false when we're \"closing down\" the connection (e.g. we're switching transports but there's still\n  // incoming data from the server that we're waiting for).\n  sendNewPolls = true;\n\n  uniqueCallbackIdentifier: number;\n  myIFrame: IFrameElement;\n  alive: boolean;\n  myID: string;\n  myPW: string;\n  commandCB: (command: string, ...args: any[]) => void;\n  onMessageCB: (...args: any[]) => void;\n\n  /**\n   * @param commandCB - The callback to be called when control commands are recevied from the server.\n   * @param onMessageCB - The callback to be triggered when responses arrive from the server.\n   * @param onDisconnect - The callback to be triggered when this tag holder is closed\n   * @param urlFn - A function that provides the URL of the endpoint to send data to.\n   */\n  constructor(\n    commandCB: (command: string, ...args: any[]) => void,\n    onMessageCB: (...args: any[]) => void,\n    public onDisconnect: () => void,\n    public urlFn: (a: object) => string\n  ) {\n    if (!isNodeSdk()) {\n      //Each script holder registers a couple of uniquely named callbacks with the window. These are called from the\n      //iframes where we put the long-polling script tags. We have two callbacks:\n      //   1) Command Callback - Triggered for control issues, like starting a connection.\n      //   2) Message Callback - Triggered when new data arrives.\n      this.uniqueCallbackIdentifier = LUIDGenerator();\n      (window as any)[\n        FIREBASE_LONGPOLL_COMMAND_CB_NAME + this.uniqueCallbackIdentifier\n      ] = commandCB;\n      (window as any)[\n        FIREBASE_LONGPOLL_DATA_CB_NAME + this.uniqueCallbackIdentifier\n      ] = onMessageCB;\n\n      //Create an iframe for us to add script tags to.\n      this.myIFrame = FirebaseIFrameScriptHolder.createIFrame_();\n\n      // Set the iframe's contents.\n      let script = '';\n      // if we set a javascript url, it's IE and we need to set the document domain. The javascript url is sufficient\n      // for ie9, but ie8 needs to do it again in the document itself.\n      if (\n        this.myIFrame.src &&\n        this.myIFrame.src.substr(0, 'javascript:'.length) === 'javascript:'\n      ) {\n        const currentDomain = document.domain;\n        script = '<script>document.domain=\"' + currentDomain + '\";</script>';\n      }\n      const iframeContents = '<html><body>' + script + '</body></html>';\n      try {\n        this.myIFrame.doc.open();\n        this.myIFrame.doc.write(iframeContents);\n        this.myIFrame.doc.close();\n      } catch (e) {\n        log('frame writing exception');\n        if (e.stack) {\n          log(e.stack);\n        }\n        log(e);\n      }\n    } else {\n      this.commandCB = commandCB;\n      this.onMessageCB = onMessageCB;\n    }\n  }\n\n  /**\n   * Each browser has its own funny way to handle iframes. Here we mush them all together into one object that I can\n   * actually use.\n   * @private\n   * @return {Element}\n   */\n  private static createIFrame_(): IFrameElement {\n    const iframe = document.createElement('iframe') as IFrameElement;\n    iframe.style.display = 'none';\n\n    // This is necessary in order to initialize the document inside the iframe\n    if (document.body) {\n      document.body.appendChild(iframe);\n      try {\n        // If document.domain has been modified in IE, this will throw an error, and we need to set the\n        // domain of the iframe's document manually. We can do this via a javascript: url as the src attribute\n        // Also note that we must do this *after* the iframe has been appended to the page. Otherwise it doesn't work.\n        const a = iframe.contentWindow.document;\n        if (!a) {\n          // Apologies for the log-spam, I need to do something to keep closure from optimizing out the assignment above.\n          log('No IE domain setting required');\n        }\n      } catch (e) {\n        const domain = document.domain;\n        iframe.src =\n          \"javascript:void((function(){document.open();document.domain='\" +\n          domain +\n          \"';document.close();})())\";\n      }\n    } else {\n      // LongPollConnection attempts to delay initialization until the document is ready, so hopefully this\n      // never gets hit.\n      throw 'Document body has not initialized. Wait to initialize Firebase until after the document is ready.';\n    }\n\n    // Get the document of the iframe in a browser-specific way.\n    if (iframe.contentDocument) {\n      (iframe as any).doc = iframe.contentDocument; // Firefox, Opera, Safari\n    } else if (iframe.contentWindow) {\n      (iframe as any).doc = iframe.contentWindow.document; // Internet Explorer\n    } else if ((iframe as any).document) {\n      (iframe as any).doc = (iframe as any).document; //others?\n    }\n\n    return iframe;\n  }\n\n  /**\n   * Cancel all outstanding queries and remove the frame.\n   */\n  close() {\n    //Mark this iframe as dead, so no new requests are sent.\n    this.alive = false;\n\n    if (this.myIFrame) {\n      //We have to actually remove all of the html inside this iframe before removing it from the\n      //window, or IE will continue loading and executing the script tags we've already added, which\n      //can lead to some errors being thrown. Setting innerHTML seems to be the easiest way to do this.\n      this.myIFrame.doc.body.innerHTML = '';\n      setTimeout(() => {\n        if (this.myIFrame !== null) {\n          document.body.removeChild(this.myIFrame);\n          this.myIFrame = null;\n        }\n      }, Math.floor(0));\n    }\n\n    // Protect from being called recursively.\n    const onDisconnect = this.onDisconnect;\n    if (onDisconnect) {\n      this.onDisconnect = null;\n      onDisconnect();\n    }\n  }\n\n  /**\n   * Actually start the long-polling session by adding the first script tag(s) to the iframe.\n   * @param {!string} id - The ID of this connection\n   * @param {!string} pw - The password for this connection\n   */\n  startLongPoll(id: string, pw: string) {\n    this.myID = id;\n    this.myPW = pw;\n    this.alive = true;\n\n    //send the initial request. If there are requests queued, make sure that we transmit as many as we are currently able to.\n    while (this.newRequest_()) {}\n  }\n\n  /**\n   * This is called any time someone might want a script tag to be added. It adds a script tag when there aren't\n   * too many outstanding requests and we are still alive.\n   *\n   * If there are outstanding packet segments to send, it sends one. If there aren't, it sends a long-poll anyways if\n   * needed.\n   */\n  private newRequest_() {\n    // We keep one outstanding request open all the time to receive data, but if we need to send data\n    // (pendingSegs.length > 0) then we create a new request to send the data.  The server will automatically\n    // close the old request.\n    if (\n      this.alive &&\n      this.sendNewPolls &&\n      this.outstandingRequests.size < (this.pendingSegs.length > 0 ? 2 : 1)\n    ) {\n      //construct our url\n      this.currentSerial++;\n      const urlParams: { [k: string]: string | number } = {};\n      urlParams[FIREBASE_LONGPOLL_ID_PARAM] = this.myID;\n      urlParams[FIREBASE_LONGPOLL_PW_PARAM] = this.myPW;\n      urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = this.currentSerial;\n      let theURL = this.urlFn(urlParams);\n      //Now add as much data as we can.\n      let curDataString = '';\n      let i = 0;\n\n      while (this.pendingSegs.length > 0) {\n        //first, lets see if the next segment will fit.\n        const nextSeg = this.pendingSegs[0];\n        if (\n          nextSeg.d.length + SEG_HEADER_SIZE + curDataString.length <=\n          MAX_URL_DATA_SIZE\n        ) {\n          //great, the segment will fit. Lets append it.\n          const theSeg = this.pendingSegs.shift();\n          curDataString =\n            curDataString +\n            '&' +\n            FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM +\n            i +\n            '=' +\n            theSeg.seg +\n            '&' +\n            FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET +\n            i +\n            '=' +\n            theSeg.ts +\n            '&' +\n            FIREBASE_LONGPOLL_DATA_PARAM +\n            i +\n            '=' +\n            theSeg.d;\n          i++;\n        } else {\n          break;\n        }\n      }\n\n      theURL = theURL + curDataString;\n      this.addLongPollTag_(theURL, this.currentSerial);\n\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Queue a packet for transmission to the server.\n   * @param segnum - A sequential id for this packet segment used for reassembly\n   * @param totalsegs - The total number of segments in this packet\n   * @param data - The data for this segment.\n   */\n  enqueueSegment(segnum: number, totalsegs: number, data: any) {\n    //add this to the queue of segments to send.\n    this.pendingSegs.push({ seg: segnum, ts: totalsegs, d: data });\n\n    //send the data immediately if there isn't already data being transmitted, unless\n    //startLongPoll hasn't been called yet.\n    if (this.alive) {\n      this.newRequest_();\n    }\n  }\n\n  /**\n   * Add a script tag for a regular long-poll request.\n   * @param {!string} url - The URL of the script tag.\n   * @param {!number} serial - The serial number of the request.\n   * @private\n   */\n  private addLongPollTag_(url: string, serial: number) {\n    //remember that we sent this request.\n    this.outstandingRequests.add(serial);\n\n    const doNewRequest = () => {\n      this.outstandingRequests.delete(serial);\n      this.newRequest_();\n    };\n\n    // If this request doesn't return on its own accord (by the server sending us some data), we'll\n    // create a new one after the KEEPALIVE interval to make sure we always keep a fresh request open.\n    const keepaliveTimeout = setTimeout(\n      doNewRequest,\n      Math.floor(KEEPALIVE_REQUEST_INTERVAL)\n    );\n\n    const readyStateCB = () => {\n      // Request completed.  Cancel the keepalive.\n      clearTimeout(keepaliveTimeout);\n\n      // Trigger a new request so we can continue receiving data.\n      doNewRequest();\n    };\n\n    this.addTag(url, readyStateCB);\n  }\n\n  /**\n   * Add an arbitrary script tag to the iframe.\n   * @param {!string} url - The URL for the script tag source.\n   * @param {!function()} loadCB - A callback to be triggered once the script has loaded.\n   */\n  addTag(url: string, loadCB: () => void) {\n    if (isNodeSdk()) {\n      (this as any).doNodeLongPoll(url, loadCB);\n    } else {\n      setTimeout(() => {\n        try {\n          // if we're already closed, don't add this poll\n          if (!this.sendNewPolls) return;\n          const newScript = this.myIFrame.doc.createElement('script');\n          newScript.type = 'text/javascript';\n          newScript.async = true;\n          newScript.src = url;\n          newScript.onload = (newScript as any).onreadystatechange = function() {\n            const rstate = (newScript as any).readyState;\n            if (!rstate || rstate === 'loaded' || rstate === 'complete') {\n              newScript.onload = (newScript as any).onreadystatechange = null;\n              if (newScript.parentNode) {\n                newScript.parentNode.removeChild(newScript);\n              }\n              loadCB();\n            }\n          };\n          newScript.onerror = () => {\n            log('Long-poll script failed to load: ' + url);\n            this.sendNewPolls = false;\n            this.close();\n          };\n          this.myIFrame.doc.body.appendChild(newScript);\n        } catch (e) {\n          // TODO: we should make this error visible somehow\n        }\n      }, Math.floor(1));\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** The semver (www.semver.org) version of the SDK. */\nexport let SDK_VERSION = '';\n\n// SDK_VERSION should be set before any database instance is created\nexport function setSDKVersion(version: string): void {\n  SDK_VERSION = version;\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RepoInfo } from '../core/RepoInfo';\n\ndeclare const MozWebSocket: any;\n\nimport { assert, CONSTANTS as ENV_CONSTANTS } from '@firebase/util';\nimport { logWrapper, splitStringBySize } from '../core/util/util';\nimport { StatsManager } from '../core/stats/StatsManager';\nimport {\n  FORGE_DOMAIN,\n  FORGE_REF,\n  LAST_SESSION_PARAM,\n  PROTOCOL_VERSION,\n  REFERER_PARAM,\n  TRANSPORT_SESSION_PARAM,\n  VERSION_PARAM,\n  WEBSOCKET\n} from './Constants';\nimport { PersistentStorage } from '../core/storage/storage';\nimport { jsonEval, stringify } from '@firebase/util';\nimport { isNodeSdk } from '@firebase/util';\nimport { Transport } from './Transport';\nimport { StatsCollection } from '../core/stats/StatsCollection';\nimport { SDK_VERSION } from '../core/version';\n\nconst WEBSOCKET_MAX_FRAME_SIZE = 16384;\nconst WEBSOCKET_KEEPALIVE_INTERVAL = 45000;\n\nlet WebSocketImpl = null;\nif (typeof MozWebSocket !== 'undefined') {\n  WebSocketImpl = MozWebSocket;\n} else if (typeof WebSocket !== 'undefined') {\n  WebSocketImpl = WebSocket;\n}\n\nexport function setWebSocketImpl(impl) {\n  WebSocketImpl = impl;\n}\n\n/**\n * Create a new websocket connection with the given callbacks.\n * @constructor\n * @implements {Transport}\n */\nexport class WebSocketConnection implements Transport {\n  keepaliveTimer: number | null = null;\n  frames: string[] | null = null;\n  totalFrames = 0;\n  bytesSent = 0;\n  bytesReceived = 0;\n  connURL: string;\n  onDisconnect: (a?: boolean) => void;\n  onMessage: (msg: Object) => void;\n  mySock: any | null;\n  private log_: (...a: any[]) => void;\n  private stats_: StatsCollection;\n  private everConnected_: boolean;\n  private isClosed_: boolean;\n\n  /**\n   * @param {string} connId identifier for this transport\n   * @param {RepoInfo} repoInfo The info for the websocket endpoint.\n   * @param {string=} transportSessionId Optional transportSessionId if this is connecting to an existing transport\n   *                                         session\n   * @param {string=} lastSessionId Optional lastSessionId if there was a previous connection\n   */\n  constructor(\n    public connId: string,\n    repoInfo: RepoInfo,\n    transportSessionId?: string,\n    lastSessionId?: string\n  ) {\n    this.log_ = logWrapper(this.connId);\n    this.stats_ = StatsManager.getCollection(repoInfo);\n    this.connURL = WebSocketConnection.connectionURL_(\n      repoInfo,\n      transportSessionId,\n      lastSessionId\n    );\n  }\n\n  /**\n   * @param {RepoInfo} repoInfo The info for the websocket endpoint.\n   * @param {string=} transportSessionId Optional transportSessionId if this is connecting to an existing transport\n   *                                         session\n   * @param {string=} lastSessionId Optional lastSessionId if there was a previous connection\n   * @return {string} connection url\n   * @private\n   */\n  private static connectionURL_(\n    repoInfo: RepoInfo,\n    transportSessionId?: string,\n    lastSessionId?: string\n  ): string {\n    const urlParams: { [k: string]: string } = {};\n    urlParams[VERSION_PARAM] = PROTOCOL_VERSION;\n\n    if (\n      !isNodeSdk() &&\n      typeof location !== 'undefined' &&\n      location.href &&\n      location.href.indexOf(FORGE_DOMAIN) !== -1\n    ) {\n      urlParams[REFERER_PARAM] = FORGE_REF;\n    }\n    if (transportSessionId) {\n      urlParams[TRANSPORT_SESSION_PARAM] = transportSessionId;\n    }\n    if (lastSessionId) {\n      urlParams[LAST_SESSION_PARAM] = lastSessionId;\n    }\n    return repoInfo.connectionURL(WEBSOCKET, urlParams);\n  }\n\n  /**\n   *\n   * @param onMessage Callback when messages arrive\n   * @param onDisconnect Callback with connection lost.\n   */\n  open(onMessage: (msg: Object) => void, onDisconnect: (a?: boolean) => void) {\n    this.onDisconnect = onDisconnect;\n    this.onMessage = onMessage;\n\n    this.log_('Websocket connecting to ' + this.connURL);\n\n    this.everConnected_ = false;\n    // Assume failure until proven otherwise.\n    PersistentStorage.set('previous_websocket_failure', true);\n\n    try {\n      if (isNodeSdk()) {\n        const device = ENV_CONSTANTS.NODE_ADMIN ? 'AdminNode' : 'Node';\n        // UA Format: Firebase/<wire_protocol>/<sdk_version>/<platform>/<device>\n        const options: { [k: string]: object } = {\n          headers: {\n            'User-Agent': `Firebase/${PROTOCOL_VERSION}/${SDK_VERSION}/${process.platform}/${device}`\n          }\n        };\n\n        // Plumb appropriate http_proxy environment variable into faye-websocket if it exists.\n        const env = process['env'];\n        const proxy =\n          this.connURL.indexOf('wss://') == 0\n            ? env['HTTPS_PROXY'] || env['https_proxy']\n            : env['HTTP_PROXY'] || env['http_proxy'];\n\n        if (proxy) {\n          options['proxy'] = { origin: proxy };\n        }\n\n        this.mySock = new WebSocketImpl(this.connURL, [], options);\n      } else {\n        this.mySock = new WebSocketImpl(this.connURL);\n      }\n    } catch (e) {\n      this.log_('Error instantiating WebSocket.');\n      const error = e.message || e.data;\n      if (error) {\n        this.log_(error);\n      }\n      this.onClosed_();\n      return;\n    }\n\n    this.mySock.onopen = () => {\n      this.log_('Websocket connected.');\n      this.everConnected_ = true;\n    };\n\n    this.mySock.onclose = () => {\n      this.log_('Websocket connection was disconnected.');\n      this.mySock = null;\n      this.onClosed_();\n    };\n\n    this.mySock.onmessage = (m: object) => {\n      this.handleIncomingFrame(m);\n    };\n\n    this.mySock.onerror = (e: any) => {\n      this.log_('WebSocket error.  Closing connection.');\n      const error = e.message || e.data;\n      if (error) {\n        this.log_(error);\n      }\n      this.onClosed_();\n    };\n  }\n\n  /**\n   * No-op for websockets, we don't need to do anything once the connection is confirmed as open\n   */\n  start() {}\n\n  static forceDisallow_: Boolean;\n\n  static forceDisallow() {\n    WebSocketConnection.forceDisallow_ = true;\n  }\n\n  static isAvailable(): boolean {\n    let isOldAndroid = false;\n    if (typeof navigator !== 'undefined' && navigator.userAgent) {\n      const oldAndroidRegex = /Android ([0-9]{0,}\\.[0-9]{0,})/;\n      const oldAndroidMatch = navigator.userAgent.match(oldAndroidRegex);\n      if (oldAndroidMatch && oldAndroidMatch.length > 1) {\n        if (parseFloat(oldAndroidMatch[1]) < 4.4) {\n          isOldAndroid = true;\n        }\n      }\n    }\n\n    return (\n      !isOldAndroid &&\n      WebSocketImpl !== null &&\n      !WebSocketConnection.forceDisallow_\n    );\n  }\n\n  /**\n   * Number of response before we consider the connection \"healthy.\"\n   * @type {number}\n   */\n  static responsesRequiredToBeHealthy = 2;\n\n  /**\n   * Time to wait for the connection te become healthy before giving up.\n   * @type {number}\n   */\n  static healthyTimeout = 30000;\n\n  /**\n   * Returns true if we previously failed to connect with this transport.\n   * @return {boolean}\n   */\n  static previouslyFailed(): boolean {\n    // If our persistent storage is actually only in-memory storage,\n    // we default to assuming that it previously failed to be safe.\n    return (\n      PersistentStorage.isInMemoryStorage ||\n      PersistentStorage.get('previous_websocket_failure') === true\n    );\n  }\n\n  markConnectionHealthy() {\n    PersistentStorage.remove('previous_websocket_failure');\n  }\n\n  private appendFrame_(data: string) {\n    this.frames.push(data);\n    if (this.frames.length == this.totalFrames) {\n      const fullMess = this.frames.join('');\n      this.frames = null;\n      const jsonMess = jsonEval(fullMess) as object;\n\n      //handle the message\n      this.onMessage(jsonMess);\n    }\n  }\n\n  /**\n   * @param {number} frameCount The number of frames we are expecting from the server\n   * @private\n   */\n  private handleNewFrameCount_(frameCount: number) {\n    this.totalFrames = frameCount;\n    this.frames = [];\n  }\n\n  /**\n   * Attempts to parse a frame count out of some text. If it can't, assumes a value of 1\n   * @param {!String} data\n   * @return {?String} Any remaining data to be process, or null if there is none\n   * @private\n   */\n  private extractFrameCount_(data: string): string | null {\n    assert(this.frames === null, 'We already have a frame buffer');\n    // TODO: The server is only supposed to send up to 9999 frames (i.e. length <= 4), but that isn't being enforced\n    // currently.  So allowing larger frame counts (length <= 6).  See https://app.asana.com/0/search/8688598998380/8237608042508\n    if (data.length <= 6) {\n      const frameCount = Number(data);\n      if (!isNaN(frameCount)) {\n        this.handleNewFrameCount_(frameCount);\n        return null;\n      }\n    }\n    this.handleNewFrameCount_(1);\n    return data;\n  }\n\n  /**\n   * Process a websocket frame that has arrived from the server.\n   * @param mess The frame data\n   */\n  handleIncomingFrame(mess: { [k: string]: any }) {\n    if (this.mySock === null) return; // Chrome apparently delivers incoming packets even after we .close() the connection sometimes.\n    const data = mess['data'] as string;\n    this.bytesReceived += data.length;\n    this.stats_.incrementCounter('bytes_received', data.length);\n\n    this.resetKeepAlive();\n\n    if (this.frames !== null) {\n      // we're buffering\n      this.appendFrame_(data);\n    } else {\n      // try to parse out a frame count, otherwise, assume 1 and process it\n      const remainingData = this.extractFrameCount_(data);\n      if (remainingData !== null) {\n        this.appendFrame_(remainingData);\n      }\n    }\n  }\n\n  /**\n   * Send a message to the server\n   * @param {Object} data The JSON object to transmit\n   */\n  send(data: Object) {\n    this.resetKeepAlive();\n\n    const dataStr = stringify(data);\n    this.bytesSent += dataStr.length;\n    this.stats_.incrementCounter('bytes_sent', dataStr.length);\n\n    //We can only fit a certain amount in each websocket frame, so we need to split this request\n    //up into multiple pieces if it doesn't fit in one request.\n\n    const dataSegs = splitStringBySize(dataStr, WEBSOCKET_MAX_FRAME_SIZE);\n\n    //Send the length header\n    if (dataSegs.length > 1) {\n      this.sendString_(String(dataSegs.length));\n    }\n\n    //Send the actual data in segments.\n    for (let i = 0; i < dataSegs.length; i++) {\n      this.sendString_(dataSegs[i]);\n    }\n  }\n\n  private shutdown_() {\n    this.isClosed_ = true;\n    if (this.keepaliveTimer) {\n      clearInterval(this.keepaliveTimer);\n      this.keepaliveTimer = null;\n    }\n\n    if (this.mySock) {\n      this.mySock.close();\n      this.mySock = null;\n    }\n  }\n\n  private onClosed_() {\n    if (!this.isClosed_) {\n      this.log_('WebSocket is closing itself');\n      this.shutdown_();\n\n      // since this is an internal close, trigger the close listener\n      if (this.onDisconnect) {\n        this.onDisconnect(this.everConnected_);\n        this.onDisconnect = null;\n      }\n    }\n  }\n\n  /**\n   * External-facing close handler.\n   * Close the websocket and kill the connection.\n   */\n  close() {\n    if (!this.isClosed_) {\n      this.log_('WebSocket is being closed');\n      this.shutdown_();\n    }\n  }\n\n  /**\n   * Kill the current keepalive timer and start a new one, to ensure that it always fires N seconds after\n   * the last activity.\n   */\n  resetKeepAlive() {\n    clearInterval(this.keepaliveTimer);\n    this.keepaliveTimer = setInterval(() => {\n      //If there has been no websocket activity for a while, send a no-op\n      if (this.mySock) {\n        this.sendString_('0');\n      }\n      this.resetKeepAlive();\n    }, Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL)) as any;\n  }\n\n  /**\n   * Send a string over the websocket.\n   *\n   * @param {string} str String to send.\n   * @private\n   */\n  private sendString_(str: string) {\n    // Firefox seems to sometimes throw exceptions (NS_ERROR_UNEXPECTED) from websocket .send()\n    // calls for some unknown reason.  We treat these as an error and disconnect.\n    // See https://app.asana.com/0/58926111402292/68021340250410\n    try {\n      this.mySock.send(str);\n    } catch (e) {\n      this.log_(\n        'Exception thrown from WebSocket.send():',\n        e.message || e.data,\n        'Closing connection.'\n      );\n      setTimeout(this.onClosed_.bind(this), 0);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BrowserPollConnection } from './BrowserPollConnection';\nimport { WebSocketConnection } from './WebSocketConnection';\nimport { warn, each } from '../core/util/util';\nimport { TransportConstructor } from './Transport';\nimport { RepoInfo } from '../core/RepoInfo';\n\n/**\n * Currently simplistic, this class manages what transport a Connection should use at various stages of its\n * lifecycle.\n *\n * It starts with longpolling in a browser, and httppolling on node. It then upgrades to websockets if\n * they are available.\n * @constructor\n */\nexport class TransportManager {\n  private transports_: TransportConstructor[];\n\n  /**\n   * @const\n   * @type {!Array.<function(new:Transport, string, RepoInfo, string=)>}\n   */\n  static get ALL_TRANSPORTS() {\n    return [BrowserPollConnection, WebSocketConnection];\n  }\n\n  /**\n   * @param {!RepoInfo} repoInfo Metadata around the namespace we're connecting to\n   */\n  constructor(repoInfo: RepoInfo) {\n    this.initTransports_(repoInfo);\n  }\n\n  /**\n   * @param {!RepoInfo} repoInfo\n   * @private\n   */\n  private initTransports_(repoInfo: RepoInfo) {\n    const isWebSocketsAvailable: boolean =\n      WebSocketConnection && WebSocketConnection['isAvailable']();\n    let isSkipPollConnection =\n      isWebSocketsAvailable && !WebSocketConnection.previouslyFailed();\n\n    if (repoInfo.webSocketOnly) {\n      if (!isWebSocketsAvailable)\n        warn(\n          \"wss:// URL used, but browser isn't known to support websockets.  Trying anyway.\"\n        );\n\n      isSkipPollConnection = true;\n    }\n\n    if (isSkipPollConnection) {\n      this.transports_ = [WebSocketConnection];\n    } else {\n      const transports = (this.transports_ = [] as TransportConstructor[]);\n      for (const transport of TransportManager.ALL_TRANSPORTS) {\n        if (transport && transport['isAvailable']()) {\n          transports.push(transport);\n        }\n      }\n    }\n  }\n\n  /**\n   * @return {function(new:Transport, !string, !RepoInfo, string=, string=)} The constructor for the\n   * initial transport to use\n   */\n  initialTransport(): TransportConstructor {\n    if (this.transports_.length > 0) {\n      return this.transports_[0];\n    } else {\n      throw new Error('No transports available');\n    }\n  }\n\n  /**\n   * @return {?function(new:Transport, function(),function(), string=)} The constructor for the next\n   * transport, or null\n   */\n  upgradeTransport(): TransportConstructor | null {\n    if (this.transports_.length > 1) {\n      return this.transports_[1];\n    } else {\n      return null;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  error,\n  logWrapper,\n  requireKey,\n  setTimeoutNonBlocking,\n  warn\n} from '../core/util/util';\nimport { PersistentStorage } from '../core/storage/storage';\nimport { PROTOCOL_VERSION } from './Constants';\nimport { TransportManager } from './TransportManager';\nimport { RepoInfo } from '../core/RepoInfo';\nimport { Transport, TransportConstructor } from './Transport';\n\n// Abort upgrade attempt if it takes longer than 60s.\nconst UPGRADE_TIMEOUT = 60000;\n\n// For some transports (WebSockets), we need to \"validate\" the transport by exchanging a few requests and responses.\n// If we haven't sent enough requests within 5s, we'll start sending noop ping requests.\nconst DELAY_BEFORE_SENDING_EXTRA_REQUESTS = 5000;\n\n// If the initial data sent triggers a lot of bandwidth (i.e. it's a large put or a listen for a large amount of data)\n// then we may not be able to exchange our ping/pong requests within the healthy timeout.  So if we reach the timeout\n// but we've sent/received enough bytes, we don't cancel the connection.\nconst BYTES_SENT_HEALTHY_OVERRIDE = 10 * 1024;\nconst BYTES_RECEIVED_HEALTHY_OVERRIDE = 100 * 1024;\n\nconst enum RealtimeState {\n  CONNECTING,\n  CONNECTED,\n  DISCONNECTED\n}\n\nconst MESSAGE_TYPE = 't';\nconst MESSAGE_DATA = 'd';\nconst CONTROL_SHUTDOWN = 's';\nconst CONTROL_RESET = 'r';\nconst CONTROL_ERROR = 'e';\nconst CONTROL_PONG = 'o';\nconst SWITCH_ACK = 'a';\nconst END_TRANSMISSION = 'n';\nconst PING = 'p';\n\nconst SERVER_HELLO = 'h';\n\n/**\n * Creates a new real-time connection to the server using whichever method works\n * best in the current browser.\n *\n * @constructor\n */\nexport class Connection {\n  connectionCount = 0;\n  pendingDataMessages: any[] = [];\n  sessionId: string;\n\n  private conn_: Transport;\n  private healthyTimeout_: number;\n  private isHealthy_: boolean;\n  private log_: (...args: any[]) => void;\n  private primaryResponsesRequired_: number;\n  private rx_: Transport;\n  private secondaryConn_: Transport;\n  private secondaryResponsesRequired_: number;\n  private state_ = RealtimeState.CONNECTING;\n  private transportManager_: TransportManager;\n  private tx_: Transport;\n\n  /**\n   * @param {!string} id - an id for this connection\n   * @param {!RepoInfo} repoInfo_ - the info for the endpoint to connect to\n   * @param {function(Object)} onMessage_ - the callback to be triggered when a server-push message arrives\n   * @param {function(number, string)} onReady_ - the callback to be triggered when this connection is ready to send messages.\n   * @param {function()} onDisconnect_ - the callback to be triggered when a connection was lost\n   * @param {function(string)} onKill_ - the callback to be triggered when this connection has permanently shut down.\n   * @param {string=} lastSessionId - last session id in persistent connection. is used to clean up old session in real-time server\n   */\n  constructor(\n    public id: string,\n    private repoInfo_: RepoInfo,\n    private onMessage_: (a: Object) => void,\n    private onReady_: (a: number, b: string) => void,\n    private onDisconnect_: () => void,\n    private onKill_: (a: string) => void,\n    public lastSessionId?: string\n  ) {\n    this.log_ = logWrapper('c:' + this.id + ':');\n    this.transportManager_ = new TransportManager(repoInfo_);\n    this.log_('Connection created');\n    this.start_();\n  }\n\n  /**\n   * Starts a connection attempt\n   * @private\n   */\n  private start_() {\n    const conn = this.transportManager_.initialTransport();\n    this.conn_ = new conn(\n      this.nextTransportId_(),\n      this.repoInfo_,\n      undefined,\n      this.lastSessionId\n    );\n\n    // For certain transports (WebSockets), we need to send and receive several messages back and forth before we\n    // can consider the transport healthy.\n    this.primaryResponsesRequired_ = conn['responsesRequiredToBeHealthy'] || 0;\n\n    const onMessageReceived = this.connReceiver_(this.conn_);\n    const onConnectionLost = this.disconnReceiver_(this.conn_);\n    this.tx_ = this.conn_;\n    this.rx_ = this.conn_;\n    this.secondaryConn_ = null;\n    this.isHealthy_ = false;\n\n    /*\n     * Firefox doesn't like when code from one iframe tries to create another iframe by way of the parent frame.\n     * This can occur in the case of a redirect, i.e. we guessed wrong on what server to connect to and received a reset.\n     * Somehow, setTimeout seems to make this ok. That doesn't make sense from a security perspective, since you should\n     * still have the context of your originating frame.\n     */\n    setTimeout(() => {\n      // this.conn_ gets set to null in some of the tests. Check to make sure it still exists before using it\n      this.conn_ && this.conn_.open(onMessageReceived, onConnectionLost);\n    }, Math.floor(0));\n\n    const healthyTimeout_ms = conn['healthyTimeout'] || 0;\n    if (healthyTimeout_ms > 0) {\n      this.healthyTimeout_ = setTimeoutNonBlocking(() => {\n        this.healthyTimeout_ = null;\n        if (!this.isHealthy_) {\n          if (\n            this.conn_ &&\n            this.conn_.bytesReceived > BYTES_RECEIVED_HEALTHY_OVERRIDE\n          ) {\n            this.log_(\n              'Connection exceeded healthy timeout but has received ' +\n                this.conn_.bytesReceived +\n                ' bytes.  Marking connection healthy.'\n            );\n            this.isHealthy_ = true;\n            this.conn_.markConnectionHealthy();\n          } else if (\n            this.conn_ &&\n            this.conn_.bytesSent > BYTES_SENT_HEALTHY_OVERRIDE\n          ) {\n            this.log_(\n              'Connection exceeded healthy timeout but has sent ' +\n                this.conn_.bytesSent +\n                ' bytes.  Leaving connection alive.'\n            );\n            // NOTE: We don't want to mark it healthy, since we have no guarantee that the bytes have made it to\n            // the server.\n          } else {\n            this.log_('Closing unhealthy connection after timeout.');\n            this.close();\n          }\n        }\n      }, Math.floor(healthyTimeout_ms)) as any;\n    }\n  }\n\n  /**\n   * @return {!string}\n   * @private\n   */\n  private nextTransportId_(): string {\n    return 'c:' + this.id + ':' + this.connectionCount++;\n  }\n\n  private disconnReceiver_(conn) {\n    return everConnected => {\n      if (conn === this.conn_) {\n        this.onConnectionLost_(everConnected);\n      } else if (conn === this.secondaryConn_) {\n        this.log_('Secondary connection lost.');\n        this.onSecondaryConnectionLost_();\n      } else {\n        this.log_('closing an old connection');\n      }\n    };\n  }\n\n  private connReceiver_(conn: Transport) {\n    return (message: object) => {\n      if (this.state_ != RealtimeState.DISCONNECTED) {\n        if (conn === this.rx_) {\n          this.onPrimaryMessageReceived_(message);\n        } else if (conn === this.secondaryConn_) {\n          this.onSecondaryMessageReceived_(message);\n        } else {\n          this.log_('message on old connection');\n        }\n      }\n    };\n  }\n\n  /**\n   *\n   * @param {Object} dataMsg An arbitrary data message to be sent to the server\n   */\n  sendRequest(dataMsg: object) {\n    // wrap in a data message envelope and send it on\n    const msg = { t: 'd', d: dataMsg };\n    this.sendData_(msg);\n  }\n\n  tryCleanupConnection() {\n    if (this.tx_ === this.secondaryConn_ && this.rx_ === this.secondaryConn_) {\n      this.log_(\n        'cleaning up and promoting a connection: ' + this.secondaryConn_.connId\n      );\n      this.conn_ = this.secondaryConn_;\n      this.secondaryConn_ = null;\n      // the server will shutdown the old connection\n    }\n  }\n\n  private onSecondaryControl_(controlData: { [k: string]: any }) {\n    if (MESSAGE_TYPE in controlData) {\n      const cmd = controlData[MESSAGE_TYPE] as string;\n      if (cmd === SWITCH_ACK) {\n        this.upgradeIfSecondaryHealthy_();\n      } else if (cmd === CONTROL_RESET) {\n        // Most likely the session wasn't valid. Abandon the switch attempt\n        this.log_('Got a reset on secondary, closing it');\n        this.secondaryConn_.close();\n        // If we were already using this connection for something, than we need to fully close\n        if (\n          this.tx_ === this.secondaryConn_ ||\n          this.rx_ === this.secondaryConn_\n        ) {\n          this.close();\n        }\n      } else if (cmd === CONTROL_PONG) {\n        this.log_('got pong on secondary.');\n        this.secondaryResponsesRequired_--;\n        this.upgradeIfSecondaryHealthy_();\n      }\n    }\n  }\n\n  private onSecondaryMessageReceived_(parsedData: object) {\n    const layer: string = requireKey('t', parsedData);\n    const data: any = requireKey('d', parsedData);\n    if (layer == 'c') {\n      this.onSecondaryControl_(data);\n    } else if (layer == 'd') {\n      // got a data message, but we're still second connection. Need to buffer it up\n      this.pendingDataMessages.push(data);\n    } else {\n      throw new Error('Unknown protocol layer: ' + layer);\n    }\n  }\n\n  private upgradeIfSecondaryHealthy_() {\n    if (this.secondaryResponsesRequired_ <= 0) {\n      this.log_('Secondary connection is healthy.');\n      this.isHealthy_ = true;\n      this.secondaryConn_.markConnectionHealthy();\n      this.proceedWithUpgrade_();\n    } else {\n      // Send a ping to make sure the connection is healthy.\n      this.log_('sending ping on secondary.');\n      this.secondaryConn_.send({ t: 'c', d: { t: PING, d: {} } });\n    }\n  }\n\n  private proceedWithUpgrade_() {\n    // tell this connection to consider itself open\n    this.secondaryConn_.start();\n    // send ack\n    this.log_('sending client ack on secondary');\n    this.secondaryConn_.send({ t: 'c', d: { t: SWITCH_ACK, d: {} } });\n\n    // send end packet on primary transport, switch to sending on this one\n    // can receive on this one, buffer responses until end received on primary transport\n    this.log_('Ending transmission on primary');\n    this.conn_.send({ t: 'c', d: { t: END_TRANSMISSION, d: {} } });\n    this.tx_ = this.secondaryConn_;\n\n    this.tryCleanupConnection();\n  }\n\n  private onPrimaryMessageReceived_(parsedData: { [k: string]: any }) {\n    // Must refer to parsedData properties in quotes, so closure doesn't touch them.\n    const layer: string = requireKey('t', parsedData);\n    const data: any = requireKey('d', parsedData);\n    if (layer == 'c') {\n      this.onControl_(data);\n    } else if (layer == 'd') {\n      this.onDataMessage_(data);\n    }\n  }\n\n  private onDataMessage_(message: any) {\n    this.onPrimaryResponse_();\n\n    // We don't do anything with data messages, just kick them up a level\n    this.onMessage_(message);\n  }\n\n  private onPrimaryResponse_() {\n    if (!this.isHealthy_) {\n      this.primaryResponsesRequired_--;\n      if (this.primaryResponsesRequired_ <= 0) {\n        this.log_('Primary connection is healthy.');\n        this.isHealthy_ = true;\n        this.conn_.markConnectionHealthy();\n      }\n    }\n  }\n\n  private onControl_(controlData: { [k: string]: any }) {\n    const cmd: string = requireKey(MESSAGE_TYPE, controlData);\n    if (MESSAGE_DATA in controlData) {\n      const payload = controlData[MESSAGE_DATA];\n      if (cmd === SERVER_HELLO) {\n        this.onHandshake_(payload);\n      } else if (cmd === END_TRANSMISSION) {\n        this.log_('recvd end transmission on primary');\n        this.rx_ = this.secondaryConn_;\n        for (let i = 0; i < this.pendingDataMessages.length; ++i) {\n          this.onDataMessage_(this.pendingDataMessages[i]);\n        }\n        this.pendingDataMessages = [];\n        this.tryCleanupConnection();\n      } else if (cmd === CONTROL_SHUTDOWN) {\n        // This was previously the 'onKill' callback passed to the lower-level connection\n        // payload in this case is the reason for the shutdown. Generally a human-readable error\n        this.onConnectionShutdown_(payload);\n      } else if (cmd === CONTROL_RESET) {\n        // payload in this case is the host we should contact\n        this.onReset_(payload);\n      } else if (cmd === CONTROL_ERROR) {\n        error('Server Error: ' + payload);\n      } else if (cmd === CONTROL_PONG) {\n        this.log_('got pong on primary.');\n        this.onPrimaryResponse_();\n        this.sendPingOnPrimaryIfNecessary_();\n      } else {\n        error('Unknown control packet command: ' + cmd);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {Object} handshake The handshake data returned from the server\n   * @private\n   */\n  private onHandshake_(handshake: {\n    ts: number;\n    v: string;\n    h: string;\n    s: string;\n  }) {\n    const timestamp = handshake.ts;\n    const version = handshake.v;\n    const host = handshake.h;\n    this.sessionId = handshake.s;\n    this.repoInfo_.updateHost(host);\n    // if we've already closed the connection, then don't bother trying to progress further\n    if (this.state_ == RealtimeState.CONNECTING) {\n      this.conn_.start();\n      this.onConnectionEstablished_(this.conn_, timestamp);\n      if (PROTOCOL_VERSION !== version) {\n        warn('Protocol version mismatch detected');\n      }\n      // TODO: do we want to upgrade? when? maybe a delay?\n      this.tryStartUpgrade_();\n    }\n  }\n\n  private tryStartUpgrade_() {\n    const conn = this.transportManager_.upgradeTransport();\n    if (conn) {\n      this.startUpgrade_(conn);\n    }\n  }\n\n  private startUpgrade_(conn: TransportConstructor) {\n    this.secondaryConn_ = new conn(\n      this.nextTransportId_(),\n      this.repoInfo_,\n      this.sessionId\n    );\n    // For certain transports (WebSockets), we need to send and receive several messages back and forth before we\n    // can consider the transport healthy.\n    this.secondaryResponsesRequired_ =\n      conn['responsesRequiredToBeHealthy'] || 0;\n\n    const onMessage = this.connReceiver_(this.secondaryConn_);\n    const onDisconnect = this.disconnReceiver_(this.secondaryConn_);\n    this.secondaryConn_.open(onMessage, onDisconnect);\n\n    // If we haven't successfully upgraded after UPGRADE_TIMEOUT, give up and kill the secondary.\n    setTimeoutNonBlocking(() => {\n      if (this.secondaryConn_) {\n        this.log_('Timed out trying to upgrade.');\n        this.secondaryConn_.close();\n      }\n    }, Math.floor(UPGRADE_TIMEOUT));\n  }\n\n  private onReset_(host: string) {\n    this.log_('Reset packet received.  New host: ' + host);\n    this.repoInfo_.updateHost(host);\n    // TODO: if we're already \"connected\", we need to trigger a disconnect at the next layer up.\n    // We don't currently support resets after the connection has already been established\n    if (this.state_ === RealtimeState.CONNECTED) {\n      this.close();\n    } else {\n      // Close whatever connections we have open and start again.\n      this.closeConnections_();\n      this.start_();\n    }\n  }\n\n  private onConnectionEstablished_(conn: Transport, timestamp: number) {\n    this.log_('Realtime connection established.');\n    this.conn_ = conn;\n    this.state_ = RealtimeState.CONNECTED;\n\n    if (this.onReady_) {\n      this.onReady_(timestamp, this.sessionId);\n      this.onReady_ = null;\n    }\n\n    // If after 5 seconds we haven't sent enough requests to the server to get the connection healthy,\n    // send some pings.\n    if (this.primaryResponsesRequired_ === 0) {\n      this.log_('Primary connection is healthy.');\n      this.isHealthy_ = true;\n    } else {\n      setTimeoutNonBlocking(() => {\n        this.sendPingOnPrimaryIfNecessary_();\n      }, Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS));\n    }\n  }\n\n  private sendPingOnPrimaryIfNecessary_() {\n    // If the connection isn't considered healthy yet, we'll send a noop ping packet request.\n    if (!this.isHealthy_ && this.state_ === RealtimeState.CONNECTED) {\n      this.log_('sending ping on primary.');\n      this.sendData_({ t: 'c', d: { t: PING, d: {} } });\n    }\n  }\n\n  private onSecondaryConnectionLost_() {\n    const conn = this.secondaryConn_;\n    this.secondaryConn_ = null;\n    if (this.tx_ === conn || this.rx_ === conn) {\n      // we are relying on this connection already in some capacity. Therefore, a failure is real\n      this.close();\n    }\n  }\n\n  /**\n   *\n   * @param {boolean} everConnected Whether or not the connection ever reached a server. Used to determine if\n   * we should flush the host cache\n   * @private\n   */\n  private onConnectionLost_(everConnected: boolean) {\n    this.conn_ = null;\n\n    // NOTE: IF you're seeing a Firefox error for this line, I think it might be because it's getting\n    // called on window close and RealtimeState.CONNECTING is no longer defined.  Just a guess.\n    if (!everConnected && this.state_ === RealtimeState.CONNECTING) {\n      this.log_('Realtime connection failed.');\n      // Since we failed to connect at all, clear any cached entry for this namespace in case the machine went away\n      if (this.repoInfo_.isCacheableHost()) {\n        PersistentStorage.remove('host:' + this.repoInfo_.host);\n        // reset the internal host to what we would show the user, i.e. <ns>.firebaseio.com\n        this.repoInfo_.internalHost = this.repoInfo_.host;\n      }\n    } else if (this.state_ === RealtimeState.CONNECTED) {\n      this.log_('Realtime connection lost.');\n    }\n\n    this.close();\n  }\n\n  /**\n   *\n   * @param {string} reason\n   * @private\n   */\n  private onConnectionShutdown_(reason: string) {\n    this.log_('Connection shutdown command received. Shutting down...');\n\n    if (this.onKill_) {\n      this.onKill_(reason);\n      this.onKill_ = null;\n    }\n\n    // We intentionally don't want to fire onDisconnect (kill is a different case),\n    // so clear the callback.\n    this.onDisconnect_ = null;\n\n    this.close();\n  }\n\n  private sendData_(data: object) {\n    if (this.state_ !== RealtimeState.CONNECTED) {\n      throw 'Connection is not connected';\n    } else {\n      this.tx_.send(data);\n    }\n  }\n\n  /**\n   * Cleans up this connection, calling the appropriate callbacks\n   */\n  close() {\n    if (this.state_ !== RealtimeState.DISCONNECTED) {\n      this.log_('Closing realtime connection.');\n      this.state_ = RealtimeState.DISCONNECTED;\n\n      this.closeConnections_();\n\n      if (this.onDisconnect_) {\n        this.onDisconnect_();\n        this.onDisconnect_ = null;\n      }\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private closeConnections_() {\n    this.log_('Shutting down all connections');\n    if (this.conn_) {\n      this.conn_.close();\n      this.conn_ = null;\n    }\n\n    if (this.secondaryConn_) {\n      this.secondaryConn_.close();\n      this.secondaryConn_ = null;\n    }\n\n    if (this.healthyTimeout_) {\n      clearTimeout(this.healthyTimeout_);\n      this.healthyTimeout_ = null;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Query } from '../api/Query';\n\n/**\n * Interface defining the set of actions that can be performed against the Firebase server\n * (basically corresponds to our wire protocol).\n *\n * @interface\n */\nexport abstract class ServerActions {\n  /**\n   * @param {!Query} query\n   * @param {function():string} currentHashFn\n   * @param {?number} tag\n   * @param {function(string, *)} onComplete\n   */\n  abstract listen(\n    query: Query,\n    currentHashFn: () => string,\n    tag: number | null,\n    onComplete: (a: string, b: any) => void\n  ): void;\n\n  /**\n   * Remove a listen.\n   *\n   * @param {!Query} query\n   * @param {?number} tag\n   */\n  abstract unlisten(query: Query, tag: number | null): void;\n\n  /**\n   * @param {string} pathString\n   * @param {*} data\n   * @param {function(string, string)=} onComplete\n   * @param {string=} hash\n   */\n  put(\n    pathString: string,\n    data: any,\n    onComplete?: (a: string, b: string) => void,\n    hash?: string\n  ) {}\n\n  /**\n   * @param {string} pathString\n   * @param {*} data\n   * @param {function(string, ?string)} onComplete\n   * @param {string=} hash\n   */\n  merge(\n    pathString: string,\n    data: any,\n    onComplete: (a: string, b: string | null) => void,\n    hash?: string\n  ) {}\n\n  /**\n   * Refreshes the auth token for the current connection.\n   * @param {string} token The authentication token\n   */\n  refreshAuthToken(token: string) {}\n\n  /**\n   * @param {string} pathString\n   * @param {*} data\n   * @param {function(string, string)=} onComplete\n   */\n  onDisconnectPut(\n    pathString: string,\n    data: any,\n    onComplete?: (a: string, b: string) => void\n  ) {}\n\n  /**\n   * @param {string} pathString\n   * @param {*} data\n   * @param {function(string, string)=} onComplete\n   */\n  onDisconnectMerge(\n    pathString: string,\n    data: any,\n    onComplete?: (a: string, b: string) => void\n  ) {}\n\n  /**\n   * @param {string} pathString\n   * @param {function(string, string)=} onComplete\n   */\n  onDisconnectCancel(\n    pathString: string,\n    onComplete?: (a: string, b: string) => void\n  ) {}\n\n  /**\n   * @param {Object.<string, *>} stats\n   */\n  reportStats(stats: { [k: string]: any }) {}\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { contains, isEmpty, safeGet, CONSTANTS } from '@firebase/util';\nimport { stringify } from '@firebase/util';\nimport { assert } from '@firebase/util';\nimport { error, log, logWrapper, warn, ObjectToUniqueKey } from './util/util';\nimport { Path } from './util/Path';\nimport { VisibilityMonitor } from './util/VisibilityMonitor';\nimport { OnlineMonitor } from './util/OnlineMonitor';\nimport { isAdmin, isValidFormat } from '@firebase/util';\nimport { Connection } from '../realtime/Connection';\nimport { isMobileCordova, isReactNative, isNodeSdk } from '@firebase/util';\nimport { ServerActions } from './ServerActions';\nimport { AuthTokenProvider } from './AuthTokenProvider';\nimport { RepoInfo } from './RepoInfo';\nimport { Query } from '../api/Query';\nimport { SDK_VERSION } from './version';\n\nconst RECONNECT_MIN_DELAY = 1000;\nconst RECONNECT_MAX_DELAY_DEFAULT = 60 * 5 * 1000; // 5 minutes in milliseconds (Case: 1858)\nconst RECONNECT_MAX_DELAY_FOR_ADMINS = 30 * 1000; // 30 seconds for admin clients (likely to be a backend server)\nconst RECONNECT_DELAY_MULTIPLIER = 1.3;\nconst RECONNECT_DELAY_RESET_TIMEOUT = 30000; // Reset delay back to MIN_DELAY after being connected for 30sec.\nconst SERVER_KILL_INTERRUPT_REASON = 'server_kill';\n\n// If auth fails repeatedly, we'll assume something is wrong and log a warning / back off.\nconst INVALID_AUTH_TOKEN_THRESHOLD = 3;\n\ninterface ListenSpec {\n  onComplete(s: string, p?: any): void;\n\n  hashFn(): string;\n\n  query: Query;\n  tag: number | null;\n}\n\ninterface OnDisconnectRequest {\n  pathString: string;\n  action: string;\n  data: any;\n  onComplete?: (a: string, b: string) => void;\n}\n\ninterface OutstandingPut {\n  action: string;\n  request: Object;\n  queued?: boolean;\n  onComplete: (a: string, b?: string) => void;\n}\n\n/**\n * Firebase connection.  Abstracts wire protocol and handles reconnecting.\n *\n * NOTE: All JSON objects sent to the realtime connection must have property names enclosed\n * in quotes to make sure the closure compiler does not minify them.\n */\nexport class PersistentConnection extends ServerActions {\n  // Used for diagnostic logging.\n  id = PersistentConnection.nextPersistentConnectionId_++;\n  private log_ = logWrapper('p:' + this.id + ':');\n\n  private interruptReasons_: { [reason: string]: boolean } = {};\n  /** Map<path, Map<queryId, ListenSpec>> */\n  private readonly listens: Map<\n    /* path */ string,\n    Map</* queryId */ string, ListenSpec>\n  > = new Map();\n  private outstandingPuts_: OutstandingPut[] = [];\n  private outstandingPutCount_ = 0;\n  private onDisconnectRequestQueue_: OnDisconnectRequest[] = [];\n  private connected_ = false;\n  private reconnectDelay_ = RECONNECT_MIN_DELAY;\n  private maxReconnectDelay_ = RECONNECT_MAX_DELAY_DEFAULT;\n  private securityDebugCallback_: ((a: Object) => void) | null = null;\n  lastSessionId: string | null = null;\n\n  private establishConnectionTimer_: number | null = null;\n\n  private visible_: boolean = false;\n\n  // Before we get connected, we keep a queue of pending messages to send.\n  private requestCBHash_: { [k: number]: (a: any) => void } = {};\n  private requestNumber_ = 0;\n\n  private realtime_: {\n    sendRequest(a: Object): void;\n    close(): void;\n  } | null = null;\n\n  private authToken_: string | null = null;\n  private forceTokenRefresh_ = false;\n  private invalidAuthTokenCount_ = 0;\n\n  private firstConnection_ = true;\n  private lastConnectionAttemptTime_: number | null = null;\n  private lastConnectionEstablishedTime_: number | null = null;\n\n  private static nextPersistentConnectionId_ = 0;\n\n  /**\n   * Counter for number of connections created. Mainly used for tagging in the logs\n   */\n  private static nextConnectionId_ = 0;\n\n  /**\n   * @implements {ServerActions}\n   * @param repoInfo_ Data about the namespace we are connecting to\n   * @param onDataUpdate_ A callback for new data from the server\n   */\n  constructor(\n    private repoInfo_: RepoInfo,\n    private onDataUpdate_: (\n      a: string,\n      b: any,\n      c: boolean,\n      d: number | null\n    ) => void,\n    private onConnectStatus_: (a: boolean) => void,\n    private onServerInfoUpdate_: (a: any) => void,\n    private authTokenProvider_: AuthTokenProvider,\n    private authOverride_?: Object | null\n  ) {\n    super();\n\n    if (authOverride_ && !isNodeSdk()) {\n      throw new Error(\n        'Auth override specified in options, but not supported on non Node.js platforms'\n      );\n    }\n    this.scheduleConnect_(0);\n\n    VisibilityMonitor.getInstance().on('visible', this.onVisible_, this);\n\n    if (repoInfo_.host.indexOf('fblocal') === -1) {\n      OnlineMonitor.getInstance().on('online', this.onOnline_, this);\n    }\n  }\n\n  protected sendRequest(\n    action: string,\n    body: any,\n    onResponse?: (a: any) => void\n  ) {\n    const curReqNum = ++this.requestNumber_;\n\n    const msg = { r: curReqNum, a: action, b: body };\n    this.log_(stringify(msg));\n    assert(\n      this.connected_,\n      \"sendRequest call when we're not connected not allowed.\"\n    );\n    this.realtime_.sendRequest(msg);\n    if (onResponse) {\n      this.requestCBHash_[curReqNum] = onResponse;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  listen(\n    query: Query,\n    currentHashFn: () => string,\n    tag: number | null,\n    onComplete: (a: string, b: any) => void\n  ) {\n    const queryId = query.queryIdentifier();\n    const pathString = query.path.toString();\n    this.log_('Listen called for ' + pathString + ' ' + queryId);\n    if (!this.listens.has(pathString)) {\n      this.listens.set(pathString, new Map());\n    }\n    assert(\n      query.getQueryParams().isDefault() ||\n        !query.getQueryParams().loadsAllData(),\n      'listen() called for non-default but complete query'\n    );\n    assert(\n      !this.listens.get(pathString)!.has(queryId),\n      'listen() called twice for same path/queryId.'\n    );\n    const listenSpec: ListenSpec = {\n      onComplete: onComplete,\n      hashFn: currentHashFn,\n      query: query,\n      tag: tag\n    };\n    this.listens.get(pathString)!.set(queryId, listenSpec);\n\n    if (this.connected_) {\n      this.sendListen_(listenSpec);\n    }\n  }\n\n  private sendListen_(listenSpec: ListenSpec) {\n    const query = listenSpec.query;\n    const pathString = query.path.toString();\n    const queryId = query.queryIdentifier();\n    this.log_('Listen on ' + pathString + ' for ' + queryId);\n    const req: { [k: string]: any } = { /*path*/ p: pathString };\n\n    const action = 'q';\n\n    // Only bother to send query if it's non-default.\n    if (listenSpec.tag) {\n      req['q'] = query.queryObject();\n      req['t'] = listenSpec.tag;\n    }\n\n    req[/*hash*/ 'h'] = listenSpec.hashFn();\n\n    this.sendRequest(action, req, (message: { [k: string]: any }) => {\n      const payload: any = message[/*data*/ 'd'];\n      const status: string = message[/*status*/ 's'];\n\n      // print warnings in any case...\n      PersistentConnection.warnOnListenWarnings_(payload, query);\n\n      const currentListenSpec =\n        this.listens.get(pathString) &&\n        this.listens.get(pathString)!.get(queryId);\n      // only trigger actions if the listen hasn't been removed and readded\n      if (currentListenSpec === listenSpec) {\n        this.log_('listen response', message);\n\n        if (status !== 'ok') {\n          this.removeListen_(pathString, queryId);\n        }\n\n        if (listenSpec.onComplete) {\n          listenSpec.onComplete(status, payload);\n        }\n      }\n    });\n  }\n\n  private static warnOnListenWarnings_(payload: any, query: Query) {\n    if (payload && typeof payload === 'object' && contains(payload, 'w')) {\n      const warnings = safeGet(payload, 'w');\n      if (Array.isArray(warnings) && ~warnings.indexOf('no_index')) {\n        const indexSpec =\n          '\".indexOn\": \"' +\n          query\n            .getQueryParams()\n            .getIndex()\n            .toString() +\n          '\"';\n        const indexPath = query.path.toString();\n        warn(\n          `Using an unspecified index. Your data will be downloaded and ` +\n            `filtered on the client. Consider adding ${indexSpec} at ` +\n            `${indexPath} to your security rules for better performance.`\n        );\n      }\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  refreshAuthToken(token: string) {\n    this.authToken_ = token;\n    this.log_('Auth token refreshed');\n    if (this.authToken_) {\n      this.tryAuth();\n    } else {\n      //If we're connected we want to let the server know to unauthenticate us. If we're not connected, simply delete\n      //the credential so we dont become authenticated next time we connect.\n      if (this.connected_) {\n        this.sendRequest('unauth', {}, () => {});\n      }\n    }\n\n    this.reduceReconnectDelayIfAdminCredential_(token);\n  }\n\n  private reduceReconnectDelayIfAdminCredential_(credential: string) {\n    // NOTE: This isn't intended to be bulletproof (a malicious developer can always just modify the client).\n    // Additionally, we don't bother resetting the max delay back to the default if auth fails / expires.\n    const isFirebaseSecret = credential && credential.length === 40;\n    if (isFirebaseSecret || isAdmin(credential)) {\n      this.log_(\n        'Admin auth credential detected.  Reducing max reconnect time.'\n      );\n      this.maxReconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;\n    }\n  }\n\n  /**\n   * Attempts to authenticate with the given credentials. If the authentication attempt fails, it's triggered like\n   * a auth revoked (the connection is closed).\n   */\n  tryAuth() {\n    if (this.connected_ && this.authToken_) {\n      const token = this.authToken_;\n      const authMethod = isValidFormat(token) ? 'auth' : 'gauth';\n      const requestData: { [k: string]: any } = { cred: token };\n      if (this.authOverride_ === null) {\n        requestData['noauth'] = true;\n      } else if (typeof this.authOverride_ === 'object') {\n        requestData['authvar'] = this.authOverride_;\n      }\n      this.sendRequest(authMethod, requestData, (res: { [k: string]: any }) => {\n        const status: string = res[/*status*/ 's'];\n        const data: string = res[/*data*/ 'd'] || 'error';\n\n        if (this.authToken_ === token) {\n          if (status === 'ok') {\n            this.invalidAuthTokenCount_ = 0;\n          } else {\n            // Triggers reconnect and force refresh for auth token\n            this.onAuthRevoked_(status, data);\n          }\n        }\n      });\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  unlisten(query: Query, tag: number | null) {\n    const pathString = query.path.toString();\n    const queryId = query.queryIdentifier();\n\n    this.log_('Unlisten called for ' + pathString + ' ' + queryId);\n\n    assert(\n      query.getQueryParams().isDefault() ||\n        !query.getQueryParams().loadsAllData(),\n      'unlisten() called for non-default but complete query'\n    );\n    const listen = this.removeListen_(pathString, queryId);\n    if (listen && this.connected_) {\n      this.sendUnlisten_(pathString, queryId, query.queryObject(), tag);\n    }\n  }\n\n  private sendUnlisten_(\n    pathString: string,\n    queryId: string,\n    queryObj: Object,\n    tag: number | null\n  ) {\n    this.log_('Unlisten on ' + pathString + ' for ' + queryId);\n\n    const req: { [k: string]: any } = { /*path*/ p: pathString };\n    const action = 'n';\n    // Only bother sending queryId if it's non-default.\n    if (tag) {\n      req['q'] = queryObj;\n      req['t'] = tag;\n    }\n\n    this.sendRequest(action, req);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  onDisconnectPut(\n    pathString: string,\n    data: any,\n    onComplete?: (a: string, b: string) => void\n  ) {\n    if (this.connected_) {\n      this.sendOnDisconnect_('o', pathString, data, onComplete);\n    } else {\n      this.onDisconnectRequestQueue_.push({\n        pathString,\n        action: 'o',\n        data,\n        onComplete\n      });\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  onDisconnectMerge(\n    pathString: string,\n    data: any,\n    onComplete?: (a: string, b: string) => void\n  ) {\n    if (this.connected_) {\n      this.sendOnDisconnect_('om', pathString, data, onComplete);\n    } else {\n      this.onDisconnectRequestQueue_.push({\n        pathString,\n        action: 'om',\n        data,\n        onComplete\n      });\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  onDisconnectCancel(\n    pathString: string,\n    onComplete?: (a: string, b: string) => void\n  ) {\n    if (this.connected_) {\n      this.sendOnDisconnect_('oc', pathString, null, onComplete);\n    } else {\n      this.onDisconnectRequestQueue_.push({\n        pathString,\n        action: 'oc',\n        data: null,\n        onComplete\n      });\n    }\n  }\n\n  private sendOnDisconnect_(\n    action: string,\n    pathString: string,\n    data: any,\n    onComplete: (a: string, b: string) => void\n  ) {\n    const request = { /*path*/ p: pathString, /*data*/ d: data };\n    this.log_('onDisconnect ' + action, request);\n    this.sendRequest(action, request, (response: { [k: string]: any }) => {\n      if (onComplete) {\n        setTimeout(function() {\n          onComplete(response[/*status*/ 's'], response[/* data */ 'd']);\n        }, Math.floor(0));\n      }\n    });\n  }\n\n  /**\n   * @inheritDoc\n   */\n  put(\n    pathString: string,\n    data: any,\n    onComplete?: (a: string, b: string) => void,\n    hash?: string\n  ) {\n    this.putInternal('p', pathString, data, onComplete, hash);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  merge(\n    pathString: string,\n    data: any,\n    onComplete: (a: string, b: string | null) => void,\n    hash?: string\n  ) {\n    this.putInternal('m', pathString, data, onComplete, hash);\n  }\n\n  putInternal(\n    action: string,\n    pathString: string,\n    data: any,\n    onComplete: (a: string, b: string | null) => void,\n    hash?: string\n  ) {\n    const request: { [k: string]: any } = {\n      /*path*/ p: pathString,\n      /*data*/ d: data\n    };\n\n    if (hash !== undefined) request[/*hash*/ 'h'] = hash;\n\n    // TODO: Only keep track of the most recent put for a given path?\n    this.outstandingPuts_.push({\n      action,\n      request,\n      onComplete\n    });\n\n    this.outstandingPutCount_++;\n    const index = this.outstandingPuts_.length - 1;\n\n    if (this.connected_) {\n      this.sendPut_(index);\n    } else {\n      this.log_('Buffering put: ' + pathString);\n    }\n  }\n\n  private sendPut_(index: number) {\n    const action = this.outstandingPuts_[index].action;\n    const request = this.outstandingPuts_[index].request;\n    const onComplete = this.outstandingPuts_[index].onComplete;\n    this.outstandingPuts_[index].queued = this.connected_;\n\n    this.sendRequest(action, request, (message: { [k: string]: any }) => {\n      this.log_(action + ' response', message);\n\n      delete this.outstandingPuts_[index];\n      this.outstandingPutCount_--;\n\n      // Clean up array occasionally.\n      if (this.outstandingPutCount_ === 0) {\n        this.outstandingPuts_ = [];\n      }\n\n      if (onComplete)\n        onComplete(message[/*status*/ 's'], message[/* data */ 'd']);\n    });\n  }\n\n  /**\n   * @inheritDoc\n   */\n  reportStats(stats: { [k: string]: any }) {\n    // If we're not connected, we just drop the stats.\n    if (this.connected_) {\n      const request = { /*counters*/ c: stats };\n      this.log_('reportStats', request);\n\n      this.sendRequest(/*stats*/ 's', request, result => {\n        const status = result[/*status*/ 's'];\n        if (status !== 'ok') {\n          const errorReason = result[/* data */ 'd'];\n          this.log_('reportStats', 'Error sending stats: ' + errorReason);\n        }\n      });\n    }\n  }\n\n  private onDataMessage_(message: { [k: string]: any }) {\n    if ('r' in message) {\n      // this is a response\n      this.log_('from server: ' + stringify(message));\n      const reqNum = message['r'];\n      const onResponse = this.requestCBHash_[reqNum];\n      if (onResponse) {\n        delete this.requestCBHash_[reqNum];\n        onResponse(message[/*body*/ 'b']);\n      }\n    } else if ('error' in message) {\n      throw 'A server-side error has occurred: ' + message['error'];\n    } else if ('a' in message) {\n      // a and b are action and body, respectively\n      this.onDataPush_(message['a'], message['b']);\n    }\n  }\n\n  private onDataPush_(action: string, body: { [k: string]: any }) {\n    this.log_('handleServerMessage', action, body);\n    if (action === 'd')\n      this.onDataUpdate_(\n        body[/*path*/ 'p'],\n        body[/*data*/ 'd'],\n        /*isMerge*/ false,\n        body['t']\n      );\n    else if (action === 'm')\n      this.onDataUpdate_(\n        body[/*path*/ 'p'],\n        body[/*data*/ 'd'],\n        /*isMerge=*/ true,\n        body['t']\n      );\n    else if (action === 'c')\n      this.onListenRevoked_(body[/*path*/ 'p'], body[/*query*/ 'q']);\n    else if (action === 'ac')\n      this.onAuthRevoked_(\n        body[/*status code*/ 's'],\n        body[/* explanation */ 'd']\n      );\n    else if (action === 'sd') this.onSecurityDebugPacket_(body);\n    else\n      error(\n        'Unrecognized action received from server: ' +\n          stringify(action) +\n          '\\nAre you using the latest client?'\n      );\n  }\n\n  private onReady_(timestamp: number, sessionId: string) {\n    this.log_('connection ready');\n    this.connected_ = true;\n    this.lastConnectionEstablishedTime_ = new Date().getTime();\n    this.handleTimestamp_(timestamp);\n    this.lastSessionId = sessionId;\n    if (this.firstConnection_) {\n      this.sendConnectStats_();\n    }\n    this.restoreState_();\n    this.firstConnection_ = false;\n    this.onConnectStatus_(true);\n  }\n\n  private scheduleConnect_(timeout: number) {\n    assert(\n      !this.realtime_,\n      \"Scheduling a connect when we're already connected/ing?\"\n    );\n\n    if (this.establishConnectionTimer_) {\n      clearTimeout(this.establishConnectionTimer_);\n    }\n\n    // NOTE: Even when timeout is 0, it's important to do a setTimeout to work around an infuriating \"Security Error\" in\n    // Firefox when trying to write to our long-polling iframe in some scenarios (e.g. Forge or our unit tests).\n\n    this.establishConnectionTimer_ = setTimeout(() => {\n      this.establishConnectionTimer_ = null;\n      this.establishConnection_();\n    }, Math.floor(timeout)) as any;\n  }\n\n  private onVisible_(visible: boolean) {\n    // NOTE: Tabbing away and back to a window will defeat our reconnect backoff, but I think that's fine.\n    if (\n      visible &&\n      !this.visible_ &&\n      this.reconnectDelay_ === this.maxReconnectDelay_\n    ) {\n      this.log_('Window became visible.  Reducing delay.');\n      this.reconnectDelay_ = RECONNECT_MIN_DELAY;\n\n      if (!this.realtime_) {\n        this.scheduleConnect_(0);\n      }\n    }\n    this.visible_ = visible;\n  }\n\n  private onOnline_(online: boolean) {\n    if (online) {\n      this.log_('Browser went online.');\n      this.reconnectDelay_ = RECONNECT_MIN_DELAY;\n      if (!this.realtime_) {\n        this.scheduleConnect_(0);\n      }\n    } else {\n      this.log_('Browser went offline.  Killing connection.');\n      if (this.realtime_) {\n        this.realtime_.close();\n      }\n    }\n  }\n\n  private onRealtimeDisconnect_() {\n    this.log_('data client disconnected');\n    this.connected_ = false;\n    this.realtime_ = null;\n\n    // Since we don't know if our sent transactions succeeded or not, we need to cancel them.\n    this.cancelSentTransactions_();\n\n    // Clear out the pending requests.\n    this.requestCBHash_ = {};\n\n    if (this.shouldReconnect_()) {\n      if (!this.visible_) {\n        this.log_(\"Window isn't visible.  Delaying reconnect.\");\n        this.reconnectDelay_ = this.maxReconnectDelay_;\n        this.lastConnectionAttemptTime_ = new Date().getTime();\n      } else if (this.lastConnectionEstablishedTime_) {\n        // If we've been connected long enough, reset reconnect delay to minimum.\n        const timeSinceLastConnectSucceeded =\n          new Date().getTime() - this.lastConnectionEstablishedTime_;\n        if (timeSinceLastConnectSucceeded > RECONNECT_DELAY_RESET_TIMEOUT)\n          this.reconnectDelay_ = RECONNECT_MIN_DELAY;\n        this.lastConnectionEstablishedTime_ = null;\n      }\n\n      const timeSinceLastConnectAttempt =\n        new Date().getTime() - this.lastConnectionAttemptTime_;\n      let reconnectDelay = Math.max(\n        0,\n        this.reconnectDelay_ - timeSinceLastConnectAttempt\n      );\n      reconnectDelay = Math.random() * reconnectDelay;\n\n      this.log_('Trying to reconnect in ' + reconnectDelay + 'ms');\n      this.scheduleConnect_(reconnectDelay);\n\n      // Adjust reconnect delay for next time.\n      this.reconnectDelay_ = Math.min(\n        this.maxReconnectDelay_,\n        this.reconnectDelay_ * RECONNECT_DELAY_MULTIPLIER\n      );\n    }\n    this.onConnectStatus_(false);\n  }\n\n  private establishConnection_() {\n    if (this.shouldReconnect_()) {\n      this.log_('Making a connection attempt');\n      this.lastConnectionAttemptTime_ = new Date().getTime();\n      this.lastConnectionEstablishedTime_ = null;\n      const onDataMessage = this.onDataMessage_.bind(this);\n      const onReady = this.onReady_.bind(this);\n      const onDisconnect = this.onRealtimeDisconnect_.bind(this);\n      const connId = this.id + ':' + PersistentConnection.nextConnectionId_++;\n      const self = this;\n      const lastSessionId = this.lastSessionId;\n      let canceled = false;\n      let connection: Connection | null = null;\n      const closeFn = function() {\n        if (connection) {\n          connection.close();\n        } else {\n          canceled = true;\n          onDisconnect();\n        }\n      };\n      const sendRequestFn = function(msg: Object) {\n        assert(\n          connection,\n          \"sendRequest call when we're not connected not allowed.\"\n        );\n        connection.sendRequest(msg);\n      };\n\n      this.realtime_ = {\n        close: closeFn,\n        sendRequest: sendRequestFn\n      };\n\n      const forceRefresh = this.forceTokenRefresh_;\n      this.forceTokenRefresh_ = false;\n\n      // First fetch auth token, and establish connection after fetching the token was successful\n      this.authTokenProvider_\n        .getToken(forceRefresh)\n        .then(function(result) {\n          if (!canceled) {\n            log('getToken() completed. Creating connection.');\n            self.authToken_ = result && result.accessToken;\n            connection = new Connection(\n              connId,\n              self.repoInfo_,\n              onDataMessage,\n              onReady,\n              onDisconnect,\n              /* onKill= */ function(reason) {\n                warn(reason + ' (' + self.repoInfo_.toString() + ')');\n                self.interrupt(SERVER_KILL_INTERRUPT_REASON);\n              },\n              lastSessionId\n            );\n          } else {\n            log('getToken() completed but was canceled');\n          }\n        })\n        .then(null, function(error) {\n          self.log_('Failed to get token: ' + error);\n          if (!canceled) {\n            if (CONSTANTS.NODE_ADMIN) {\n              // This may be a critical error for the Admin Node.js SDK, so log a warning.\n              // But getToken() may also just have temporarily failed, so we still want to\n              // continue retrying.\n              warn(error);\n            }\n            closeFn();\n          }\n        });\n    }\n  }\n\n  interrupt(reason: string) {\n    log('Interrupting connection for reason: ' + reason);\n    this.interruptReasons_[reason] = true;\n    if (this.realtime_) {\n      this.realtime_.close();\n    } else {\n      if (this.establishConnectionTimer_) {\n        clearTimeout(this.establishConnectionTimer_);\n        this.establishConnectionTimer_ = null;\n      }\n      if (this.connected_) {\n        this.onRealtimeDisconnect_();\n      }\n    }\n  }\n\n  resume(reason: string) {\n    log('Resuming connection for reason: ' + reason);\n    delete this.interruptReasons_[reason];\n    if (isEmpty(this.interruptReasons_)) {\n      this.reconnectDelay_ = RECONNECT_MIN_DELAY;\n      if (!this.realtime_) {\n        this.scheduleConnect_(0);\n      }\n    }\n  }\n\n  private handleTimestamp_(timestamp: number) {\n    const delta = timestamp - new Date().getTime();\n    this.onServerInfoUpdate_({ serverTimeOffset: delta });\n  }\n\n  private cancelSentTransactions_() {\n    for (let i = 0; i < this.outstandingPuts_.length; i++) {\n      const put = this.outstandingPuts_[i];\n      if (put && /*hash*/ 'h' in put.request && put.queued) {\n        if (put.onComplete) put.onComplete('disconnect');\n\n        delete this.outstandingPuts_[i];\n        this.outstandingPutCount_--;\n      }\n    }\n\n    // Clean up array occasionally.\n    if (this.outstandingPutCount_ === 0) this.outstandingPuts_ = [];\n  }\n\n  private onListenRevoked_(pathString: string, query?: any[]) {\n    // Remove the listen and manufacture a \"permission_denied\" error for the failed listen.\n    let queryId;\n    if (!query) {\n      queryId = 'default';\n    } else {\n      queryId = query.map(q => ObjectToUniqueKey(q)).join('$');\n    }\n    const listen = this.removeListen_(pathString, queryId);\n    if (listen && listen.onComplete) listen.onComplete('permission_denied');\n  }\n\n  private removeListen_(pathString: string, queryId: string): ListenSpec {\n    const normalizedPathString = new Path(pathString).toString(); // normalize path.\n    let listen;\n    if (this.listens.has(normalizedPathString)) {\n      const map = this.listens.get(normalizedPathString)!;\n      listen = map.get(queryId);\n      map.delete(queryId);\n      if (map.size === 0) {\n        this.listens.delete(normalizedPathString);\n      }\n    } else {\n      // all listens for this path has already been removed\n      listen = undefined;\n    }\n    return listen;\n  }\n\n  private onAuthRevoked_(statusCode: string, explanation: string) {\n    log('Auth token revoked: ' + statusCode + '/' + explanation);\n    this.authToken_ = null;\n    this.forceTokenRefresh_ = true;\n    this.realtime_.close();\n    if (statusCode === 'invalid_token' || statusCode === 'permission_denied') {\n      // We'll wait a couple times before logging the warning / increasing the\n      // retry period since oauth tokens will report as \"invalid\" if they're\n      // just expired. Plus there may be transient issues that resolve themselves.\n      this.invalidAuthTokenCount_++;\n      if (this.invalidAuthTokenCount_ >= INVALID_AUTH_TOKEN_THRESHOLD) {\n        // Set a long reconnect delay because recovery is unlikely\n        this.reconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;\n\n        // Notify the auth token provider that the token is invalid, which will log\n        // a warning\n        this.authTokenProvider_.notifyForInvalidToken();\n      }\n    }\n  }\n\n  private onSecurityDebugPacket_(body: { [k: string]: any }) {\n    if (this.securityDebugCallback_) {\n      this.securityDebugCallback_(body);\n    } else {\n      if ('msg' in body) {\n        console.log('FIREBASE: ' + body['msg'].replace('\\n', '\\nFIREBASE: '));\n      }\n    }\n  }\n\n  private restoreState_() {\n    //Re-authenticate ourselves if we have a credential stored.\n    this.tryAuth();\n\n    // Puts depend on having received the corresponding data update from the server before they complete, so we must\n    // make sure to send listens before puts.\n    for (const queries of this.listens.values()) {\n      for (const listenSpec of queries.values()) {\n        this.sendListen_(listenSpec);\n      }\n    }\n\n    for (let i = 0; i < this.outstandingPuts_.length; i++) {\n      if (this.outstandingPuts_[i]) this.sendPut_(i);\n    }\n\n    while (this.onDisconnectRequestQueue_.length) {\n      const request = this.onDisconnectRequestQueue_.shift();\n      this.sendOnDisconnect_(\n        request.action,\n        request.pathString,\n        request.data,\n        request.onComplete\n      );\n    }\n  }\n\n  /**\n   * Sends client stats for first connection\n   */\n  private sendConnectStats_() {\n    const stats: { [k: string]: number } = {};\n\n    let clientName = 'js';\n    if (CONSTANTS.NODE_ADMIN) {\n      clientName = 'admin_node';\n    } else if (CONSTANTS.NODE_CLIENT) {\n      clientName = 'node';\n    }\n\n    stats['sdk.' + clientName + '.' + SDK_VERSION.replace(/\\./g, '-')] = 1;\n\n    if (isMobileCordova()) {\n      stats['framework.cordova'] = 1;\n    } else if (isReactNative()) {\n      stats['framework.reactnative'] = 1;\n    }\n    this.reportStats(stats);\n  }\n\n  private shouldReconnect_(): boolean {\n    const online = OnlineMonitor.getInstance().currentlyOnline();\n    return isEmpty(this.interruptReasons_) && online;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { logWrapper, warn } from './util/util';\nimport { jsonEval } from '@firebase/util';\nimport { safeGet } from '@firebase/util';\nimport { querystring } from '@firebase/util';\nimport { ServerActions } from './ServerActions';\nimport { RepoInfo } from './RepoInfo';\nimport { AuthTokenProvider } from './AuthTokenProvider';\nimport { Query } from '../api/Query';\n\n/**\n * An implementation of ServerActions that communicates with the server via REST requests.\n * This is mostly useful for compatibility with crawlers, where we don't want to spin up a full\n * persistent connection (using WebSockets or long-polling)\n */\nexport class ReadonlyRestClient extends ServerActions {\n  reportStats(stats: { [k: string]: any }): void {\n    throw new Error('Method not implemented.');\n  }\n\n  /** @private {function(...[*])} */\n  private log_: (...args: any[]) => void = logWrapper('p:rest:');\n\n  /**\n   * We don't actually need to track listens, except to prevent us calling an onComplete for a listen\n   * that's been removed. :-/\n   *\n   * @private {!Object.<string, !Object>}\n   */\n  private listens_: { [k: string]: Object } = {};\n\n  /**\n   * @param {!Query} query\n   * @param {?number=} tag\n   * @return {string}\n   * @private\n   */\n  static getListenId_(query: Query, tag?: number | null): string {\n    if (tag !== undefined) {\n      return 'tag$' + tag;\n    } else {\n      assert(\n        query.getQueryParams().isDefault(),\n        \"should have a tag if it's not a default query.\"\n      );\n      return query.path.toString();\n    }\n  }\n\n  /**\n   * @param {!RepoInfo} repoInfo_ Data about the namespace we are connecting to\n   * @param {function(string, *, boolean, ?number)} onDataUpdate_ A callback for new data from the server\n   * @param {AuthTokenProvider} authTokenProvider_\n   * @implements {ServerActions}\n   */\n  constructor(\n    private repoInfo_: RepoInfo,\n    private onDataUpdate_: (\n      a: string,\n      b: any,\n      c: boolean,\n      d: number | null\n    ) => void,\n    private authTokenProvider_: AuthTokenProvider\n  ) {\n    super();\n  }\n\n  /** @inheritDoc */\n  listen(\n    query: Query,\n    currentHashFn: () => string,\n    tag: number | null,\n    onComplete: (a: string, b: any) => void\n  ) {\n    const pathString = query.path.toString();\n    this.log_(\n      'Listen called for ' + pathString + ' ' + query.queryIdentifier()\n    );\n\n    // Mark this listener so we can tell if it's removed.\n    const listenId = ReadonlyRestClient.getListenId_(query, tag);\n    const thisListen = {};\n    this.listens_[listenId] = thisListen;\n\n    const queryStringParameters = query\n      .getQueryParams()\n      .toRestQueryStringParameters();\n\n    this.restRequest_(\n      pathString + '.json',\n      queryStringParameters,\n      (error, result) => {\n        let data = result;\n\n        if (error === 404) {\n          data = null;\n          error = null;\n        }\n\n        if (error === null) {\n          this.onDataUpdate_(pathString, data, /*isMerge=*/ false, tag);\n        }\n\n        if (safeGet(this.listens_, listenId) === thisListen) {\n          let status;\n          if (!error) {\n            status = 'ok';\n          } else if (error == 401) {\n            status = 'permission_denied';\n          } else {\n            status = 'rest_error:' + error;\n          }\n\n          onComplete(status, null);\n        }\n      }\n    );\n  }\n\n  /** @inheritDoc */\n  unlisten(query: Query, tag: number | null) {\n    const listenId = ReadonlyRestClient.getListenId_(query, tag);\n    delete this.listens_[listenId];\n  }\n\n  /** @inheritDoc */\n  refreshAuthToken(token: string) {\n    // no-op since we just always call getToken.\n  }\n\n  /**\n   * Performs a REST request to the given path, with the provided query string parameters,\n   * and any auth credentials we have.\n   *\n   * @param {!string} pathString\n   * @param {!Object.<string, *>} queryStringParameters\n   * @param {?function(?number, *=)} callback\n   * @private\n   */\n  private restRequest_(\n    pathString: string,\n    queryStringParameters: { [k: string]: any } = {},\n    callback: ((a: number | null, b?: any) => void) | null\n  ) {\n    queryStringParameters['format'] = 'export';\n\n    this.authTokenProvider_\n      .getToken(/*forceRefresh=*/ false)\n      .then(authTokenData => {\n        const authToken = authTokenData && authTokenData.accessToken;\n        if (authToken) {\n          queryStringParameters['auth'] = authToken;\n        }\n\n        const url =\n          (this.repoInfo_.secure ? 'https://' : 'http://') +\n          this.repoInfo_.host +\n          pathString +\n          '?' +\n          'ns=' +\n          this.repoInfo_.namespace +\n          querystring(queryStringParameters);\n\n        this.log_('Sending REST request for ' + url);\n        const xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = () => {\n          if (callback && xhr.readyState === 4) {\n            this.log_(\n              'REST Response for ' + url + ' received. status:',\n              xhr.status,\n              'response:',\n              xhr.responseText\n            );\n            let res = null;\n            if (xhr.status >= 200 && xhr.status < 300) {\n              try {\n                res = jsonEval(xhr.responseText);\n              } catch (e) {\n                warn(\n                  'Failed to parse JSON response for ' +\n                    url +\n                    ': ' +\n                    xhr.responseText\n                );\n              }\n              callback(null, res);\n            } else {\n              // 401 and 404 are expected.\n              if (xhr.status !== 401 && xhr.status !== 404) {\n                warn(\n                  'Got unsuccessful REST response for ' +\n                    url +\n                    ' Status: ' +\n                    xhr.status\n                );\n              }\n              callback(xhr.status);\n            }\n            callback = null;\n          }\n        };\n\n        xhr.open('GET', url, /*asynchronous=*/ true);\n        xhr.send();\n      });\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  generateWithValues,\n  resolveDeferredValueSnapshot,\n  resolveDeferredValueTree\n} from './util/ServerValues';\nimport { nodeFromJSON } from './snap/nodeFromJSON';\nimport { Path } from './util/Path';\nimport { SparseSnapshotTree } from './SparseSnapshotTree';\nimport { SyncTree } from './SyncTree';\nimport { SnapshotHolder } from './SnapshotHolder';\nimport { stringify } from '@firebase/util';\nimport { beingCrawled, each, exceptionGuard, warn, log } from './util/util';\nimport { map, isEmpty } from '@firebase/util';\nimport { AuthTokenProvider } from './AuthTokenProvider';\nimport { StatsManager } from './stats/StatsManager';\nimport { StatsReporter } from './stats/StatsReporter';\nimport { StatsListener } from './stats/StatsListener';\nimport { EventQueue } from './view/EventQueue';\nimport { PersistentConnection } from './PersistentConnection';\nimport { ReadonlyRestClient } from './ReadonlyRestClient';\nimport { FirebaseApp } from '@firebase/app-types';\nimport { RepoInfo } from './RepoInfo';\nimport { Database } from '../api/Database';\nimport { ServerActions } from './ServerActions';\nimport { Query } from '../api/Query';\nimport { EventRegistration } from './view/EventRegistration';\nimport { StatsCollection } from './stats/StatsCollection';\nimport { Event } from './view/Event';\nimport { Node } from './snap/Node';\nimport { FirebaseAuthInternalName } from '@firebase/auth-interop-types';\nimport { Provider } from '@firebase/component';\n\nconst INTERRUPT_REASON = 'repo_interrupt';\n\n/**\n * A connection to a single data repository.\n */\nexport class Repo {\n  dataUpdateCount = 0;\n  private infoSyncTree_: SyncTree;\n  private serverSyncTree_: SyncTree;\n\n  private stats_: StatsCollection;\n  private statsListener_: StatsListener | null = null;\n  private eventQueue_ = new EventQueue();\n  private nextWriteId_ = 1;\n  private server_: ServerActions;\n  private statsReporter_: StatsReporter;\n  private transactions_init_: () => void;\n  private infoData_: SnapshotHolder;\n  private abortTransactions_: (path: Path) => Path;\n  private rerunTransactions_: (changedPath: Path) => Path;\n  private interceptServerDataCallback_:\n    | ((a: string, b: any) => void)\n    | null = null;\n  private __database: Database;\n\n  /** A list of data pieces and paths to be set when this client disconnects. */\n  private onDisconnect_ = new SparseSnapshotTree();\n\n  // TODO: This should be @private but it's used by test_access.js and internal.js\n  persistentConnection_: PersistentConnection | null = null;\n\n  constructor(\n    public repoInfo_: RepoInfo,\n    forceRestClient: boolean,\n    public app: FirebaseApp,\n    authProvider: Provider<FirebaseAuthInternalName>\n  ) {\n    const authTokenProvider = new AuthTokenProvider(app, authProvider);\n\n    this.stats_ = StatsManager.getCollection(repoInfo_);\n\n    if (forceRestClient || beingCrawled()) {\n      this.server_ = new ReadonlyRestClient(\n        this.repoInfo_,\n        this.onDataUpdate_.bind(this),\n        authTokenProvider\n      );\n\n      // Minor hack: Fire onConnect immediately, since there's no actual connection.\n      setTimeout(this.onConnectStatus_.bind(this, true), 0);\n    } else {\n      const authOverride = app.options['databaseAuthVariableOverride'];\n      // Validate authOverride\n      if (typeof authOverride !== 'undefined' && authOverride !== null) {\n        if (typeof authOverride !== 'object') {\n          throw new Error(\n            'Only objects are supported for option databaseAuthVariableOverride'\n          );\n        }\n        try {\n          stringify(authOverride);\n        } catch (e) {\n          throw new Error('Invalid authOverride provided: ' + e);\n        }\n      }\n\n      this.persistentConnection_ = new PersistentConnection(\n        this.repoInfo_,\n        this.onDataUpdate_.bind(this),\n        this.onConnectStatus_.bind(this),\n        this.onServerInfoUpdate_.bind(this),\n        authTokenProvider,\n        authOverride\n      );\n\n      this.server_ = this.persistentConnection_;\n    }\n\n    authTokenProvider.addTokenChangeListener(token => {\n      this.server_.refreshAuthToken(token);\n    });\n\n    // In the case of multiple Repos for the same repoInfo (i.e. there are multiple Firebase.Contexts being used),\n    // we only want to create one StatsReporter.  As such, we'll report stats over the first Repo created.\n    this.statsReporter_ = StatsManager.getOrCreateReporter(\n      repoInfo_,\n      () => new StatsReporter(this.stats_, this.server_)\n    );\n\n    this.transactions_init_();\n\n    // Used for .info.\n    this.infoData_ = new SnapshotHolder();\n    this.infoSyncTree_ = new SyncTree({\n      startListening: (query, tag, currentHashFn, onComplete) => {\n        let infoEvents: Event[] = [];\n        const node = this.infoData_.getNode(query.path);\n        // This is possibly a hack, but we have different semantics for .info endpoints. We don't raise null events\n        // on initial data...\n        if (!node.isEmpty()) {\n          infoEvents = this.infoSyncTree_.applyServerOverwrite(\n            query.path,\n            node\n          );\n          setTimeout(() => {\n            onComplete('ok');\n          }, 0);\n        }\n        return infoEvents;\n      },\n      stopListening: () => {}\n    });\n    this.updateInfo_('connected', false);\n\n    this.serverSyncTree_ = new SyncTree({\n      startListening: (query, tag, currentHashFn, onComplete) => {\n        this.server_.listen(query, currentHashFn, tag, (status, data) => {\n          const events = onComplete(status, data);\n          this.eventQueue_.raiseEventsForChangedPath(query.path, events);\n        });\n        // No synchronous events for network-backed sync trees\n        return [];\n      },\n      stopListening: (query, tag) => {\n        this.server_.unlisten(query, tag);\n      }\n    });\n  }\n\n  /**\n   * @return The URL corresponding to the root of this Firebase.\n   */\n  toString(): string {\n    return (\n      (this.repoInfo_.secure ? 'https://' : 'http://') + this.repoInfo_.host\n    );\n  }\n\n  /**\n   * @return The namespace represented by the repo.\n   */\n  name(): string {\n    return this.repoInfo_.namespace;\n  }\n\n  /**\n   * @return The time in milliseconds, taking the server offset into account if we have one.\n   */\n  serverTime(): number {\n    const offsetNode = this.infoData_.getNode(\n      new Path('.info/serverTimeOffset')\n    );\n    const offset = (offsetNode.val() as number) || 0;\n    return new Date().getTime() + offset;\n  }\n\n  /**\n   * Generate ServerValues using some variables from the repo object.\n   */\n  generateServerValues(): Object {\n    return generateWithValues({\n      timestamp: this.serverTime()\n    });\n  }\n\n  /**\n   * Called by realtime when we get new messages from the server.\n   */\n  private onDataUpdate_(\n    pathString: string,\n    data: any,\n    isMerge: boolean,\n    tag: number | null\n  ) {\n    // For testing.\n    this.dataUpdateCount++;\n    const path = new Path(pathString);\n    data = this.interceptServerDataCallback_\n      ? this.interceptServerDataCallback_(pathString, data)\n      : data;\n    let events = [];\n    if (tag) {\n      if (isMerge) {\n        const taggedChildren = map(data as { [k: string]: any }, (raw: any) =>\n          nodeFromJSON(raw)\n        );\n        events = this.serverSyncTree_.applyTaggedQueryMerge(\n          path,\n          taggedChildren,\n          tag\n        );\n      } else {\n        const taggedSnap = nodeFromJSON(data);\n        events = this.serverSyncTree_.applyTaggedQueryOverwrite(\n          path,\n          taggedSnap,\n          tag\n        );\n      }\n    } else if (isMerge) {\n      const changedChildren = map(data as { [k: string]: any }, (raw: any) =>\n        nodeFromJSON(raw)\n      );\n      events = this.serverSyncTree_.applyServerMerge(path, changedChildren);\n    } else {\n      const snap = nodeFromJSON(data);\n      events = this.serverSyncTree_.applyServerOverwrite(path, snap);\n    }\n    let affectedPath = path;\n    if (events.length > 0) {\n      // Since we have a listener outstanding for each transaction, receiving any events\n      // is a proxy for some change having occurred.\n      affectedPath = this.rerunTransactions_(path);\n    }\n    this.eventQueue_.raiseEventsForChangedPath(affectedPath, events);\n  }\n\n  // TODO: This should be @private but it's used by test_access.js and internal.js\n  interceptServerData_(callback: ((a: string, b: any) => any) | null) {\n    this.interceptServerDataCallback_ = callback;\n  }\n\n  private onConnectStatus_(connectStatus: boolean) {\n    this.updateInfo_('connected', connectStatus);\n    if (connectStatus === false) {\n      this.runOnDisconnectEvents_();\n    }\n  }\n\n  private onServerInfoUpdate_(updates: Object) {\n    each(updates, (key: string, value: any) => {\n      this.updateInfo_(key, value);\n    });\n  }\n\n  private updateInfo_(pathString: string, value: any) {\n    const path = new Path('/.info/' + pathString);\n    const newNode = nodeFromJSON(value);\n    this.infoData_.updateSnapshot(path, newNode);\n    const events = this.infoSyncTree_.applyServerOverwrite(path, newNode);\n    this.eventQueue_.raiseEventsForChangedPath(path, events);\n  }\n\n  private getNextWriteId_(): number {\n    return this.nextWriteId_++;\n  }\n\n  setWithPriority(\n    path: Path,\n    newVal: any,\n    newPriority: number | string | null,\n    onComplete: ((status: Error | null, errorReason?: string) => void) | null\n  ) {\n    this.log_('set', {\n      path: path.toString(),\n      value: newVal,\n      priority: newPriority\n    });\n\n    // TODO: Optimize this behavior to either (a) store flag to skip resolving where possible and / or\n    // (b) store unresolved paths on JSON parse\n    const serverValues = this.generateServerValues();\n    const newNodeUnresolved = nodeFromJSON(newVal, newPriority);\n    const existing = this.serverSyncTree_.calcCompleteEventCache(path);\n    const newNode = resolveDeferredValueSnapshot(\n      newNodeUnresolved,\n      existing,\n      serverValues\n    );\n\n    const writeId = this.getNextWriteId_();\n    const events = this.serverSyncTree_.applyUserOverwrite(\n      path,\n      newNode,\n      writeId,\n      true\n    );\n    this.eventQueue_.queueEvents(events);\n    this.server_.put(\n      path.toString(),\n      newNodeUnresolved.val(/*export=*/ true),\n      (status, errorReason) => {\n        const success = status === 'ok';\n        if (!success) {\n          warn('set at ' + path + ' failed: ' + status);\n        }\n\n        const clearEvents = this.serverSyncTree_.ackUserWrite(\n          writeId,\n          !success\n        );\n        this.eventQueue_.raiseEventsForChangedPath(path, clearEvents);\n        this.callOnCompleteCallback(onComplete, status, errorReason);\n      }\n    );\n    const affectedPath = this.abortTransactions_(path);\n    this.rerunTransactions_(affectedPath);\n    // We queued the events above, so just flush the queue here\n    this.eventQueue_.raiseEventsForChangedPath(affectedPath, []);\n  }\n\n  update(\n    path: Path,\n    childrenToMerge: { [k: string]: any },\n    onComplete: ((status: Error | null, errorReason?: string) => void) | null\n  ) {\n    this.log_('update', { path: path.toString(), value: childrenToMerge });\n\n    // Start with our existing data and merge each child into it.\n    let empty = true;\n    const serverValues = this.generateServerValues();\n    const changedChildren: { [k: string]: Node } = {};\n    each(childrenToMerge, (changedKey: string, changedValue: any) => {\n      empty = false;\n      const newNodeUnresolved = nodeFromJSON(changedValue);\n      changedChildren[changedKey] = resolveDeferredValueSnapshot(\n        newNodeUnresolved,\n        this.serverSyncTree_.calcCompleteEventCache(path),\n        serverValues\n      );\n    });\n\n    if (!empty) {\n      const writeId = this.getNextWriteId_();\n      const events = this.serverSyncTree_.applyUserMerge(\n        path,\n        changedChildren,\n        writeId\n      );\n      this.eventQueue_.queueEvents(events);\n      this.server_.merge(\n        path.toString(),\n        childrenToMerge,\n        (status, errorReason) => {\n          const success = status === 'ok';\n          if (!success) {\n            warn('update at ' + path + ' failed: ' + status);\n          }\n\n          const clearEvents = this.serverSyncTree_.ackUserWrite(\n            writeId,\n            !success\n          );\n          const affectedPath =\n            clearEvents.length > 0 ? this.rerunTransactions_(path) : path;\n          this.eventQueue_.raiseEventsForChangedPath(affectedPath, clearEvents);\n          this.callOnCompleteCallback(onComplete, status, errorReason);\n        }\n      );\n\n      each(childrenToMerge, (changedPath: string) => {\n        const affectedPath = this.abortTransactions_(path.child(changedPath));\n        this.rerunTransactions_(affectedPath);\n      });\n\n      // We queued the events above, so just flush the queue here\n      this.eventQueue_.raiseEventsForChangedPath(path, []);\n    } else {\n      log(\"update() called with empty data.  Don't do anything.\");\n      this.callOnCompleteCallback(onComplete, 'ok');\n    }\n  }\n\n  /**\n   * Applies all of the changes stored up in the onDisconnect_ tree.\n   */\n  private runOnDisconnectEvents_() {\n    this.log_('onDisconnectEvents');\n\n    const serverValues = this.generateServerValues();\n    const resolvedOnDisconnectTree = resolveDeferredValueTree(\n      this.onDisconnect_,\n      this.serverSyncTree_,\n      serverValues\n    );\n    let events: Event[] = [];\n\n    resolvedOnDisconnectTree.forEachTree(Path.Empty, (path, snap) => {\n      events = events.concat(\n        this.serverSyncTree_.applyServerOverwrite(path, snap)\n      );\n      const affectedPath = this.abortTransactions_(path);\n      this.rerunTransactions_(affectedPath);\n    });\n\n    this.onDisconnect_ = new SparseSnapshotTree();\n    this.eventQueue_.raiseEventsForChangedPath(Path.Empty, events);\n  }\n\n  onDisconnectCancel(\n    path: Path,\n    onComplete: ((status: Error | null, errorReason?: string) => void) | null\n  ) {\n    this.server_.onDisconnectCancel(path.toString(), (status, errorReason) => {\n      if (status === 'ok') {\n        this.onDisconnect_.forget(path);\n      }\n      this.callOnCompleteCallback(onComplete, status, errorReason);\n    });\n  }\n\n  onDisconnectSet(\n    path: Path,\n    value: any,\n    onComplete: ((status: Error | null, errorReason?: string) => void) | null\n  ) {\n    const newNode = nodeFromJSON(value);\n    this.server_.onDisconnectPut(\n      path.toString(),\n      newNode.val(/*export=*/ true),\n      (status, errorReason) => {\n        if (status === 'ok') {\n          this.onDisconnect_.remember(path, newNode);\n        }\n        this.callOnCompleteCallback(onComplete, status, errorReason);\n      }\n    );\n  }\n\n  onDisconnectSetWithPriority(\n    path: Path,\n    value: any,\n    priority: any,\n    onComplete: ((status: Error | null, errorReason?: string) => void) | null\n  ) {\n    const newNode = nodeFromJSON(value, priority);\n    this.server_.onDisconnectPut(\n      path.toString(),\n      newNode.val(/*export=*/ true),\n      (status, errorReason) => {\n        if (status === 'ok') {\n          this.onDisconnect_.remember(path, newNode);\n        }\n        this.callOnCompleteCallback(onComplete, status, errorReason);\n      }\n    );\n  }\n\n  onDisconnectUpdate(\n    path: Path,\n    childrenToMerge: { [k: string]: any },\n    onComplete: ((status: Error | null, errorReason?: string) => void) | null\n  ) {\n    if (isEmpty(childrenToMerge)) {\n      log(\n        \"onDisconnect().update() called with empty data.  Don't do anything.\"\n      );\n      this.callOnCompleteCallback(onComplete, 'ok');\n      return;\n    }\n\n    this.server_.onDisconnectMerge(\n      path.toString(),\n      childrenToMerge,\n      (status, errorReason) => {\n        if (status === 'ok') {\n          each(childrenToMerge, (childName: string, childNode: any) => {\n            const newChildNode = nodeFromJSON(childNode);\n            this.onDisconnect_.remember(path.child(childName), newChildNode);\n          });\n        }\n        this.callOnCompleteCallback(onComplete, status, errorReason);\n      }\n    );\n  }\n\n  addEventCallbackForQuery(query: Query, eventRegistration: EventRegistration) {\n    let events;\n    if (query.path.getFront() === '.info') {\n      events = this.infoSyncTree_.addEventRegistration(\n        query,\n        eventRegistration\n      );\n    } else {\n      events = this.serverSyncTree_.addEventRegistration(\n        query,\n        eventRegistration\n      );\n    }\n    this.eventQueue_.raiseEventsAtPath(query.path, events);\n  }\n\n  removeEventCallbackForQuery(\n    query: Query,\n    eventRegistration: EventRegistration\n  ) {\n    // These are guaranteed not to raise events, since we're not passing in a cancelError. However, we can future-proof\n    // a little bit by handling the return values anyways.\n    let events;\n    if (query.path.getFront() === '.info') {\n      events = this.infoSyncTree_.removeEventRegistration(\n        query,\n        eventRegistration\n      );\n    } else {\n      events = this.serverSyncTree_.removeEventRegistration(\n        query,\n        eventRegistration\n      );\n    }\n    this.eventQueue_.raiseEventsAtPath(query.path, events);\n  }\n\n  interrupt() {\n    if (this.persistentConnection_) {\n      this.persistentConnection_.interrupt(INTERRUPT_REASON);\n    }\n  }\n\n  resume() {\n    if (this.persistentConnection_) {\n      this.persistentConnection_.resume(INTERRUPT_REASON);\n    }\n  }\n\n  stats(showDelta: boolean = false) {\n    if (typeof console === 'undefined') return;\n\n    let stats: { [k: string]: any };\n    if (showDelta) {\n      if (!this.statsListener_)\n        this.statsListener_ = new StatsListener(this.stats_);\n      stats = this.statsListener_.get();\n    } else {\n      stats = this.stats_.get();\n    }\n\n    const longestName = Object.keys(stats).reduce(\n      (previousValue, currentValue) =>\n        Math.max(currentValue.length, previousValue),\n      0\n    );\n\n    each(stats, (stat: string, value: any) => {\n      let paddedStat = stat;\n      // pad stat names to be the same length (plus 2 extra spaces).\n      for (let i = stat.length; i < longestName + 2; i++) {\n        paddedStat += ' ';\n      }\n      console.log(paddedStat + value);\n    });\n  }\n\n  statsIncrementCounter(metric: string) {\n    this.stats_.incrementCounter(metric);\n    this.statsReporter_.includeStat(metric);\n  }\n\n  private log_(...var_args: any[]) {\n    let prefix = '';\n    if (this.persistentConnection_) {\n      prefix = this.persistentConnection_.id + ':';\n    }\n    log(prefix, ...var_args);\n  }\n\n  callOnCompleteCallback(\n    callback: ((status: Error | null, errorReason?: string) => void) | null,\n    status: string,\n    errorReason?: string | null\n  ) {\n    if (callback) {\n      exceptionGuard(function() {\n        if (status == 'ok') {\n          callback(null);\n        } else {\n          const code = (status || 'error').toUpperCase();\n          let message = code;\n          if (errorReason) message += ': ' + errorReason;\n\n          const error = new Error(message);\n          (error as any).code = code;\n          callback(error);\n        }\n      });\n    }\n  }\n\n  get database(): Database {\n    return this.__database || (this.__database = new Database(this));\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IndexedFilter } from './IndexedFilter';\nimport { PRIORITY_INDEX } from '../../snap/indexes/PriorityIndex';\nimport { NamedNode, Node } from '../../../core/snap/Node';\nimport { ChildrenNode } from '../../snap/ChildrenNode';\nimport { NodeFilter } from './NodeFilter';\nimport { QueryParams } from '../QueryParams';\nimport { Index } from '../../snap/indexes/Index';\nimport { Path } from '../../util/Path';\nimport { CompleteChildSource } from '../CompleteChildSource';\nimport { ChildChangeAccumulator } from '../ChildChangeAccumulator';\n\n/**\n * Filters nodes by range and uses an IndexFilter to track any changes after filtering the node\n *\n * @constructor\n * @implements {NodeFilter}\n */\nexport class RangedFilter implements NodeFilter {\n  /**\n   * @type {!IndexedFilter}\n   * @const\n   * @private\n   */\n  private indexedFilter_: IndexedFilter;\n\n  /**\n   * @const\n   * @type {!Index}\n   * @private\n   */\n  private index_: Index;\n\n  /**\n   * @const\n   * @type {!NamedNode}\n   * @private\n   */\n  private startPost_: NamedNode;\n\n  /**\n   * @const\n   * @type {!NamedNode}\n   * @private\n   */\n  private endPost_: NamedNode;\n\n  /**\n   * @param {!QueryParams} params\n   */\n  constructor(params: QueryParams) {\n    this.indexedFilter_ = new IndexedFilter(params.getIndex());\n    this.index_ = params.getIndex();\n    this.startPost_ = RangedFilter.getStartPost_(params);\n    this.endPost_ = RangedFilter.getEndPost_(params);\n  }\n\n  /**\n   * @return {!NamedNode}\n   */\n  getStartPost(): NamedNode {\n    return this.startPost_;\n  }\n\n  /**\n   * @return {!NamedNode}\n   */\n  getEndPost(): NamedNode {\n    return this.endPost_;\n  }\n\n  /**\n   * @param {!NamedNode} node\n   * @return {boolean}\n   */\n  matches(node: NamedNode): boolean {\n    return (\n      this.index_.compare(this.getStartPost(), node) <= 0 &&\n      this.index_.compare(node, this.getEndPost()) <= 0\n    );\n  }\n\n  /**\n   * @inheritDoc\n   */\n  updateChild(\n    snap: Node,\n    key: string,\n    newChild: Node,\n    affectedPath: Path,\n    source: CompleteChildSource,\n    optChangeAccumulator: ChildChangeAccumulator | null\n  ): Node {\n    if (!this.matches(new NamedNode(key, newChild))) {\n      newChild = ChildrenNode.EMPTY_NODE;\n    }\n    return this.indexedFilter_.updateChild(\n      snap,\n      key,\n      newChild,\n      affectedPath,\n      source,\n      optChangeAccumulator\n    );\n  }\n\n  /**\n   * @inheritDoc\n   */\n  updateFullNode(\n    oldSnap: Node,\n    newSnap: Node,\n    optChangeAccumulator: ChildChangeAccumulator | null\n  ): Node {\n    if (newSnap.isLeafNode()) {\n      // Make sure we have a children node with the correct index, not a leaf node;\n      newSnap = ChildrenNode.EMPTY_NODE;\n    }\n    let filtered = newSnap.withIndex(this.index_);\n    // Don't support priorities on queries\n    filtered = filtered.updatePriority(ChildrenNode.EMPTY_NODE);\n    const self = this;\n    newSnap.forEachChild(PRIORITY_INDEX, function(key, childNode) {\n      if (!self.matches(new NamedNode(key, childNode))) {\n        filtered = filtered.updateImmediateChild(key, ChildrenNode.EMPTY_NODE);\n      }\n    });\n    return this.indexedFilter_.updateFullNode(\n      oldSnap,\n      filtered,\n      optChangeAccumulator\n    );\n  }\n\n  /**\n   * @inheritDoc\n   */\n  updatePriority(oldSnap: Node, newPriority: Node): Node {\n    // Don't support priorities on queries\n    return oldSnap;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  filtersNodes(): boolean {\n    return true;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getIndexedFilter(): IndexedFilter {\n    return this.indexedFilter_;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getIndex(): Index {\n    return this.index_;\n  }\n\n  /**\n   * @param {!QueryParams} params\n   * @return {!NamedNode}\n   * @private\n   */\n  private static getStartPost_(params: QueryParams): NamedNode {\n    if (params.hasStart()) {\n      const startName = params.getIndexStartName();\n      return params.getIndex().makePost(params.getIndexStartValue(), startName);\n    } else {\n      return params.getIndex().minPost();\n    }\n  }\n\n  /**\n   * @param {!QueryParams} params\n   * @return {!NamedNode}\n   * @private\n   */\n  private static getEndPost_(params: QueryParams): NamedNode {\n    if (params.hasEnd()) {\n      const endName = params.getIndexEndName();\n      return params.getIndex().makePost(params.getIndexEndValue(), endName);\n    } else {\n      return params.getIndex().maxPost();\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RangedFilter } from './RangedFilter';\nimport { ChildrenNode } from '../../snap/ChildrenNode';\nimport { Node, NamedNode } from '../../snap/Node';\nimport { assert } from '@firebase/util';\nimport { Change } from '../Change';\nimport { NodeFilter } from './NodeFilter';\nimport { Index } from '../../snap/indexes/Index';\nimport { IndexedFilter } from './IndexedFilter';\nimport { QueryParams } from '../QueryParams';\nimport { Path } from '../../util/Path';\nimport { CompleteChildSource } from '../CompleteChildSource';\nimport { ChildChangeAccumulator } from '../ChildChangeAccumulator';\n\n/**\n * Applies a limit and a range to a node and uses RangedFilter to do the heavy lifting where possible\n *\n * @constructor\n * @implements {NodeFilter}\n */\nexport class LimitedFilter implements NodeFilter {\n  /**\n   * @const\n   * @type {RangedFilter}\n   * @private\n   */\n  private readonly rangedFilter_: RangedFilter;\n\n  /**\n   * @const\n   * @type {!Index}\n   * @private\n   */\n  private readonly index_: Index;\n\n  /**\n   * @const\n   * @type {number}\n   * @private\n   */\n  private readonly limit_: number;\n\n  /**\n   * @const\n   * @type {boolean}\n   * @private\n   */\n  private readonly reverse_: boolean;\n\n  /**\n   * @param {!QueryParams} params\n   */\n  constructor(params: QueryParams) {\n    this.rangedFilter_ = new RangedFilter(params);\n    this.index_ = params.getIndex();\n    this.limit_ = params.getLimit();\n    this.reverse_ = !params.isViewFromLeft();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  updateChild(\n    snap: Node,\n    key: string,\n    newChild: Node,\n    affectedPath: Path,\n    source: CompleteChildSource,\n    optChangeAccumulator: ChildChangeAccumulator | null\n  ): Node {\n    if (!this.rangedFilter_.matches(new NamedNode(key, newChild))) {\n      newChild = ChildrenNode.EMPTY_NODE;\n    }\n    if (snap.getImmediateChild(key).equals(newChild)) {\n      // No change\n      return snap;\n    } else if (snap.numChildren() < this.limit_) {\n      return this.rangedFilter_\n        .getIndexedFilter()\n        .updateChild(\n          snap,\n          key,\n          newChild,\n          affectedPath,\n          source,\n          optChangeAccumulator\n        );\n    } else {\n      return this.fullLimitUpdateChild_(\n        snap,\n        key,\n        newChild,\n        source,\n        optChangeAccumulator\n      );\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  updateFullNode(\n    oldSnap: Node,\n    newSnap: Node,\n    optChangeAccumulator: ChildChangeAccumulator | null\n  ): Node {\n    let filtered;\n    if (newSnap.isLeafNode() || newSnap.isEmpty()) {\n      // Make sure we have a children node with the correct index, not a leaf node;\n      filtered = ChildrenNode.EMPTY_NODE.withIndex(this.index_);\n    } else {\n      if (\n        this.limit_ * 2 < newSnap.numChildren() &&\n        newSnap.isIndexed(this.index_)\n      ) {\n        // Easier to build up a snapshot, since what we're given has more than twice the elements we want\n        filtered = ChildrenNode.EMPTY_NODE.withIndex(this.index_);\n        // anchor to the startPost, endPost, or last element as appropriate\n        let iterator;\n        if (this.reverse_) {\n          iterator = (newSnap as ChildrenNode).getReverseIteratorFrom(\n            this.rangedFilter_.getEndPost(),\n            this.index_\n          );\n        } else {\n          iterator = (newSnap as ChildrenNode).getIteratorFrom(\n            this.rangedFilter_.getStartPost(),\n            this.index_\n          );\n        }\n        let count = 0;\n        while (iterator.hasNext() && count < this.limit_) {\n          const next = iterator.getNext();\n          let inRange;\n          if (this.reverse_) {\n            inRange =\n              this.index_.compare(this.rangedFilter_.getStartPost(), next) <= 0;\n          } else {\n            inRange =\n              this.index_.compare(next, this.rangedFilter_.getEndPost()) <= 0;\n          }\n          if (inRange) {\n            filtered = filtered.updateImmediateChild(next.name, next.node);\n            count++;\n          } else {\n            // if we have reached the end post, we cannot keep adding elemments\n            break;\n          }\n        }\n      } else {\n        // The snap contains less than twice the limit. Faster to delete from the snap than build up a new one\n        filtered = newSnap.withIndex(this.index_);\n        // Don't support priorities on queries\n        filtered = filtered.updatePriority(\n          ChildrenNode.EMPTY_NODE\n        ) as ChildrenNode;\n        let startPost;\n        let endPost;\n        let cmp;\n        let iterator;\n        if (this.reverse_) {\n          iterator = filtered.getReverseIterator(this.index_);\n          startPost = this.rangedFilter_.getEndPost();\n          endPost = this.rangedFilter_.getStartPost();\n          const indexCompare = this.index_.getCompare();\n          cmp = (a: NamedNode, b: NamedNode) => indexCompare(b, a);\n        } else {\n          iterator = filtered.getIterator(this.index_);\n          startPost = this.rangedFilter_.getStartPost();\n          endPost = this.rangedFilter_.getEndPost();\n          cmp = this.index_.getCompare();\n        }\n\n        let count = 0;\n        let foundStartPost = false;\n        while (iterator.hasNext()) {\n          let next = iterator.getNext();\n          if (!foundStartPost && cmp(startPost, next) <= 0) {\n            // start adding\n            foundStartPost = true;\n          }\n          let inRange =\n            foundStartPost && count < this.limit_ && cmp(next, endPost) <= 0;\n          if (inRange) {\n            count++;\n          } else {\n            filtered = filtered.updateImmediateChild(\n              next.name,\n              ChildrenNode.EMPTY_NODE\n            );\n          }\n        }\n      }\n    }\n    return this.rangedFilter_\n      .getIndexedFilter()\n      .updateFullNode(oldSnap, filtered, optChangeAccumulator);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  updatePriority(oldSnap: Node, newPriority: Node): Node {\n    // Don't support priorities on queries\n    return oldSnap;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  filtersNodes(): boolean {\n    return true;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getIndexedFilter(): IndexedFilter {\n    return this.rangedFilter_.getIndexedFilter();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getIndex(): Index {\n    return this.index_;\n  }\n\n  /**\n   * @param {!Node} snap\n   * @param {string} childKey\n   * @param {!Node} childSnap\n   * @param {!CompleteChildSource} source\n   * @param {?ChildChangeAccumulator} changeAccumulator\n   * @return {!Node}\n   * @private\n   */\n  private fullLimitUpdateChild_(\n    snap: Node,\n    childKey: string,\n    childSnap: Node,\n    source: CompleteChildSource,\n    changeAccumulator: ChildChangeAccumulator | null\n  ): Node {\n    // TODO: rename all cache stuff etc to general snap terminology\n    let cmp;\n    if (this.reverse_) {\n      const indexCmp = this.index_.getCompare();\n      cmp = (a: NamedNode, b: NamedNode) => indexCmp(b, a);\n    } else {\n      cmp = this.index_.getCompare();\n    }\n    const oldEventCache = snap as ChildrenNode;\n    assert(oldEventCache.numChildren() == this.limit_, '');\n    const newChildNamedNode = new NamedNode(childKey, childSnap);\n    const windowBoundary = this.reverse_\n      ? oldEventCache.getFirstChild(this.index_)\n      : (oldEventCache.getLastChild(this.index_) as NamedNode);\n    const inRange = this.rangedFilter_.matches(newChildNamedNode);\n    if (oldEventCache.hasChild(childKey)) {\n      const oldChildSnap = oldEventCache.getImmediateChild(childKey);\n      let nextChild = source.getChildAfterChild(\n        this.index_,\n        windowBoundary,\n        this.reverse_\n      );\n      while (\n        nextChild != null &&\n        (nextChild.name == childKey || oldEventCache.hasChild(nextChild.name))\n      ) {\n        // There is a weird edge case where a node is updated as part of a merge in the write tree, but hasn't\n        // been applied to the limited filter yet. Ignore this next child which will be updated later in\n        // the limited filter...\n        nextChild = source.getChildAfterChild(\n          this.index_,\n          nextChild,\n          this.reverse_\n        );\n      }\n      const compareNext =\n        nextChild == null ? 1 : cmp(nextChild, newChildNamedNode);\n      const remainsInWindow =\n        inRange && !childSnap.isEmpty() && compareNext >= 0;\n      if (remainsInWindow) {\n        if (changeAccumulator != null) {\n          changeAccumulator.trackChildChange(\n            Change.childChangedChange(childKey, childSnap, oldChildSnap)\n          );\n        }\n        return oldEventCache.updateImmediateChild(childKey, childSnap);\n      } else {\n        if (changeAccumulator != null) {\n          changeAccumulator.trackChildChange(\n            Change.childRemovedChange(childKey, oldChildSnap)\n          );\n        }\n        const newEventCache = oldEventCache.updateImmediateChild(\n          childKey,\n          ChildrenNode.EMPTY_NODE\n        );\n        const nextChildInRange =\n          nextChild != null && this.rangedFilter_.matches(nextChild);\n        if (nextChildInRange) {\n          if (changeAccumulator != null) {\n            changeAccumulator.trackChildChange(\n              Change.childAddedChange(nextChild.name, nextChild.node)\n            );\n          }\n          return newEventCache.updateImmediateChild(\n            nextChild.name,\n            nextChild.node\n          );\n        } else {\n          return newEventCache;\n        }\n      }\n    } else if (childSnap.isEmpty()) {\n      // we're deleting a node, but it was not in the window, so ignore it\n      return snap;\n    } else if (inRange) {\n      if (cmp(windowBoundary, newChildNamedNode) >= 0) {\n        if (changeAccumulator != null) {\n          changeAccumulator.trackChildChange(\n            Change.childRemovedChange(windowBoundary.name, windowBoundary.node)\n          );\n          changeAccumulator.trackChildChange(\n            Change.childAddedChange(childKey, childSnap)\n          );\n        }\n        return oldEventCache\n          .updateImmediateChild(childKey, childSnap)\n          .updateImmediateChild(windowBoundary.name, ChildrenNode.EMPTY_NODE);\n      } else {\n        return snap;\n      }\n    } else {\n      return snap;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { MIN_NAME, MAX_NAME } from '../util/util';\nimport { KEY_INDEX } from '../snap/indexes/KeyIndex';\nimport { PRIORITY_INDEX } from '../snap/indexes/PriorityIndex';\nimport { VALUE_INDEX } from '../snap/indexes/ValueIndex';\nimport { PathIndex } from '../snap/indexes/PathIndex';\nimport { IndexedFilter } from './filter/IndexedFilter';\nimport { LimitedFilter } from './filter/LimitedFilter';\nimport { RangedFilter } from './filter/RangedFilter';\nimport { stringify } from '@firebase/util';\nimport { NodeFilter } from './filter/NodeFilter';\nimport { Index } from '../snap/indexes/Index';\n\n/**\n * This class is an immutable-from-the-public-api struct containing a set of query parameters defining a\n * range to be returned for a particular location. It is assumed that validation of parameters is done at the\n * user-facing API level, so it is not done here.\n * @constructor\n */\nexport class QueryParams {\n  private limitSet_ = false;\n  private startSet_ = false;\n  private startNameSet_ = false;\n  private endSet_ = false;\n  private endNameSet_ = false;\n\n  private limit_ = 0;\n  private viewFrom_ = '';\n  private indexStartValue_: any | null = null;\n  private indexStartName_ = '';\n  private indexEndValue_: any | null = null;\n  private indexEndName_ = '';\n\n  private index_ = PRIORITY_INDEX;\n\n  /**\n   * Wire Protocol Constants\n   * @const\n   * @enum {string}\n   * @private\n   */\n  private static readonly WIRE_PROTOCOL_CONSTANTS_ = {\n    INDEX_START_VALUE: 'sp',\n    INDEX_START_NAME: 'sn',\n    INDEX_END_VALUE: 'ep',\n    INDEX_END_NAME: 'en',\n    LIMIT: 'l',\n    VIEW_FROM: 'vf',\n    VIEW_FROM_LEFT: 'l',\n    VIEW_FROM_RIGHT: 'r',\n    INDEX: 'i'\n  };\n\n  /**\n   * REST Query Constants\n   * @const\n   * @enum {string}\n   * @private\n   */\n  private static readonly REST_QUERY_CONSTANTS_ = {\n    ORDER_BY: 'orderBy',\n    PRIORITY_INDEX: '$priority',\n    VALUE_INDEX: '$value',\n    KEY_INDEX: '$key',\n    START_AT: 'startAt',\n    END_AT: 'endAt',\n    LIMIT_TO_FIRST: 'limitToFirst',\n    LIMIT_TO_LAST: 'limitToLast'\n  };\n\n  /**\n   * Default, empty query parameters\n   * @type {!QueryParams}\n   * @const\n   */\n  static readonly DEFAULT = new QueryParams();\n\n  /**\n   * @return {boolean}\n   */\n  hasStart(): boolean {\n    return this.startSet_;\n  }\n\n  /**\n   * @return {boolean} True if it would return from left.\n   */\n  isViewFromLeft(): boolean {\n    if (this.viewFrom_ === '') {\n      // limit(), rather than limitToFirst or limitToLast was called.\n      // This means that only one of startSet_ and endSet_ is true. Use them\n      // to calculate which side of the view to anchor to. If neither is set,\n      // anchor to the end.\n      return this.startSet_;\n    } else {\n      return (\n        this.viewFrom_ === QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT\n      );\n    }\n  }\n\n  /**\n   * Only valid to call if hasStart() returns true\n   * @return {*}\n   */\n  getIndexStartValue(): any {\n    assert(this.startSet_, 'Only valid if start has been set');\n    return this.indexStartValue_;\n  }\n\n  /**\n   * Only valid to call if hasStart() returns true.\n   * Returns the starting key name for the range defined by these query parameters\n   * @return {!string}\n   */\n  getIndexStartName(): string {\n    assert(this.startSet_, 'Only valid if start has been set');\n    if (this.startNameSet_) {\n      return this.indexStartName_;\n    } else {\n      return MIN_NAME;\n    }\n  }\n\n  /**\n   * @return {boolean}\n   */\n  hasEnd(): boolean {\n    return this.endSet_;\n  }\n\n  /**\n   * Only valid to call if hasEnd() returns true.\n   * @return {*}\n   */\n  getIndexEndValue(): any {\n    assert(this.endSet_, 'Only valid if end has been set');\n    return this.indexEndValue_;\n  }\n\n  /**\n   * Only valid to call if hasEnd() returns true.\n   * Returns the end key name for the range defined by these query parameters\n   * @return {!string}\n   */\n  getIndexEndName(): string {\n    assert(this.endSet_, 'Only valid if end has been set');\n    if (this.endNameSet_) {\n      return this.indexEndName_;\n    } else {\n      return MAX_NAME;\n    }\n  }\n\n  /**\n   * @return {boolean}\n   */\n  hasLimit(): boolean {\n    return this.limitSet_;\n  }\n\n  /**\n   * @return {boolean} True if a limit has been set and it has been explicitly anchored\n   */\n  hasAnchoredLimit(): boolean {\n    return this.limitSet_ && this.viewFrom_ !== '';\n  }\n\n  /**\n   * Only valid to call if hasLimit() returns true\n   * @return {!number}\n   */\n  getLimit(): number {\n    assert(this.limitSet_, 'Only valid if limit has been set');\n    return this.limit_;\n  }\n\n  /**\n   * @return {!Index}\n   */\n  getIndex(): Index {\n    return this.index_;\n  }\n\n  /**\n   * @return {!QueryParams}\n   * @private\n   */\n  private copy_(): QueryParams {\n    const copy = new QueryParams();\n    copy.limitSet_ = this.limitSet_;\n    copy.limit_ = this.limit_;\n    copy.startSet_ = this.startSet_;\n    copy.indexStartValue_ = this.indexStartValue_;\n    copy.startNameSet_ = this.startNameSet_;\n    copy.indexStartName_ = this.indexStartName_;\n    copy.endSet_ = this.endSet_;\n    copy.indexEndValue_ = this.indexEndValue_;\n    copy.endNameSet_ = this.endNameSet_;\n    copy.indexEndName_ = this.indexEndName_;\n    copy.index_ = this.index_;\n    copy.viewFrom_ = this.viewFrom_;\n    return copy;\n  }\n\n  /**\n   * @param {!number} newLimit\n   * @return {!QueryParams}\n   */\n  limit(newLimit: number): QueryParams {\n    const newParams = this.copy_();\n    newParams.limitSet_ = true;\n    newParams.limit_ = newLimit;\n    newParams.viewFrom_ = '';\n    return newParams;\n  }\n\n  /**\n   * @param {!number} newLimit\n   * @return {!QueryParams}\n   */\n  limitToFirst(newLimit: number): QueryParams {\n    const newParams = this.copy_();\n    newParams.limitSet_ = true;\n    newParams.limit_ = newLimit;\n    newParams.viewFrom_ = QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT;\n    return newParams;\n  }\n\n  /**\n   * @param {!number} newLimit\n   * @return {!QueryParams}\n   */\n  limitToLast(newLimit: number): QueryParams {\n    const newParams = this.copy_();\n    newParams.limitSet_ = true;\n    newParams.limit_ = newLimit;\n    newParams.viewFrom_ = QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT;\n    return newParams;\n  }\n\n  /**\n   * @param {*} indexValue\n   * @param {?string=} key\n   * @return {!QueryParams}\n   */\n  startAt(indexValue: any, key?: string | null): QueryParams {\n    const newParams = this.copy_();\n    newParams.startSet_ = true;\n    if (indexValue === undefined) {\n      indexValue = null;\n    }\n    newParams.indexStartValue_ = indexValue;\n    if (key != null) {\n      newParams.startNameSet_ = true;\n      newParams.indexStartName_ = key;\n    } else {\n      newParams.startNameSet_ = false;\n      newParams.indexStartName_ = '';\n    }\n    return newParams;\n  }\n\n  /**\n   * @param {*} indexValue\n   * @param {?string=} key\n   * @return {!QueryParams}\n   */\n  endAt(indexValue: any, key?: string | null): QueryParams {\n    const newParams = this.copy_();\n    newParams.endSet_ = true;\n    if (indexValue === undefined) {\n      indexValue = null;\n    }\n    newParams.indexEndValue_ = indexValue;\n    if (key !== undefined) {\n      newParams.endNameSet_ = true;\n      newParams.indexEndName_ = key;\n    } else {\n      newParams.endNameSet_ = false;\n      newParams.indexEndName_ = '';\n    }\n    return newParams;\n  }\n\n  /**\n   * @param {!Index} index\n   * @return {!QueryParams}\n   */\n  orderBy(index: Index): QueryParams {\n    const newParams = this.copy_();\n    newParams.index_ = index;\n    return newParams;\n  }\n\n  /**\n   * @return {!Object}\n   */\n  getQueryObject(): Object {\n    const WIRE_PROTOCOL_CONSTANTS = QueryParams.WIRE_PROTOCOL_CONSTANTS_;\n    const obj: { [k: string]: any } = {};\n    if (this.startSet_) {\n      obj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_VALUE] = this.indexStartValue_;\n      if (this.startNameSet_) {\n        obj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_NAME] = this.indexStartName_;\n      }\n    }\n    if (this.endSet_) {\n      obj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_VALUE] = this.indexEndValue_;\n      if (this.endNameSet_) {\n        obj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_NAME] = this.indexEndName_;\n      }\n    }\n    if (this.limitSet_) {\n      obj[WIRE_PROTOCOL_CONSTANTS.LIMIT] = this.limit_;\n      let viewFrom = this.viewFrom_;\n      if (viewFrom === '') {\n        if (this.isViewFromLeft()) {\n          viewFrom = WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_LEFT;\n        } else {\n          viewFrom = WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_RIGHT;\n        }\n      }\n      obj[WIRE_PROTOCOL_CONSTANTS.VIEW_FROM] = viewFrom;\n    }\n    // For now, priority index is the default, so we only specify if it's some other index\n    if (this.index_ !== PRIORITY_INDEX) {\n      obj[WIRE_PROTOCOL_CONSTANTS.INDEX] = this.index_.toString();\n    }\n    return obj;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  loadsAllData(): boolean {\n    return !(this.startSet_ || this.endSet_ || this.limitSet_);\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isDefault(): boolean {\n    return this.loadsAllData() && this.index_ == PRIORITY_INDEX;\n  }\n\n  /**\n   * @return {!NodeFilter}\n   */\n  getNodeFilter(): NodeFilter {\n    if (this.loadsAllData()) {\n      return new IndexedFilter(this.getIndex());\n    } else if (this.hasLimit()) {\n      return new LimitedFilter(this);\n    } else {\n      return new RangedFilter(this);\n    }\n  }\n\n  /**\n   * Returns a set of REST query string parameters representing this query.\n   *\n   * @return {!Object.<string,*>} query string parameters\n   */\n  toRestQueryStringParameters(): { [k: string]: any } {\n    const REST_CONSTANTS = QueryParams.REST_QUERY_CONSTANTS_;\n    const qs: { [k: string]: string | number } = {};\n\n    if (this.isDefault()) {\n      return qs;\n    }\n\n    let orderBy;\n    if (this.index_ === PRIORITY_INDEX) {\n      orderBy = REST_CONSTANTS.PRIORITY_INDEX;\n    } else if (this.index_ === VALUE_INDEX) {\n      orderBy = REST_CONSTANTS.VALUE_INDEX;\n    } else if (this.index_ === KEY_INDEX) {\n      orderBy = REST_CONSTANTS.KEY_INDEX;\n    } else {\n      assert(this.index_ instanceof PathIndex, 'Unrecognized index type!');\n      orderBy = this.index_.toString();\n    }\n    qs[REST_CONSTANTS.ORDER_BY] = stringify(orderBy);\n\n    if (this.startSet_) {\n      qs[REST_CONSTANTS.START_AT] = stringify(this.indexStartValue_);\n      if (this.startNameSet_) {\n        qs[REST_CONSTANTS.START_AT] += ',' + stringify(this.indexStartName_);\n      }\n    }\n\n    if (this.endSet_) {\n      qs[REST_CONSTANTS.END_AT] = stringify(this.indexEndValue_);\n      if (this.endNameSet_) {\n        qs[REST_CONSTANTS.END_AT] += ',' + stringify(this.indexEndName_);\n      }\n    }\n\n    if (this.limitSet_) {\n      if (this.isViewFromLeft()) {\n        qs[REST_CONSTANTS.LIMIT_TO_FIRST] = this.limit_;\n      } else {\n        qs[REST_CONSTANTS.LIMIT_TO_LAST] = this.limit_;\n      }\n    }\n\n    return qs;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { OnDisconnect } from './onDisconnect';\nimport { TransactionResult } from './TransactionResult';\nimport { warn } from '../core/util/util';\nimport { nextPushId } from '../core/util/NextPushId';\nimport { Query } from './Query';\nimport { Repo } from '../core/Repo';\nimport { Path } from '../core/util/Path';\nimport { QueryParams } from '../core/view/QueryParams';\nimport {\n  validateRootPathString,\n  validatePathString,\n  validateFirebaseMergeDataArg,\n  validateBoolean,\n  validatePriority,\n  validateFirebaseDataArg,\n  validateWritablePath\n} from '../core/util/validation';\nimport { validateArgCount, validateCallback } from '@firebase/util';\nimport { Deferred } from '@firebase/util';\nimport { SyncPoint } from '../core/SyncPoint';\nimport { Database } from './Database';\nimport { DataSnapshot } from './DataSnapshot';\nimport * as types from '@firebase/database-types';\n\nexport interface ReferenceConstructor {\n  new (repo: Repo, path: Path): Reference;\n}\n\nexport class Reference extends Query implements types.Reference {\n  public then: (a?: any) => Promise<any>;\n  public catch: (a?: Error) => Promise<any>;\n\n  /**\n   * Call options:\n   *   new Reference(Repo, Path) or\n   *   new Reference(url: string, string|RepoManager)\n   *\n   * Externally - this is the firebase.database.Reference type.\n   *\n   * @param {!Repo} repo\n   * @param {(!Path)} path\n   * @extends {Query}\n   */\n  constructor(repo: Repo, path: Path) {\n    if (!(repo instanceof Repo)) {\n      throw new Error(\n        'new Reference() no longer supported - use app.database().'\n      );\n    }\n\n    // call Query's constructor, passing in the repo and path.\n    super(repo, path, QueryParams.DEFAULT, false);\n  }\n\n  /** @return {?string} */\n  getKey(): string | null {\n    validateArgCount('Reference.key', 0, 0, arguments.length);\n\n    if (this.path.isEmpty()) return null;\n    else return this.path.getBack();\n  }\n\n  /**\n   * @param {!(string|Path)} pathString\n   * @return {!Reference}\n   */\n  child(pathString: string | Path): Reference {\n    validateArgCount('Reference.child', 1, 1, arguments.length);\n    if (typeof pathString === 'number') {\n      pathString = String(pathString);\n    } else if (!(pathString instanceof Path)) {\n      if (this.path.getFront() === null)\n        validateRootPathString('Reference.child', 1, pathString, false);\n      else validatePathString('Reference.child', 1, pathString, false);\n    }\n\n    return new Reference(this.repo, this.path.child(pathString));\n  }\n\n  /** @return {?Reference} */\n  getParent(): Reference | null {\n    validateArgCount('Reference.parent', 0, 0, arguments.length);\n\n    const parentPath = this.path.parent();\n    return parentPath === null ? null : new Reference(this.repo, parentPath);\n  }\n\n  /** @return {!Reference} */\n  getRoot(): Reference {\n    validateArgCount('Reference.root', 0, 0, arguments.length);\n\n    let ref = this as any;\n    while (ref.getParent() !== null) {\n      ref = ref.getParent();\n    }\n    return ref;\n  }\n\n  /** @return {!Database} */\n  databaseProp(): Database {\n    return this.repo.database;\n  }\n\n  /**\n   * @param {*} newVal\n   * @param {function(?Error)=} onComplete\n   * @return {!Promise}\n   */\n  set(newVal: any, onComplete?: (a: Error | null) => void): Promise<any> {\n    validateArgCount('Reference.set', 1, 2, arguments.length);\n    validateWritablePath('Reference.set', this.path);\n    validateFirebaseDataArg('Reference.set', 1, newVal, this.path, false);\n    validateCallback('Reference.set', 2, onComplete, true);\n\n    const deferred = new Deferred();\n    this.repo.setWithPriority(\n      this.path,\n      newVal,\n      /*priority=*/ null,\n      deferred.wrapCallback(onComplete)\n    );\n    return deferred.promise;\n  }\n\n  /**\n   * @param {!Object} objectToMerge\n   * @param {function(?Error)=} onComplete\n   * @return {!Promise}\n   */\n  update(\n    objectToMerge: Object,\n    onComplete?: (a: Error | null) => void\n  ): Promise<any> {\n    validateArgCount('Reference.update', 1, 2, arguments.length);\n    validateWritablePath('Reference.update', this.path);\n\n    if (Array.isArray(objectToMerge)) {\n      const newObjectToMerge: { [k: string]: any } = {};\n      for (let i = 0; i < objectToMerge.length; ++i) {\n        newObjectToMerge['' + i] = objectToMerge[i];\n      }\n      objectToMerge = newObjectToMerge;\n      warn(\n        'Passing an Array to Firebase.update() is deprecated. ' +\n          'Use set() if you want to overwrite the existing data, or ' +\n          'an Object with integer keys if you really do want to ' +\n          'only update some of the children.'\n      );\n    }\n    validateFirebaseMergeDataArg(\n      'Reference.update',\n      1,\n      objectToMerge,\n      this.path,\n      false\n    );\n    validateCallback('Reference.update', 2, onComplete, true);\n    const deferred = new Deferred();\n    this.repo.update(\n      this.path,\n      objectToMerge,\n      deferred.wrapCallback(onComplete)\n    );\n    return deferred.promise;\n  }\n\n  /**\n   * @param {*} newVal\n   * @param {string|number|null} newPriority\n   * @param {function(?Error)=} onComplete\n   * @return {!Promise}\n   */\n  setWithPriority(\n    newVal: any,\n    newPriority: string | number | null,\n    onComplete?: (a: Error | null) => void\n  ): Promise<any> {\n    validateArgCount('Reference.setWithPriority', 2, 3, arguments.length);\n    validateWritablePath('Reference.setWithPriority', this.path);\n    validateFirebaseDataArg(\n      'Reference.setWithPriority',\n      1,\n      newVal,\n      this.path,\n      false\n    );\n    validatePriority('Reference.setWithPriority', 2, newPriority, false);\n    validateCallback('Reference.setWithPriority', 3, onComplete, true);\n\n    if (this.getKey() === '.length' || this.getKey() === '.keys')\n      throw 'Reference.setWithPriority failed: ' +\n        this.getKey() +\n        ' is a read-only object.';\n\n    const deferred = new Deferred();\n    this.repo.setWithPriority(\n      this.path,\n      newVal,\n      newPriority,\n      deferred.wrapCallback(onComplete)\n    );\n    return deferred.promise;\n  }\n\n  /**\n   * @param {function(?Error)=} onComplete\n   * @return {!Promise}\n   */\n  remove(onComplete?: (a: Error | null) => void): Promise<any> {\n    validateArgCount('Reference.remove', 0, 1, arguments.length);\n    validateWritablePath('Reference.remove', this.path);\n    validateCallback('Reference.remove', 1, onComplete, true);\n\n    return this.set(null, onComplete);\n  }\n\n  /**\n   * @param {function(*):*} transactionUpdate\n   * @param {(function(?Error, boolean, ?DataSnapshot))=} onComplete\n   * @param {boolean=} applyLocally\n   * @return {!Promise}\n   */\n  transaction(\n    transactionUpdate: (a: any) => any,\n    onComplete?: (a: Error | null, b: boolean, c: DataSnapshot | null) => void,\n    applyLocally?: boolean\n  ): Promise<TransactionResult> {\n    validateArgCount('Reference.transaction', 1, 3, arguments.length);\n    validateWritablePath('Reference.transaction', this.path);\n    validateCallback('Reference.transaction', 1, transactionUpdate, false);\n    validateCallback('Reference.transaction', 2, onComplete, true);\n    // NOTE: applyLocally is an internal-only option for now.  We need to decide if we want to keep it and how\n    // to expose it.\n    validateBoolean('Reference.transaction', 3, applyLocally, true);\n\n    if (this.getKey() === '.length' || this.getKey() === '.keys')\n      throw 'Reference.transaction failed: ' +\n        this.getKey() +\n        ' is a read-only object.';\n\n    if (applyLocally === undefined) applyLocally = true;\n\n    const deferred = new Deferred<TransactionResult>();\n    if (typeof onComplete === 'function') {\n      deferred.promise.catch(() => {});\n    }\n\n    const promiseComplete = function(\n      error: Error,\n      committed: boolean,\n      snapshot: DataSnapshot\n    ) {\n      if (error) {\n        deferred.reject(error);\n      } else {\n        deferred.resolve(new TransactionResult(committed, snapshot));\n      }\n      if (typeof onComplete === 'function') {\n        onComplete(error, committed, snapshot);\n      }\n    };\n    this.repo.startTransaction(\n      this.path,\n      transactionUpdate,\n      promiseComplete,\n      applyLocally\n    );\n\n    return deferred.promise;\n  }\n\n  /**\n   * @param {string|number|null} priority\n   * @param {function(?Error)=} onComplete\n   * @return {!Promise}\n   */\n  setPriority(\n    priority: string | number | null,\n    onComplete?: (a: Error | null) => void\n  ): Promise<any> {\n    validateArgCount('Reference.setPriority', 1, 2, arguments.length);\n    validateWritablePath('Reference.setPriority', this.path);\n    validatePriority('Reference.setPriority', 1, priority, false);\n    validateCallback('Reference.setPriority', 2, onComplete, true);\n\n    const deferred = new Deferred();\n    this.repo.setWithPriority(\n      this.path.child('.priority'),\n      priority,\n      null,\n      deferred.wrapCallback(onComplete)\n    );\n    return deferred.promise;\n  }\n\n  /**\n   * @param {*=} value\n   * @param {function(?Error)=} onComplete\n   * @return {!Reference}\n   */\n  push(value?: any, onComplete?: (a: Error | null) => void): Reference {\n    validateArgCount('Reference.push', 0, 2, arguments.length);\n    validateWritablePath('Reference.push', this.path);\n    validateFirebaseDataArg('Reference.push', 1, value, this.path, true);\n    validateCallback('Reference.push', 2, onComplete, true);\n\n    const now = this.repo.serverTime();\n    const name = nextPushId(now);\n\n    // push() returns a ThennableReference whose promise is fulfilled with a regular Reference.\n    // We use child() to create handles to two different references. The first is turned into a\n    // ThennableReference below by adding then() and catch() methods and is used as the\n    // return value of push(). The second remains a regular Reference and is used as the fulfilled\n    // value of the first ThennableReference.\n    const thennablePushRef = this.child(name);\n    const pushRef = this.child(name);\n\n    let promise;\n    if (value != null) {\n      promise = thennablePushRef.set(value, onComplete).then(() => pushRef);\n    } else {\n      promise = Promise.resolve(pushRef);\n    }\n\n    thennablePushRef.then = promise.then.bind(promise);\n    thennablePushRef.catch = promise.then.bind(promise, undefined);\n\n    if (typeof onComplete === 'function') {\n      promise.catch(() => {});\n    }\n\n    return thennablePushRef;\n  }\n\n  /**\n   * @return {!OnDisconnect}\n   */\n  onDisconnect(): OnDisconnect {\n    validateWritablePath('Reference.onDisconnect', this.path);\n    return new OnDisconnect(this.repo, this.path);\n  }\n\n  get database(): Database {\n    return this.databaseProp();\n  }\n\n  get key(): string | null {\n    return this.getKey();\n  }\n\n  get parent(): Reference | null {\n    return this.getParent();\n  }\n\n  get root(): Reference {\n    return this.getRoot();\n  }\n}\n\n/**\n * Define reference constructor in various modules\n *\n * We are doing this here to avoid several circular\n * dependency issues\n */\nQuery.__referenceConstructor = Reference;\nSyncPoint.__referenceConstructor = Reference;\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { Path } from './Path';\nimport { contains, safeGet } from '@firebase/util';\nimport { each } from './util';\n\n/**\n * Node in a Tree.\n */\nexport class TreeNode<T> {\n  // TODO: Consider making accessors that create children and value lazily or\n  // separate Internal / Leaf 'types'.\n  children: { [name: string]: TreeNode<T> } = {};\n  childCount = 0;\n  value: T | null = null;\n}\n\n/**\n * A light-weight tree, traversable by path.  Nodes can have both values and children.\n * Nodes are not enumerated (by forEachChild) unless they have a value or non-empty\n * children.\n */\nexport class Tree<T> {\n  /**\n   * @template T\n   * @param {string=} name_ Optional name of the node.\n   * @param {Tree=} parent_ Optional parent node.\n   * @param {TreeNode=} node_ Optional node to wrap.\n   */\n  constructor(\n    private name_: string = '',\n    private parent_: Tree<T> | null = null,\n    private node_: TreeNode<T> = new TreeNode<T>()\n  ) {}\n\n  /**\n   * Returns a sub-Tree for the given path.\n   *\n   * @param {!(string|Path)} pathObj Path to look up.\n   * @return {!Tree.<T>} Tree for path.\n   */\n  subTree(pathObj: string | Path): Tree<T> {\n    // TODO: Require pathObj to be Path?\n    let path = pathObj instanceof Path ? pathObj : new Path(pathObj);\n    let child = this as Tree<T>,\n      next;\n    while ((next = path.getFront()) !== null) {\n      const childNode = safeGet(child.node_.children, next) || new TreeNode();\n      child = new Tree(next, child, childNode);\n      path = path.popFront();\n    }\n\n    return child;\n  }\n\n  /**\n   * Returns the data associated with this tree node.\n   *\n   * @return {?T} The data or null if no data exists.\n   */\n  getValue(): T | null {\n    return this.node_.value;\n  }\n\n  /**\n   * Sets data to this tree node.\n   *\n   * @param {!T} value Value to set.\n   */\n  setValue(value: T) {\n    assert(typeof value !== 'undefined', 'Cannot set value to undefined');\n    this.node_.value = value;\n    this.updateParents_();\n  }\n\n  /**\n   * Clears the contents of the tree node (its value and all children).\n   */\n  clear() {\n    this.node_.value = null;\n    this.node_.children = {};\n    this.node_.childCount = 0;\n    this.updateParents_();\n  }\n\n  /**\n   * @return {boolean} Whether the tree has any children.\n   */\n  hasChildren(): boolean {\n    return this.node_.childCount > 0;\n  }\n\n  /**\n   * @return {boolean} Whether the tree is empty (no value or children).\n   */\n  isEmpty(): boolean {\n    return this.getValue() === null && !this.hasChildren();\n  }\n\n  /**\n   * Calls action for each child of this tree node.\n   *\n   * @param {function(!Tree.<T>)} action Action to be called for each child.\n   */\n  forEachChild(action: (tree: Tree<T>) => void) {\n    each(this.node_.children, (child: string, childTree: TreeNode<T>) => {\n      action(new Tree<T>(child, this, childTree));\n    });\n  }\n\n  /**\n   * Does a depth-first traversal of this node's descendants, calling action for each one.\n   *\n   * @param {function(!Tree.<T>)} action Action to be called for each child.\n   * @param {boolean=} includeSelf Whether to call action on this node as well. Defaults to\n   *   false.\n   * @param {boolean=} childrenFirst Whether to call action on children before calling it on\n   *   parent.\n   */\n  forEachDescendant(\n    action: (tree: Tree<T>) => void,\n    includeSelf?: boolean,\n    childrenFirst?: boolean\n  ) {\n    if (includeSelf && !childrenFirst) action(this);\n\n    this.forEachChild(function(child) {\n      child.forEachDescendant(action, /*includeSelf=*/ true, childrenFirst);\n    });\n\n    if (includeSelf && childrenFirst) action(this);\n  }\n\n  /**\n   * Calls action on each ancestor node.\n   *\n   * @param {function(!Tree.<T>)} action Action to be called on each parent; return\n   *   true to abort.\n   * @param {boolean=} includeSelf Whether to call action on this node as well.\n   * @return {boolean} true if the action callback returned true.\n   */\n  forEachAncestor(\n    action: (tree: Tree<T>) => unknown,\n    includeSelf?: boolean\n  ): boolean {\n    let node = includeSelf ? this : this.parent();\n    while (node !== null) {\n      if (action(node)) {\n        return true;\n      }\n      node = node.parent();\n    }\n    return false;\n  }\n\n  /**\n   * Does a depth-first traversal of this node's descendants.  When a descendant with a value\n   * is found, action is called on it and traversal does not continue inside the node.\n   * Action is *not* called on this node.\n   *\n   * @param {function(!Tree.<T>)} action Action to be called for each child.\n   */\n  forEachImmediateDescendantWithValue(action: (tree: Tree<T>) => void) {\n    this.forEachChild(function(child) {\n      if (child.getValue() !== null) action(child);\n      else child.forEachImmediateDescendantWithValue(action);\n    });\n  }\n\n  /**\n   * @return {!Path} The path of this tree node, as a Path.\n   */\n  path(): Path {\n    return new Path(\n      this.parent_ === null\n        ? this.name_\n        : this.parent_.path() + '/' + this.name_\n    );\n  }\n\n  /**\n   * @return {string} The name of the tree node.\n   */\n  name(): string {\n    return this.name_;\n  }\n\n  /**\n   * @return {?Tree} The parent tree node, or null if this is the root of the tree.\n   */\n  parent(): Tree<T> | null {\n    return this.parent_;\n  }\n\n  /**\n   * Adds or removes this child from its parent based on whether it's empty or not.\n   *\n   * @private\n   */\n  private updateParents_() {\n    if (this.parent_ !== null) this.parent_.updateChild_(this.name_, this);\n  }\n\n  /**\n   * Adds or removes the passed child to this tree node, depending on whether it's empty.\n   *\n   * @param {string} childName The name of the child to update.\n   * @param {!Tree.<T>} child The child to update.\n   * @private\n   */\n  private updateChild_(childName: string, child: Tree<T>) {\n    const childEmpty = child.isEmpty();\n    const childExists = contains(this.node_.children, childName);\n    if (childEmpty && childExists) {\n      delete this.node_.children[childName];\n      this.node_.childCount--;\n      this.updateParents_();\n    } else if (!childEmpty && !childExists) {\n      this.node_.children[childName] = child.node_;\n      this.node_.childCount++;\n      this.updateParents_();\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { Reference } from '../api/Reference';\nimport { DataSnapshot } from '../api/DataSnapshot';\nimport { Path } from './util/Path';\nimport { Tree } from './util/Tree';\nimport { PRIORITY_INDEX } from './snap/indexes/PriorityIndex';\nimport { Node } from './snap/Node';\nimport { LUIDGenerator, warn, exceptionGuard } from './util/util';\nimport { resolveDeferredValueSnapshot } from './util/ServerValues';\nimport { isValidPriority, validateFirebaseData } from './util/validation';\nimport { contains, safeGet } from '@firebase/util';\nimport { nodeFromJSON } from './snap/nodeFromJSON';\nimport { ChildrenNode } from './snap/ChildrenNode';\nimport { Repo } from './Repo';\nimport { Event } from './view/Event';\n\n// TODO: This is pretty messy.  Ideally, a lot of this would move into FirebaseData, or a transaction-specific\n// component used by FirebaseData, but it has ties to user callbacks (transaction update and onComplete) as well\n// as the realtime connection (to send transactions to the server).  So that all needs to be decoupled first.\n// For now it's part of Repo, but in its own file.\n\n/**\n * @enum {number}\n */\nexport enum TransactionStatus {\n  // We've run the transaction and updated transactionResultData_ with the result, but it isn't currently sent to the\n  // server. A transaction will go from RUN -> SENT -> RUN if it comes back from the server as rejected due to\n  // mismatched hash.\n  RUN,\n\n  // We've run the transaction and sent it to the server and it's currently outstanding (hasn't come back as accepted\n  // or rejected yet).\n  SENT,\n\n  // Temporary state used to mark completed transactions (whether successful or aborted).  The transaction will be\n  // removed when we get a chance to prune completed ones.\n  COMPLETED,\n\n  // Used when an already-sent transaction needs to be aborted (e.g. due to a conflicting set() call that was made).\n  // If it comes back as unsuccessful, we'll abort it.\n  SENT_NEEDS_ABORT,\n\n  // Temporary state used to mark transactions that need to be aborted.\n  NEEDS_ABORT\n}\n\n/**\n * If a transaction does not succeed after 25 retries, we abort it.  Among other things this ensure that if there's\n * ever a bug causing a mismatch between client / server hashes for some data, we won't retry indefinitely.\n * @type {number}\n * @const\n * @private\n */\n(Repo as any).MAX_TRANSACTION_RETRIES_ = 25;\n\n/**\n * @typedef {{\n *   path: !Path,\n *   update: function(*):*,\n *   onComplete: ?function(?Error, boolean, ?DataSnapshot),\n *   status: ?TransactionStatus,\n *   order: !number,\n *   applyLocally: boolean,\n *   retryCount: !number,\n *   unwatcher: function(),\n *   abortReason: ?string,\n *   currentWriteId: !number,\n *   currentInputSnapshot: ?Node,\n *   currentOutputSnapshotRaw: ?Node,\n *   currentOutputSnapshotResolved: ?Node\n * }}\n */\ntype Transaction = {\n  path: Path;\n  update: (a: any) => any;\n  onComplete: (a: Error | null, b: boolean, c: DataSnapshot | null) => void;\n  status: TransactionStatus;\n  order: number;\n  applyLocally: boolean;\n  retryCount: number;\n  unwatcher: () => void;\n  abortReason: string | null;\n  currentWriteId: number;\n  currentInputSnapshot: Node | null;\n  currentOutputSnapshotRaw: Node | null;\n  currentOutputSnapshotResolved: Node | null;\n};\n\n/**\n * Setup the transaction data structures\n * @private\n */\n(Repo.prototype as any).transactions_init_ = function() {\n  /**\n   * Stores queues of outstanding transactions for Firebase locations.\n   *\n   * @type {!Tree.<Array.<!Transaction>>}\n   * @private\n   */\n  this.transactionQueueTree_ = new Tree<Transaction[]>();\n};\n\ndeclare module './Repo' {\n  interface Repo {\n    startTransaction(\n      path: Path,\n      transactionUpdate: (a: any) => void,\n      onComplete: ((a: Error, b: boolean, c: DataSnapshot) => void) | null,\n      applyLocally: boolean\n    ): void;\n  }\n}\n\n/**\n * Creates a new transaction, adds it to the transactions we're tracking, and sends it to the server if possible.\n *\n * @param {!Path} path Path at which to do transaction.\n * @param {function(*):*} transactionUpdate Update callback.\n * @param {?function(?Error, boolean, ?DataSnapshot)} onComplete Completion callback.\n * @param {boolean} applyLocally Whether or not to make intermediate results visible\n */\nRepo.prototype.startTransaction = function(\n  path: Path,\n  transactionUpdate: (a: any) => any,\n  onComplete: ((a: Error, b: boolean, c: DataSnapshot) => void) | null,\n  applyLocally: boolean\n) {\n  this.log_('transaction on ' + path);\n\n  // Add a watch to make sure we get server updates.\n  const valueCallback = function() {};\n  const watchRef = new Reference(this, path);\n  watchRef.on('value', valueCallback);\n  const unwatcher = function() {\n    watchRef.off('value', valueCallback);\n  };\n\n  // Initialize transaction.\n  const transaction: Transaction = {\n    path,\n    update: transactionUpdate,\n    onComplete,\n\n    // One of TransactionStatus enums.\n    status: null,\n\n    // Used when combining transactions at different locations to figure out which one goes first.\n    order: LUIDGenerator(),\n\n    // Whether to raise local events for this transaction.\n    applyLocally: applyLocally,\n\n    // Count of how many times we've retried the transaction.\n    retryCount: 0,\n\n    // Function to call to clean up our .on() listener.\n    unwatcher,\n\n    // Stores why a transaction was aborted.\n    abortReason: null,\n\n    currentWriteId: null,\n\n    currentInputSnapshot: null,\n\n    currentOutputSnapshotRaw: null,\n\n    currentOutputSnapshotResolved: null\n  };\n\n  // Run transaction initially.\n  const currentState = this.getLatestState_(path);\n  transaction.currentInputSnapshot = currentState;\n  const newVal = transaction.update(currentState.val());\n  if (newVal === undefined) {\n    // Abort transaction.\n    transaction.unwatcher();\n    transaction.currentOutputSnapshotRaw = null;\n    transaction.currentOutputSnapshotResolved = null;\n    if (transaction.onComplete) {\n      // We just set the input snapshot, so this cast should be safe\n      const snapshot = new DataSnapshot(\n        transaction.currentInputSnapshot,\n        new Reference(this, transaction.path),\n        PRIORITY_INDEX\n      );\n      transaction.onComplete(null, false, snapshot);\n    }\n  } else {\n    validateFirebaseData(\n      'transaction failed: Data returned ',\n      newVal,\n      transaction.path\n    );\n\n    // Mark as run and add to our queue.\n    transaction.status = TransactionStatus.RUN;\n    const queueNode = this.transactionQueueTree_.subTree(path);\n    const nodeQueue = queueNode.getValue() || [];\n    nodeQueue.push(transaction);\n\n    queueNode.setValue(nodeQueue);\n\n    // Update visibleData and raise events\n    // Note: We intentionally raise events after updating all of our transaction state, since the user could\n    // start new transactions from the event callbacks.\n    let priorityForNode;\n    if (\n      typeof newVal === 'object' &&\n      newVal !== null &&\n      contains(newVal, '.priority')\n    ) {\n      priorityForNode = safeGet(newVal, '.priority');\n      assert(\n        isValidPriority(priorityForNode),\n        'Invalid priority returned by transaction. ' +\n          'Priority must be a valid string, finite number, server value, or null.'\n      );\n    } else {\n      const currentNode =\n        this.serverSyncTree_.calcCompleteEventCache(path) ||\n        ChildrenNode.EMPTY_NODE;\n      priorityForNode = currentNode.getPriority().val();\n    }\n    priorityForNode /** @type {null|number|string} */ = priorityForNode;\n\n    const serverValues = this.generateServerValues();\n    const newNodeUnresolved = nodeFromJSON(newVal, priorityForNode);\n    const newNode = resolveDeferredValueSnapshot(\n      newNodeUnresolved,\n      currentState,\n      serverValues\n    );\n    transaction.currentOutputSnapshotRaw = newNodeUnresolved;\n    transaction.currentOutputSnapshotResolved = newNode;\n    transaction.currentWriteId = this.getNextWriteId_();\n\n    const events = this.serverSyncTree_.applyUserOverwrite(\n      path,\n      newNode,\n      transaction.currentWriteId,\n      transaction.applyLocally\n    );\n    this.eventQueue_.raiseEventsForChangedPath(path, events);\n\n    this.sendReadyTransactions_();\n  }\n};\n\n/**\n * @param {!Path} path\n * @param {Array.<number>=} excludeSets A specific set to exclude\n * @return {Node}\n * @private\n */\n(Repo.prototype as any).getLatestState_ = function(\n  path: Path,\n  excludeSets?: number[]\n): Node {\n  return (\n    this.serverSyncTree_.calcCompleteEventCache(path, excludeSets) ||\n    ChildrenNode.EMPTY_NODE\n  );\n};\n\n/**\n * Sends any already-run transactions that aren't waiting for outstanding transactions to\n * complete.\n *\n * Externally it's called with no arguments, but it calls itself recursively with a particular\n * transactionQueueTree node to recurse through the tree.\n *\n * @param {Tree.<Array.<Transaction>>=} node  transactionQueueTree node to start at.\n * @private\n */\n(Repo.prototype as any).sendReadyTransactions_ = function(\n  node: Tree<Transaction[]> = this.transactionQueueTree_\n) {\n  // Before recursing, make sure any completed transactions are removed.\n  if (!node) {\n    this.pruneCompletedTransactionsBelowNode_(node);\n  }\n\n  if (node.getValue() !== null) {\n    const queue = this.buildTransactionQueue_(node);\n    assert(queue.length > 0, 'Sending zero length transaction queue');\n\n    const allRun = queue.every(\n      (transaction: Transaction) => transaction.status === TransactionStatus.RUN\n    );\n\n    // If they're all run (and not sent), we can send them.  Else, we must wait.\n    if (allRun) {\n      this.sendTransactionQueue_(node.path(), queue);\n    }\n  } else if (node.hasChildren()) {\n    node.forEachChild(childNode => {\n      this.sendReadyTransactions_(childNode);\n    });\n  }\n};\n\n/**\n * Given a list of run transactions, send them to the server and then handle the result (success or failure).\n *\n * @param {!Path} path The location of the queue.\n * @param {!Array.<Transaction>} queue Queue of transactions under the specified location.\n * @private\n */\n(Repo.prototype as any).sendTransactionQueue_ = function(\n  path: Path,\n  queue: Array<Transaction>\n) {\n  // Mark transactions as sent and increment retry count!\n  const setsToIgnore = queue.map(function(txn) {\n    return txn.currentWriteId;\n  });\n  const latestState = this.getLatestState_(path, setsToIgnore);\n  let snapToSend = latestState;\n  const latestHash = latestState.hash();\n  for (let i = 0; i < queue.length; i++) {\n    const txn = queue[i];\n    assert(\n      txn.status === TransactionStatus.RUN,\n      'tryToSendTransactionQueue_: items in queue should all be run.'\n    );\n    txn.status = TransactionStatus.SENT;\n    txn.retryCount++;\n    const relativePath = Path.relativePath(path, txn.path);\n    // If we've gotten to this point, the output snapshot must be defined.\n    snapToSend = snapToSend.updateChild(\n      relativePath /**@type {!Node} */,\n      txn.currentOutputSnapshotRaw\n    );\n  }\n\n  const dataToSend = snapToSend.val(true);\n  const pathToSend = path;\n\n  // Send the put.\n  this.server_.put(\n    pathToSend.toString(),\n    dataToSend,\n    (status: string) => {\n      this.log_('transaction put response', {\n        path: pathToSend.toString(),\n        status\n      });\n\n      let events: Event[] = [];\n      if (status === 'ok') {\n        // Queue up the callbacks and fire them after cleaning up all of our transaction state, since\n        // the callback could trigger more transactions or sets.\n        const callbacks = [];\n        for (let i = 0; i < queue.length; i++) {\n          queue[i].status = TransactionStatus.COMPLETED;\n          events = events.concat(\n            this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId)\n          );\n          if (queue[i].onComplete) {\n            // We never unset the output snapshot, and given that this transaction is complete, it should be set\n            const node = queue[i].currentOutputSnapshotResolved as Node;\n            const ref = new Reference(this, queue[i].path);\n            const snapshot = new DataSnapshot(node, ref, PRIORITY_INDEX);\n            callbacks.push(\n              queue[i].onComplete.bind(null, null, true, snapshot)\n            );\n          }\n          queue[i].unwatcher();\n        }\n\n        // Now remove the completed transactions.\n        this.pruneCompletedTransactionsBelowNode_(\n          this.transactionQueueTree_.subTree(path)\n        );\n        // There may be pending transactions that we can now send.\n        this.sendReadyTransactions_();\n\n        this.eventQueue_.raiseEventsForChangedPath(path, events);\n\n        // Finally, trigger onComplete callbacks.\n        for (let i = 0; i < callbacks.length; i++) {\n          exceptionGuard(callbacks[i]);\n        }\n      } else {\n        // transactions are no longer sent.  Update their status appropriately.\n        if (status === 'datastale') {\n          for (let i = 0; i < queue.length; i++) {\n            if (queue[i].status === TransactionStatus.SENT_NEEDS_ABORT)\n              queue[i].status = TransactionStatus.NEEDS_ABORT;\n            else queue[i].status = TransactionStatus.RUN;\n          }\n        } else {\n          warn(\n            'transaction at ' + pathToSend.toString() + ' failed: ' + status\n          );\n          for (let i = 0; i < queue.length; i++) {\n            queue[i].status = TransactionStatus.NEEDS_ABORT;\n            queue[i].abortReason = status;\n          }\n        }\n\n        this.rerunTransactions_(path);\n      }\n    },\n    latestHash\n  );\n};\n\n/**\n * Finds all transactions dependent on the data at changedPath and reruns them.\n *\n * Should be called any time cached data changes.\n *\n * Return the highest path that was affected by rerunning transactions.  This is the path at which events need to\n * be raised for.\n *\n * @param {!Path} changedPath The path in mergedData that changed.\n * @return {!Path} The rootmost path that was affected by rerunning transactions.\n * @private\n */\n(Repo.prototype as any).rerunTransactions_ = function(changedPath: Path): Path {\n  const rootMostTransactionNode = this.getAncestorTransactionNode_(changedPath);\n  const path = rootMostTransactionNode.path();\n\n  const queue = this.buildTransactionQueue_(rootMostTransactionNode);\n  this.rerunTransactionQueue_(queue, path);\n\n  return path;\n};\n\n/**\n * Does all the work of rerunning transactions (as well as cleans up aborted transactions and whatnot).\n *\n * @param {Array.<Transaction>} queue The queue of transactions to run.\n * @param {!Path} path The path the queue is for.\n * @private\n */\n(Repo.prototype as any).rerunTransactionQueue_ = function(\n  queue: Array<Transaction>,\n  path: Path\n) {\n  if (queue.length === 0) {\n    return; // Nothing to do!\n  }\n\n  // Queue up the callbacks and fire them after cleaning up all of our transaction state, since\n  // the callback could trigger more transactions or sets.\n  const callbacks = [];\n  let events: Event[] = [];\n  // Ignore all of the sets we're going to re-run.\n  const txnsToRerun = queue.filter(function(q) {\n    return q.status === TransactionStatus.RUN;\n  });\n  const setsToIgnore = txnsToRerun.map(function(q) {\n    return q.currentWriteId;\n  });\n  for (let i = 0; i < queue.length; i++) {\n    const transaction = queue[i];\n    const relativePath = Path.relativePath(path, transaction.path);\n    let abortTransaction = false,\n      abortReason;\n    assert(\n      relativePath !== null,\n      'rerunTransactionsUnderNode_: relativePath should not be null.'\n    );\n\n    if (transaction.status === TransactionStatus.NEEDS_ABORT) {\n      abortTransaction = true;\n      abortReason = transaction.abortReason;\n      events = events.concat(\n        this.serverSyncTree_.ackUserWrite(transaction.currentWriteId, true)\n      );\n    } else if (transaction.status === TransactionStatus.RUN) {\n      if (transaction.retryCount >= (Repo as any).MAX_TRANSACTION_RETRIES_) {\n        abortTransaction = true;\n        abortReason = 'maxretry';\n        events = events.concat(\n          this.serverSyncTree_.ackUserWrite(transaction.currentWriteId, true)\n        );\n      } else {\n        // This code reruns a transaction\n        const currentNode = this.getLatestState_(\n          transaction.path,\n          setsToIgnore\n        );\n        transaction.currentInputSnapshot = currentNode;\n        const newData = queue[i].update(currentNode.val());\n        if (newData !== undefined) {\n          validateFirebaseData(\n            'transaction failed: Data returned ',\n            newData,\n            transaction.path\n          );\n          let newDataNode = nodeFromJSON(newData);\n          const hasExplicitPriority =\n            typeof newData === 'object' &&\n            newData != null &&\n            contains(newData, '.priority');\n          if (!hasExplicitPriority) {\n            // Keep the old priority if there wasn't a priority explicitly specified.\n            newDataNode = newDataNode.updatePriority(currentNode.getPriority());\n          }\n\n          const oldWriteId = transaction.currentWriteId;\n          const serverValues = this.generateServerValues();\n          const newNodeResolved = resolveDeferredValueSnapshot(\n            newDataNode,\n            currentNode,\n            serverValues\n          );\n\n          transaction.currentOutputSnapshotRaw = newDataNode;\n          transaction.currentOutputSnapshotResolved = newNodeResolved;\n          transaction.currentWriteId = this.getNextWriteId_();\n          // Mutates setsToIgnore in place\n          setsToIgnore.splice(setsToIgnore.indexOf(oldWriteId), 1);\n          events = events.concat(\n            this.serverSyncTree_.applyUserOverwrite(\n              transaction.path,\n              newNodeResolved,\n              transaction.currentWriteId,\n              transaction.applyLocally\n            )\n          );\n          events = events.concat(\n            this.serverSyncTree_.ackUserWrite(oldWriteId, true)\n          );\n        } else {\n          abortTransaction = true;\n          abortReason = 'nodata';\n          events = events.concat(\n            this.serverSyncTree_.ackUserWrite(transaction.currentWriteId, true)\n          );\n        }\n      }\n    }\n    this.eventQueue_.raiseEventsForChangedPath(path, events);\n    events = [];\n    if (abortTransaction) {\n      // Abort.\n      queue[i].status = TransactionStatus.COMPLETED;\n\n      // Removing a listener can trigger pruning which can muck with mergedData/visibleData (as it prunes data).\n      // So defer the unwatcher until we're done.\n      (function(unwatcher) {\n        setTimeout(unwatcher, Math.floor(0));\n      })(queue[i].unwatcher);\n\n      if (queue[i].onComplete) {\n        if (abortReason === 'nodata') {\n          const ref = new Reference(this, queue[i].path);\n          // We set this field immediately, so it's safe to cast to an actual snapshot\n          const lastInput /** @type {!Node} */ = queue[i].currentInputSnapshot;\n          const snapshot = new DataSnapshot(lastInput, ref, PRIORITY_INDEX);\n          callbacks.push(queue[i].onComplete.bind(null, null, false, snapshot));\n        } else {\n          callbacks.push(\n            queue[i].onComplete.bind(null, new Error(abortReason), false, null)\n          );\n        }\n      }\n    }\n  }\n\n  // Clean up completed transactions.\n  this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);\n\n  // Now fire callbacks, now that we're in a good, known state.\n  for (let i = 0; i < callbacks.length; i++) {\n    exceptionGuard(callbacks[i]);\n  }\n\n  // Try to send the transaction result to the server.\n  this.sendReadyTransactions_();\n};\n\n/**\n * Returns the rootmost ancestor node of the specified path that has a pending transaction on it, or just returns\n * the node for the given path if there are no pending transactions on any ancestor.\n *\n * @param {!Path} path The location to start at.\n * @return {!Tree.<Array.<!Transaction>>} The rootmost node with a transaction.\n * @private\n */\n(Repo.prototype as any).getAncestorTransactionNode_ = function(\n  path: Path\n): Tree<Transaction[]> {\n  let front;\n\n  // Start at the root and walk deeper into the tree towards path until we find a node with pending transactions.\n  let transactionNode = this.transactionQueueTree_;\n  while (\n    (front = path.getFront()) !== null &&\n    transactionNode.getValue() === null\n  ) {\n    transactionNode = transactionNode.subTree(front);\n    path = path.popFront();\n  }\n\n  return transactionNode;\n};\n\n/**\n * Builds the queue of all transactions at or below the specified transactionNode.\n *\n * @param {!Tree.<Array.<Transaction>>} transactionNode\n * @return {Array.<Transaction>} The generated queue.\n * @private\n */\n(Repo.prototype as any).buildTransactionQueue_ = function(\n  transactionNode: Tree<Transaction[]>\n): Array<Transaction> {\n  // Walk any child transaction queues and aggregate them into a single queue.\n  const transactionQueue: Transaction[] = [];\n  this.aggregateTransactionQueuesForNode_(transactionNode, transactionQueue);\n\n  // Sort them by the order the transactions were created.\n  transactionQueue.sort(function(a, b) {\n    return a.order - b.order;\n  });\n\n  return transactionQueue;\n};\n\n/**\n * @param {!Tree.<Array.<Transaction>>} node\n * @param {Array.<Transaction>} queue\n * @private\n */\n(Repo.prototype as any).aggregateTransactionQueuesForNode_ = function(\n  node: Tree<Transaction[]>,\n  queue: Array<Transaction>\n) {\n  const nodeQueue = node.getValue();\n  if (nodeQueue !== null) {\n    for (let i = 0; i < nodeQueue.length; i++) {\n      queue.push(nodeQueue[i]);\n    }\n  }\n\n  node.forEachChild(child => {\n    this.aggregateTransactionQueuesForNode_(child, queue);\n  });\n};\n\n/**\n * Remove COMPLETED transactions at or below this node in the transactionQueueTree_.\n *\n * @param {!Tree.<Array.<!Transaction>>} node\n * @private\n */\n(Repo.prototype as any).pruneCompletedTransactionsBelowNode_ = function(\n  node: Tree<Transaction[]>\n) {\n  const queue = node.getValue();\n  if (queue) {\n    let to = 0;\n    for (let from = 0; from < queue.length; from++) {\n      if (queue[from].status !== TransactionStatus.COMPLETED) {\n        queue[to] = queue[from];\n        to++;\n      }\n    }\n    queue.length = to;\n    node.setValue(queue.length > 0 ? queue : null);\n  }\n\n  node.forEachChild(childNode => {\n    this.pruneCompletedTransactionsBelowNode_(childNode);\n  });\n};\n\n/**\n * Aborts all transactions on ancestors or descendants of the specified path.  Called when doing a set() or update()\n * since we consider them incompatible with transactions.\n *\n * @param {!Path} path Path for which we want to abort related transactions.\n * @return {!Path}\n * @private\n */\n(Repo.prototype as any).abortTransactions_ = function(path: Path): Path {\n  const affectedPath = this.getAncestorTransactionNode_(path).path();\n\n  const transactionNode = this.transactionQueueTree_.subTree(path);\n\n  transactionNode.forEachAncestor((node: Tree<Transaction[]>) => {\n    this.abortTransactionsOnNode_(node);\n  });\n\n  this.abortTransactionsOnNode_(transactionNode);\n\n  transactionNode.forEachDescendant((node: Tree<Transaction[]>) => {\n    this.abortTransactionsOnNode_(node);\n  });\n\n  return affectedPath;\n};\n\n/**\n * Abort transactions stored in this transaction queue node.\n *\n * @param {!Tree.<Array.<Transaction>>} node Node to abort transactions for.\n * @private\n */\n(Repo.prototype as any).abortTransactionsOnNode_ = function(\n  node: Tree<Transaction[]>\n) {\n  const queue = node.getValue();\n  if (queue !== null) {\n    // Queue up the callbacks and fire them after cleaning up all of our transaction state, since\n    // the callback could trigger more transactions or sets.\n    const callbacks = [];\n\n    // Go through queue.  Any already-sent transactions must be marked for abort, while the unsent ones\n    // can be immediately aborted and removed.\n    let events: Event[] = [];\n    let lastSent = -1;\n    for (let i = 0; i < queue.length; i++) {\n      if (queue[i].status === TransactionStatus.SENT_NEEDS_ABORT) {\n        // Already marked.  No action needed.\n      } else if (queue[i].status === TransactionStatus.SENT) {\n        assert(\n          lastSent === i - 1,\n          'All SENT items should be at beginning of queue.'\n        );\n        lastSent = i;\n        // Mark transaction for abort when it comes back.\n        queue[i].status = TransactionStatus.SENT_NEEDS_ABORT;\n        queue[i].abortReason = 'set';\n      } else {\n        assert(\n          queue[i].status === TransactionStatus.RUN,\n          'Unexpected transaction status in abort'\n        );\n        // We can abort it immediately.\n        queue[i].unwatcher();\n        events = events.concat(\n          this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId, true)\n        );\n        if (queue[i].onComplete) {\n          const snapshot: DataSnapshot | null = null;\n          callbacks.push(\n            queue[i].onComplete.bind(null, new Error('set'), false, snapshot)\n          );\n        }\n      }\n    }\n    if (lastSent === -1) {\n      // We're not waiting for any sent transactions.  We can clear the queue.\n      node.setValue(null);\n    } else {\n      // Remove the transactions we aborted.\n      queue.length = lastSent + 1;\n    }\n\n    // Now fire the callbacks.\n    this.eventQueue_.raiseEventsForChangedPath(node.path(), events);\n    for (let i = 0; i < callbacks.length; i++) {\n      exceptionGuard(callbacks[i]);\n    }\n  }\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseApp } from '@firebase/app-types';\nimport { safeGet } from '@firebase/util';\nimport { Repo } from './Repo';\nimport { fatal } from './util/util';\nimport { parseRepoInfo } from './util/libs/parser';\nimport { validateUrl } from './util/validation';\nimport './Repo_transaction';\nimport { Database } from '../api/Database';\nimport { RepoInfo } from './RepoInfo';\nimport { FirebaseAuthInternalName } from '@firebase/auth-interop-types';\nimport { Provider } from '@firebase/component';\n\n/** @const {string} */\nconst DATABASE_URL_OPTION = 'databaseURL';\n\n/**\n * This variable is also defined in the firebase node.js admin SDK. Before\n * modifying this definition, consult the definition in:\n *\n * https://github.com/firebase/firebase-admin-node\n *\n * and make sure the two are consistent.\n */\nconst FIREBASE_DATABASE_EMULATOR_HOST_VAR = 'FIREBASE_DATABASE_EMULATOR_HOST';\n\nlet _staticInstance: RepoManager;\n\n/**\n * Creates and caches Repo instances.\n */\nexport class RepoManager {\n  /**\n   * @private {!Object.<string, Object<string, !fb.core.Repo>>}\n   */\n  private repos_: {\n    [appName: string]: {\n      [dbUrl: string]: Repo;\n    };\n  } = {};\n\n  /**\n   * If true, new Repos will be created to use ReadonlyRestClient (for testing purposes).\n   * @private {boolean}\n   */\n  private useRestClient_: boolean = false;\n\n  static getInstance(): RepoManager {\n    if (!_staticInstance) {\n      _staticInstance = new RepoManager();\n    }\n    return _staticInstance;\n  }\n\n  // TODO(koss): Remove these functions unless used in tests?\n  interrupt() {\n    for (const appName in this.repos_) {\n      for (const dbUrl in this.repos_[appName]) {\n        this.repos_[appName][dbUrl].interrupt();\n      }\n    }\n  }\n\n  resume() {\n    for (const appName in this.repos_) {\n      for (const dbUrl in this.repos_[appName]) {\n        this.repos_[appName][dbUrl].resume();\n      }\n    }\n  }\n\n  /**\n   * This function should only ever be called to CREATE a new database instance.\n   *\n   * @param {!FirebaseApp} app\n   * @return {!Database}\n   */\n  databaseFromApp(\n    app: FirebaseApp,\n    authProvider: Provider<FirebaseAuthInternalName>,\n    url?: string\n  ): Database {\n    let dbUrl: string | undefined = url || app.options[DATABASE_URL_OPTION];\n    if (dbUrl === undefined) {\n      fatal(\n        \"Can't determine Firebase Database URL.  Be sure to include \" +\n          DATABASE_URL_OPTION +\n          ' option when calling firebase.initializeApp().'\n      );\n    }\n\n    let parsedUrl = parseRepoInfo(dbUrl);\n    let repoInfo = parsedUrl.repoInfo;\n\n    let dbEmulatorHost: string | undefined = undefined;\n    if (typeof process !== 'undefined') {\n      dbEmulatorHost = process.env[FIREBASE_DATABASE_EMULATOR_HOST_VAR];\n    }\n    if (dbEmulatorHost) {\n      dbUrl = `http://${dbEmulatorHost}?ns=${repoInfo.namespace}`;\n      parsedUrl = parseRepoInfo(dbUrl);\n      repoInfo = parsedUrl.repoInfo;\n    }\n\n    validateUrl('Invalid Firebase Database URL', 1, parsedUrl);\n    if (!parsedUrl.path.isEmpty()) {\n      fatal(\n        'Database URL must point to the root of a Firebase Database ' +\n          '(not including a child path).'\n      );\n    }\n\n    const repo = this.createRepo(repoInfo, app, authProvider);\n\n    return repo.database;\n  }\n\n  /**\n   * Remove the repo and make sure it is disconnected.\n   *\n   * @param {!Repo} repo\n   */\n  deleteRepo(repo: Repo) {\n    const appRepos = safeGet(this.repos_, repo.app.name);\n    // This should never happen...\n    if (!appRepos || safeGet(appRepos, repo.repoInfo_.toURLString()) !== repo) {\n      fatal(\n        `Database ${repo.app.name}(${repo.repoInfo_}) has already been deleted.`\n      );\n    }\n    repo.interrupt();\n    delete appRepos[repo.repoInfo_.toURLString()];\n  }\n\n  /**\n   * Ensures a repo doesn't already exist and then creates one using the\n   * provided app.\n   *\n   * @param {!RepoInfo} repoInfo The metadata about the Repo\n   * @param {!FirebaseApp} app\n   * @return {!Repo} The Repo object for the specified server / repoName.\n   */\n  createRepo(\n    repoInfo: RepoInfo,\n    app: FirebaseApp,\n    authProvider: Provider<FirebaseAuthInternalName>\n  ): Repo {\n    let appRepos = safeGet(this.repos_, app.name);\n\n    if (!appRepos) {\n      appRepos = {};\n      this.repos_[app.name] = appRepos;\n    }\n\n    let repo = safeGet(appRepos, repoInfo.toURLString());\n    if (repo) {\n      fatal(\n        'Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.'\n      );\n    }\n    repo = new Repo(repoInfo, this.useRestClient_, app, authProvider);\n    appRepos[repoInfo.toURLString()] = repo;\n\n    return repo;\n  }\n\n  /**\n   * Forces us to use ReadonlyRestClient instead of PersistentConnection for new Repos.\n   * @param {boolean} forceRestClient\n   */\n  forceRestClient(forceRestClient: boolean) {\n    this.useRestClient_ = forceRestClient;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fatal } from '../core/util/util';\nimport { parseRepoInfo } from '../core/util/libs/parser';\nimport { Path } from '../core/util/Path';\nimport { Reference } from './Reference';\nimport { Repo } from '../core/Repo';\nimport { RepoManager } from '../core/RepoManager';\nimport { validateArgCount } from '@firebase/util';\nimport { validateUrl } from '../core/util/validation';\nimport { FirebaseApp } from '@firebase/app-types';\nimport { FirebaseService } from '@firebase/app-types/private';\nimport { RepoInfo } from '../core/RepoInfo';\nimport { FirebaseDatabase } from '@firebase/database-types';\n\n/**\n * Class representing a firebase database.\n * @implements {FirebaseService}\n */\nexport class Database implements FirebaseService, FirebaseDatabase {\n  INTERNAL: DatabaseInternals;\n  private root_: Reference;\n\n  static readonly ServerValue = {\n    TIMESTAMP: {\n      '.sv': 'timestamp'\n    },\n    _increment: (x: number) => {\n      return {\n        '.sv': {\n          'increment': x\n        }\n      };\n    }\n  };\n\n  /**\n   * The constructor should not be called by users of our public API.\n   * @param {!Repo} repo_\n   */\n  constructor(private repo_: Repo) {\n    if (!(repo_ instanceof Repo)) {\n      fatal(\n        \"Don't call new Database() directly - please use firebase.database().\"\n      );\n    }\n\n    /** @type {Reference} */\n    this.root_ = new Reference(repo_, Path.Empty);\n\n    this.INTERNAL = new DatabaseInternals(this);\n  }\n\n  get app(): FirebaseApp {\n    return this.repo_.app;\n  }\n\n  /**\n   * Returns a reference to the root or to the path specified in the provided\n   * argument.\n\n   * @param {string|Reference=} path The relative string path or an existing\n   * Reference to a database location.\n   * @throws If a Reference is provided, throws if it does not belong to the\n   * same project.\n   * @return {!Reference} Firebase reference.\n   **/\n  ref(path?: string): Reference;\n  ref(path?: Reference): Reference;\n  ref(path?: string | Reference): Reference {\n    this.checkDeleted_('ref');\n    validateArgCount('database.ref', 0, 1, arguments.length);\n\n    if (path instanceof Reference) {\n      return this.refFromURL(path.toString());\n    }\n\n    return path !== undefined ? this.root_.child(path) : this.root_;\n  }\n\n  /**\n   * Returns a reference to the root or the path specified in url.\n   * We throw a exception if the url is not in the same domain as the\n   * current repo.\n   * @param {string} url\n   * @return {!Reference} Firebase reference.\n   */\n  refFromURL(url: string): Reference {\n    /** @const {string} */\n    const apiName = 'database.refFromURL';\n    this.checkDeleted_(apiName);\n    validateArgCount(apiName, 1, 1, arguments.length);\n    const parsedURL = parseRepoInfo(url);\n    validateUrl(apiName, 1, parsedURL);\n\n    const repoInfo = parsedURL.repoInfo;\n    if (repoInfo.host !== ((this.repo_ as any).repoInfo_ as RepoInfo).host) {\n      fatal(\n        apiName +\n          ': Host name does not match the current database: ' +\n          '(found ' +\n          repoInfo.host +\n          ' but expected ' +\n          ((this.repo_ as any).repoInfo_ as RepoInfo).host +\n          ')'\n      );\n    }\n\n    return this.ref(parsedURL.path.toString());\n  }\n\n  /**\n   * @param {string} apiName\n   */\n  private checkDeleted_(apiName: string) {\n    if (this.repo_ === null) {\n      fatal('Cannot call ' + apiName + ' on a deleted database.');\n    }\n  }\n\n  // Make individual repo go offline.\n  goOffline() {\n    validateArgCount('database.goOffline', 0, 0, arguments.length);\n    this.checkDeleted_('goOffline');\n    this.repo_.interrupt();\n  }\n\n  goOnline() {\n    validateArgCount('database.goOnline', 0, 0, arguments.length);\n    this.checkDeleted_('goOnline');\n    this.repo_.resume();\n  }\n}\n\nexport class DatabaseInternals {\n  /** @param {!Database} database */\n  constructor(public database: Database) {}\n\n  /** @return {Promise<void>} */\n  async delete(): Promise<void> {\n    (this.database as any).checkDeleted_('delete');\n    RepoManager.getInstance().deleteRepo((this.database as any).repo_ as Repo);\n\n    (this.database as any).repo_ = null;\n    (this.database as any).root_ = null;\n    this.database.INTERNAL = null;\n    this.database = null;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { WebSocketConnection } from '../realtime/WebSocketConnection';\nimport { BrowserPollConnection } from '../realtime/BrowserPollConnection';\nimport { Reference } from './Reference';\n\n/**\n * INTERNAL methods for internal-use only (tests, etc.).\n *\n * Customers shouldn't use these or else should be aware that they could break at any time.\n *\n * @const\n */\n\nexport const forceLongPolling = function() {\n  WebSocketConnection.forceDisallow();\n  BrowserPollConnection.forceAllow();\n};\n\nexport const forceWebSockets = function() {\n  BrowserPollConnection.forceDisallow();\n};\n\n/* Used by App Manager */\nexport const isWebSocketsAvailable = function(): boolean {\n  return WebSocketConnection['isAvailable']();\n};\n\nexport const setSecurityDebugCallback = function(\n  ref: Reference,\n  callback: (a: Object) => void\n) {\n  (ref.repo.persistentConnection_ as any).securityDebugCallback_ = callback;\n};\n\nexport const stats = function(ref: Reference, showDelta?: boolean) {\n  ref.repo.stats(showDelta);\n};\n\nexport const statsIncrementCounter = function(ref: Reference, metric: string) {\n  ref.repo.statsIncrementCounter(metric);\n};\n\nexport const dataUpdateCount = function(ref: Reference): number {\n  return ref.repo.dataUpdateCount;\n};\n\nexport const interceptServerData = function(\n  ref: Reference,\n  callback: ((a: string, b: any) => void) | null\n) {\n  return ref.repo.interceptServerData_(callback);\n};\n","/**\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RepoInfo } from '../core/RepoInfo';\nimport { PersistentConnection } from '../core/PersistentConnection';\nimport { RepoManager } from '../core/RepoManager';\nimport { Connection } from '../realtime/Connection';\nimport { Query } from './Query';\n\nexport const DataConnection = PersistentConnection;\n\n/**\n * @param {!string} pathString\n * @param {function(*)} onComplete\n */\n(PersistentConnection.prototype as any).simpleListen = function(\n  pathString: string,\n  onComplete: (a: any) => void\n) {\n  this.sendRequest('q', { p: pathString }, onComplete);\n};\n\n/**\n * @param {*} data\n * @param {function(*)} onEcho\n */\n(PersistentConnection.prototype as any).echo = function(\n  data: any,\n  onEcho: (a: any) => void\n) {\n  this.sendRequest('echo', { d: data }, onEcho);\n};\n\n// RealTimeConnection properties that we use in tests.\nexport const RealTimeConnection = Connection;\n\n/**\n * @param {function(): string} newHash\n * @return {function()}\n */\nexport const hijackHash = function(newHash: () => string) {\n  const oldPut = PersistentConnection.prototype.put;\n  PersistentConnection.prototype.put = function(\n    pathString,\n    data,\n    opt_onComplete,\n    opt_hash\n  ) {\n    if (opt_hash !== undefined) {\n      opt_hash = newHash();\n    }\n    oldPut.call(this, pathString, data, opt_onComplete, opt_hash);\n  };\n  return function() {\n    PersistentConnection.prototype.put = oldPut;\n  };\n};\n\n/**\n * @type {function(new:RepoInfo, !string, boolean, !string, boolean): undefined}\n */\nexport const ConnectionTarget = RepoInfo;\n\n/**\n * @param {!Query} query\n * @return {!string}\n */\nexport const queryIdentifier = function(query: Query) {\n  return query.queryIdentifier();\n};\n\n/**\n * Forces the RepoManager to create Repos that use ReadonlyRestClient instead of PersistentConnection.\n *\n * @param {boolean} forceRestClient\n */\nexport const forceRestClient = function(forceRestClient: boolean) {\n  RepoManager.getInstance().forceRestClient(forceRestClient);\n};\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","module.exports = Array.isArray || function (arr) {\n  return Object.prototype.toString.call(arr) == '[object Array]';\n};\n","function isAbsolute(pathname) {\n  return pathname.charAt(0) === '/';\n}\n\n// About 1.5x faster than the two-arg version of Array#splice()\nfunction spliceOne(list, index) {\n  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1) {\n    list[i] = list[k];\n  }\n\n  list.pop();\n}\n\n// This implementation is based heavily on node's url.parse\nfunction resolvePathname(to) {\n  var from = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n  var toParts = to && to.split('/') || [];\n  var fromParts = from && from.split('/') || [];\n\n  var isToAbs = to && isAbsolute(to);\n  var isFromAbs = from && isAbsolute(from);\n  var mustEndAbs = isToAbs || isFromAbs;\n\n  if (to && isAbsolute(to)) {\n    // to is absolute\n    fromParts = toParts;\n  } else if (toParts.length) {\n    // to is relative, drop the filename\n    fromParts.pop();\n    fromParts = fromParts.concat(toParts);\n  }\n\n  if (!fromParts.length) return '/';\n\n  var hasTrailingSlash = void 0;\n  if (fromParts.length) {\n    var last = fromParts[fromParts.length - 1];\n    hasTrailingSlash = last === '.' || last === '..' || last === '';\n  } else {\n    hasTrailingSlash = false;\n  }\n\n  var up = 0;\n  for (var i = fromParts.length; i >= 0; i--) {\n    var part = fromParts[i];\n\n    if (part === '.') {\n      spliceOne(fromParts, i);\n    } else if (part === '..') {\n      spliceOne(fromParts, i);\n      up++;\n    } else if (up) {\n      spliceOne(fromParts, i);\n      up--;\n    }\n  }\n\n  if (!mustEndAbs) for (; up--; up) {\n    fromParts.unshift('..');\n  }if (mustEndAbs && fromParts[0] !== '' && (!fromParts[0] || !isAbsolute(fromParts[0]))) fromParts.unshift('');\n\n  var result = fromParts.join('/');\n\n  if (hasTrailingSlash && result.substr(-1) !== '/') result += '/';\n\n  return result;\n}\n\nexport default resolvePathname;","var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction valueEqual(a, b) {\n  if (a === b) return true;\n\n  if (a == null || b == null) return false;\n\n  if (Array.isArray(a)) {\n    return Array.isArray(b) && a.length === b.length && a.every(function (item, index) {\n      return valueEqual(item, b[index]);\n    });\n  }\n\n  var aType = typeof a === 'undefined' ? 'undefined' : _typeof(a);\n  var bType = typeof b === 'undefined' ? 'undefined' : _typeof(b);\n\n  if (aType !== bType) return false;\n\n  if (aType === 'object') {\n    var aValue = a.valueOf();\n    var bValue = b.valueOf();\n\n    if (aValue !== a || bValue !== b) return valueEqual(aValue, bValue);\n\n    var aKeys = Object.keys(a);\n    var bKeys = Object.keys(b);\n\n    if (aKeys.length !== bKeys.length) return false;\n\n    return aKeys.every(function (key) {\n      return valueEqual(a[key], b[key]);\n    });\n  }\n\n  return false;\n}\n\nexport default valueEqual;","export var addLeadingSlash = function addLeadingSlash(path) {\n  return path.charAt(0) === '/' ? path : '/' + path;\n};\n\nexport var stripLeadingSlash = function stripLeadingSlash(path) {\n  return path.charAt(0) === '/' ? path.substr(1) : path;\n};\n\nexport var hasBasename = function hasBasename(path, prefix) {\n  return new RegExp('^' + prefix + '(\\\\/|\\\\?|#|$)', 'i').test(path);\n};\n\nexport var stripBasename = function stripBasename(path, prefix) {\n  return hasBasename(path, prefix) ? path.substr(prefix.length) : path;\n};\n\nexport var stripTrailingSlash = function stripTrailingSlash(path) {\n  return path.charAt(path.length - 1) === '/' ? path.slice(0, -1) : path;\n};\n\nexport var parsePath = function parsePath(path) {\n  var pathname = path || '/';\n  var search = '';\n  var hash = '';\n\n  var hashIndex = pathname.indexOf('#');\n  if (hashIndex !== -1) {\n    hash = pathname.substr(hashIndex);\n    pathname = pathname.substr(0, hashIndex);\n  }\n\n  var searchIndex = pathname.indexOf('?');\n  if (searchIndex !== -1) {\n    search = pathname.substr(searchIndex);\n    pathname = pathname.substr(0, searchIndex);\n  }\n\n  return {\n    pathname: pathname,\n    search: search === '?' ? '' : search,\n    hash: hash === '#' ? '' : hash\n  };\n};\n\nexport var createPath = function createPath(location) {\n  var pathname = location.pathname,\n      search = location.search,\n      hash = location.hash;\n\n\n  var path = pathname || '/';\n\n  if (search && search !== '?') path += search.charAt(0) === '?' ? search : '?' + search;\n\n  if (hash && hash !== '#') path += hash.charAt(0) === '#' ? hash : '#' + hash;\n\n  return path;\n};","var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nimport resolvePathname from 'resolve-pathname';\nimport valueEqual from 'value-equal';\nimport { parsePath } from './PathUtils';\n\nexport var createLocation = function createLocation(path, state, key, currentLocation) {\n  var location = void 0;\n  if (typeof path === 'string') {\n    // Two-arg form: push(path, state)\n    location = parsePath(path);\n    location.state = state;\n  } else {\n    // One-arg form: push(location)\n    location = _extends({}, path);\n\n    if (location.pathname === undefined) location.pathname = '';\n\n    if (location.search) {\n      if (location.search.charAt(0) !== '?') location.search = '?' + location.search;\n    } else {\n      location.search = '';\n    }\n\n    if (location.hash) {\n      if (location.hash.charAt(0) !== '#') location.hash = '#' + location.hash;\n    } else {\n      location.hash = '';\n    }\n\n    if (state !== undefined && location.state === undefined) location.state = state;\n  }\n\n  try {\n    location.pathname = decodeURI(location.pathname);\n  } catch (e) {\n    if (e instanceof URIError) {\n      throw new URIError('Pathname \"' + location.pathname + '\" could not be decoded. ' + 'This is likely caused by an invalid percent-encoding.');\n    } else {\n      throw e;\n    }\n  }\n\n  if (key) location.key = key;\n\n  if (currentLocation) {\n    // Resolve incomplete/relative pathname relative to current location.\n    if (!location.pathname) {\n      location.pathname = currentLocation.pathname;\n    } else if (location.pathname.charAt(0) !== '/') {\n      location.pathname = resolvePathname(location.pathname, currentLocation.pathname);\n    }\n  } else {\n    // When there is no prior location and pathname is empty, set it to /\n    if (!location.pathname) {\n      location.pathname = '/';\n    }\n  }\n\n  return location;\n};\n\nexport var locationsAreEqual = function locationsAreEqual(a, b) {\n  return a.pathname === b.pathname && a.search === b.search && a.hash === b.hash && a.key === b.key && valueEqual(a.state, b.state);\n};","import warning from 'warning';\n\nvar createTransitionManager = function createTransitionManager() {\n  var prompt = null;\n\n  var setPrompt = function setPrompt(nextPrompt) {\n    warning(prompt == null, 'A history supports only one prompt at a time');\n\n    prompt = nextPrompt;\n\n    return function () {\n      if (prompt === nextPrompt) prompt = null;\n    };\n  };\n\n  var confirmTransitionTo = function confirmTransitionTo(location, action, getUserConfirmation, callback) {\n    // TODO: If another transition starts while we're still confirming\n    // the previous one, we may end up in a weird state. Figure out the\n    // best way to handle this.\n    if (prompt != null) {\n      var result = typeof prompt === 'function' ? prompt(location, action) : prompt;\n\n      if (typeof result === 'string') {\n        if (typeof getUserConfirmation === 'function') {\n          getUserConfirmation(result, callback);\n        } else {\n          warning(false, 'A history needs a getUserConfirmation function in order to use a prompt message');\n\n          callback(true);\n        }\n      } else {\n        // Return false from a transition hook to cancel the transition.\n        callback(result !== false);\n      }\n    } else {\n      callback(true);\n    }\n  };\n\n  var listeners = [];\n\n  var appendListener = function appendListener(fn) {\n    var isActive = true;\n\n    var listener = function listener() {\n      if (isActive) fn.apply(undefined, arguments);\n    };\n\n    listeners.push(listener);\n\n    return function () {\n      isActive = false;\n      listeners = listeners.filter(function (item) {\n        return item !== listener;\n      });\n    };\n  };\n\n  var notifyListeners = function notifyListeners() {\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    listeners.forEach(function (listener) {\n      return listener.apply(undefined, args);\n    });\n  };\n\n  return {\n    setPrompt: setPrompt,\n    confirmTransitionTo: confirmTransitionTo,\n    appendListener: appendListener,\n    notifyListeners: notifyListeners\n  };\n};\n\nexport default createTransitionManager;","export var canUseDOM = !!(typeof window !== 'undefined' && window.document && window.document.createElement);\n\nexport var addEventListener = function addEventListener(node, event, listener) {\n  return node.addEventListener ? node.addEventListener(event, listener, false) : node.attachEvent('on' + event, listener);\n};\n\nexport var removeEventListener = function removeEventListener(node, event, listener) {\n  return node.removeEventListener ? node.removeEventListener(event, listener, false) : node.detachEvent('on' + event, listener);\n};\n\nexport var getConfirmation = function getConfirmation(message, callback) {\n  return callback(window.confirm(message));\n}; // eslint-disable-line no-alert\n\n/**\n * Returns true if the HTML5 history API is supported. Taken from Modernizr.\n *\n * https://github.com/Modernizr/Modernizr/blob/master/LICENSE\n * https://github.com/Modernizr/Modernizr/blob/master/feature-detects/history.js\n * changed to avoid false negatives for Windows Phones: https://github.com/reactjs/react-router/issues/586\n */\nexport var supportsHistory = function supportsHistory() {\n  var ua = window.navigator.userAgent;\n\n  if ((ua.indexOf('Android 2.') !== -1 || ua.indexOf('Android 4.0') !== -1) && ua.indexOf('Mobile Safari') !== -1 && ua.indexOf('Chrome') === -1 && ua.indexOf('Windows Phone') === -1) return false;\n\n  return window.history && 'pushState' in window.history;\n};\n\n/**\n * Returns true if browser fires popstate on hash change.\n * IE10 and IE11 do not.\n */\nexport var supportsPopStateOnHashChange = function supportsPopStateOnHashChange() {\n  return window.navigator.userAgent.indexOf('Trident') === -1;\n};\n\n/**\n * Returns false if using go(n) with hash history causes a full page reload.\n */\nexport var supportsGoWithoutReloadUsingHash = function supportsGoWithoutReloadUsingHash() {\n  return window.navigator.userAgent.indexOf('Firefox') === -1;\n};\n\n/**\n * Returns true if a given popstate event is an extraneous WebKit event.\n * Accounts for the fact that Chrome on iOS fires real popstate events\n * containing undefined state when pressing the back button.\n */\nexport var isExtraneousPopstateEvent = function isExtraneousPopstateEvent(event) {\n  return event.state === undefined && navigator.userAgent.indexOf('CriOS') === -1;\n};","var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nimport warning from 'warning';\nimport invariant from 'invariant';\nimport { createLocation } from './LocationUtils';\nimport { addLeadingSlash, stripTrailingSlash, hasBasename, stripBasename, createPath } from './PathUtils';\nimport createTransitionManager from './createTransitionManager';\nimport { canUseDOM, addEventListener, removeEventListener, getConfirmation, supportsHistory, supportsPopStateOnHashChange, isExtraneousPopstateEvent } from './DOMUtils';\n\nvar PopStateEvent = 'popstate';\nvar HashChangeEvent = 'hashchange';\n\nvar getHistoryState = function getHistoryState() {\n  try {\n    return window.history.state || {};\n  } catch (e) {\n    // IE 11 sometimes throws when accessing window.history.state\n    // See https://github.com/ReactTraining/history/pull/289\n    return {};\n  }\n};\n\n/**\n * Creates a history object that uses the HTML5 history API including\n * pushState, replaceState, and the popstate event.\n */\nvar createBrowserHistory = function createBrowserHistory() {\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  invariant(canUseDOM, 'Browser history needs a DOM');\n\n  var globalHistory = window.history;\n  var canUseHistory = supportsHistory();\n  var needsHashChangeListener = !supportsPopStateOnHashChange();\n\n  var _props$forceRefresh = props.forceRefresh,\n      forceRefresh = _props$forceRefresh === undefined ? false : _props$forceRefresh,\n      _props$getUserConfirm = props.getUserConfirmation,\n      getUserConfirmation = _props$getUserConfirm === undefined ? getConfirmation : _props$getUserConfirm,\n      _props$keyLength = props.keyLength,\n      keyLength = _props$keyLength === undefined ? 6 : _props$keyLength;\n\n  var basename = props.basename ? stripTrailingSlash(addLeadingSlash(props.basename)) : '';\n\n  var getDOMLocation = function getDOMLocation(historyState) {\n    var _ref = historyState || {},\n        key = _ref.key,\n        state = _ref.state;\n\n    var _window$location = window.location,\n        pathname = _window$location.pathname,\n        search = _window$location.search,\n        hash = _window$location.hash;\n\n\n    var path = pathname + search + hash;\n\n    warning(!basename || hasBasename(path, basename), 'You are attempting to use a basename on a page whose URL path does not begin ' + 'with the basename. Expected path \"' + path + '\" to begin with \"' + basename + '\".');\n\n    if (basename) path = stripBasename(path, basename);\n\n    return createLocation(path, state, key);\n  };\n\n  var createKey = function createKey() {\n    return Math.random().toString(36).substr(2, keyLength);\n  };\n\n  var transitionManager = createTransitionManager();\n\n  var setState = function setState(nextState) {\n    _extends(history, nextState);\n\n    history.length = globalHistory.length;\n\n    transitionManager.notifyListeners(history.location, history.action);\n  };\n\n  var handlePopState = function handlePopState(event) {\n    // Ignore extraneous popstate events in WebKit.\n    if (isExtraneousPopstateEvent(event)) return;\n\n    handlePop(getDOMLocation(event.state));\n  };\n\n  var handleHashChange = function handleHashChange() {\n    handlePop(getDOMLocation(getHistoryState()));\n  };\n\n  var forceNextPop = false;\n\n  var handlePop = function handlePop(location) {\n    if (forceNextPop) {\n      forceNextPop = false;\n      setState();\n    } else {\n      var action = 'POP';\n\n      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n        if (ok) {\n          setState({ action: action, location: location });\n        } else {\n          revertPop(location);\n        }\n      });\n    }\n  };\n\n  var revertPop = function revertPop(fromLocation) {\n    var toLocation = history.location;\n\n    // TODO: We could probably make this more reliable by\n    // keeping a list of keys we've seen in sessionStorage.\n    // Instead, we just default to 0 for keys we don't know.\n\n    var toIndex = allKeys.indexOf(toLocation.key);\n\n    if (toIndex === -1) toIndex = 0;\n\n    var fromIndex = allKeys.indexOf(fromLocation.key);\n\n    if (fromIndex === -1) fromIndex = 0;\n\n    var delta = toIndex - fromIndex;\n\n    if (delta) {\n      forceNextPop = true;\n      go(delta);\n    }\n  };\n\n  var initialLocation = getDOMLocation(getHistoryState());\n  var allKeys = [initialLocation.key];\n\n  // Public interface\n\n  var createHref = function createHref(location) {\n    return basename + createPath(location);\n  };\n\n  var push = function push(path, state) {\n    warning(!((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to push when the 1st ' + 'argument is a location-like object that already has state; it is ignored');\n\n    var action = 'PUSH';\n    var location = createLocation(path, state, createKey(), history.location);\n\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n      if (!ok) return;\n\n      var href = createHref(location);\n      var key = location.key,\n          state = location.state;\n\n\n      if (canUseHistory) {\n        globalHistory.pushState({ key: key, state: state }, null, href);\n\n        if (forceRefresh) {\n          window.location.href = href;\n        } else {\n          var prevIndex = allKeys.indexOf(history.location.key);\n          var nextKeys = allKeys.slice(0, prevIndex === -1 ? 0 : prevIndex + 1);\n\n          nextKeys.push(location.key);\n          allKeys = nextKeys;\n\n          setState({ action: action, location: location });\n        }\n      } else {\n        warning(state === undefined, 'Browser history cannot push state in browsers that do not support HTML5 history');\n\n        window.location.href = href;\n      }\n    });\n  };\n\n  var replace = function replace(path, state) {\n    warning(!((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to replace when the 1st ' + 'argument is a location-like object that already has state; it is ignored');\n\n    var action = 'REPLACE';\n    var location = createLocation(path, state, createKey(), history.location);\n\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n      if (!ok) return;\n\n      var href = createHref(location);\n      var key = location.key,\n          state = location.state;\n\n\n      if (canUseHistory) {\n        globalHistory.replaceState({ key: key, state: state }, null, href);\n\n        if (forceRefresh) {\n          window.location.replace(href);\n        } else {\n          var prevIndex = allKeys.indexOf(history.location.key);\n\n          if (prevIndex !== -1) allKeys[prevIndex] = location.key;\n\n          setState({ action: action, location: location });\n        }\n      } else {\n        warning(state === undefined, 'Browser history cannot replace state in browsers that do not support HTML5 history');\n\n        window.location.replace(href);\n      }\n    });\n  };\n\n  var go = function go(n) {\n    globalHistory.go(n);\n  };\n\n  var goBack = function goBack() {\n    return go(-1);\n  };\n\n  var goForward = function goForward() {\n    return go(1);\n  };\n\n  var listenerCount = 0;\n\n  var checkDOMListeners = function checkDOMListeners(delta) {\n    listenerCount += delta;\n\n    if (listenerCount === 1) {\n      addEventListener(window, PopStateEvent, handlePopState);\n\n      if (needsHashChangeListener) addEventListener(window, HashChangeEvent, handleHashChange);\n    } else if (listenerCount === 0) {\n      removeEventListener(window, PopStateEvent, handlePopState);\n\n      if (needsHashChangeListener) removeEventListener(window, HashChangeEvent, handleHashChange);\n    }\n  };\n\n  var isBlocked = false;\n\n  var block = function block() {\n    var prompt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    var unblock = transitionManager.setPrompt(prompt);\n\n    if (!isBlocked) {\n      checkDOMListeners(1);\n      isBlocked = true;\n    }\n\n    return function () {\n      if (isBlocked) {\n        isBlocked = false;\n        checkDOMListeners(-1);\n      }\n\n      return unblock();\n    };\n  };\n\n  var listen = function listen(listener) {\n    var unlisten = transitionManager.appendListener(listener);\n    checkDOMListeners(1);\n\n    return function () {\n      checkDOMListeners(-1);\n      unlisten();\n    };\n  };\n\n  var history = {\n    length: globalHistory.length,\n    action: 'POP',\n    location: initialLocation,\n    createHref: createHref,\n    push: push,\n    replace: replace,\n    go: go,\n    goBack: goBack,\n    goForward: goForward,\n    block: block,\n    listen: listen\n  };\n\n  return history;\n};\n\nexport default createBrowserHistory;","var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nimport warning from \"warning\";\nimport invariant from \"invariant\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\n\n/**\n * The public API for putting history on context.\n */\n\nvar Router = function (_React$Component) {\n  _inherits(Router, _React$Component);\n\n  function Router() {\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, Router);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.state = {\n      match: _this.computeMatch(_this.props.history.location.pathname)\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  Router.prototype.getChildContext = function getChildContext() {\n    return {\n      router: _extends({}, this.context.router, {\n        history: this.props.history,\n        route: {\n          location: this.props.history.location,\n          match: this.state.match\n        }\n      })\n    };\n  };\n\n  Router.prototype.computeMatch = function computeMatch(pathname) {\n    return {\n      path: \"/\",\n      url: \"/\",\n      params: {},\n      isExact: pathname === \"/\"\n    };\n  };\n\n  Router.prototype.componentWillMount = function componentWillMount() {\n    var _this2 = this;\n\n    var _props = this.props,\n        children = _props.children,\n        history = _props.history;\n\n\n    invariant(children == null || React.Children.count(children) === 1, \"A <Router> may have only one child element\");\n\n    // Do this here so we can setState when a <Redirect> changes the\n    // location in componentWillMount. This happens e.g. when doing\n    // server rendering using a <StaticRouter>.\n    this.unlisten = history.listen(function () {\n      _this2.setState({\n        match: _this2.computeMatch(history.location.pathname)\n      });\n    });\n  };\n\n  Router.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    warning(this.props.history === nextProps.history, \"You cannot change <Router history>\");\n  };\n\n  Router.prototype.componentWillUnmount = function componentWillUnmount() {\n    this.unlisten();\n  };\n\n  Router.prototype.render = function render() {\n    var children = this.props.children;\n\n    return children ? React.Children.only(children) : null;\n  };\n\n  return Router;\n}(React.Component);\n\nRouter.propTypes = {\n  history: PropTypes.object.isRequired,\n  children: PropTypes.node\n};\nRouter.contextTypes = {\n  router: PropTypes.object\n};\nRouter.childContextTypes = {\n  router: PropTypes.object.isRequired\n};\n\n\nexport default Router;","var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nimport warning from 'warning';\nimport invariant from 'invariant';\nimport { createLocation, locationsAreEqual } from './LocationUtils';\nimport { addLeadingSlash, stripLeadingSlash, stripTrailingSlash, hasBasename, stripBasename, createPath } from './PathUtils';\nimport createTransitionManager from './createTransitionManager';\nimport { canUseDOM, addEventListener, removeEventListener, getConfirmation, supportsGoWithoutReloadUsingHash } from './DOMUtils';\n\nvar HashChangeEvent = 'hashchange';\n\nvar HashPathCoders = {\n  hashbang: {\n    encodePath: function encodePath(path) {\n      return path.charAt(0) === '!' ? path : '!/' + stripLeadingSlash(path);\n    },\n    decodePath: function decodePath(path) {\n      return path.charAt(0) === '!' ? path.substr(1) : path;\n    }\n  },\n  noslash: {\n    encodePath: stripLeadingSlash,\n    decodePath: addLeadingSlash\n  },\n  slash: {\n    encodePath: addLeadingSlash,\n    decodePath: addLeadingSlash\n  }\n};\n\nvar getHashPath = function getHashPath() {\n  // We can't use window.location.hash here because it's not\n  // consistent across browsers - Firefox will pre-decode it!\n  var href = window.location.href;\n  var hashIndex = href.indexOf('#');\n  return hashIndex === -1 ? '' : href.substring(hashIndex + 1);\n};\n\nvar pushHashPath = function pushHashPath(path) {\n  return window.location.hash = path;\n};\n\nvar replaceHashPath = function replaceHashPath(path) {\n  var hashIndex = window.location.href.indexOf('#');\n\n  window.location.replace(window.location.href.slice(0, hashIndex >= 0 ? hashIndex : 0) + '#' + path);\n};\n\nvar createHashHistory = function createHashHistory() {\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  invariant(canUseDOM, 'Hash history needs a DOM');\n\n  var globalHistory = window.history;\n  var canGoWithoutReload = supportsGoWithoutReloadUsingHash();\n\n  var _props$getUserConfirm = props.getUserConfirmation,\n      getUserConfirmation = _props$getUserConfirm === undefined ? getConfirmation : _props$getUserConfirm,\n      _props$hashType = props.hashType,\n      hashType = _props$hashType === undefined ? 'slash' : _props$hashType;\n\n  var basename = props.basename ? stripTrailingSlash(addLeadingSlash(props.basename)) : '';\n\n  var _HashPathCoders$hashT = HashPathCoders[hashType],\n      encodePath = _HashPathCoders$hashT.encodePath,\n      decodePath = _HashPathCoders$hashT.decodePath;\n\n\n  var getDOMLocation = function getDOMLocation() {\n    var path = decodePath(getHashPath());\n\n    warning(!basename || hasBasename(path, basename), 'You are attempting to use a basename on a page whose URL path does not begin ' + 'with the basename. Expected path \"' + path + '\" to begin with \"' + basename + '\".');\n\n    if (basename) path = stripBasename(path, basename);\n\n    return createLocation(path);\n  };\n\n  var transitionManager = createTransitionManager();\n\n  var setState = function setState(nextState) {\n    _extends(history, nextState);\n\n    history.length = globalHistory.length;\n\n    transitionManager.notifyListeners(history.location, history.action);\n  };\n\n  var forceNextPop = false;\n  var ignorePath = null;\n\n  var handleHashChange = function handleHashChange() {\n    var path = getHashPath();\n    var encodedPath = encodePath(path);\n\n    if (path !== encodedPath) {\n      // Ensure we always have a properly-encoded hash.\n      replaceHashPath(encodedPath);\n    } else {\n      var location = getDOMLocation();\n      var prevLocation = history.location;\n\n      if (!forceNextPop && locationsAreEqual(prevLocation, location)) return; // A hashchange doesn't always == location change.\n\n      if (ignorePath === createPath(location)) return; // Ignore this change; we already setState in push/replace.\n\n      ignorePath = null;\n\n      handlePop(location);\n    }\n  };\n\n  var handlePop = function handlePop(location) {\n    if (forceNextPop) {\n      forceNextPop = false;\n      setState();\n    } else {\n      var action = 'POP';\n\n      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n        if (ok) {\n          setState({ action: action, location: location });\n        } else {\n          revertPop(location);\n        }\n      });\n    }\n  };\n\n  var revertPop = function revertPop(fromLocation) {\n    var toLocation = history.location;\n\n    // TODO: We could probably make this more reliable by\n    // keeping a list of paths we've seen in sessionStorage.\n    // Instead, we just default to 0 for paths we don't know.\n\n    var toIndex = allPaths.lastIndexOf(createPath(toLocation));\n\n    if (toIndex === -1) toIndex = 0;\n\n    var fromIndex = allPaths.lastIndexOf(createPath(fromLocation));\n\n    if (fromIndex === -1) fromIndex = 0;\n\n    var delta = toIndex - fromIndex;\n\n    if (delta) {\n      forceNextPop = true;\n      go(delta);\n    }\n  };\n\n  // Ensure the hash is encoded properly before doing anything else.\n  var path = getHashPath();\n  var encodedPath = encodePath(path);\n\n  if (path !== encodedPath) replaceHashPath(encodedPath);\n\n  var initialLocation = getDOMLocation();\n  var allPaths = [createPath(initialLocation)];\n\n  // Public interface\n\n  var createHref = function createHref(location) {\n    return '#' + encodePath(basename + createPath(location));\n  };\n\n  var push = function push(path, state) {\n    warning(state === undefined, 'Hash history cannot push state; it is ignored');\n\n    var action = 'PUSH';\n    var location = createLocation(path, undefined, undefined, history.location);\n\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n      if (!ok) return;\n\n      var path = createPath(location);\n      var encodedPath = encodePath(basename + path);\n      var hashChanged = getHashPath() !== encodedPath;\n\n      if (hashChanged) {\n        // We cannot tell if a hashchange was caused by a PUSH, so we'd\n        // rather setState here and ignore the hashchange. The caveat here\n        // is that other hash histories in the page will consider it a POP.\n        ignorePath = path;\n        pushHashPath(encodedPath);\n\n        var prevIndex = allPaths.lastIndexOf(createPath(history.location));\n        var nextPaths = allPaths.slice(0, prevIndex === -1 ? 0 : prevIndex + 1);\n\n        nextPaths.push(path);\n        allPaths = nextPaths;\n\n        setState({ action: action, location: location });\n      } else {\n        warning(false, 'Hash history cannot PUSH the same path; a new entry will not be added to the history stack');\n\n        setState();\n      }\n    });\n  };\n\n  var replace = function replace(path, state) {\n    warning(state === undefined, 'Hash history cannot replace state; it is ignored');\n\n    var action = 'REPLACE';\n    var location = createLocation(path, undefined, undefined, history.location);\n\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n      if (!ok) return;\n\n      var path = createPath(location);\n      var encodedPath = encodePath(basename + path);\n      var hashChanged = getHashPath() !== encodedPath;\n\n      if (hashChanged) {\n        // We cannot tell if a hashchange was caused by a REPLACE, so we'd\n        // rather setState here and ignore the hashchange. The caveat here\n        // is that other hash histories in the page will consider it a POP.\n        ignorePath = path;\n        replaceHashPath(encodedPath);\n      }\n\n      var prevIndex = allPaths.indexOf(createPath(history.location));\n\n      if (prevIndex !== -1) allPaths[prevIndex] = path;\n\n      setState({ action: action, location: location });\n    });\n  };\n\n  var go = function go(n) {\n    warning(canGoWithoutReload, 'Hash history go(n) causes a full page reload in this browser');\n\n    globalHistory.go(n);\n  };\n\n  var goBack = function goBack() {\n    return go(-1);\n  };\n\n  var goForward = function goForward() {\n    return go(1);\n  };\n\n  var listenerCount = 0;\n\n  var checkDOMListeners = function checkDOMListeners(delta) {\n    listenerCount += delta;\n\n    if (listenerCount === 1) {\n      addEventListener(window, HashChangeEvent, handleHashChange);\n    } else if (listenerCount === 0) {\n      removeEventListener(window, HashChangeEvent, handleHashChange);\n    }\n  };\n\n  var isBlocked = false;\n\n  var block = function block() {\n    var prompt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    var unblock = transitionManager.setPrompt(prompt);\n\n    if (!isBlocked) {\n      checkDOMListeners(1);\n      isBlocked = true;\n    }\n\n    return function () {\n      if (isBlocked) {\n        isBlocked = false;\n        checkDOMListeners(-1);\n      }\n\n      return unblock();\n    };\n  };\n\n  var listen = function listen(listener) {\n    var unlisten = transitionManager.appendListener(listener);\n    checkDOMListeners(1);\n\n    return function () {\n      checkDOMListeners(-1);\n      unlisten();\n    };\n  };\n\n  var history = {\n    length: globalHistory.length,\n    action: 'POP',\n    location: initialLocation,\n    createHref: createHref,\n    push: push,\n    replace: replace,\n    go: go,\n    goBack: goBack,\n    goForward: goForward,\n    block: block,\n    listen: listen\n  };\n\n  return history;\n};\n\nexport default createHashHistory;","var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nimport warning from 'warning';\nimport { createPath } from './PathUtils';\nimport { createLocation } from './LocationUtils';\nimport createTransitionManager from './createTransitionManager';\n\nvar clamp = function clamp(n, lowerBound, upperBound) {\n  return Math.min(Math.max(n, lowerBound), upperBound);\n};\n\n/**\n * Creates a history object that stores locations in memory.\n */\nvar createMemoryHistory = function createMemoryHistory() {\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var getUserConfirmation = props.getUserConfirmation,\n      _props$initialEntries = props.initialEntries,\n      initialEntries = _props$initialEntries === undefined ? ['/'] : _props$initialEntries,\n      _props$initialIndex = props.initialIndex,\n      initialIndex = _props$initialIndex === undefined ? 0 : _props$initialIndex,\n      _props$keyLength = props.keyLength,\n      keyLength = _props$keyLength === undefined ? 6 : _props$keyLength;\n\n\n  var transitionManager = createTransitionManager();\n\n  var setState = function setState(nextState) {\n    _extends(history, nextState);\n\n    history.length = history.entries.length;\n\n    transitionManager.notifyListeners(history.location, history.action);\n  };\n\n  var createKey = function createKey() {\n    return Math.random().toString(36).substr(2, keyLength);\n  };\n\n  var index = clamp(initialIndex, 0, initialEntries.length - 1);\n  var entries = initialEntries.map(function (entry) {\n    return typeof entry === 'string' ? createLocation(entry, undefined, createKey()) : createLocation(entry, undefined, entry.key || createKey());\n  });\n\n  // Public interface\n\n  var createHref = createPath;\n\n  var push = function push(path, state) {\n    warning(!((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to push when the 1st ' + 'argument is a location-like object that already has state; it is ignored');\n\n    var action = 'PUSH';\n    var location = createLocation(path, state, createKey(), history.location);\n\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n      if (!ok) return;\n\n      var prevIndex = history.index;\n      var nextIndex = prevIndex + 1;\n\n      var nextEntries = history.entries.slice(0);\n      if (nextEntries.length > nextIndex) {\n        nextEntries.splice(nextIndex, nextEntries.length - nextIndex, location);\n      } else {\n        nextEntries.push(location);\n      }\n\n      setState({\n        action: action,\n        location: location,\n        index: nextIndex,\n        entries: nextEntries\n      });\n    });\n  };\n\n  var replace = function replace(path, state) {\n    warning(!((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to replace when the 1st ' + 'argument is a location-like object that already has state; it is ignored');\n\n    var action = 'REPLACE';\n    var location = createLocation(path, state, createKey(), history.location);\n\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n      if (!ok) return;\n\n      history.entries[history.index] = location;\n\n      setState({ action: action, location: location });\n    });\n  };\n\n  var go = function go(n) {\n    var nextIndex = clamp(history.index + n, 0, history.entries.length - 1);\n\n    var action = 'POP';\n    var location = history.entries[nextIndex];\n\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n      if (ok) {\n        setState({\n          action: action,\n          location: location,\n          index: nextIndex\n        });\n      } else {\n        // Mimic the behavior of DOM histories by\n        // causing a render after a cancelled POP.\n        setState();\n      }\n    });\n  };\n\n  var goBack = function goBack() {\n    return go(-1);\n  };\n\n  var goForward = function goForward() {\n    return go(1);\n  };\n\n  var canGo = function canGo(n) {\n    var nextIndex = history.index + n;\n    return nextIndex >= 0 && nextIndex < history.entries.length;\n  };\n\n  var block = function block() {\n    var prompt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    return transitionManager.setPrompt(prompt);\n  };\n\n  var listen = function listen(listener) {\n    return transitionManager.appendListener(listener);\n  };\n\n  var history = {\n    length: entries.length,\n    action: 'POP',\n    location: entries[index],\n    index: index,\n    entries: entries,\n    createHref: createHref,\n    push: push,\n    replace: replace,\n    go: go,\n    goBack: goBack,\n    goForward: goForward,\n    canGo: canGo,\n    block: block,\n    listen: listen\n  };\n\n  return history;\n};\n\nexport default createMemoryHistory;","// Written in this round about way for babel-transform-imports\nimport Router from \"react-router/es/Router\";\n\nexport default Router;","function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nimport warning from \"warning\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { createBrowserHistory as createHistory } from \"history\";\nimport Router from \"./Router\";\n\n/**\n * The public API for a <Router> that uses HTML5 history.\n */\n\nvar BrowserRouter = function (_React$Component) {\n  _inherits(BrowserRouter, _React$Component);\n\n  function BrowserRouter() {\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, BrowserRouter);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.history = createHistory(_this.props), _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  BrowserRouter.prototype.componentWillMount = function componentWillMount() {\n    warning(!this.props.history, \"<BrowserRouter> ignores the history prop. To use a custom history, \" + \"use `import { Router }` instead of `import { BrowserRouter as Router }`.\");\n  };\n\n  BrowserRouter.prototype.render = function render() {\n    return React.createElement(Router, { history: this.history, children: this.props.children });\n  };\n\n  return BrowserRouter;\n}(React.Component);\n\nBrowserRouter.propTypes = {\n  basename: PropTypes.string,\n  forceRefresh: PropTypes.bool,\n  getUserConfirmation: PropTypes.func,\n  keyLength: PropTypes.number,\n  children: PropTypes.node\n};\n\n\nexport default BrowserRouter;","var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nimport warning from \"warning\";\nimport invariant from \"invariant\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport matchPath from \"./matchPath\";\n\nvar isEmptyChildren = function isEmptyChildren(children) {\n  return React.Children.count(children) === 0;\n};\n\n/**\n * The public API for matching a single path and rendering.\n */\n\nvar Route = function (_React$Component) {\n  _inherits(Route, _React$Component);\n\n  function Route() {\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, Route);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.state = {\n      match: _this.computeMatch(_this.props, _this.context.router)\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  Route.prototype.getChildContext = function getChildContext() {\n    return {\n      router: _extends({}, this.context.router, {\n        route: {\n          location: this.props.location || this.context.router.route.location,\n          match: this.state.match\n        }\n      })\n    };\n  };\n\n  Route.prototype.computeMatch = function computeMatch(_ref, router) {\n    var computedMatch = _ref.computedMatch,\n        location = _ref.location,\n        path = _ref.path,\n        strict = _ref.strict,\n        exact = _ref.exact,\n        sensitive = _ref.sensitive;\n\n    if (computedMatch) return computedMatch; // <Switch> already computed the match for us\n\n    invariant(router, \"You should not use <Route> or withRouter() outside a <Router>\");\n\n    var route = router.route;\n\n    var pathname = (location || route.location).pathname;\n\n    return matchPath(pathname, { path: path, strict: strict, exact: exact, sensitive: sensitive }, route.match);\n  };\n\n  Route.prototype.componentWillMount = function componentWillMount() {\n    warning(!(this.props.component && this.props.render), \"You should not use <Route component> and <Route render> in the same route; <Route render> will be ignored\");\n\n    warning(!(this.props.component && this.props.children && !isEmptyChildren(this.props.children)), \"You should not use <Route component> and <Route children> in the same route; <Route children> will be ignored\");\n\n    warning(!(this.props.render && this.props.children && !isEmptyChildren(this.props.children)), \"You should not use <Route render> and <Route children> in the same route; <Route children> will be ignored\");\n  };\n\n  Route.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps, nextContext) {\n    warning(!(nextProps.location && !this.props.location), '<Route> elements should not change from uncontrolled to controlled (or vice versa). You initially used no \"location\" prop and then provided one on a subsequent render.');\n\n    warning(!(!nextProps.location && this.props.location), '<Route> elements should not change from controlled to uncontrolled (or vice versa). You provided a \"location\" prop initially but omitted it on a subsequent render.');\n\n    this.setState({\n      match: this.computeMatch(nextProps, nextContext.router)\n    });\n  };\n\n  Route.prototype.render = function render() {\n    var match = this.state.match;\n    var _props = this.props,\n        children = _props.children,\n        component = _props.component,\n        render = _props.render;\n    var _context$router = this.context.router,\n        history = _context$router.history,\n        route = _context$router.route,\n        staticContext = _context$router.staticContext;\n\n    var location = this.props.location || route.location;\n    var props = { match: match, location: location, history: history, staticContext: staticContext };\n\n    if (component) return match ? React.createElement(component, props) : null;\n\n    if (render) return match ? render(props) : null;\n\n    if (typeof children === \"function\") return children(props);\n\n    if (children && !isEmptyChildren(children)) return React.Children.only(children);\n\n    return null;\n  };\n\n  return Route;\n}(React.Component);\n\nRoute.propTypes = {\n  computedMatch: PropTypes.object, // private, from <Switch>\n  path: PropTypes.string,\n  exact: PropTypes.bool,\n  strict: PropTypes.bool,\n  sensitive: PropTypes.bool,\n  component: PropTypes.func,\n  render: PropTypes.func,\n  children: PropTypes.oneOfType([PropTypes.func, PropTypes.node]),\n  location: PropTypes.object\n};\nRoute.contextTypes = {\n  router: PropTypes.shape({\n    history: PropTypes.object.isRequired,\n    route: PropTypes.object.isRequired,\n    staticContext: PropTypes.object\n  })\n};\nRoute.childContextTypes = {\n  router: PropTypes.object.isRequired\n};\n\n\nexport default Route;","// Written in this round about way for babel-transform-imports\nimport Route from \"react-router/es/Route\";\n\nexport default Route;","function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport warning from \"warning\";\nimport invariant from \"invariant\";\nimport matchPath from \"./matchPath\";\n\n/**\n * The public API for rendering the first <Route> that matches.\n */\n\nvar Switch = function (_React$Component) {\n  _inherits(Switch, _React$Component);\n\n  function Switch() {\n    _classCallCheck(this, Switch);\n\n    return _possibleConstructorReturn(this, _React$Component.apply(this, arguments));\n  }\n\n  Switch.prototype.componentWillMount = function componentWillMount() {\n    invariant(this.context.router, \"You should not use <Switch> outside a <Router>\");\n  };\n\n  Switch.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    warning(!(nextProps.location && !this.props.location), '<Switch> elements should not change from uncontrolled to controlled (or vice versa). You initially used no \"location\" prop and then provided one on a subsequent render.');\n\n    warning(!(!nextProps.location && this.props.location), '<Switch> elements should not change from controlled to uncontrolled (or vice versa). You provided a \"location\" prop initially but omitted it on a subsequent render.');\n  };\n\n  Switch.prototype.render = function render() {\n    var route = this.context.router.route;\n    var children = this.props.children;\n\n    var location = this.props.location || route.location;\n\n    var match = void 0,\n        child = void 0;\n    React.Children.forEach(children, function (element) {\n      if (match == null && React.isValidElement(element)) {\n        var _element$props = element.props,\n            pathProp = _element$props.path,\n            exact = _element$props.exact,\n            strict = _element$props.strict,\n            sensitive = _element$props.sensitive,\n            from = _element$props.from;\n\n        var path = pathProp || from;\n\n        child = element;\n        match = matchPath(location.pathname, { path: path, exact: exact, strict: strict, sensitive: sensitive }, route.match);\n      }\n    });\n\n    return match ? React.cloneElement(child, { location: location, computedMatch: match }) : null;\n  };\n\n  return Switch;\n}(React.Component);\n\nSwitch.contextTypes = {\n  router: PropTypes.shape({\n    route: PropTypes.object.isRequired\n  }).isRequired\n};\nSwitch.propTypes = {\n  children: PropTypes.node,\n  location: PropTypes.object\n};\n\n\nexport default Switch;","// Written in this round about way for babel-transform-imports\nimport Switch from \"react-router/es/Switch\";\n\nexport default Switch;"],"sourceRoot":""}